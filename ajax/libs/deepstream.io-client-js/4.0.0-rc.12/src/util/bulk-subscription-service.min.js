"use strict";var __read=this&&this.__read||function(s,i){var t="function"==typeof Symbol&&s[Symbol.iterator];if(!t)return s;var e,r,n=t.call(s),c=[];try{for(;(void 0===i||0<i--)&&!(e=n.next()).done;)c.push(e.value)}catch(s){r={error:s}}finally{try{e&&!e.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}return c},__spread=this&&this.__spread||function(){for(var s=[],i=0;i<arguments.length;i++)s=s.concat(__read(arguments[i]));return s};Object.defineProperty(exports,"__esModule",{value:!0});var BulkSubscriptionService=function(){function s(s,i,t,e,r,n,c,o){void 0===o&&(o=function(){}),this.services=s,this.subscriptionInterval=i,this.topic=t,this.subscribeBulkAction=e,this.subscribeOriginalAction=r,this.unsubscribeBulkAction=n,this.unsubscribeOriginalAction=c,this.onSubscriptionSent=o,this.subscribeNames=new Set,this.unsubscribeNames=new Set,this.timerRef=-1,this.correlationId=0,this.services.connection.onLost(this.onLost.bind(this))}return s.prototype.subscribe=function(s){if(0<this.subscriptionInterval||!this.subscribeOriginalAction)this.unsubscribeNames.has(s)?this.unsubscribeNames.delete(s):(this.subscribeNames.add(s),this.registerFlush());else{var i={topic:this.topic,action:this.subscribeOriginalAction,name:s};this.services.connection.sendMessage(i),this.onSubscriptionSent(i)}},s.prototype.subscribeList=function(s){s.forEach(this.subscribe.bind(this))},s.prototype.unsubscribe=function(s){if(0<this.subscriptionInterval||!this.unsubscribeOriginalAction)this.subscribeNames.has(s)?this.subscribeNames.delete(s):(this.unsubscribeNames.add(s),this.registerFlush());else{var i={topic:this.topic,action:this.unsubscribeOriginalAction,name:s};this.services.connection.sendMessage(i),this.onSubscriptionSent(i)}},s.prototype.unsubscribeList=function(s){s.forEach(this.unsubscribe.bind(this))},s.prototype.registerFlush=function(){this.services.timerRegistry.has(this.timerRef)||(this.timerRef=this.services.timerRegistry.add({callback:this.sendMessages,context:this,duration:this.subscriptionInterval}))},s.prototype.sendMessages=function(){if(this.services.connection.isConnected){if(0<this.subscribeNames.size){var s={topic:this.topic,action:this.subscribeBulkAction,names:__spread(this.subscribeNames),correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(s),this.onSubscriptionSent(s),this.subscribeNames.clear()}if(0<this.unsubscribeNames.size){s={topic:this.topic,action:this.unsubscribeBulkAction,names:__spread(this.unsubscribeNames),correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(s),this.onSubscriptionSent(s),this.unsubscribeNames.clear()}}else this.onLost()},s.prototype.onLost=function(){this.services.timerRegistry.remove(this.timerRef),this.subscribeNames.clear(),this.unsubscribeNames.clear()},s}();exports.BulkSubscriptionService=BulkSubscriptionService;