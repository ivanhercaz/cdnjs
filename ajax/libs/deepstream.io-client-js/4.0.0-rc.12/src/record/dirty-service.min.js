"use strict";var __read=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var i,o,s=r.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(i=s.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return a},__spread=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t};Object.defineProperty(exports,"__esModule",{value:!0});var DirtyService=function(){function t(t,e){this.storage=t,this.dirtyStorageName=e,this.dirtyRecords=new Map,this.loadedCallback=[],this.flushTimeout=null,this.loaded=!1,this.save=this.save.bind(this),this.load()}return t.prototype.isDirty=function(t){return this.dirtyRecords.has(t)},t.prototype.setDirty=function(t,e){e?this.dirtyRecords.set(t,!0):this.dirtyRecords.delete(t),this.flushTimeout||(this.flushTimeout=setTimeout(this.save,1e3))},t.prototype.save=function(){this.storage.set(this.dirtyStorageName,1,__spread(this.dirtyRecords),function(){}),this.flushTimeout&&clearTimeout(this.flushTimeout),this.flushTimeout=null},t.prototype.whenLoaded=function(t,e){this.loaded?e.call(t):this.loadedCallback.push({callback:e,context:t})},t.prototype.getAll=function(){return this.dirtyRecords},t.prototype.load=function(){var i=this;this.loaded||this.storage.get(this.dirtyStorageName,function(t,e,r){i.dirtyRecords=r?new Map(r):new Map,i.loaded=!0,i.loadedCallback.forEach(function(t){var e=t.callback,r=t.context;return e.call(r)})})},t}();exports.DirtyService=DirtyService;