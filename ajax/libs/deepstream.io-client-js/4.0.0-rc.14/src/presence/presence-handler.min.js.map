{"version":3,"sources":["presence-handler.js"],"names":["Object","defineProperty","exports","value","constants_1","require","message_constants_1","Emitter","bulk_subscription_service_1","ONLY_EVENT","validateQueryArguments","rest","users","callback","length","Array","isArray","Error","PresenceHandler","services","options","this","globalSubscriptionEmitter","subscriptionEmitter","queryEmitter","queryAllEmitter","counter","limboQueue","bulkSubscription","BulkSubscriptionService","subscriptionInterval","TOPIC","PRESENCE","PRESENCE_ACTIONS","SUBSCRIBE_BULK","UNSUBSCRIBE_BULK","onBulkSubscriptionSent","bind","connection","registerHandler","handle","onExitLimbo","onLost","onReestablished","onConnectionReestablished","prototype","subscribe","userOrCallback","user","hasListeners","on","subscribeToAllChanges","unsubscribe","off","unsubscribeToAllChanges","unsubscribeList","eventNames","getAll","_i","arguments","message","emitter","emitterAction","_a","queryId","toString","topic","action","QUERY","correlationId","names","QUERY_ALL","isConnected","sendQuery","isInLimbo","push","timerRegistry","requestIdleCallback","emit","EVENT","CLIENT_OFFLINE","Promise","resolve","reject","once","error","results","isAck","timeoutRegistry","remove","QUERY_ALL_RESPONSE","QUERY_RESPONSE","parsedData","PRESENCE_JOIN","PRESENCE_JOIN_ALL","PRESENCE_LEAVE","PRESENCE_LEAVE_ALL","isError","originalAction","logger","UNSOLICITED_MESSAGE","name","sendMessage","add","SUBSCRIBE_ALL","UNSUBSCRIBE_ALL","keys","subscribeList","i","_this","forEach"],"mappings":"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"}