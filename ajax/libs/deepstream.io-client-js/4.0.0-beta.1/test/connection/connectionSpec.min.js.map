{"version":3,"sources":["connectionSpec.js"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","bluebird_1","require","chai_1","sinon_1","connection_1","mocks_1","client_options_1","constants_1","message_constants_1","Emitter","describe","connection","services","options","emitter","emitterMock","socket","socketMock","logger","loggerMock","authCallback","url","authData","password","clientData","name","initialUrl","otherUrl","openConnection","simulateOpen","delay","awaitConnectionAck","expects","once","withExactArgs","EVENT","CONNECTION_STATE_CHANGED","CONNECTION_STATE","AWAITING_CONNECTION","CHALLENGING","expect","to","equal","sendChallenge","topic","TOPIC","CONNECTION","action","CONNECTION_ACTIONS","CHALLENGE","receiveChallengeAccept","AWAITING_AUTHENTICATION","simulateMessages","ACCEPT","receiveChallengeReject","REJECT","sendAuth","AUTHENTICATING","AUTH","AUTH_ACTIONS","REQUEST","parsedData","authenticate","receiveAuthResponse","data","receivedClientData","OPEN","CLIENT_DATA_CHANGED","assign","AUTH_SUCCESSFUL","receiveConnectionError","CONNECTION_ERROR","JSON","stringify","code","simulateError","receiveAuthRejectResponse","AUTH_UNSUCCESSFUL","INVALID_MESSAGE_DATA","getSocketMock","socketService","getSocket","beforeEach","getServicesMock","DefaultOptions","heartbeatInterval","reconnectIntervalIncrement","maxReconnectAttempts","maxReconnectInterval","mock","Connection","loggerService","getLogger","getLoggerMock","spy","afterEach","verify","it","EVENT_ACTIONS","EMIT","sendMessage","CLOSING","close","closeConnection","CLOSED","simulateRemoteClose","recieveConnectionClose","PONG","PING","HEARTBEAT_TIMEOUT","REDIRECTING","REDIRECT","receiveRedirect","openConnectionToRedirectedServer","RECONNECTING","loseConnection","reconnectToInitialServer","CHALLENGE_DENIED","withArgs","IS_CLOSED","assert","callCount","calledOnce","calledWithExactly","reason","INVALID_AUTHENTICATION_DETAILS","TOO_MANY_AUTH_ATTEMPTS","receiveTooManyAuthAttempts","AUTHENTICATION_TIMEOUT","receiveAuthenticationTimeout","throw","sendBadAuthDataAndReceiveError","MAX_RECONNECTION_ATTEMPTS_REACHED","REAUTHENTICATION_FAILURE","receiveChallengeAcceptAndResendAuth"],"mappings":"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"}