"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const message_constants_1=require("../../binary-protocol/src/message-constants"),utils_1=require("../../binary-protocol/src/utils"),client_1=require("../client");class WriteAcknowledgementService{constructor(e){this.services=e,this.responses=new Map,this.count=1,this.services.connection.onLost(this.onConnectionLost.bind(this))}send(e,s){if(!1===this.services.connection.isConnected)return void this.services.timerRegistry.requestIdleCallback(s.bind(this,client_1.EVENT.CLIENT_OFFLINE));const t=this.count.toString();this.responses.set(t,s),this.services.connection.sendMessage(Object.assign({},e,{correlationId:t,action:utils_1.ACTION_TO_WRITE_ACK[e.action]})),this.count++}recieve(e){const s=e.correlationId,t=this.responses.get(s);t&&(e.action===message_constants_1.RECORD_ACTIONS.WRITE_ACKNOWLEDGEMENT||e.isError)&&(e.isError?t(message_constants_1.RECORD_ACTIONS[e.action]):t(null),this.responses.delete(s))}onConnectionLost(){this.responses.forEach(e=>{e(client_1.EVENT.CLIENT_OFFLINE)}),this.responses.clear()}}exports.WriteAcknowledgementService=WriteAcknowledgementService;