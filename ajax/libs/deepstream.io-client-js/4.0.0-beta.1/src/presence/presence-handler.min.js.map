{"version":3,"sources":["presence-handler.js"],"names":["Object","defineProperty","exports","value","client_1","require","message_constants_1","Emitter","ONLY_EVENT","validateQueryArguments","rest","users","cb","length","Array","isArray","Error","callback","PresenceHandler","[object Object]","services","options","this","subscriptionEmitter","globalSubscriptionEmitter","queryEmitter","queryAllEmitter","resubscribe","bind","connection","registerHandler","TOPIC","PRESENCE","handle","onReestablished","onLost","onConnectionLost","counter","pendingSubscribes","Set","pendingUnsubscribes","userOrCallback","user","hasListeners","add","on","delete","registerFlushTimeout","subscribeToAllChanges","off","unsubscribeToAllChanges","clear","eventNames","i","isConnected","timerRegistry","requestIdleCallback","EVENT","CLIENT_OFFLINE","Promise","reject","message","emitter","emitterAction","queryId","toString","topic","action","PRESENCE_ACTIONS","QUERY","correlationId","names","QUERY_ALL","sendMessage","timeoutRegistry","resolve","once","error","results","isAck","remove","QUERY_ALL_RESPONSE","emit","assign","QUERY_RESPONSE","parsedData","PRESENCE_JOIN","PRESENCE_JOIN_ALL","PRESENCE_LEAVE","PRESENCE_LEAVE_ALL","isError","originalAction","logger","UNSOLICITED_MESSAGE","name","subUsers","from","keys","bulkSubscription","SUBSCRIBE","unsubUsers","UNSUBSCRIBE","flushTimeout","SUBSCRIBE_ALL","UNSUBSCRIBE_ALL","duration","context","flush","forEach"],"mappings":"AAAA,aACAA,OAAOC,eAAeC,QAAS,cAAgBC,OAAO,IACtD,MAAMC,SAAWC,QAAQ,aACnBC,oBAAsBD,QAAQ,+CAC9BE,QAAUF,QAAQ,sBAClBG,WAAa,KACnB,SAASC,uBAAuBC,GAC5B,IAAIC,EAAQ,KACRC,EAAK,KACT,GAAoB,IAAhBF,EAAKG,OACL,GAAIC,MAAMC,QAAQL,EAAK,IACnBC,EAAQD,EAAK,OAEZ,CACD,GAAuB,mBAAZA,EAAK,GACZ,MAAM,IAAIM,MAAM,gCAEpBJ,EAAKF,EAAK,QAGb,GAAoB,IAAhBA,EAAKG,SACVF,EAAQD,EAAK,GACbE,EAAKF,EAAK,IACLI,MAAMC,QAAQJ,IAAwB,mBAAPC,GAChC,MAAM,IAAII,MAAM,2CAGxB,OAASL,MAAAA,EAAOM,SAAUL,SAExBM,gBACFC,YAAYC,EAAUC,GAClBC,KAAKF,SAAWA,EAChBE,KAAKD,QAAUA,EACfC,KAAKC,oBAAsB,IAAIhB,QAC/Be,KAAKE,0BAA4B,IAAIjB,QACrCe,KAAKG,aAAe,IAAIlB,QACxBe,KAAKI,gBAAkB,IAAInB,QAC3Be,KAAKK,YAAcL,KAAKK,YAAYC,KAAKN,MACzCA,KAAKF,SAASS,WAAWC,gBAAgBxB,oBAAoByB,MAAMC,SAAUV,KAAKW,OAAOL,KAAKN,OAC9FA,KAAKF,SAASS,WAAWK,gBAAgBZ,KAAKK,YAAYC,KAAKN,OAC/DA,KAAKF,SAASS,WAAWM,OAAOb,KAAKc,iBAAiBR,KAAKN,OAC3DA,KAAKe,QAAU,EACff,KAAKgB,kBAAoB,IAAIC,IAC7BjB,KAAKkB,oBAAsB,IAAID,IAEnCpB,UAAUsB,EAAgBxB,GACtB,GAA8B,iBAAnBwB,GAA+BA,EAAe5B,OAAS,GAAyB,mBAAbI,EAAyB,CACnG,MAAMyB,EAAOD,EAOb,OANKnB,KAAKC,oBAAoBoB,aAAaD,IACvCpB,KAAKgB,kBAAkBM,IAAIF,GAE/BpB,KAAKC,oBAAoBsB,GAAGH,EAAMzB,GAClCK,KAAKkB,oBAAoBM,OAAOJ,QAChCpB,KAAKyB,uBAGT,GAA8B,mBAAnBN,QAAqD,IAAbxB,EAK/C,OAJKK,KAAKC,oBAAoBoB,aAAanC,aACvCc,KAAK0B,6BAET1B,KAAKE,0BAA0BqB,GAAGrC,WAAYiC,GAGlD,MAAM,IAAIzB,MAAM,2CAEpBG,YAAYsB,EAAgBxB,GACxB,KAAIwB,GAA4C,iBAAnBA,GAA+BA,EAAe5B,OAAS,GAApF,CAkBA,GAAI4B,GAA4C,mBAAnBA,EAMzB,OALAxB,EAAWwB,EACXnB,KAAKE,0BAA0ByB,IAAIzC,WAAYS,QAC1CK,KAAKC,oBAAoBoB,aAAanC,aACvCc,KAAK4B,2BAIb,QAA8B,IAAnBT,QAAsD,IAAbxB,EAA0B,CAC1EK,KAAKC,oBAAoB0B,MACzB3B,KAAKE,0BAA0ByB,MAC/B3B,KAAKgB,kBAAkBa,QACvB,MAAMxC,EAAQW,KAAKC,oBAAoB6B,aACvC,IAAK,IAAIC,EAAI,EAAGA,EAAI1C,EAAME,OAAQwC,IAC9B/B,KAAKkB,oBAAoBI,IAAIjC,EAAM0C,IAIvC,OAFA/B,KAAKyB,4BACLzB,KAAK4B,0BAGT,MAAM,IAAIlC,MAAM,0CAtChB,CACI,MAAM0B,EAAOD,EACb,GAAIxB,EAAU,CACV,GAAwB,mBAAbA,EACP,MAAM,IAAID,MAAM,gCAEpBM,KAAKC,oBAAoB0B,IAAIP,EAAMzB,QAGnCK,KAAKC,oBAAoB0B,IAAIP,GAE5BpB,KAAKC,oBAAoBoB,aAAaD,KACvCpB,KAAKgB,kBAAkBQ,OAAOJ,GAC9BpB,KAAKkB,oBAAoBI,IAAIF,GAC7BpB,KAAKyB,yBA0BjB5B,UAAUT,GACN,MAAMO,SAAEA,EAAQN,MAAEA,GAAUF,uBAAuBC,GACnD,IAAKY,KAAKF,SAASS,WAAWyB,YAC1B,OAAIrC,OACAK,KAAKF,SAASmC,cAAcC,oBAAoBvC,EAASW,KAAKN,KAAMlB,SAASqD,MAAMC,iBAGhFC,QAAQC,OAAOxD,SAASqD,MAAMC,gBAEzC,IAAIG,EACAC,EACAC,EACJ,GAAIpD,EAAO,CACP,MAAMqD,GAAW1C,KAAKe,WAAW4B,WACjCJ,GACIK,MAAO5D,oBAAoByB,MAAMC,SACjCmC,OAAQ7D,oBAAoB8D,iBAAiBC,MAC7CC,cAAeN,EACfO,MAAO5D,GAEXmD,EAAUxC,KAAKG,aACfsC,EAAgBC,OAGhBH,GACIK,MAAO5D,oBAAoByB,MAAMC,SACjCmC,OAAQ7D,oBAAoB8D,iBAAiBI,WAEjDV,EAAUxC,KAAKI,gBACfqC,EAAgBvD,WAIpB,GAFAc,KAAKF,SAASS,WAAW4C,YAAYZ,GACrCvC,KAAKF,SAASsD,gBAAgB9B,KAAMiB,QAAAA,KAChC5C,EAIJ,OAAO,IAAI0C,QAAQ,CAACgB,EAASf,KACzBE,EAAQc,KAAKb,EAAe,CAACc,EAAOC,KAC5BD,EACAjB,EAAOiB,GAGPF,EAAQG,OAThBhB,EAAQc,KAAKb,EAAe9C,GAcpCE,OAAO0C,GACH,GAAIA,EAAQkB,MACRzD,KAAKF,SAASsD,gBAAgBM,OAAOnB,OADzC,CAIA,GAAIA,EAAQM,SAAW7D,oBAAoB8D,iBAAiBa,mBAGxD,OAFA3D,KAAKI,gBAAgBwD,KAAK1E,WAAY,KAAMqD,EAAQU,YACpDjD,KAAKF,SAASsD,gBAAgBM,OAAOhF,OAAOmF,UAAWtB,GAAWM,OAAQ7D,oBAAoB8D,iBAAiBI,aAGnH,GAAIX,EAAQM,SAAW7D,oBAAoB8D,iBAAiBgB,eAGxD,OAFA9D,KAAKG,aAAayD,KAAKrB,EAAQS,cAAe,KAAMT,EAAQwB,iBAC5D/D,KAAKF,SAASsD,gBAAgBM,OAAOhF,OAAOmF,UAAWtB,GAAWM,OAAQ7D,oBAAoB8D,iBAAiBC,SAGnH,GAAIR,EAAQM,SAAW7D,oBAAoB8D,iBAAiBkB,cAI5D,GAAIzB,EAAQM,SAAW7D,oBAAoB8D,iBAAiBmB,kBAI5D,GAAI1B,EAAQM,SAAW7D,oBAAoB8D,iBAAiBoB,eAA5D,CAIA,GAAI3B,EAAQM,SAAW7D,oBAAoB8D,iBAAiBqB,mBAI5D,OAAI5B,EAAQ6B,SACRpE,KAAKF,SAASsD,gBAAgBM,OAAOnB,QACjCA,EAAQ8B,iBAAmBrF,oBAAoB8D,iBAAiBC,MAChE/C,KAAKG,aAAayD,KAAKrB,EAAQS,cAAehE,oBAAoB8D,iBAAiBP,EAAQM,SAEtFN,EAAQ8B,iBAAmBrF,oBAAoB8D,iBAAiBI,UACrElD,KAAKI,gBAAgBwD,KAAK1E,WAAYF,oBAAoB8D,iBAAiBP,EAAQM,SAGnF7C,KAAKF,SAASwE,OAAOf,MAAMhB,UAInCvC,KAAKF,SAASwE,OAAOf,MAAMhB,EAASzD,SAASqD,MAAMoC,qBAhB/CvE,KAAKE,0BAA0B0D,KAAK1E,WAAYqD,EAAQiC,MAAM,QAJ9DxE,KAAKC,oBAAoB2D,KAAKrB,EAAQiC,KAAMjC,EAAQiC,MAAM,QAJ1DxE,KAAKE,0BAA0B0D,KAAK1E,WAAYqD,EAAQiC,MAAM,QAJ9DxE,KAAKC,oBAAoB2D,KAAKrB,EAAQiC,KAAMjC,EAAQiC,MAAM,IA8BlE3E,QACI,IAAKG,KAAKF,SAASS,WAAWyB,YAE1B,OAEJ,MAAMyC,EAAWjF,MAAMkF,KAAK1E,KAAKgB,kBAAkB2D,QAC/CF,EAASlF,OAAS,IAClBS,KAAK4E,iBAAiB5F,oBAAoB8D,iBAAiB+B,UAAWJ,GACtEzE,KAAKgB,kBAAkBa,SAE3B,MAAMiD,EAAatF,MAAMkF,KAAK1E,KAAKkB,oBAAoByD,QACnDG,EAAWvF,OAAS,IACpBS,KAAK4E,iBAAiB5F,oBAAoB8D,iBAAiBiC,YAAaD,GACxE9E,KAAKkB,oBAAoBW,SAE7B7B,KAAKgF,aAAe,KAExBnF,cACI,MAAM8E,EAAO3E,KAAKC,oBAAoB6B,aAClC6C,EAAKpF,OAAS,GACdS,KAAK4E,iBAAiB5F,oBAAoB8D,iBAAiB+B,UAAWF,GAE5C3E,KAAKE,0BAA0BmB,aAAanC,aAEtEc,KAAK0B,wBAGb7B,iBAAiBgD,EAAQI,GACrB,MAAMD,EAAgBhD,KAAKe,UACrBwB,GACFK,MAAO5D,oBAAoByB,MAAMC,SACjCmC,OAAAA,EACAG,cAAeA,EAAcL,WAC7BM,MAAAA,GAEJjD,KAAKF,SAASsD,gBAAgB9B,KAAMiB,QAAAA,IACpCvC,KAAKF,SAASS,WAAW4C,YAAYZ,GAEzC1C,wBACI,IAAKG,KAAKF,SAASS,WAAWyB,YAC1B,OAEJ,MAAMO,GAAYK,MAAO5D,oBAAoByB,MAAMC,SAAUmC,OAAQ7D,oBAAoB8D,iBAAiBmC,eAC1GjF,KAAKF,SAASsD,gBAAgB9B,KAAMiB,QAAAA,IACpCvC,KAAKF,SAASS,WAAW4C,YAAYZ,GAEzC1C,0BACI,IAAKG,KAAKF,SAASS,WAAWyB,YAC1B,OAEJ,MAAMO,GAAYK,MAAO5D,oBAAoByB,MAAMC,SAAUmC,OAAQ7D,oBAAoB8D,iBAAiBoC,iBAC1GlF,KAAKF,SAASsD,gBAAgB9B,KAAMiB,QAAAA,IACpCvC,KAAKF,SAASS,WAAW4C,YAAYZ,GAEzC1C,uBACSG,KAAKgF,eACNhF,KAAKgF,aAAehF,KAAKF,SAASmC,cAAcX,KAC5C6D,SAAU,EACVC,QAASpF,KACTL,SAAUK,KAAKqF,SAI3BxF,mBACIG,KAAKG,aAAa2B,aAAawD,QAAQtC,IACnChD,KAAKG,aAAayD,KAAKZ,EAAelE,SAASqD,MAAMC,kBAEzDpC,KAAKI,gBAAgBwD,KAAK1E,WAAYJ,SAASqD,MAAMC,iBAG7DxD,QAAQgB,gBAAkBA"}