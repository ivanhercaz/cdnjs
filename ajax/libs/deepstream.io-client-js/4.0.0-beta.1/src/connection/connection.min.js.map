{"version":3,"sources":["connection.js"],"names":["Object","defineProperty","exports","value","constants_1","require","message_constants_1","message_parser_1","state_machine_1","utils","Emitter","Connection","[object Object]","services","options","url","emitter","this","authParams","handlers","Map","isConnected","authCallback","internalEmitter","isReconnecting","firstOpen","stateMachine","StateMachine","logger","init","CONNECTION_STATE","CLOSED","onStateChanged","newState","oldState","OPEN","emit","EVENT","CONNECTION_STATE_CHANGED","RECONNECTING","CONNECTION_LOST","CONNECTION_REESTABLISHED","transitions","name","from","to","AWAITING_CONNECTION","REDIRECTING","CHALLENGING","CHALLENGE_DENIED","AWAITING_AUTHENTICATION","handler","onAwaitingAuthentication","bind","AUTHENTICATION_TIMEOUT","AUTHENTICATING","TOO_MANY_AUTH_ATTEMPTS","CLOSING","originalUrl","parseUrl","path","createEndpoint","callback","on","topic","set","message","isOpen","endpoint","sendParsedMessage","error","IS_CLOSED","authParamsOrCallback","Error","state","sendAuthParams","TOPIC","CONNECTION","connState","getConnectionState","ERROR","timerRegistry","remove","heartbeatInterval","sendMessage","action","CONNECTION_ACTIONS","transition","socketFactory","socketOptions","onopen","onOpen","onerror","onError","onclose","onClose","onparsedmessages","onMessages","clearReconnect","lastHeartBeat","Date","now","checkHeartBeat","CHALLENGE","protocolVersion","setTimeout","msg","code","JSON","stringify","e","toString","CONNECTION_ERROR","tryReconnect","parseResults","forEach","parseResult","parseError","PARSER","raw","res","parseData","PARSER_ACTIONS","INVALID_MESSAGE","handleConnectionResponse","AUTH","handleAuthResponse","get","AUTH_ACTIONS","REQUEST","parsedData","heartBeatTolerance","HEARTBEAT_TIMEOUT","close","add","duration","context","reconnectTimeout","reconnectionAttempt","maxReconnectAttempts","tryOpen","Math","min","maxReconnectInterval","reconnectIntervalIncrement","MAX_RECONNECTION_ATTEMPTS_REACHED","clearTimeout","PING","PONG","ACCEPT","REJECT","REDIRECT","deliberateClose","AUTH_UNSUCCESSFUL","onAuthUnSuccessful","AUTH_SUCCESSFUL","onAuthSuccessful","clientData","updateClientData","reason","INVALID_AUTHENTICATION_DETAILS","REAUTHENTICATION_FAILURE","data","newClientData","undefined","keys","length","deepEquals","CLIENT_DATA_CHANGED","assign"],"mappings":"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"}