"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const message_constants_1=require("../../binary-protocol/src/message-constants");class RPC{constructor(s,e,t,i,o){this.options=i,this.services=o,this.name=s,this.response=t,this.acceptTimeout=this.services.timeoutRegistry.add({message:{topic:message_constants_1.TOPIC.RPC,action:message_constants_1.RPC_ACTIONS.ACCEPT,name:s,correlationId:e},event:message_constants_1.RPC_ACTIONS.ACCEPT_TIMEOUT,duration:this.options.rpcAcceptTimeout,callback:this.onTimeout.bind(this)}),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:message_constants_1.TOPIC.RPC,action:message_constants_1.RPC_ACTIONS.REQUEST,name:s,correlationId:e},event:message_constants_1.RPC_ACTIONS.RESPONSE_TIMEOUT,duration:this.options.rpcResponseTimeout,callback:this.onTimeout.bind(this)})}accept(){this.services.timeoutRegistry.clear(this.acceptTimeout)}respond(s){this.response(null,s),this.complete()}error(s){this.response(s),this.complete()}onTimeout(s,e){this.response(message_constants_1.RPC_ACTIONS[s]),this.complete()}complete(){this.services.timeoutRegistry.clear(this.acceptTimeout),this.services.timeoutRegistry.clear(this.responseTimeout)}}exports.RPC=RPC;