{"version":3,"sources":["message-parser.js"],"names":["Object","defineProperty","exports","value","message_constants_1","require","constants_1","utils_1","message_validator_1","isError","message","action","topic","TOPIC","PARSER","parse","buffer","queue","offset","messages","bytesConsumed","rawMessage","readBinary","push","fin","parseMessage","joinMessages","length","parseData","undefined","parsedData","data","payloadEncoding","PAYLOAD_ENCODING","JSON","Error","parseJSON","buff","HEADER_LENGTH","metaLength","readUIntBE","payloadLength","messageLength","rawHeader","slice","meta","payload","rawMessages","payloadSections","metaSections","forEach","payloadSection","metaSection","Buffer","concat","rawTopic","rawAction","parseError","PARSER_ACTIONS","UNKNOWN_TOPIC","parsedMessage","description","raw","ACTIONS","UNKNOWN_ACTION","MESSAGE_PARSE_ERROR","toString","metaError","validateMeta","addMetadataToMessage","hasPayload","INVALID_MESSAGE","BINARY","isAck","RECORD","isWriteAck","key","META_KEYS","err"],"mappings":"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"}