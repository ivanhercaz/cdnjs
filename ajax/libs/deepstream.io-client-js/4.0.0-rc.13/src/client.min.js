"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var client_options_1=require("./client-options"),logger_1=require("./util/logger"),timeout_registry_1=require("./util/timeout-registry"),timer_registry_1=require("./util/timer-registry"),connection_1=require("./connection/connection"),socket_factory_1=require("./connection/socket-factory"),event_handler_1=require("./event/event-handler"),rpc_handler_1=require("./rpc/rpc-handler"),record_handler_1=require("./record/record-handler"),presence_handler_1=require("./presence/presence-handler"),EventEmitter=require("component-emitter2"),indexdb_storage_service_1=require("./storage/indexdb-storage-service"),noop_storage_service_1=require("./storage/noop-storage-service"),Client=function(o){function e(e,t){void 0===t&&(t={});var n=o.call(this)||this;n.options=__assign({},client_options_1.DefaultOptions,t);var r={};return r.logger=new logger_1.Logger(n),r.timerRegistry=new timer_registry_1.TimerRegistry(n.options.timerResolution),r.timeoutRegistry=new timeout_registry_1.TimeoutRegistry(r,n.options),r.socketFactory=n.options.socketFactory||socket_factory_1.socketFactory,r.connection=new connection_1.Connection(r,n.options,e,n),n.options.offlineEnabled?r.storage=n.options.storage||new indexdb_storage_service_1.Storage(n.options):r.storage=new noop_storage_service_1.NoopStorage,n.services=r,n.services.connection.onLost(r.timeoutRegistry.onConnectionLost.bind(r.timeoutRegistry)),n.event=new event_handler_1.EventHandler(n.services,n.options),n.rpc=new rpc_handler_1.RPCHandler(n.services,n.options),n.record=new record_handler_1.RecordHandler(n.services,n.options),n.presence=new presence_handler_1.PresenceHandler(n.services,n.options),n}return __extends(e,o),e.prototype.login=function(e,t){var o=this;if(e&&"object"==typeof e){if(!t)return new Promise(function(n,r){o.services.connection.authenticate(e,function(e,t){(e?n:r)(t)})});this.services.connection.authenticate(e,t)}else{if("function"!=typeof e)return new Promise(function(n,r){o.services.connection.authenticate({},function(e,t){(e?n:r)(t)})});this.services.connection.authenticate({},e)}},e.prototype.getConnectionState=function(){return this.services.connection.getConnectionState()},e.prototype.close=function(){this.services.connection.close()},e.prototype.pause=function(){this.services.connection.pause()},e.prototype.resume=function(e){var r=this;if(!e)return new Promise(function(t,n){r.services.connection.resume(function(e){e?n(e):t()})});this.services.connection.resume(e)},e.prototype.getUid=function(){return(new Date).getTime().toString(36)+"-"+(1e16*Math.random()).toString(36).replace(".","")},e}(EventEmitter);exports.Client=Client;