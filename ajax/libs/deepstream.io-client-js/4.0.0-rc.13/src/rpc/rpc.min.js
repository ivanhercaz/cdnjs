"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var message_constants_1=require("../../binary-protocol/src/message-constants"),RPC=function(){function t(t,e,s,o,i,n){this.name=t,this.correlationId=e,this.response=o,this.options=i,this.services=n,this.onTimeout=this.onTimeout.bind(this);var c={topic:message_constants_1.TOPIC.RPC,action:message_constants_1.RPC_ACTIONS.REQUEST,correlationId:e,name:t,parsedData:s};this.acceptTimeout=this.services.timeoutRegistry.add({message:{topic:message_constants_1.TOPIC.RPC,action:message_constants_1.RPC_ACTIONS.ACCEPT,name:this.name,correlationId:this.correlationId},event:message_constants_1.RPC_ACTIONS.ACCEPT_TIMEOUT,duration:this.options.rpcAcceptTimeout,callback:this.onTimeout}),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:message_constants_1.TOPIC.RPC,action:message_constants_1.RPC_ACTIONS.REQUEST,name:this.name,correlationId:this.correlationId},event:message_constants_1.RPC_ACTIONS.RESPONSE_TIMEOUT,duration:this.options.rpcResponseTimeout,callback:this.onTimeout}),this.services.connection.sendMessage(c)}return t.prototype.accept=function(){this.services.timeoutRegistry.clear(this.acceptTimeout)},t.prototype.respond=function(t){this.response(null,t),this.complete()},t.prototype.error=function(t){this.response(t),this.complete()},t.prototype.onTimeout=function(t,e){this.response(message_constants_1.RPC_ACTIONS[t]),this.complete()},t.prototype.complete=function(){this.services.timeoutRegistry.clear(this.acceptTimeout),this.services.timeoutRegistry.clear(this.responseTimeout)},t}();exports.RPC=RPC;