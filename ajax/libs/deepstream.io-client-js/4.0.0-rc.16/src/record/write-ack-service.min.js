"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var message_constants_1=require("../../binary-protocol/src/message-constants"),utils_1=require("../../binary-protocol/src/utils"),constants_1=require("../constants"),WriteAcknowledgementService=function(){function e(e){this.services=e,this.responses=new Map,this.count=1,this.services.connection.onLost(this.onConnectionLost.bind(this))}return e.prototype.send=function(e,s){if(!1!==this.services.connection.isConnected){var t=this.count.toString();this.responses.set(t,s),this.services.connection.sendMessage(Object.assign({},e,{correlationId:t,action:utils_1.ACTION_TO_WRITE_ACK[e.action]})),this.count++}else this.services.timerRegistry.requestIdleCallback(s.bind(this,constants_1.EVENT.CLIENT_OFFLINE))},e.prototype.recieve=function(e){var s=e.correlationId,t=this.responses.get(s);t&&(e.action===message_constants_1.RECORD_ACTIONS.WRITE_ACKNOWLEDGEMENT||e.isError)&&(e.isError?t(message_constants_1.RECORD_ACTIONS[e.action]):t(null),this.responses.delete(s))},e.prototype.onConnectionLost=function(){this.responses.forEach(function(e){return e(constants_1.EVENT.CLIENT_OFFLINE)}),this.responses.clear()},e}();exports.WriteAcknowledgementService=WriteAcknowledgementService;