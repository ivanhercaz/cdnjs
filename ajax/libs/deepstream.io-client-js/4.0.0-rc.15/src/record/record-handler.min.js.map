{"version":3,"sources":["record-handler.js"],"names":["Object","defineProperty","exports","value","utils","require","constants_1","message_constants_1","utils_1","record_core_1","record_1","anonymous_record_1","list_1","listener_1","single_notifier_1","write_ack_service_1","dirty_service_1","merge_strategy_service_1","bulk_subscription_service_1","RecordHandler","services","options","recordServices","listener","_a","this","Listener","TOPIC","RECORD","recordCores","Map","bulkSubscriptionService","RECORD_ACTIONS","SUBSCRIBECREATEANDREAD_BULK","getBulkSubscriptionService","SUBSCRIBECREATEANDREAD","SUBSCRIBEANDHEAD_BULK","SUBSCRIBEANDHEAD","SUBSCRIBEANDREAD_BULK","SUBSCRIBEANDREAD","writeAckService","WriteAcknowledgementService","readRegistry","SingleNotifier","READ","recordReadTimeout","headRegistry","HEAD","dirtyService","DirtyService","storage","dirtyStorageName","mergeStrategy","MergeStrategyService","sendUpdatedData","bind","onRecordUpdated","onMergeCompleted","getRecordCore","removeRecord","onBulkSubscriptionSent","connection","registerHandler","handle","onReestablished","syncDirtyRecords","isConnected","prototype","setMergeStrategy","recordName","Error","setMergeStrategyByName","setMergeStrategyRegExp","regexp","setMergeStrategyByPattern","getRecord","name","Record","getList","List","getAnonymousRecord","AnonymousRecord","listen","pattern","callback","unlisten","snapshot","_this","length","undefined","recordCore","get","whenReady","Promise","resolve","reject","request","error","data","has","cb","version","head","setDataWithAck","rest","_i","arguments","args","normalizeSetArguments","sendSetData","setData","path","set","action","ERASE","CREATEANDPATCH","CREATEANDUPDATE","message","topic","parsedData","send","sendMessage","isAck","timeoutRegistry","remove","SUBSCRIPTION_FOR_PATTERN_FOUND","SUBSCRIPTION_FOR_PATTERN_REMOVED","LISTEN","UNLISTEN","isWriteAck","originalAction","recieve","READ_RESPONSE","HEAD_RESPONSE","isError","VERSION_EXISTS","SUBSCRIPTION_HAS_PROVIDER","SUBSCRIPTION_HAS_NO_PROVIDER","logger","EVENT","UNSOLICITED_MESSAGE","delete","RecordCore","whenLoaded","_syncDirtyRecords","dirtyRecords","getAll","references","size","setDirty","mergeData","remoteVersion","remoteData","bulkSubscribe","subscribe","BulkSubscriptionService","subscriptionInterval","UNSUBSCRIBE_BULK","UNSUBSCRIBE","names","add"],"mappings":"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"}