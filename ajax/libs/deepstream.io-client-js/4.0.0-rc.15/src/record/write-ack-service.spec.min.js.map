{"version":3,"sources":["write-ack-service.spec.js"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","_this","Object","defineProperty","exports","bluebird_1","require","sinon_1","mocks_1","constants_1","message_constants_1","write_ack_service_1","describe","services","writeAckService","callbackSpy","topic","TOPIC","RECORD","action","RECORD_ACTIONS","CREATEANDPATCH","ackAction","CREATEANDPATCH_WITH_WRITE_ACK","name","beforeEach","getServicesMock","WriteAcknowledgementService","spy","afterEach","verify","it","_a","connection","isConnected","connectionMock","expects","never","send","delay","assert","calledOnce","calledWithExactly","EVENT","CLIENT_OFFLINE","messageBody","simulateConnectionLost","calledTwice","once","withExactArgs","assign","correlationId","message","msg","recieve","notCalled","WRITE_ACKNOWLEDGEMENT","originalAction","CREATEANDUPDATE_WITH_WRITE_ACK","calledWith","errorAction","MESSAGE_DENIED","isError"],"mappings":"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"}