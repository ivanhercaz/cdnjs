{"version":3,"sources":["message-parser.js"],"names":["_a","_b","_c","Object","defineProperty","exports","value","message_constants_1","require","constants_1","utils_1","message_validator_1","isError","message","action","topic","TOPIC","PARSER","BULK_ACTIONS","RECORD","RECORD_ACTIONS","SUBSCRIBECREATEANDREAD_BULK","SUBSCRIBECREATEANDREAD","SUBSCRIBEANDHEAD_BULK","SUBSCRIBEANDHEAD","SUBSCRIBEANDREAD_BULK","SUBSCRIBEANDREAD","EVENT","EVENT_ACTIONS","SUBSCRIBE_BULK","SUBSCRIBE","UNSUBSCRIBE_BULK","UNSUBSCRIBE","uuid","parse","buffer","queue","_loop_1","readBinary","offset","bytesConsumed","rawMessage","push","fin","message_1","parseMessage","joinMessages","undefined","parseError","isAck","action_1","names","forEach","name","messages","correlationId","isBulk","bulkId","bulkAction","length","parseData","parsedData","data","payloadEncoding","PAYLOAD_ENCODING","JSON","Error","parseJSON","buff","HEADER_LENGTH","metaLength","readUIntBE","payloadLength","messageLength","rawHeader","slice","meta","payload","rawMessages","payloadSections","metaSections","payloadSection","metaSection","Buffer","concat","rawTopic","rawAction","PARSER_ACTIONS","UNKNOWN_TOPIC","parsedMessage","description","raw","ACTIONS","UNKNOWN_ACTION","MESSAGE_PARSE_ERROR","toString","metaError","validateMeta","addMetadataToMessage","hasPayload","INVALID_MESSAGE","BINARY","isWriteAck","key","META_KEYS","err"],"mappings":"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"}