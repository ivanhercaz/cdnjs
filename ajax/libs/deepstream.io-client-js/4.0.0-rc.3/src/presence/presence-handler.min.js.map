{"version":3,"sources":["presence-handler.js"],"names":["Object","defineProperty","exports","value","constants_1","require","message_constants_1","Emitter","bulk_subscription_service_1","ONLY_EVENT","validateQueryArguments","rest","users","callback","length","Array","isArray","Error","PresenceHandler","[object Object]","services","options","this","globalSubscriptionEmitter","subscriptionEmitter","queryEmitter","queryAllEmitter","counter","limboQueue","bulkSubscription","BulkSubscriptionService","subscriptionInterval","TOPIC","PRESENCE","PRESENCE_ACTIONS","SUBSCRIBE_BULK","UNSUBSCRIBE_BULK","onBulkSubscriptionSent","bind","connection","registerHandler","handle","onExitLimbo","onLost","onReestablished","onConnectionReestablished","userOrCallback","user","hasListeners","subscribe","on","subscribeToAllChanges","off","unsubscribe","unsubscribeToAllChanges","unsubscribeList","eventNames","message","emitter","emitterAction","queryId","toString","topic","action","QUERY","correlationId","names","QUERY_ALL","isConnected","sendQuery","isInLimbo","push","timerRegistry","requestIdleCallback","emit","EVENT","CLIENT_OFFLINE","Promise","resolve","reject","once","error","results","isAck","timeoutRegistry","remove","QUERY_ALL_RESPONSE","QUERY_RESPONSE","parsedData","PRESENCE_JOIN","PRESENCE_JOIN_ALL","PRESENCE_LEAVE","PRESENCE_LEAVE_ALL","isError","originalAction","logger","UNSOLICITED_MESSAGE","name","sendMessage","add","SUBSCRIBE_ALL","UNSUBSCRIBE_ALL","keys","subscribeList","i","forEach"],"mappings":"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"}