"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class BulkSubscriptionService{constructor(s,i,e,t,n,c,r,o=(()=>{})){this.services=s,this.subscriptionInterval=i,this.topic=e,this.subscribeBulkAction=t,this.subscribeOriginalAction=n,this.unsubscribeBulkAction=c,this.unsubscribeOriginalAction=r,this.onSubscriptionSent=o,this.subscribeNames=new Set,this.unsubscribeNames=new Set,this.timerRef=-1,this.correlationId=0,this.services.connection.onLost(this.onLost.bind(this))}subscribe(s){if(this.subscriptionInterval>0||!this.subscribeOriginalAction)return this.unsubscribeNames.delete(s),this.subscribeNames.add(s),void this.registerFlush();const i={topic:this.topic,action:this.subscribeOriginalAction,name:s};this.services.connection.sendMessage(i),this.onSubscriptionSent(i)}subscribeList(s){s.forEach(this.subscribe.bind(this))}unsubscribe(s){if(this.subscriptionInterval>0||!this.unsubscribeOriginalAction)return this.unsubscribeNames.add(s),this.subscribeNames.delete(s),void this.registerFlush();const i={topic:this.topic,action:this.unsubscribeOriginalAction,name:s};this.services.connection.sendMessage(i),this.onSubscriptionSent(i)}unsubscribeList(s){s.forEach(this.unsubscribe.bind(this))}registerFlush(){this.services.timerRegistry.has(this.timerRef)||(this.timerRef=this.services.timerRegistry.add({callback:this.sendMessages,context:this,duration:this.subscriptionInterval}))}sendMessages(){if(this.services.connection.isConnected){if(this.subscribeNames.size>0){const s={topic:this.topic,action:this.subscribeBulkAction,names:[...this.subscribeNames],correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(s),this.onSubscriptionSent(s),this.subscribeNames.clear()}if(this.unsubscribeNames.size>0){const s={topic:this.topic,action:this.unsubscribeBulkAction,names:[...this.unsubscribeNames],correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(s),this.onSubscriptionSent(s),this.unsubscribeNames.clear()}}else this.onLost()}onLost(){this.services.timerRegistry.remove(this.timerRef),this.subscribeNames.clear(),this.unsubscribeNames.clear()}}exports.BulkSubscriptionService=BulkSubscriptionService;