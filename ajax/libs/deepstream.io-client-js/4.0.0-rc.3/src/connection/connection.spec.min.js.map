{"version":3,"sources":["connection.spec.js"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","bluebird_1","require","chai_1","sinon_1","connection_1","mocks_1","client_options_1","constants_1","message_constants_1","Emitter","describe","connection","services","options","emitter","emitterMock","socket","socketMock","loggerMock","authCallback","url","authData","password","clientData","name","initialUrl","otherUrl","openConnection","simulateOpen","delay","awaitConnectionAck","expects","once","withExactArgs","EVENT","CONNECTION_STATE_CHANGED","CONNECTION_STATE","AWAITING_CONNECTION","CHALLENGING","expect","to","equal","sendChallenge","topic","TOPIC","CONNECTION","action","CONNECTION_ACTIONS","CHALLENGE","receiveChallengeAccept","AWAITING_AUTHENTICATION","simulateMessages","ACCEPT","receiveChallengeReject","REJECT","sendAuth","AUTHENTICATING","AUTH","AUTH_ACTIONS","REQUEST","parsedData","authenticate","receiveAuthResponse","data","receivedClientData","OPEN","CLIENT_DATA_CHANGED","assign","AUTH_SUCCESSFUL","receiveConnectionError","CONNECTION_ERROR","JSON","stringify","code","simulateError","receiveAuthRejectResponse","AUTH_UNSUCCESSFUL","INVALID_MESSAGE_DATA","loseConnection","RECONNECTING","close","isConnected","getSocketMock","socketService","getSocket","beforeEach","getServicesMock","DefaultOptions","heartbeatInterval","reconnectIntervalIncrement","maxReconnectAttempts","maxReconnectInterval","offlineBufferTimeout","mock","Connection","loggerService","getLogger","getLoggerMock","spy","afterEach","verify","it","EVENT_ACTIONS","EMIT","sendMessage","CLOSING","closeConnection","CLOSED","simulateRemoteClose","recieveConnectionClose","PONG","PING","HEARTBEAT_TIMEOUT","getTimeSinceLastMessage","REDIRECTING","REDIRECT","receiveRedirect","openConnectionToRedirectedServer","reconnectToInitialServer","CHALLENGE_DENIED","withArgs","IS_CLOSED","assert","callCount","calledOnce","calledWithExactly","reason","INVALID_AUTHENTICATION_DETAILS","TOO_MANY_AUTH_ATTEMPTS","receiveTooManyAuthAttempts","AUTHENTICATION_TIMEOUT","receiveAuthenticationTimeout","throw","sendBadAuthDataAndReceiveError","MAX_RECONNECTION_ATTEMPTS_REACHED","REAUTHENTICATION_FAILURE","receiveChallengeAcceptAndResendAuth","limboSpy","onExitLimbo","isInLimbo"],"mappings":"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"}