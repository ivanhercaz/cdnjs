{"version":3,"sources":["connection.js"],"names":["Object","defineProperty","exports","value","constants_1","require","message_constants_1","message_parser_1","state_machine_1","utils","Emitter","Connection","[object Object]","services","options","url","emitter","this","reconnectTimeout","authParams","handlers","Map","authCallback","resumeCallback","internalEmitter","isInLimbo","clientData","heartbeatIntervalTimeout","endpoint","reconnectionAttempt","limboTimeout","isReconnecting","firstOpen","stateMachine","StateMachine","logger","init","CONNECTION_STATE","CLOSED","onStateChanged","newState","oldState","emit","EVENT","CONNECTION_STATE_CHANGED","RECONNECTING","CONNECTION_LOST","timerRegistry","add","duration","offlineBufferTimeout","context","callback","EXIT_LIMBO","OPEN","CONNECTION_REESTABLISHED","remove","transitions","name","from","to","INITIALISING","AWAITING_CONNECTION","REDIRECTING","CHALLENGING","CHALLENGE_DENIED","AWAITING_AUTHENTICATION","handler","onAwaitingAuthentication","bind","AUTHENTICATION_TIMEOUT","AUTHENTICATING","TOO_MANY_AUTH_ATTEMPTS","CLOSING","PAUSING","OFFLINE","transition","originalUrl","parseUrl","path","lazyConnect","createEndpoint","isConnected","state","on","off","topic","set","message","isOpen","sendParsedMessage","error","IS_CLOSED","authParamsOrCallback","Error","sendAuthParams","TOPIC","CONNECTION","connState","getConnectionState","ERROR","sendMessage","action","CONNECTION_ACTIONS","close","tryReconnect","socketFactory","socketOptions","heartbeatInterval","onopen","onOpen","onerror","onError","onclose","onClose","onparsedmessages","onMessages","clearReconnect","checkHeartBeat","CHALLENGE","protocolVersion","setTimeout","msg","code","JSON","stringify","e","toString","CONNECTION_ERROR","parseResults","forEach","parseResult","parseError","PARSER","raw","res","parseData","PARSER_ACTIONS","INVALID_MESSAGE","handleConnectionResponse","AUTH","handleAuthResponse","get","AUTH_ACTIONS","REQUEST","parsedData","heartBeatTolerance","getTimeSinceLastMessage","HEARTBEAT_TIMEOUT","maxReconnectAttempts","tryOpen","Math","min","maxReconnectInterval","reconnectIntervalIncrement","MAX_RECONNECTION_ATTEMPTS_REACHED","ACCEPT","REJECT","REDIRECT","AUTH_UNSUCCESSFUL","onAuthUnSuccessful","AUTH_SUCCESSFUL","onAuthSuccessful","updateClientData","reason","INVALID_AUTHENTICATION_DETAILS","REAUTHENTICATION_FAILURE","data","newClientData","keys","length","deepEquals","CLIENT_DATA_CHANGED","assign"],"mappings":"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"}