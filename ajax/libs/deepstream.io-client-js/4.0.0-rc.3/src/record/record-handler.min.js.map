{"version":3,"sources":["record-handler.js"],"names":["Object","defineProperty","exports","value","utils","require","constants_1","message_constants_1","utils_1","record_core_1","record_1","anonymous_record_1","list_1","listener_1","single_notifier_1","write_ack_service_1","dirty_service_1","merge_strategy_service_1","bulk_subscription_service_1","RecordHandler","[object Object]","services","options","recordServices","listener","this","Listener","TOPIC","RECORD","recordCores","Map","bulkSubscriptionService","RECORD_ACTIONS","SUBSCRIBECREATEANDREAD_BULK","getBulkSubscriptionService","SUBSCRIBECREATEANDREAD","SUBSCRIBEANDHEAD_BULK","SUBSCRIBEANDHEAD","SUBSCRIBEANDREAD_BULK","SUBSCRIBEANDREAD","writeAckService","WriteAcknowledgementService","readRegistry","SingleNotifier","READ","recordReadTimeout","headRegistry","HEAD","dirtyService","DirtyService","storage","dirtyStorageName","mergeStrategy","MergeStrategyService","sendUpdatedData","bind","onRecordUpdated","onMergeCompleted","getRecordCore","removeRecord","connection","registerHandler","handle","onReestablished","syncDirtyRecords","isConnected","recordName","Error","setMergeStrategyByName","regexp","setMergeStrategyByPattern","name","Record","List","AnonymousRecord","pattern","callback","listen","unlisten","length","undefined","recordCore","get","whenReady","Promise","resolve","reject","request","error","data","cb","version","head","rest","args","normalizeSetArguments","arguments","sendSetData","path","set","action","ERASE","CREATEANDPATCH","CREATEANDUPDATE","message","topic","parsedData","send","sendMessage","SUBSCRIPTION_FOR_PATTERN_FOUND","SUBSCRIPTION_FOR_PATTERN_REMOVED","LISTEN","UNLISTEN","isWriteAck","originalAction","recieve","READ_RESPONSE","isError","HEAD_RESPONSE","VERSION_EXISTS","SUBSCRIPTION_HAS_PROVIDER","SUBSCRIPTION_HAS_NO_PROVIDER","logger","EVENT","UNSOLICITED_MESSAGE","delete","usages","RecordCore","whenLoaded","_syncDirtyRecords","dirtyRecords","getAll","setDirty","mergeData","remoteVersion","remoteData","bulkSubscribe","subscribe","BulkSubscriptionService","subscriptionInterval","UNSUBSCRIBE_BULK","UNSUBSCRIBE"],"mappings":"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"}