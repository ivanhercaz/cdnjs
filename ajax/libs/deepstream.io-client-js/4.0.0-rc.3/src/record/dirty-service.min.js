"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class DirtyService{constructor(t,e){this.storage=t,this.dirtyStorageName=e,this.dirtyRecords=new Map,this.loadedCallback=[],this.loaded=!1,this.load()}isDirty(t){return this.dirtyRecords.has(t)}setDirty(t,e){e?this.dirtyRecords.set(t,!0):this.dirtyRecords.delete(t),this.storage.set(this.dirtyStorageName,1,[...this.dirtyRecords],()=>{})}whenLoaded(t,e){this.loaded?e.call(t):this.loadedCallback.push({callback:e,context:t})}getAll(){return this.dirtyRecords}load(){this.loaded||this.storage.get(this.dirtyStorageName,(t,e,s)=>{this.dirtyRecords=s?new Map(s):new Map,this.loaded=!0,this.loadedCallback.forEach(({callback:t,context:e})=>t.call(e))})}}exports.DirtyService=DirtyService;