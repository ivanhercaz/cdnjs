var floor=Math.floor,round=Math.round,ceil=Math.ceil;function BWIPJS(t,s){if(this.constructor!==BWIPJS)return new BWIPJS(t,s);this.bmap=null,this.gstk=[],this.cmds=[],this.rgbmap={},this.ncolors=0,this.fontlib=t,this.reset(),this.minx=this.miny=1/0,this.maxx=this.maxy=0,t.monochrome(s)}BWIPJS.prototype.bitmap=function(t){return t&&(this.bmap=t),this.bmap},BWIPJS.prototype.reset=function(){this.g_tdx=0,this.g_tdy=0,this.g_tsx=1,this.g_tsy=1,this.g_posx=0,this.g_posy=0,this.g_penw=1,this.g_path=[],this.g_font=null,this.g_rgb=[0,0,0]},BWIPJS.prototype.save=function(){var t={};for(var s in this)0==s.indexOf("g_")&&(t[s]=h(this[s]));function h(t){if(t instanceof Array){for(var s=[],o=0;o<t.length;o++)s[o]=h(t[o]);return s}if(t instanceof Object){s={};for(var i in t)s[i]=h(t[i]);return s}return t}this.gstk.push(t)},BWIPJS.prototype.restore=function(){if(!this.gstk.length)throw new Error("grestore: stack underflow");var t=this.gstk.pop();for(var s in t)this[s]=t[s];var o=this,i=this.g_rgb[0],h=this.g_rgb[1],r=this.g_rgb[2];this.cmds.push(function(){o.bmap.color(i,h,r)})},BWIPJS.prototype.currpos=function(){return{x:(this.g_posx-this.g_tdx)/this.g_tsx,y:(this.g_posy-this.g_tdy)/this.g_tsy}},BWIPJS.prototype.currfont=function(){return this.g_font},BWIPJS.prototype.findfont=function(t){return{FontName:t}},BWIPJS.prototype.translate=function(t,s){this.g_tdx=this.g_tsx*t,this.g_tdy=this.g_tsy*s},BWIPJS.prototype.scale=function(t,s){this.g_tsx*=t,this.g_tsy*=s},BWIPJS.prototype.setlinewidth=function(t){this.g_penw=t},BWIPJS.prototype.setfont=function(t){this.g_font=t},BWIPJS.prototype.getfont=function(){return this.fontlib.lookup(this.g_font.FontName.toString())},BWIPJS.prototype.setcolor=function(t){if(6==t.length)var s=parseInt(t.substr(0,2),16),o=parseInt(t.substr(2,2),16),i=parseInt(t.substr(4,2),16);else{if(8!=t.length)throw"bwipp.setcolor: invalid string length ("+t+")";var h=parseInt(t.substr(0,2),16)/255,r=parseInt(t.substr(2,2),16)/255,n=parseInt(t.substr(4,2),16)/255,g=parseInt(t.substr(6,2),16)/255;s=round((1-h)*(1-g)*255),o=round((1-r)*(1-g)*255),i=round((1-n)*(1-g)*255)}var p=this;p.cmds.push(function(){p.bmap.color(s,o,i)}),this.g_rgb=[s,o,i]},BWIPJS.prototype.newpath=function(){this.g_path=[]},BWIPJS.prototype.closepath=function(){if(this.g_path.length){var t=this.g_path[0],s=this.g_path[this.g_path.length-1];this.g_path.push([s[0],s[1]]),this.g_path.push(["c"]),this.g_path.push([t[0],t[1]])}},BWIPJS.prototype.moveto=function(t,s){this.g_posx=this.g_tdx+this.g_tsx*t,this.g_posy=this.g_tdy+this.g_tsy*s},BWIPJS.prototype.rmoveto=function(t,s){this.g_posx+=this.g_tsx*t,this.g_posy+=this.g_tsy*s},BWIPJS.prototype.lineto=function(t,s){this.g_path.push([this.g_posx,this.g_posy]),this.g_path.push(["l"]),this.g_posx=this.g_tdx+this.g_tsx*t,this.g_posy=this.g_tdy+this.g_tsy*s,this.g_path.push([this.g_posx,this.g_posy])},BWIPJS.prototype.rlineto=function(t,s){this.g_path.push([this.g_posx,this.g_posy]),this.g_path.push(["l"]),this.g_posx+=this.g_tsx*t,this.g_posy+=this.g_tsy*s,this.g_path.push([this.g_posx,this.g_posy])},BWIPJS.prototype.stringwidth=function(t){for(var s=this.getfont(),o=(+this.g_font.FontSize||10)*this.g_tsx,i="string"==typeof t,h=0,r=0,n=0,g=0;g<t.length;g++){var p=i?t.charCodeAt(g):t[g],e=this.fontlib.getglyph(s,p,o,o);h+=e.advance,r=Math.max(r,e.top),n=Math.max(n,e.height-e.top)}return{w:h/this.g_tsx,h:(r+n)/this.g_tsy,a:r/this.g_tsy,d:n/this.g_tsy}},BWIPJS.prototype.charpath=function(t,s){var o=this.stringwidth(t);this.rlineto(0,o.a),this.rlineto(o.w,0),this.rlineto(0,-o.h)},BWIPJS.prototype.pathbbox=function(){if(!this.g_path.length)throw new Error("pathbbox: --nocurrentpoint--");for(var t=this.g_path,s=t[0][0],o=t[0][1],i=0,h=0,r=2,n=2;r<t.length;r+=n)s>t[r][0]&&(s=t[r][0]),i<t[r][0]&&(i=t[r][0]),o>t[r][1]&&(o=t[r][1]),h<t[r][1]&&(h=t[r][1]),n=2==n?1:2;return{llx:(s-this.g_tdx)/this.g_tsx,lly:(o-this.g_tdy)/this.g_tsy,urx:(i-this.g_tdx)/this.g_tsx,ury:(h-this.g_tdy)/this.g_tsy}},BWIPJS.prototype.stroke=function(){var h=this,r=this.g_penw*this.g_tsx,n=this.g_penw*this.g_tsy,g=this.g_path,p=this.g_path.length/3;"c"==this.g_path[this.g_path.length-2][0]&&p--;var t=this.g_rgb[0]<<16|this.g_rgb[1]<<8|this.g_rgb[2];this.rgbmap[t]||(this.rgbmap[t]=1,this.ncolors+=1);for(var s=0;s<g.length;){var o=g[s++],i=g[s++],e=g[s++];"l"==i[0]&&this.linebbox(o[0],o[1],e[0],e[1],r,n)}this.cmds.push(function(){for(var t=0;t<g.length;){var s=g[t++],o=g[t++],i=g[t++];"l"==o[0]&&h.drawline(!0,s[0],s[1],i[0],i[1],r,n,1<p)}}),this.g_path=[]},BWIPJS.prototype.floorscale=function(){this.g_tsx=floor(this.g_tsx)||1,this.g_tsy=floor(this.g_tsy)||1},BWIPJS.prototype.ceilscale=function(){this.g_tsx=ceil(this.g_tsx)||1,this.g_tsy=ceil(this.g_tsy)||1},BWIPJS.prototype.roundscale=function(){this.g_tsx=round(this.g_tsx)||1,this.g_tsy=round(this.g_tsy)||1},BWIPJS.prototype.imagemask=function(p,e,a){var f,_=floor(this.g_tdx),t=floor(this.g_tdy),l=floor(this.g_tsx/p),y=floor(this.g_tsy/e),u=ceil(p/8),c=t+e*y,x=this;if(!l||!y)throw new Error("Image scaled to zero size.");var s=this.g_rgb[0]<<16|this.g_rgb[1]<<8|this.g_rgb[2];this.rgbmap[s]||(this.rgbmap[s]=1,this.ncolors+=1),this.bbox(_,t,l*p,y*e),this.cmds.push(function(){for(var t=x.minx,s=x.miny,o=0;o<e;o++){f=_,c-=y;for(var i=0;i<p;i++){if(a[o*u+(i>>>3)]&1<<7-(7&i))for(var h=f+l,r=c+y,n=c;n<r;n++)for(var g=f;g<h;g++)x.bmap.set(g-t,n-s,255);f+=l}}})},BWIPJS.prototype.show=function(y,u,c){if(y.length){var x=this,m=x.getfont(),t=+x.g_font.FontSize||10,b=x.g_tsx,s=x.g_tsy,d=floor(x.g_posx),v=floor(x.g_posy),o=x.g_rgb[0],i=x.g_rgb[1],h=x.g_rgb[2],I=floor(t*b),S=(floor(t*s),"string"==typeof y);u=floor(x.g_tsx*u),c=floor(x.g_tsy*c);var r=o<<16|i<<8|h,n=x.rgbmap[r];n?1==n&&(x.ncolors+=255):x.ncolors+=256,x.rgbmap[r]=256;for(var g=floor(x.g_posy)+c,p=0;p<y.length;p++){var e=S?y.charCodeAt(p):y[p],a=x.fontlib.getglyph(m,e,I,I),f=floor(this.g_posx)+a.left;m<=1&&(f-=floor(+b)),x.bbox(f,g+a.top-a.height,a.width,a.height),this.g_posx+=a.advance+u}this.g_posx-=u,this.maxicount=0,x.cmds.push(function(){for(var t=x.minx,s=x.miny,o=0;o<y.length;o++){var i=S?y.charCodeAt(o):y[o],h=x.fontlib.getglyph(m,i,I,I),r=v+h.top+c-1,n=d+h.left;m<=1&&(n-=floor(+b));for(var g=h.width,p=h.height,e=h.bytes,a=h.offset,f=0;f<g;f++)for(var _=0;_<p;_++){var l=e[a+_*g+f];l&&x.bmap.set(n+f-t,r-_-s,l)}d+=h.advance+u}})}},BWIPJS.prototype.drawline=function(t,s,o,i,h,r,n,g){var p=this.minx,e=this.miny;if(!t||s!=i&&o!=h){s=floor(s),i=floor(i),o=floor(o),h=floor(h);var a=Math.abs(i-s),f=Math.abs(h-o),_=i<s?-1:1,l=h<o?-1:1,y=(S=s,I=o,0),u=floor(Math.sqrt(r*r+n*n)),c=round(Math.sqrt(u*u/(f*f/(a*a)+1)))||1,x=round(Math.sqrt(u*u-c*c))||1;if(f<=a){for(;S!=i;){for(var m=0;m<c;m++)this.bmap.set(S-p,I+m-e,255);a<=(y+=f)&&(y-=a,I+=l),S+=_}for(m=0;m<c;m++)this.bmap.set(S-p,I+m-e,255)}else{for(;I!=h;){for(m=0;m<x;m++)this.bmap.set(S+m-p,I-e,255);f<=(y+=a)&&(y-=f,S+=_),I+=l}for(m=0;m<x;m++)this.bmap.set(S+m-p,I-e,255)}}else{var b=round(r),d=round(n);if(h<o){var v=o;o=h,h=v}if(i<s){v=s;s=i,i=v}s==i?(s=floor(s-b/2),i=floor(i+b/2),o=floor(o-(g?d/2:0)),h=floor(h+(g?d/2:0))):(o=floor(o-d/2),h=floor(h+d/2),s=floor(s-(g?b/2:0)),i=floor(i+(g?b/2:0)));for(var I=o;I<h;I++)for(var S=s;S<i;S++)this.bmap.set(S-p,I-e,255)}},BWIPJS.prototype.linebbox=function(t,s,o,i,h,r){if(o<t){var n=t;t=o,o=n}if(i<s){n=s;s=i,i=n}if(h=round(h),r=round(r),t==o){var g=floor(t-h/2),p=floor(t+h/2);this.bbox(floor(g),floor(s),p-g,floor(i-s))}else s==i?this.bbox(t,s-r/2,o-t,r):this.bbox(t,s,o-t,i-s)},BWIPJS.prototype.bbox=function(t,s,o,i){this.minx>t&&(this.minx=t),this.maxx<t+o-1&&(this.maxx=t+o-1),this.miny>s&&(this.miny=s),this.maxy<s+i-1&&(this.maxy=s+i-1)},BWIPJS.prototype.render=function(t){this.minx=floor(this.minx),this.miny=floor(this.miny),this.maxx=floor(this.maxx),this.maxy=floor(this.maxy),this.bmap.imageinfo&&this.bmap.imageinfo(this.maxx-this.minx+1,this.maxy-this.miny+1,this.ncolors);for(var s=0,o=this.cmds.length;s<o;s++)this.cmds[s]();this.bmap.finalize&&this.bmap.finalize(t)},BWIPJS.VERSION="1.7.4 (2019-10-30)","object"==typeof module&&module.exports&&(module.exports=BWIPJS);