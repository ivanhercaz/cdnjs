const defaults={container:window,className:void 0,imageSize:"default",initialZoomState:null,fullScreen:!1,loop:!1,linkImages:!0,duration:300,setIndex:0,firstImage:0,lastImage:!1,currentImage:void 0,initialized:!1,timer:!1,timerDebounce:!1,images:[],enableZoom:!0,imageSource:"href",setTitle:function(){return""},description:function(){return this.settings.images[this.settings.currentImage].title},pagination:function(){var e=this.settings.lastImage+1;return this.settings.currentImage+1+"/"+e},afterInitialize(){},afterMarkup(){},afterImageLoad(){},zoomedPaddingX:function(e,t){return 0},zoomedPaddingY:function(e,t){return 0}};class Chocolat{constructor(e,t){this.settings=t,this.elems={},this.elements=e,this.events=[],this._cssClasses=["chocolat-open","chocolat-in-container","chocolat-cover","chocolat-zoomable","chocolat-zoomed"],this.elements.forEach((e,t)=>{this.settings.images.push({title:e.getAttribute("title"),src:e.getAttribute(this.settings.imageSource),height:!1,width:!1}),this.off(e,"click.chocolat"),this.on(e,"click.chocolat",e=>{this.init(t),e.preventDefault()})})}init(e){return this.settings.initialized||(this.setDomContainer(),this.markup(),this.attachListeners(),this.settings.lastImage=this.settings.images.length-1,this.settings.initialized=!0),this.settings.afterInitialize.call(this),this.load(e)}loadImage(e,t){return"decode"in t?(t.src=e,t.decode()):new Promise(function(s,i){t.onload=s,t.onerror=s,t.src=e})}load(e){if(this.settings.fullScreen&&this.openFullScreen(),this.settings.currentImage===e)return Promise.resolve();setTimeout(()=>{this.elems.overlay.classList.add("chocolat-visible"),this.elems.wrapper.classList.add("chocolat-visible")},0),this.elems.domContainer.classList.add("chocolat-open"),this.settings.timer=setTimeout(()=>{void 0!==this.elems&&this.elems.loader.classList.add("chocolat-visible")},this.settings.duration);const t=new Image;return this.loadImage(this.settings.images[e].src,t).then(()=>{const s=e+1;null!=this.settings.images[s]&&this.loadImage(this.settings.images[s].src,new Image),this.settings.currentImage=e;const i=this.place(t),n=this.appear(e);return Promise.all([i,n])}).then(()=>{this.zoomable(),this.settings.afterImageLoad()})}place(e){this.elems.description.textContent=this.settings.description.call(this),this.elems.pagination.textContent=this.settings.pagination.call(this),this.arrows();const{width:t,height:s,left:i,top:n}=this.fit(e,this.elems.wrapper);return this.center(t,s,i,n)}center(e,t,s,i){return this.transitionAsPromise(()=>{Object.assign(this.elems.content.style,{width:e+"px",height:t+"px",left:s+"px",top:i+"px"})},this.elems.content)}appear(e){return clearTimeout(this.settings.timer),this.elems.loader.classList.contains("chocolat-visible")?this.transitionAsPromise(()=>{this.elems.loader.classList.remove("chocolat-visible")},this.elems.loader).then(()=>this.loadImage(this.settings.images[e].src,this.elems.img)):this.loadImage(this.settings.images[e].src,this.elems.img)}fit(e,t){let s,i;const n=e.naturalHeight,l=e.naturalWidth,o=t.clientHeight,h=t.clientWidth,a=this.getOutMarginH(),c=h-this.getOutMarginW(),r=o-a,m=r/c,g=o/h,d=n/l;return"cover"==this.settings.imageSize?d<g?i=(s=o)/d:s=(i=h)*d:"native"==this.settings.imageSize?(s=n,i=l):(d>m?i=(s=r)/d:s=(i=c)*d,"default"===this.settings.imageSize&&(i>=l||s>=n)&&(i=l,s=n)),{height:s,width:i,top:(o-s)/2,left:(h-i)/2}}change(e){this.zoomOut(0),this.zoomable();var t=this.settings.currentImage+parseInt(e);if(t>this.settings.lastImage){if(this.settings.loop)return this.load(0)}else{if(!(t<0))return this.load(t);if(this.settings.loop)return this.load(this.settings.lastImage)}}arrows(){this.settings.loop?(this.elems.left.classList.add("active"),this.elems.right.classList.add("active")):this.settings.linkImages?(this.settings.currentImage==this.settings.lastImage?this.elems.right.classList.remove("active"):this.elems.right.classList.add("active"),0===this.settings.currentImage?this.elems.left.classList.remove("active"):this.elems.left.classList.add("active")):(this.elems.left.classList.remove("active"),this.elems.right.classList.remove("active"))}close(){if(this.settings.fullscreenOpen)return void this.exitFullScreen();this.settings.currentImage=void 0;const e=this.transitionAsPromise(()=>{this.elems.overlay.classList.remove("chocolat-visible")},this.elems.overlay),t=this.transitionAsPromise(()=>{this.elems.wrapper.classList.remove("chocolat-visible")},this.elems.wrapper);return Promise.all([e,t]).then(()=>{this.elems.domContainer.classList.remove("chocolat-open")})}destroy(){for(var e=this.events.length-1;e>=0;e--){const{element:t,eventName:s}=this.events[e];this.off(t,s)}this.settings.initialized&&(this.settings.fullscreenOpen&&this.exitFullScreen(),this.settings.currentImage=void 0,this.settings.initialized=!1,this.elems.domContainer.classList.remove(...this._cssClasses),this.elems.wrapper.parentNode.removeChild(this.elems.wrapper))}getOutMarginW(){return this.elems.left.offsetWidth+this.elems.right.offsetWidth}getOutMarginH(){return this.elems.top.offsetHeight+this.elems.bottom.offsetHeight}markup(){this.elems.domContainer.classList.add("chocolat-open",this.settings.className),"cover"==this.settings.imageSize&&this.elems.domContainer.classList.add("chocolat-cover"),this.settings.container!==window&&this.elems.domContainer.classList.add("chocolat-in-container"),this.elems.wrapper=document.createElement("div"),this.elems.wrapper.setAttribute("id","chocolat-content-"+this.settings.setIndex),this.elems.wrapper.setAttribute("class","chocolat-wrapper"),this.elems.domContainer.appendChild(this.elems.wrapper),this.elems.overlay=document.createElement("div"),this.elems.overlay.setAttribute("class","chocolat-overlay"),this.elems.wrapper.appendChild(this.elems.overlay),this.elems.loader=document.createElement("div"),this.elems.loader.setAttribute("class","chocolat-loader"),this.elems.wrapper.appendChild(this.elems.loader),this.elems.content=document.createElement("div"),this.elems.content.setAttribute("class","chocolat-content"),this.elems.wrapper.appendChild(this.elems.content),this.elems.img=document.createElement("img"),this.elems.img.setAttribute("class","chocolat-img"),this.elems.content.appendChild(this.elems.img),this.elems.top=document.createElement("div"),this.elems.top.setAttribute("class","chocolat-top"),this.elems.wrapper.appendChild(this.elems.top),this.elems.left=document.createElement("div"),this.elems.left.setAttribute("class","chocolat-left"),this.elems.wrapper.appendChild(this.elems.left),this.elems.right=document.createElement("div"),this.elems.right.setAttribute("class","chocolat-right"),this.elems.wrapper.appendChild(this.elems.right),this.elems.bottom=document.createElement("div"),this.elems.bottom.setAttribute("class","chocolat-bottom"),this.elems.wrapper.appendChild(this.elems.bottom),this.elems.close=document.createElement("span"),this.elems.close.setAttribute("class","chocolat-close"),this.elems.top.appendChild(this.elems.close),this.elems.fullscreen=document.createElement("span"),this.elems.fullscreen.setAttribute("class","chocolat-fullscreen"),this.elems.bottom.appendChild(this.elems.fullscreen),this.elems.description=document.createElement("span"),this.elems.description.setAttribute("class","chocolat-description"),this.elems.bottom.appendChild(this.elems.description),this.elems.pagination=document.createElement("span"),this.elems.pagination.setAttribute("class","chocolat-pagination"),this.elems.bottom.appendChild(this.elems.pagination),this.elems.setTitle=document.createElement("span"),this.elems.setTitle.setAttribute("class","chocolat-set-title"),this.elems.setTitle.textContent=this.settings.setTitle(),this.elems.bottom.appendChild(this.elems.setTitle),this.settings.afterMarkup.call(this)}openFullScreen(){var e=this.elems.wrapper;e.requestFullscreen?(this.settings.fullscreenOpen=!0,e.requestFullscreen()):e.mozRequestFullScreen?(this.settings.fullscreenOpen=!0,e.mozRequestFullScreen()):e.webkitRequestFullscreen?(this.settings.fullscreenOpen=!0,e.webkitRequestFullscreen()):e.msRequestFullscreen?(e.msRequestFullscreen(),this.settings.fullscreenOpen=!0):this.settings.fullscreenOpen=!1}exitFullScreen(){document.exitFullscreen?(document.exitFullscreen(),this.settings.fullscreenOpen=!1):document.mozCancelFullScreen?(document.mozCancelFullScreen(),this.settings.fullscreenOpen=!1):document.webkitExitFullscreen?(document.webkitExitFullscreen(),this.settings.fullscreenOpen=!1):document.msExitFullscreen?(document.msExitFullscreen(),this.settings.fullscreenOpen=!1):this.settings.fullscreenOpen=!0}attachListeners(){this.off(document,"keydown.chocolat"),this.on(document,"keydown.chocolat",e=>{this.settings.initialized&&(37==e.keyCode?this.change(-1):39==e.keyCode?this.change(1):27==e.keyCode&&this.close())});const e=this.elems.wrapper.querySelector(".chocolat-right");this.off(e,"click.chocolat"),this.on(e,"click.chocolat",()=>{this.change(1)});const t=this.elems.wrapper.querySelector(".chocolat-left");this.off(t,"click.chocolat"),this.on(t,"click.chocolat",()=>{this.change(-1)}),this.off(this.elems.close,"click.chocolat"),this.on(this.elems.close,"click.chocolat",()=>{this.close()}),this.off(this.elems.fullscreen,"click.chocolat"),this.on(this.elems.fullscreen,"click.chocolat",()=>{this.settings.fullscreenOpen?this.exitFullScreen():this.openFullScreen()}),this.settings.backgroundClose&&(this.off(this.elems.overlay,"click.chocolat"),this.on(this.elems.overlay,"click.chocolat",e=>{this.close()})),this.off(this.elems.wrapper,"click.chocolat"),this.on(this.elems.wrapper,"click.chocolat",e=>{this.zoomOut(e)});const s=this.elems.wrapper.querySelector(".chocolat-img");this.off(s,"click.chocolat"),this.on(s,"click.chocolat",e=>{null===this.settings.initialZoomState&&this.elems.domContainer.classList.contains("chocolat-zoomable")&&(e.stopPropagation(),this.zoomIn(e))}),this.on(this.elems.wrapper,"mousemove.chocolat",e=>{if(null===this.settings.initialZoomState)return;if(void 0===this.settings.currentImage)return;const t=this.elems.wrapper.getBoundingClientRect(),s=t.top+window.scrollY,i=t.left+window.scrollX;var n=this.elems.wrapper.clientHeight,l=this.elems.wrapper.clientWidth,o=(this.settings.images[this.settings.currentImage],this.elems.img.width),h=this.elems.img.height,a=[e.pageX-l/2-i,e.pageY-n/2-s],c=0;if(o>l){var r=this.settings.zoomedPaddingX(o,l);c=a[0]/(l/2),c*=(o-l)/2+r}var m=0;if(h>n){var g=this.settings.zoomedPaddingY(h,n);m=a[1]/(n/2),m*=(h-n)/2+g}this.elems.img.style.marginLeft=-c+"px",this.elems.img.style.marginTop=-m+"px"}),this.on(window,"resize.chocolat",e=>{this.settings.initialized&&void 0!==this.settings.currentImage&&this.debounce(50,()=>{const{width:e,height:t,left:s,top:i}=this.fit(this.elems.img,this.elems.wrapper);this.center(e,t,s,i,0),this.zoomable()})})}zoomable(){this.settings.images[this.settings.currentImage];var e=this.elems.wrapper.clientWidth,t=this.elems.wrapper.clientHeight,s=!(!this.settings.enableZoom||!(this.elems.img.naturalWidth>e||this.elems.img.naturalHeight>t)),i=this.elems.img.clientWidth>this.elems.img.naturalWidth||this.elems.img.clientHeight>this.elems.img.naturalHeight;s&&!i?this.elems.domContainer.classList.add("chocolat-zoomable"):this.elems.domContainer.classList.remove("chocolat-zoomable")}zoomIn(e){this.settings.initialZoomState=this.settings.imageSize,this.settings.imageSize="native",this.elems.domContainer.classList.add("chocolat-zoomed");const{width:t,height:s,left:i,top:n}=this.fit(this.elems.img,this.elems.wrapper);return this.center(t,s,i,n,this.settings.duration)}zoomOut(e,t){if(null===this.settings.initialZoomState||void 0===this.settings.currentImage)return;t=t||this.settings.duration,this.settings.imageSize=this.settings.initialZoomState,this.settings.initialZoomState=null,this.elems.img.style.margin=0,this.elems.domContainer.classList.remove("chocolat-zoomed");const{width:s,height:i,left:n,top:l}=this.fit(this.elems.img,this.elems.wrapper);return this.center(s,i,n,l,t)}setDomContainer(){this.settings.container===window?this.elems.domContainer=document.body:this.elems.domContainer=this.settings.container}debounce(e,t){clearTimeout(this.settings.timerDebounce),this.settings.timerDebounce=setTimeout(function(){t()},e)}on(e,t,s){const i=this.events.push({element:e,eventName:t,cb:s});return e.addEventListener(t.split(".")[0],this.events[i-1].cb),this}off(e,t){const s=this.events.findIndex(s=>s.element===e&&s.eventName===t);return this.events[s]&&(e.removeEventListener(t.split(".")[0],this.events[s].cb),this.events.splice(s,1)),this}transitionAsPromise(e,t){return new Promise(s=>{const i=()=>{t.removeEventListener("transitionend",i),s()};t.addEventListener("transitionend",i);const n=t.getAttribute("class"),l=t.getAttribute("style");e(),n===t.getAttribute("class")&&l===t.getAttribute("style")&&i()})}api(){return{open:e=>(e=parseInt(e)||0,this.init(e)),close:()=>this.close(),next:()=>this.change(1),prev:()=>this.change(-1),goto:e=>this.open(e),current:()=>this.settings.currentImage,place:()=>this.place(this.elems.img,this.settings.duration),destroy:()=>this.destroy(),set:(e,t)=>(this.settings[e]=t,t),get:e=>this.settings[e],getElem:e=>this.elems[e]}}}const instances=[];function main_esm(e){const t=Object.assign({},defaults,{images:[]},e,{setIndex:instances.length}),s=new Chocolat(elements,t);return instances.push(s),s}export default main_esm;