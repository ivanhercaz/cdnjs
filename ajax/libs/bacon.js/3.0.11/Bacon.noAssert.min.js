!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).Bacon={})}(this,function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function a(){}var h=Array.isArray||function(t){return t instanceof Array};function f(t){return t&&t._isObservable}function y(t,n){for(var r=0;r<t.length;r++)if(!n(t[r]))return!1;return!0}function i(t,n){for(var r=0;r<t.length;r++)if(n(t[r]))return!0;return!1}function u(t,n){return-1!==w(t,n)}function b(t,n){for(var r,e=[],i=0;i<n.length;i++)t(r=n[i])&&e.push(r);return e}function o(r){return function(t,n){return r(n,t)}}function s(t,n,r){for(var e=0;e<t.length;e++)n=r(n,t[e]);return n}function c(t){return t[0]}var w=Array.prototype.indexOf?function(t,n){return t.indexOf(n)}:function(t,n){for(var r=0;r<t.length;r++)if(n===t[r])return r;return-1};function p(t){return"function"==typeof t}function g(t,n){for(var r,e=[],i=0;i<n.length;i++)r=n[i],e.push(t(r));return e}function l(t){return t.slice(1,t.length)}function v(t){return h(t)?t:[t]}function d(n){return"function"==typeof n?n:function(t){return n}}var m={indexOf:w,indexWhere:function(t,n){for(var r=0;r<t.length;r++)if(n(t[r]))return r;return-1},head:c,always:function(t){return function(){return t}},negate:function(n){return function(t){return!n(t)}},empty:function(t){return 0===t.length},tail:l,filter:b,map:g,each:function(t,n){for(var r in t){if(Object.prototype.hasOwnProperty.call(t,r))n(r,t[r])}},toArray:v,contains:u,id:function(t){return t},last:function(t){return t[t.length-1]},all:y,any:i,without:function(n,t){return b(function(t){return t!==n},t)},remove:function(t,n){var r=w(n,t);if(0<=r)return n.splice(r,1)},fold:s,flatMap:function(r,t){return s(t,[],function(t,n){return t.concat(r(n))})},bind:function(t,n){return function(){return t.apply(n,arguments)}},isFunction:p,toFunction:d,toString:function t(n){var r={}.hasOwnProperty;try{if(E++,null==n)return"undefined";if(p(n))return"function";if(h(n))return 5<E?"[..]":"["+g(t,n).toString()+"]";if(null!=(null!=n?n.toString:void 0)&&n.toString!==Object.prototype.toString)return n.toString();if("object"!=typeof n)return n;if(5<E)return"{..}";var e=[];for(var i in n)if(r.call(n,i)){var u=function(){try{return n[i]}catch(t){return t}}();e.push(t(i)+":"+t(u))}return"{"+e+"}"}finally{E--}}},E=0,S=void 0,D="<no-more>",I={scheduler:{setTimeout:function(t,n){return setTimeout(t,n)},setInterval:function(t,n){return setInterval(t,n)},clearInterval:function(t){return clearInterval(t)},clearTimeout:function(t){return clearTimeout(t)},now:function(){return(new Date).getTime()}}};var A=void 0,k=[],_={},B=[],x=0,M={},W=!1;function O(t){t<=x||(B[t-1]||(B[t-1]=[[],0]),x=t)}function P(t,n){if(!A&&!W)return n();O(1);for(var r=0;r<x-1&&!T(t,B[r][0]);)r++;B[r][0].push([t,n]),A||N()}function T(t,n){for(var r=0;r<n.length;r++)if(n[r][0].id==t.id)return!0;return!1}function N(){var t=x;if(t){var n=!W;W=!0;try{for(;t<=x;){var r=B[x-1];if(!r)throw new Error("Unexpected stack top: "+r);var e=r[0],i=r[1];if(!(i<e.length)){r[0]=[],r[1]=0;break}var u=e[i][1];r[1]++,O(x+1);var o=!1;try{for(u(),o=!0;t<x&&0==B[x-1][0].length;)x--}finally{o||(B=[],x=0)}}}finally{n&&(W=!1)}}}function r(t,n){if(A){var r=_[t.id];return void 0===r?(r=_[t.id]=[n],k.push(t)):r.push(n)}return n()}function C(t,n){var r=k[t],e=r.id,i=_[e];k.splice(t,1),delete _[e],n&&0<k.length&&function t(n){if(M[n.id])return;var r=n.internalDeps();for(var e,i=0;i<r.length;i++)if(e=r[i],t(e),_[e.id]){var u=m.indexOf(k,e);C(u,!1)}M[n.id]=!0}(r);for(var u=0;u<i.length;u++)(0,i[u])()}var F={toString:function(){return m.toString({rootEvent:A,processingAfters:W,waiterObs:k,waiters:_,aftersStack:B,aftersStackHeight:x,flushed:M})},whenDoneWith:r,hasWaiters:function(){return 0<k.length},inTransaction:function(t,n,r,e){if(A)return r.apply(n,e);A=t;try{var i=r.apply(n,e);!function(){for(;0<k.length;)C(0,!0);M={}}()}finally{A=void 0,N()}return i},currentEventId:function(){return A?A.id:void 0},wrappedSubscribe:function(n,t,r){function e(){i=!0,o()}var i=!1,u=!1,o=function(){u=!0};return o=t(function(t){return P(n,function(){i||r(t)===D&&e()}),S}),u&&o(),e},afterTransaction:P,soonButNotYet:function(t,n){A?r(t,n):I.scheduler.setTimeout(n,0)},isInTransaction:function(){return void 0!==A}},V=(L.prototype.deps=function(){return this.cachedDeps||(this.cachedDeps=j([this.context].concat(this.args))),this.cachedDeps},L.prototype.toString=function(){var t=m.map(m.toString,this.args);return m.toString(this.context)+"."+m.toString(this.method)+"("+t+")"},L);function L(t,n,r){void 0===r&&(r=[]),this._isDesc=!0,this.context=t,this.method=n,this.args=r}function q(t,n){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];var i=t||n;return i&&i._isDesc?t||n:new V(t,n,r)}function j(t){return h(t)?m.flatMap(j,t):f(t)?[t]:(null!=t?t._isSource:void 0)?[t.obs]:[]}function U(){return S}function Q(){return S}function z(t,n,r){return r.transform(function(t,s){var c=t;return function(t,n){var r=s(c,t),e=r[0],i=r[1];c=e;for(var u=S,o=0;o<i.length;o++){if((u=n(i[o]))===D)return u}return u}}(t,n),new V(r,"withStateMachine",[t,n]))}var H=(R.prototype.getOrElse=function(t){return this.value},R.prototype.get=function(){return this.value},R.prototype.filter=function(t){return t(this.value)?new R(this.value):Y},R.prototype.map=function(t){return new R(t(this.value))},R.prototype.forEach=function(t){t(this.value)},R.prototype.toArray=function(){return[this.value]},R.prototype.inspect=function(){return"Some("+this.value+")"},R.prototype.toString=function(){return this.inspect()},R);function R(t){this._isSome=!0,this.isDefined=!0,this.value=t}var Y={_isNone:!0,getOrElse:function(t){return t},get:function(){throw new Error("None.get()")},filter:function(){return Y},map:function(){return Y},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};function X(){return Y}var $=0,G=(J.prototype.filter=function(t){return!0},J.prototype.inspect=function(){return this.toString()},J.prototype.log=function(){return this.toString()},J.prototype.toNext=function(){return this},J);function J(){this.id=++$,this.isEvent=!0,this._isEvent=!0,this.isEnd=!1,this.isInitial=!1,this.isNext=!1,this.isError=!1,this.hasValue=!1}var K,Z=(n(tt,K=G),tt.prototype.fmap=function(t){return this.apply(t(this.value))},tt.prototype.filter=function(t){return t(this.value)},tt.prototype.toString=function(){return m.toString(this.value)},tt.prototype.log=function(){return this.value},tt);function tt(t){var n=K.call(this)||this;if(n.hasValue=!0,t instanceof G)throw new vt("Wrapping an event inside other event");return n.value=t,n}var nt,rt=(n(et,nt=Z),et.prototype.apply=function(t){return new et(t)},et);function et(t){var n=nt.call(this,t)||this;return n.isNext=!0,n._isNext=!0,n}var it,ut=(n(ot,it=Z),ot.prototype.apply=function(t){return new ot(t)},ot.prototype.toNext=function(){return new rt(this.value)},ot);function ot(t){var n=it.call(this,t)||this;return n.isInitial=!0,n._isInitial=!0,n}var st,ct=(n(ft,st=G),ft.prototype.fmap=function(t){return this},ft);function ft(){var t=null!==st&&st.apply(this,arguments)||this;return t.hasValue=!1,t}var at,ht=(n(pt,at=ct),pt.prototype.toString=function(){return"<end>"},pt);function pt(){var t=null!==at&&at.apply(this,arguments)||this;return t.isEnd=!0,t}var lt,vt=(n(dt,lt=ct),dt.prototype.toString=function(){return"<error> "+m.toString(this.error)},dt);function dt(t){var n=lt.call(this)||this;return n.isError=!0,n.error=t,n}function yt(t){return new ut(t)}function bt(t){return new rt(t)}function wt(){return new ht}function gt(t){return t&&t._isEvent?t:bt(t)}function mt(t){return t&&t._isEvent}function Et(t){return t.isError}function St(t){return t.hasValue}function Dt(t){return t.isEnd}function It(t,n){return t===n}function At(t,r){void 0===r&&(r=It);var n=new V(t,"skipDuplicates",[]);return z(X(),function(t,n){return St(n)?n.isInitial||function(t){return null!=t&&t._isNone}(t)||!r(t.get(),n.value)?[new H(n.value),[n]]:[t,[]]:[t,[n]]},t).withDesc(n)}function kt(t,n,r){return n.transform(_t(t),r||new V(n,"take",[t]))}function _t(r){return function(t,n){return t.hasValue?0<--r?n(t):(0===r&&n(t),n(wt()),D):n(t)}}function Bt(n,t,o){var s,c=t,f=!1;return s=new sr(new V(n,"scan",[t,o]),function(r){function e(){return i||(i=f=!0,(u=r(new ut(c)))===D&&(t(),t=a)),u}var i=!1,t=a,u=S;return t=n.subscribeInternal(function(t){if(St(t)){if(f&&t.isInitial)return S;t.isInitial||e(),i=f=!0;var n=o(c,t.value);return c=n,r(t.apply(n))}return t.isEnd&&(u=e()),u!==D?r(t):u}),F.whenDoneWith(s,e),t})}var xt=(Mt.prototype.add=function(t){var n=this;if(!this.unsubscribed){var r=!1,e=a;this.starting.push(t),e=t(this.unsubscribe,function(){n.unsubscribed||(r=!0,n.remove(e),m.remove(t,n.starting))}),this.unsubscribed||r?e():this.subscriptions.push(e),m.remove(t,this.starting)}},Mt.prototype.remove=function(t){if(!this.unsubscribed)return void 0!==m.remove(t,this.subscriptions)?t():void 0},Mt.prototype.unsubscribe=function(){if(!this.unsubscribed){this.unsubscribed=!0;for(var t=this.subscriptions,n=0;n<t.length;n++)t[n]();this.subscriptions=[],this.starting=[]}},Mt.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},Mt.prototype.empty=function(){return 0===this.count()},Mt);function Mt(t){void 0===t&&(t=[]),this.unsubscribed=!1,this.unsubscribe=m.bind(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[];for(var n,r=0;r<t.length;r++)n=t[r],this.add(n)}function Wt(s,t){return function(n){function r(){if(!e)return s.forEach(function(t){if(e=!0,(o=n(new ut(t)))===D)return u(),u=a})}var e=!1,i=!1,u=a,o=S;return u=t(function(t){return t instanceof Z?t.isInitial&&!i?(s=new H(t.value),S):(t.isInitial||r(),e=!0,s=new H(t.value),n(t)):(t.isEnd&&(o=r()),o!==D?n(t):o)}),i=!0,r(),u}}function Ot(t,n){return new sr(t,Wt(X(),n))}function Pt(n){var r=new pr(new V("Bacon","once",[n]),function(t){return F.soonButNotYet(r,function(){t(gt(n)),t(wt())}),a});return r}function Tt(n,t,e){void 0===e&&(e={});var i=t,r=[i],f=[],a=t._isProperty,h=!1,u=(a?Ot:dr)(e.desc||new V(t,"flatMap_",[n]),function(u){var r=new xt,o=[];function s(t){if(a&&t.isInitial){if(h)return S;h=!0}var i=Ct(n(t));return f.push(i),r.add(function(r,e){return i.subscribeInternal(function(t){if(t.isEnd)return m.remove(i,f),function(){var t=o.shift();t&&s(t)}(),c(e),D;t=t.toNext();var n=u(t);return n===D&&r(),n})})}function c(t){return t(),r.empty()?u(wt()):S}return r.add(function(t,n){return i.subscribeInternal(function(t){return t.isEnd?c(n):t.isError&&!e.mapError?u(t):e.firstOnly&&1<r.count()?S:r.unsubscribed?D:(e.limit&&r.count()>e.limit?o.push(t):s(t),S)})}),r.unsubscribe});return u.internalDeps=function(){return f.length?r.concat(f):r},u}function Nt(n){return"function"==typeof n?function(t){return St(t)?n(t.value):t}:function(t){return n}}function Ct(t){return f(t)?t:Pt(t)}function Ft(t,n){return Tt(n,t,{mapError:!0,desc:new V(t,"flatMapEvent",[n])})}var Vt=(Lt.prototype.subscribe=function(t){return this.obs.subscribeInternal(t)},Lt.prototype.toString=function(){return this.obs.toString()},Lt.prototype.markEnded=function(){this.ended=!0},Lt.prototype.mayHave=function(t){return!0},Lt);function Lt(t,n){this._isSource=!0,this.flatten=!0,this.ended=!1,this.obs=t,this.sync=n}var qt,jt=(n(Ut,qt=Vt),Ut.prototype.consume=function(){return this.value},Ut.prototype.push=function(t){this.value=t},Ut.prototype.hasAtLeast=function(t){return!!this.value},Ut);function Ut(){return null!==qt&&qt.apply(this,arguments)||this}var Qt,zt=(n(Ht,Qt=Vt),Ht.prototype.consume=function(){return this.queue.shift()},Ht.prototype.push=function(t){this.queue.push(t)},Ht.prototype.mayHave=function(t){return!this.ended||this.queue.length>=t},Ht.prototype.hasAtLeast=function(t){return this.queue.length>=t},Ht);function Ht(t,n){var r=Qt.call(this,t,n)||this;return r.flatten=!1,r.queue=[],r}var Rt,Yt=(n(Xt,Rt=Vt),Xt.prototype.consume=function(){var t=this.queue;return this.queue=[],{value:t}},Xt.prototype.push=function(t){return this.queue.push(t.value)},Xt.prototype.hasAtLeast=function(t){return!0},Xt);function Xt(t){var n=Rt.call(this,t,!0)||this;return n.queue=[],n}function $t(t){return null!=t&&t._isSource?t:null!=t&&t._isProperty?new jt(t,!1):new zt(t,!0)}function Gt(){return new pr(q("Bacon","never"),function(t){return t(wt()),a})}function Jt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Zt(vr,t)}function Kt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Zt(Ot,t)}function Zt(t,n){if(0===n.length)return Gt();var r=function(t){for(var n=[],r=[],e=0;e<t.length;e++){for(var i,u=t[e],o=u[0],s={f:u[1],ixs:[]},c=!1,f=0;f<o.length;f++){i=o[f];var a=w(n,i);c=c||null!=(l=i)&&(l._isSource?l.sync:l._isEventStream),a<0&&(n.push(i),a=n.length-1);for(var h=0;h<s.ixs.length;h++){var p=s.ixs[h];p.index===a&&p.count++}s.ixs.push({index:a,count:1})}if(0<o.length&&!c)throw new Error("At least one EventStream required, none found in "+o);0<o.length&&r.push(s)}var l;return[g($t,n),r]}(nn(n)),l=r[0],v=r[1];if(!l.length)return Gt();var c=i(l,function(t){return t.flatten})&&function(t,e){void 0===e&&(e=[]);return i(t,function t(n){if(u(e,n))return!0;var r=n.internalDeps();return r.length?(e.push(n),i(r,t)):(e.push(n),!1)})}(g(function(t){return t.obs},l)),d=t(new V("Bacon","when",Array.prototype.slice.call(n)),function(f){var a=[],s=!1;function h(t){for(var n=0;n<t.ixs.length;n++){var r=t.ixs[n];if(!l[r.index].hasAtLeast(r.count))return!1}return!0}function n(t){for(var n=0;n<t.ixs.length;n++){var r=t.ixs[n];if(!l[r.index].mayHave(r.count))return!0}return!1}function p(t){return!t.source.flatten}return new xt(g(function(o){return function(e){function i(){return F.whenDoneWith(d,u)}function u(){var t=function t(){var n;if(void 0!==(n=a.pop()))for(var r,e=S,i=0;i<v.length;i++)if(h(r=v[i])){for(var u=[],o=0;o<r.ixs.length;o++){var s=l[r.ixs[o].index].consume();if(!s)throw new Error("Event was undefined");u.push(s.value)}var c=r.f.apply(null,u);return e=f(n.e.apply(c)),a.length&&(a=b(p,a)),e===D?e:t()}return S}();s&&(y(l,rn)||y(v,n))&&(t=D,f(wt())),t===D&&e()}return o.subscribe(function(t){var n=S;if(t.isEnd)s=!0,o.markEnded(),i();else if(t.isError)n=f(t);else{var r=t;o.push(r),o.sync&&(a.push({source:o,e:r}),c||F.hasWaiters()?i():u())}return n===D&&e(),n})}},l)).unsubscribe});return d}function tn(t){for(var n=0,r=t.length,e=[];n<r;){var i=v(t[n++]),u=d(t[n++]);e.push([i,u])}return e}function nn(t){for(var n,r=[],e=0;e<t.length;e++){var i=t[e];if(!((n=i)instanceof Array)||f(n[n.length-1]))return tn(t);if(i[0]instanceof Array)r.push([i[0],d(i[1])]);else{var u=i.slice(0,i.length-1),o=d(i[i.length-1]);r.push([u,o])}}return r}function rn(t){return!t.sync||t.ended}function en(t,n,r){return Jt([new jt(n.toProperty(),!1),new jt(t,!0),o(r)]).withDesc(new V(t,"withLatestFrom",[n,r]))}function un(t,n,r){return Kt([new jt(n.toProperty(),!1),new jt(t,!0),o(r)]).withDesc(new V(t,"withLatestFrom",[n,r]))}function on(t,n,r){if(t instanceof sr)return un(t,n,r);if(t instanceof pr)return en(t,n,r);throw new Error("Unknown observable: "+t)}function sn(t,n){return n instanceof sr?on(t,n,function(t,n){return n}):t.transform(cn(n),new V(t,"map",[n]))}function cn(t){var r=m.toFunction(t);return function(t,n){return n(t.fmap(r))}}function fn(n){return new sr(new V("Bacon","constant",[n]),function(t){return t(yt(n)),t(wt()),a})}function an(t){return t=Array.prototype.slice.call(t),m.flatMap(hn,t)}function hn(t){return f(t)?[t]:h(t)?an(t):[fn(t)]}function pn(t){return m.isFunction(t[0])?[an(Array.prototype.slice.call(t,1)),t[0]]:[an(Array.prototype.slice.call(t,0,t.length-1)),m.last(t)]}function ln(t,r){return Zt(function(t,n){return new pr(t,n,void 0,r)},[m.map(function(t){return new Yt(t)},t),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t}]).withDesc(new V("Bacon","groupSimultaneous",t))}function vn(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if((t=an(t)).length){for(var r=[],e=0;e<t.length;e++){var i=f(t[e])?t[e]:fn(t[e]);r.push(yn(i))}return Kt([r,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t}]).withDesc(new V("Bacon","combineAsArray",t))}return fn([])}function dn(t,n,r){return Kt([[yn(t),yn(n)],r]).withDesc(new V(t,"combine",[n,r]))}function yn(t){return new jt(t,!0)}function bn(t,n){return Tt(Nt(n),t,{desc:new V(t,"flatMapConcat",[n]),limit:1})}function wn(e,f){void 0===f&&(f=m.id);var t=new V("Bacon","fromBinder",[e,f]);return new pr(t,function(s){function c(){if(!t)return null!=r?(r(),t=!0):n=!0}var t=!1,n=!1,r=e(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=f.apply(void 0,t),e=h(r)&&mt(m.last(r))?r:[r],i=S,u=0;u<e.length;u++){var o=gt(e[u]);if((i=s(o))===D||o.isEnd)return c(),i}return i});return n&&c(),c})}function gn(r,t){var n=new V("Bacon","fromPoll",[r,t]);return wn(function(t){var n=I.scheduler.setInterval(t,r);return function(){return I.scheduler.clearInterval(n)}},t).withDesc(n)}function mn(t,n){return gn(t,function(){return bt(n)}).withDesc(new V("Bacon","interval",[t,n]))}function En(t,n,r){return t instanceof pr?function(t,n,r){return Sn(t.toProperty(),n,r).withDesc(new V(t,"sampledBy",[n]))}(t,n,r):Sn(t,n,r)}function Sn(t,n,r){return on(n,t,o(function(t){return"function"==typeof t?t:m.id}(r))).withDesc(new V(t,"sampledBy",[n]))}function Dn(t,r,n){return new sr(new V(t,"transform",[r]),function(n){return t.subscribeInternal(function(t){return r(t,n)})}).withDesc(n)}function In(r,n){function e(t){return n(t,i)}var i;return function(t,n){return i=n,r(t,e)}}function An(t,n,r,e){return n instanceof sr?on(t,n,function(t,n){return[t,n]}).transform(In(r(function(t){return t[1]}),cn(function(t){return t[0]})),e):t.transform(r(function(t){if("boolean"==typeof t)return m.always(t);if("function"!=typeof t)throw new Error("Not a function: "+t);return t}(n)),e)}function kn(r){return function(t,n){return t.filter(r)?n(t):S}}function _n(t){return t.map(function(t){return!t}).withDesc(new V(t,"not",[]))}function Bn(t){return fr(t)?t:fn(t)}function xn(t,n){return Tt(Nt(n),t,{firstOnly:!0,desc:new V(t,"flatMapFirst",[n])})}function Mn(e,t){var i=new pr(q(e,"justInitValue"),function(t){var n,r=e.dispatcher.subscribe(function(t){return t.isEnd||(n=t),D});return F.whenDoneWith(i,function(){return null!=n&&t(n),t(wt())}),r},void 0,hr);return i.concat(t,hr).toProperty()}function Wn(t,n,r){return t.scan(n,r).last().withDesc(new V(t,"fold",[n,r]))}var On={};function Pn(t,n){return Tt(Nt(n),t,{desc:new V(t,"flatMap",[n])})}function Tn(t,r){return Tt(function(t){if(t instanceof vt){var n=t.error;return r(n)}return t},t,{mapError:!0,desc:new V(t,"flatMapError",[r])})}var Nn=[],Cn=!1;function Fn(n){if(Nn.length&&!Cn)try{Cn=!0,Nn.forEach(function(t){t(n)})}finally{Cn=!1}}function Vn(t,n){var r=m.toFunction(n),e=fr(t)?t.toEventStream(hr):t,i=Pn(e,function(t){return Ct(r(t)).takeUntil(e)});return fr(t)&&(i=i.toProperty()),i.withDesc(new V(t,"flatMapLatest",[r]))}var Ln=(qn.prototype.hasSubscribers=function(){return 0<this.subscriptions.length},qn.prototype.removeSub=function(t){return this.subscriptions=m.without(t,this.subscriptions),this.subscriptions},qn.prototype.push=function(t){return t.isEnd&&(this.ended=!0),F.inTransaction(t,this,this.pushIt,[t])},qn.prototype.pushToSubscriptions=function(t){try{for(var n=this.subscriptions,r=n.length,e=0;e<r;e++){var i=n[e];i.sink(t)!==D&&!t.isEnd||this.removeSub(i)}return!0}catch(t){throw this.pushing=!1,this.queue=[],t}},qn.prototype.pushIt=function(t){if(this.pushing)return this.queue.push(t),S;if(t!==this.prevError){for(t.isError&&(this.prevError=t),this.pushing=!0,this.pushToSubscriptions(t),this.pushing=!1;;){var n=this.queue.shift();if(!n)break;this.push(n)}return this.hasSubscribers()?S:(this.unsubscribeFromSource(),D)}},qn.prototype.handleEvent=function(t){return this._handleEvent?this._handleEvent(t):this.push(t)},qn.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc(),this.unsubSrc=void 0},qn.prototype.subscribe=function(t){var n=this;if(this.ended)return t(wt()),a;var r={sink:t};return this.subscriptions.push(r),1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent)),function(){if(n.removeSub(r),!n.hasSubscribers())return n.unsubscribeFromSource()}},qn.prototype.inspect=function(){return this.observable.toString()},qn);function qn(t,n,r){this.pushing=!1,this.ended=!1,this.prevError=void 0,this.unsubSrc=void 0,this._subscribe=n,this._handleEvent=r,this.subscribe=m.bind(this.subscribe,this),this.handleEvent=m.bind(this.handleEvent,this),this.subscriptions=[],this.observable=t,this.queue=[]}var jn,Un=(n(Qn,jn=Ln),Qn.prototype.push=function(t){return t.isEnd&&(this.propertyEnded=!0),t instanceof Z?(this.current=new H(t),this.currentValueRootId=F.currentEventId()):t.hasValue&&console.error("Unknown event, two Bacons loaded?",t.constructor),jn.prototype.push.call(this,t)},Qn.prototype.maybeSubSource=function(t,n){return n===D?a:this.propertyEnded?(t(wt()),a):jn.prototype.subscribe.call(this,t)},Qn.prototype.subscribe=function(t){var n=this,r=S;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var e=F.currentEventId(),i=this.currentValueRootId;return!this.propertyEnded&&i&&e&&e!==i?F.whenDoneWith(this.observable,function(){if(n.currentValueRootId===i)return t(yt(n.current.get().value))}):F.inTransaction(void 0,this,function(){return r=t(yt(n.current.get().value))},[]),this.maybeSubSource(t,r)}return this.maybeSubSource(t,r)},Qn.prototype.inspect=function(){return this.observable+" current= "+this.current},Qn);function Qn(t,n,r){var e=jn.call(this,t,n,r)||this;return e.current=X(),e.propertyEnded=!1,e.subscribe=m.bind(e.subscribe,e),e}function zn(t,n,r){return Tt(Nt(r),t,{desc:new V(t,"flatMapWithConcurrencyLimit",[n,r]),limit:n})}function Hn(t,n,r){var e=function(t){if(void 0===t)return;if("number"!=typeof t)return t;var n=t;return function(t){return I.scheduler.setTimeout(t,n)}}(n);function i(t){return t.values.length===r?t.flush():void 0!==e?t.schedule(e):void 0}var u=new V(t,"bufferWithTimeOrCount",[n,r]);return function(t,r,n){void 0===r&&(r=a);void 0===n&&(n=a);var e=S,i=new Rn(n,r);return t.transform(function(t,n){return i.push=n,St(t)?(i.values.push(t.value),r(i)):Et(t)?e=n(t):Dt(t)&&(i.end=t,i.scheduled||i.flush()),e}).withDesc(new V(t,"buffer",[]))}(t,i,i).withDesc(u)}var Rn=(Yn.prototype.flush=function(){if(this.scheduled&&(I.scheduler.clearTimeout(this.scheduled),this.scheduled=null),0<this.values.length){var t=this.values;this.values=[];var n=this.push(bt(t));if(null!=this.end)return this.push(this.end);if(n!==D)return this.onFlush(this)}else if(null!=this.end)return this.push(this.end)},Yn.prototype.schedule=function(t){var n=this;if(!this.scheduled)return this.scheduled=t(function(){return n.flush()})},Yn);function Yn(t,n){this.push=function(t){return S},this.scheduled=null,this.end=void 0,this.values=[],this.onFlush=t,this.onInput=n}function Xn(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var u=an(t);return u.length?new pr(new V("Bacon","mergeAll",u),function(e){var i=0,t=g(function(t){return function(r){return t.subscribeInternal(function(t){if(t.isEnd)return++i===u.length?e(wt()):S;t=t.toNext();var n=e(t);return n===D&&r(),n})}},u);return new xt(t).unsubscribe}):Gt()}function $n(r,e){return wn(function(t){var n=I.scheduler.setTimeout(function(){return t([gt(e),wt()])},r);return function(){return I.scheduler.clearTimeout(n)}}).withDesc(new V("Bacon","later",[r,e]))}function Gn(r){return function(t,n){return t.filter(r)?n(t):(n(wt()),D)}}function Jn(r){var e=!1;return function(t,n){return!e&&St(t)&&r(t.value)?S:(t.hasValue&&(e=!0),n(t))}}function Kn(u,o,s){void 0===s&&(s=m.id);var c={};return u.transform(In(kn(function(t){return!c[o(t)]}),cn(function(t){var e=o(t),n=u.changes().filter(function(t){return o(t)===e}),r=Pt(t).concat(n),i=s(r,t).toEventStream().transform(function(t,n){var r=n(t);return t.isEnd&&delete c[e],r});return c[e]=i})))}var Zn={};function tr(e,s){var c=!1,f=[],a=!1;return new pr(new V(e,"holdWhen",[s]),function(u){function o(t){return t&&t(),n.empty()&&r?u(wt()):S}var n=new xt,r=!1;return n.add(function(t,i){return s.subscribeInternal(function(t){if(St(t)){c=t.value;var n=S;if(!c){var r=f;f=[];for(var e=0;e<r.length;e++)n=u(bt(r[e]));a&&(u(wt()),i(),n=D)}return n}return t.isEnd?o(i):u(t)})}),n.add(function(t,n){return e.subscribeInternal(function(t){return c&&St(t)?(f.push(t.value),S):t.isEnd&&f.length?(a=!0,o(n)):u(t)})}),r=!0,o(),n.unsubscribe})}function nr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var e=pn(arguments);n=e[0],t=e[1];return Jt([n=m.map(function(t){return t.toEventStream()},n),t]).withDesc(new V("Bacon","zipWith",[t].concat(n)))}function rr(i){function u(t,n,r){return function(t){return t[t.length-1]}(t)[n]=r}function o(t){return h(t)?[]:{}}function r(t){if(f(t))return!0;if(t&&(t.constructor==Object||t.constructor==Array))for(var n in t){if(Object.prototype.hasOwnProperty.call(t,n))if(r(t[n]))return!0}}function n(t,n){if(f(n))c.push(n),s.push(function(r,e){return function(t,n){u(t,r,n[e])}}(t,c.length-1));else if(r(n)){s.push(function(r,e){return function(t){var n=o(e);u(t,r,n),t.push(n)}}(t,n)),e(n),s.push(function(t){t.pop()})}else s.push(function(n,r){return function(t){u(t,n,r)}}(t,n))}function e(t){m.each(t,n)}var s=[],c=[];return(r(i)?(e(i),vn(c).map(function(t){for(var n=o(i),r=[n],e=0;e<s.length;e++)(0,s[e])(r,t);return n})):fn(i)).withDesc(new V("Bacon","combineTemplate",[i]))}var er=0,ir=(ur.prototype.awaiting=function(t){return function(t,n){return ln([t,n],hr).map(function(t){return 0===t[1].length}).toProperty(!1).skipDuplicates().withDesc(new V(t,"awaiting",[n]))}(this,t)},ur.prototype.bufferingThrottle=function(t){return function(t,n){var r=new V(t,"bufferingThrottle",[n]);return t.delayChanges(r,function(t){return t.flatMapConcat(function(t){return Pt(t).concat($n(n,t).errors())})})}(this,t)},ur.prototype.combine=function(t,n){return dn(this,t,n)},ur.prototype.debounce=function(t){return function(t,n){return t.delayChanges(new V(t,"debounce",[n]),function(t){return t.flatMapLatest(function(t){return $n(n,t)})})}(this,t)},ur.prototype.debounceImmediate=function(t){return function(t,n){return t.delayChanges(new V(t,"debounceImmediate",[n]),function(t){return t.flatMapFirst(function(t){return Pt(t).concat($n(n,t).errors())})})}(this,t)},ur.prototype.decode=function(t){return function(t,n){return t.combine(rr(n),function(t,n){return n[t]}).withDesc(new V(t,"decode",[n]))}(this,t)},ur.prototype.delay=function(t){return function(t,n){return t.delayChanges(new V(t,"delay",[n]),function(t){return t.flatMap(function(t){return $n(n,t)})})}(this,t)},ur.prototype.deps=function(){return this.desc.deps()},ur.prototype.diff=function(t,n){return function(t,n,r){return Dn(Bt(t,[n,Zn],function(t,n){return[n,r(t[0],n)]}),In(kn(function(t){return t[1]!==Zn}),cn(function(t){return t[1]})),new V(t,"diff",[n,r]))}(this,t,n)},ur.prototype.doAction=function(t){return this.transform(function(r){return function(t,n){return St(t)&&r(t.value),n(t)}}(t),new V(this,"doAction",[t]))},ur.prototype.doEnd=function(t){return this.transform(function(r){return function(t,n){return Dt(t)&&r(),n(t)}}(t),new V(this,"doEnd",[t]))},ur.prototype.doError=function(t){return this.transform(function(r){return function(t,n){return Et(t)&&r(t.error),n(t)}}(t),new V(this,"doError",[t]))},ur.prototype.doLog=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.transform(function(r){return function(t,n){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,r.concat([t.log()])),n(t)}}(t),new V(this,"doLog",t))},ur.prototype.endAsValue=function(){return function(t){return t.transform(function(t,n){return Dt(t)?(n(bt({})),n(wt()),D):S})}(this)},ur.prototype.endOnError=function(t){return void 0===t&&(t=function(t){return!0}),function(t,r){return void 0===r&&(r=function(t){return!0}),t.transform(function(t,n){return Et(t)&&r(t.error)?(n(t),n(wt())):n(t)},new V(t,"endOnError",[]))}(this,t)},ur.prototype.errors=function(){return this.filter(function(t){return!1}).withDesc(new V(this,"errors"))},ur.prototype.filter=function(t){return function(t,n){return An(t,n,kn,new V(t,"filter",[n]))}(this,t)},ur.prototype.first=function(){return kt(1,this,new V(this,"first"))},ur.prototype.firstToPromise=function(t){return function(t,n){if("function"!=typeof n){if("function"!=typeof Promise)throw new Error("There isn't default Promise, use shim or parameter");n=function(t){return new Promise(t)}}return new n(function(n,r){return t.subscribe(function(t){return St(t)&&n(t.value),Et(t)&&r(t.error),D})})}(this,t)},ur.prototype.fold=function(t,n){return Wn(this,t,n)},ur.prototype.forEach=function(t){return void 0===t&&(t=U),this.onValue(t)},ur.prototype.holdWhen=function(t){return tr(this,t)},ur.prototype.inspect=function(){return this.toString()},ur.prototype.internalDeps=function(){return this.initialDesc.deps()},ur.prototype.last=function(){return function(t){var r;return t.transform(function(t,n){return Dt(t)?(r&&n(r),n(wt()),D):St(t)?(r=t,S):n(t)}).withDesc(new V(t,"last",[]))}(this)},ur.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n,t){t.subscribe(function(t){return"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,n.concat([t.log()])),S})}(t,this),this},ur.prototype.mapEnd=function(t){return this.transform(function(t){var r=m.toFunction(t);return function(t,n){return Dt(t)?(n(bt(r(t))),n(wt()),D):n(t)}}(t),new V(this,"mapEnd",[t]))},ur.prototype.mapError=function(t){return this.transform(function(t){var r=m.toFunction(t);return function(t,n){return Et(t)?n(bt(r(t.error))):n(t)}}(t),new V(this,"mapError",[t]))},ur.prototype.name=function(t){return this._name=t,this},ur.prototype.onEnd=function(n){return void 0===n&&(n=Q),this.subscribe(function(t){return t.isEnd?n():S})},ur.prototype.onError=function(n){return void 0===n&&(n=U),this.subscribe(function(t){return Et(t)?n(t.error):S})},ur.prototype.onValue=function(n){return void 0===n&&(n=U),this.subscribe(function(t){return St(t)?n(t.value):S})},ur.prototype.onValues=function(n){return this.onValue(function(t){return n.apply(void 0,t)})},ur.prototype.reduce=function(t,n){return Wn(this,t,n)},ur.prototype.sampledBy=function(t){return En(this,t,arguments[1])},ur.prototype.scan=function(t,n){return Bt(this,t,n)},ur.prototype.skip=function(t){return function(t,r){return t.transform(function(t,n){return t.hasValue&&0<r?(r--,S):n(t)},new V(t,"skip",[r]))}(this,t)},ur.prototype.skipDuplicates=function(t){return At(this,t)},ur.prototype.skipErrors=function(){return function(t){return t.transform(function(t,n){return Et(t)?S:n(t)},new V(t,"skipErrors",[]))}(this)},ur.prototype.skipUntil=function(t){return function(t,n){var r=n.transform(In(_t(1),cn(!0))).toProperty().startWith(!1);return t.filter(r).withDesc(new V(t,"skipUntil",[n]))}(this,t)},ur.prototype.skipWhile=function(t){return function(t,n){return An(t,n,Jn,new V(t,"skipWhile",[n]))}(this,t)},ur.prototype.slidingWindow=function(t,n){return void 0===n&&(n=0),function(t,r,n){return void 0===n&&(n=0),t.scan([],function(t,n){return t.concat([n]).slice(-r)}).filter(function(t){return t.length>=n}).withDesc(new V(t,"slidingWindow",[r,n]))}(this,t,n)},ur.prototype.subscribe=function(t){var n=this;return void 0===t&&(t=U),F.wrappedSubscribe(this,function(t){return n.subscribeInternal(t)},t)},ur.prototype.take=function(t){return kt(t,this)},ur.prototype.takeUntil=function(t){return function(t,n){var r=ln([t.mapEnd(On),n.skipErrors()],hr);return t instanceof sr&&(r=r.toProperty()),r.transform(function(t,n){if(St(t)){var r=t.value,e=r[0];if(r[1].length)return n(wt());for(var i=S,u=0;u<e.length;u++){var o=e[u];if(o===On)return n(wt());i=n(bt(o))}return i}return n(t)},new V(t,"takeUntil",[n]))}(this,t)},ur.prototype.takeWhile=function(t){return function(t,n){return An(t,n,Gn,new V(t,"takeWhile",[n]))}(this,t)},ur.prototype.throttle=function(t){return function(t,n){return t.delayChanges(new V(t,"throttle",[n]),function(t){return t.bufferWithTime(n).map(function(t){return t[t.length-1]})})}(this,t)},ur.prototype.toPromise=function(t){return function(t,n){return t.last().firstToPromise(n)}(this,t)},ur.prototype.toString=function(){return this._name?this._name:this.desc.toString()},ur.prototype.withDesc=function(t){return t&&(this.desc=t),this},ur.prototype.withDescription=function(t,n){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];return this.desc=q.apply(void 0,[t,n].concat(r)),this},ur.prototype.zip=function(t,n){return function(t,n,r){return nr(r||Array,t,n).withDesc(new V(t,"zip",[n]))}(this,t,n)},ur);function ur(t){this.id=++er,this._isObservable=!0,this.desc=t,this.initialDesc=t}var or,sr=(n(cr,or=ir),cr.prototype.and=function(t){return function(t,n){return t.combine(Bn(n),function(t,n){return!(!t||!n)}).withDesc(new V(t,"and",[n]))}(this,t)},cr.prototype.changes=function(){var t=this;return new pr(new V(this,"changes",[]),function(n){return t.dispatcher.subscribe(function(t){return t.isInitial?S:n(t)})})},cr.prototype.concat=function(t){return Mn(this,this.changes().concat(t))},cr.prototype.delayChanges=function(t,n){return Mn(this,n(this.changes())).withDesc(t)},cr.prototype.flatMap=function(t){return Pn(this,t)},cr.prototype.flatMapConcat=function(t){return bn(this,t)},cr.prototype.flatMapError=function(t){return Tn(this,t)},cr.prototype.flatMapEvent=function(t){return Ft(this,t)},cr.prototype.flatMapFirst=function(t){return xn(this,t)},cr.prototype.flatMapLatest=function(t){return Vn(this,t)},cr.prototype.flatMapWithConcurrencyLimit=function(t,n){return zn(this,t,n)},cr.prototype.groupBy=function(t,n){return Kn(this,t,n)},cr.prototype.map=function(t){return sn(this,t)},cr.prototype.not=function(){return _n(this)},cr.prototype.or=function(t){return function(t,n){return t.combine(Bn(n),function(t,n){return t||n}).withDesc(new V(t,"or",[n]))}(this,t)},cr.prototype.sample=function(t){return function(t,n){return Sn(t,mn(n,{}),function(t,n){return t}).withDesc(new V(t,"sample",[n]))}(this,t)},cr.prototype.startWith=function(t){return function(t,n){return t.scan(n,function(t,n){return n}).withDesc(new V(t,"startWith",[n]))}(this,t)},cr.prototype.subscribeInternal=function(t){return void 0===t&&(t=U),this.dispatcher.subscribe(t)},cr.prototype.toEventStream=function(t){var r=this;return new pr(new V(this,"toEventStream",[]),function(n){return r.subscribeInternal(function(t){return n(t.toNext())})},void 0,t)},cr.prototype.toProperty=function(){return this},cr.prototype.transform=function(t,n){return Dn(this,t,n)},cr.prototype.withLatestFrom=function(t,n){return un(this,t,n)},cr.prototype.withStateMachine=function(t,n){return z(t,n,this)},cr);function cr(t,n,r){var e=or.call(this,t)||this;return e._isProperty=!0,e.dispatcher=new Un(e,n,r),Fn(e),e}function fr(t){return!!t._isProperty}var ar,hr={forceAsync:!1},pr=(n(lr,ar=ir),lr.prototype.bufferWithTime=function(t){return function(t,n){return Hn(t,n,Number.MAX_VALUE).withDesc(new V(t,"bufferWithTime",[n]))}(this,t)},lr.prototype.bufferWithCount=function(t){return function(t,n){return Hn(t,void 0,n).withDesc(new V(t,"bufferWithCount",[n]))}(this,t)},lr.prototype.bufferWithTimeOrCount=function(t,n){return Hn(this,t,n)},lr.prototype.changes=function(){return this},lr.prototype.concat=function(t,n){return function(e,i,t){return new pr(new V(e,"concat",[i]),function(n){var r=a,t=e.dispatcher.subscribe(function(t){return t.isEnd?(r=i.toEventStream().dispatcher.subscribe(n),S):n(t)});return function(){return t(),r()}},void 0,t)}(this,t,n)},lr.prototype.delayChanges=function(t,n){return n(this).withDesc(t)},lr.prototype.flatMap=function(t){return Pn(this,t)},lr.prototype.flatMapConcat=function(t){return bn(this,t)},lr.prototype.flatMapError=function(t){return Tn(this,t)},lr.prototype.flatMapFirst=function(t){return xn(this,t)},lr.prototype.flatMapLatest=function(t){return Vn(this,t)},lr.prototype.flatMapWithConcurrencyLimit=function(t,n){return zn(this,t,n)},lr.prototype.flatMapEvent=function(t){return Ft(this,t)},lr.prototype.flatScan=function(t,n){return function(t,n,r){var e=n;return t.flatMapConcat(function(t){return Ct(r(e,t)).doAction(function(t){return e=t})}).toProperty().startWith(n).withDesc(new V(t,"flatScan",[n,r]))}(this,t,n)},lr.prototype.groupBy=function(t,n){return Kn(this,t,n)},lr.prototype.map=function(t){return sn(this,t)},lr.prototype.merge=function(t){return Xn(this,t).withDesc(new V(this,"merge",[t]))},lr.prototype.not=function(){return _n(this)},lr.prototype.startWith=function(t){return function(t,n){return Pt(n).concat(t).withDesc(new V(t,"startWith",[n]))}(this,t)},lr.prototype.subscribeInternal=function(t){return void 0===t&&(t=U),this.dispatcher.subscribe(t)},lr.prototype.toEventStream=function(){return this},lr.prototype.toProperty=function(t){var n=arguments.length?function(t){return t&&(t._isSome||t._isNone)?t:new H(t)}(t):X(),r=this.dispatcher,e=new V(this,"toProperty",Array.prototype.slice.apply(arguments)),i=r.subscribe;return new sr(e,Wt(n,i))},lr.prototype.transform=function(t,n){return function(t,r,n){return new pr(new V(t,"transform",[r]),function(n){return t.subscribeInternal(function(t){return r(t,n)})},void 0,hr).withDesc(n)}(this,t,n)},lr.prototype.withLatestFrom=function(t,n){return en(this,t,n)},lr.prototype.withStateMachine=function(t,n){return z(t,n,this)},lr);function lr(t,n,r,e){var i=ar.call(this,t)||this;return i._isEventStream=!0,e!==hr&&(n=function(u,t){var o=!1;return function(r){var e,n=F.isInTransaction();function i(){var t=e||[];e=void 0;for(var n=0;n<t.length;n++){r(t[n])}}o=!0;try{return t(function(t){return o||e?(e?e.push(t):(e=[t],n?F.soonButNotYet(u,i):I.scheduler.setTimeout(i,0)),S):r(t)})}finally{o=!1}}}(i,n)),i.dispatcher=new Ln(i,n,r),Fn(i),i}function vr(t,n){return new pr(t,n)}function dr(t,n){return new pr(t,n,void 0,hr)}function yr(t){return"undefined"!=typeof Symbol&&Symbol[t]?Symbol[t]:"undefined"!=typeof Symbol&&"function"==typeof Symbol.for?Symbol[t]=Symbol.for(t):"@@"+t}var br=(wr.prototype.subscribe=function(t,n,r){var e="function"==typeof t?{next:t,error:n,complete:r}:t,i={closed:!1,unsubscribe:function(){i.closed=!0,u()}},u=this.observable.subscribe(function(t){St(t)&&e.next?e.next(t.value):Et(t)?(e.error&&e.error(t.error),i.unsubscribe()):t.isEnd&&(i.closed=!0,e.complete&&e.complete())});return i},wr);function wr(t){this.observable=t}function gr(r){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){return r.apply(void 0,[t].concat(n))}}}br.prototype[yr("observable")]=function(){return this},ir.prototype.toESObservable=function(){return new br(this)},ir.prototype[yr("observable")]=ir.prototype.toESObservable;var mr=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];function Er(n,r,t){var e=function(t){for(var n,r=0;r<mr.length;r++){var e=[t[(n=mr[r])[0]],t[n[1]]];if(e[0]&&e[1])return e}for(var i=0;i<mr.length;i++){var u=t[(n=mr[i])[0]];if(u)return[u,function(){}]}throw new Error("No suitable event methods in "+t)}(n),i=e[0],u=e[1],o=new V("Bacon","fromEvent",[n,r]);return wn(function(t){return function(t){return m.isFunction(t)}(r)?(r(i.bind(n),t),function(){return r(u.bind(n),t)}):(i.call(n,r,t),function(){return u.call(n,r,t)})},t).withDesc(o)}function Sr(s){var c=0;return wn(function(n){var r=!1,e=S,i=function(){};function u(t){return t.isEnd?(r?o():r=!0,S):e=n(t)}function o(){var t;for(r=!0;r&&e!==D;)t=s(c++),r=!1,t?i=t.subscribeInternal(u):n(wt());r=!0}return o(),function(){return i()}}).withDesc(new V("Bacon","repeat",[s]))}function Dr(t){return $n(t,"").filter(!1).withDesc(new V("Bacon","silence",[t]))}function Ir(t){return[gt(t),wt()]}var Ar,kr=(Ar=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return m.isFunction(t)?n.length?function(r,e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.apply(void 0,e.concat(t))}}(t,n):t:m.always(t)},function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if("object"==typeof t&&n.length){var e=t,i=n[0];t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e[i].apply(e,t)},n=n.slice(1)}return Ar.apply(void 0,[t].concat(n))});function _r(t,n){return kr.apply(void 0,[t].concat(n))}var Br,xr=(n(Mr,Br=pr),Mr.prototype.plug=function(t){var n=this;if(!this.ended){var r={input:t,unsub:void 0};return this.subscriptions.push(r),void 0!==this.sink&&this.subscribeInput(r),function(){return n.unsubscribeInput(t)}}},Mr.prototype.end=function(){if(this.ended=!0,this.unsubAll(),"function"==typeof this.sink)return this.sink(wt())},Mr.prototype.push=function(t){if(!this.ended&&"function"==typeof this.sink){var n=!this.pushing;if(!n)return this.pushQueue||(this.pushQueue=[]),void this.pushQueue.push(t);this.pushing=!0;try{return this.sink(bt(t))}finally{if(n&&this.pushQueue){for(var r=0;r<this.pushQueue.length;){var e=this.pushQueue[r];this.sink(bt(e)),r++}this.pushQueue=void 0}this.pushing=!1}}},Mr.prototype.error=function(t){if("function"==typeof this.sink)return this.sink(new vt(t))},Mr.prototype.unsubAll=function(){for(var t,n=this.subscriptions,r=0;r<n.length;r++)"function"==typeof(t=n[r]).unsub&&t.unsub()},Mr.prototype.subscribeAll=function(t){if(this.ended)t(wt());else{this.sink=t;for(var n,r=this.subscriptions.slice(),e=0;e<r.length;e++)n=r[e],this.subscribeInput(n)}return this.unsubAll},Mr.prototype.guardedSink=function(n){var r=this;return function(t){return t.isEnd?(r.unsubscribeInput(n),D):r.sink?r.sink(t):S}},Mr.prototype.subscribeInput=function(t){return t.unsub=t.input.subscribeInternal(this.guardedSink(t.input)),t.unsub},Mr.prototype.unsubscribeInput=function(t){for(var n,r=this.subscriptions,e=0;e<r.length;e++)if((n=r[e]).input===t)return"function"==typeof n.unsub&&n.unsub(),void this.subscriptions.splice(e,1)},Mr);function Mr(){var n=Br.call(this,new V("Bacon","Bus",[]),function(t){return n.subscribeAll(t)})||this;return n.pushing=!1,n.pushQueue=void 0,n.ended=!1,n.subscriptions=[],n.unsubAll=m.bind(n.unsubAll,n),n.subscriptions=[],n.ended=!1,n}var Wr={asEventStream:function(n,r,t){var e=this;return m.isFunction(r)&&(t=r,r=void 0),wn(function(t){return e.on(n,r,t),function(){return e.off(n,r,t)}},t).withDesc(new V(this.selector||this,"asEventStream",[n]))},init:function(t){t.fn.asEventStream=Wr.asEventStream}};t.$=Wr,t.Bus=xr,t.CompositeUnsubscribe=xt,t.Desc=V,t.End=ht,t.Error=vt,t.Event=G,t.EventStream=pr,t.Initial=ut,t.Next=rt,t.Observable=ir,t.Property=sr,t.Value=Z,t._=m,t.combine=dn,t.combineAsArray=vn,t.combineTemplate=rr,t.combineWith=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var e=pn(arguments),i=(t=e[0],n=e[1],new V("Bacon","combineWith",[n].concat(t)));return vn(t).map(function(t){return n.apply(void 0,t)}).withDesc(i)},t.concatAll=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=an(t);return(r.length?s(l(r),c(r).toEventStream(),function(t,n){return t.concat(n)}):Gt()).withDesc(new V("Bacon","concatAll",r))},t.constant=fn,t.fromArray=function(s){if(s.length){var c=0,f=new pr(new V("Bacon","fromArray",[s]),function(r){var e=!1,i=S,u=!1,o=!1;return F.soonButNotYet(f,function t(){if(o=!0,!u){if(c===s.length)return r(wt()),!1;for(u=!0;o;)if(o=!1,i!==D&&!e){var n=s[c++];(i=r(gt(n)))!==D&&(c===s.length?r(wt()):F.afterTransaction(f,t))}return u=!1}}),function(){return e=!0}});return f}return Gt().withDesc(new V("Bacon","fromArray",s))},t.fromBinder=wn,t.fromCallback=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return wn(function(t){return _r(n,r)(t),a},function(t){return[t,wt()]}).withDesc(new V("Bacon","fromCallback",[n].concat(r)))},t.fromESObservable=function(t){var r;r=t[yr("observable")]?t[yr("observable")]():t;var n=new V("Bacon","fromESObservable",[r]);return new pr(n,function(n){var t=r.subscribe({error:function(t){n(new vt(t)),n(new ht)},next:function(t){n(new rt(t))},complete:function(){n(new ht)}});return t.unsubscribe?function(){t.unsubscribe()}:t})},t.fromEvent=Er,t.fromEventTarget=Er,t.fromNodeCallback=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return wn(function(t){return _r(n,r)(t),a},function(t,n){return t?[new vt(t),wt()]:[n,wt()]}).withDesc(new V("Bacon","fromNodeCallback",[n].concat(r)))},t.fromPoll=gn,t.fromPromise=function(r,e,t){return void 0===t&&(t=Ir),wn(function(n){var t=r.then(n,function(t){return n(new vt(t))});return t&&"function"==typeof t.done&&t.done(),e?function(){if("function"==typeof r.abort)return r.abort()}:function(){}},t).withDesc(new V("Bacon","fromPromise",[r]))},t.getScheduler=function(){return I.scheduler},t.groupSimultaneous=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return ln(an(t))},t.hasValue=St,t.interval=mn,t.isEnd=Dt,t.isError=Et,t.isEvent=mt,t.isInitial=function(t){return t&&t._isInitial},t.isNext=function(t){return t.isNext},t.later=$n,t.mergeAll=Xn,t.more=S,t.never=Gt,t.noMore=D,t.nullSink=U,t.nullVoidSink=Q,t.onValues=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return vn(t.slice(0,t.length-1)).onValues(t[arguments.length-1])},t.once=Pt,t.repeat=Sr,t.repeatedly=function(t,n){var r=0;return gn(t,function(){return n[r++%n.length]}).withDesc(new V("Bacon","repeatedly",[t,n]))},t.retry=function(t){if(!m.isFunction(t.source))throw new Error("'source' option has to be a function");var i=t.source,u=t.retries||0,o=0,s=t.delay||function(){return 0},c=t.isRetryable||function(){return!0},f=!1,a=null;return Sr(function(t){function n(){return i(t).endOnError().transform(function(t,n){return Et(t)?c((a=t).error)&&(0===u||o<u)?S:(f=!0,n(t)):(St(t)&&(f=!(a=null)),n(t))})}if(!f){if(a){var r={error:a.error,retriesDone:o},e=Dr(s(r));return o++,e.concat(Pt(null).flatMap(n))}return n()}}).withDesc(new V("Bacon","retry",[t]))},t.sequentially=function(t,n){var r=0;return gn(t,function(){var t=n[r++];return r<n.length?t:r===n.length?[gt(t),wt()]:wt()}).withDesc(new V("Bacon","sequentially",[t,n]))},t.setScheduler=function(t){I.scheduler=t},t.silence=Dr,t.spy=function(t){return Nn.push(t)},t.try=function(n){return function(t){try{return Pt(n(t))}catch(t){return Pt(new vt(t))}}},t.update=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];for(var e=nn(n),i=0;i<e.length;i++){var u=e[i];u[1]=gr(u[1])}return Jt.apply(void 0,e).scan(t,function(t,n){return n(t)}).withDesc(new V("Bacon","update",[t].concat(n)))},t.version="3.0.11",t.when=Jt,t.zipAsArray=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Jt([m.map(function(t){return t.toEventStream()},an(t)),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t}]).withDesc(new V("Bacon","zipAsArray",t))},t.zipWith=nr,Object.defineProperty(t,"__esModule",{value:!0})});