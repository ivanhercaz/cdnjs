!function(u){u.extend(!0,window,{Slick:{CellExternalCopyManager:function(e){var g,p,S=this,D=e||{},r=D.copiedCellStyleLayerKey||"copy-manager",i=D.copiedCellStyle||"copied",s=0,R=D.bodyElement||document.body,y=D.onCopyInit||null,v=D.onCopySuccess||null,w={C:67,V:86,ESC:27,INSERT:45};function x(e){if(D.headerColumnValueExtractor){var t=D.headerColumnValueExtractor(e);if(t)return t}return e.name}function E(e,t,l){if(D.dataItemColumnValueExtractor){var o=D.dataItemColumnValueExtractor(e,t);if(o)return o}var n="";if(t.editor){var a={container:u("<p>"),column:t,position:{top:0,left:0},grid:g,event:l},r=new t.editor(a);r.loadValue(e),n=r.serializeValue(),r.destroy()}else n=e[t.field];return n}function V(e,t,l){if(t.denyPaste)return null;if(D.dataItemColumnValueSetter)return D.dataItemColumnValueSetter(e,t,l);if(t.editor){var o={container:u("body"),column:t,position:{top:0,left:0},grid:g},n=new t.editor(o);n.loadValue(e),n.applyValue(e,l),n.destroy()}else e[t.field]=l}function b(e){var t=document.createElement("textarea");return t.style.position="absolute",t.style.left="-1000px",t.style.top=document.body.scrollTop+"px",t.value=e,R.appendChild(t),t.select(),t}function l(e,t){var l;if(!g.getEditorLock().isActive()||g.getOptions().autoEdit){if(e.which==w.ESC&&p&&(e.preventDefault(),M(),S.onCopyCancelled.notify({ranges:p}),p=null),(e.which===w.C||e.which===w.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(y&&y.call(),0!==(l=g.getSelectionModel().getSelectedRanges()).length)){I(p=l),S.onCopyCells.notify({ranges:l});for(var o=g.getColumns(),n="",a=0;a<l.length;a++){for(var r=l[a],i=[],s=r.fromRow;s<r.toRow+1;s++){var u=[],c=g.getDataItem(s);if(0===i.length&&D.includeHeaderWhenCopying){for(var d=[],f=r.fromCell;f<r.toCell+1;f++)0<o[f].name.length&&d.push(x(o[f]));i.push(d.join("\t"))}for(f=r.fromCell;f<r.toCell+1;f++)u.push(E(c,o[f],e));i.push(u.join("\t"))}n+=i.join("\r\n")+"\r\n"}if(window.clipboardData)return window.clipboardData.setData("Text",n),!0;var h=document.activeElement;if((m=b(n)).focus(),setTimeout(function(){R.removeChild(m),h?h.focus():console.log("Not element to restore focus to after copy?")},100),v){var C=0;C=1===l.length?l[0].toRow+1-l[0].fromRow:l.length,v.call(this,C)}return!1}if(!D.readOnlyMode&&(e.which===w.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===w.INSERT&&e.shiftKey&&!e.ctrlKey)){var m=b("");return setTimeout(function(){!function(i,e){var s=i.getColumns(),t=e.value.split(/[\n\f\r]/);""===t[t.length-1]&&t.pop();var r=[],l=0;R.removeChild(e);for(var o=0;o<t.length;o++)""!==t[o]?r[l++]=t[o].split("\t"):r[l++]=[""];var n=i.getActiveCell(),a=i.getSelectionModel().getSelectedRanges(),u=a&&a.length?a[0]:null,c=null,d=null;if(u)c=u.fromRow,d=u.fromCell;else{if(!n)return;c=n.row,d=n.cell}var f=!1,h=r.length,C=r.length?r[0].length:0;1==r.length&&1==r[0].length&&u&&(f=!0,h=u.toRow-u.fromRow+1,C=u.toCell-u.fromCell+1);var m=i.getData().length-c,g=0;if(m<h&&D.newRowCreator){var p=i.getData();for(g=1;g<=h-m;g++)p.push({});i.setData(p),i.render()}var y=c+h>i.getDataLength();if(D.newRowCreator&&y){var v=c+h-i.getDataLength();D.newRowCreator(v)}var w={isClipboardCommand:!0,clippedRange:r,oldValues:[],cellExternalCopyManager:S,_options:D,setDataItemValueForColumn:V,markCopySelection:I,oneCellToMultiple:f,activeRow:c,activeCell:d,destH:h,destW:C,maxDestY:i.getDataLength(),maxDestX:i.getColumns().length,h:0,w:0,execute:function(){for(var e=this.h=0;e<this.destH;e++){this.oldValues[e]=[],this.w=0,this.h++;for(var t=0;t<this.destW;t++){this.w++;var l=c+e,o=d+t;if(l<this.maxDestY&&o<this.maxDestX){i.getCellNode(l,o);var n=i.getDataItem(l);this.oldValues[e][t]=n[s[o].field],f?this.setDataItemValueForColumn(n,s[o],r[0][0]):this.setDataItemValueForColumn(n,s[o],r[e]?r[e][t]:""),i.updateCell(l,o),i.onCellChange.notify({row:l,cell:o,item:n,grid:i})}}}var a={fromCell:d,fromRow:c,toCell:d+this.w-1,toRow:c+this.h-1};this.markCopySelection([a]),i.getSelectionModel().setSelectedRanges([a]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[a]})},undo:function(){for(var e=0;e<this.destH;e++)for(var t=0;t<this.destW;t++){var l=c+e,o=d+t;if(l<this.maxDestY&&o<this.maxDestX){i.getCellNode(l,o);var n=i.getDataItem(l);f?this.setDataItemValueForColumn(n,s[o],this.oldValues[0][0]):this.setDataItemValueForColumn(n,s[o],this.oldValues[e][t]),i.updateCell(l,o),i.onCellChange.notify({row:l,cell:o,item:n,grid:i})}}var a={fromCell:d,fromRow:c,toCell:d+this.w-1,toRow:c+this.h-1};if(this.markCopySelection([a]),i.getSelectionModel().setSelectedRanges([a]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[a]}),1<g){for(var r=i.getData();1<g;g--)r.splice(r.length-1,1);i.setData(r),i.render()}}};D.clipboardCommandHandler?D.clipboardCommandHandler(w):w.execute()}(g,m)},100),!1}}}function I(e){M();for(var t=g.getColumns(),l={},o=0;o<e.length;o++)for(var n=e[o].fromRow;n<=e[o].toRow;n++){l[n]={};for(var a=e[o].fromCell;a<=e[o].toCell&&a<t.length;a++)l[n][t[a].id]=i}g.setCellCssStyles(r,l),clearTimeout(s),s=setTimeout(function(){S.clearCopySelection()},2e3)}function M(){g.removeCellCssStyles(r)}u.extend(this,{init:function(e){(g=e).onKeyDown.subscribe(l);var t=e.getSelectionModel();if(!t)throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");t.onSelectedRangesChanged.subscribe(function(e,t){g.focus()})},destroy:function(){g.onKeyDown.unsubscribe(l)},pluginName:"CellExternalCopyManager",clearCopySelection:M,handleKeyDown:l,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event,setIncludeHeaderWhenCopying:function(e){D.includeHeaderWhenCopying=e}})}}})}(jQuery);