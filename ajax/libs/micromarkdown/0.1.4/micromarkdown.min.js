/* * * * * * * * * * * *
 *  micromarkdown .js  *
 *    Version 0.1.4    *
 *    License:  MIT    *
 *   Simon  Waldherr   *
 * * * * * * * * * * * */

var micromarkdown={useajax:!1,regexobject:{headline:/^(\#{1,6})([^\#\n]+)\n/m,code:/\s\`\`\`\n?([^`]+)\`\`\`/g,hr:/\n(?:([\*\-_] ?)+)\1\1\n/gm,lists:/^(( *(\*|\d\.) [^\n]+)\n)+/gm,bolditalic:/(?:([\*_~]{1,3}))([^\*_~\n]+)\1/g,links:/!?\[([^\]<>]+)\]\(([^ \)<>]+)( "[^\(\)\"]+")?\)/g,mail:/<(([a-z0-9_\-\.])+\@([a-z0-9_\-\.])+\.([a-z]{2,7}))>/gim,tables:/\n(([^|\n]+ *\| *)+([^|\n]+\n))(\-+\|)+(\-+\n)((([^|\n]+ *\| *)+([^|\n]+)\n)+)/g,include:/[\[<]include (\S+) from (https?:\/\/[a-z0-9\.\-]+\.[a-z]{2,9}[a-z0-9\.\-\?\&\/]+)[\]>]/gi,url:/<([a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[\-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?)>/g},parse:function(a){"use strict";var b,c,d,e,f,g,h,i,j,k=0,l=0;for(a="\n"+a+"\n";null!==(j=micromarkdown.regexobject.code.exec(a));)a=a.replace(j[0],"<code>\n"+micromarkdown.htmlEncode(j[1]).replace(/\n/gm,"<br/>").replace(/\ /gm,"&nbsp;")+"</code>\n");for(;null!==(j=micromarkdown.regexobject.headline.exec(a));)h=j[1].length,a=a.replace(j[0],"<h"+h+">"+j[2]+"</h"+h+">\n");for(;null!==(j=micromarkdown.regexobject.hr.exec(a));)a=a.replace(j[0],"\n<hr/>\n");for(;null!==(j=micromarkdown.regexobject.lists.exec(a));){for(i="*"===j[0].trim().substr(0,1)?"<ul>":"<ol>",e=j[0].split("\n"),d=0,k=0;k<e.length;k++)null!==(b=/^(( )*(\*|\d\.) ([^\n]+))/.exec(e[k]))&&(c=void 0===b[2]?0:b[2].length,d>c&&(i+="<ul>",d=c),i+="<li>"+b[4]+"</li>\n",c>d&&(i+="</ul>",d=c));i+="*"===j[0].trim().substr(0,1)?"</ul>":"</ol>",a=a.replace(j[0],i+"\n")}for(;null!==(j=micromarkdown.regexobject.bolditalic.exec(a));)if(i=[],"~~"===j[1])a=a.replace(j[0],"<del>"+j[2]+"</del>");else{switch(j[1].length){case 1:i=["<i>","</i>\n"];break;case 2:i=["<b>","</b>\n"];break;case 3:i=["<i><b>","</b></i>\n"]}a=a.replace(j[0],i[0]+j[2]+i[1])}for(;null!==(j=micromarkdown.regexobject.tables.exec(a));){for(i="<table><tr>",e=j[1].split("|"),k=0;k<e.length;k++)i+="<th>"+e[k]+"</th>";for(i+="</tr>",f=j[6].split("\n"),k=0;k<f.length;k++)if(g=f[k].split("|"),0!==g[0].length){for(i+="<tr>",l=0;l<g.length;l++)i+="<td>"+g[l]+"</td>";i+="</tr>\n"}i+="</table>",a=a.replace(j[0],i)}for(;null!==(j=micromarkdown.regexobject.links.exec(a));)a="!"===j[0].substr(0,1)?a.replace(j[0],'<img src="'+j[2]+'" alt="'+j[1]+'" title="'+j[1]+'" />\n'):a.replace(j[0],'<a href="'+j[2]+'">'+j[1]+"</a>\n");for(;null!==(j=micromarkdown.regexobject.mail.exec(a));)a=a.replace(j[0],'<a href="mailto:'+j[1]+'">'+j[1]+"</a>");for(;null!==(j=micromarkdown.regexobject.url.exec(a));)i=j[1],-1===i.indexOf("://")&&(i="http://"+i),a=a.replace(j[0],'<a href="'+i+'">'+i.replace(/(https:\/\/|http:\/\/|mailto:|ftp:\/\/)/gim,"")+"</a>");if(micromarkdown.useajax!==!1)for(;null!==(j=micromarkdown.regexobject.include.exec(a));)if(e=j[2].replace(/[\.\:\/]+/gm,""),f="",document.getElementById(e)?f=document.getElementById(e).innerHTML.trim():micromarkdown.ajax(j[2]),"csv"===j[1]&&""!==f){for(g={},g[";"]=[],g[","]=[],g[0]=[";",","],f=f.split("\n"),l=0;l<g[0].length;l++)for(k=0;k<f.length;k++)g[g[0][l]][k]=f[k].split(g[0][l]).length,k>0&&g[g[0][l]]!==!1&&(g[g[0][l]][k]!==g[g[0][l]][k-1]||1===g[g[0][l]][k])&&(g[g[0][l]]=!1);if(g[","]!==!1||g[";"]!==!1){for(g=g[";"]!==!1?";":",",i="<table>",k=0;k<f.length;k++){for(e=f[k].split(g),i+="<tr>",l=0;l<e.length;l++)i+="<td>"+micromarkdown.htmlEncode(e[l])+"</td>";i+="</tr>"}i+="</table>",a=a.replace(j[0],i)}else a=a.replace(j[0],"<code>"+f.join("\n")+"</code>")}else a=a.replace(j[0],"");return a=a.replace(/ {2,}[\n]{1,}/gim,"</br></br>")},ajax:function(a){"use strict";var b;if(document.getElementById(a.replace(/[\.\:\/]+/gm,"")))return!1;if(window.ActiveXObject)try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){return b=null,c}else b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState){var c=document.createElement("code");c.innerHTML=b.responseText,c.id=a.replace(/[\.\:\/]+/gm,""),c.style.display="none",document.getElementsByTagName("body")[0].appendChild(c),micromarkdown.useajax()}},b.open("GET",a,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.send()},countingChars:function(a,b){"use strict";return a=a.split(b),"object"==typeof a?a.length-1:0},htmlEncode:function(a){"use strict";return a.replace(/[^a-zA-Z0-9\.:\n]/g,function(a){return"&"+(micromarkdown.entityTable[a.charCodeAt(0)]||"#"+a.charCodeAt(0))+";"})},entityTable:{32:"nbsp",34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",196:"Auml",203:"Euml",207:"Iuml",214:"Ouml",220:"Uuml",223:"szlig",228:"auml",235:"euml",239:"iuml",246:"ouml",252:"uuml",255:"yuml",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",8364:"euro"}};

/* /micromarkdown */
