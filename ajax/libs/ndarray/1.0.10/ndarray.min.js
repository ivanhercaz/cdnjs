"use strict";var iota=require("iota-array"),arrayMethods=["concat","join","slice","toString","indexOf","lastIndexOf","forEach","every","some","filter","map","reduce","reduceRight"];function compare1st(t,r){return t[0]-r[0]}function order(){var t,r=this.stride,n=new Array(r.length);for(t=0;t<n.length;++t)n[t]=[Math.abs(r[t]),t];n.sort(compare1st);var o=new Array(n.length);for(t=0;t<o.length;++t)o[t]=n[t][1];return o}function compileConstructor(t,r){var n=["View",r,"d",t].join(""),o="generic"===t;if(0===r){var i=["function ",n,"(a,d) {this.data = a;this.offset = d};var proto=",n,".prototype;proto.dtype='",t,"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=proto.pick=function ",n,"_copy() {return new ",n,"(this.data,this.offset)};proto.get=function ",n,"_get(){return ",o?"this.data.get(this.offset)":"this.data[this.offset]","};proto.set=function ",n,"_set(v){return ",o?"this.data.get(this.offset)":"this.data[this.offset]","=v};return function construct_",n,"(a,b,c,d){return new ",n,"(a,d)}"].join("");return new Function(i)()}i=["'use strict'"];var e=iota(r),s=e.map(function(t){return"i"+t}),a="this.offset+"+e.map(function(t){return["this._stride",t,"*i",t].join("")}).join("+");i.push(["function ",n,"(a,",e.map(function(t){return"b"+t}).join(","),",",e.map(function(t){return"c"+t}).join(","),",d){this.data=a"].join(""));for(var u=0;u<r;++u)i.push(["this._shape",u,"=b",u,"|0"].join(""));for(u=0;u<r;++u)i.push(["this._stride",u,"=c",u,"|0"].join(""));i.push("this.offset=d|0}"),i.push(["var proto=",n,".prototype"].join("")),i.push(["proto.dtype='",t,"'"].join("")),i.push("proto.dimension="+r);var p={stride:["VStride",r,"d",t].join(""),shape:["VShape",r,"d",t].join("")};for(var f in p){var h=p[f];i.push(["function ",h,"(v) {this._v=v} var aproto=",h,".prototype"].join("")),i.push(["aproto.length=",r].join(""));var c=[];for(u=0;u<r;++u)c.push(["this._v._",f,u].join(""));i.push(["aproto.toJSON=function ",h,"_toJSON(){return [",c.join(","),"]}"].join("")),i.push(["aproto.toString=function ",h,"_toString(){return [",c.join(","),"].join()}"].join(""));for(u=0;u<r;++u)i.push(["Object.defineProperty(aproto,",u,",{get:function(){return this._v._",f,u,"},set:function(v){return this._v._",f,u,"=v|0},enumerable:true})"].join(""));for(u=0;u<arrayMethods.length;++u)arrayMethods[u]in Array.prototype&&i.push(["aproto.",arrayMethods[u],"=Array.prototype.",arrayMethods[u]].join(""));i.push(["Object.defineProperty(proto,'",f,"',{get:function ",h,"_get(){return new ",h,"(this)},set: function ",h,"_set(v){"].join(""));for(u=0;u<r;++u)i.push(["this._",f,u,"=v[",u,"]|0"].join(""));i.push("return v}})")}i.push(["Object.defineProperty(proto,'size',{get:function ",n,"_size(){return ",e.map(function(t){return["this._shape",t].join("")}).join("*"),"}})"].join("")),1===r?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),r<4?(i.push(["function ",n,"_order(){"].join("")),2===r?i.push("return (Math.abs(this._stride0)>Math.abs(this._stride1))?[1,0]:[0,1]}})"):3===r&&i.push("var s0=Math.abs(this._stride0),s1=Math.abs(this._stride1),s2=Math.abs(this._stride2);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push(["proto.set=function ",n,"_set(",s.join(","),",v){"].join("")),o?i.push(["return this.data.set(",a,",v)}"].join("")):i.push(["return this.data[",a,"]=v}"].join("")),i.push(["proto.get=function ",n,"_get(",s.join(","),"){"].join("")),o?i.push(["return this.data.get(",a,")}"].join("")):i.push(["return this.data[",a,"]}"].join("")),i.push(["proto.index=function ",n,"_index(",s.join(),"){return ",a,"}"].join("")),i.push(["proto.hi=function ",n,"_hi(",s.join(","),"){return new ",n,"(this.data,",e.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this._shape",t,":i",t,"|0"].join("")}).join(","),",",e.map(function(t){return"this._stride"+t}).join(","),",this.offset)}"].join(""));var d=e.map(function(t){return"a"+t+"=this._shape"+t}),j=e.map(function(t){return"c"+t+"=this._stride"+t});i.push(["proto.lo=function ",n,"_lo(",s.join(","),"){var b=this.offset,d=0,",d.join(","),",",j.join(",")].join(""));for(u=0;u<r;++u)i.push(["if(typeof i",u,"==='number'&&i",u,">=0){d=i",u,"|0;b+=c",u,"*d;a",u,"-=d}"].join(""));i.push(["return new ",n,"(this.data,",e.map(function(t){return"a"+t}).join(","),",",e.map(function(t){return"c"+t}).join(","),",b)}"].join("")),i.push(["proto.step=function ",n,"_step(",s.join(","),"){var ",e.map(function(t){return"a"+t+"=this._shape"+t}).join(","),",",e.map(function(t){return"b"+t+"=this._stride"+t}).join(","),",c=this.offset,d=0,ceil=Math.ceil"].join(""));for(u=0;u<r;++u)i.push(["if(typeof i",u,"==='number'){d=i",u,"|0;if(d<0){c+=b",u,"*(a",u,"-1);a",u,"=ceil(-a",u,"/d)}else{a",u,"=ceil(a",u,"/d)}b",u,"*=d}"].join(""));i.push(["return new ",n,"(this.data,",e.map(function(t){return"a"+t}).join(","),",",e.map(function(t){return"b"+t}).join(","),",c)}"].join(""));var _=new Array(r),y=new Array(r);for(u=0;u<r;++u)_[u]=["a[i",u,"|0]"].join(""),y[u]=["b[i",u,"|0]"].join("");i.push(["proto.transpose=function ",n,"_transpose(",s,"){var a=this.shape,b=this.stride;return new ",n,"(this.data,",_.join(","),",",y.join(","),",this.offset)}"].join("")),i.push(["proto.pick=function ",n,"_pick(",s,"){var a=[],b=[],c=this.offset"].join(""));for(u=0;u<r;++u)i.push(["if(typeof i",u,"==='number'&&i",u,">=0){c=(c+this._stride",u,"*i",u,")|0}else{a.push(this._shape",u,");b.push(this._stride",u,")}"].join(""));return i.push("var ctor=CTOR_LIST[a.length];return ctor(this.data,a,b,c)}"),i.push(["return function construct_",n,"(data,shape,stride,offset){return new ",n,"(data,",e.map(function(t){return"shape["+t+"]"}).join(","),",",e.map(function(t){return"stride["+t+"]"}).join(","),",offset)}"].join("")),new Function("CTOR_LIST","ORDER",i.join("\n"))(CACHED_CONSTRUCTORS[t],order)}function arrayDType(t){return t instanceof Float64Array?"float64":t instanceof Float32Array?"float32":t instanceof Int32Array?"int32":t instanceof Uint32Array?"uint32":t instanceof Uint8Array?"uint8":t instanceof Uint16Array?"uint16":t instanceof Int16Array?"int16":t instanceof Int8Array?"int8":t instanceof Uint8ClampedArray?"uint8_clamped":"undefined"!=typeof Buffer&&t instanceof Buffer?"buffer":t instanceof Array?"array":"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};function wrappedNDArrayCtor(t,r,n,o){void 0===r&&(r=[t.length]);var i=r.length;if(void 0===n){n=new Array(i);for(var e=i-1,s=1;0<=e;--e)n[e]=s,s*=r[e]}if(void 0===o)for(e=o=0;e<i;++e)n[e]<0&&(o-=(r[e]-1)*n[e]);for(var a=arrayDType(t),u=CACHED_CONSTRUCTORS[a];u.length<=i;)u.push(compileConstructor(a,u.length));return(0,u[i])(t,r,n,o)}module.exports=wrappedNDArrayCtor;