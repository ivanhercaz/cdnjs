var iota=require("iota-array"),arrayMethods=["concat","join","slice","toString","indexOf","lastIndexOf","forEach","every","some","filter","map","reduce","reduceRight"],hasTypedArrays="undefined"!=typeof Float64Array,hasBuffer="undefined"!=typeof Buffer;function compare1st(t,r){return t[0]-r[0]}function order(){var t,r=this.stride,e=new Array(r.length);for(t=0;t<e.length;++t)e[t]=[Math.abs(r[t]),t];e.sort(compare1st);var o=new Array(e.length);for(t=0;t<o.length;++t)o[t]=e[t][1];return o}function compileConstructor(t,r){var e=["View",r,"d",t].join("");r<0&&(e="View_Nil"+t);var o="generic"===t;if(-1===r){var n="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(n)()}if(0===r){n="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}";return new Function("TrivialArray",n)(CACHED_CONSTRUCTORS[t][0])}n=["'use strict'"];var i=iota(r),s=i.map(function(t){return"i"+t}),a="this.offset+"+i.map(function(t){return"this._stride"+t+"*i"+t}).join("+");n.push("function "+e+"(a,"+i.map(function(t){return"b"+t}).join(",")+","+i.map(function(t){return"c"+t}).join(",")+",d){this.data=a");for(var u=0;u<r;++u)n.push("this._shape"+u+"=b"+u+"|0");for(u=0;u<r;++u)n.push("this._stride"+u+"=c"+u+"|0");n.push("this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+t+"'","proto.dimension="+r);var p={stride:"VStride"+r+"d"+t,shape:"VShape"+r+"d"+t};for(var f in p){var h=p[f];n.push("function "+h+"(v) {this._v=v} var aproto="+h+".prototype","aproto.length="+r);var c=[];for(u=0;u<r;++u)c.push(["this._v._",f,u].join(""));n.push("aproto.toJSON=function "+h+"_toJSON(){return ["+c.join(",")+"]}","aproto.valueOf=aproto.toString=function "+h+"_toString(){return ["+c.join(",")+"].join()}");for(u=0;u<r;++u)n.push("Object.defineProperty(aproto,"+u+",{get:function(){return this._v._"+f+u+"},set:function(v){return this._v._"+f+u+"=v|0},enumerable:true})");for(u=0;u<arrayMethods.length;++u)arrayMethods[u]in Array.prototype&&n.push("aproto."+arrayMethods[u]+"=Array.prototype."+arrayMethods[u]);n.push(["Object.defineProperty(proto,'",f,"',{get:function ",h,"_get(){return new ",h,"(this)},set: function ",h,"_set(v){"].join(""));for(u=0;u<r;++u)n.push("this._"+f+u+"=v["+u+"]|0");n.push("return v}})")}n.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+i.map(function(t){return"this._shape"+t}).join("*"),"}})"),1===r?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),r<4?(n.push("function "+e+"_order(){"),2===r?n.push("return (Math.abs(this._stride0)>Math.abs(this._stride1))?[1,0]:[0,1]}})"):3===r&&n.push("var s0=Math.abs(this._stride0),s1=Math.abs(this._stride1),s2=Math.abs(this._stride2);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+e+"_set("+s.join(",")+",v){"),o?n.push("return this.data.set("+a+",v)}"):n.push("return this.data["+a+"]=v}"),n.push("proto.get=function "+e+"_get("+s.join(",")+"){"),o?n.push("return this.data.get("+a+")}"):n.push("return this.data["+a+"]}"),n.push("proto.index=function "+e+"_index(",s.join(),"){return "+a+"}"),n.push("proto.hi=function "+e+"_hi("+s.join(",")+"){return new "+e+"(this.data,"+i.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this._shape",t,":i",t,"|0"].join("")}).join(",")+","+i.map(function(t){return"this._stride"+t}).join(",")+",this.offset)}");var d=i.map(function(t){return"a"+t+"=this._shape"+t}),y=i.map(function(t){return"c"+t+"=this._stride"+t});n.push("proto.lo=function "+e+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+y.join(","));for(u=0;u<r;++u)n.push("if(typeof i"+u+"==='number'&&i"+u+">=0){d=i"+u+"|0;b+=c"+u+"*d;a"+u+"-=d}");n.push("return new "+e+"(this.data,"+i.map(function(t){return"a"+t}).join(",")+","+i.map(function(t){return"c"+t}).join(",")+",b)}"),n.push("proto.step=function "+e+"_step("+s.join(",")+"){var "+i.map(function(t){return"a"+t+"=this._shape"+t}).join(",")+","+i.map(function(t){return"b"+t+"=this._stride"+t}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(u=0;u<r;++u)n.push("if(typeof i"+u+"==='number'){d=i"+u+"|0;if(d<0){c+=b"+u+"*(a"+u+"-1);a"+u+"=ceil(-a"+u+"/d)}else{a"+u+"=ceil(a"+u+"/d)}b"+u+"*=d}");n.push("return new "+e+"(this.data,"+i.map(function(t){return"a"+t}).join(",")+","+i.map(function(t){return"b"+t}).join(",")+",c)}");var _=new Array(r),v=new Array(r);for(u=0;u<r;++u)_[u]="a[i"+u+"]",v[u]="b[i"+u+"]";n.push("proto.transpose=function "+e+"_transpose("+s+"){"+s.map(function(t,r){return t+"=("+t+"===undefined?"+r+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+_.join(",")+","+v.join(",")+",this.offset)}"),n.push("proto.pick=function "+e+"_pick("+s+"){var a=[],b=[],c=this.offset");for(u=0;u<r;++u)n.push("if(typeof i"+u+"==='number'&&i"+u+">=0){c=(c+this._stride"+u+"*i"+u+")|0}else{a.push(this._shape"+u+");b.push(this._stride"+u+")}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+i.map(function(t){return"shape["+t+"]"}).join(",")+","+i.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(CACHED_CONSTRUCTORS[t],order)}function arrayDType(t){if(hasBuffer&&Buffer.isBuffer(t))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};function wrappedNDArrayCtor(t,r,e,o){if(void 0===t)return(0,CACHED_CONSTRUCTORS.array[0])([]);"number"==typeof t&&(t=[t]),void 0===r&&(r=[t.length]);var n=r.length;if(void 0===e){e=new Array(n);for(var i=n-1,s=1;0<=i;--i)e[i]=s,s*=r[i]}if(void 0===o)for(i=o=0;i<n;++i)e[i]<0&&(o-=(r[i]-1)*e[i]);for(var a=arrayDType(t),u=CACHED_CONSTRUCTORS[a];u.length<=n+1;)u.push(compileConstructor(a,u.length-1));return(0,u[n+1])(t,r,e,o)}module.exports=wrappedNDArrayCtor;