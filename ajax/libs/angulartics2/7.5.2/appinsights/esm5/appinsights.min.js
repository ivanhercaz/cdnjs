import*as tslib_1 from"tslib";import{Injectable}from"@angular/core";import{Title}from"@angular/platform-browser";import{NavigationEnd,NavigationError,NavigationStart,Router}from"@angular/router";import{filter}from"rxjs/operators";import{Angulartics2}from"angulartics2";import*as i0 from"@angular/core";import*as i1 from"angulartics2";import*as i2 from"@angular/platform-browser";import*as i3 from"@angular/router";var AppInsightsDefaults=function(){return function(){this.userId=null}}();export{AppInsightsDefaults};var Angulartics2AppInsights=function(){function t(t,i,e){var r=this;this.angulartics2=t,this.title=i,this.router=e,this.loadStartTime=null,this.loadTime=null,this.metrics=null,this.dimensions=null,this.measurements=null,"undefined"==typeof appInsights&&console.warn("appInsights not found");var s=new AppInsightsDefaults;this.angulartics2.settings.appInsights=tslib_1.__assign({},s,this.angulartics2.settings.appInsights),this.angulartics2.setUsername.subscribe(function(t){return r.setUsername(t)}),this.angulartics2.setUserProperties.subscribe(function(t){return r.setUserProperties(t)})}return t.prototype.startTracking=function(){var t=this;this.angulartics2.pageTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(i){return t.pageTrack(i.path)}),this.angulartics2.eventTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(i){return t.eventTrack(i.action,i.properties)}),this.angulartics2.exceptionTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(i){return t.exceptionTrack(i)}),this.router.events.pipe(this.angulartics2.filterDeveloperMode(),filter(function(t){return t instanceof NavigationStart})).subscribe(function(i){return t.startTimer()}),this.router.events.pipe(filter(function(t){return t instanceof NavigationError||t instanceof NavigationEnd})).subscribe(function(i){return t.stopTimer()})},t.prototype.startTimer=function(){this.loadStartTime=Date.now(),this.loadTime=null},t.prototype.stopTimer=function(){this.loadTime=Date.now()-this.loadStartTime,this.loadStartTime=null},t.prototype.pageTrack=function(t){appInsights.trackPageView(this.title.getTitle(),t,this.dimensions,this.metrics,this.loadTime)},t.prototype.eventTrack=function(t,i){appInsights.trackEvent(t,i,this.measurements)},t.prototype.exceptionTrack=function(t){var i=t.event||t.description||t;appInsights.trackException(i)},t.prototype.setUsername=function(t){this.angulartics2.settings.appInsights.userId=t,appInsights.setAuthenticatedUserContext(t)},t.prototype.setUserProperties=function(t){t.userId&&(this.angulartics2.settings.appInsights.userId=t.userId),t.accountId?appInsights.setAuthenticatedUserContext(this.angulartics2.settings.appInsights.userId,t.accountId):appInsights.setAuthenticatedUserContext(this.angulartics2.settings.appInsights.userId)},t.ngInjectableDef=i0.defineInjectable({factory:function(){return new t(i0.inject(i1.Angulartics2),i0.inject(i2.Title),i0.inject(i3.Router))},token:t,providedIn:"root"}),t=tslib_1.__decorate([Injectable({providedIn:"root"}),tslib_1.__metadata("design:paramtypes",[Angulartics2,Title,Router])],t)}();export{Angulartics2AppInsights};