import{__decorate,__metadata}from"tslib";import{ɵɵdefineInjectable,ɵɵinject,Injectable}from"@angular/core";import{Title}from"@angular/platform-browser";import{NavigationStart,NavigationError,NavigationEnd,Router}from"@angular/router";import{filter}from"rxjs/operators";import{Angulartics2}from"angulartics2";class AppInsightsDefaults{constructor(){this.userId=null}}let Angulartics2AppInsights=class{constructor(t,s,e){this.angulartics2=t,this.title=s,this.router=e,this.loadStartTime=null,this.loadTime=null,this.metrics=null,this.dimensions=null,this.measurements=null,"undefined"==typeof appInsights&&console.warn("appInsights not found");const i=new AppInsightsDefaults;this.angulartics2.settings.appInsights=Object.assign({},i,this.angulartics2.settings.appInsights),this.angulartics2.setUsername.subscribe(t=>this.setUsername(t)),this.angulartics2.setUserProperties.subscribe(t=>this.setUserProperties(t))}startTracking(){this.angulartics2.pageTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.pageTrack(t.path)),this.angulartics2.eventTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.eventTrack(t.action,t.properties)),this.angulartics2.exceptionTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.exceptionTrack(t)),this.router.events.pipe(this.angulartics2.filterDeveloperMode(),filter(t=>t instanceof NavigationStart)).subscribe(t=>this.startTimer()),this.router.events.pipe(filter(t=>t instanceof NavigationError||t instanceof NavigationEnd)).subscribe(t=>this.stopTimer())}startTimer(){this.loadStartTime=Date.now(),this.loadTime=null}stopTimer(){this.loadTime=Date.now()-this.loadStartTime,this.loadStartTime=null}pageTrack(t){appInsights.trackPageView(this.title.getTitle(),t,this.dimensions,this.metrics,this.loadTime)}eventTrack(t,s){appInsights.trackEvent(t,s,this.measurements)}exceptionTrack(t){const s=t.event||t.description||t;appInsights.trackException(s)}setUsername(t){this.angulartics2.settings.appInsights.userId=t,appInsights.setAuthenticatedUserContext(t)}setUserProperties(t){t.userId&&(this.angulartics2.settings.appInsights.userId=t.userId),t.accountId?appInsights.setAuthenticatedUserContext(this.angulartics2.settings.appInsights.userId,t.accountId):appInsights.setAuthenticatedUserContext(this.angulartics2.settings.appInsights.userId)}};Angulartics2AppInsights.ngInjectableDef=ɵɵdefineInjectable({factory:function(){return new Angulartics2AppInsights(ɵɵinject(Angulartics2),ɵɵinject(Title),ɵɵinject(Router))},token:Angulartics2AppInsights,providedIn:"root"}),Angulartics2AppInsights=__decorate([Injectable({providedIn:"root"}),__metadata("design:paramtypes",[Angulartics2,Title,Router])],Angulartics2AppInsights);export{Angulartics2AppInsights,AppInsightsDefaults};