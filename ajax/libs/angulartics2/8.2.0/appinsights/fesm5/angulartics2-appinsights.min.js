import{__decorate,__metadata,__assign}from"tslib";import{ɵɵdefineInjectable,ɵɵinject,Injectable}from"@angular/core";import{Title}from"@angular/platform-browser";import{NavigationStart,NavigationError,NavigationEnd,Router}from"@angular/router";import{filter}from"rxjs/operators";import{Angulartics2}from"angulartics2";var AppInsightsDefaults=function(){return function(){this.userId=null}}(),Angulartics2AppInsights=function(){function t(t,e,i){var s=this;this.angulartics2=t,this.title=e,this.router=i,this.loadStartTime=null,this.loadTime=null,this.metrics=null,this.dimensions=null,this.measurements=null,"undefined"==typeof appInsights&&console.warn("appInsights not found");var n=new AppInsightsDefaults;this.angulartics2.settings.appInsights=__assign({},n,this.angulartics2.settings.appInsights),this.angulartics2.setUsername.subscribe(function(t){return s.setUsername(t)}),this.angulartics2.setUserProperties.subscribe(function(t){return s.setUserProperties(t)})}return t.prototype.startTracking=function(){var t=this;this.angulartics2.pageTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.pageTrack(e.path)}),this.angulartics2.eventTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.eventTrack(e.action,e.properties)}),this.angulartics2.exceptionTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.exceptionTrack(e)}),this.router.events.pipe(this.angulartics2.filterDeveloperMode(),filter(function(t){return t instanceof NavigationStart})).subscribe(function(e){return t.startTimer()}),this.router.events.pipe(filter(function(t){return t instanceof NavigationError||t instanceof NavigationEnd})).subscribe(function(e){return t.stopTimer()})},t.prototype.startTimer=function(){this.loadStartTime=Date.now(),this.loadTime=null},t.prototype.stopTimer=function(){this.loadTime=Date.now()-this.loadStartTime,this.loadStartTime=null},t.prototype.pageTrack=function(t){appInsights.trackPageView(this.title.getTitle(),t,this.dimensions,this.metrics,this.loadTime)},t.prototype.eventTrack=function(t,e){appInsights.trackEvent(t,e,this.measurements)},t.prototype.exceptionTrack=function(t){var e=t.event||t.description||t;appInsights.trackException(e)},t.prototype.setUsername=function(t){this.angulartics2.settings.appInsights.userId=t,appInsights.setAuthenticatedUserContext(t)},t.prototype.setUserProperties=function(t){t.userId&&(this.angulartics2.settings.appInsights.userId=t.userId),t.accountId?appInsights.setAuthenticatedUserContext(this.angulartics2.settings.appInsights.userId,t.accountId):appInsights.setAuthenticatedUserContext(this.angulartics2.settings.appInsights.userId)},t.ngInjectableDef=ɵɵdefineInjectable({factory:function(){return new t(ɵɵinject(Angulartics2),ɵɵinject(Title),ɵɵinject(Router))},token:t,providedIn:"root"}),t=__decorate([Injectable({providedIn:"root"}),__metadata("design:paramtypes",[Angulartics2,Title,Router])],t)}();export{Angulartics2AppInsights,AppInsightsDefaults};