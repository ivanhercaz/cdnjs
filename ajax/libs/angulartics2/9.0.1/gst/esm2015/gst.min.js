import{__decorate}from"tslib";import{Injectable}from"@angular/core";import{Angulartics2,GoogleGlobalSiteTagSettings,UserTimings}from"angulartics2";import*as i0 from"@angular/core";import*as i1 from"angulartics2";export class GoogleGlobalSiteTagDefaults{constructor(){this.trackingIds=[],"undefined"!=typeof ga&&ga&&ga(()=>{ga.getAll().forEach(t=>{const e=t.get("trackingId");void 0!==e&&-1===this.trackingIds.indexOf(e)&&this.trackingIds.push(e)})})}};let Angulartics2GoogleGlobalSiteTag=class{constructor(t){this.angulartics2=t,this.dimensionsAndMetrics={};const e=new GoogleGlobalSiteTagDefaults;this.angulartics2.settings.gst=Object.assign(Object.assign({},e),this.angulartics2.settings.gst)}startTracking(){this.angulartics2.pageTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.pageTrack(t.path)),this.angulartics2.eventTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.eventTrack(t.action,t.properties)),this.angulartics2.exceptionTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.exceptionTrack(t)),this.angulartics2.userTimings.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.userTimings(this.convertTimings(t))),this.angulartics2.setUsername.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.setUsername(t)),this.angulartics2.setUserProperties.pipe(this.angulartics2.filterDeveloperMode()).subscribe(t=>this.setUserProperties(t))}pageTrack(t){if("undefined"!=typeof gtag&&gtag){const e=Object.assign({page_path:t,page_location:window.location.protocol+"//"+window.location.host+t},this.dimensionsAndMetrics);this.angulartics2.settings.gst.customMap&&(e.custom_map=this.angulartics2.settings.gst.customMap),this.angulartics2.settings.gst.userId&&(e.user_id=this.angulartics2.settings.gst.userId),this.angulartics2.settings.gst.anonymizeIp&&(e.anonymize_ip=this.angulartics2.settings.gst.anonymizeIp);for(const t of this.angulartics2.settings.gst.trackingIds)gtag("config",t,e)}}eventTrack(t,e={}){this.eventTrackInternal(t,Object.assign({event_category:e.category||"interaction",event_label:e.label,value:e.value,non_interaction:e.noninteraction},e.gstCustom))}exceptionTrack(t){void 0===t.fatal&&(console.log('No "fatal" provided, sending with fatal=true'),t.fatal=!0),t.exDescription=t.event?t.event.stack:t.description,this.eventTrack("exception",{gstCustom:Object.assign({description:t.exDescription,fatal:t.fatal},t.gstCustom)})}userTimings(t){t?this.eventTrackInternal("timing_complete",{name:t.name,value:t.value,event_category:t.category,event_label:t.label}):console.error('User timings - "properties" parameter is required to be set.')}convertTimings(t){return{name:t.timingVar,value:t.timingValue,category:t.timingCategory,label:t.timingLabel}}setUsername(t){this.angulartics2.settings.gst.userId=t,"undefined"!=typeof gtag&&gtag&&gtag("set",{user_id:"string"!=typeof t&&t?t.userId:t})}setUserProperties(t){this.setDimensionsAndMetrics(t)}setDimensionsAndMetrics(t){this.dimensionsAndMetrics=Object.assign(Object.assign({},this.dimensionsAndMetrics),t),Object.keys(this.dimensionsAndMetrics).forEach(t=>{const e=this.dimensionsAndMetrics[t];null==e&&delete this.dimensionsAndMetrics[t]}),"undefined"!=typeof gtag&&gtag&&gtag("set",this.dimensionsAndMetrics)}eventTrackInternal(t,e={}){this.cleanProperties(e),"undefined"!=typeof gtag&&gtag&&gtag("event",t,e)}cleanProperties(t){if(t.value){const e=parseInt(t.value,10);t.value=isNaN(e)?0:e}}};Angulartics2GoogleGlobalSiteTag.ctorParameters=(()=>[{type:Angulartics2}]),Angulartics2GoogleGlobalSiteTag.ɵprov=i0.ɵɵdefineInjectable({factory:function(){return new Angulartics2GoogleGlobalSiteTag(i0.ɵɵinject(i1.Angulartics2))},token:Angulartics2GoogleGlobalSiteTag,providedIn:"root"}),Angulartics2GoogleGlobalSiteTag=__decorate([Injectable({providedIn:"root"})],Angulartics2GoogleGlobalSiteTag);export{Angulartics2GoogleGlobalSiteTag};