import{__assign,__decorate,__param,__values}from"tslib";import{Inject,Injectable}from"@angular/core";import{ReplaySubject}from"rxjs";import{filter}from"rxjs/operators";import{DefaultConfig}from"./angulartics2-config";import{ANGULARTICS2_TOKEN}from"./angulartics2-token";import{RouterlessTracking,TrackNavigationEnd}from"./routerless";import*as i0 from"@angular/core";import*as i1 from"./routerless";import*as i2 from"./angulartics2-token";var Angulartics2=function(){function e(e,t){var r=this;this.tracker=e,this.pageTrack=new ReplaySubject(10),this.eventTrack=new ReplaySubject(10),this.exceptionTrack=new ReplaySubject(10),this.setAlias=new ReplaySubject(10),this.setUsername=new ReplaySubject(10),this.setUserProperties=new ReplaySubject(10),this.setUserPropertiesOnce=new ReplaySubject(10),this.setSuperProperties=new ReplaySubject(10),this.setSuperPropertiesOnce=new ReplaySubject(10),this.userTimings=new ReplaySubject(10);var a=new DefaultConfig;this.settings=__assign(__assign({},a),t.settings),this.settings.pageTracking=__assign(__assign({},a.pageTracking),t.settings.pageTracking),this.tracker.trackLocation(this.settings).subscribe(function(e){return r.trackUrlChange(e.url)})}return e.prototype.filterDeveloperMode=function(){var e=this;return filter(function(t,r){return!e.settings.developerMode})},e.prototype.trackUrlChange=function(e){if(this.settings.pageTracking.autoTrackVirtualPages&&!this.matchesExcludedRoute(e)){var t=this.clearUrl(e),r=void 0;r=this.settings.pageTracking.basePath.length?this.settings.pageTracking.basePath+t:this.tracker.prepareExternalUrl(t),this.pageTrack.next({path:r})}},e.prototype.matchesExcludedRoute=function(e){var t,r;try{for(var a=__values(this.settings.pageTracking.excludedRoutes),i=a.next();!i.done;i=a.next()){var n=i.value;if(n instanceof RegExp&&n.test(e)||-1!==e.indexOf(n))return!0}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return!1},e.prototype.clearUrl=function(e){var t=this;return this.settings.pageTracking.clearIds||this.settings.pageTracking.clearQueryParams||this.settings.pageTracking.clearHash?e.split("/").map(function(e){return t.settings.pageTracking.clearQueryParams?e.split("?")[0]:e}).map(function(e){return t.settings.pageTracking.clearHash?e.split("#")[0]:e}).filter(function(e){return!t.settings.pageTracking.clearIds||!e.match(t.settings.pageTracking.idsRegExp)}).join("/"):e},e.ctorParameters=function(){return[{type:RouterlessTracking},{type:void 0,decorators:[{type:Inject,args:[ANGULARTICS2_TOKEN]}]}]},e.ɵprov=i0.ɵɵdefineInjectable({factory:function(){return new e(i0.ɵɵinject(i1.RouterlessTracking),i0.ɵɵinject(i2.ANGULARTICS2_TOKEN))},token:e,providedIn:"root"}),e=__decorate([Injectable({providedIn:"root"}),__param(1,Inject(ANGULARTICS2_TOKEN))],e)}();export{Angulartics2};