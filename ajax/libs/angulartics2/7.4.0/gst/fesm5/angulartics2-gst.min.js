import{__assign,__values}from"tslib";import{Injectable,defineInjectable,inject}from"@angular/core";import{Angulartics2}from"angulartics2";var GoogleGlobalSiteTagDefaults=function(){return function(){var t=this;this.trackingIds=[],"undefined"!=typeof ga&&ga&&ga(function(){ga.getAll().forEach(function(e){var n=e.get("trackingId");void 0!==n&&-1===t.trackingIds.indexOf(n)&&t.trackingIds.push(n)})})}}(),Angulartics2GoogleGlobalSiteTag=function(){function t(t){this.angulartics2=t,this.dimensionsAndMetrics={};var e=new GoogleGlobalSiteTagDefaults;this.angulartics2.settings.gst=__assign({},e,this.angulartics2.settings.gst)}return t.prototype.startTracking=function(){var t=this;this.angulartics2.pageTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.pageTrack(e.path)}),this.angulartics2.eventTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.eventTrack(e.action,e.properties)}),this.angulartics2.exceptionTrack.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.exceptionTrack(e)}),this.angulartics2.userTimings.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.userTimings(t.convertTimings(e))}),this.angulartics2.setUsername.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.setUsername(e)}),this.angulartics2.setUserProperties.pipe(this.angulartics2.filterDeveloperMode()).subscribe(function(e){return t.setUserProperties(e)})},t.prototype.pageTrack=function(t){var e,n;if("undefined"!=typeof gtag&&gtag){var i=__assign({page_path:t,page_location:window.location.protocol+"//"+window.location.host+t},this.dimensionsAndMetrics);this.angulartics2.settings.gst.customMap&&(i.custom_map=this.angulartics2.settings.gst.customMap),this.angulartics2.settings.gst.userId&&(i.user_id=this.angulartics2.settings.gst.userId),this.angulartics2.settings.gst.anonymizeIp&&(i.anonymize_ip=this.angulartics2.settings.gst.anonymizeIp);try{for(var r=__values(this.angulartics2.settings.gst.trackingIds),s=r.next();!s.done;s=r.next()){var a=s.value;gtag("config",a,__assign({},i))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},t.prototype.eventTrack=function(t,e){void 0===e&&(e={}),this.eventTrackInternal(t,__assign({event_category:e.category||"interaction",event_label:e.label,value:e.value,non_interaction:e.noninteraction},e.gstCustom))},t.prototype.exceptionTrack=function(t){void 0===t.fatal&&(console.log('No "fatal" provided, sending with fatal=true'),t.fatal=!0),t.exDescription=t.event?t.event.stack:t.description,this.eventTrack("exception",{gstCustom:__assign({description:t.exDescription,fatal:t.fatal},t.gstCustom)})},t.prototype.userTimings=function(t){t?this.eventTrackInternal("timing_complete",{name:t.name,value:t.value,event_category:t.category,event_label:t.label}):console.error('User timings - "properties" parameter is required to be set.')},t.prototype.convertTimings=function(t){return{name:t.timingVar,value:t.timingValue,category:t.timingCategory,label:t.timingLabel}},t.prototype.setUsername=function(t){var e,n;if(this.angulartics2.settings.gst.userId=t,"undefined"!=typeof gtag&&gtag)try{for(var i=__values(this.angulartics2.settings.gst.trackingIds),r=i.next();!r.done;r=i.next()){var s=r.value;gtag("set",s,{user_id:"string"==typeof t?t:t.userId})}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.setUserProperties=function(t){this.setDimensionsAndMetrics(t)},t.prototype.setDimensionsAndMetrics=function(t){var e,n,i=this;if(this.dimensionsAndMetrics=__assign({},this.dimensionsAndMetrics,t),Object.keys(this.dimensionsAndMetrics).forEach(function(t){var e=i.dimensionsAndMetrics[t];null==e&&delete i.dimensionsAndMetrics[t]}),"undefined"!=typeof gtag&&gtag)try{for(var r=__values(this.angulartics2.settings.gst.trackingIds),s=r.next();!s.done;s=r.next()){var a=s.value;gtag("set",a,this.dimensionsAndMetrics)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.eventTrackInternal=function(t,e){void 0===e&&(e={}),this.cleanProperties(e),"undefined"!=typeof gtag&&gtag&&gtag("event",t,e)},t.prototype.cleanProperties=function(t){if(t.value){var e=parseInt(t.value,10);t.value=isNaN(e)?0:e}},t.decorators=[{type:Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:Angulartics2}]},t.ngInjectableDef=defineInjectable({factory:function(){return new t(inject(Angulartics2))},token:t,providedIn:"root"}),t}();export{GoogleGlobalSiteTagDefaults,Angulartics2GoogleGlobalSiteTag};