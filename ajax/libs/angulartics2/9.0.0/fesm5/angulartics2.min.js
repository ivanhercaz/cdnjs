import{__assign,__values,__decorate,__param}from"tslib";import{InjectionToken,Inject,ɵɵdefineInjectable,ɵɵinject,Injectable,ElementRef,Renderer2,Input,Directive,NgModule}from"@angular/core";import{BehaviorSubject,ReplaySubject}from"rxjs";import{filter,map,delay}from"rxjs/operators";import{Location}from"@angular/common";import{NavigationEnd,Router}from"@angular/router";var DefaultConfig=function(){return function(){this.pageTracking={autoTrackVirtualPages:!0,basePath:"",excludedRoutes:[],clearIds:!1,clearHash:!1,clearQueryParams:!1,idsRegExp:/^\d+$|^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/},this.developerMode=!1,this.ga={},this.appInsights={},this.gtm={},this.gst={}}}(),ANGULARTICS2_TOKEN=new InjectionToken("ANGULARTICS2"),RouterlessTracking=function(){function t(){}return t.prototype.trackLocation=function(t){return new BehaviorSubject({url:"/"})},t.prototype.prepareExternalUrl=function(t){return t},t}(),Angulartics2=function(){function t(t,e){var r=this;this.tracker=t,this.pageTrack=new ReplaySubject(10),this.eventTrack=new ReplaySubject(10),this.exceptionTrack=new ReplaySubject(10),this.setAlias=new ReplaySubject(10),this.setUsername=new ReplaySubject(10),this.setUserProperties=new ReplaySubject(10),this.setUserPropertiesOnce=new ReplaySubject(10),this.setSuperProperties=new ReplaySubject(10),this.setSuperPropertiesOnce=new ReplaySubject(10),this.userTimings=new ReplaySubject(10);var n=new DefaultConfig;this.settings=__assign(__assign({},n),e.settings),this.settings.pageTracking=__assign(__assign({},n.pageTracking),e.settings.pageTracking),this.tracker.trackLocation(this.settings).subscribe(function(t){return r.trackUrlChange(t.url)})}return t.prototype.filterDeveloperMode=function(){var t=this;return filter(function(e,r){return!t.settings.developerMode})},t.prototype.trackUrlChange=function(t){if(this.settings.pageTracking.autoTrackVirtualPages&&!this.matchesExcludedRoute(t)){var e=this.clearUrl(t),r=void 0;r=this.settings.pageTracking.basePath.length?this.settings.pageTracking.basePath+e:this.tracker.prepareExternalUrl(e),this.pageTrack.next({path:r})}},t.prototype.matchesExcludedRoute=function(t){var e,r;try{for(var n=__values(this.settings.pageTracking.excludedRoutes),a=n.next();!a.done;a=n.next()){var i=a.value;if(i instanceof RegExp&&i.test(t)||-1!==t.indexOf(i))return!0}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1},t.prototype.clearUrl=function(t){var e=this;return this.settings.pageTracking.clearIds||this.settings.pageTracking.clearQueryParams||this.settings.pageTracking.clearHash?t.split("/").map(function(t){return e.settings.pageTracking.clearQueryParams?t.split("?")[0]:t}).map(function(t){return e.settings.pageTracking.clearHash?t.split("#")[0]:t}).filter(function(t){return!e.settings.pageTracking.clearIds||!t.match(e.settings.pageTracking.idsRegExp)}).join("/"):t},t.ctorParameters=function(){return[{type:RouterlessTracking},{type:void 0,decorators:[{type:Inject,args:[ANGULARTICS2_TOKEN]}]}]},t.ɵprov=ɵɵdefineInjectable({factory:function(){return new t(ɵɵinject(RouterlessTracking),ɵɵinject(ANGULARTICS2_TOKEN))},token:t,providedIn:"root"}),t=__decorate([Injectable({providedIn:"root"}),__param(1,Inject(ANGULARTICS2_TOKEN))],t)}(),AngularRouterTracking=function(){function t(t,e){this.router=t,this.location=e}return t.prototype.trackLocation=function(t){return this.router.events.pipe(filter(function(t){return t instanceof NavigationEnd}),filter(function(){return!t.developerMode}),map(function(t){return{url:t.urlAfterRedirects}}),delay(0))},t.prototype.prepareExternalUrl=function(t){return this.location.prepareExternalUrl(t)},t.ctorParameters=function(){return[{type:Router},{type:Location}]},t.ɵprov=ɵɵdefineInjectable({factory:function(){return new t(ɵɵinject(Router),ɵɵinject(Location))},token:t,providedIn:"root"}),t=__decorate([Injectable({providedIn:"root"})],t)}(),Angulartics2On=function(){function t(t,e,r){this.elRef=t,this.angulartics2=e,this.renderer=r,this.angularticsProperties={}}return t.prototype.ngAfterContentInit=function(){var t=this;this.renderer.listen(this.elRef.nativeElement,this.angulartics2On||"click",function(e){return t.eventTrack(e)})},t.prototype.eventTrack=function(t){var e=this.angularticsAction,r=__assign(__assign({},this.angularticsProperties),{eventType:t.type});this.angularticsCategory&&(r.category=this.angularticsCategory),this.angularticsLabel&&(r.label=this.angularticsLabel),this.angularticsValue&&(r.value=this.angularticsValue),this.angulartics2.eventTrack.next({action:e,properties:r})},t.ctorParameters=function(){return[{type:ElementRef},{type:Angulartics2},{type:Renderer2}]},__decorate([Input("angulartics2On")],t.prototype,"angulartics2On",void 0),__decorate([Input()],t.prototype,"angularticsAction",void 0),__decorate([Input()],t.prototype,"angularticsCategory",void 0),__decorate([Input()],t.prototype,"angularticsLabel",void 0),__decorate([Input()],t.prototype,"angularticsValue",void 0),__decorate([Input()],t.prototype,"angularticsProperties",void 0),t=__decorate([Directive({selector:"[angulartics2On]"})],t)}(),Angulartics2OnModule=function(){function t(){}return t=__decorate([NgModule({declarations:[Angulartics2On],exports:[Angulartics2On]})],t)}(),Angulartics2Module=function(){function t(){}var e;return e=t,t.forRoot=function(t){return void 0===t&&(t={}),{ngModule:e,providers:[{provide:ANGULARTICS2_TOKEN,useValue:{settings:t}},{provide:RouterlessTracking,useClass:AngularRouterTracking},Angulartics2]}},t=e=__decorate([NgModule({imports:[Angulartics2OnModule],exports:[Angulartics2On]})],t)}();export{ANGULARTICS2_TOKEN,AngularRouterTracking,Angulartics2,Angulartics2Module,Angulartics2On,Angulartics2OnModule,DefaultConfig,RouterlessTracking};