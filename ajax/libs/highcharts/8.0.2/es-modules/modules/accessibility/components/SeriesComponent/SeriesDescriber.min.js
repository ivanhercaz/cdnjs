"use strict";import H from"../../../../parts/Globals.js";var numberFormat=H.numberFormat,format=H.format;import U from"../../../../parts/Utilities.js";var find=U.find,isNumber=U.isNumber,pick=U.pick,defined=U.defined;import AnnotationsA11y from"../AnnotationsA11y.js";var getPointAnnotationTexts=AnnotationsA11y.getPointAnnotationTexts;import HTMLUtilities from"../../utils/htmlUtilities.js";var escapeStringForHTML=HTMLUtilities.escapeStringForHTML,reverseChildNodes=HTMLUtilities.reverseChildNodes,stripHTMLTags=HTMLUtilities.stripHTMLTagsFromString;import ChartUtilities from"../../utils/chartUtilities.js";var getAxisDescription=ChartUtilities.getAxisDescription,getSeriesFirstPointElement=ChartUtilities.getSeriesFirstPointElement,getSeriesA11yElement=ChartUtilities.getSeriesA11yElement,unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import Tooltip from"../../../../parts/Tooltip.js";function findFirstPointWithGraphic(i){var e=i.index;return i.series&&i.series.data&&defined(e)&&find(i.series.data,function(i){return!!(i&&void 0!==i.index&&i.index>e&&i.graphic&&i.graphic.element)})||null}function shouldAddDummyPoint(i){var e=i.series&&i.series.is("sunburst");return i.isNull&&!e}function makeDummyElement(i,e){var t=i.series.chart.renderer.rect(e.x,e.y,1,1);return t.attr({class:"highcharts-a11y-dummy-point",fill:"none",opacity:0,"fill-opacity":0,"stroke-opacity":0}),t}function addDummyPointElement(i){var e=i.series,t=findFirstPointWithGraphic(i),r=t&&t.graphic,s=r?r.parentGroup:e.graph||e.group,n=makeDummyElement(i,t?{x:pick(i.plotX,t.plotX,0),y:pick(i.plotY,t.plotY,0)}:{x:pick(i.plotX,0),y:pick(i.plotY,0)});if(s&&s.element)return i.graphic=n,i.hasDummyGraphic=!0,n.add(s),s.element.insertBefore(n.element,r?r.element:null),n.element}function hasMorePointsThanDescriptionThreshold(i){var e=i.chart.options.accessibility.series.pointDescriptionEnabledThreshold;return!!(!1!==e&&i.points&&i.points.length>=e)}function shouldSetScreenReaderPropsOnPoints(i){var e=i.options.accessibility||{};return!hasMorePointsThanDescriptionThreshold(i)&&!e.exposeAsGroupOnly}function shouldSetKeyboardNavPropsOnPoints(i){var e=i.chart.options.accessibility.keyboardNavigation.seriesNavigation;return!(!i.points||!(i.points.length<e.pointNavigationEnabledThreshold||!1===e.pointNavigationEnabledThreshold))}function shouldDescribeSeriesElement(i){var e=i.chart,t=e.options.chart||{},r=t.options3d&&t.options3d.enabled,s=e.series.length>1,n=e.options.accessibility.series.describeSingleSeries,o=(i.options.accessibility||{}).exposeAsGroupOnly;return!(r&&s)&&(s||n||o||hasMorePointsThanDescriptionThreshold(i))}function pointNumberToString(i,e){var t=i.series.chart,r=t.options.accessibility.point||{},s=i.series.tooltipOptions||{},n=t.options.lang;return isNumber(e)?numberFormat(e,r.valueDecimals||s.valueDecimals||-1,n.decimalPoint,n.accessibility.thousandsSep||n.thousandsSep):e}function getSeriesDescriptionText(i){var e=(i.options.accessibility||{}).description;return e&&i.chart.langFormat("accessibility.series.description",{description:e,series:i})||""}function getSeriesAxisDescriptionText(i,e){var t=i[e];return i.chart.langFormat("accessibility.series."+e+"Description",{name:getAxisDescription(t),series:i})}function getPointA11yTimeDescription(i){var e=i.series,t=e.chart,r=t.options.accessibility.point||{};if(e.xAxis&&e.xAxis.isDatetimeAxis){var s=Tooltip.prototype.getXDateFormat.call({getDateFormat:Tooltip.prototype.getDateFormat,chart:t},i,t.options.tooltip,e.xAxis),n=r.dateFormatter&&r.dateFormatter(i)||r.dateFormat||s;return t.time.dateFormat(n,i.x,void 0)}}function getPointXDescription(i){var e=getPointA11yTimeDescription(i),t=(i.series.xAxis||{}).categories&&defined(i.category)&&(""+i.category).replace("<br/>"," "),r=i.id&&i.id.indexOf("highcharts-")<0,s="x, "+i.x;return i.name||e||t||(r?i.id:s)}function getPointArrayMapValueDescription(i,e,t){var r=e||"",s=t||"";return i.series.pointArrayMap.reduce(function(e,t){return e+(e.length?", ":"")+function(e){var t=pointNumberToString(i,pick(i[e],i.options[e]));return e+": "+r+t+s}(t)},"")}function getPointValue(i){var e=i.series,t=e.chart.options.accessibility.point||{},r=e.tooltipOptions||{},s=t.valuePrefix||r.valuePrefix||"",n=t.valueSuffix||r.valueSuffix||"",o=pointNumberToString(i,i[void 0!==i.value?"value":"y"]);return i.isNull?e.chart.langFormat("accessibility.series.nullPointValue",{point:i}):e.pointArrayMap?getPointArrayMapValueDescription(i,s,n):s+o+n}function getPointAnnotationDescription(i){var e=i.series.chart,t=getPointAnnotationTexts(i),r={point:i,annotations:t};return t.length?e.langFormat("accessibility.series.pointAnnotationsDescription",r):""}function getPointValueDescription(i){var e=i.series,t=e.chart,r=t.options.accessibility.point.valueDescriptionFormat,s=pick(e.xAxis&&e.xAxis.options.accessibility&&e.xAxis.options.accessibility.enabled,!t.angular),n=s?getPointXDescription(i):"",o={point:i,index:defined(i.index)?i.index+1:"",xDescription:n,value:getPointValue(i),separator:s?", ":""};return format(r,o,t)}function defaultPointDescriptionFormatter(i){var e=i.series,t=e.chart,r=getPointValueDescription(i),s=i.options&&i.options.accessibility&&i.options.accessibility.description,n=s?" "+s:"",o=t.series.length>1&&e.name?" "+e.name+".":"",a=getPointAnnotationDescription(i),c=a?" "+a:"";return i.accessibility=i.accessibility||{},i.accessibility.valueDescription=r,r+n+o+c}function setPointScreenReaderAttribs(i,e){var t=i.series,r=t.chart.options.accessibility.point||{},s=t.options.accessibility||{},n=escapeStringForHTML(stripHTMLTags(s.pointDescriptionFormatter&&s.pointDescriptionFormatter(i)||r.descriptionFormatter&&r.descriptionFormatter(i)||defaultPointDescriptionFormatter(i)));e.setAttribute("role","img"),e.setAttribute("aria-label",n)}function describePointsInSeries(i){var e=shouldSetScreenReaderPropsOnPoints(i),t=shouldSetKeyboardNavPropsOnPoints(i);(e||t)&&i.points.forEach(function(i){var t=i.graphic&&i.graphic.element||shouldAddDummyPoint(i)&&addDummyPointElement(i);t&&(t.setAttribute("tabindex","-1"),e?setPointScreenReaderAttribs(i,t):t.setAttribute("aria-hidden",!0))})}function defaultSeriesDescriptionFormatter(i){var e=i.chart,t=e.types||[],r=getSeriesDescriptionText(i),s=function(t){return e[t]&&e[t].length>1&&i[t]},n=getSeriesAxisDescriptionText(i,"xAxis"),o=getSeriesAxisDescriptionText(i,"yAxis"),a={name:i.name||"",ix:i.index+1,numSeries:e.series&&e.series.length,numPoints:i.points&&i.points.length,series:i},c=t.length>1?"Combination":"";return(e.langFormat("accessibility.series.summary."+i.type+c,a)||e.langFormat("accessibility.series.summary.default"+c,a))+(r?" "+r:"")+(s("yAxis")?" "+o:"")+(s("xAxis")?" "+n:"")}function describeSeriesElement(i,e){var t=i.options.accessibility||{},r=i.chart.options.accessibility,s=r.landmarkVerbosity;t.exposeAsGroupOnly?e.setAttribute("role","img"):"all"===s&&e.setAttribute("role","region"),e.setAttribute("tabindex","-1"),e.setAttribute("aria-label",escapeStringForHTML(stripHTMLTags(r.series.descriptionFormatter&&r.series.descriptionFormatter(i)||defaultSeriesDescriptionFormatter(i))))}function describeSeries(i){var e=i.chart,t=getSeriesFirstPointElement(i),r=getSeriesA11yElement(i),s=e.is3d&&e.is3d();r&&(r.lastChild!==t||s||reverseChildNodes(r),describePointsInSeries(i),unhideChartElementFromAT(e,r),shouldDescribeSeriesElement(i)?describeSeriesElement(i,r):r.setAttribute("aria-label",""))}var SeriesDescriber={describeSeries:describeSeries,defaultPointDescriptionFormatter:defaultPointDescriptionFormatter,defaultSeriesDescriptionFormatter:defaultSeriesDescriptionFormatter,getPointA11yTimeDescription:getPointA11yTimeDescription,getPointXDescription:getPointXDescription,getPointValue:getPointValue,getPointValueDescription:getPointValueDescription};export default SeriesDescriber;