"use strict";import H from"./Globals.js";import U from"./Utilities.js";var clamp=U.clamp,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick,fireEvent=H.fireEvent,deg2rad=H.deg2rad,Tick=function(){function t(t,e,i,s,a){this.isNew=!0,this.isNewLabel=!0,this.axis=t,this.pos=e,this.type=i||"",this.parameters=a||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,i||s||this.addLabel()}return t.prototype.addLabel=function(){var t,e,i,s,a,r=this,o=r.axis,l=o.options,h=o.chart,n=o.categories,d=o.names,c=r.pos,p=pick(r.options&&r.options.labels,l.labels),f=o.tickPositions,b=c===f[0],x=c===f[f.length-1],m=this.parameters.category||(n?pick(n[c],d[c],c):c),y=r.label,k=(!p.step||1===p.step)&&1===o.tickInterval,g=f.info;o.isDatetimeAxis&&g&&(e=(i=h.time.resolveDTLFormat(l.dateTimeLabelFormats[!l.grid&&g.higherRanks[c]||g.unitName])).main),r.isFirst=b,r.isLast=x,r.formatCtx={axis:o,chart:h,isFirst:b,isLast:x,dateTimeLabelFormat:e,tickPositionInfo:g,value:o.isLog?correctFloat(o.lin2log(m)):m,pos:c},t=o.labelFormatter.call(r.formatCtx,this.formatCtx),(a=i&&i.list)&&(r.shortenLabel=function(){for(s=0;s<a.length;s++)if(y.attr({text:o.labelFormatter.call(extend(r.formatCtx,{dateTimeLabelFormat:a[s]}))}),y.getBBox().width<o.getSlotWidth(r)-2*pick(p.padding,5))return;y.attr({text:""})}),k&&o._addedPlotLB&&o.isXAxis&&r.moveLabel(t,p),defined(y)||r.movedLabel?y&&y.textStr!==t&&!k&&(!y.textWidth||p.style&&p.style.width||y.styles.width||y.css({width:null}),y.attr({text:t}),y.textPxLength=y.getBBox().width):(r.label=y=r.createLabel({x:0,y:0},t,p),r.rotation=0)},t.prototype.createLabel=function(t,e,i){var s=this.axis,a=s.chart,r=defined(e)&&i.enabled?a.renderer.text(e,t.x,t.y,i.useHTML).add(s.labelGroup):null;return r&&(a.styledMode||r.css(merge(i.style)),r.textPxLength=r.getBBox().width),r},t.prototype.destroy=function(){destroyObjectProperties(this,this.axis)},t.prototype.getPosition=function(t,e,i,s){var a,r=this.axis,o=r.chart,l=s&&o.oldChartHeight||o.chartHeight;return(a={x:t?correctFloat(r.translate(e+i,null,null,s)+r.transB):r.left+r.offset+(r.opposite?(s&&o.oldChartWidth||o.chartWidth)-r.right-r.left:0),y:t?l-r.bottom+r.offset-(r.opposite?r.height:0):correctFloat(l-r.translate(e+i,null,null,s)-r.transB)}).y=clamp(a.y,-1e5,1e5),fireEvent(this,"afterGetPosition",{pos:a}),a},t.prototype.getLabelPosition=function(t,e,i,s,a,r,o,l){var h,n=this.axis,d=n.transA,c=n.isLinked&&n.linkedParent?n.linkedParent.reversed:n.reversed,p=n.staggerLines,f=n.tickRotCorr||{x:0,y:0},b=a.y,x=s||n.reserveSpaceDefault?0:-n.labelOffset*("center"===n.labelAlign?.5:1),m={};return defined(b)||(b=0===n.side?i.rotation?-8:-i.getBBox().height:2===n.side?f.y+8:Math.cos(i.rotation*deg2rad)*(f.y-i.getBBox(!1,0).height/2)),t=t+a.x+x+f.x-(r&&s?r*d*(c?-1:1):0),e=e+b-(r&&!s?r*d*(c?1:-1):0),p&&(h=o/(l||1)%p,n.opposite&&(h=p-h-1),e+=h*(n.labelOffset/p)),m.x=t,m.y=Math.round(e),fireEvent(this,"afterGetLabelPosition",{pos:m,tickmarkOffset:r,index:o}),m},t.prototype.getLabelSize=function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},t.prototype.getMarkPath=function(t,e,i,s,a,r){return r.crispLine(["M",t,e,"L",t+(a?0:-i),e+(a?i:0)],s)},t.prototype.handleOverflow=function(t){var e,i,s=this.axis,a=s.options.labels,r=t.x,o=s.chart.chartWidth,l=s.chart.spacing,h=pick(s.labelLeft,Math.min(s.pos,l[3])),n=pick(s.labelRight,Math.max(s.isRadial?0:s.pos+s.len,o-l[1])),d=this.label,c=this.rotation,p={left:0,center:.5,right:1}[s.labelAlign||d.attr("align")],f=d.getBBox().width,b=s.getSlotWidth(this),x=b,m=p,y=1,k={};c||"justify"!==pick(a.overflow,"justify")?c<0&&r-p*f<h?i=Math.round(r/Math.cos(c*deg2rad)-h):c>0&&r+p*f>n&&(i=Math.round((o-r)/Math.cos(c*deg2rad))):(e=r+(1-p)*f,r-p*f<h?x=t.x+x*(1-p)-h:e>n&&(x=n-t.x+x*p,y=-1),(x=Math.min(b,x))<b&&"center"===s.labelAlign&&(t.x+=y*(b-x-m*(b-Math.min(f,x)))),(f>x||s.autoRotation&&(d.styles||{}).width)&&(i=x)),i&&(this.shortenLabel?this.shortenLabel():(k.width=Math.floor(i),(a.style||{}).textOverflow||(k.textOverflow="ellipsis"),d.css(k)))},t.prototype.moveLabel=function(t,e){var i,s,a,r=this,o=r.label,l=!1,h=r.axis,n=h.chart,d=h.reversed,c=n.inverted;o&&o.textStr===t?(r.movedLabel=o,l=!0,delete r.label):objectEach(h.ticks,function(e){l||e.isNew||e===r||!e.label||e.label.textStr!==t||(r.movedLabel=e.label,l=!0,e.labelPos=r.movedLabel.xy,delete e.label)}),l||!r.labelPos&&!o||(i=r.labelPos||o.xy,s=c?i.x:d?0:h.width+h.left,a=c?d?h.width+h.left:0:i.y,r.movedLabel=r.createLabel({x:s,y:a},t,e),r.movedLabel&&r.movedLabel.attr({opacity:0}))},t.prototype.render=function(t,e,i){var s=this.axis,a=s.horiz,r=this.pos,o=pick(this.tickmarkOffset,s.tickmarkOffset),l=this.getPosition(a,r,o,e),h=l.x,n=l.y,d=a&&h===s.pos+s.len||!a&&n===s.pos?-1:1;i=pick(i,1),this.isActive=!0,this.renderGridLine(e,i,d),this.renderMark(l,i,d),this.renderLabel(l,e,i,t),this.isNew=!1,H.fireEvent(this,"afterRender")},t.prototype.renderGridLine=function(t,e,i){var s,a=this.axis,r=a.options,o=this.gridLine,l={},h=this.pos,n=this.type,d=pick(this.tickmarkOffset,a.tickmarkOffset),c=a.chart.renderer,p=n?n+"Grid":"grid",f=r[p+"LineWidth"],b=r[p+"LineColor"],x=r[p+"LineDashStyle"];o||(a.chart.styledMode||(l.stroke=b,l["stroke-width"]=f,x&&(l.dashstyle=x)),n||(l.zIndex=1),t&&(e=0),this.gridLine=o=c.path().attr(l).addClass("highcharts-"+(n?n+"-":"")+"grid-line").add(a.gridGroup)),o&&(s=a.getPlotLinePath({value:h+d,lineWidth:o.strokeWidth()*i,force:"pass",old:t}))&&o[t||this.isNew?"attr":"animate"]({d:s,opacity:e})},t.prototype.renderMark=function(t,e,i){var s=this.axis,a=s.options,r=s.chart.renderer,o=this.type,l=o?o+"Tick":"tick",h=s.tickSize(l),n=this.mark,d=!n,c=t.x,p=t.y,f=pick(a[l+"Width"],!o&&s.isXAxis?1:0),b=a[l+"Color"];h&&(s.opposite&&(h[0]=-h[0]),d&&(this.mark=n=r.path().addClass("highcharts-"+(o?o+"-":"")+"tick").add(s.axisGroup),s.chart.styledMode||n.attr({stroke:b,"stroke-width":f})),n[d?"attr":"animate"]({d:this.getMarkPath(c,p,h[0],n.strokeWidth()*i,s.horiz,r),opacity:e}))},t.prototype.renderLabel=function(t,e,i,s){var a=this.axis,r=a.horiz,o=a.options,l=this.label,h=o.labels,n=h.step,d=pick(this.tickmarkOffset,a.tickmarkOffset),c=!0,p=t.x,f=t.y;l&&isNumber(p)&&(l.xy=t=this.getLabelPosition(p,f,l,r,h,d,s,n),this.isFirst&&!this.isLast&&!pick(o.showFirstLabel,1)||this.isLast&&!this.isFirst&&!pick(o.showLastLabel,1)?c=!1:!r||h.step||h.rotation||e||0===i||this.handleOverflow(t),n&&s%n&&(c=!1),c&&isNumber(t.y)?(t.opacity=i,l[this.isNewLabel?"attr":"animate"](t),this.isNewLabel=!1):(l.attr("y",-9999),this.isNewLabel=!0))},t.prototype.replaceMovedLabel=function(){var t,e,i=this.label,s=this.axis,a=s.reversed,r=this.axis.chart.inverted;i&&!this.isNew&&(t=r?i.xy.x:a?s.left:s.width+s.left,e=r?a?s.width+s.top:s.top:i.xy.y,i.animate({x:t,y:e,opacity:0},void 0,i.destroy),delete this.label),s.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel},t}();H.Tick=Tick;export default H.Tick;