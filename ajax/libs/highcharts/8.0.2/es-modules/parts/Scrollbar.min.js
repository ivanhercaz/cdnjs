"use strict";import H from"./Globals.js";import U from"./Utilities.js";var addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent;import"./Axis.js";import"./Options.js";var swapXY,Axis=H.Axis,defaultOptions=H.defaultOptions,hasTouch=H.hasTouch,isTouchDevice=H.isTouchDevice,defaultScrollbarOptions={height:isTouchDevice?20:14,barBorderRadius:0,buttonBorderRadius:0,liveRedraw:void 0,margin:10,minWidth:6,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:1,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"#333333",trackBackgroundColor:"#f2f2f2",trackBorderColor:"#f2f2f2",trackBorderWidth:1};defaultOptions.scrollbar=merge(!0,defaultScrollbarOptions,defaultOptions.scrollbar),H.swapXY=swapXY=function(t,i){var r,s,o=t.length;if(i)for(r=0;r<o;r+=3)s=t[r+1],t[r+1]=t[r+2],t[r+2]=s;return t};var Scrollbar=function(){function t(t,i,r){this._events=[],this.chartX=0,this.chartY=0,this.from=0,this.group=void 0,this.scrollbar=void 0,this.scrollbarButtons=[],this.scrollbarGroup=void 0,this.scrollbarLeft=0,this.scrollbarRifles=void 0,this.scrollbarStrokeWidth=1,this.scrollbarTop=0,this.size=0,this.to=0,this.track=void 0,this.trackBorderWidth=1,this.userOptions={},this.x=0,this.y=0,this.chart=r,this.options=i,this.renderer=r.renderer,this.init(t,i,r)}return t.prototype.addEvents=function(){var t,i=this.options.inverted?[1,0]:[0,1],r=this.scrollbarButtons,s=this.scrollbarGroup.element,o=this.track.element,h=this.mouseDownHandler.bind(this),e=this.mouseMoveHandler.bind(this),a=this.mouseUpHandler.bind(this);t=[[r[i[0]].element,"click",this.buttonToMinClick.bind(this)],[r[i[1]].element,"click",this.buttonToMaxClick.bind(this)],[o,"click",this.trackClick.bind(this)],[s,"mousedown",h],[s.ownerDocument,"mousemove",e],[s.ownerDocument,"mouseup",a]],hasTouch&&t.push([s,"touchstart",h],[s.ownerDocument,"touchmove",e],[s.ownerDocument,"touchend",a]),t.forEach(function(t){addEvent.apply(null,t)}),this._events=t},t.prototype.buttonToMaxClick=function(t){var i=(this.to-this.from)*pick(this.options.step,.2);this.updatePosition(this.from+i,this.to+i),fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:t})},t.prototype.buttonToMinClick=function(t){var i=correctFloat(this.to-this.from)*pick(this.options.step,.2);this.updatePosition(correctFloat(this.from-i),correctFloat(this.to-i)),fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:t})},t.prototype.cursorToScrollbarPosition=function(t){var i=this.options,r=i.minWidth>this.calculatedWidth?i.minWidth:0;return{chartX:(t.chartX-this.x-this.xOffset)/(this.barWidth-r),chartY:(t.chartY-this.y-this.yOffset)/(this.barWidth-r)}},t.prototype.destroy=function(){var t=this.chart.scroller;this.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(t){this[t]&&this[t].destroy&&(this[t]=this[t].destroy())},this),t&&this===t.scrollbar&&(t.scrollbar=null,destroyObjectProperties(t.scrollbarButtons))},t.prototype.drawScrollbarButton=function(t){var i,r,s=this.renderer,o=this.scrollbarButtons,h=this.options,e=this.size;i=s.g().add(this.group),o.push(i),r=s.rect().addClass("highcharts-scrollbar-button").add(i),this.chart.styledMode||r.attr({stroke:h.buttonBorderColor,"stroke-width":h.buttonBorderWidth,fill:h.buttonBackgroundColor}),r.attr(r.crisp({x:-.5,y:-.5,width:e+1,height:e+1,r:h.buttonBorderRadius},r.strokeWidth())),r=s.path(swapXY(["M",e/2+(t?-1:1),e/2-3,"L",e/2+(t?-1:1),e/2+3,"L",e/2+(t?2:-2),e/2],h.vertical)).addClass("highcharts-scrollbar-arrow").add(o[t]),this.chart.styledMode||r.attr({fill:h.buttonArrowColor})},t.prototype.init=function(t,i,r){this.scrollbarButtons=[],this.renderer=t,this.userOptions=i,this.options=merge(defaultScrollbarOptions,i),this.chart=r,this.size=pick(this.options.size,this.options.height),i.enabled&&(this.render(),this.addEvents())},t.prototype.mouseDownHandler=function(t){var i=this.chart.pointer.normalize(t),r=this.cursorToScrollbarPosition(i);this.chartX=r.chartX,this.chartY=r.chartY,this.initPositions=[this.from,this.to],this.grabbedCenter=!0},t.prototype.mouseMoveHandler=function(t){var i,r=this.chart.pointer.normalize(t),s=this.options.vertical?"chartY":"chartX",o=this.initPositions||[];!this.grabbedCenter||t.touches&&0===t.touches[0][s]||(i=this.cursorToScrollbarPosition(r)[s]-this[s],this.hasDragged=!0,this.updatePosition(o[0]+i,o[1]+i),this.hasDragged&&fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:t.type,DOMEvent:t}))},t.prototype.mouseUpHandler=function(t){this.hasDragged&&fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:t.type,DOMEvent:t}),this.grabbedCenter=this.hasDragged=this.chartX=this.chartY=null},t.prototype.position=function(t,i,r,s){var o=this.options.vertical,h=s,e=0,a=this.rendered?"animate":"attr";this.x=t,this.y=i+this.trackBorderWidth,this.width=r,this.height=s,this.xOffset=h,this.yOffset=e,o?(this.width=this.yOffset=r=e=this.size,this.xOffset=h=0,this.barWidth=s-2*r,this.x=t+=this.options.margin):(this.height=this.xOffset=s=h=this.size,this.barWidth=r-2*s,this.y=this.y+this.options.margin),this.group[a]({translateX:t,translateY:this.y}),this.track[a]({width:r,height:s}),this.scrollbarButtons[1][a]({translateX:o?0:r-h,translateY:o?s-e:0})},t.prototype.removeEvents=function(){this._events.forEach(function(t){removeEvent.apply(null,t)}),this._events.length=0},t.prototype.render=function(){var t,i=this.renderer,r=this.options,s=this.size,o=this.chart.styledMode;this.group=t=i.g("scrollbar").attr({zIndex:r.zIndex,translateY:-99999}).add(),this.track=i.rect().addClass("highcharts-scrollbar-track").attr({x:0,r:r.trackBorderRadius||0,height:s,width:s}).add(t),o||this.track.attr({fill:r.trackBackgroundColor,stroke:r.trackBorderColor,"stroke-width":r.trackBorderWidth}),this.trackBorderWidth=this.track.strokeWidth(),this.track.attr({y:-this.trackBorderWidth%2/2}),this.scrollbarGroup=i.g().add(t),this.scrollbar=i.rect().addClass("highcharts-scrollbar-thumb").attr({height:s,width:s,r:r.barBorderRadius||0}).add(this.scrollbarGroup),this.scrollbarRifles=i.path(swapXY(["M",-3,s/4,"L",-3,2*s/3,"M",0,s/4,"L",0,2*s/3,"M",3,s/4,"L",3,2*s/3],r.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup),o||(this.scrollbar.attr({fill:r.barBackgroundColor,stroke:r.barBorderColor,"stroke-width":r.barBorderWidth}),this.scrollbarRifles.attr({stroke:r.rifleColor,"stroke-width":1})),this.scrollbarStrokeWidth=this.scrollbar.strokeWidth(),this.scrollbarGroup.translate(-this.scrollbarStrokeWidth%2/2,-this.scrollbarStrokeWidth%2/2),this.drawScrollbarButton(0),this.drawScrollbarButton(1)},t.prototype.setRange=function(t,i){var r,s,o,h,e,a=this.options,n=a.vertical,l=a.minWidth,c=this.barWidth,d=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";defined(c)&&(t=Math.max(t,0),r=Math.ceil(c*t),s=c*Math.min(i,1),this.calculatedWidth=h=correctFloat(s-r),h<l&&(r=(c-l+h)*t,h=l),o=Math.floor(r+this.xOffset+this.yOffset),e=h/2-.5,this.from=t,this.to=i,n?(this.scrollbarGroup[d]({translateY:o}),this.scrollbar[d]({height:h}),this.scrollbarRifles[d]({translateY:e}),this.scrollbarTop=o,this.scrollbarLeft=0):(this.scrollbarGroup[d]({translateX:o}),this.scrollbar[d]({width:h}),this.scrollbarRifles[d]({translateX:e}),this.scrollbarLeft=o,this.scrollbarTop=0),h<=12?this.scrollbarRifles.hide():this.scrollbarRifles.show(!0),!1===a.showFull&&(t<=0&&i>=1?this.group.hide():this.group.show()),this.rendered=!0)},t.prototype.trackClick=function(t){var i=this.chart.pointer.normalize(t),r=this.to-this.from,s=this.y+this.scrollbarTop,o=this.x+this.scrollbarLeft;this.options.vertical&&i.chartY>s||!this.options.vertical&&i.chartX>o?this.updatePosition(this.from+r,this.to+r):this.updatePosition(this.from-r,this.to-r),fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:t})},t.prototype.update=function(t){this.destroy(),this.init(this.chart.renderer,merge(!0,this.options,t),this.chart)},t.prototype.updatePosition=function(t,i){i>1&&(t=correctFloat(1-correctFloat(i-t)),i=1),t<0&&(i=correctFloat(i-t),t=0),this.from=t,this.to=i},t}();H.Scrollbar||(addEvent(Axis,"afterInit",function(){var t=this;t.options&&t.options.scrollbar&&t.options.scrollbar.enabled&&(t.options.scrollbar.vertical=!t.horiz,t.options.startOnTick=t.options.endOnTick=!1,t.scrollbar=new Scrollbar(t.chart.renderer,t.options.scrollbar,t.chart),addEvent(t.scrollbar,"changed",function(i){var r,s,o=Math.min(pick(t.options.min,t.min),t.min,t.dataMin),h=Math.max(pick(t.options.max,t.max),t.max,t.dataMax)-o;t.horiz&&!t.reversed||!t.horiz&&t.reversed?(r=o+h*this.to,s=o+h*this.from):(r=o+h*(1-this.from),s=o+h*(1-this.to)),pick(this.options.liveRedraw,H.svg&&!H.isTouchDevice&&!this.chart.isBoosting)||"mouseup"===i.DOMType||!defined(i.DOMType)?t.setExtremes(s,r,!0,"mousemove"!==i.DOMType,i):this.setRange(this.from,this.to)}))}),addEvent(Axis,"afterRender",function(){var t,i,r,s=Math.min(pick(this.options.min,this.min),this.min,pick(this.dataMin,this.min)),o=Math.max(pick(this.options.max,this.max),this.max,pick(this.dataMax,this.max)),h=this.scrollbar,e=this.axisTitleMargin+(this.titleOffset||0),a=this.chart.scrollbarsOffsets,n=this.options.margin||0;h&&(this.horiz?(this.opposite||(a[1]+=e),h.position(this.left,this.top+this.height+2+a[1]-(this.opposite?n:0),this.width,this.height),this.opposite||(a[1]+=n),t=1):(this.opposite&&(a[0]+=e),h.position(this.left+this.width+2+a[0]-(this.opposite?0:n),this.top,this.width,this.height),this.opposite&&(a[0]+=n),t=0),a[t]+=h.size+h.options.margin,isNaN(s)||isNaN(o)||!defined(this.min)||!defined(this.max)||this.min===this.max?h.setRange(0,1):(i=(this.min-s)/(o-s),r=(this.max-s)/(o-s),this.horiz&&!this.reversed||!this.horiz&&this.reversed?h.setRange(i,r):h.setRange(1-r,1-i)))}),addEvent(Axis,"afterGetOffset",function(){var t=this.horiz?2:1,i=this.scrollbar;i&&(this.chart.scrollbarsOffsets=[0,0],this.chart.axisOffset[t]+=i.size+i.options.margin)}),H.Scrollbar=Scrollbar);export default H.Scrollbar;