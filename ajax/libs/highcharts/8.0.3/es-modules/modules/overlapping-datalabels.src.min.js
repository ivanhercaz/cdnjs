"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,isArray=U.isArray,objectEach=U.objectEach,pick=U.pick;import"../parts/Chart.js";var Chart=H.Chart;addEvent(Chart,"render",function(){var t=[];(this.labelCollectors||[]).forEach(function(a){t=t.concat(a())}),(this.yAxis||[]).forEach(function(a){a.options.stackLabels&&!a.options.stackLabels.allowOverlap&&objectEach(a.stacks,function(a){objectEach(a,function(a){t.push(a.label)})})}),(this.series||[]).forEach(function(a){var e=a.options.dataLabels;a.visible&&(!1!==e.enabled||a._hasPointLabels)&&(a.nodes||a.points).forEach(function(a){a.visible&&(isArray(a.dataLabels)?a.dataLabels:a.dataLabel?[a.dataLabel]:[]).forEach(function(e){var i=e.options;e.labelrank=pick(i.labelrank,a.labelrank,a.shapeArgs&&a.shapeArgs.height),i.allowOverlap||t.push(e)})})}),this.hideOverlappingLabels(t)}),Chart.prototype.hideOverlappingLabels=function(t){var a,e,i,r,n,l,o,s=this,c=t.length,h=s.renderer,p=!1,d=function(t,a){return!(a.x>t.x+t.width||a.x+a.width<t.x||a.y>t.y+t.height||a.y+a.height<t.y)},b=function(t){var a,e,i,r=t.box?0:t.padding||0,n=0;if(t&&(!t.alignAttr||t.placed))return a=t.alignAttr||{x:t.attr("x"),y:t.attr("y")},e=t.parentGroup,t.width||(i=t.getBBox(),t.width=i.width,t.height=i.height,n=h.fontMetrics(null,t.element).h),{x:a.x+(e.translateX||0)+r,y:a.y+(e.translateY||0)+r-n,width:t.width-2*r,height:t.height-2*r}};for(e=0;e<c;e++)(a=t[e])&&(a.oldOpacity=a.opacity,a.newOpacity=1,a.absoluteBox=b(a));for(t.sort(function(t,a){return(a.labelrank||0)-(t.labelrank||0)}),e=0;e<c;e++)for(l=(r=t[e])&&r.absoluteBox,i=e+1;i<c;++i)o=(n=t[i])&&n.absoluteBox,l&&o&&r!==n&&0!==r.newOpacity&&0!==n.newOpacity&&d(l,o)&&((r.labelrank<n.labelrank?r:n).newOpacity=0);t.forEach(function(t){var a,e;t&&(e=t.newOpacity,t.oldOpacity!==e&&(t.alignAttr&&t.placed?(e?t.show(!0):a=function(){t.hide(!0),t.placed=!1},p=!0,t.alignAttr.opacity=e,t[t.isOld?"animate":"attr"](t.alignAttr,null,a),fireEvent(s,"afterHideOverlappingLabel")):t.attr({opacity:e})),t.isOld=!0)}),p&&fireEvent(s,"afterHideAllOverlappingLabels")};