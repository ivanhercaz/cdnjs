"use strict";import H from"../parts/Globals.js";import Tick from"../parts/Tick.js";import U from"../parts/Utilities.js";var addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,extend=U.extend,merge=U.merge,pick=U.pick,pInt=U.pInt,relativeLength=U.relativeLength,wrap=U.wrap;import"../parts/Axis.js";import"./Pane.js";var hiddenAxisMixin,radialAxisMixin,Axis=H.Axis,noop=H.noop,axisProto=Axis.prototype,tickProto=Tick.prototype;hiddenAxisMixin={getOffset:noop,redraw:function(){this.isDirty=!1},render:function(){this.isDirty=!1},createLabelCollector:function(){return!1},setScale:noop,setCategories:noop,setTitle:noop},radialAxisMixin={defaultRadialGaugeOptions:{labels:{align:"center",x:0,y:null},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},defaultCircularOptions:{gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null,style:{textOverflow:"none"}},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},defaultRadialOptions:{gridLineInterpolation:"circle",gridLineWidth:1,labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}},setOptions:function(t){var i=this.options=merge(this.defaultOptions,this.defaultPolarOptions,t);i.plotBands||(i.plotBands=[]),H.fireEvent(this,"afterSetOptions")},getOffset:function(){axisProto.getOffset.call(this),this.chart.axisOffset[this.side]=0},getLinePath:function(t,i,s){var e,a,n=this.pane.center,r=this.chart,o=pick(i,n[2]/2-this.offset);return void 0===s&&(s=this.horiz?0:this.center&&-this.center[3]/2),s&&(o+=s),this.isCircular||void 0!==i?((a=this.chart.renderer.symbols.arc(this.left+n[0],this.top+n[1],o,o,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})).xBounds=[this.left+n[0]],a.yBounds=[this.top+n[1]-o]):(e=this.postTranslate(this.angleRad,o),a=["M",this.center[0]+r.plotLeft,this.center[1]+r.plotTop,"L",e.x,e.y]),a},setAxisTranslation:function(){axisProto.setAxisTranslation.call(this),this.center&&(this.isCircular?this.transA=(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.transA=(this.center[2]-this.center[3])/2/(this.max-this.min||1),this.isXAxis?this.minPixelPadding=this.transA*this.minPointOffset:this.minPixelPadding=0)},beforeSetTickPositions:function(){this.autoConnect=this.isCircular&&void 0===pick(this.userMax,this.options.max)&&correctFloat(this.endAngleRad-this.startAngleRad)===correctFloat(2*Math.PI),!this.isCircular&&this.chart.inverted&&this.max++,this.autoConnect&&(this.max+=(this.categories?1:this.pointRange)||this.closestPointRange||0)},setAxisSize:function(){var t,i;axisProto.setAxisSize.call(this),this.isRadial&&(this.pane.updateCenter(this),t=this.center=extend([],this.pane.center),this.isCircular?this.sector=this.endAngleRad-this.startAngleRad:(i=this.postTranslate(this.angleRad,t[3]/2),t[0]=i.x-this.chart.plotLeft,t[1]=i.y-this.chart.plotTop),this.len=this.width=this.height=(t[2]-t[3])*pick(this.sector,1)/2)},getPosition:function(t,i){var s=this.translate(t);return this.postTranslate(this.isCircular?s:this.angleRad,pick(this.isCircular?i:s<0?0:s,this.center[2]/2)-this.offset)},postTranslate:function(t,i){var s=this.chart,e=this.center;return t=this.startAngleRad+t,{x:s.plotLeft+e[0]+Math.cos(t)*i,y:s.plotTop+e[1]+Math.sin(t)*i}},getPlotBandPath:function(t,i,s){var e,a,n,r,o,h,l=this.center,c=this.startAngleRad,d=l[2]/2,p=[pick(s.outerRadius,"100%"),s.innerRadius,pick(s.thickness,10)],u=Math.min(this.offset,0),g=/%$/,f=this.isCircular;return"polygon"===this.options.gridLineInterpolation?h=this.getPlotLinePath({value:t}).concat(this.getPlotLinePath({value:i,reverse:!0})):(t=Math.max(t,this.min),i=Math.min(i,this.max),f||(p[0]=this.translate(t),p[1]=this.translate(i)),p=p.map(function(t){return g.test(t)&&(t=pInt(t,10)*d/100),t}),"circle"!==s.shape&&f?(e=c+this.translate(t),a=c+this.translate(i)):(e=-Math.PI/2,a=1.5*Math.PI,o=!0),p[0]-=u,p[2]-=u,h=this.chart.renderer.symbols.arc(this.left+l[0],this.top+l[1],p[0],p[0],{start:Math.min(e,a),end:Math.max(e,a),innerR:pick(p[1],p[0]-p[2]),open:o}),f&&(n=(a+e)/2,r=this.left+l[0]+l[2]/2*Math.cos(n),h.xBounds=n>-Math.PI/2&&n<Math.PI/2?[r,this.chart.plotWidth]:[0,r],h.yBounds=[this.top+l[1]+l[2]/2*Math.sin(n)],h.yBounds[0]+=n>-Math.PI&&n<0||n>Math.PI?-10:10)),h},getCrosshairPosition:function(t,i,s){var e,a,n,r=t.value,o=this.pane.center;return this.isCircular?(defined(r)?t.point&&(t.point.shapeArgs||{}).start&&(r=this.chart.inverted?this.translate(t.point.rectPlotY,!0):t.point.x):(a=t.chartX||0,n=t.chartY||0,r=this.translate(Math.atan2(n-s,a-i)-this.startAngleRad,!0)),a=(e=this.getPosition(r)).x,n=e.y):(defined(r)||(a=t.chartX,n=t.chartY),defined(a)&&defined(n)&&(s=o[1]+this.chart.plotTop,r=this.translate(Math.min(Math.sqrt(Math.pow(a-i,2)+Math.pow(n-s,2)),o[2]/2)-o[3]/2,!0))),[r,a||0,n||0]},getPlotLinePath:function(t){var i,s,e,a,n,r,o,h,l,c=this,d=c.pane.center,p=c.chart,u=p.inverted,g=t.value,f=t.reverse,x=c.getPosition(g),P=c.pane.options.background?c.pane.options.background[0]||c.pane.options.background:{},A=P.innerRadius||"0%",v=P.outerRadius||"100%",m=d[0]+p.plotLeft,M=d[1]+p.plotTop,k=x.x,L=x.y,R=c.height,y=t.isCrosshair,C=d[3]/2;return y&&(h=this.getCrosshairPosition(t,m,M),g=h[0],k=h[1],L=h[2]),c.isCircular?(s=Math.sqrt(Math.pow(k-m,2)+Math.pow(L-M,2)),e="string"==typeof A?relativeLength(A,1):A/s,a="string"==typeof v?relativeLength(v,1):v/s,d&&C&&(e<(i=C/s)&&(e=i),a<i&&(a=i)),l=["M",m+e*(k-m),M-e*(M-L),"L",k-(1-a)*(k-m),L+(1-a)*(M-L)]):((g=c.translate(g))&&(g<0||g>R)&&(g=0),"circle"===c.options.gridLineInterpolation?l=c.getLinePath(0,g,C):(p[u?"yAxis":"xAxis"].forEach(function(t){t.pane===c.pane&&(n=t)}),l=[],o=n.tickPositions,n.autoConnect&&(o=o.concat([o[0]])),f&&(o=[].concat(o).reverse()),g&&(g+=C),o.forEach(function(t,i){r=n.getPosition(t,g),l.push(i?"L":"M",r.x,r.y)}))),l},getTitlePosition:function(){var t=this.center,i=this.chart,s=this.options.title;return{x:i.plotLeft+t[0]+(s.x||0),y:i.plotTop+t[1]-{high:.5,middle:.25,low:0}[s.align]*t[2]+(s.y||0)}},createLabelCollector:function(){var t=this;return function(){if(t.isRadial&&t.tickPositions&&!0!==t.options.labels.allowOverlap)return t.tickPositions.map(function(i){return t.ticks[i]&&t.ticks[i].label}).filter(function(t){return Boolean(t)})}}},addEvent(Axis,"init",function(t){var i,s=this.chart,e=s.inverted,a=s.angular,n=s.polar,r=this.isXAxis,o=this.coll,h=a&&r,l=s.options,c=t.userOptions.pane||0,d=this.pane=s.pane&&s.pane[c];"colorAxis"!==o?(a?(extend(this,h?hiddenAxisMixin:radialAxisMixin),(i=!r)&&(this.defaultPolarOptions=this.defaultRadialGaugeOptions)):n&&(extend(this,radialAxisMixin),i=this.horiz,this.defaultPolarOptions=i?this.defaultCircularOptions:merge("xAxis"===o?this.defaultOptions:this.defaultYAxisOptions,this.defaultRadialOptions),e&&"yAxis"===o&&(this.defaultPolarOptions.stackLabels=this.defaultYAxisOptions.stackLabels)),a||n?(this.isRadial=!0,l.chart.zoomType=null,this.labelCollector||(this.labelCollector=this.createLabelCollector()),this.labelCollector&&s.labelCollectors.push(this.labelCollector)):this.isRadial=!1,d&&i&&(d.axis=this),this.isCircular=i):this.isRadial=!1}),addEvent(Axis,"afterInit",function(){var t=this.chart,i=this.options,s=t.angular&&this.isXAxis,e=this.pane,a=e&&e.options;!s&&e&&(t.angular||t.polar)&&(this.angleRad=(i.angle||0)*Math.PI/180,this.startAngleRad=(a.startAngle-90)*Math.PI/180,this.endAngleRad=(pick(a.endAngle,a.startAngle+360)-90)*Math.PI/180,this.offset=i.offset||0)}),addEvent(Axis,"autoLabelAlign",function(t){this.isRadial&&(t.align=void 0,t.preventDefault())}),addEvent(Axis,"destroy",function(){if(this.chart&&this.chart.labelCollectors){var t=this.chart.labelCollectors.indexOf(this.labelCollector);t>=0&&this.chart.labelCollectors.splice(t,1)}}),addEvent(Tick,"afterGetPosition",function(t){this.axis.getPosition&&extend(t.pos,this.axis.getPosition(this.pos))}),addEvent(Tick,"afterGetLabelPosition",function(t){var i,s=this.axis,e=this.label,a=e.getBBox(),n=s.options.labels,r=n.y,o=20,h=n.align,l=(s.translate(this.pos)+s.startAngleRad+Math.PI/2)/Math.PI*180%360,c=Math.round(l),d="end",p=c<0?c+360:c,u=p,g=0,f=0,x=null===n.y?.3*-a.height:0;s.isRadial&&(i=s.getPosition(this.pos,s.center[2]/2+relativeLength(pick(n.distance,-25),s.center[2]/2,-s.center[2]/2)),"auto"===n.rotation?e.attr({rotation:l}):null===r&&(r=s.chart.renderer.fontMetrics(e.styles&&e.styles.fontSize).b-a.height/2),null===h&&(s.isCircular?(a.width>s.len*s.tickInterval/(s.max-s.min)&&(o=0),h=l>o&&l<180-o?"left":l>180+o&&l<360-o?"right":"center"):h="center",e.attr({align:h})),"auto"===h&&2===s.tickPositions.length&&s.isCircular&&(p>90&&p<180?p=180-p:p>270&&p<=360&&(p=540-p),u>180&&u<=360&&(u=360-u),s.pane.options.startAngle!==c&&s.pane.options.startAngle!==c+360&&s.pane.options.startAngle!==c-360||(d="start"),h=c>=-90&&c<=90||c>=-360&&c<=-270||c>=270&&c<=360?"start"===d?"right":"left":"start"===d?"left":"right",u>70&&u<110&&(h="center"),p<15||p>=180&&p<195?g=.3*a.height:p>=15&&p<=35?g="start"===d?0:.75*a.height:p>=195&&p<=215?g="start"===d?.75*a.height:0:p>35&&p<=90?g="start"===d?.25*-a.height:a.height:p>215&&p<=270&&(g="start"===d?a.height:.25*-a.height),u<15?f="start"===d?.15*-a.height:.15*a.height:u>165&&u<=180&&(f="start"===d?.15*a.height:.15*-a.height),e.attr({align:h}),e.translate(f,g+x)),t.pos.x=i.x+n.x,t.pos.y=i.y+r)}),wrap(tickProto,"getMarkPath",function(t,i,s,e,a,n,r){var o,h=this.axis;return h.isRadial?["M",i,s,"L",(o=h.getPosition(this.pos,h.center[2]/2+e)).x,o.y]:t.call(this,i,s,e,a,n,r)});