"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,extend=U.extend,pick=U.pick,seriesType=U.seriesType;import"../parts-map/HeatmapSeries.js";function tilePaddingFromTileSize(e,t,a){var n=e.options;return{xPad:(n.colsize||1)/-t,yPad:(n.rowsize||1)/-a}}H.tileShapeTypes={hexagon:{alignDataLabel:H.seriesTypes.scatter.prototype.alignDataLabel,getSeriesPadding:function(e){return tilePaddingFromTileSize(e,3,2)},haloPath:function(e){if(!e)return[];var t=this.tileEdges;return["M",t.x2-e,t.y1+e,"L",t.x3+e,t.y1+e,t.x4+1.5*e,t.y2,t.x3+e,t.y3-e,t.x2-e,t.y3-e,t.x1-1.5*e,t.y2,"Z"]},translate:function(){var e,t=this.options,a=this.xAxis,n=this.yAxis,i=t.pointPadding||0,r=(t.colsize||1)/3,s=(t.rowsize||1)/2;this.generatePoints(),this.points.forEach(function(t){var l=clamp(Math.floor(a.len-a.translate(t.x-2*r,0,1,0,1)),-a.len,2*a.len),o=clamp(Math.floor(a.len-a.translate(t.x-r,0,1,0,1)),-a.len,2*a.len),p=clamp(Math.floor(a.len-a.translate(t.x+r,0,1,0,1)),-a.len,2*a.len),h=clamp(Math.floor(a.len-a.translate(t.x+2*r,0,1,0,1)),-a.len,2*a.len),d=clamp(Math.floor(n.translate(t.y-s,0,1,0,1)),-n.len,2*n.len),c=clamp(Math.floor(n.translate(t.y,0,1,0,1)),-n.len,2*n.len),y=clamp(Math.floor(n.translate(t.y+s,0,1,0,1)),-n.len,2*n.len),g=pick(t.pointPadding,i),x=g*Math.abs(o-l)/Math.abs(y-c),u=a.reversed?-x:x,m=a.reversed?-g:g,P=n.reversed?-g:g;t.x%2&&(d+=e=e||Math.round(Math.abs(y-d)/2)*(n.reversed?-1:1),c+=e,y+=e),t.plotX=t.clientX=(o+p)/2,t.plotY=c,l+=u+m,o+=m,p-=m,h-=u+m,d-=P,y+=P,t.tileEdges={x1:l,x2:o,x3:p,x4:h,y1:d,y2:c,y3:y},t.shapeType="path",t.shapeArgs={d:["M",o,d,"L",p,d,h,c,p,y,o,y,l,c,"Z"]}}),this.translateColors()}},diamond:{alignDataLabel:H.seriesTypes.scatter.prototype.alignDataLabel,getSeriesPadding:function(e){return tilePaddingFromTileSize(e,2,2)},haloPath:function(e){if(!e)return[];var t=this.tileEdges;return["M",t.x2,t.y1+e,"L",t.x3+e,t.y2,t.x2,t.y3-e,t.x1-e,t.y2,"Z"]},translate:function(){var e,t=this.options,a=this.xAxis,n=this.yAxis,i=t.pointPadding||0,r=t.colsize||1,s=(t.rowsize||1)/2;this.generatePoints(),this.points.forEach(function(t){var l=clamp(Math.round(a.len-a.translate(t.x-r,0,1,0,0)),-a.len,2*a.len),o=clamp(Math.round(a.len-a.translate(t.x,0,1,0,0)),-a.len,2*a.len),p=clamp(Math.round(a.len-a.translate(t.x+r,0,1,0,0)),-a.len,2*a.len),h=clamp(Math.round(n.translate(t.y-s,0,1,0,0)),-n.len,2*n.len),d=clamp(Math.round(n.translate(t.y,0,1,0,0)),-n.len,2*n.len),c=clamp(Math.round(n.translate(t.y+s,0,1,0,0)),-n.len,2*n.len),y=pick(t.pointPadding,i),g=y*Math.abs(o-l)/Math.abs(c-d),x=a.reversed?-g:g,u=n.reversed?-y:y;t.x%2&&(h+=e=Math.abs(c-h)/2*(n.reversed?-1:1),d+=e,c+=e),t.plotX=t.clientX=o,t.plotY=d,l+=x,p-=x,h-=u,c+=u,t.tileEdges={x1:l,x2:o,x3:p,y1:h,y2:d,y3:c},t.shapeType="path",t.shapeArgs={d:["M",o,h,"L",p,d,o,c,l,d,"Z"]}}),this.translateColors()}},circle:{alignDataLabel:H.seriesTypes.scatter.prototype.alignDataLabel,getSeriesPadding:function(e){return tilePaddingFromTileSize(e,2,2)},haloPath:function(e){return H.seriesTypes.scatter.prototype.pointClass.prototype.haloPath.call(this,e+(e&&this.radius))},translate:function(){var e,t,a,n,i=this.options,r=this.xAxis,s=this.yAxis,l=i.pointPadding||0,o=(i.rowsize||1)/2,p=i.colsize||1,h=!1;this.generatePoints(),this.points.forEach(function(i){var d=clamp(Math.round(r.len-r.translate(i.x,0,1,0,0)),-r.len,2*r.len),c=clamp(Math.round(s.translate(i.y,0,1,0,0)),-s.len,2*s.len),y=l,g=!1;void 0!==i.pointPadding&&(y=i.pointPadding,g=!0,h=!0),n&&!h||(e=Math.abs(clamp(Math.floor(r.len-r.translate(i.x+p,0,1,0,0)),-r.len,2*r.len)-d),t=Math.abs(clamp(Math.floor(s.translate(i.y+o,0,1,0,0)),-s.len,2*s.len)-c),a=Math.floor(Math.sqrt(e*e+t*t)/2),n=Math.min(e,a,t)-y,h&&!g&&(h=!1)),i.x%2&&(c+=t*(s.reversed?-1:1)),i.plotX=i.clientX=d,i.plotY=c,i.radius=n,i.shapeType="circle",i.shapeArgs={x:d,y:c,r:n}}),this.translateColors()}},square:{alignDataLabel:H.seriesTypes.heatmap.prototype.alignDataLabel,translate:H.seriesTypes.heatmap.prototype.translate,getSeriesPadding:function(){},haloPath:H.seriesTypes.heatmap.prototype.pointClass.prototype.haloPath}},addEvent(H.Axis,"afterSetAxisTranslation",function(){if(!this.recomputingForTilemap&&"colorAxis"!==this.coll){var e=this,t=e.series.map(function(t){return t.getSeriesPixelPadding&&t.getSeriesPixelPadding(e)}).reduce(function(e,t){return(e&&e.padding)>(t&&t.padding)?e:t},void 0)||{padding:0,axisLengthFactor:1},a=Math.round(t.padding*t.axisLengthFactor);t.padding&&(e.len-=a,e.recomputingForTilemap=!0,e.setAxisTranslation(),delete e.recomputingForTilemap,e.minPixelPadding+=t.padding,e.len+=a)}}),seriesType("tilemap","heatmap",{states:{hover:{halo:{enabled:!0,size:2,opacity:.5,attributes:{zIndex:3}}}},pointPadding:2,tileShape:"hexagon"},{setOptions:function(){var e=H.seriesTypes.heatmap.prototype.setOptions.apply(this,Array.prototype.slice.call(arguments));return this.tileShape=H.tileShapeTypes[e.tileShape],e},alignDataLabel:function(){return this.tileShape.alignDataLabel.apply(this,Array.prototype.slice.call(arguments))},getSeriesPixelPadding:function(e){var t,a,n=e.isXAxis,i=this.tileShape.getSeriesPadding(this);return i?(t=Math.round(e.translate(n?2*i.xPad:i.yPad,0,1,0,1)),a=Math.round(e.translate(n?i.xPad:0,0,1,0,1)),{padding:Math.abs(t-a)||0,axisLengthFactor:n?2:1.1}):{padding:0,axisLengthFactor:1}},translate:function(){return this.tileShape.translate.apply(this,Array.prototype.slice.call(arguments))}},extend({haloPath:function(){return this.series.tileShape.haloPath.apply(this,Array.prototype.slice.call(arguments))}},H.colorPointMixin));