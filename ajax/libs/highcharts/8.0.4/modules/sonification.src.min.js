"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sonification",["highcharts"],function(n){return t(n),t.Highcharts=n,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(n){var t=n?n._modules:{};function i(n,t,i,e){n.hasOwnProperty(t)||(n[t]=e.apply(null,i))}i(t,"modules/sonification/Instrument.js",[t["parts/Globals.js"],t["parts/Utilities.js"]],function(s,n){var i=n.error,e=n.merge,a=n.pick,o=n.uniqueKey,r={type:"oscillator",playCallbackInterval:20,oscillator:{waveformShape:"sine"}};function t(n){this.init(n)}return t.prototype.init=function(n){if(this.initAudioContext()){this.options=e(r,n),this.id=this.options.id=n&&n.id||o();var t=s.audioContext;this.gainNode=t.createGain(),this.setGain(0),this.panNode=t.createStereoPanner&&t.createStereoPanner(),this.panNode?(this.setPan(0),this.gainNode.connect(this.panNode),this.panNode.connect(t.destination)):this.gainNode.connect(t.destination),"oscillator"===this.options.type&&this.initOscillator(this.options.oscillator),this.playCallbackTimers=[]}else i(29)},t.prototype.copy=function(n){return new t(e(this.options,{id:null},n))},t.prototype.initAudioContext=function(){var n=s.win.AudioContext||s.win.webkitAudioContext,t=!!s.audioContext;return!!n&&(s.audioContext=s.audioContext||new n,!t&&s.audioContext&&"running"===s.audioContext.state&&s.audioContext.suspend(),!!(s.audioContext&&s.audioContext.createOscillator&&s.audioContext.createGain))},t.prototype.initOscillator=function(n){var t=s.audioContext;this.oscillator=t.createOscillator(),this.oscillator.type=n.waveformShape,this.oscillator.connect(this.gainNode),this.oscillatorStarted=!1},t.prototype.setPan=function(n){this.panNode&&this.panNode.pan.setValueAtTime(n,s.audioContext.currentTime)},t.prototype.setGain=function(n,t){this.gainNode&&(1.2<n&&(console.warn("Highcharts sonification warning: Volume of instrument set too high."),n=1.2),t?(this.gainNode.gain.setValueAtTime(this.gainNode.gain.value,s.audioContext.currentTime),this.gainNode.gain.linearRampToValueAtTime(n,s.audioContext.currentTime+t/1e3)):this.gainNode.gain.setValueAtTime(n,s.audioContext.currentTime))},t.prototype.cancelGainRamp=function(){this.gainNode&&this.gainNode.gain.cancelScheduledValues(0)},t.prototype.getValidFrequency=function(i,n,t){var e=this.options.allowedFrequencies,o=a(t,1/0),s=a(n,-1/0);return e&&e.length?e.reduce(function(n,t){return Math.abs(t-i)<Math.abs(n-i)&&t<o&&s<t?t:n},1/0):i},t.prototype.clearPlayCallbackTimers=function(){this.playCallbackTimers.forEach(function(n){clearInterval(n)}),this.playCallbackTimers=[]},t.prototype.setFrequency=function(n,t){var i=t||{},e=this.getValidFrequency(n,i.min,i.max);"oscillator"===this.options.type&&this.oscillatorPlay(e)},t.prototype.oscillatorPlay=function(n){this.oscillatorStarted||(this.oscillator.start(),this.oscillatorStarted=!0),this.oscillator.frequency.setValueAtTime(n,s.audioContext.currentTime)},t.prototype.preparePlay=function(){this.setGain(.001),"suspended"===s.audioContext.state&&s.audioContext.resume(),this.oscillator&&!this.oscillatorStarted&&(this.oscillator.start(),this.oscillatorStarted=!0)},t.prototype.play=function(n){function t(t,i,e){var o=n.duration,s=0,a=l.options.playCallbackInterval;if("function"==typeof t){var r=setInterval(function(){var n=++s*a/o;1<=n?(l[i](t(1),e),clearInterval(r)):l[i](t(n),e)},a);l.playCallbackTimers.push(r)}else l[i](t,e)}var l=this,i=n.duration||0;if(l.id){if("suspended"===s.audioContext.state||this.oscillator&&!this.oscillatorStarted)return l.preparePlay(),void setTimeout(function(){l.play(n)},10);l.playCallbackTimers.length&&l.clearPlayCallbackTimers(),l.cancelGainRamp(),l.stopOscillatorTimeout&&(clearTimeout(l.stopOscillatorTimeout),delete l.stopOscillatorTimeout),l.stopTimeout&&(clearTimeout(l.stopTimeout),delete l.stopTimeout,l.stopCallback&&(l._play=l.play,l.play=function(){},l.stopCallback("cancelled"),l.play=l._play));var e=i<s.sonification.fadeOutDuration+20;l.stopCallback=n.onEnd;var o=function(){delete l.stopTimeout,l.stop(e)};i?(l.stopTimeout=setTimeout(o,e?i:i-s.sonification.fadeOutDuration),t(n.frequency,"setFrequency",{minFrequency:n.minFrequency,maxFrequency:n.maxFrequency}),t(a(n.volume,1),"setGain",4),t(a(n.pan,0),"setPan")):o()}},t.prototype.mute=function(){this.setGain(1e-4,.8*s.sonification.fadeOutDuration)},t.prototype.stop=function(n,t,i){function e(){o.stopOscillatorTimeout&&delete o.stopOscillatorTimeout;try{o.oscillator.stop()}catch(n){}o.oscillator.disconnect(o.gainNode),o.initOscillator(o.options.oscillator),t&&t(i),o.stopCallback&&o.stopCallback(i)}var o=this;o.playCallbackTimers.length&&o.clearPlayCallbackTimers(),o.stopTimeout&&clearTimeout(o.stopTimeout),n?(o.setGain(0),e()):(o.mute(),o.stopOscillatorTimeout=setTimeout(e,s.sonification.fadeOutDuration+100))},t}),i(t,"modules/sonification/musicalFrequencies.js",[],function(){return[16.351597831287414,17.323914436054505,18.354047994837977,19.445436482630058,20.601722307054366,21.826764464562746,23.12465141947715,24.499714748859326,25.956543598746574,27.5,29.13523509488062,30.86770632850775,32.70319566257483,34.64782887210901,36.70809598967594,38.890872965260115,41.20344461410875,43.653528929125486,46.2493028389543,48.999429497718666,51.91308719749314,55,58.27047018976124,61.7354126570155,65.40639132514966,69.29565774421802,73.41619197935188,77.78174593052023,82.4068892282175,87.30705785825097,92.4986056779086,97.99885899543733,103.82617439498628,110,116.54094037952248,123.47082531403103,130.8127826502993,138.59131548843604,146.8323839587038,155.56349186104046,164.81377845643496,174.61411571650194,184.9972113558172,195.99771799087463,207.65234878997256,220,233.08188075904496,246.94165062806206,261.6255653005986,277.1826309768721,293.6647679174076,311.1269837220809,329.6275569128699,349.2282314330039,369.9944227116344,391.99543598174927,415.3046975799451,440,466.1637615180899,493.8833012561241,523.2511306011972,554.3652619537442,587.3295358348151,622.2539674441618,659.2551138257398,698.4564628660078,739.9888454232688,783.9908719634985,830.6093951598903,880,932.3275230361799,987.7666025122483,1046.5022612023945,1108.7305239074883,1174.6590716696303,1244.5079348883237,1318.5102276514797,1396.9129257320155,1479.9776908465376,1567.981743926997,1661.2187903197805,1760,1864.6550460723597,1975.533205024496,2093.004522404789,2217.4610478149766,2349.31814333926,2489.0158697766474,2637.02045530296,2793.825851464031,2959.955381693075,3135.9634878539946,3322.437580639561,3520,3729.3100921447194,3951.066410048992,4186.009044809578]}),i(t,"modules/sonification/utilities.js",[t["modules/sonification/musicalFrequencies.js"],t["parts/Utilities.js"]],function(n,t){var a=t.clamp;function i(n){this.init(n||[])}return i.prototype.init=function(n){this.supportedSignals=n,this.signals={}},i.prototype.registerSignalCallbacks=function(i){var e=this;e.supportedSignals.forEach(function(n){var t=i[n];t&&(e.signals[n]=e.signals[n]||[]).push(t)})},i.prototype.clearSignalCallbacks=function(n){var t=this;n?n.forEach(function(n){t.signals[n]&&delete t.signals[n]}):t.signals={}},i.prototype.emitSignal=function(n,i){var e;return this.signals[n]&&this.signals[n].forEach(function(n){var t=n(i);e=void 0!==t?t:e}),e},{musicalFrequencies:n,SignalHandler:i,getMusicalScale:function(e){return n.filter(function(n,t){var i=t%12+1;return e.some(function(n){return n===i})})},calculateDataExtremes:function(n,e){return n.series.reduce(function(i,n){return n.points.forEach(function(n){var t=void 0!==n[e]?n[e]:n.options[e];i.min=Math.min(i.min,t),i.max=Math.max(i.max,t)}),i},{min:1/0,max:-1/0})},virtualAxisTranslate:function(n,t,i){var e=t.max-t.min,o=i.max-i.min,s=i.min+o*(n-t.min)/e;return 0<e?a(s,i.min,i.max):i.min}}}),i(t,"modules/sonification/instrumentDefinitions.js",[t["modules/sonification/Instrument.js"],t["modules/sonification/utilities.js"]],function(t,i){var e={};return["sine","square","triangle","sawtooth"].forEach(function(n){e[n]=new t({oscillator:{waveformShape:n}}),e[n+"Musical"]=new t({allowedFrequencies:i.musicalFrequencies,oscillator:{waveformShape:n}}),e[n+"Major"]=new t({allowedFrequencies:i.getMusicalScale([1,3,5,6,8,10,12]),oscillator:{waveformShape:n}})}),e}),i(t,"modules/sonification/Earcon.js",[t["parts/Globals.js"],t["parts/Utilities.js"]],function(p,n){var f=n.error,m=n.merge,h=n.pick,t=n.uniqueKey;function i(n){this.init(n||{})}return i.prototype.init=function(n){this.options=n,this.options.id||(this.options.id=this.id=t()),this.instrumentsPlaying={}},i.prototype.sonify=function(n){var t=m(this.options,n),a=h(t.volume,1),r=t.pan,l=this,u=n&&n.onEnd,c=l.options.onEnd;t.instruments.forEach(function(n){var t,i,e="string"==typeof n.instrument?p.sonification.instruments[n.instrument]:n.instrument,o=m(n.playOptions),s="";e&&e.play?n.playOptions&&("function"!=typeof n.playOptions.volume&&(o.volume=h(a,1)*h(n.playOptions.volume,1)),o.pan=h(r,o.pan),t=o.onEnd,o.onEnd=function(){delete l.instrumentsPlaying[s],t&&t.apply(this,arguments),Object.keys(l.instrumentsPlaying).length||(u&&u.apply(this,arguments),c&&c.apply(this,arguments))},i=e.copy(),s=i.id,(l.instrumentsPlaying[s]=i).play(o)):f(30)})},i.prototype.cancelSonify=function(t){var i=this.instrumentsPlaying,n=i&&Object.keys(i);n&&n.length&&(n.forEach(function(n){i[n].stop(!t,null,"cancelled")}),this.instrumentsPlaying={})},i}),i(t,"modules/sonification/pointSonify.js",[t["parts/Globals.js"],t["parts/Utilities.js"],t["modules/sonification/utilities.js"]],function(u,n,o){var c=n.error,p=n.merge,f=n.pick,m={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};return{pointSonify:function(n){function s(t,n,i){return"function"==typeof t?n?function(n){return t(a,e,n)}:t(a,e):"string"==typeof t?(e[t]=e[t]||o.calculateDataExtremes(a.series.chart,t),o.virtualAxisTranslate(f(a[t],a.options[t]),e[t],i)):t}var a=this,r=a.series.chart,e=n.dataExtremes||{};(r.sonification.currentlyPlayingPoint=a).sonification=a.sonification||{},a.sonification.instrumentsPlaying=a.sonification.instrumentsPlaying||{};var l=a.sonification.signalHandler=a.sonification.signalHandler||new o.SignalHandler(["onEnd"]);l.clearSignalCallbacks(),l.registerSignalCallbacks({onEnd:n.onEnd}),!a.isNull&&a.visible&&a.series.visible?n.instruments.forEach(function(t){var n="string"==typeof t.instrument?u.sonification.instruments[t.instrument]:t.instrument,i=t.instrumentMapping||{},e=p(m,t.instrumentOptions),o=n.id;n&&n.play?(a.sonification.instrumentsPlaying[n.id]=n).play({frequency:s(i.frequency,!0,{min:e.minFrequency,max:e.maxFrequency}),duration:s(i.duration,!1,{min:e.minDuration,max:e.maxDuration}),pan:s(i.pan,!0,{min:e.minPan,max:e.maxPan}),volume:s(i.volume,!0,{min:e.minVolume,max:e.maxVolume}),onEnd:function(n){t.onEnd&&t.onEnd.apply(this,arguments),r.sonification&&r.sonification.currentlyPlayingPoint&&delete r.sonification.currentlyPlayingPoint,a.sonification&&a.sonification.instrumentsPlaying&&(delete a.sonification.instrumentsPlaying[o],Object.keys(a.sonification.instrumentsPlaying).length||l.emitSignal("onEnd",n))},minFrequency:e.minFrequency,maxFrequency:e.maxFrequency}):c(30)}):l.emitSignal("onEnd")},pointCancelSonify:function(t){var i=this.sonification&&this.sonification.instrumentsPlaying,n=i&&Object.keys(i);n&&n.length&&(n.forEach(function(n){i[n].stop(!t,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}}}),i(t,"modules/sonification/chartSonify.js",[t["parts/Globals.js"],t["parts/Point.js"],t["parts/Utilities.js"],t["modules/sonification/utilities.js"]],function(f,i,n,c){var m=n.find,h=n.isArray,d=n.merge,y=n.pick,g=n.splat;function p(n,t){return"function"==typeof t?t(n):y(n[t],n.options[t])}function v(n,e){return n.points.reduce(function(n,t){var i=p(t,e);return n.min=Math.min(n.min,i),n.max=Math.max(n.max,i),n},{min:1/0,max:-1/0})}function E(o,n,t){return(n||[]).reduce(function(i,e){return Object.keys(e.instrumentMapping||{}).forEach(function(n){var t=e.instrumentMapping[n];"string"!=typeof t||i[t]||(i[t]=c.calculateDataExtremes(o,t))}),i},d(t))}function r(n,a){var r=a.timeExtremes||v(n,a.pointPlayTime),l=E(n.chart,a.instruments,a.dataExtremes),u=a.instruments.map(function(n){var t=n.instrument,i=("string"==typeof t?f.sonification.instruments[t]:t).copy();return d(n,{instrument:i})}),t=n.points.reduce(function(n,t){var i,o,e=(o=t,(a.earcons||[]).reduce(function(n,t){var i,e=t.earcon;return t.condition?(i=t.condition(o))instanceof f.sonification.Earcon?n.push(i):i&&n.push(e):t.onPoint&&o.id===t.onPoint&&n.push(e),n},[])),s=(i=t,c.virtualAxisTranslate(p(i,a.pointPlayTime),r,{min:0,max:a.duration}));return n.concat(new f.sonification.TimelineEvent({eventObject:t,time:s,id:t.id,playOptions:{instruments:u,dataExtremes:l}}),e.map(function(n){return new f.sonification.TimelineEvent({eventObject:n,time:s})}))},[]);return new f.sonification.TimelinePath({events:t,onStart:function(){a.onStart&&a.onStart(n)},onEventStart:function(n){var t=n.options&&n.options.eventObject;if(t instanceof i){if(!t.series.visible&&!t.series.chart.series.some(function(n){return n.visible}))return n.timelinePath.timeline.pause(),n.timelinePath.timeline.resetCursor(),!1;a.onPointStart&&a.onPointStart(n,t)}},onEventEnd:function(n){var t=n.event&&n.event.options&&n.event.options.eventObject;t instanceof i&&a.onPointEnd&&a.onPointEnd(n.event,t)},onEnd:function(){a.onEnd&&a.onEnd(n)}})}function P(n,t){var s=Math.max(t-n.reduce(function(n,t){var i=g(t);return n+(1===i.length&&i[0].options&&i[0].options.silentWait||0)},0),0),a=n.reduce(function(n,t){return n+g(t).reduce(function(n,t){var i=t.series&&t.seriesOptions&&t.seriesOptions.timeExtremes;return i?Math.max(n,i.max-i.min):n},0)},0);return n.reduce(function(n,t){var i=g(t).reduce(function(n,t){var i,e,o;return t instanceof f.sonification.TimelinePath?n.push(t):t.series&&(t.seriesOptions.duration=t.seriesOptions.duration||(i=t.seriesOptions.timeExtremes.max-t.seriesOptions.timeExtremes.min,e=a,o=s,c.virtualAxisTranslate(i,{min:0,max:e},{min:0,max:o})),n.push(r(t.series,t.seriesOptions))),n},[]);return n.push(i),n},[])}return{chartSonify:function(n){var t,s=(t=n,d(this.options.sonification,t));if(!1!==s.enabled){this.sonification.timeline&&this.sonification.timeline.pause(),this.sonification.duration=s.duration;var i,o,a,e,r,l,u=E(this,s.instruments,s.dataExtremes),c=(i=s.order,o=this,a=function(n){return t=n,i=u,o=(e=s).seriesOptions||{},d({dataExtremes:i,timeExtremes:v(t,e.pointPlayTime),instruments:e.instruments,onStart:e.onSeriesStart,onEnd:e.onSeriesEnd,earcons:e.earcons},h(o)?m(o,function(n){return n.id===y(t.id,t.options.id)})||{}:o,{pointPlayTime:e.pointPlayTime});var t,i,e,o},"sequential"===i||"simultaneous"===i?(e=o.series.reduce(function(n,t){return t.visible&&n.push({series:t,seriesOptions:a(t)}),n},[]),"simultaneous"===i&&(e=[e])):e=i.reduce(function(n,t){var i=g(t).reduce(function(n,t){var i;if("string"==typeof t){var e=o.get(t);e.visible&&(i={series:e,seriesOptions:a(e)})}else t instanceof f.sonification.Earcon&&(i=new f.sonification.TimelinePath({events:[new f.sonification.TimelineEvent({eventObject:t})]}));return t.silentWait&&(i=new f.sonification.TimelinePath({silentWait:t.silentWait})),i&&n.push(i),n},[]);return i.length&&n.push(i),n},[]),e);r=c;var p=P(c=(l=s.afterSeriesWait||0)?r.reduce(function(n,t,i){var e=g(t);return n.push(e),i<r.length-1&&e.some(function(n){return n.series})&&n.push(new f.sonification.TimelinePath({silentWait:l})),n},[]):r,s.duration);p.forEach(function(n){var t,o;o=(t=n).reduce(function(n,t){var i=t.events;return i&&i.length&&(n.min=Math.min(i[0].time,n.min),n.max=Math.max(i[i.length-1].time,n.max)),n},{min:1/0,max:-1/0}),t.forEach(function(n){var t=n.events,i=t&&t.length,e=[];i&&t[0].time<=o.min||e.push(new f.sonification.TimelineEvent({time:o.min})),i&&t[t.length-1].time>=o.max||e.push(new f.sonification.TimelineEvent({time:o.max})),e.length&&n.addTimelineEvents(e)})}),this.sonification.timeline=new f.sonification.Timeline({paths:p,onEnd:s.onEnd}),this.sonification.timeline.play()}},seriesSonify:function(n){var t=r(this,n),i=this.chart.sonification;i.timeline&&i.timeline.pause(),i.duration=n.duration,i.timeline=new f.sonification.Timeline({paths:[t]}),i.timeline.play()},pause:function(n){this.sonification.timeline?this.sonification.timeline.pause(y(n,!0)):this.sonification.currentlyPlayingPoint&&this.sonification.currentlyPlayingPoint.cancelSonify(n)},resume:function(n){this.sonification.timeline&&this.sonification.timeline.play(n)},rewind:function(n){this.sonification.timeline&&this.sonification.timeline.rewind(n)},cancel:function(n){this.pauseSonify(n),this.resetSonifyCursor()},getCurrentPoints:function(){var t;return this.sonification.timeline?(t=this.sonification.timeline.getCursor(),Object.keys(t).map(function(n){return t[n].eventObject}).filter(function(n){return n instanceof i})):[]},setCursor:function(n){var t=this.sonification.timeline;t&&g(n).forEach(function(n){t.setCursor(n.id)})},resetCursor:function(){this.sonification.timeline&&this.sonification.timeline.resetCursor()},resetCursorEnd:function(){this.sonification.timeline&&this.sonification.timeline.resetCursorEnd()}}}),i(t,"modules/sonification/Timeline.js",[t["parts/Globals.js"],t["parts/Utilities.js"],t["modules/sonification/utilities.js"]],function(t,n,i){var a=n.merge,c=n.splat,e=n.uniqueKey;function o(n){this.init(n||{})}function s(n){this.init(n)}function r(n){this.init(n||{})}return o.prototype.init=function(n){this.options=n,this.time=n.time||0,this.id=this.options.id=n.id||e()},o.prototype.play=function(n){var t=this.options.eventObject,i=this.options.onEnd,e=n&&n.onEnd,o=this.options.playOptions&&this.options.playOptions.onEnd,s=a(this.options.playOptions,n);t&&t.sonify?(s.onEnd=i||e||o?function(){var t=arguments;[i,e,o].forEach(function(n){n&&n.apply(this,t)})}:void 0,t.sonify(s)):(e&&e(),i&&i())},o.prototype.cancel=function(n){this.options.eventObject.cancelSonify(n)},s.prototype.init=function(n){this.options=n,this.id=this.options.id=n.id||e(),this.cursor=0,this.eventsPlaying={},this.events=n.silentWait?[new o({time:0}),new o({time:n.silentWait})]:this.options.events,this.sortEvents(),this.updateEventIdMap(),this.signalHandler=new i.SignalHandler(["playOnEnd","masterOnEnd","onStart","onEventStart","onEventEnd"]),this.signalHandler.registerSignalCallbacks(a(n,{masterOnEnd:n.onEnd}))},s.prototype.sortEvents=function(){this.events=this.events.sort(function(n,t){return n.time-t.time})},s.prototype.updateEventIdMap=function(){this.eventIdMap=this.events.reduce(function(n,t,i){return n[t.id]=i,n},{})},s.prototype.addTimelineEvents=function(n){this.events=this.events.concat(n),this.sortEvents(),this.updateEventIdMap()},s.prototype.getCursor=function(){return this.events[this.cursor]},s.prototype.setCursor=function(n){var t=this.eventIdMap[n];return void 0!==t&&(this.cursor=t,!0)},s.prototype.play=function(n){this.pause(),this.signalHandler.emitSignal("onStart"),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playEvents(1)},s.prototype.rewind=function(n){this.pause(),this.signalHandler.emitSignal("onStart"),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playEvents(-1)},s.prototype.resetCursor=function(){this.cursor=0},s.prototype.resetCursorEnd=function(){this.cursor=this.events.length-1},s.prototype.pause=function(t){var i=this;clearTimeout(i.nextScheduledPlay),Object.keys(i.eventsPlaying).forEach(function(n){i.eventsPlaying[n]&&i.eventsPlaying[n].cancel(t)}),i.eventsPlaying={}},s.prototype.playEvents=function(n){function i(n){e.signalHandler.emitSignal("masterOnEnd",n),e.signalHandler.emitSignal("playOnEnd",n)}var t,e=this,o=e.events[this.cursor],s=e.events[this.cursor+n];!1!==(o.timelinePath=e).signalHandler.emitSignal("onEventStart",o)?((e.eventsPlaying[o.id]=o).play({onEnd:function(n){var t={event:o,cancelled:!!n};delete e.eventsPlaying[o.id],e.signalHandler.emitSignal("onEventEnd",t),s||i(t)}}),s&&((t=Math.abs(s.time-o.time))<1?(e.cursor+=n,e.playEvents(n)):this.nextScheduledPlay=setTimeout(function(){e.cursor+=n,e.playEvents(n)},t))):i({event:o,cancelled:!0})},r.prototype.init=function(n){this.options=n,this.cursor=0,this.paths=n.paths,this.pathsPlaying={},this.signalHandler=new i.SignalHandler(["playOnEnd","masterOnEnd","onPathStart","onPathEnd"]),this.signalHandler.registerSignalCallbacks(a(n,{masterOnEnd:n.onEnd}))},r.prototype.play=function(n){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playPaths(1)},r.prototype.rewind=function(n){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playPaths(-1)},r.prototype.playPaths=function(o){var s=c(this.paths[this.cursor]),a=this.paths[this.cursor+o],r=this,l=this.signalHandler,u=0;s.forEach(function(n){n&&(n.timeline=r,setTimeout(function(){var e;e=n,l.emitSignal("onPathStart",e),(r.pathsPlaying[e.id]=e)[0<o?"play":"rewind"](function(n){var t=n&&n.cancelled,i={path:e,cancelled:t};delete r.pathsPlaying[e.id],l.emitSignal("onPathEnd",i),++u>=s.length&&(a&&!t?(r.cursor+=o,c(a).forEach(function(n){n[0<o?"resetCursor":"resetCursorEnd"]()}),r.playPaths(o)):(l.emitSignal("playOnEnd",i),l.emitSignal("masterOnEnd",i)))})},t.sonification.fadeOutDuration))})},r.prototype.pause=function(t){var i=this;Object.keys(i.pathsPlaying).forEach(function(n){i.pathsPlaying[n]&&i.pathsPlaying[n].pause(t)}),i.pathsPlaying={}},r.prototype.resetCursor=function(){this.paths.forEach(function(n){c(n).forEach(function(n){n.resetCursor()})}),this.cursor=0},r.prototype.resetCursorEnd=function(){this.paths.forEach(function(n){c(n).forEach(function(n){n.resetCursorEnd()})}),this.cursor=this.paths.length-1},r.prototype.setCursor=function(t){return this.paths.some(function(n){return c(n).some(function(n){return n.setCursor(t)})})},r.prototype.getCursor=function(){return this.getCurrentPlayingPaths().reduce(function(n,t){return n[t.id]=t.getCursor(),n},{})},r.prototype.atStart=function(){return!this.getCurrentPlayingPaths().some(function(n){return n.cursor})},r.prototype.getCurrentPlayingPaths=function(){return c(this.paths[this.cursor])},{TimelineEvent:o,TimelinePath:s,Timeline:r}}),i(t,"modules/sonification/options.js",[],function(){return{sonification:{enabled:!1,duration:2e3,afterSeriesWait:1e3,order:"sequential",pointPlayTime:"x",instruments:[{instrument:"sineMusical",instrumentMapping:{duration:400,frequency:"y",volume:.7},instrumentOptions:{minFrequency:392,maxFrequency:1046}}]}}}),i(t,"modules/sonification/sonification.js",[t["parts/Globals.js"],t["parts/Point.js"],t["parts/Utilities.js"],t["modules/sonification/Instrument.js"],t["modules/sonification/instrumentDefinitions.js"],t["modules/sonification/Earcon.js"],t["modules/sonification/pointSonify.js"],t["modules/sonification/chartSonify.js"],t["modules/sonification/utilities.js"],t["modules/sonification/Timeline.js"],t["modules/sonification/options.js"]],function(n,t,i,e,o,s,a,r,l,u,c){var p=i.addEvent,f=i.extend,m=i.merge;n.sonification={fadeOutDuration:20,utilities:l,Instrument:e,instruments:o,Earcon:s,TimelineEvent:u.TimelineEvent,TimelinePath:u.TimelinePath,Timeline:u.Timeline},m(!0,n.defaultOptions,c),t.prototype.sonify=a.pointSonify,t.prototype.cancelSonify=a.pointCancelSonify,n.Series.prototype.sonify=r.seriesSonify,f(n.Chart.prototype,{sonify:r.chartSonify,pauseSonify:r.pause,resumeSonify:r.resume,rewindSonify:r.rewind,cancelSonify:r.cancel,getCurrentSonifyPoints:r.getCurrentPoints,setSonifyCursor:r.setCursor,resetSonifyCursor:r.resetCursor,resetSonifyCursorEnd:r.resetCursorEnd}),p(n.Chart,"init",function(){this.sonification={}}),p(n.Chart,"update",function(n){var t=n.options.sonification;t&&m(!0,this.options.sonification,t)})}),i(t,"masters/modules/sonification.src.js",[],function(){})});