"use strict";import H from"../../parts/Globals.js";import U from"../../parts/Utilities.js";var pick=U.pick;import utilities from"./utilities.js";var defaultInstrumentOptions={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};function pointSonify(n){var i=this,t=i.series.chart,a=n.dataExtremes||{},e=function(n,t,e){return"function"==typeof n?t?function(t){return n(i,a,t)}:n(i,a):"string"==typeof n?(a[n]=a[n]||utilities.calculateDataExtremes(i.series.chart,n),utilities.virtualAxisTranslate(pick(i[n],i.options[n]),a[n],e)):n};t.sonification.currentlyPlayingPoint=i,i.sonification=i.sonification||{},i.sonification.instrumentsPlaying=i.sonification.instrumentsPlaying||{};var o=i.sonification.signalHandler=i.sonification.signalHandler||new utilities.SignalHandler(["onEnd"]);o.clearSignalCallbacks(),o.registerSignalCallbacks({onEnd:n.onEnd}),!i.isNull&&i.visible&&i.series.visible?n.instruments.forEach(function(n){var a="string"==typeof n.instrument?H.sonification.instruments[n.instrument]:n.instrument,s=n.instrumentMapping||{},r=H.merge(defaultInstrumentOptions,n.instrumentOptions),l=a.id;a&&a.play?(i.sonification.instrumentsPlaying[a.id]=a,a.play({frequency:e(s.frequency,!0,{min:r.minFrequency,max:r.maxFrequency}),duration:e(s.duration,!1,{min:r.minDuration,max:r.maxDuration}),pan:e(s.pan,!0,{min:r.minPan,max:r.maxPan}),volume:e(s.volume,!0,{min:r.minVolume,max:r.maxVolume}),onEnd:function(a){n.onEnd&&n.onEnd.apply(this,arguments),t.sonification&&t.sonification.currentlyPlayingPoint&&delete t.sonification.currentlyPlayingPoint,i.sonification&&i.sonification.instrumentsPlaying&&(delete i.sonification.instrumentsPlaying[l],Object.keys(i.sonification.instrumentsPlaying).length||o.emitSignal("onEnd",a))},minFrequency:r.minFrequency,maxFrequency:r.maxFrequency})):H.error(30)}):o.emitSignal("onEnd")}function pointCancelSonify(n){var i=this.sonification&&this.sonification.instrumentsPlaying,t=i&&Object.keys(i);t&&t.length&&(t.forEach(function(t){i[t].stop(!n,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}var pointSonifyFunctions={pointSonify:pointSonify,pointCancelSonify:pointCancelSonify};export default pointSonifyFunctions;