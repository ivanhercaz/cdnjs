"use strict";import Highcharts from"../parts/Globals.js";import U from"../parts/Utilities.js";var pick=U.pick;import"../parts/Options.js";import"../parts/Series.js";var seriesType=Highcharts.seriesType,seriesTypes=Highcharts.seriesTypes,fireEvent=Highcharts.fireEvent,addEvent=Highcharts.addEvent,noop=Highcharts.noop;seriesType("funnel","pie",{animation:!1,center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,size:!0,dataLabels:{connectorWidth:1,verticalAlign:"middle"},states:{select:{color:"#cccccc",borderColor:"#000000"}}},{animate:noop,translate:function(){var t,e,i,a,s,n,o,l,r,h,c=0,p=this,d=p.chart,g=p.options,b=g.reversed,f=g.ignoreHiddenPoint,u=d.plotWidth,m=d.plotHeight,v=0,y=g.center,L=Y(y[0],u),W=Y(y[1],m),A=Y(g.width,u),H=Y(g.height,m),x=Y(g.neckWidth,u),D=Y(g.neckHeight,m),k=W-H/2+H-D,T=p.data,E="left"===g.dataLabels.position?1:0;function Y(t,e){return/%$/.test(t)?e*parseInt(t,10)/100:parseInt(t,10)}p.getWidthAt=function(t){return t>k||H===D?x:x+(A-x)*(1-(t-(W-H/2))/(H-D))},p.getX=function(t,e,i){return L+(e?-1:1)*(p.getWidthAt(b?2*W-t:t)/2+i.labelDistance)},p.center=[L,W,H],p.centerX=L,T.forEach(function(t){f&&!1===t.visible||(c+=t.y)}),T.forEach(function(d){h=null,i=c?d.y/c:0,l=(s=W-H/2+v*H)+i*H,t=p.getWidthAt(s),n=(a=L-t/2)+t,t=p.getWidthAt(l),r=(o=L-t/2)+t,s>k?(a=o=L-x/2,n=r=L+x/2):l>k&&(h=l,t=p.getWidthAt(k),r=(o=L-t/2)+t,l=k),b&&(s=2*W-s,l=2*W-l,null!==h&&(h=2*W-h)),e=["M",a,s,"L",n,s,r,l],null!==h&&e.push(r,h,o,h),e.push(o,l,"Z"),d.shapeType="path",d.shapeArgs={d:e},d.percentage=100*i,d.plotX=L,d.plotY=(s+(h||l))/2,d.tooltipPos=[L,d.plotY],d.dlBox={x:o,y:s,topWidth:n-a,bottomWidth:r-o,height:Math.abs(pick(h,l)-s),width:NaN},d.slice=noop,d.half=E,f&&!1===d.visible||(v+=i)}),fireEvent(p,"afterTranslate")},sortByAngle:function(t){t.sort(function(t,e){return t.plotY-e.plotY})},drawDataLabels:function(){var t,e,i,a,s,n=this.data,o=this.options.dataLabels.distance,l=n.length;for(this.center[2]-=2*o;l--;)e=(t=(i=n[l]).half)?1:-1,s=i.plotY,i.labelDistance=pick(i.options.dataLabels&&i.options.dataLabels.distance,o),this.maxLabelDistance=Math.max(i.labelDistance,this.maxLabelDistance||0),a=this.getX(s,t,i),i.labelPosition={natural:{x:0,y:s},final:{},alignment:t?"right":"left",connectorPosition:{breakAt:{x:a+(i.labelDistance-5)*e,y:s},touchingSliceAt:{x:a+i.labelDistance*e,y:s}}};seriesTypes[this.options.dataLabels.inside?"column":"pie"].prototype.drawDataLabels.call(this)},alignDataLabel:function(t,e,i,a,s){var n=t.series,o=n.options.reversed,l=t.dlBox||t.shapeArgs,r=i.align,h=i.verticalAlign,c=((n.options||{}).dataLabels||{}).inside,p=n.center[1],d=o?2*p-t.plotY:t.plotY,g=n.getWidthAt(d-l.height/2+e.height),b="middle"===h?(l.topWidth-l.bottomWidth)/4:(g-l.bottomWidth)/2,f=l.y,u=l.x;"middle"===h?f=l.y-l.height/2+e.height/2:"top"===h&&(f=l.y-l.height+e.height+i.padding),("top"===h&&!o||"bottom"===h&&o||"middle"===h)&&("right"===r?u=l.x-i.padding+b:"left"===r&&(u=l.x+i.padding-b)),a={x:u,y:o?f-l.height:f,width:l.bottomWidth,height:l.height},i.verticalAlign="bottom",c&&!t.visible||Highcharts.Series.prototype.alignDataLabel.call(this,t,e,i,a,s),c&&(!t.visible&&t.dataLabel&&(t.dataLabel.placed=!1),t.contrastColor&&e.css({color:t.contrastColor}))}}),addEvent(Highcharts.Chart,"afterHideAllOverlappingLabels",function(){this.series.forEach(function(t){t instanceof seriesTypes.pie&&t.placeDataLabels&&!((t.options||{}).dataLabels||{}).inside&&t.placeDataLabels()})}),seriesType("pyramid","funnel",{neckWidth:"0%",neckHeight:"0%",reversed:!0});