"use strict";import H from"./Globals.js";import U from"./Utilities.js";var clamp=U.clamp,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,isNumber=U.isNumber,objectEach=U.objectEach,pick=U.pick,fireEvent=H.fireEvent,merge=H.merge,deg2rad=H.deg2rad;H.Tick=function(t,e,i,s,a){this.axis=t,this.pos=e,this.type=i||"",this.isNew=!0,this.isNewLabel=!0,this.parameters=a||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,i||s||this.addLabel()},H.Tick.prototype={addLabel:function(){var t,e,i,s,a,r=this,o=r.axis,l=o.options,h=o.chart,n=o.categories,d=o.names,c=r.pos,f=pick(r.options&&r.options.labels,l.labels),p=o.tickPositions,b=c===p[0],x=c===p[p.length-1],m=this.parameters.category||(n?pick(n[c],d[c],c):c),k=r.label,g=(!f.step||1===f.step)&&1===o.tickInterval,L=p.info;o.isDatetimeAxis&&L&&(e=(i=h.time.resolveDTLFormat(l.dateTimeLabelFormats[!l.grid&&L.higherRanks[c]||L.unitName])).main),r.isFirst=b,r.isLast=x,r.formatCtx={axis:o,chart:h,isFirst:b,isLast:x,dateTimeLabelFormat:e,tickPositionInfo:L,value:o.isLog?correctFloat(o.lin2log(m)):m,pos:c},t=o.labelFormatter.call(r.formatCtx,this.formatCtx),(a=i&&i.list)&&(r.shortenLabel=function(){for(s=0;s<a.length;s++)if(k.attr({text:o.labelFormatter.call(extend(r.formatCtx,{dateTimeLabelFormat:a[s]}))}),k.getBBox().width<o.getSlotWidth(r)-2*pick(f.padding,5))return;k.attr({text:""})}),g&&o._addedPlotLB&&o.isXAxis&&r.moveLabel(t,f),defined(k)||r.movedLabel?k&&k.textStr!==t&&!g&&(!k.textWidth||f.style&&f.style.width||k.styles.width||k.css({width:null}),k.attr({text:t}),k.textPxLength=k.getBBox().width):(r.label=k=r.createLabel({x:0,y:0},t,f),r.rotation=0)},moveLabel:function(t,e){var i,s,a,r=this,o=r.label,l=!1,h=r.axis,n=h.chart,d=h.reversed,c=n.inverted;o&&o.textStr===t?(r.movedLabel=o,l=!0,delete r.label):objectEach(h.ticks,function(e){l||e.isNew||e===r||!e.label||e.label.textStr!==t||(r.movedLabel=e.label,l=!0,e.labelPos=r.movedLabel.xy,delete e.label)}),l||!r.labelPos&&!o||(i=r.labelPos||o.xy,s=c?i.x:d?0:h.width+h.left,a=c?d?h.width+h.left:0:i.y,r.movedLabel=r.createLabel({x:s,y:a},t,e),r.movedLabel&&r.movedLabel.attr({opacity:0}))},createLabel:function(t,e,i){var s=this.axis,a=s.chart,r=defined(e)&&i.enabled?a.renderer.text(e,t.x,t.y,i.useHTML).add(s.labelGroup):null;return r&&(a.styledMode||r.css(merge(i.style)),r.textPxLength=r.getBBox().width),r},replaceMovedLabel:function(){var t,e,i=this.label,s=this.axis,a=s.reversed,r=this.axis.chart.inverted;i&&!this.isNew&&(t=r?i.xy.x:a?s.left:s.width+s.left,e=r?a?s.width+s.top:s.top:i.xy.y,i.animate({x:t,y:e,opacity:0},void 0,i.destroy),delete this.label),s.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},handleOverflow:function(t){var e,i,s=this.axis,a=s.options.labels,r=t.x,o=s.chart.chartWidth,l=s.chart.spacing,h=pick(s.labelLeft,Math.min(s.pos,l[3])),n=pick(s.labelRight,Math.max(s.isRadial?0:s.pos+s.len,o-l[1])),d=this.label,c=this.rotation,f={left:0,center:.5,right:1}[s.labelAlign||d.attr("align")],p=d.getBBox().width,b=s.getSlotWidth(this),x=b,m=f,k=1,g={};c||"justify"!==pick(a.overflow,"justify")?c<0&&r-f*p<h?i=Math.round(r/Math.cos(c*deg2rad)-h):c>0&&r+f*p>n&&(i=Math.round((o-r)/Math.cos(c*deg2rad))):(e=r+(1-f)*p,r-f*p<h?x=t.x+x*(1-f)-h:e>n&&(x=n-t.x+x*f,k=-1),(x=Math.min(b,x))<b&&"center"===s.labelAlign&&(t.x+=k*(b-x-m*(b-Math.min(p,x)))),(p>x||s.autoRotation&&(d.styles||{}).width)&&(i=x)),i&&(this.shortenLabel?this.shortenLabel():(g.width=Math.floor(i),(a.style||{}).textOverflow||(g.textOverflow="ellipsis"),d.css(g)))},getPosition:function(t,e,i,s){var a,r=this.axis,o=r.chart,l=s&&o.oldChartHeight||o.chartHeight;return(a={x:t?correctFloat(r.translate(e+i,null,null,s)+r.transB):r.left+r.offset+(r.opposite?(s&&o.oldChartWidth||o.chartWidth)-r.right-r.left:0),y:t?l-r.bottom+r.offset-(r.opposite?r.height:0):correctFloat(l-r.translate(e+i,null,null,s)-r.transB)}).y=clamp(a.y,-1e5,1e5),fireEvent(this,"afterGetPosition",{pos:a}),a},getLabelPosition:function(t,e,i,s,a,r,o,l){var h,n=this.axis,d=n.transA,c=n.isLinked&&n.linkedParent?n.linkedParent.reversed:n.reversed,f=n.staggerLines,p=n.tickRotCorr||{x:0,y:0},b=a.y,x=s||n.reserveSpaceDefault?0:-n.labelOffset*("center"===n.labelAlign?.5:1),m={};return defined(b)||(b=0===n.side?i.rotation?-8:-i.getBBox().height:2===n.side?p.y+8:Math.cos(i.rotation*deg2rad)*(p.y-i.getBBox(!1,0).height/2)),t=t+a.x+x+p.x-(r&&s?r*d*(c?-1:1):0),e=e+b-(r&&!s?r*d*(c?1:-1):0),f&&(h=o/(l||1)%f,n.opposite&&(h=f-h-1),e+=h*(n.labelOffset/f)),m.x=t,m.y=Math.round(e),fireEvent(this,"afterGetLabelPosition",{pos:m,tickmarkOffset:r,index:o}),m},getMarkPath:function(t,e,i,s,a,r){return r.crispLine(["M",t,e,"L",t+(a?0:-i),e+(a?i:0)],s)},renderGridLine:function(t,e,i){var s,a=this.axis,r=a.options,o=this.gridLine,l={},h=this.pos,n=this.type,d=pick(this.tickmarkOffset,a.tickmarkOffset),c=a.chart.renderer,f=n?n+"Grid":"grid",p=r[f+"LineWidth"],b=r[f+"LineColor"],x=r[f+"LineDashStyle"];o||(a.chart.styledMode||(l.stroke=b,l["stroke-width"]=p,x&&(l.dashstyle=x)),n||(l.zIndex=1),t&&(e=0),this.gridLine=o=c.path().attr(l).addClass("highcharts-"+(n?n+"-":"")+"grid-line").add(a.gridGroup)),o&&(s=a.getPlotLinePath({value:h+d,lineWidth:o.strokeWidth()*i,force:"pass",old:t}))&&o[t||this.isNew?"attr":"animate"]({d:s,opacity:e})},renderMark:function(t,e,i){var s=this.axis,a=s.options,r=s.chart.renderer,o=this.type,l=o?o+"Tick":"tick",h=s.tickSize(l),n=this.mark,d=!n,c=t.x,f=t.y,p=pick(a[l+"Width"],!o&&s.isXAxis?1:0),b=a[l+"Color"];h&&(s.opposite&&(h[0]=-h[0]),d&&(this.mark=n=r.path().addClass("highcharts-"+(o?o+"-":"")+"tick").add(s.axisGroup),s.chart.styledMode||n.attr({stroke:b,"stroke-width":p})),n[d?"attr":"animate"]({d:this.getMarkPath(c,f,h[0],n.strokeWidth()*i,s.horiz,r),opacity:e}))},renderLabel:function(t,e,i,s){var a=this.axis,r=a.horiz,o=a.options,l=this.label,h=o.labels,n=h.step,d=pick(this.tickmarkOffset,a.tickmarkOffset),c=!0,f=t.x,p=t.y;l&&isNumber(f)&&(l.xy=t=this.getLabelPosition(f,p,l,r,h,d,s,n),this.isFirst&&!this.isLast&&!pick(o.showFirstLabel,1)||this.isLast&&!this.isFirst&&!pick(o.showLastLabel,1)?c=!1:!r||h.step||h.rotation||e||0===i||this.handleOverflow(t),n&&s%n&&(c=!1),c&&isNumber(t.y)?(t.opacity=i,l[this.isNewLabel?"attr":"animate"](t),this.isNewLabel=!1):(l.attr("y",-9999),this.isNewLabel=!0))},render:function(t,e,i){var s=this.axis,a=s.horiz,r=this.pos,o=pick(this.tickmarkOffset,s.tickmarkOffset),l=this.getPosition(a,r,o,e),h=l.x,n=l.y,d=a&&h===s.pos+s.len||!a&&n===s.pos?-1:1;i=pick(i,1),this.isActive=!0,this.renderGridLine(e,i,d),this.renderMark(l,i,d),this.renderLabel(l,e,i,t),this.isNew=!1,H.fireEvent(this,"afterRender")},destroy:function(){destroyObjectProperties(this,this.axis)}};