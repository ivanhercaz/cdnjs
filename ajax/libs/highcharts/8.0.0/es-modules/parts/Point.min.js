"use strict";import Highcharts from"./Globals.js";import U from"./Utilities.js";var Point,animObject=U.animObject,defined=U.defined,erase=U.erase,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,syncTimeout=U.syncTimeout,pick=U.pick,H=Highcharts,fireEvent=H.fireEvent,format=H.format,uniqueKey=H.uniqueKey,removeEvent=H.removeEvent;Highcharts.Point=Point=function(){},Highcharts.Point.prototype={init:function(t,e,o){return this.series=t,this.applyOptions(e,o),this.id=defined(this.id)?this.id:uniqueKey(),this.resolveColor(),t.chart.pointCount++,fireEvent(this,"afterInit"),this},resolveColor:function(){var t,e,o=this.series,i=o.chart.options.chart.colorCount,s=o.chart.styledMode;s||this.options.color||(this.color=o.color),o.options.colorByPoint?(s||(t=o.options.colors||o.chart.options.colors,this.color=this.color||t[o.colorCounter],i=t.length),e=o.colorCounter,o.colorCounter++,o.colorCounter===i&&(o.colorCounter=0)):e=o.colorIndex,this.colorIndex=pick(this.colorIndex,e)},applyOptions:function(t,e){var o=this.series,i=o.options.pointValKey||o.pointValKey;return t=Point.prototype.optionsToObject.call(this,t),extend(this,t),this.options=this.options?extend(this.options,t):t,t.group&&delete this.group,t.dataLabels&&delete this.dataLabels,i&&(this.y=this[i]),this.isNull=pick(this.isValid&&!this.isValid(),null===this.x||!isNumber(this.y)),this.formatPrefix=this.isNull?"null":"point",this.selected&&(this.state="select"),"name"in this&&void 0===e&&o.xAxis&&o.xAxis.hasNames&&(this.x=o.xAxis.nameToX(this)),void 0===this.x&&o&&(this.x=void 0===e?o.autoIncrement(this):e),this},setNestedProperty:function(t,e,o){return o.split(".").reduce(function(t,o,i,s){var r=s.length-1===i;return t[o]=r?e:isObject(t[o],!0)?t[o]:{},t[o]},t),t},optionsToObject:function(t){var e,o={},i=this.series,s=i.options.keys,r=s||i.pointArrayMap||["y"],n=r.length,a=0,h=0;if(isNumber(t)||null===t)o[r[0]]=t;else if(isArray(t))for(!s&&t.length>n&&("string"===(e=typeof t[0])?o.name=t[0]:"number"===e&&(o.x=t[0]),a++);h<n;)s&&void 0===t[a]||(r[h].indexOf(".")>0?H.Point.prototype.setNestedProperty(o,t[a],r[h]):o[r[h]]=t[a]),a++,h++;else"object"==typeof t&&(o=t,t.dataLabels&&(i._hasPointLabels=!0),t.marker&&(i._hasPointMarkers=!0));return o},getClassName:function(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(void 0!==this.colorIndex?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")},getZone:function(){var t,e=this.series,o=e.zones,i=e.zoneAxis||"y",s=0;for(t=o[s];this[i]>=t.value;)t=o[++s];return this.nonZonedColor||(this.nonZonedColor=this.color),t&&t.color&&!this.options.color?this.color=t.color:this.color=this.nonZonedColor,t},hasNewShapeType:function(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType},destroy:function(){var t,e=this,o=e.series,i=o.chart,s=o.options.dataSorting,r=i.hoverPoints,n=e.series.chart.renderer.globalAnimation,a=animObject(n);function h(){for(t in r&&(e.setState(),erase(r,e),r.length||(i.hoverPoints=null)),e===i.hoverPoint&&e.onMouseOut(),(e.graphic||e.dataLabel||e.dataLabels)&&(removeEvent(e),e.destroyElements()),e)e[t]=null}s&&s.enabled?(this.animateBeforeDestroy(),syncTimeout(h,a.duration)):h(),i.pointCount--,e.legendItem&&i.legend.destroyItem(e)},animateBeforeDestroy:function(){var t,e=this,o={x:e.startXPos,opacity:0},i=e.getGraphicalProps();i.singular.forEach(function(i){t="dataLabel"===i,e[i]=e[i].animate(t?{x:e[i].startXPos,y:e[i].startYPos,opacity:0}:o)}),i.plural.forEach(function(t){e[t].forEach(function(t){t.element&&t.animate(extend({x:e.startXPos},t.startYPos?{x:t.startXPos,y:t.startYPos}:{}))})})},destroyElements:function(t){var e=this,o=e.getGraphicalProps(t);o.singular.forEach(function(t){e[t]=e[t].destroy()}),o.plural.forEach(function(t){e[t].forEach(function(t){t.element&&t.destroy()}),delete e[t]})},getGraphicalProps:function(t){var e,o,i=this,s=[],r={singular:[],plural:[]};for((t=t||{graphic:1,dataLabel:1}).graphic&&s.push("graphic","shadowGroup"),t.dataLabel&&s.push("dataLabel","dataLabelUpper","connector"),o=s.length;o--;)e=s[o],i[e]&&r.singular.push(e);return["dataLabel","connector"].forEach(function(e){var o=e+"s";t[e]&&i[o]&&r.plural.push(o)}),r},getLabelConfig:function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(t){var e=this.series,o=e.tooltipOptions,i=pick(o.valueDecimals,""),s=o.valuePrefix||"",r=o.valueSuffix||"";return e.chart.styledMode&&(t=e.chart.tooltip.styledModeFormat(t)),(e.pointArrayMap||["y"]).forEach(function(e){e="{point."+e,(s||r)&&(t=t.replace(RegExp(e+"}","g"),s+e+"}"+r)),t=t.replace(RegExp(e+"}","g"),e+":,."+i+"f}")}),format(t,{point:this,series:this.series},e.chart)},firePointEvent:function(t,e,o){var i=this,s=this.series.options;(s.point.events[t]||i.options&&i.options.events&&i.options.events[t])&&this.importEvents(),"click"===t&&s.allowPointSelect&&(o=function(t){i.select&&i.select(null,t.ctrlKey||t.metaKey||t.shiftKey)}),fireEvent(this,t,e,o)},visible:!0};