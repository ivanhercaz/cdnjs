"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var correctFloat=U.correctFloat,defined=U.defined,extend=U.extend,pick=U.pick,pInt=U.pInt,relativeLength=U.relativeLength,wrap=U.wrap;import"../parts/Axis.js";import"../parts/Tick.js";import"./Pane.js";var hiddenAxisMixin,radialAxisMixin,addEvent=H.addEvent,Axis=H.Axis,merge=H.merge,noop=H.noop,Tick=H.Tick,axisProto=Axis.prototype,tickProto=Tick.prototype;hiddenAxisMixin={getOffset:noop,redraw:function(){this.isDirty=!1},render:function(){this.isDirty=!1},createLabelCollector:function(){return!1},setScale:noop,setCategories:noop,setTitle:noop},radialAxisMixin={defaultRadialGaugeOptions:{labels:{align:"center",x:0,y:null},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},defaultCircularOptions:{gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null,style:{textOverflow:"none"}},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},defaultRadialOptions:{gridLineInterpolation:"circle",gridLineWidth:1,labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}},setOptions:function(t){var i=this.options=merge(this.defaultOptions,this.defaultPolarOptions,t);i.plotBands||(i.plotBands=[]),H.fireEvent(this,"afterSetOptions")},getOffset:function(){axisProto.getOffset.call(this),this.chart.axisOffset[this.side]=0},getLinePath:function(t,i){var s,e,a=this.center,n=this.chart,o=pick(i,a[2]/2-this.offset);return this.isCircular||void 0!==i?((e=this.chart.renderer.symbols.arc(this.left+a[0],this.top+a[1],o,o,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})).xBounds=[this.left+a[0]],e.yBounds=[this.top+a[1]-o]):(s=this.postTranslate(this.angleRad,o),e=["M",a[0]+n.plotLeft,a[1]+n.plotTop,"L",s.x,s.y]),e},setAxisTranslation:function(){axisProto.setAxisTranslation.call(this),this.center&&(this.isCircular?this.transA=(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.transA=this.center[2]/2/(this.max-this.min||1),this.isXAxis?this.minPixelPadding=this.transA*this.minPointOffset:this.minPixelPadding=0)},beforeSetTickPositions:function(){this.autoConnect=this.isCircular&&void 0===pick(this.userMax,this.options.max)&&correctFloat(this.endAngleRad-this.startAngleRad)===correctFloat(2*Math.PI),!this.isCircular&&this.chart.inverted&&this.max++,this.autoConnect&&(this.max+=(this.categories?1:this.pointRange)||this.closestPointRange||0)},setAxisSize:function(){axisProto.setAxisSize.call(this),this.isRadial&&(this.pane.updateCenter(this),this.isCircular&&(this.sector=this.endAngleRad-this.startAngleRad),this.len=this.width=this.height=this.center[2]*pick(this.sector,1)/2)},getPosition:function(t,i){var s=this.translate(t);return this.postTranslate(this.isCircular?s:this.angleRad,pick(this.isCircular?i:s<0?0:s,this.center[2]/2)-this.offset)},postTranslate:function(t,i){var s=this.chart,e=this.center;return t=this.startAngleRad+t,{x:s.plotLeft+e[0]+Math.cos(t)*i,y:s.plotTop+e[1]+Math.sin(t)*i}},getPlotBandPath:function(t,i,s){var e,a,n,o,r,h,l=this.center,c=this.startAngleRad,d=l[2]/2,p=[pick(s.outerRadius,"100%"),s.innerRadius,pick(s.thickness,10)],u=Math.min(this.offset,0),g=/%$/,f=this.isCircular;return"polygon"===this.options.gridLineInterpolation?h=this.getPlotLinePath({value:t}).concat(this.getPlotLinePath({value:i,reverse:!0})):(t=Math.max(t,this.min),i=Math.min(i,this.max),f||(p[0]=this.translate(t),p[1]=this.translate(i)),p=p.map(function(t){return g.test(t)&&(t=pInt(t,10)*d/100),t}),"circle"!==s.shape&&f?(e=c+this.translate(t),a=c+this.translate(i)):(e=-Math.PI/2,a=1.5*Math.PI,r=!0),p[0]-=u,p[2]-=u,h=this.chart.renderer.symbols.arc(this.left+l[0],this.top+l[1],p[0],p[0],{start:Math.min(e,a),end:Math.max(e,a),innerR:pick(p[1],p[0]-p[2]),open:r}),f&&(n=(a+e)/2,o=this.left+l[0]+l[2]/2*Math.cos(n),h.xBounds=n>-Math.PI/2&&n<Math.PI/2?[o,this.chart.plotWidth]:[0,o],h.yBounds=[this.top+l[1]+l[2]/2*Math.sin(n)],h.yBounds[0]+=n>-Math.PI&&n<0||n>Math.PI?-10:10)),h},getCrosshairPosition:function(t,i,s){var e,a,n,o=t.value;return this.isCircular?(defined(o)?t.point&&(t.point.shapeArgs||{}).start&&(o=this.translate(t.point.rectPlotY,!0)):(a=t.chartX||0,n=t.chartY||0,o=this.translate(Math.atan2(n-s,a-i)-this.startAngleRad,!0)),a=(e=this.getPosition(o)).x,n=e.y):(defined(o)||(a=t.chartX,n=t.chartY),defined(a)&&defined(n)&&(o=this.translate(Math.min(Math.sqrt(Math.pow(a-i,2)+Math.pow(n-s,2)),this.len),!0))),[o,a||0,n||0]},getPlotLinePath:function(t){var i,s,e,a,n,o,r,h=this,l=h.center,c=h.chart,d=c.inverted,p=t.value,u=t.reverse,g=h.getPosition(p),f=h.pane.options.background?h.pane.options.background[0]||h.pane.options.background:{},x=f.innerRadius||"0%",P=f.outerRadius||"100%",A=l[0]+c.plotLeft,v=l[1]+c.plotTop,M=g.x,m=g.y;return t.isCrosshair&&(o=this.getCrosshairPosition(t,A,v),p=o[0],M=o[1],m=o[2]),h.isCircular?(i="string"==typeof x?relativeLength(x,1):x/Math.sqrt(Math.pow(M-A,2)+Math.pow(m-v,2)),s="string"==typeof P?relativeLength(P,1):P/Math.sqrt(Math.pow(M-A,2)+Math.pow(m-v,2)),r=["M",A+i*(M-A),v-i*(v-m),"L",M-(1-s)*(M-A),m+(1-s)*(v-m)]):(p=h.translate(p),!t.isCrosshair&&(p<0||p>h.height)&&d&&(p=0),"circle"===h.options.gridLineInterpolation?r=h.getLinePath(0,p):(c[d?"yAxis":"xAxis"].forEach(function(t){t.pane===h.pane&&(e=t)}),r=[],n=e.tickPositions,e.autoConnect&&(n=n.concat([n[0]])),u&&(n=[].concat(n).reverse()),n.forEach(function(t,i){a=e.getPosition(t,p),r.push(i?"L":"M",a.x,a.y)}))),r},getTitlePosition:function(){var t=this.center,i=this.chart,s=this.options.title;return{x:i.plotLeft+t[0]+(s.x||0),y:i.plotTop+t[1]-{high:.5,middle:.25,low:0}[s.align]*t[2]+(s.y||0)}},createLabelCollector:function(){var t=this;return function(){if(t.isRadial&&t.tickPositions&&!0!==t.options.labels.allowOverlap)return t.tickPositions.map(function(i){return t.ticks[i]&&t.ticks[i].label}).filter(function(t){return Boolean(t)})}}},addEvent(Axis,"init",function(t){var i,s=this.chart,e=s.inverted,a=s.angular,n=s.polar,o=this.isXAxis,r=this.coll,h=a&&o,l=s.options,c=t.userOptions.pane||0,d=this.pane=s.pane&&s.pane[c];"colorAxis"!==r?(a?(extend(this,h?hiddenAxisMixin:radialAxisMixin),(i=!o)&&(this.defaultPolarOptions=this.defaultRadialGaugeOptions)):n&&(extend(this,radialAxisMixin),i=this.horiz,this.defaultPolarOptions=i?this.defaultCircularOptions:merge("xAxis"===r?this.defaultOptions:this.defaultYAxisOptions,this.defaultRadialOptions),e&&"yAxis"===r&&(this.defaultPolarOptions.stackLabels=this.defaultYAxisOptions.stackLabels)),a||n?(this.isRadial=!0,l.chart.zoomType=null,this.labelCollector||(this.labelCollector=this.createLabelCollector()),this.labelCollector&&s.labelCollectors.push(this.labelCollector)):this.isRadial=!1,d&&i&&(d.axis=this),this.isCircular=i):this.isRadial=!1}),addEvent(Axis,"afterInit",function(){var t=this.chart,i=this.options,s=t.angular&&this.isXAxis,e=this.pane,a=e&&e.options;!s&&e&&(t.angular||t.polar)&&(this.angleRad=(i.angle||0)*Math.PI/180,this.startAngleRad=(a.startAngle-90)*Math.PI/180,this.endAngleRad=(pick(a.endAngle,a.startAngle+360)-90)*Math.PI/180,this.offset=i.offset||0)}),addEvent(Axis,"autoLabelAlign",function(t){this.isRadial&&(t.align=void 0,t.preventDefault())}),addEvent(Axis,"destroy",function(){if(this.chart&&this.chart.labelCollectors){var t=this.chart.labelCollectors.indexOf(this.labelCollector);t>=0&&this.chart.labelCollectors.splice(t,1)}}),addEvent(Tick,"afterGetPosition",function(t){this.axis.getPosition&&extend(t.pos,this.axis.getPosition(this.pos))}),addEvent(Tick,"afterGetLabelPosition",function(t){var i,s=this.axis,e=this.label,a=e.getBBox(),n=s.options.labels,o=n.y,r=20,h=n.align,l=(s.translate(this.pos)+s.startAngleRad+Math.PI/2)/Math.PI*180%360,c=Math.round(l),d="end",p=c<0?c+360:c,u=p,g=0,f=0,x=null===n.y?.3*-a.height:0;s.isRadial&&(i=s.getPosition(this.pos,s.center[2]/2+relativeLength(pick(n.distance,-25),s.center[2]/2,-s.center[2]/2)),"auto"===n.rotation?e.attr({rotation:l}):null===o&&(o=s.chart.renderer.fontMetrics(e.styles&&e.styles.fontSize).b-a.height/2),null===h&&(s.isCircular?(a.width>s.len*s.tickInterval/(s.max-s.min)&&(r=0),h=l>r&&l<180-r?"left":l>180+r&&l<360-r?"right":"center"):h="center",e.attr({align:h})),"auto"===h&&2===s.tickPositions.length&&s.isCircular&&(p>90&&p<180?p=180-p:p>270&&p<=360&&(p=540-p),u>180&&u<=360&&(u=360-u),s.pane.options.startAngle!==c&&s.pane.options.startAngle!==c+360&&s.pane.options.startAngle!==c-360||(d="start"),h=c>=-90&&c<=90||c>=-360&&c<=-270||c>=270&&c<=360?"start"===d?"right":"left":"start"===d?"left":"right",u>70&&u<110&&(h="center"),p<15||p>=180&&p<195?g=.3*a.height:p>=15&&p<=35?g="start"===d?0:.75*a.height:p>=195&&p<=215?g="start"===d?.75*a.height:0:p>35&&p<=90?g="start"===d?.25*-a.height:a.height:p>215&&p<=270&&(g="start"===d?a.height:.25*-a.height),u<15?f="start"===d?.15*-a.height:.15*a.height:u>165&&u<=180&&(f="start"===d?.15*a.height:.15*-a.height),e.attr({align:h}),e.translate(f,g+x)),t.pos.x=i.x+n.x,t.pos.y=i.y+o)}),wrap(tickProto,"getMarkPath",function(t,i,s,e,a,n,o){var r,h=this.axis;return h.isRadial?["M",i,s,"L",(r=h.getPosition(this.pos,h.center[2]/2+e)).x,r.y]:t.call(this,i,s,e,a,n,o)});