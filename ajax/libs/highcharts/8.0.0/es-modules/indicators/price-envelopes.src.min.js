"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var isArray=U.isArray,merge=H.merge,SMA=H.seriesTypes.sma;H.seriesType("priceenvelopes","sma",{marker:{enabled:!1},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span><b> {series.name}</b><br/>Top: {point.top}<br/>Middle: {point.middle}<br/>Bottom: {point.bottom}<br/>'},params:{period:20,topBand:.1,bottomBand:.1},bottomLine:{styles:{lineWidth:1,lineColor:void 0}},topLine:{styles:{lineWidth:1}},dataGrouping:{approximation:"averages"}},{nameComponents:["period","topBand","bottomBand"],nameBase:"Price envelopes",pointArrayMap:["top","middle","bottom"],parallelArrays:["x","y","top","bottom"],pointValKey:"middle",init:function(){SMA.prototype.init.apply(this,arguments),this.options=merge({topLine:{styles:{lineColor:this.color}},bottomLine:{styles:{lineColor:this.color}}},this.options)},toYData:function(t){return[t.top,t.middle,t.bottom]},translate:function(){var t=this,o=["plotTop","plotMiddle","plotBottom"];SMA.prototype.translate.apply(t),t.points.forEach(function(p){[p.top,p.middle,p.bottom].forEach(function(i,a){null!==i&&(p[o[a]]=t.yAxis.toPixels(i,!0))})})},drawGraph:function(){for(var t,o=this,p=o.points,i=p.length,a=o.options,e=o.graph,r={options:{gapSize:a.gapSize}},l=[[],[]];i--;)t=p[i],l[0].push({plotX:t.plotX,plotY:t.plotTop,isNull:t.isNull}),l[1].push({plotX:t.plotX,plotY:t.plotBottom,isNull:t.isNull});["topLine","bottomLine"].forEach(function(t,p){o.points=l[p],o.options=merge(a[t].styles,r),o.graph=o["graph"+t],SMA.prototype.drawGraph.call(o),o["graph"+t]=o.graph}),o.points=p,o.options=a,o.graph=e,SMA.prototype.drawGraph.call(o)},getValues:function(t,o){var p,i,a,e,r,l,s,n,m=o.period,d=o.topBand,h=o.bottomBand,y=t.xData,u=t.yData,c=u?u.length:0,g=[],b=[],f=[];if(!(y.length<m)&&isArray(u[0])&&4===u[0].length){for(n=m;n<=c;n++)r=y.slice(n-m,n),l=u.slice(n-m,n),e=(s=SMA.prototype.getValues.call(this,{xData:r,yData:l},o)).xData[0],i=(p=s.yData[0])*(1+d),a=p*(1-h),g.push([e,i,p,a]),b.push(e),f.push([i,p,a]);return{values:g,xData:b,yData:f}}}});