!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}t(o=o?o._modules:{},"mixins/nodes.js",[o["parts/Globals.js"],o["parts/Utilities.js"]],function(s,o){var i=o.defined,r=o.extend,a=o.pick,n=s.Point;s.NodesMixin={createNode:function(o){function t(o,t){return s.find(o,function(o){return o.id===t})}var n=t(this.nodes,o),e=this.pointClass;if(!n){var i=this.options.nodes&&t(this.options.nodes,o);(n=(new e).init(this,r({className:"highcharts-node",isNode:!0,id:o,y:1},i))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id,n.mass=a(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)}return n},generatePoints:function(){var t=this.chart,e={};s.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){i(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=a(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),i(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),s.Series.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),s.Series.prototype.destroy.apply(this,arguments)},setNodeState:function(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o.series&&(n.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&n.prototype.setState.apply(o.fromNode,t),o.toNode.graphic&&n.prototype.setState.apply(o.toNode,t)))}),n.prototype.setState.apply(this,t)}}}),t(o,"mixins/tree-series.js",[o["parts/Globals.js"],o["parts/Utilities.js"]],function(m,o){var d=o.extend,r=o.isArray,a=o.isNumber,l=o.isObject,v=o.pick,h=m.merge;return{getColor:function(o,t){var e,i=t.index,n=t.mapOptionsToLevel,s=t.parentColor,r=t.parentColorIndex,a=t.series,l=t.colors,h=t.siblings,d=a.points,c=a.chart.options.chart;if(o){if(d=d[o.i],o=n[o.level]||{},n=d&&o.colorByPoint)var p=d.index%(l?l.length:c.colorCount),u=l&&l[p];a.chart.styledMode||(l=d&&d.options.color,c=o&&o.color,(e=s)&&(e=(e=o&&o.colorVariation)&&"brightness"===e.key?m.color(s).brighten(i/h*e.to).get():s),e=v(l,c,u,e,a.color));var f=v(d&&d.options.colorIndex,o&&o.colorIndex,p,r,t.colorIndex)}return{color:e,colorIndex:f}},getLevelOptions:function(o){var t=null;if(l(o)){t={};var n=a(o.from)?o.from:1,e=o.levels,i={},s=l(o.defaults)?o.defaults:{};for(r(e)&&(i=e.reduce(function(o,t){if(l(t)&&a(t.level)){var e=h({},t),i="boolean"==typeof e.levelIsConstant?e.levelIsConstant:s.levelIsConstant;delete e.levelIsConstant,delete e.level,t=t.level+(i?0:n-1),l(o[t])?d(o[t],e):o[t]=e}return o},{})),e=a(o.to)?o.to:1,o=0;o<=e;o++)t[o]=h({},s,l(i[o])?i[o]:{})}return t},setTreeValues:function i(n,s){var o=s.before,t=s.idRoot,e=s.mapIdToNode[t],r=s.points[n.i],a=r&&r.options||{},l=0,h=[];return d(n,{levelDynamic:n.level-("boolean"!=typeof s.levelIsConstant||s.levelIsConstant?0:e.level),name:v(r&&r.name,""),visible:t===n.id||"boolean"==typeof s.visible&&s.visible}),"function"==typeof o&&(n=o(n,s)),n.children.forEach(function(o,t){var e=d({},s);d(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),h.push(o),o.visible&&(l+=o.val)}),n.visible=0<l||n.visible,o=v(a.value,l),d(n,{children:h,childrenTotal:l,isLeaf:n.visible&&!l,val:o}),n},updateRootId:function(o){if(l(o)){var t=l(o.options)?o.options:{};t=v(o.rootNode,t.rootId,""),l(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t}return t}}}),t(o,"modules/sankey.src.js",[o["parts/Globals.js"],o["parts/Utilities.js"],o["mixins/tree-series.js"]],function(a,o,t){var r=o.defined,h=o.isObject,d=o.pick,l=o.relativeLength,c=t.getLevelOptions,p=a.find,u=a.merge;o=a.seriesType;var e=a.Point;o("sankey","column",{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,invertable:!0,forceDL:!0,orderNodes:!0,pointArrayMap:["from","to"],createNode:a.NodesMixin.createNode,setData:a.NodesMixin.setData,destroy:a.NodesMixin.destroy,getNodePadding:function(){return this.options.nodePadding},createNodeColumn:function(){var t=this.chart,s=[],r=this.getNodePadding();return s.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},s.offset=function(o,t){for(var e,i=0,n=0;n<s.length;n++){if(e=s[n].getSum()*t+r,s[n]===o)return{relativeTop:i+l(o.options.offset||0,e)};i+=e}},s.top=function(e){var o=this.reduce(function(o,t){return 0<o&&(o+=r),o+t.getSum()*e},0);return(t.plotSizeY-o)/2},s},createNodeColumns:function(){var s=[];this.nodes.forEach(function(e){var i,o=-1;if(!r(e.options.column))if(0===e.linksTo.length)e.column=0;else{for(i=0;i<e.linksTo.length;i++){var t=e.linksTo[0];if(t.fromNode.column>o){var n=t.fromNode;o=n.column}}e.column=o+1,n&&"hanging"===n.options.layout&&(e.hangsFrom=n,i=-1,p(n.linksFrom,function(o,t){return(o=o.toNode===e)&&(i=t),o}),e.column+=i)}s[e.column]||(s[e.column]=this.createNodeColumn()),s[e.column].push(e)},this);for(var o=0;o<s.length;o++)void 0===s[o]&&(s[o]=this.createNodeColumn());return s},hasData:function(){return!!this.processedXData.length},pointAttribs:function(o,t){var e=this,i=e.mapOptionsToLevel[(o.isNode?o.level:o.fromNode.level)||0]||{},n=o.options,s=i.states&&i.states[t]||{};t=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=d(s[t],n[t],i[t],e.options[t]),o},{});var r=d(s.color,n.color,t.colorByPoint?o.color:i.color);return o.isNode?{fill:r,stroke:t.borderColor,"stroke-width":t.borderWidth}:{fill:a.color(r).setOpacity(t.linkOpacity).get()}},generatePoints:function(){a.NodesMixin.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){t(o.toNode,e+1)}))}(o,0)}),a.stableSort(this.nodes,function(o,t){return o.level-t.level}))},translateNode:function(o,t){var e=this.translationFactor,i=this.chart,n=this.options,s=o.getSum(),r=Math.round(s*e),a=Math.round(n.borderWidth)%2/2,l=t.offset(o,e);t=Math.floor(d(l.absoluteTop,t.top(e)+l.relativeTop))+a,a=Math.floor(this.colDistance*o.column+n.borderWidth/2)+a,a=i.inverted?i.plotSizeX-a:a,e=Math.round(this.nodeWidth),o.sum=s,o.shapeType="rect",o.nodeX=a,o.nodeY=t,o.shapeArgs=i.inverted?{x:a-e,y:i.plotSizeY-t-r,width:o.options.height||n.height||e,height:o.options.width||n.width||r}:{x:a,y:t,width:o.options.width||n.width||e,height:o.options.height||n.height||r},o.shapeArgs.display=o.hasShape()?"":"none",i=this.mapOptionsToLevel[o.level],n=o.options,n=h(n)?n.dataLabels:{},i=h(i)?i.dataLabels:{},i=u({style:{}},i,n),o.dlOptions=i,o.plotY=1},translateLink:function(o){var t=o.fromNode,e=o.toNode,i=this.chart,n=this.translationFactor,s=Math.max(o.weight*n,this.options.minLinkWidth),r=this.options,a=t.offset(o,"linksFrom")*n,l=(i.inverted?-this.colDistance:this.colDistance)*r.curveFactor;a=t.nodeY+a,r=t.nodeX,n=this.nodeColumns[e.column].top(n)+e.offset(o,"linksTo")*n+this.nodeColumns[e.column].offset(e,n).relativeTop;var h=this.nodeWidth;e=e.column*this.colDistance;var d=o.outgoing,c=r<e;if(i.inverted&&(a=i.plotSizeY-a,n=i.plotSizeY-n,h=-h,s=-s,c=(e=i.plotSizeX-e)<r),o.shapeType="path",o.linkBase=[a,a+s,n,n+s],c)o.shapeArgs={d:["M",r+h,a,"C",r+h+l,a,e-l,n,e,n,"L",e+(d?h:0),n+s/2,"L",e,n+s,"C",e-l,n+s,r+h+l,a+s,r+h,a+s,"z"]};else{l=e-20-s,d=e-20,c=e;var p=r+h,u=p+20,f=u+s,m=a+s,v=m+20,g=(i=v+(i.plotHeight-a-s))+20,y=g+s,b=n+s,N=b+20,k=g+.7*s,C=c-.7*s,x=p+.7*s;o.shapeArgs={d:["M",p,a,"C",x,a,f,m-.7*s,f,v,"L",f,i,"C",f,k,x,y,p,y,"L",c,y,"C",C,y,l,k,l,i,"L",l,N,"C",l,b-.7*s,C,n,c,n,"L",c,b,"C",d,b,d,b,d,N,"L",d,i,"C",d,g,d,g,c,g,"L",p,g,"C",u,g,u,g,u,i,"L",u,v,"C",u,m,u,m,p,m,"z"]}}o.dlBox={x:r+(e-r+h)/2,y:a+(n-a)/2,height:s,width:0},o.y=o.plotY=1,o.color||(o.color=t.color)},translate:function(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=l(this.options.nodeWidth,this.chart.plotSizeX);var e=this,i=this.chart,n=this.options,o=this.nodeWidth,t=this.nodeColumns,s=this.getNodePadding();this.translationFactor=t.reduce(function(o,t){return Math.min(o,(i.plotSizeY-n.borderWidth-(t.length-1)*s)/t.sum())},1/0),this.colDistance=(i.plotSizeX-o-n.borderWidth)/Math.max(1,t.length-1),e.mapOptionsToLevel=c({from:1,levels:n.levels,to:t.length-1,defaults:{borderColor:n.borderColor,borderRadius:n.borderRadius,borderWidth:n.borderWidth,color:e.color,colorByPoint:n.colorByPoint,levelIsConstant:!0,linkColor:n.linkColor,linkLineWidth:n.linkLineWidth,linkOpacity:n.linkOpacity,states:n.states}}),t.forEach(function(t){t.forEach(function(o){e.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){e.translateLink(o),o.allowShadow=!1})})},render:function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),a.seriesTypes.column.prototype.render.call(this),this.points=o},animate:a.Series.prototype.animate},{applyOptions:function(o,t){return e.prototype.applyOptions.call(this,o,t),r(this.options.level)&&(this.options.column=this.column=this.options.level),this},setState:a.NodesMixin.setNodeState,getClassName:function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})}),t(o,"masters/modules/sankey.src.js",[],function(){})});