"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var addEvent=U.addEvent,extend=U.extend,find=U.find,fireEvent=U.fireEvent,isArray=U.isArray,pick=U.pick;import"../parts/Axis.js";import"../parts/Series.js";var Axis=H.Axis,Series=H.Series,findBreakAt=function(i,t){return find(t,function(t){return t.from<i&&i<t.to})};extend(Axis.prototype,{isInBreak:function(i,t){var e=i.repeat||1/0,r=i.from,s=i.to-i.from,n=t>=r?(t-r)%e:e-(r-t)%e;return i.inclusive?n<=s:n<s&&0!==n},isInAnyBreak:function(i,t){var e,r,s,n=this.options.breaks,o=n&&n.length;if(o){for(;o--;)this.isInBreak(n[o],i)&&(e=!0,r||(r=pick(n[o].showPoints,!this.isXAxis)));s=e&&t?e&&!r:e}return s}}),addEvent(Axis,"afterInit",function(){"function"==typeof this.setBreaks&&this.setBreaks(this.options.breaks,!1)}),addEvent(Axis,"afterSetTickPositions",function(){if(this.isBroken){var i,t=this.tickPositions,e=this.tickPositions.info,r=[];for(i=0;i<t.length;i++)this.isInAnyBreak(t[i])||r.push(t[i]);this.tickPositions=r,this.tickPositions.info=e}}),addEvent(Axis,"afterSetOptions",function(){this.isBroken&&(this.options.ordinal=!1)}),Axis.prototype.setBreaks=function(i,t){var e=this,r=isArray(i)&&!!i.length;function s(i){var t,r,s=i;for(r=0;r<e.breakArray.length;r++)if((t=e.breakArray[r]).to<=i)s-=t.len;else{if(t.from>=i)break;if(e.isInBreak(t,i)){s-=i-t.from;break}}return s}e.isDirty=e.isBroken!==r,e.isBroken=r,e.options.breaks=e.userOptions.breaks=i,e.forceRedraw=!0,e.series.forEach(function(i){i.isDirty=!0}),r||e.val2lin!==s||(delete e.val2lin,delete e.lin2val),r&&(e.userOptions.ordinal=!1,e.val2lin=s,e.lin2val=function(i){var t,r,s=i;for(r=0;r<e.breakArray.length&&!((t=e.breakArray[r]).from>=s);r++)t.to<s?s+=t.len:e.isInBreak(t,s)&&(s+=t.len);return s},e.setExtremes=function(i,t,e,r,s){if(this.isBroken){for(var n,o=this.options.breaks;n=findBreakAt(i,o);)i=n.to;for(;n=findBreakAt(t,o);)t=n.from;t<i&&(t=i)}Axis.prototype.setExtremes.call(this,i,t,e,r,s)},e.setAxisTranslation=function(i){if(Axis.prototype.setAxisTranslation.call(this,i),this.unitLength=null,this.isBroken){var t,r,s,n,o=e.options.breaks,a=[],f=[],p=0,h=e.userMin||e.min,l=e.userMax||e.max,c=pick(e.pointRangePadding,0);o.forEach(function(i){r=i.repeat||1/0,e.isInBreak(i,h)&&(h+=i.to%r-h%r),e.isInBreak(i,l)&&(l-=l%r-i.from%r)}),o.forEach(function(i){for(s=i.from,r=i.repeat||1/0;s-r>h;)s-=r;for(;s<h;)s+=r;for(n=s;n<l;n+=r)a.push({value:n,move:"in"}),a.push({value:n+(i.to-i.from),move:"out",size:i.breakSize})}),a.sort(function(i,t){return i.value===t.value?("in"===i.move?0:1)-("in"===t.move?0:1):i.value-t.value}),t=0,s=h,a.forEach(function(i){1===(t+="in"===i.move?1:-1)&&"in"===i.move&&(s=i.value),0===t&&(f.push({from:s,to:i.value,len:i.value-s-(i.size||0)}),p+=i.value-s-(i.size||0))}),e.breakArray=f,e.unitLength=l-h-p+c,fireEvent(e,"afterBreaks"),e.staticScale?e.transA=e.staticScale:e.unitLength&&(e.transA*=(l-e.min+c)/e.unitLength),c&&(e.minPixelPadding=e.transA*e.minPointOffset),e.min=h,e.max=l}}),pick(t,!0)&&this.chart.redraw()},addEvent(Series,"afterGeneratePoints",function(){var i=this,t=i.isDirty,e=i.options.connectNulls,r=i.points,s=i.xAxis,n=i.yAxis;if(t)for(var o=r.length;o--;){var a=r[o],f=!(null===a.y&&!1===e)&&(s&&s.isInAnyBreak(a.x,!0)||n&&n.isInAnyBreak(a.y,!0));a.visible=!f&&!1!==a.options.visible}}),addEvent(Series,"afterRender",function(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,pick(this.pointArrayMap,["y"]))}),H.Series.prototype.drawBreaks=function(i,t){var e,r,s,n,o=this,a=o.points;i&&t.forEach(function(t){e=i.breakArray||[],r=i.isXAxis?i.min:pick(o.options.threshold,i.min),a.forEach(function(o){n=pick(o["stack"+t.toUpperCase()],o[t]),e.forEach(function(t){s=!1,r<t.from&&n>t.to||r>t.from&&n<t.from?s="pointBreak":(r<t.from&&n>t.from&&n<t.to||r>t.from&&n>t.to&&n<t.from)&&(s="pointInBreak"),s&&fireEvent(i,s,{point:o,brk:t})})})})},H.Series.prototype.gappedPath=function(){var i=this.currentDataGrouping,t=i&&i.gapSize,e=this.options.gapSize,r=this.points.slice(),s=r.length-1,n=this.yAxis;if(e&&s>0){"value"!==this.options.gapUnit&&(e*=this.basePointRange),t&&t>e&&t>=this.basePointRange&&(e=t);for(var o=void 0,a=void 0;s--;)if(a&&!1!==a.visible||(a=r[s+1]),o=r[s],!1!==a.visible&&!1!==o.visible){if(a.x-o.x>e){var f=(o.x+a.x)/2;r.splice(s+1,0,{isNull:!0,x:f}),this.options.stacking&&((n.stacks[this.stackKey][f]=new H.StackItem(n,n.options.stackLabels,!1,f,this.stack)).total=0)}a=o}}return this.getGraphPath(r)};