!function(r){"object"==typeof module&&module.exports?module.exports=r.default=r:"function"==typeof define&&define.amd?define("highcharts/modules/draggable-points",["highcharts"],function(e){return r(e),r.Highcharts=e,r}):r("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){function r(e,r,t,o){e.hasOwnProperty(r)||(e[r]=o.apply(null,t))}r(e=e?e._modules:{},"modules/draggable-points.src.js",[e["parts/Globals.js"],e["parts/Point.js"],e["parts/Utilities.js"]],function(t,e,r){function c(e){return{left:"right",right:"left",top:"bottom",bottom:"top"}[e]}function o(e){var r,t=["draggableX","draggableY"];for(w(e.dragDropProps,function(e){e.optionName&&t.push(e.optionName)}),r=t.length;r--;)if(e.options.dragDrop[t[r]])return 1}function l(e,r){return void 0===e.chartX||void 0===e.chartY?r.pointer.normalize(e):e}function u(r,e,t,o){var a=e.map(function(e){return v(r,e,t,o)});return function(){a.forEach(function(e){e()})}}function m(e,r){var t,o,a,i,n,s,d,p,g,h=(a=(o=r).series,i=[],n=a.options.dragDrop.groupBy,a.isSeriesBoosting?a.options.data.forEach(function(e,r){i.push((new a.pointClass).init(a,e)),i[i.length-1].index=r}):i=a.points,o.options[n]?i.filter(function(e){return e.options[n]===o.options[n]}):[o]),l=r.series,u=l.chart;b(l.options.dragDrop&&l.options.dragDrop.liveRedraw,!0)||(u.dragGuideBox=t=l.getGuideBox(h),u.setGuideBoxState("default",l.options.dragDrop.guideBox).add(l.group)),u.dragDropData={origin:(d=h,p=t,g={chartX:(s=e).chartX,chartY:s.chartY,guideBox:p&&{x:p.attr("x"),y:p.attr("y"),width:p.attr("width"),height:p.attr("height")},points:{}},d.forEach(function(t){var o={};w(t.series.dragDropProps,function(e,r){e=t.series[e.axis+"Axis"],o[r]=t[r],o[r+"Offset"]=e.toPixels(t[r])-(e.horiz?s.chartX:s.chartY)}),o.point=t,g.points[t.id]=o}),g),point:r,groupedPoints:h,isDragging:!0}}function f(e,r){var t=e.dragDropData.newPoints;r=!1!==r&&P({duration:400},e.options.chart.animation),e.isDragDropAnimating=!0,w(t,function(e){e.point.update(e.newValues,!1)}),e.redraw(r),setTimeout(function(){delete e.isDragDropAnimating,e.hoverPoint&&!e.dragHandles&&e.hoverPoint.showDragHandles()},r.duration)}function x(e){var r=e.series&&e.series.chart,t=r&&r.dragDropData;!r||!r.dragHandles||t&&(t.isDragging&&t.draggedPastSensitivity||t.isHoveringHandle===e.id)||r.hideDragHandles()}function g(e){var r,t=0;for(r in e)Object.hasOwnProperty.call(e,r)&&t++;return t}function h(e){for(var r in e)if(Object.hasOwnProperty.call(e,r))return e[r]}function a(l,e){if(!e.zoomOrPanKeyPressed(l)){var r=e.dragDropData,t=0;if(r&&r.isDragging){var u=r.point;t=u.series.options.dragDrop,l.preventDefault(),r.draggedPastSensitivity||(r.draggedPastSensitivity=function(e,r,t){var o=r.dragDropData.origin;r=o.chartX,o=o.chartY;var a=e.chartX;return e=e.chartY,Math.sqrt((a-r)*(a-r)+(e-o)*(e-o))>t}(l,e,b(u.options.dragDrop&&u.options.dragDrop.dragSensitivity,t&&t.dragSensitivity,2))),r.draggedPastSensitivity&&(r.newPoints=(a=l,i=(o=r).point,n=P(i.series.options.dragDrop,i.options.dragDrop),s={},d=o.updateProp,p={},w(i.series.dragDropProps,function(e,r){d&&(d!==r||!e.resize||e.optionName&&!1===n[e.optionName])||(d||e.move&&("x"===e.axis&&n.draggableX||"y"===e.axis&&n.draggableY))&&(s[r]=e)}),(d?[i]:o.groupedPoints).forEach(function(e){p[e.id]={point:e,newValues:e.getDropValues(o.origin,a,s)}}),p),e=1===(t=g(e=r.newPoints))?h(e):null,u.firePointEvent("drag",{origin:r.origin,newPoints:r.newPoints,newPoint:e&&e.newValues,newPointId:e&&e.point.id,numNewPoints:t,chartX:l.chartX,chartY:l.chartY},function(){var e=u.series,r=e.chart,t=r.dragDropData,o=P(e.options.dragDrop,u.options.dragDrop),a=o.draggableX,i=o.draggableY;e=t.origin;var n=l.chartX-e.chartX,s=l.chartY-e.chartY,d=n;if(t=t.updateProp,r.inverted&&(n=-s,s=-d),b(o.liveRedraw,!0))f(r,!1),u.showDragHandles();else if(t){a=n,r=s,t=(i=(d=u.series).chart).dragDropData,o=d.dragDropProps[t.updateProp];var p=t.newPoints[u.id].newValues,g="function"==typeof o.resizeSide?o.resizeSide(p,u):o.resizeSide;switch(o.beforeResize&&o.beforeResize(i.dragGuideBox,p,u),i=i.dragGuideBox,d="x"===o.axis&&d.xAxis.reversed||"y"===o.axis&&d.yAxis.reversed?c(g):g,a="x"===o.axis?a-(t.origin.prevdX||0):0,r="y"===o.axis?r-(t.origin.prevdY||0):0,d){case"left":var h={x:i.attr("x")+a,width:Math.max(1,i.attr("width")-a)};break;case"right":h={width:Math.max(1,i.attr("width")+a)};break;case"top":h={y:i.attr("y")+r,height:Math.max(1,i.attr("height")-r)};break;case"bottom":h={height:Math.max(1,i.attr("height")+r)}}i.attr(h)}else r.dragGuideBox.translate(a?n:0,i?s:0);e.prevdX=n,e.prevdY=s}))}}var o,a,i,n,s,d,p}function y(e,r){var t=r.dragDropData;if(t&&t.isDragging&&t.draggedPastSensitivity){var o=t.point,a=t.newPoints,i=g(a),n=1===i?h(a):null;r.dragHandles&&r.hideDragHandles(),e.preventDefault(),r.cancelClick=!0,o.firePointEvent("drop",{origin:t.origin,chartX:e.chartX,chartY:e.chartY,newPoints:a,numNewPoints:i,newPoint:n&&n.newValues,newPointId:n&&n.point.id},function(){f(r)})}delete r.dragDropData,r.dragGuideBox&&(r.dragGuideBox.destroy(),delete r.dragGuideBox)}function i(p){var e=p.container,r=t.doc;!function(e){var r=e.series?e.series.length:0;if(e.hasCartesianSeries&&!e.polar)for(;r--;)if(e.series[r].options.dragDrop&&o(e.series[r]))return 1}(p)||(u(e,["mousedown","touchstart"],function(e){e=l(e,p);var r,t,o,a,i,n=p.hoverPoint,s=P(n&&n.series.options.dragDrop,n&&n.options.dragDrop),d=s.draggableX||!1;s=s.draggableY||!1,p.cancelClick=!1,!d&&!s||p.zoomOrPanKeyPressed(e)||p.hasDraggedAnnotation||(p.dragDropData&&p.dragDropData.isDragging?y(e,p):n&&(a=(r=n).series,i=a.options.dragDrop||{},r=r.options&&r.options.dragDrop,w(a.dragDropProps,function(e){"x"===e.axis&&e.move?t=!0:"y"===e.axis&&e.move&&(o=!0)}),(i.draggableX&&t||i.draggableY&&o)&&(!r||!1!==r.draggableX||!1!==r.draggableY)&&a.yAxis&&a.xAxis)&&(p.mouseIsDown=!1,m(e,n),n.firePointEvent("dragStart",e)))}),u(e,["mousemove","touchmove"],function(e){a(l(e,p),p)}),v(e,"mouseleave",function(e){y(l(e,p),p)}),p.unbindDragDropMouseUp=u(r,["mouseup","touchend"],function(e){y(l(e,p),p)}),p.hasAddedDragDropEvents=!0,v(p,"destroy",function(){p.unbindDragDropMouseUp&&p.unbindDragDropMouseUp()}))}var v=r.addEvent,D=r.clamp,P=r.merge,w=r.objectEach,b=r.pick,n=t.seriesTypes;r=function(e){var r=(e=e.shapeArgs||e.graphic.getBBox()).r||0,t=e.height/2;return["M",0,r,"L",0,t-5,"A",1,1,0,0,0,0,5+t,"A",1,1,0,0,0,0,t-5,"M",0,5+t,"L",0,e.height-r]};var s=n.line.prototype.dragDropProps={x:{axis:"x",move:!0},y:{axis:"y",move:!0}};n.flags&&(n.flags.prototype.dragDropProps=s);var d=n.column.prototype.dragDropProps={x:{axis:"x",move:!0},y:{axis:"y",move:!1,resize:!0,beforeResize:function(e,r,t){var o=t.series.translatedThreshold,a=e.attr("y");r.y>=t.series.options.threshold?(r=e.attr("height"),e.attr({height:Math.max(0,Math.round(r+(o?o-(a+r):0)))})):e.attr({y:Math.round(a+(o?o-a:0))})},resizeSide:function(e,r){var t=r.series.chart.dragHandles;return t[r=c(e=e.y>=(r.series.options.threshold||0)?"top":"bottom")]&&(t[r].destroy(),delete t[r]),e},handlePositioner:function(e){var r=e.shapeArgs||e.graphic.getBBox();return{x:r.x,y:e.y>=(e.series.options.threshold||0)?r.y:r.y+r.height}},handleFormatter:function(e){var r=(e=e.shapeArgs).r||0,t=e.width/2;return["M",r,0,"L",t-5,0,"A",1,1,0,0,0,5+t,0,"A",1,1,0,0,0,t-5,0,"M",5+t,0,"L",e.width-r,0]}}};if(n.bullet&&(n.bullet.prototype.dragDropProps={x:d.x,y:d.y,target:{optionName:"draggableTarget",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){var r=e.targetGraphic.getBBox();return{x:e.barX,y:r.y+r.height/2}},handleFormatter:d.y.handleFormatter}}),n.columnrange&&(n.columnrange.prototype.dragDropProps={x:{axis:"x",move:!0},low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:(e=e.shapeArgs||e.graphic.getBBox()).x,y:e.y+e.height}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.high}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:(e=e.shapeArgs||e.graphic.getBBox()).x,y:e.y}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e>=r.low}}}),n.boxplot&&(n.boxplot.prototype.dragDropProps={x:d.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.lowPlot}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.q1}},q1:{optionName:"draggableQ1",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.q1Plot}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.median&&e>=r.low}},median:{axis:"y",move:!0},q3:{optionName:"draggableQ3",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.q3Plot}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.high&&e>=r.median}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.highPlot}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e>=r.q3}}}),n.ohlc&&(n.ohlc.prototype.dragDropProps={x:d.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotLow}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.open&&e<=r.close}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotHigh}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e>=r.open&&e>=r.close}},open:{optionName:"draggableOpen",axis:"y",move:!0,resize:!0,resizeSide:function(e){return e.open>=e.close?"top":"bottom"},handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotOpen}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.high&&e>=r.low}},close:{optionName:"draggableClose",axis:"y",move:!0,resize:!0,resizeSide:function(e){return e.open>=e.close?"bottom":"top"},handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotClose}},handleFormatter:d.y.handleFormatter,propValidate:function(e,r){return e<=r.high&&e>=r.low}}}),n.arearange){s=n.columnrange.prototype.dragDropProps;function p(e){return["M",0-(e=e.graphic?e.graphic.getBBox().width/2+1:4),0,"a",e,e,0,1,0,2*e,0,"a",e,e,0,1,0,-2*e,0]}n.arearange.prototype.dragDropProps={x:s.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return(e=e.lowerGraphic&&e.lowerGraphic.getBBox())?{x:e.x+e.width/2,y:e.y+e.height/2}:{x:-999,y:-999}},handleFormatter:p,propValidate:s.low.propValidate},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return(e=e.upperGraphic&&e.upperGraphic.getBBox())?{x:e.x+e.width/2,y:e.y+e.height/2}:{x:-999,y:-999}},handleFormatter:p,propValidate:s.high.propValidate}}}if(n.waterfall&&(n.waterfall.prototype.dragDropProps={x:d.x,y:P(d.y,{handleFormatter:function(e){return e.isSum||e.isIntermediateSum?null:d.y.handleFormatter(e)}})}),n.xrange){function z(e,r){var t=e.series,o=t.xAxis,a=t.yAxis,i=t.chart.inverted;r=o.toPixels(e[r],!0);var n=a.toPixels(e.y,!0);return e=t.columnMetrics?t.columnMetrics.offset:-e.shapeArgs.height/2,i&&(r=o.len-r,n=a.len-n),{x:Math.round(r),y:Math.round(n+e)}}r=n.xrange.prototype.dragDropProps={y:{axis:"y",move:!0},x:{optionName:"draggableX1",axis:"x",move:!0,resize:!0,resizeSide:"left",handlePositioner:function(e){return z(e,"x")},handleFormatter:r,propValidate:function(e,r){return e<=r.x2}},x2:{optionName:"draggableX2",axis:"x",move:!0,resize:!0,resizeSide:"right",handlePositioner:function(e){return z(e,"x2")},handleFormatter:r,propValidate:function(e,r){return e>=r.x}}},n.gantt&&(n.gantt.prototype.dragDropProps={y:r.y,start:P(r.x,{optionName:"draggableStart",validateIndividualDrag:function(e){return!e.milestone}}),end:P(r.x2,{optionName:"draggableEnd",validateIndividualDrag:function(e){return!e.milestone}})})}"gauge pie sunburst wordcloud sankey histogram pareto vector windbarb treemap bellcurve sma map mapline".split(" ").forEach(function(e){n[e]&&(n[e].prototype.dragDropProps=null)});var H={default:{className:"highcharts-drag-box-default",lineWidth:1,lineColor:"#888",color:"rgba(0, 0, 0, 0.1)",cursor:"move",zIndex:900}},S={className:"highcharts-drag-handle",color:"#fff",lineColor:"rgba(0, 0, 0, 0.6)",lineWidth:1,zIndex:901};t.Chart.prototype.setGuideBoxState=function(e,r){var t=this.dragGuideBox;return r=P(H,r),e=P(r.default,r[e]),t.attr({className:e.className,stroke:e.lineColor,strokeWidth:e.lineWidth,fill:e.color,cursor:e.cursor,zIndex:e.zIndex}).css({pointerEvents:"none"})},e.prototype.getDropValues=function(e,s,r){var t,d=this,p=d.series,g=P(p.options.dragDrop,d.options.dragDrop),h={},l=e.points[d.id];for(t in r)if(Object.hasOwnProperty.call(r,t)){if(void 0!==u){var u=!1;break}u=!0}return w(r,function(e,r){var t=l[r],o=p[e.axis+"Axis"];o=o.toValue((o.horiz?s.chartX:s.chartY)+l[r+"Offset"]);var a=e.axis.toUpperCase(),i=p[a.toLowerCase()+"Axis"].categories?1:0;i=b(g["dragPrecision"+a],i);var n=b(g["dragMin"+a],-1/0);a=b(g["dragMax"+a],1/0),i&&(o=Math.round(o/i)*i),o=D(o,n,a),u&&e.propValidate&&!e.propValidate(o,d)||void 0===t||(h[r]=o)}),h},t.Series.prototype.getGuideBox=function(e){var r,t=this.chart,o=1/0,a=-1/0,i=1/0,n=-1/0;return e.forEach(function(e){(e=e.graphic&&e.graphic.getBBox()||e.shapeArgs)&&(e.width||e.height||e.x||e.y)&&(r=!0,o=Math.min(e.x,o),a=Math.max(e.x+e.width,a),i=Math.min(e.y,i),n=Math.max(e.y+e.height,n))}),r?t.renderer.rect(o,i,a-o,n-i):t.renderer.g()},e.prototype.showDragHandles=function(){var s=this,d=s.series,p=d.chart,g=p.renderer,h=P(d.options.dragDrop,s.options.dragDrop);w(d.dragDropProps,function(e,t){var r=P(S,e.handleOptions,h.dragHandle),o={className:r.className,"stroke-width":r.lineWidth,fill:r.color,stroke:r.lineColor},a=r.pathFormatter||e.handleFormatter,i=e.handlePositioner,n=!e.validateIndividualDrag||e.validateIndividualDrag(s);e.resize&&n&&e.resizeSide&&a&&(h["draggable"+e.axis.toUpperCase()]||h[e.optionName])&&!1!==h[e.optionName]&&(p.dragHandles||(p.dragHandles={group:g.g("drag-drop-handles").add(d.markerGroup||d.group)}),p.dragHandles.point=s.id,i=i(s),o.d=n=a(s),a="function"==typeof e.resizeSide?e.resizeSide(s.options,s):e.resizeSide,!n||i.x<0||i.y<0||(o.cursor=r.cursor||"x"===e.axis!=!!p.inverted?"ew-resize":"ns-resize",(e=p.dragHandles[a])||(e=p.dragHandles[a]=g.path().add(p.dragHandles.group)),e.translate(i.x,i.y).attr(o),u(e.element,["touchstart","mousedown"],function(e){e=l(e,p);var r=s.series.chart;r.zoomOrPanKeyPressed(e)||(r.mouseIsDown=!1,m(e,s),r.dragDropData.updateProp=e.updateProp=t,s.firePointEvent("dragStart",e),e.stopPropagation(),e.preventDefault())}),v(p.dragHandles.group.element,"mouseover",function(){p.dragDropData=p.dragDropData||{},p.dragDropData.isHoveringHandle=s.id}),u(p.dragHandles.group.element,["touchend","mouseout"],function(){var e=s.series.chart;e.dragDropData&&s.id===e.dragDropData.isHoveringHandle&&delete e.dragDropData.isHoveringHandle,e.hoverPoint||x(s)})))})},t.Chart.prototype.hideDragHandles=function(){this.dragHandles&&(w(this.dragHandles,function(e,r){"group"!==r&&e.destroy&&e.destroy()}),this.dragHandles.group&&this.dragHandles.group.destroy&&this.dragHandles.group.destroy(),delete this.dragHandles)},v(e,"mouseOver",function(){var a=this;setTimeout(function(){var e=a.series,r=e&&e.chart,t=r&&r.dragDropData,o=r&&r.is3d&&r.is3d();!r||t&&t.isDragging&&t.draggedPastSensitivity||r.isDragDropAnimating||!e.options.dragDrop||o||(r.dragHandles&&r.hideDragHandles(),a.showDragHandles())},12)}),v(e,"mouseOut",function(){var e=this;setTimeout(function(){e.series&&x(e)},10)}),v(e,"remove",function(){var e=this.series.chart,r=e.dragHandles;r&&r.point===this.id&&e.hideDragHandles()}),t.Chart.prototype.zoomOrPanKeyPressed=function(e){var r=this.userOptions.chart||{},t=r.panKey&&r.panKey+"Key";return e[r.zoomKey&&r.zoomKey+"Key"]||e[t]},v(t.Chart,"render",function(){this.hasAddedDragDropEvents||i(this)})}),r(e,"masters/modules/draggable-points.src.js",[],function(){})});