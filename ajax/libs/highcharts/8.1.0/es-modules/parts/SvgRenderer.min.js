"use strict";import Color from"./Color.js";var color=Color.parse;import H from"./Globals.js";import SVGElement from"./SVGElement.js";import U from"./Utilities.js";var SVGRenderer,addEvent=U.addEvent,attr=U.attr,createElement=U.createElement,css=U.css,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,erase=U.erase,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,objectEach=U.objectEach,pick=U.pick,pInt=U.pInt,removeEvent=U.removeEvent,splat=U.splat,stop=U.stop,uniqueKey=U.uniqueKey,charts=H.charts,deg2rad=H.deg2rad,doc=H.doc,hasTouch=H.hasTouch,isFirefox=H.isFirefox,isMS=H.isMS,isWebKit=H.isWebKit,noop=H.noop,svg=H.svg,SVG_NS=H.SVG_NS,symbolSizes=H.symbolSizes,win=H.win;SVGRenderer=H.SVGRenderer=function(){this.init.apply(this,arguments)},extend(SVGRenderer.prototype,{Element:SVGElement,SVG_NS:SVG_NS,init:function(t,e,i,n,r,s,a){var o,h,l,c;o=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),a||o.css(this.getStyle(n)),h=o.element,t.appendChild(h),attr(t,"dir","ltr"),-1===t.innerHTML.indexOf("xmlns")&&attr(h,"xmlns",this.SVG_NS),this.isSVG=!0,this.box=h,this.boxWrapper=o,this.alignedObjects=[],this.url=(isFirefox||isWebKit)&&doc.getElementsByTagName("base").length?win.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"",this.createElement("desc").add().element.appendChild(doc.createTextNode("Created with Highcharts 8.1.0")),this.defs=this.createElement("defs").add(),this.allowHTML=s,this.forExport=r,this.styledMode=a,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.setSize(e,i,!1),isFirefox&&t.getBoundingClientRect&&((l=function(){css(t,{left:0,top:0}),c=t.getBoundingClientRect(),css(t,{left:Math.ceil(c.left)-c.left+"px",top:Math.ceil(c.top)-c.top+"px"})})(),this.unSubPixelFix=addEvent(win,"resize",l))},definition:function(t){var e=this;return function t(i,n){var r;return splat(i).forEach(function(i){var s=e.createElement(i.tagName),a={};objectEach(i,function(t,e){"tagName"!==e&&"children"!==e&&"textContent"!==e&&(a[e]=t)}),s.attr(a),s.add(n||e.defs),i.textContent&&s.element.appendChild(doc.createTextNode(i.textContent)),t(i.children||[],s),r=s}),r}(t)},getStyle:function(t){return this.style=extend({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},t),this.style},setStyle:function(t){this.boxWrapper.css(this.getStyle(t))},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var t=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),destroyObjectProperties(this.gradients||{}),this.gradients=null,t&&(this.defs=t.destroy()),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null},createElement:function(t){var e=new this.Element;return e.init(this,t),e},draw:noop,getRadialAttr:function(t,e){return{cx:t[0]-t[2]/2+e.cx*t[2],cy:t[1]-t[2]/2+e.cy*t[2],r:e.r*t[2]}},truncate:function(t,e,i,n,r,s,a){var o,h,l,c=this,d=t.rotation,u=n?1:0,f=(i||n).length,g=f,p=[],m=function(t){e.firstChild&&e.removeChild(e.firstChild),t&&e.appendChild(doc.createTextNode(t))},x=function(s,o){var h=o||s;if(void 0===p[h])if(e.getSubStringLength)try{p[h]=r+e.getSubStringLength(0,n?h+1:h)}catch(t){}else c.getSpanWidth&&(m(a(i||n,s)),p[h]=r+c.getSpanWidth(t,e));return p[h]};if(t.rotation=0,h=x(e.textContent.length),l=r+h>s){for(;u<=f;)g=Math.ceil((u+f)/2),n&&(o=a(n,g)),h=x(g,o&&o.length-1),u===f?u=f+1:h>s?f=g-1:u=g;0===f?m(""):i&&f===i.length-1||m(o||a(i||n,g))}return n&&n.splice(0,g),t.actualWidth=h,t.rotation=d,l},escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},buildText:function(t){var e,i,n,r=t.element,s=this,a=s.forExport,o=pick(t.textStr,"").toString(),h=-1!==o.indexOf("<"),l=r.childNodes,c=attr(r,"x"),d=t.styles,u=t.textWidth,f=d&&d.lineHeight,g=d&&d.textOutline,p=d&&"ellipsis"===d.textOverflow,m=d&&"nowrap"===d.whiteSpace,x=d&&d.fontSize,y=l.length,b=u&&!t.added&&this.box,S=function(t){var e;return s.styledMode||(e=/(px|em)$/.test(t&&t.style.fontSize)?t.style.fontSize:x||s.style.fontSize||12),f?pInt(f):s.fontMetrics(e,t.getAttribute("style")?t:r).h},v=function(t,e){return objectEach(s.escapes,function(i,n){e&&-1!==e.indexOf(i)||(t=t.toString().replace(new RegExp(i,"g"),n))}),t},w=function(t,e){var i,n;if(i=t.indexOf("<"),-1!==(i=(t=t.substring(i,t.indexOf(">")-i)).indexOf(e+"="))&&(i=i+e.length+1,'"'===(n=t.charAt(i))||"'"===n))return(t=t.substring(i+1)).substring(0,t.indexOf(n))},M=/<br.*?>/g;if((i=[o,p,m,f,g,x,u].join(","))!==t.textCache){for(t.textCache=i;y--;)r.removeChild(l[y]);h||g||p||u||-1!==o.indexOf(" ")&&(!m||M.test(o))?(b&&b.appendChild(r),(h?(s.styledMode?o.replace(/<(b|strong)>/g,'<span class="highcharts-strong">').replace(/<(i|em)>/g,'<span class="highcharts-emphasized">'):o.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">')).replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(M):[o]).filter(function(t){return""!==t}).forEach(function(i,o){var h,l=0,d=0;i=i.replace(/^\s+|\s+$/g,"").replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||"),(h=i.split("|||")).forEach(function(i){if(""!==i||1===h.length){var f,g,y,b={},M=doc.createElementNS(s.SVG_NS,"tspan");if((f=w(i,"class"))&&attr(M,"class",f),(g=w(i,"style"))&&(g=g.replace(/(;| |^)color([ :])/,"$1fill$2"),attr(M,"style",g)),(y=w(i,"href"))&&!a&&(attr(M,"onclick",'location.href="'+y+'"'),attr(M,"class","highcharts-anchor"),s.styledMode||css(M,{cursor:"pointer"}))," "!==(i=v(i.replace(/<[a-zA-Z\/](.|\n)*?>/g,"")||" "))){if(M.appendChild(doc.createTextNode(i)),l?b.dx=0:o&&null!==c&&(b.x=c),attr(M,b),r.appendChild(M),!l&&n&&(!svg&&a&&css(M,{display:"block"}),attr(M,"dy",S(M))),u){var E=i.replace(/([^\^])-/g,"$1- ").split(" "),L=!m&&(h.length>1||o||E.length>1),A=0,C=S(M);if(p)e=s.truncate(t,M,i,void 0,0,Math.max(0,u-parseInt(x||12,10)),function(t,e){return t.substring(0,e)+"â€¦"});else if(L)for(;E.length;)E.length&&!m&&A>0&&(M=doc.createElementNS(SVG_NS,"tspan"),attr(M,{dy:C,x:c}),g&&attr(M,"style",g),M.appendChild(doc.createTextNode(E.join(" ").replace(/- /g,"-"))),r.appendChild(M)),s.truncate(t,M,null,E,0===A?d:0,u,function(t,e){return E.slice(0,e).join(" ").replace(/- /g,"-")}),d=t.actualWidth,A++}l++}}}),n=n||r.childNodes.length}),p&&e&&t.attr("title",v(t.textStr,["&lt;","&gt;"])),b&&b.removeChild(r),g&&t.applyTextOutline&&t.applyTextOutline(g)):r.appendChild(doc.createTextNode(v(o)))}},getContrast:function(t){return(t=color(t).rgba)[0]*=1,t[1]*=1.2,t[2]*=.5,t[0]+t[1]+t[2]>459?"#000000":"#FFFFFF"},button:function(t,e,i,n,r,s,a,o,h,l){var c,d,u,f,g=this.label(t,e,i,h,void 0,void 0,l,void 0,"button"),p=0,m=this.styledMode;(g.attr(merge({padding:8,r:2},r)),m)||(r=merge({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},r),c=r.style,delete r.style,s=merge(r,{fill:"#e6e6e6"},s),d=s.style,delete s.style,a=merge(r,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},a),u=a.style,delete a.style,o=merge(r,{style:{color:"#cccccc"}},o),f=o.style,delete o.style);return addEvent(g.element,isMS?"mouseover":"mouseenter",function(){3!==p&&g.setState(1)}),addEvent(g.element,isMS?"mouseout":"mouseleave",function(){3!==p&&g.setState(p)}),g.setState=function(t){1!==t&&(g.state=p=t),g.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][t||0]),m||g.attr([r,s,a,o][t||0]).css([c,d,u,f][t||0])},m||g.attr(r).css(extend({cursor:"default"},c)),g.on("click",function(t){3!==p&&n.call(g,t)})},crispLine:function(t,e,i){void 0===i&&(i="round");var n=t[0],r=t[1];return n[1]===r[1]&&(n[1]=r[1]=Math[i](n[1])-e%2/2),n[2]===r[2]&&(n[2]=r[2]=Math[i](n[2])+e%2/2),t},path:function(t){var e=this.styledMode?{}:{fill:"none"};return isArray(t)?e.d=t:isObject(t)&&extend(e,t),this.createElement("path").attr(e)},circle:function(t,e,i){var n=isObject(t)?t:void 0===t?{}:{x:t,y:e,r:i},r=this.createElement("circle");return r.xSetter=r.ySetter=function(t,e,i){i.setAttribute("c"+e,t)},r.attr(n)},arc:function(t,e,i,n,r,s){var a,o;return isObject(t)?(e=(o=t).y,i=o.r,n=o.innerR,r=o.start,s=o.end,t=o.x):o={innerR:n,start:r,end:s},(a=this.symbol("arc",t,e,i,i,o)).r=i,a},rect:function(t,e,i,n,r,s){r=isObject(t)?t.r:r;var a=this.createElement("rect"),o=isObject(t)?t:void 0===t?{}:{x:t,y:e,width:Math.max(i,0),height:Math.max(n,0)};return this.styledMode||(void 0!==s&&(o.strokeWidth=s,o=a.crisp(o)),o.fill="none"),r&&(o.r=r),a.rSetter=function(t,e,i){a.r=t,attr(i,{rx:t,ry:t})},a.rGetter=function(){return a.r},a.attr(o)},setSize:function(t,e,i){var n=this.alignedObjects,r=n.length;for(this.width=t,this.height=e,this.boxWrapper.animate({width:t,height:e},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:pick(i,!0)?void 0:0});r--;)n[r].align()},g:function(t){var e=this.createElement("g");return t?e.attr({class:"highcharts-"+t}):e},image:function(t,e,i,n,r,s){var a,o,h={preserveAspectRatio:"none"},l=function(t,e){t.setAttributeNS?t.setAttributeNS("http://www.w3.org/1999/xlink","href",e):t.setAttribute("hc-svg-href",e)},c=function(e){l(a.element,t),s.call(a,e)};return arguments.length>1&&extend(h,{x:e,y:i,width:n,height:r}),a=this.createElement("image").attr(h),s?(l(a.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),o=new win.Image,addEvent(o,"load",c),o.src=t,o.complete&&c({})):l(a.element,t),a},symbol:function(t,e,i,n,r,s){var a,o,h,l,c=this,d=/^url\((.*?)\)$/,u=d.test(t),f=!u&&(this.symbols[t]?t:"circle"),g=f&&this.symbols[f];return g?("number"==typeof e&&(o=g.call(this.symbols,Math.round(e||0),Math.round(i||0),n,r,s)),a=this.path(o),c.styledMode||a.attr("fill","none"),extend(a,{symbolName:f,x:e,y:i,width:n,height:r}),s&&extend(a,s)):u&&(h=t.match(d)[1],(a=this.image(h)).imgwidth=pick(symbolSizes[h]&&symbolSizes[h].width,s&&s.width),a.imgheight=pick(symbolSizes[h]&&symbolSizes[h].height,s&&s.height),l=function(){a.attr({width:a.width,height:a.height})},["width","height"].forEach(function(t){a[t+"Setter"]=function(t,e){var i={},n=this["img"+e],r="width"===e?"translateX":"translateY";this[e]=t,defined(n)&&(s&&"within"===s.backgroundSize&&this.width&&this.height&&(n=Math.round(n*Math.min(this.width/this.imgwidth,this.height/this.imgheight))),this.element&&this.element.setAttribute(e,n),this.alignByTranslate||(i[r]=((this[e]||0)-n)/2,this.attr(i)))}}),defined(e)&&a.attr({x:e,y:i}),a.isImg=!0,defined(a.imgwidth)&&defined(a.imgheight)?l():(a.attr({width:0,height:0}),createElement("img",{onload:function(){var t=charts[c.chartIndex];0===this.width&&(css(this,{position:"absolute",top:"-999em"}),doc.body.appendChild(this)),symbolSizes[h]={width:this.width,height:this.height},a.imgwidth=this.width,a.imgheight=this.height,a.element&&l(),this.parentNode&&this.parentNode.removeChild(this),c.imgCount--,c.imgCount||!t||t.hasLoaded||t.onload()},src:h}),this.imgCount++)),a},symbols:{circle:function(t,e,i,n){return this.arc(t+i/2,e+n/2,i/2,n/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},square:function(t,e,i,n){return[["M",t,e],["L",t+i,e],["L",t+i,e+n],["L",t,e+n],["Z"]]},triangle:function(t,e,i,n){return[["M",t+i/2,e],["L",t+i,e+n],["L",t,e+n],["Z"]]},"triangle-down":function(t,e,i,n){return[["M",t,e],["L",t+i,e],["L",t+i/2,e+n],["Z"]]},diamond:function(t,e,i,n){return[["M",t+i/2,e],["L",t+i,e+n/2],["L",t+i/2,e+n],["L",t,e+n/2],["Z"]]},arc:function(t,e,i,n,r){var s,a=r.start,o=r.r||i,h=r.r||n||i,l=Math.abs(r.end-r.start-2*Math.PI)<.001,c=r.end-.001,d=r.innerR,u=pick(r.open,l),f=Math.cos(a),g=Math.sin(a),p=Math.cos(c),m=Math.sin(c),x=pick(r.longArc,r.end-a-Math.PI<.001?0:1);return s=[["M",t+o*f,e+h*g],["A",o,h,0,x,pick(r.clockwise,1),t+o*p,e+h*m]],defined(d)&&s.push(u?["M",t+d*p,e+d*m]:["L",t+d*p,e+d*m],["A",d,d,0,x,defined(r.clockwise)?1-r.clockwise:0,t+d*f,e+d*g]),u||s.push(["Z"]),s},callout:function(t,e,i,n,r){var s,a=Math.min(r&&r.r||0,i,n),o=a+6,h=r&&r.anchorX,l=r&&r.anchorY;return s=[["M",t+a,e],["L",t+i-a,e],["C",t+i,e,t+i,e,t+i,e+a],["L",t+i,e+n-a],["C",t+i,e+n,t+i,e+n,t+i-a,e+n],["L",t+a,e+n],["C",t,e+n,t,e+n,t,e+n-a],["L",t,e+a],["C",t,e,t,e,t+a,e]],h&&h>i?l>e+o&&l<e+n-o?s.splice(3,1,["L",t+i,l-6],["L",t+i+6,l],["L",t+i,l+6],["L",t+i,e+n-a]):s.splice(3,1,["L",t+i,n/2],["L",h,l],["L",t+i,n/2],["L",t+i,e+n-a]):h&&h<0?l>e+o&&l<e+n-o?s.splice(7,1,["L",t,l+6],["L",t-6,l],["L",t,l-6],["L",t,e+a]):s.splice(7,1,["L",t,n/2],["L",h,l],["L",t,n/2],["L",t,e+a]):l&&l>n&&h>t+o&&h<t+i-o?s.splice(5,1,["L",h+6,e+n],["L",h,e+n+6],["L",h-6,e+n],["L",t+a,e+n]):l&&l<0&&h>t+o&&h<t+i-o&&s.splice(1,1,["L",h-6,e],["L",h,e-6],["L",h+6,e],["L",i-a,e]),s}},clipRect:function(t,e,i,n){var r,s=uniqueKey()+"-",a=this.createElement("clipPath").attr({id:s}).add(this.defs);return(r=this.rect(t,e,i,n,0).add(a)).id=s,r.clipPath=a,r.count=0,r},text:function(t,e,i,n){var r,s={};return!n||!this.allowHTML&&this.forExport?(s.x=Math.round(e||0),i&&(s.y=Math.round(i)),defined(t)&&(s.text=t),r=this.createElement("text").attr(s),n||(r.xSetter=function(t,e,i){var n,r,s=i.getElementsByTagName("tspan"),a=i.getAttribute(e);for(r=0;r<s.length;r++)(n=s[r]).getAttribute(e)===a&&n.setAttribute(e,t);i.setAttribute(e,t)}),r):this.html(t,e,i)},fontMetrics:function(t,e){var i;return t=!this.styledMode&&/px/.test(t)||!win.getComputedStyle?t||e&&e.style&&e.style.fontSize||this.style&&this.style.fontSize:e&&SVGElement.prototype.getStyle.call(e,"font-size"),{h:i=(t=/px/.test(t)?pInt(t):12)<24?t+3:Math.round(1.2*t),b:Math.round(.8*i),f:t}},rotCorr:function(t,e,i){var n=t;return e&&i&&(n=Math.max(n*Math.cos(e*deg2rad),4)),{x:-t/3*Math.sin(e*deg2rad),y:n}},pathToSegments:function(t){for(var e=[],i=[],n={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2},r=0;r<t.length;r++)isString(i[0])&&isNumber(t[r])&&i.length===n[i[0].toUpperCase()]&&t.splice(r,0,i[0].replace("M","L").replace("m","l")),"string"==typeof t[r]&&(i.length&&e.push(i.slice(0)),i.length=0),i.push(t[r]);return e.push(i.slice(0)),e},label:function(t,e,i,n,r,s,a,o,h){var l,c,d,u,f,g,p,m,x,y,b,S=this,v=S.styledMode,w=S.g("button"!==h&&"label"),M=w.text=S.text("",0,0,a).attr({zIndex:1}),E={width:0,height:0,x:0,y:0},L=E,A=0,C=3,N=0,O={},j=/^url\((.*?)\)$/.test(n),k=v||j,z=function(){return v?l.strokeWidth()%2/2:(p?parseInt(p,10):0)%2/2};h&&w.addClass("highcharts-"+h),x=function(){var t,e=M.element.style,i={};L=isNumber(c)&&isNumber(d)&&!g||!defined(M.textStr)?E:M.getBBox(),w.width=(c||L.width||0)+2*C+N,w.height=(d||L.height||0)+2*C,m=C+Math.min(S.fontMetrics(e&&e.fontSize,M).b,L.height||1/0),k&&(l||(w.box=l=S.symbols[n]||j?S.symbol(n):S.rect(),l.addClass(("button"===h?"":"highcharts-label-box")+(h?" highcharts-"+h+"-box":"")),l.add(w),t=z(),i.x=t,i.y=(o?-m:0)+t),i.width=Math.round(w.width),i.height=Math.round(w.height),l.attr(extend(i,O)),O={})},y=function(){var t,e=N+C;t=o?0:m,defined(c)&&L&&("center"===g||"right"===g)&&(e+={center:.5,right:1}[g]*(c-L.width)),e===M.x&&t===M.y||(M.attr("x",e),M.hasBoxWidthChanged&&(L=M.getBBox(!0),x()),void 0!==t&&M.attr("y",t)),M.x=e,M.y=t},b=function(t,e){l?l.attr(t,e):O[t]=e},w.onAdd=function(){M.add(w),w.attr({text:t||0===t?t:"",x:e,y:i}),l&&defined(r)&&w.attr({anchorX:r,anchorY:s})},w.widthSetter=function(t){c=isNumber(t)?t:null},w.heightSetter=function(t){d=t},w["text-alignSetter"]=function(t){g=t},w.paddingSetter=function(t){defined(t)&&t!==C&&(C=w.padding=t,y())},w.paddingLeftSetter=function(t){defined(t)&&t!==N&&(N=t,y())},w.alignSetter=function(t){(t={left:0,center:.5,right:1}[t])!==A&&(A=t,L&&w.attr({x:u}))},w.textSetter=function(t){void 0!==t&&M.attr({text:t}),x(),y()},w["stroke-widthSetter"]=function(t,e){t&&(k=!0),p=this["stroke-width"]=t,b(e,t)},v?w.rSetter=function(t,e){b(e,t)}:w.strokeSetter=w.fillSetter=w.rSetter=function(t,e){"r"!==e&&("fill"===e&&t&&(k=!0),w[e]=t),b(e,t)},w.anchorXSetter=function(t,e){r=w.anchorX=t,b(e,Math.round(t)-z()-u)},w.anchorYSetter=function(t,e){s=w.anchorY=t,b(e,t-f)},w.xSetter=function(t){w.x=t,A&&(t-=A*((c||L.width)+2*C),w["forceAnimate:x"]=!0),u=Math.round(t),w.attr("translateX",u)},w.ySetter=function(t){f=w.y=Math.round(t),w.attr("translateY",f)},w.isLabel=!0;var H=w.css,U={css:function(t){if(t){var e,i={};t=merge(t),w.textProps.forEach(function(e){void 0!==t[e]&&(i[e]=t[e],delete t[e])}),M.css(i),e="fontSize"in i||"fontWeight"in i,("width"in i||e)&&(x(),e&&y())}return H.call(w,t)},getBBox:function(){return{width:L.width+2*C,height:L.height+2*C,x:L.x-C,y:L.y-C}},destroy:function(){removeEvent(w.element,"mouseenter"),removeEvent(w.element,"mouseleave"),M&&M.destroy(),l&&(l=l.destroy()),SVGElement.prototype.destroy.call(w),w=S=M=x=y=b=null}};return w.on=function(t,e){var i,n=M&&"SPAN"===M.element.tagName?M:void 0;return n&&(i=function(i){("mouseenter"===t||"mouseleave"===t)&&i.relatedTarget instanceof Element&&(w.element.contains(i.relatedTarget)||n.element.contains(i.relatedTarget))||e.call(w.element,i)},n.on(t,i)),SVGElement.prototype.on.call(w,t,i||e),w},v||(U.shadow=function(t){return t&&(x(),l&&l.shadow(t)),w}),extend(w,U)}}),H.Renderer=SVGRenderer;