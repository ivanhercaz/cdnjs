"use strict";import Axis from"./Axis.js";import H from"./Globals.js";import Point from"./Point.js";import U from"./Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,defined=U.defined,extend=U.extend,find=U.find,format=U.format,isNumber=U.isNumber,isString=U.isString,merge=U.merge,pick=U.pick,splat=U.splat;import"./Chart.js";import"./Pointer.js";import"./Series.js";import"./SvgRenderer.js";import"./Navigator.js";import"./Scrollbar.js";import"./RangeSelector.js";var Chart=H.Chart,Renderer=H.Renderer,Series=H.Series,SVGRenderer=H.SVGRenderer,seriesProto=Series.prototype,seriesInit=seriesProto.init,seriesProcessData=seriesProto.processData,pointTooltipFormatter=Point.prototype.tooltipFormatter;H.StockChart=H.stockChart=function(t,i,e){var s,r=isString(t)||t.nodeName,a=arguments[r?1:0],o=a,n=a.series,h=H.getOptions(),l=pick(a.navigator&&a.navigator.enabled,h.navigator.enabled,!0);return a.xAxis=splat(a.xAxis||{}).map(function(t,i){return merge({minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0},h.xAxis,h.xAxis&&h.xAxis[i],t,{type:"datetime",categories:null},l?{startOnTick:!1,endOnTick:!1}:null)}),a.yAxis=splat(a.yAxis||{}).map(function(t,i){return s=pick(t.opposite,!0),merge({labels:{y:-2},opposite:s,showLastLabel:!(!t.categories&&"category"!==t.type),title:{text:null}},h.yAxis,h.yAxis&&h.yAxis[i],t)}),a.series=null,(a=merge({chart:{panning:{enabled:!0,type:"x"},pinchType:"x"},navigator:{enabled:l},scrollbar:{enabled:pick(h.scrollbar.enabled,!0)},rangeSelector:{enabled:pick(h.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(h.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},a,{isStock:!0})).series=o.series=n,r?new Chart(t,a,e):new Chart(a,i)},addEvent(Series,"setOptions",function(t){var i;this.chart.options.isStock&&(this.is("column")||this.is("columnrange")?i={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(i={marker:{enabled:!1,radius:2}}),i&&(t.plotOptions[this.type]=merge(t.plotOptions[this.type],i)))}),addEvent(Axis,"autoLabelAlign",function(t){var i,e=this.chart,s=this.options,r=e._labelPanes=e._labelPanes||{},a=this.options.labels;this.chart.options.isStock&&"yAxis"===this.coll&&!r[i=s.top+","+s.height]&&a.enabled&&(15===a.x&&(a.x=0),void 0===a.align&&(a.align="right"),r[i]=this,t.align="right",t.preventDefault())}),addEvent(Axis,"destroy",function(){var t=this.chart,i=this.options&&this.options.top+","+this.options.height;i&&t._labelPanes&&t._labelPanes[i]===this&&delete t._labelPanes[i]}),addEvent(Axis,"getPlotLinePath",function(t){var i,e,s,r,a,o,n,h,l,p=this,c=this.isLinked&&!this.series?this.linkedParent.series:this.series,d=p.chart,x=d.renderer,f=p.left,u=p.top,g=[],m=[],y=t.translatedValue,b=t.value,v=t.force;(d.options.isStock&&!1!==t.acrossPanes&&"xAxis"===p.coll||"yAxis"===p.coll)&&(t.preventDefault(),n=p.coll,h="xAxis"===n?"yAxis":"xAxis",l=p.options[h],m=isNumber(l)?[d[h][l]]:isString(l)?[d.get(l)]:c.map(function(t){return t[h]}),(p.isXAxis?d.yAxis:d.xAxis).forEach(function(t){if(!defined(t.options.id)||-1===t.options.id.indexOf("navigator")){var i=t.isXAxis?"yAxis":"xAxis",e=defined(t.options[i])?d[i][t.options[i]]:d[i][0];p===e&&m.push(t)}}),a=m.length?[]:[p.isXAxis?d.yAxis[0]:d.xAxis[0]],m.forEach(function(t){-1!==a.indexOf(t)||find(a,function(i){return i.pos===t.pos&&i.len===t.len})||a.push(t)}),o=pick(y,p.translate(b,null,null,t.old)),isNumber(o)&&(p.horiz?a.forEach(function(t){var a;e=t.pos,r=e+t.len,i=s=Math.round(o+p.transB),"pass"!==v&&(i<f||i>f+p.width)&&(v?i=s=clamp(i,f,f+p.width):a=!0),a||g.push(["M",i,e],["L",s,r])}):a.forEach(function(t){var a;i=t.pos,s=i+t.len,e=r=Math.round(u+p.height-o),"pass"!==v&&(e<u||e>u+p.height)&&(v?e=r=clamp(e,u,u+p.height):a=!0),a||g.push(["M",i,e],["L",s,r])})),t.path=g.length>0?x.crispPolyLine(g,t.lineWidth||1):null)}),SVGRenderer.prototype.crispPolyLine=function(t,i){for(var e=0;e<t.length;e+=2){var s=t[e],r=t[e+1];s[1]===r[1]&&(s[1]=r[1]=Math.round(s[1])-i%2/2),s[2]===r[2]&&(s[2]=r[2]=Math.round(s[2])+i%2/2)}return t},addEvent(Axis,"afterHideCrosshair",function(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}),addEvent(Axis,"afterDrawCrosshair",function(t){if(defined(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var i,e,s,r,a,o,n=this.chart,h=this.logarithmic,l=this.options.crosshair.label,p=this.horiz,c=this.opposite,d=this.left,x=this.top,f=this.crossLabel,u=l.format,g="",m="inside"===this.options.tickPosition,y=!1!==this.crosshair.snap,b=0,v=t.e||this.cross&&this.cross.e,A=t.point,k=this.min,P=this.max;h&&(k=h.lin2log(k),P=h.lin2log(P)),a=p?"center":c?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",f||(f=this.crossLabel=n.renderer.label(null,null,null,l.shape||"callout").addClass("highcharts-crosshair-label"+(this.series[0]&&" highcharts-color-"+this.series[0].colorIndex)).attr({align:l.align||a,padding:pick(l.padding,8),r:pick(l.borderRadius,3),zIndex:2}).add(this.labelGroup),n.styledMode||f.attr({fill:l.backgroundColor||this.series[0]&&this.series[0].color||"#666666",stroke:l.borderColor||"","stroke-width":l.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"11px",textAlign:"center"},l.style))),p?(i=y?A.plotX+d:v.chartX,e=x+(c?0:this.height)):(i=c?this.width+d:0,e=y?A.plotY+x:v.chartY),u||l.formatter||(this.dateTime&&(g="%b %d, %Y"),u="{value"+(g?":"+g:"")+"}"),o=y?A[this.isXAxis?"x":"y"]:this.toValue(p?v.chartX:v.chartY),f.attr({text:u?format(u,{value:o},n):l.formatter.call(this,o),x:i,y:e,visibility:o<k||o>P?"hidden":"visible"}),s=f.getBBox(),p?(m&&!c||!m&&c)&&(e=f.y-s.height):e=f.y-s.height/2,r=p?{left:d-s.x,right:d+this.width-s.x}:{left:"left"===this.labelAlign?d:0,right:"right"===this.labelAlign?d+this.width:n.chartWidth},f.translateX<r.left&&(b=r.left-f.translateX),f.translateX+s.width>=r.right&&(b=-(f.translateX+s.width-r.right)),f.attr({x:i+b,y:e,anchorX:p?i:this.opposite?0:n.chartWidth,anchorY:p?this.opposite?n.chartHeight:0:e+s.height/2})}}),seriesProto.init=function(){seriesInit.apply(this,arguments),this.setCompare(this.options.compare)},seriesProto.setCompare=function(t){this.modifyValue="value"===t||"percent"===t?function(i,e){var s=this.compareValue;return void 0!==i&&void 0!==s?("value"===t?i-=s:i=i/s*100-(100===this.options.compareBase?0:100),e&&(e.change=i),i):0}:null,this.userOptions.compare=t,this.chart.hasRendered&&(this.isDirty=!0)},seriesProto.processData=function(t){var i,e,s,r,a,o=-1,n=!0===this.options.compareStart?0:1;if(seriesProcessData.apply(this,arguments),this.xAxis&&this.processedYData)for(e=this.processedXData,r=(s=this.processedYData).length,this.pointArrayMap&&(o=this.pointArrayMap.indexOf(this.options.pointValKey||this.pointValKey||"y")),i=0;i<r-n;i++)if(a=s[i]&&o>-1?s[i][o]:s[i],isNumber(a)&&e[i+n]>=this.xAxis.min&&0!==a){this.compareValue=a;break}},addEvent(Series,"afterGetExtremes",function(t){var i=t.dataExtremes;if(this.modifyValue&&i){var e=[this.modifyValue(i.dataMin),this.modifyValue(i.dataMax)];i.dataMin=arrayMin(e),i.dataMax=arrayMax(e)}}),Axis.prototype.setCompare=function(t,i){this.isXAxis||(this.series.forEach(function(i){i.setCompare(t)}),pick(i,!0)&&this.chart.redraw())},Point.prototype.tooltipFormatter=function(t){var i=this.series.chart.numberFormatter;return t=t.replace("{point.change}",(this.change>0?"+":"")+i(this.change,pick(this.series.tooltipOptions.changeDecimals,2))),pointTooltipFormatter.apply(this,[t])},addEvent(Series,"render",function(){var t,i=this.chart;if((!i.is3d||!i.is3d())&&!i.polar&&this.xAxis&&!this.xAxis.isRadial){if(t=this.yAxis.len,this.xAxis.axisLine){var e=i.plotTop+i.plotHeight-this.yAxis.pos-this.yAxis.len,s=Math.floor(this.xAxis.axisLine.strokeWidth()/2);e>=0&&(t-=Math.max(s-e,0))}!this.clipBox&&this.animate?(this.clipBox=merge(i.clipBox),this.clipBox.width=this.xAxis.len,this.clipBox.height=t):i[this.sharedClipKey]&&(i[this.sharedClipKey].animate({width:this.xAxis.len,height:t}),i[this.sharedClipKey+"m"]&&i[this.sharedClipKey+"m"].animate({width:this.xAxis.len}))}}),addEvent(Chart,"update",function(t){var i=t.options;"scrollbar"in i&&this.navigator&&(merge(!0,this.options.scrollbar,i.scrollbar),this.navigator.update({},!1),delete i.scrollbar)});