"use strict";import H from"../../parts/Globals.js";import U from"../../parts/Utilities.js";var addEvent=U.addEvent,extend=U.extend,pick=U.pick,svgElementBorderUpdateTriggers=["x","y","transform","width","height","r","d","stroke-width"];function addDestroyFocusBorderHook(o){if(!o.focusBorderDestroyHook){var e=o.destroy;o.destroy=function(){var t,r;return null===(r=null===(t=o.focusBorder)||void 0===t?void 0:t.destroy)||void 0===r||r.call(t),e.apply(o,arguments)},o.focusBorderDestroyHook=e}}function removeDestroyFocusBorderHook(o){o.focusBorderDestroyHook&&(o.destroy=o.focusBorderDestroyHook,delete o.focusBorderDestroyHook)}function addUpdateFocusBorderHooks(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];o.focusBorderUpdateHooks||(o.focusBorderUpdateHooks={},svgElementBorderUpdateTriggers.forEach(function(t){var r=t+"Setter",s=o[r]||o._defaultSetter;o.focusBorderUpdateHooks[r]=s,o[r]=function(){var t=s.apply(o,arguments);return o.addFocusBorder.apply(o,e),t}}))}function removeUpdateFocusBorderHooks(o){o.focusBorderUpdateHooks&&(Object.keys(o.focusBorderUpdateHooks).forEach(function(e){var t=o.focusBorderUpdateHooks[e];t===o._defaultSetter?delete o[e]:o[e]=t}),delete o.focusBorderUpdateHooks)}extend(H.SVGElement.prototype,{addFocusBorder:function(o,e){this.focusBorder&&this.removeFocusBorder();var t=this.getBBox(),r=pick(o,3);t.x+=this.translateX?this.translateX:0,t.y+=this.translateY?this.translateY:0;var s,d,i,a=t.x-r,n=t.y-r,c=t.width+2*r,u=t.height+2*r;if("text"===this.element.nodeName||this.isLabel){var h=!!this.rotation,f=this.isLabel?{x:h?1:0,y:0}:(d=0,i=0,"middle"===(s=this).attr("text-anchor")?(d=H.isFirefox&&s.rotation?.25:.5,i=H.isFirefox&&!s.rotation?.75:.5):s.rotation?d=.25:i=.75,{x:d,y:i});if(a=+this.attr("x")-t.width*f.x-r,n=+this.attr("y")-t.height*f.y-r,this.isLabel&&h){var l=c;c=u,u=l,a=+this.attr("x")-t.height*f.x-r,n=+this.attr("y")-t.width*f.y-r}}this.focusBorder=this.renderer.rect(a,n,c,u,parseInt((e&&e.borderRadius||0).toString(),10)).addClass("highcharts-focus-border").attr({zIndex:99}).add(this.parentGroup),this.renderer.styledMode||this.focusBorder.attr({stroke:e&&e.stroke,"stroke-width":e&&e.strokeWidth}),addUpdateFocusBorderHooks(this,o,e),addDestroyFocusBorderHook(this)},removeFocusBorder:function(){removeUpdateFocusBorderHooks(this),removeDestroyFocusBorderHook(this),this.focusBorder&&(this.focusBorder.destroy(),delete this.focusBorder)}}),H.Chart.prototype.renderFocusBorder=function(){var o=this.focusElement,e=this.options.accessibility.keyboardNavigation.focusBorder;o&&(o.removeFocusBorder(),e.enabled&&o.addFocusBorder(e.margin,{stroke:e.style.color,strokeWidth:e.style.lineWidth,borderRadius:e.style.borderRadius}))},H.Chart.prototype.setFocusToElement=function(o,e){var t=this.options.accessibility.keyboardNavigation.focusBorder,r=e||o.element;r&&r.focus&&(r.hcEvents&&r.hcEvents.focusin||addEvent(r,"focusin",function(){}),r.focus(),t.hideBrowserFocusOutline&&(r.style.outline="none")),this.focusElement&&this.focusElement.removeFocusBorder(),this.focusElement=o,this.renderFocusBorder()};