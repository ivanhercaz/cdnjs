"use strict";!function(r){"object"==typeof module&&module.exports?module.exports=r.default=r:"function"==typeof define&&define.amd?define("highcharts/modules/draggable-points",["highcharts"],function(e){return r(e),r.Highcharts=e,r}):r("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){var r=e?e._modules:{};function t(e,r,t,o){e.hasOwnProperty(r)||(e[r]=o.apply(null,t))}t(r,"modules/draggable-points.src.js",[r["parts/Globals.js"],r["parts/Point.js"],r["parts/Utilities.js"]],function(o,e,r){var f=r.addEvent,v=r.clamp,z=r.merge,H=r.objectEach,S=r.pick,t=o.seriesTypes;function p(e){return{left:"right",right:"left",top:"bottom",bottom:"top"}[e]}function a(e){var r=e.shapeArgs||e.graphic.getBBox(),t=r.r||0,o=r.height-t,a=r.height/2;return[["M",0,t],["L",0,a-5],["A",1,1,0,0,0,0,5+a],["A",1,1,0,0,0,0,a-5],["M",0,5+a],["L",0,o]]}var i=t.line.prototype.dragDropProps={x:{axis:"x",move:!0},y:{axis:"y",move:!0}};t.flags&&(t.flags.prototype.dragDropProps=i);var n,s,d,g,l=t.column.prototype.dragDropProps={x:{axis:"x",move:!0},y:{axis:"y",move:!1,resize:!0,beforeResize:function(e,r,t){var o,a,i=t.series.translatedThreshold,n=e.attr("y");r.y>=t.series.options.threshold?(o=e.attr("height"),a=i?i-(n+o):0,e.attr({height:Math.max(0,Math.round(o+a))})):e.attr({y:Math.round(n+(i?i-n:0))})},resizeSide:function(e,r){var t=r.series.chart.dragHandles,o=e.y>=(r.series.options.threshold||0)?"top":"bottom",a=p(o);return t[a]&&(t[a].destroy(),delete t[a]),o},handlePositioner:function(e){var r=e.shapeArgs||e.graphic.getBBox();return{x:r.x,y:e.y>=(e.series.options.threshold||0)?r.y:r.y+r.height}},handleFormatter:function(e){var r=e.shapeArgs,t=r.r||0,o=r.width/2;return["M",t,0,"L",o-5,0,"A",1,1,0,0,0,5+o,0,"A",1,1,0,0,0,o-5,0,"M",5+o,0,"L",r.width-t,0]}}};t.bullet&&(t.bullet.prototype.dragDropProps={x:l.x,y:l.y,target:{optionName:"draggableTarget",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){var r=e.targetGraphic.getBBox();return{x:e.barX,y:r.y+r.height/2}},handleFormatter:l.y.handleFormatter}}),t.columnrange&&(t.columnrange.prototype.dragDropProps={x:{axis:"x",move:!0},low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){var r=e.shapeArgs||e.graphic.getBBox();return{x:r.x,y:r.y+r.height}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.high}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){var r=e.shapeArgs||e.graphic.getBBox();return{x:r.x,y:r.y}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e>=r.low}}}),t.boxplot&&(t.boxplot.prototype.dragDropProps={x:l.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.lowPlot}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.q1}},q1:{optionName:"draggableQ1",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.q1Plot}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.median&&e>=r.low}},median:{axis:"y",move:!0},q3:{optionName:"draggableQ3",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.q3Plot}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.high&&e>=r.median}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.highPlot}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e>=r.q3}}}),t.ohlc&&(t.ohlc.prototype.dragDropProps={x:l.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotLow}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.open&&e<=r.close}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotHigh}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e>=r.open&&e>=r.close}},open:{optionName:"draggableOpen",axis:"y",move:!0,resize:!0,resizeSide:function(e){return e.open>=e.close?"top":"bottom"},handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotOpen}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.high&&e>=r.low}},close:{optionName:"draggableClose",axis:"y",move:!0,resize:!0,resizeSide:function(e){return e.open>=e.close?"bottom":"top"},handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotClose}},handleFormatter:l.y.handleFormatter,propValidate:function(e,r){return e<=r.high&&e>=r.low}}}),t.arearange&&(n=t.columnrange.prototype.dragDropProps,s=function(e){var r=e.graphic?e.graphic.getBBox().width/2+1:4;return[["M",0-r,0],["a",r,r,0,1,0,2*r,0],["a",r,r,0,1,0,-2*r,0]]},t.arearange.prototype.dragDropProps={x:n.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){var r=e.lowerGraphic&&e.lowerGraphic.getBBox();return r?{x:r.x+r.width/2,y:r.y+r.height/2}:{x:-999,y:-999}},handleFormatter:s,propValidate:n.low.propValidate},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){var r=e.upperGraphic&&e.upperGraphic.getBBox();return r?{x:r.x+r.width/2,y:r.y+r.height/2}:{x:-999,y:-999}},handleFormatter:s,propValidate:n.high.propValidate}}),t.waterfall&&(t.waterfall.prototype.dragDropProps={x:l.x,y:z(l.y,{handleFormatter:function(e){return e.isSum||e.isIntermediateSum?null:l.y.handleFormatter(e)}})}),t.xrange&&(d=function(e,r){var t=e.series,o=t.xAxis,a=t.yAxis,i=t.chart.inverted,n=o.toPixels(e[r],!0),s=a.toPixels(e.y,!0),d=t.columnMetrics?t.columnMetrics.offset:-e.shapeArgs.height/2;return i&&(n=o.len-n,s=a.len-s),s+=d,{x:Math.round(n),y:Math.round(s)}},g=t.xrange.prototype.dragDropProps={y:{axis:"y",move:!0},x:{optionName:"draggableX1",axis:"x",move:!0,resize:!0,resizeSide:"left",handlePositioner:function(e){return d(e,"x")},handleFormatter:a,propValidate:function(e,r){return e<=r.x2}},x2:{optionName:"draggableX2",axis:"x",move:!0,resize:!0,resizeSide:"right",handlePositioner:function(e){return d(e,"x2")},handleFormatter:a,propValidate:function(e,r){return e>=r.x}}},t.gantt&&(t.gantt.prototype.dragDropProps={y:g.y,start:z(g.x,{optionName:"draggableStart",validateIndividualDrag:function(e){return!e.milestone}}),end:z(g.x2,{optionName:"draggableEnd",validateIndividualDrag:function(e){return!e.milestone}})})),["gauge","pie","sunburst","wordcloud","sankey","histogram","pareto","vector","windbarb","treemap","bellcurve","sma","map","mapline"].forEach(function(e){t[e]&&(t[e].prototype.dragDropProps=null)});var A=2,h={default:{className:"highcharts-drag-box-default",lineWidth:1,lineColor:"#888",color:"rgba(0, 0, 0, 0.1)",cursor:"move",zIndex:900}},x={className:"highcharts-drag-handle",color:"#fff",lineColor:"rgba(0, 0, 0, 0.6)",lineWidth:1,zIndex:901};function u(e){var r,t=["draggableX","draggableY"];for(H(e.dragDropProps,function(e){e.optionName&&t.push(e.optionName)}),r=t.length;r--;)if(e.options.dragDrop[t[r]])return 1}function y(e,r){return void 0===e.chartX||void 0===e.chartY?r.pointer.normalize(e):e}function D(r,e,t,o){var a=e.map(function(e){return f(r,e,t,o)});return function(){a.forEach(function(e){e()})}}function P(e,r){var t,o,a,i,n,s,d,p,g,l=(a=(o=r).series,i=[],n=a.options.dragDrop.groupBy,a.isSeriesBoosting?a.options.data.forEach(function(e,r){i.push((new a.pointClass).init(a,e)),i[i.length-1].index=r}):i=a.points,o.options[n]?i.filter(function(e){return e.options[n]===o.options[n]}):[o]),h=r.series,u=h.chart;S(h.options.dragDrop&&h.options.dragDrop.liveRedraw,!0)||(u.dragGuideBox=t=h.getGuideBox(l),u.setGuideBoxState("default",h.options.dragDrop.guideBox).add(h.group)),u.dragDropData={origin:(d=l,p=t,g={chartX:(s=e).chartX,chartY:s.chartY,guideBox:p&&{x:p.attr("x"),y:p.attr("y"),width:p.attr("width"),height:p.attr("height")},points:{}},d.forEach(function(o){var a={};H(o.series.dragDropProps,function(e,r){var t=o.series[e.axis+"Axis"];a[r]=o[r],a[r+"Offset"]=t.toPixels(o[r])-(t.horiz?s.chartX:s.chartY)}),a.point=o,g.points[o.id]=a}),g),point:r,groupedPoints:l,isDragging:!0}}function B(e,r){var t=e.dragDropData.newPoints,o=!1!==r&&z({duration:400},e.options.chart.animation);e.isDragDropAnimating=!0,H(t,function(e){e.point.update(e.newValues,!1)}),e.redraw(o),setTimeout(function(){delete e.isDragDropAnimating,e.hoverPoint&&!e.dragHandles&&e.hoverPoint.showDragHandles()},o.duration)}function F(e,r,t){var o=e.series,a=o.chart,i=a.dragDropData,n=o.dragDropProps[i.updateProp],s=i.newPoints[e.id].newValues,d="function"==typeof n.resizeSide?n.resizeSide(s,e):n.resizeSide;n.beforeResize&&n.beforeResize(a.dragGuideBox,s,e),function(e,r,t){var o;switch(r){case"left":o={x:e.attr("x")+t.x,width:Math.max(1,e.attr("width")-t.x)};break;case"right":o={width:Math.max(1,e.attr("width")+t.x)};break;case"top":o={y:e.attr("y")+t.y,height:Math.max(1,e.attr("height")-t.y)};break;case"bottom":o={height:Math.max(1,e.attr("height")+t.y)}}e.attr(o)}(a.dragGuideBox,"x"===n.axis&&o.xAxis.reversed||"y"===n.axis&&o.yAxis.reversed?p(d):d,{x:"x"===n.axis?r-(i.origin.prevdX||0):0,y:"y"===n.axis?t-(i.origin.prevdY||0):0})}function w(e){var r=e.series&&e.series.chart,t=r&&r.dragDropData;!r||!r.dragHandles||t&&(t.isDragging&&t.draggedPastSensitivity||t.isHoveringHandle===e.id)||r.hideDragHandles()}function N(e){var r=0;for(var t in e)Object.hasOwnProperty.call(e,t)&&r++;return r}function M(e){for(var r in e)if(Object.hasOwnProperty.call(e,r))return e[r]}function c(u,e){var r,c,t,o,a,i,n,s,d,p,g,l,h,m,f,x,y,v,D,P,w,b;e.zoomOrPanKeyPressed(u)||(a=0,(r=e.dragDropData)&&r.isDragging&&(t=(c=r.point).series.options.dragDrop,u.preventDefault(),r.draggedPastSensitivity||(r.draggedPastSensitivity=(f=u,x=e,y=S(c.options.dragDrop&&c.options.dragDrop.dragSensitivity,t&&t.dragSensitivity,A),v=x.dragDropData.origin,D=v.chartX,P=v.chartY,w=f.chartX,b=f.chartY,y<Math.sqrt((w-D)*(w-D)+(b-P)*(b-P)))),r.draggedPastSensitivity&&(r.newPoints=(s=u,d=(n=r).point,p=d.series,g=z(p.options.dragDrop,d.options.dragDrop),l={},h=n.updateProp,m={},H(d.series.dragDropProps,function(e,r){h&&(h!==r||!e.resize||e.optionName&&!1===g[e.optionName])||(h||e.move&&("x"===e.axis&&g.draggableX||"y"===e.axis&&g.draggableY))&&(l[r]=e)}),(h?[d]:n.groupedPoints).forEach(function(e){m[e.id]={point:e,newValues:e.getDropValues(n.origin,s,l)}}),m),i=1===(a=N(o=r.newPoints))?M(o):null,c.firePointEvent("drag",{origin:r.origin,newPoints:r.newPoints,newPoint:i&&i.newValues,newPointId:i&&i.point.id,numNewPoints:a,chartX:u.chartX,chartY:u.chartY},function(){var e,r,t,o,a,i,n,s,d,p,g,l,h;e=u,t=(r=c).series,o=t.chart,a=o.dragDropData,i=z(t.options.dragDrop,r.options.dragDrop),n=i.draggableX,s=i.draggableY,d=a.origin,p=e.chartX-d.chartX,g=e.chartY-d.chartY,l=p,h=a.updateProp,o.inverted&&(p=-g,g=-l),S(i.liveRedraw,!0)?(B(o,!1),r.showDragHandles()):h?F(r,p,g):o.dragGuideBox.translate(n?p:0,s?g:0),d.prevdX=p,d.prevdY=g}))))}function m(e,r){var t,o,a,i,n=r.dragDropData;n&&n.isDragging&&n.draggedPastSensitivity&&(t=n.point,i=1===(a=N(o=n.newPoints))?M(o):null,r.dragHandles&&r.hideDragHandles(),e.preventDefault(),r.cancelClick=!0,t.firePointEvent("drop",{origin:n.origin,chartX:e.chartX,chartY:e.chartY,newPoints:o,numNewPoints:a,newPoint:i&&i.newValues,newPointId:i&&i.point.id},function(){B(r)})),delete r.dragDropData,r.dragGuideBox&&(r.dragGuideBox.destroy(),delete r.dragGuideBox)}function b(e,r){var t,o,a,i,n,s,d,p=r.hoverPoint,g=z(p&&p.series.options.dragDrop,p&&p.options.dragDrop),l=g.draggableX||!1,h=g.draggableY||!1;r.cancelClick=!1,!l&&!h||r.zoomOrPanKeyPressed(e)||r.hasDraggedAnnotation||(r.dragDropData&&r.dragDropData.isDragging?m(e,r):p&&(i=(t=p).series,n=i.options.dragDrop||{},s=t.options&&t.options.dragDrop,d=i.dragDropProps,H(d,function(e){"x"===e.axis&&e.move?o=!0:"y"===e.axis&&e.move&&(a=!0)}),(n.draggableX&&o||n.draggableY&&a)&&(!s||!1!==s.draggableX||!1!==s.draggableY)&&i.yAxis&&i.xAxis)&&(r.mouseIsDown=!1,P(e,p),p.firePointEvent("dragStart",e)))}function V(r){var e=r.container,t=o.doc;!function(e){var r=e.series?e.series.length:0;if(e.hasCartesianSeries&&!e.polar)for(;r--;)if(e.series[r].options.dragDrop&&u(e.series[r]))return 1}(r)||(D(e,["mousedown","touchstart"],function(e){b(y(e,r),r)}),D(e,["mousemove","touchmove"],function(e){c(y(e,r),r)}),f(e,"mouseleave",function(e){m(y(e,r),r)}),r.unbindDragDropMouseUp=D(t,["mouseup","touchend"],function(e){m(y(e,r),r)}),r.hasAddedDragDropEvents=!0,f(r,"destroy",function(){r.unbindDragDropMouseUp&&r.unbindDragDropMouseUp()}))}o.Chart.prototype.setGuideBoxState=function(e,r){var t=this.dragGuideBox,o=z(h,r),a=z(o.default,o[e]);return t.attr({className:a.className,stroke:a.lineColor,strokeWidth:a.lineWidth,fill:a.color,cursor:a.cursor,zIndex:a.zIndex}).css({pointerEvents:"none"})},e.prototype.getDropValues=function(e,h,r){var u,c=this,m=c.series,f=z(m.options.dragDrop,c.options.dragDrop),x={},y=e.points[c.id];for(var t in r)if(Object.hasOwnProperty.call(r,t)){if(void 0!==u){u=!1;break}u=!0}return H(r,function(e,r){var t,o,a,i,n,s,d,p=y[r],g=m[e.axis+"Axis"],l=(t=g.toValue((g.horiz?h.chartX:h.chartY)+y[r+"Offset"]),o=e.axis.toUpperCase(),a=m[o.toLowerCase()+"Axis"].categories?1:0,i=S(f["dragPrecision"+o],a),n=S(f["dragMin"+o],-1/0),s=S(f["dragMax"+o],1/0),d=t,i&&(d=Math.round(d/i)*i),v(d,n,s));u&&e.propValidate&&!e.propValidate(l,c)||void 0===p||(x[r]=l)}),x},o.Series.prototype.getGuideBox=function(e){var t,r=this.chart,o=1/0,a=-1/0,i=1/0,n=-1/0;return e.forEach(function(e){var r=e.graphic&&e.graphic.getBBox()||e.shapeArgs;r&&(r.width||r.height||r.x||r.y)&&(t=!0,o=Math.min(r.x,o),a=Math.max(r.x+r.width,a),i=Math.min(r.y,i),n=Math.max(r.y+r.height,n))}),t?r.renderer.rect(o,i,a-o,n-i):r.renderer.g()},e.prototype.showDragHandles=function(){var l=this,h=l.series,u=h.chart,c=u.renderer,m=z(h.options.dragDrop,l.options.dragDrop);H(h.dragDropProps,function(e,i){var r,t,o,a,n=z(x,e.handleOptions,m.dragHandle),s={className:n.className,"stroke-width":n.lineWidth,fill:n.color,stroke:n.lineColor},d=n.pathFormatter||e.handleFormatter,p=e.handlePositioner,g=!e.validateIndividualDrag||e.validateIndividualDrag(l);if(e.resize&&g&&e.resizeSide&&d&&(m["draggable"+e.axis.toUpperCase()]||m[e.optionName])&&!1!==m[e.optionName]){if(u.dragHandles||(u.dragHandles={group:c.g("drag-drop-handles").add(h.markerGroup||h.group)}),u.dragHandles.point=l.id,r=p(l),s.d=a=d(l),o="function"==typeof e.resizeSide?e.resizeSide(l.options,l):e.resizeSide,!a||r.x<0||r.y<0)return;s.cursor=n.cursor||"x"===e.axis!=!!u.inverted?"ew-resize":"ns-resize",(t=(t=u.dragHandles[o])||(u.dragHandles[o]=c.path().add(u.dragHandles.group))).translate(r.x,r.y).attr(s),D(t.element,["touchstart","mousedown"],function(e){var r,t,o,a;r=y(e,u),o=i,(a=(t=l).series.chart).zoomOrPanKeyPressed(r)||(a.mouseIsDown=!1,P(r,t),a.dragDropData.updateProp=r.updateProp=o,t.firePointEvent("dragStart",r),r.stopPropagation(),r.preventDefault())}),f(u.dragHandles.group.element,"mouseover",function(){u.dragDropData=u.dragDropData||{},u.dragDropData.isHoveringHandle=l.id}),D(u.dragHandles.group.element,["touchend","mouseout"],function(){var e,r;(r=(e=l).series.chart).dragDropData&&e.id===r.dragDropData.isHoveringHandle&&delete r.dragDropData.isHoveringHandle,r.hoverPoint||w(e)})}})},o.Chart.prototype.hideDragHandles=function(){var e=this;e.dragHandles&&(H(e.dragHandles,function(e,r){"group"!==r&&e.destroy&&e.destroy()}),e.dragHandles.group&&e.dragHandles.group.destroy&&e.dragHandles.group.destroy(),delete e.dragHandles)},f(e,"mouseOver",function(){var i=this;setTimeout(function(){var e,r,t,o,a;r=(e=i).series,t=r&&r.chart,o=t&&t.dragDropData,a=t&&t.is3d&&t.is3d(),!t||o&&o.isDragging&&o.draggedPastSensitivity||t.isDragDropAnimating||!r.options.dragDrop||a||(t.dragHandles&&t.hideDragHandles(),e.showDragHandles())},12)}),f(e,"mouseOut",function(){var e=this;setTimeout(function(){e.series&&w(e)},10)}),f(e,"remove",function(){var e=this.series.chart,r=e.dragHandles;r&&r.point===this.id&&e.hideDragHandles()}),o.Chart.prototype.zoomOrPanKeyPressed=function(e){var r=this.userOptions.chart||{},t=r.panKey&&r.panKey+"Key";return e[r.zoomKey&&r.zoomKey+"Key"]||e[t]},f(o.Chart,"render",function(){this.hasAddedDragDropEvents||V(this)})}),t(r,"masters/modules/draggable-points.src.js",[],function(){})});