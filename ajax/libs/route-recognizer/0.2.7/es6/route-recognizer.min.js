function Target(e,t,r){this.path=e,this.matcher=t,this.delegate=r}function Matcher(e){this.routes={},this.children={},this.target=e}function generateMatch(e,t,r){return function(n,a){var i=e+n;if(!a)return new Target(e+n,t,r);a(generateMatch(i,t,r))}}function addRoute(e,t,r){for(var n=0,a=0;a<e.length;a++)n+=e[a].path.length;var i={path:t=t.substr(n),handler:r};e.push(i)}function eachRoute(e,t,r,n){var a=t.routes;for(var i in a)if(a.hasOwnProperty(i)){var s=e.slice();addRoute(s,i,a[i]),t.children[i]?eachRoute(s,t.children[i],r,n):r.call(n,s)}}function map(e,t){var r=new Matcher;e(generateMatch("",r,this.delegate)),eachRoute([],r,function(e){t?t(this,e):this.add(e)},this)}function normalizePath(e){return e.split("/").map(normalizeSegment).join("/")}Target.prototype={to:function(e,t){var r=this.delegate;if(r&&r.willAddRoute&&(e=r.willAddRoute(this.matcher.target,e)),this.matcher.add(this.path,e),t){if(0===t.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,e,t,this.delegate)}return this}},Matcher.prototype={add:function(e,t){this.routes[e]=t},addChild:function(e,t,r,n){var a=new Matcher(t);this.children[e]=a;var i=generateMatch(e,a,n);n&&n.contextEntered&&n.contextEntered(t,i),r(i)}};var SEGMENT_RESERVED_CHARS=/%|\//g;function normalizeSegment(e){return decodeURIComponent(e).replace(SEGMENT_RESERVED_CHARS,encodeURIComponent)}var PATH_SEGMENT_ENCODINGS=/%(?:24|26|2B|2C|3B|3D|3A|40)/g;function encodePathSegment(e){return encodeURIComponent(e).replace(PATH_SEGMENT_ENCODINGS,decodeURIComponent)}var specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],escapeRegex=new RegExp("(\\"+specials.join("|\\")+")","g");function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function StaticSegment(e){this.string=normalizeSegment(e)}function DynamicSegment(e){this.name=normalizeSegment(e)}function StarSegment(e){this.name=e}function EpsilonSegment(){}function parse(e,t,r,n){"/"===e.charAt(0)&&(e=e.substr(1));for(var a=e.split("/"),i=new Array(a.length),s=0;s<a.length;s++){var o,h=a[s];(o=h.match(/^:([^\/]+)$/))?(i[s]=new DynamicSegment(o[1]),t.push(o[1]),n.push(!0),r.dynamics++):(o=h.match(/^\*([^\/]+)$/))?(i[s]=new StarSegment(o[1]),t.push(o[1]),n.push(!1),r.stars++):""===h?i[s]=new EpsilonSegment:(i[s]=new StaticSegment(h),r.statics++)}return i}function isEqualCharSpec(e,t){return e.validChars===t.validChars&&e.invalidChars===t.invalidChars}function State(e){this.charSpec=e,this.nextStates=[],this.regex=void 0,this.handlers=void 0,this.specificity=void 0}function sortSolutions(e){return e.sort(function(e,t){if(e.types.stars!==t.types.stars)return e.types.stars-t.types.stars;if(e.types.stars){if(e.types.statics!==t.types.statics)return t.types.statics-e.types.statics;if(e.types.dynamics!==t.types.dynamics)return t.types.dynamics-e.types.dynamics}return e.types.dynamics!==t.types.dynamics?e.types.dynamics-t.types.dynamics:e.types.statics!==t.types.statics?t.types.statics-e.types.statics:0})}function recognizeChar(e,t){for(var r=[],n=0,a=e.length;n<a;n++){var i=e[n];r=r.concat(i.match(t))}return r}StaticSegment.prototype={eachChar:function(e){for(var t,r=this.string,n=0;n<r.length;n++)t=r.charAt(n),e=e.put({invalidChars:void 0,repeat:!1,validChars:t});return e},regex:function(){return this.string.replace(escapeRegex,"\\$1")},generate:function(){return this.string}},DynamicSegment.prototype={eachChar:function(e){return e.put({invalidChars:"/",repeat:!0,validChars:void 0})},regex:function(){return"([^/]+)"},generate:function(e){return RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS?encodePathSegment(e[this.name]):e[this.name]}},StarSegment.prototype={eachChar:function(e){return e.put({invalidChars:"",repeat:!0,validChars:void 0})},regex:function(){return"(.+)"},generate:function(e){return e[this.name]}},EpsilonSegment.prototype={eachChar:function(e){return e},regex:function(){return""},generate:function(){return""}},State.prototype={get:function(e){for(var t=this.nextStates,r=0;r<t.length;r++){var n=t[r];if(isEqualCharSpec(n.charSpec,e))return n}},put:function(e){var t;return(t=this.get(e))?t:(t=new State(e),this.nextStates.push(t),e.repeat&&t.nextStates.push(t),t)},match:function(e){for(var t,r,n,a=this.nextStates,i=[],s=0;s<a.length;s++)void 0!==(n=(r=(t=a[s]).charSpec).validChars)?-1!==n.indexOf(e)&&i.push(t):void 0!==(n=r.invalidChars)&&-1===n.indexOf(e)&&i.push(t);return i}};var oCreate=Object.create||function(e){function t(){}return t.prototype=e,new t};function RecognizeResults(e){this.queryParams=e||{}}function findHandler(e,t,r){var n=e.handlers,a=e.regex,i=t.match(a),s=1,o=new RecognizeResults(r);o.length=n.length;for(var h=0;h<n.length;h++){for(var c,u,p,l=n[h],d=l.names,g=l.shouldDecodes,f={},m=0;m<d.length;m++)c=d[m],u=g[m],p=i[s++],RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS?f[c]=u?decodeURIComponent(p):p:f[c]=p;o[h]={handler:l.handler,params:f,isDynamic:!!d.length}}return o}function decodeQueryParamPart(e){var t;e=e.replace(/\+/gm,"%20");try{t=decodeURIComponent(e)}catch(e){t=""}return t}RecognizeResults.prototype=oCreate({splice:Array.prototype.splice,slice:Array.prototype.slice,push:Array.prototype.push,length:0,queryParams:null});var RouteRecognizer=function(){this.rootState=new State,this.names={}};RouteRecognizer.prototype={add:function(e,t){for(var r,n=this.rootState,a="^",i={statics:0,dynamics:0,stars:0},s=new Array(e.length),o=[],h=!0,c=0;c<e.length;c++){var u=e[c],p=[],l=[],d=parse(u.path,p,i,l);o=o.concat(d);for(var g=0;g<d.length;g++){var f=d[g];f instanceof EpsilonSegment||(h=!1,n=n.put({invalidChars:void 0,repeat:!1,validChars:"/"}),a+="/",n=f.eachChar(n),a+=f.regex())}var m={handler:u.handler,names:p,shouldDecodes:l};s[c]=m}h&&(n=n.put({invalidChars:void 0,repeat:!1,validChars:"/"}),a+="/"),n.handlers=s,n.regex=new RegExp(a+"$"),n.types=i,(r=t&&t.as)&&(this.names[r]={segments:o,handlers:s})},handlersFor:function(e){var t=this.names[e];if(!t)throw new Error("There is no route named "+e);for(var r=new Array(t.handlers.length),n=0;n<t.handlers.length;n++)r[n]=t.handlers[n];return r},hasRoute:function(e){return!!this.names[e]},generate:function(e,t){var r=this.names[e],n="";if(!r)throw new Error("There is no route named "+e);for(var a=r.segments,i=0;i<a.length;i++){var s=a[i];s instanceof EpsilonSegment||(n+="/",n+=s.generate(t))}return"/"!==n.charAt(0)&&(n="/"+n),t&&t.queryParams&&(n+=this.generateQueryString(t.queryParams,r.handlers)),n},generateQueryString:function(e){var t=[],r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(n);r.sort();for(var a=0;a<r.length;a++){var i=e[n=r[a]];if(null!=i){var s=encodeURIComponent(n);if(isArray(i))for(var o=0;o<i.length;o++){var h=n+"[]="+encodeURIComponent(i[o]);t.push(h)}else s+="="+encodeURIComponent(i),t.push(s)}}return 0===t.length?"":"?"+t.join("&")},parseQueryString:function(e){for(var t=e.split("&"),r={},n=0;n<t.length;n++){var a,i=t[n].split("="),s=decodeQueryParamPart(i[0]),o=s.length,h=!1;1===i.length?a="true":(o>2&&"[]"===s.slice(o-2)&&(h=!0,r[s=s.slice(0,o-2)]||(r[s]=[])),a=i[1]?decodeQueryParamPart(i[1]):""),h?r[s].push(a):r[s]=a}return r},recognize:function(e){var t,r,n,a,i=[this.rootState],s={},o=!1;if(-1!==(a=e.indexOf("#"))&&(e=e.substr(0,a)),-1!==(n=e.indexOf("?"))){var h=e.substr(n+1,e.length);e=e.substr(0,n),s=this.parseQueryString(h)}"/"!==e.charAt(0)&&(e="/"+e);var c=e;for(RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS?e=normalizePath(e):(e=decodeURI(e),c=decodeURI(c)),(t=e.length)>1&&"/"===e.charAt(t-1)&&(e=e.substr(0,t-1),c=c.substr(0,c.length-1),o=!0),r=0;r<e.length&&(i=recognizeChar(i,e.charAt(r))).length;r++);var u=[];for(r=0;r<i.length;r++)i[r].handlers&&u.push(i[r]);i=sortSolutions(u);var p=u[0];if(p&&p.handlers)return o&&"(.+)$"===p.regex.source.slice(-5)&&(c+="/"),findHandler(p,c,s)}},RouteRecognizer.prototype.map=map,RouteRecognizer.VERSION="0.2.7",RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS=!0,RouteRecognizer.Normalizer={normalizeSegment:normalizeSegment,normalizePath:normalizePath,encodePathSegment:encodePathSegment};export default RouteRecognizer;