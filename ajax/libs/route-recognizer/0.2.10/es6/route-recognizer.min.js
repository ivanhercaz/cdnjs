function Target(e,t,r){this.path=e,this.matcher=t,this.delegate=r}function Matcher(e){this.routes={},this.children={},this.target=e}function generateMatch(e,t,r){return function(n,a){var o=e+n;if(!a)return new Target(e+n,t,r);a(generateMatch(o,t,r))}}function addRoute(e,t,r){for(var n=0,a=0;a<e.length;a++)n+=e[a].path.length;var o={path:t=t.substr(n),handler:r};e.push(o)}function eachRoute(e,t,r,n){var a=t.routes;for(var o in a)if(a.hasOwnProperty(o)){var i=e.slice();addRoute(i,o,a[o]),t.children[o]?eachRoute(i,t.children[o],r,n):r.call(n,i)}}Target.prototype={to:function(e,t){var r=this.delegate;if(r&&r.willAddRoute&&(e=r.willAddRoute(this.matcher.target,e)),this.matcher.add(this.path,e),t){if(0===t.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,e,t,this.delegate)}return this}},Matcher.prototype={add:function(e,t){this.routes[e]=t},addChild:function(e,t,r,n){var a=new Matcher(t);this.children[e]=a;var o=generateMatch(e,a,n);n&&n.contextEntered&&n.contextEntered(t,o),r(o)}};var map=function(e,t){var r=new Matcher;e(generateMatch("",r,this.delegate)),eachRoute([],r,function(e){t?t(this,e):this.add(e)},this)};function normalizePath(e){return e.split("/").map(normalizeSegment).join("/")}var SEGMENT_RESERVED_CHARS=/%|\//g;function normalizeSegment(e){return decodeURIComponent(e).replace(SEGMENT_RESERVED_CHARS,encodeURIComponent)}var PATH_SEGMENT_ENCODINGS=/%(?:24|26|2B|2C|3B|3D|3A|40)/g;function encodePathSegment(e){return encodeURIComponent(e).replace(PATH_SEGMENT_ENCODINGS,decodeURIComponent)}var specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],escapeRegex=new RegExp("(\\"+specials.join("|\\")+")","g");function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function getParam(e,t){if("object"!=typeof e||null===e)throw new Error("You must pass an object as the second argument to `generate`.");if(!e.hasOwnProperty(t))throw new Error("You must provide param `"+t+"` to `generate`.");if(0===(""+e[t]).length)throw new Error("You must provide a param `"+t+"`.");return e[t]}function StaticSegment(e){this.string=normalizeSegment(e)}function DynamicSegment(e){this.name=normalizeSegment(e)}function StarSegment(e){this.name=e}function EpsilonSegment(){}function parse(e,t,r,n){"/"===e.charAt(0)&&(e=e.substr(1));for(var a=e.split("/"),o=new Array(a.length),i=0;i<a.length;i++){var s,h=a[i];(s=h.match(/^:([^\/]+)$/))?(o[i]=new DynamicSegment(s[1]),t.push(s[1]),n.push(!0),r.dynamics++):(s=h.match(/^\*([^\/]+)$/))?(o[i]=new StarSegment(s[1]),t.push(s[1]),n.push(!1),r.stars++):""===h?o[i]=new EpsilonSegment:(o[i]=new StaticSegment(h),r.statics++)}return o}function isEqualCharSpec(e,t){return e.validChars===t.validChars&&e.invalidChars===t.invalidChars}function State(e){this.charSpec=e,this.nextStates=[],this.regex=void 0,this.handlers=void 0,this.specificity=void 0}function sortSolutions(e){return e.sort(function(e,t){if(e.types.stars!==t.types.stars)return e.types.stars-t.types.stars;if(e.types.stars){if(e.types.statics!==t.types.statics)return t.types.statics-e.types.statics;if(e.types.dynamics!==t.types.dynamics)return t.types.dynamics-e.types.dynamics}return e.types.dynamics!==t.types.dynamics?e.types.dynamics-t.types.dynamics:e.types.statics!==t.types.statics?t.types.statics-e.types.statics:0})}function recognizeChar(e,t){for(var r=[],n=0,a=e.length;n<a;n++){var o=e[n];r=r.concat(o.match(t))}return r}StaticSegment.prototype={eachChar:function(e){for(var t,r=this.string,n=0;n<r.length;n++)t=r.charAt(n),e=e.put({invalidChars:void 0,repeat:!1,validChars:t});return e},regex:function(){return this.string.replace(escapeRegex,"\\$1")},generate:function(){return this.string}},DynamicSegment.prototype={eachChar:function(e){return e.put({invalidChars:"/",repeat:!0,validChars:void 0})},regex:function(){return"([^/]+)"},generate:function(e){var t=getParam(e,this.name);return RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS?encodePathSegment(t):t}},StarSegment.prototype={eachChar:function(e){return e.put({invalidChars:"",repeat:!0,validChars:void 0})},regex:function(){return"(.+)"},generate:function(e){return getParam(e,this.name)}},EpsilonSegment.prototype={eachChar:function(e){return e},regex:function(){return""},generate:function(){return""}},State.prototype={get:function(e){for(var t=this.nextStates,r=0;r<t.length;r++){var n=t[r];if(isEqualCharSpec(n.charSpec,e))return n}},put:function(e){var t;return(t=this.get(e))?t:(t=new State(e),this.nextStates.push(t),e.repeat&&t.nextStates.push(t),t)},match:function(e){for(var t,r,n,a=this.nextStates,o=[],i=0;i<a.length;i++)void 0!==(n=(r=(t=a[i]).charSpec).validChars)?-1!==n.indexOf(e)&&o.push(t):void 0!==(n=r.invalidChars)&&-1===n.indexOf(e)&&o.push(t);return o}};var oCreate=Object.create||function(e){function t(){}return t.prototype=e,new t};function RecognizeResults(e){this.queryParams=e||{}}function findHandler(e,t,r){var n=e.handlers,a=e.regex,o=t.match(a),i=1,s=new RecognizeResults(r);s.length=n.length;for(var h=0;h<n.length;h++){for(var c,u,p,l=n[h],g=l.names,d=l.shouldDecodes,m={},f=0;f<g.length;f++)c=g[f],u=d[f],p=o[i++],RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS?m[c]=u?decodeURIComponent(p):p:m[c]=p;s[h]={handler:l.handler,params:m,isDynamic:!!g.length}}return s}function decodeQueryParamPart(e){var t;e=e.replace(/\+/gm,"%20");try{t=decodeURIComponent(e)}catch(e){t=""}return t}RecognizeResults.prototype=oCreate({splice:Array.prototype.splice,slice:Array.prototype.slice,push:Array.prototype.push,length:0,queryParams:null});var RouteRecognizer=function(){this.rootState=new State,this.names={}};RouteRecognizer.prototype={add:function(e,t){for(var r,n=this.rootState,a="^",o={statics:0,dynamics:0,stars:0},i=new Array(e.length),s=[],h=!0,c=0;c<e.length;c++){var u=e[c],p=[],l=[],g=parse(u.path,p,o,l);s=s.concat(g);for(var d=0;d<g.length;d++){var m=g[d];m instanceof EpsilonSegment||(h=!1,n=n.put({invalidChars:void 0,repeat:!1,validChars:"/"}),a+="/",n=m.eachChar(n),a+=m.regex())}var f={handler:u.handler,names:p,shouldDecodes:l};i[c]=f}h&&(n=n.put({invalidChars:void 0,repeat:!1,validChars:"/"}),a+="/"),n.handlers=i,n.regex=new RegExp(a+"$"),n.types=o,"object"==typeof t&&null!==t&&t.hasOwnProperty("as")&&(r=t.as),(r=t&&t.as)&&(this.names[r]={segments:s,handlers:i})},handlersFor:function(e){var t=this.names[e];if(!t)throw new Error("There is no route named "+e);for(var r=new Array(t.handlers.length),n=0;n<t.handlers.length;n++)r[n]=t.handlers[n];return r},hasRoute:function(e){return!!this.names[e]},generate:function(e,t){var r=this.names[e],n="";if(!r)throw new Error("There is no route named "+e);for(var a=r.segments,o=0;o<a.length;o++){var i=a[o];i instanceof EpsilonSegment||(n+="/",n+=i.generate(t))}return"/"!==n.charAt(0)&&(n="/"+n),t&&t.queryParams&&(n+=this.generateQueryString(t.queryParams,r.handlers)),n},generateQueryString:function(e){var t=[],r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(n);r.sort();for(var a=0;a<r.length;a++){var o=e[n=r[a]];if(null!=o){var i=encodeURIComponent(n);if(isArray(o))for(var s=0;s<o.length;s++){var h=n+"[]="+encodeURIComponent(o[s]);t.push(h)}else i+="="+encodeURIComponent(o),t.push(i)}}return 0===t.length?"":"?"+t.join("&")},parseQueryString:function(e){for(var t=e.split("&"),r={},n=0;n<t.length;n++){var a,o=t[n].split("="),i=decodeQueryParamPart(o[0]),s=i.length,h=!1;1===o.length?a="true":(s>2&&"[]"===i.slice(s-2)&&(h=!0,r[i=i.slice(0,s-2)]||(r[i]=[])),a=o[1]?decodeQueryParamPart(o[1]):""),h?r[i].push(a):r[i]=a}return r},recognize:function(e){var t,r,n,a,o=[this.rootState],i={},s=!1;if(-1!==(a=e.indexOf("#"))&&(e=e.substr(0,a)),-1!==(n=e.indexOf("?"))){var h=e.substr(n+1,e.length);e=e.substr(0,n),i=this.parseQueryString(h)}"/"!==e.charAt(0)&&(e="/"+e);var c=e;for(RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS?e=normalizePath(e):(e=decodeURI(e),c=decodeURI(c)),(t=e.length)>1&&"/"===e.charAt(t-1)&&(e=e.substr(0,t-1),c=c.substr(0,c.length-1),s=!0),r=0;r<e.length&&(o=recognizeChar(o,e.charAt(r))).length;r++);var u=[];for(r=0;r<o.length;r++)o[r].handlers&&u.push(o[r]);o=sortSolutions(u);var p=u[0];if(p&&p.handlers)return s&&"(.+)$"===p.regex.source.slice(-5)&&(c+="/"),findHandler(p,c,i)}},RouteRecognizer.prototype.map=map,RouteRecognizer.VERSION="0.2.10",RouteRecognizer.ENCODE_AND_DECODE_PATH_SEGMENTS=!0,RouteRecognizer.Normalizer={normalizeSegment:normalizeSegment,normalizePath:normalizePath,encodePathSegment:encodePathSegment};export default RouteRecognizer;