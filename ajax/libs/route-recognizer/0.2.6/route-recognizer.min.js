!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("route-recognizer",e):t.RouteRecognizer=e()}(this,function(){"use strict";function i(t,e,r){this.path=t,this.matcher=e,this.delegate=r}function o(t){this.routes={},this.children={},this.target=t}function h(n,a,s){return function(t,e){var r=n+t;if(!e)return new i(n+t,a,s);e(h(r,a,s))}}function c(t,e,r){for(var n=0,a=0;a<t.length;a++)n+=t[a].path.length;var s={path:e=e.substr(n),handler:r};t.push(s)}function d(t){return t.split("/").map(r).join("/")}i.prototype={to:function(t,e){var r=this.delegate;if(r&&r.willAddRoute&&(t=r.willAddRoute(this.matcher.target,t)),this.matcher.add(this.path,t),e){if(0===e.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,t,e,this.delegate)}return this}},o.prototype={add:function(t,e){this.routes[t]=e},addChild:function(t,e,r,n){var a=new o(e),s=h(t,this.children[t]=a,n);n&&n.contextEntered&&n.contextEntered(e,s),r(s)}};var e=/%|\//g;function r(t){return decodeURIComponent(t).replace(e,encodeURIComponent)}var n=/%(?:24|26|2B|2C|3B|3D|3A|40)/g;function a(t){return encodeURIComponent(t).replace(n,decodeURIComponent)}var t=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g");function u(t){this.string=r(t)}function p(t){this.name=r(t)}function l(t){this.name=t}function y(){}function m(t,e,r,n){"/"===t.charAt(0)&&(t=t.substr(1));for(var a=t.split("/"),s=new Array(a.length),i=0;i<a.length;i++){var o,h=a[i];(o=h.match(/^:([^\/]+)$/))?(s[i]=new p(o[1]),e.push(o[1]),n.push(!0),r.dynamics++):(o=h.match(/^\*([^\/]+)$/))?(s[i]=new l(o[1]),e.push(o[1]),n.push(!1),r.stars++):""===h?s[i]=new y:(s[i]=new u(h),r.statics++)}return s}function s(t){this.charSpec=t,this.nextStates=[],this.regex=void 0,this.handlers=void 0,this.specificity=void 0}function f(t,e){for(var r=[],n=0,a=t.length;n<a;n++){var s=t[n];r=r.concat(s.match(e))}return r}u.prototype={eachChar:function(t){for(var e,r=this.string,n=0;n<r.length;n++)e=r.charAt(n),t=t.put({invalidChars:void 0,repeat:!1,validChars:e});return t},regex:function(){return this.string.replace(t,"\\$1")},generate:function(){return this.string}},p.prototype={eachChar:function(t){return t.put({invalidChars:"/",repeat:!0,validChars:void 0})},regex:function(){return"([^/]+)"},generate:function(t){return E.ENCODE_AND_DECODE_PATH_SEGMENTS?a(t[this.name]):t[this.name]}},l.prototype={eachChar:function(t){return t.put({invalidChars:"",repeat:!0,validChars:void 0})},regex:function(){return"(.+)"},generate:function(t){return t[this.name]}},y.prototype={eachChar:function(t){return t},regex:function(){return""},generate:function(){return""}},s.prototype={get:function(t){for(var e,r,n=this.nextStates,a=0;a<n.length;a++){var s=n[a];if(e=s.charSpec,r=t,e.validChars===r.validChars&&e.invalidChars===r.invalidChars)return s}},put:function(t){var e;return(e=this.get(t))||(e=new s(t),this.nextStates.push(e),t.repeat&&e.nextStates.push(e)),e},match:function(t){for(var e,r,n,a=this.nextStates,s=[],i=0;i<a.length;i++)void 0!==(n=(r=(e=a[i]).charSpec).validChars)?-1!==n.indexOf(t)&&s.push(e):void 0!==(n=r.invalidChars)&&-1===n.indexOf(t)&&s.push(e);return s}};var g=Object.create||function(t){function e(){}return e.prototype=t,new e};function C(t){this.queryParams=t||{}}function v(t){var e;t=t.replace(/\+/gm,"%20");try{e=decodeURIComponent(t)}catch(t){e=""}return e}C.prototype=g({splice:Array.prototype.splice,slice:Array.prototype.slice,push:Array.prototype.push,length:0,queryParams:null});var E=function(){this.rootState=new s,this.names={}};return E.prototype={add:function(t,e){for(var r,n=this.rootState,a="^",s={statics:0,dynamics:0,stars:0},i=new Array(t.length),o=[],h=!0,c=0;c<t.length;c++){var u=t[c],p=[],d=[],l=m(u.path,p,s,d);o=o.concat(l);for(var f=0;f<l.length;f++){var g=l[f];g instanceof y||(h=!1,n=n.put({invalidChars:void 0,repeat:!1,validChars:"/"}),a+="/",n=g.eachChar(n),a+=g.regex())}var v={handler:u.handler,names:p,shouldDecodes:d};i[c]=v}h&&(n=n.put({invalidChars:void 0,repeat:!1,validChars:"/"}),a+="/"),n.handlers=i,n.regex=new RegExp(a+"$"),n.types=s,(r=e&&e.as)&&(this.names[r]={segments:o,handlers:i})},handlersFor:function(t){var e=this.names[t];if(!e)throw new Error("There is no route named "+t);for(var r=new Array(e.handlers.length),n=0;n<e.handlers.length;n++)r[n]=e.handlers[n];return r},hasRoute:function(t){return!!this.names[t]},generate:function(t,e){var r=this.names[t],n="";if(!r)throw new Error("There is no route named "+t);for(var a=r.segments,s=0;s<a.length;s++){var i=a[s];i instanceof y||(n+="/",n+=i.generate(e))}return"/"!==n.charAt(0)&&(n="/"+n),e&&e.queryParams&&(n+=this.generateQueryString(e.queryParams,r.handlers)),n},generateQueryString:function(t){var e,r=[],n=[];for(var a in t)t.hasOwnProperty(a)&&n.push(a);n.sort();for(var s=0;s<n.length;s++){var i=t[a=n[s]];if(null!=i){var o=encodeURIComponent(a);if(e=i,"[object Array]"===Object.prototype.toString.call(e))for(var h=0;h<i.length;h++){var c=a+"[]="+encodeURIComponent(i[h]);r.push(c)}else o+="="+encodeURIComponent(i),r.push(o)}}return 0===r.length?"":"?"+r.join("&")},parseQueryString:function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var a,s=e[n].split("="),i=v(s[0]),o=i.length,h=!1;a=1===s.length?"true":(2<o&&"[]"===i.slice(o-2)&&(h=!0,r[i=i.slice(0,o-2)]||(r[i]=[])),s[1]?v(s[1]):""),h?r[i].push(a):r[i]=a}return r},recognize:function(t){var e,r,n,a,s=[this.rootState],i={},o=!1;if(-1!==(a=t.indexOf("#"))&&(t=t.substr(0,a)),-1!==(n=t.indexOf("?"))){var h=t.substr(n+1,t.length);t=t.substr(0,n),i=this.parseQueryString(h)}"/"!==t.charAt(0)&&(t="/"+t);var c=t;for(E.ENCODE_AND_DECODE_PATH_SEGMENTS?t=d(t):(t=decodeURI(t),c=decodeURI(c)),1<(e=t.length)&&"/"===t.charAt(e-1)&&(t=t.substr(0,e-1),c=c.substr(0,e-1),o=!0),r=0;r<t.length&&(s=f(s,t.charAt(r))).length;r++);var u=[];for(r=0;r<s.length;r++)s[r].handlers&&u.push(s[r]);s=u.sort(function(t,e){if(t.types.stars!==e.types.stars)return t.types.stars-e.types.stars;if(t.types.stars){if(t.types.statics!==e.types.statics)return e.types.statics-t.types.statics;if(t.types.dynamics!==e.types.dynamics)return e.types.dynamics-t.types.dynamics}return t.types.dynamics!==e.types.dynamics?t.types.dynamics-e.types.dynamics:t.types.statics!==e.types.statics?e.types.statics-t.types.statics:0});var p=u[0];if(p&&p.handlers)return o&&"(.+)$"===p.regex.source.slice(-5)&&(c+="/"),function(t,e,r){var n=t.handlers,a=t.regex,s=e.match(a),i=1,o=new C(r);o.length=n.length;for(var h=0;h<n.length;h++){for(var c,u,p,d=n[h],l=d.names,f=d.shouldDecodes,g={},v=0;v<l.length;v++)c=l[v],u=f[v],p=s[i++],E.ENCODE_AND_DECODE_PATH_SEGMENTS?g[c]=u?decodeURIComponent(p):p:g[c]=p;o[h]={handler:d.handler,params:g,isDynamic:!!l.length}}return o}(p,c,i)}},E.prototype.map=function(t,e){var r=new o;t(h("",r,this.delegate)),function t(e,r,n,a){var s=r.routes;for(var i in s)if(s.hasOwnProperty(i)){var o=e.slice();c(o,i,s[i]),r.children[i]?t(o,r.children[i],n,a):n.call(a,o)}}([],r,function(t){e?e(this,t):this.add(t)},this)},E.VERSION="0.2.6",E.ENCODE_AND_DECODE_PATH_SEGMENTS=!0,E.Normalizer={normalizeSegment:r,normalizePath:d,encodePathSegment:a},E});