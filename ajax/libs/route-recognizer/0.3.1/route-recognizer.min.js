!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("route-recognizer",e):t.RouteRecognizer=e()}(this,function(){"use strict";var e=Object.create;function r(){var t=e(null);return t.__=void 0,delete t.__,t}var i=function(t,e,r){this.path=t,this.matcher=e,this.delegate=r};i.prototype.to=function(t,e){var r=this.delegate;if(r&&r.willAddRoute&&(t=r.willAddRoute(this.matcher.target,t)),this.matcher.add(this.path,t),e){if(0===e.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,t,e,this.delegate)}};function s(t){this.routes=r(),this.children=r(),this.target=t}function h(n,a,o){return function(t,e){var r=n+t;if(!e)return new i(r,a,o);e(h(r,a,o))}}function p(t,e,r){for(var n=0,a=0;a<t.length;a++)n+=t[a].path.length;var o={path:e=e.substr(n),handler:r};t.push(o)}function d(t){return t.split("/").map(c).join("/")}s.prototype.add=function(t,e){this.routes[t]=e},s.prototype.addChild=function(t,e,r,n){var a=new s(e),o=h(t,this.children[t]=a,n);n&&n.contextEntered&&n.contextEntered(e,o),r(o)};var n=/%|\//g;function c(t){return t.length<3||-1===t.indexOf("%")?t:decodeURIComponent(t).replace(n,encodeURIComponent)}var a=/%(?:2(?:4|6|B|C)|3(?:B|D|A)|40)/g;function o(t){return encodeURIComponent(t).replace(a,decodeURIComponent)}var u=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,l=Array.isArray;function f(t,e){var r=t[e];return"string"==typeof r?r:""+r}var g=[];g[0]=function(t,e){for(var r=e,n=t.value,a=0;a<n.length;a++){var o=n.charCodeAt(a);r=r.put(o,!1,!1)}return r},g[1]=function(t,e){return e.put(47,!0,!0)},g[2]=function(t,e){return e.put(-1,!1,!0)},g[4]=function(t,e){return e};var y=[];y[0]=function(t){return t.value.replace(u,"\\$1")},y[1]=function(){return"([^/]+)"},y[2]=function(){return"(.+)"},y[4]=function(){return""};var v=[];function m(t,e,r,n,a){0<e.length&&47===e.charCodeAt(0)&&(e=e.substr(1));for(var o=e.split("/"),i=0;i<o.length;i++){var s,h=o[i],u=0;12&(s=2<<(u=""===h?4:58===h.charCodeAt(0)?1:42===h.charCodeAt(0)?2:0))&&(h=h.slice(1),r.push(h),a.push(0!=(4&s))),14&s&&n[u]++,t.push({type:u,value:c(h)})}}function E(t,e,r){return t.char===e&&t.negate===r}v[0]=function(t){return t.value},v[1]=function(t,e){var r=f(e,t.value);return D.ENCODE_AND_DECODE_PATH_SEGMENTS?o(r):r},v[2]=function(t,e){return f(e,t.value)},v[4]=function(){return""};function S(t,e,r,n,a){this.states=t,this.id=e,this.char=r,this.negate=n,this.nextStates=a?e:null,this.pattern="",this._regex=void 0,this.handlers=void 0,this.types=void 0}function A(t,e){return t.negate?t.char!==e&&-1!==t.char:t.char===e||-1===t.char}function C(t,e){for(var r=[],n=0,a=t.length;n<a;n++){var o=t[n];r=r.concat(o.match(e))}return r}S.prototype.regex=function(){return this._regex||(this._regex=new RegExp(this.pattern)),this._regex},S.prototype.get=function(t,e){var r=this.nextStates;if(null!==r)if(l(r))for(var n=0;n<r.length;n++){var a=this.states[r[n]];if(E(a,t,e))return a}else{var o=this.states[r];if(E(o,t,e))return o}},S.prototype.put=function(t,e,r){var n;if(n=this.get(t,e))return n;var a=this.states;return n=new S(a,a.length,t,e,r),a[a.length]=n,null==this.nextStates?this.nextStates=n.id:l(this.nextStates)?this.nextStates.push(n.id):this.nextStates=[this.nextStates,n.id],n},S.prototype.match=function(t){var e=this.nextStates;if(!e)return[];var r=[];if(l(e))for(var n=0;n<e.length;n++){var a=this.states[e[n]];A(a,t)&&r.push(a)}else{var o=this.states[e];A(o,t)&&r.push(o)}return r};function _(t){this.length=0,this.queryParams=t||{}}function x(t){var e;t=t.replace(/\+/gm,"%20");try{e=decodeURIComponent(t)}catch(t){e=""}return e}_.prototype.splice=Array.prototype.splice,_.prototype.slice=Array.prototype.slice,_.prototype.push=Array.prototype.push;var D=function(){this.names=r();var t=[],e=new S(t,0,-1,!0,!1);t[0]=e,this.states=t,this.rootState=e};return D.prototype.add=function(t,e){for(var r,n=this.rootState,a="^",o=[0,0,0],i=new Array(t.length),s=[],h=!0,u=0,c=0;c<t.length;c++){var p=t[c],l=[],f=[];for(m(s,p.path,l,o,f);u<s.length;u++){var d=s[u];4!==d.type&&(h=!1,n=n.put(47,!1,!1),a+="/",n=g[d.type](d,n),a+=y[d.type](d))}var v={handler:p.handler,names:l,shouldDecodes:f};i[c]=v}h&&(n=n.put(47,!1,!1),a+="/"),n.handlers=i,n.pattern=a+"$",n.types=o,"object"==typeof e&&null!==e&&e.as&&(r=e.as),r&&(this.names[r]={segments:s,handlers:i})},D.prototype.handlersFor=function(t){var e=this.names[t];if(!e)throw new Error("There is no route named "+t);for(var r=new Array(e.handlers.length),n=0;n<e.handlers.length;n++)r[n]=e.handlers[n];return r},D.prototype.hasRoute=function(t){return!!this.names[t]},D.prototype.generate=function(t,e){var r=this.names[t],n="";if(!r)throw new Error("There is no route named "+t);for(var a=r.segments,o=0;o<a.length;o++){var i=a[o];4!==i.type&&(n+="/",n+=v[i.type](i,e))}return"/"!==n.charAt(0)&&(n="/"+n),e&&e.queryParams&&(n+=this.generateQueryString(e.queryParams)),n},D.prototype.generateQueryString=function(t){var e=[],r=Object.keys(t);r.sort();for(var n=0;n<r.length;n++){var a=r[n],o=t[a];if(null!=o){var i=encodeURIComponent(a);if(l(o))for(var s=0;s<o.length;s++){var h=a+"[]="+encodeURIComponent(o[s]);e.push(h)}else i+="="+encodeURIComponent(o),e.push(i)}}return 0===e.length?"":"?"+e.join("&")},D.prototype.parseQueryString=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var a=e[n].split("="),o=x(a[0]),i=o.length,s=!1,h=void 0;h=1===a.length?"true":(2<i&&"[]"===o.slice(i-2)&&(s=!0,r[o=o.slice(0,i-2)]||(r[o]=[])),a[1]?x(a[1]):""),s?r[o].push(h):r[o]=h}return r},D.prototype.recognize=function(t){var e,r=[this.rootState],n={},a=!1,o=t.indexOf("#");-1!==o&&(t=t.substr(0,o));var i=t.indexOf("?");if(-1!==i){var s=t.substr(i+1,t.length);t=t.substr(0,i),n=this.parseQueryString(s)}"/"!==t.charAt(0)&&(t="/"+t);var h=t;D.ENCODE_AND_DECODE_PATH_SEGMENTS?t=d(t):(t=decodeURI(t),h=decodeURI(h));var u=t.length;1<u&&"/"===t.charAt(u-1)&&(t=t.substr(0,u-1),h=h.substr(0,h.length-1),a=!0);for(var c=0;c<t.length&&(r=C(r,t.charCodeAt(c))).length;c++);for(var p=[],l=0;l<r.length;l++)r[l].handlers&&p.push(r[l]);r=p.sort(function(t,e){var r=t.types||[0,0,0],n=r[0],a=r[1],o=r[2],i=e.types||[0,0,0],s=i[0],h=i[1],u=i[2];if(o!==u)return o-u;if(o){if(n!==s)return s-n;if(a!==h)return h-a}return a!==h?a-h:n!==s?s-n:0});var f=p[0];return f&&f.handlers&&(a&&f.pattern&&"(.+)$"===f.pattern.slice(-5)&&(h+="/"),e=function(t,e,r){var n=t.handlers,a=t.regex();if(!a||!n)throw new Error("state not initialized");var o=e.match(a),i=1,s=new _(r);s.length=n.length;for(var h=0;h<n.length;h++){for(var u=n[h],c=u.names,p=u.shouldDecodes,l={},f=0;f<c.length;f++){var d=c[f],v=o&&o[i++];D.ENCODE_AND_DECODE_PATH_SEGMENTS&&p[f]?l[d]=v&&decodeURIComponent(v):l[d]=v}s[h]={handler:u.handler,params:l,isDynamic:!!c.length}}return s}(f,h,n)),e},D.VERSION="0.3.0",D.ENCODE_AND_DECODE_PATH_SEGMENTS=!0,D.Normalizer={normalizeSegment:c,normalizePath:d,encodePathSegment:o},D.prototype.map=function(t,e){var r=new s;t(h("",r,this.delegate)),function t(e,r,n,a){for(var o=r.routes,i=Object.keys(o),s=0;s<i.length;s++){var h=i[s],u=e.slice();p(u,h,o[h]);var c=r.children[h];c?t(u,c,n,a):n.call(a,u)}}([],r,function(t){e?e(this,t):this.add(t)},this)},D});