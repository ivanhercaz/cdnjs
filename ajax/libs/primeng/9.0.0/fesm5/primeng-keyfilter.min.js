import{forwardRef,EventEmitter,ElementRef,Input,Output,HostListener,Directive,NgModule}from"@angular/core";import{CommonModule}from"@angular/common";import{DomHandler}from"primeng/dom";import{NG_VALIDATORS}from"@angular/forms";var __decorate=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},KEYFILTER_VALIDATOR={provide:NG_VALIDATORS,useExisting:forwardRef(function(){return KeyFilter}),multi:!0},DEFAULT_MASKS={pint:/[\d]/,int:/[\d\-]/,pnum:/[\d\.]/,money:/[\d\.\s,]/,num:/[\d\-\.]/,hex:/[0-9a-f]/i,email:/[a-z0-9_\.\-@]/i,alpha:/[a-z_]/i,alphanum:/[a-z0-9_]/i},KEYS={TAB:9,RETURN:13,ESC:27,BACKSPACE:8,DELETE:46},SAFARI_KEYS={63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},KeyFilter=function(){function e(e){this.el=e,this.ngModelChange=new EventEmitter,this.isAndroid=DomHandler.isAndroid()}return Object.defineProperty(e.prototype,"pattern",{get:function(){return this._pattern},set:function(e){this._pattern=e,this.regex=DEFAULT_MASKS[this._pattern]||this._pattern},enumerable:!0,configurable:!0}),e.prototype.isNavKeyPress=function(e){var t=e.keyCode;return(t=DomHandler.getBrowser().safari&&SAFARI_KEYS[t]||t)>=33&&t<=40||t==KEYS.RETURN||t==KEYS.TAB||t==KEYS.ESC},e.prototype.isSpecialKey=function(e){var t=e.keyCode;e.charCode;return 9==t||13==t||27==t||16==t||17==t||t>=18&&t<=20||DomHandler.getBrowser().opera&&!e.shiftKey&&(8==t||t>=33&&t<=35||t>=36&&t<=39||t>=44&&t<=45)},e.prototype.getKey=function(e){var t=e.keyCode||e.charCode;return DomHandler.getBrowser().safari&&SAFARI_KEYS[t]||t},e.prototype.getCharCode=function(e){return e.charCode||e.keyCode||e.which},e.prototype.findDelta=function(e,t){for(var r="",i=0;i<e.length;i++){e.substr(0,i)+e.substr(i+e.length-t.length)===t&&(r=e.substr(i,e.length-t.length))}return r},e.prototype.isValidChar=function(e){return this.regex.test(e)},e.prototype.isValidString=function(e){for(var t=0;t<e.length;t++)if(!this.isValidChar(e.substr(t,1)))return!1;return!0},e.prototype.onInput=function(e){if(this.isAndroid&&!this.pValidateOnly){var t=this.el.nativeElement.value,r=this.lastValue||"",i=this.findDelta(t,r),n=this.findDelta(r,t);i.length>1||!i&&!n?this.isValidString(t)||(this.el.nativeElement.value=r,this.ngModelChange.emit(r)):n||this.isValidChar(i)||(this.el.nativeElement.value=r,this.ngModelChange.emit(r)),t=this.el.nativeElement.value,this.isValidString(t)&&(this.lastValue=t)}},e.prototype.onKeyPress=function(e){if(!this.isAndroid&&!this.pValidateOnly){var t=DomHandler.getBrowser();if(!e.ctrlKey&&!e.altKey){var r=this.getKey(e);if(!(13==r||t.mozilla&&(this.isNavKeyPress(e)||r==KEYS.BACKSPACE||r==KEYS.DELETE&&0==e.charCode))){var i=this.getCharCode(e),n=String.fromCharCode(i);(!t.mozilla||!this.isSpecialKey(e)&&n)&&(this.regex.test(n)||e.preventDefault())}}}},e.prototype.onPaste=function(e){var t=e.clipboardData||window.clipboardData.getData("text");if(t){var r=t.getData("text");this.regex.test(r)||e.preventDefault()}},e.prototype.validate=function(e){if(this.pValidateOnly){var t=this.el.nativeElement.value;if(t&&!this.regex.test(t))return{validatePattern:!1}}},e.ctorParameters=function(){return[{type:ElementRef}]},__decorate([Input()],e.prototype,"pValidateOnly",void 0),__decorate([Output()],e.prototype,"ngModelChange",void 0),__decorate([Input("pKeyFilter")],e.prototype,"pattern",null),__decorate([HostListener("input",["$event"])],e.prototype,"onInput",null),__decorate([HostListener("keypress",["$event"])],e.prototype,"onKeyPress",null),__decorate([HostListener("paste",["$event"])],e.prototype,"onPaste",null),e=__decorate([Directive({selector:"[pKeyFilter]",providers:[KEYFILTER_VALIDATOR]})],e)}(),KeyFilterModule=function(){function e(){}return e=__decorate([NgModule({imports:[CommonModule],exports:[KeyFilter],declarations:[KeyFilter]})],e)}();export{KEYFILTER_VALIDATOR,KeyFilter,KeyFilterModule};