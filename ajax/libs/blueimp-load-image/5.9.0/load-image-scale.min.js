!function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],t):"object"==typeof module&&module.exports?t(require("./load-image")):t(window.loadImage)}(function(y){"use strict";var n=y.transform;y.createCanvas=function(t,e,a){if(a&&y.global.OffscreenCanvas)return new OffscreenCanvas(t,e);var i=document.createElement("canvas");return i.width=t,i.height=e,i},y.transform=function(t,e,a,i,o){n.call(y,y.scale(t,e,o),e,a,i,o)},y.transformCoordinates=function(){},y.getTransformedOptions=function(t,e){var a,i,o,n,r=e.aspectRatio;if(!r)return e;for(i in a={},e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a.crop=!0,r<(o=t.naturalWidth||t.width)/(n=t.naturalHeight||t.height)?(a.maxWidth=n*r,a.maxHeight=n):(a.maxWidth=o,a.maxHeight=o/r),a},y.drawImage=function(t,e,a,i,o,n,r,h,d){var g=e.getContext("2d");return!1===d.imageSmoothingEnabled?(g.msImageSmoothingEnabled=!1,g.imageSmoothingEnabled=!1):d.imageSmoothingQuality&&(g.imageSmoothingQuality=d.imageSmoothingQuality),g.drawImage(t,a,i,o,n,0,0,r,h),g},y.requiresCanvas=function(t){return t.canvas||t.crop||!!t.aspectRatio},y.scale=function(t,e,a){e=e||{},a=a||{};var i,o,n,r,h,d,g,m,s,c,u,f,l=t.getContext||y.requiresCanvas(e)&&!!y.global.HTMLCanvasElement,v=t.naturalWidth||t.width,p=t.naturalHeight||t.height,w=v,C=p;function x(){var t=Math.max((n||w)/w,(r||C)/C);1<t&&(w*=t,C*=t)}function b(){var t=Math.min((i||w)/w,(o||C)/C);t<1&&(w*=t,C*=t)}if(l&&(g=(e=y.getTransformedOptions(t,e,a)).left||0,m=e.top||0,e.sourceWidth?(h=e.sourceWidth,void 0!==e.right&&void 0===e.left&&(g=v-h-e.right)):h=v-g-(e.right||0),e.sourceHeight?(d=e.sourceHeight,void 0!==e.bottom&&void 0===e.top&&(m=p-d-e.bottom)):d=p-m-(e.bottom||0),w=h,C=d),i=e.maxWidth,o=e.maxHeight,n=e.minWidth,r=e.minHeight,l&&i&&o&&e.crop?(u=h/d-(w=i)/(C=o))<0?(d=o*h/i,void 0===e.top&&void 0===e.bottom&&(m=(p-d)/2)):0<u&&(h=i*d/o,void 0===e.left&&void 0===e.right&&(g=(v-h)/2)):((e.contain||e.cover)&&(n=i=i||n,r=o=o||r),e.cover?(b(),x()):(x(),b())),l){if(1<(s=e.pixelRatio)&&(!t.style.width||Math.floor(parseFloat(t.style.width,10))!==Math.floor(v/s))&&(w*=s,C*=s),y.orientationCropBug&&!t.getContext&&(g||m||h!==v||d!==p)&&(u=t,t=y.createCanvas(v,p,!0),y.drawImage(u,t,0,0,v,p,v,p,e)),0<(c=e.downsamplingRatio)&&c<1&&w<h&&C<d)for(;w<h*c;)f=y.createCanvas(h*c,d*c,!0),y.drawImage(t,f,g,m,h,d,f.width,f.height,e),m=g=0,h=f.width,d=f.height,t=f;return f=y.createCanvas(w,C),y.transformCoordinates(f,e,a),1<s&&(f.style.width=f.width/s+"px",f.style.height=f.height/s+"px"),y.drawImage(t,f,g,m,h,d,w,C,e).setTransform(1,0,0,1,0,0),f}return t.width=w,t.height=C,t}});