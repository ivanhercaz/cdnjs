!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}(function(u){"use strict";u.blobSlice=u.global.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),u.bufferSlice=u.global.ArrayBuffer.prototype.slice||function(e,a){a=a||this.byteLength-e;var t=new Uint8Array(this,e,a),r=new Uint8Array(a);return r.set(t),r.buffer},u.metaDataParsers={jpeg:{65505:[],65517:[]}},u.parseMetaData=function(e,c,g,b){b=b||{};var d=this,a=(g=g||{}).maxMetaDataSize||262144;!!(u.global.DataView&&e&&12<=e.size&&"image/jpeg"===e.type&&u.blobSlice)&&u.readFile(u.blobSlice.call(e,0,a),function(e){if(e.target.error)return console.log(e.target.error),void c(b);var a,t,r,i,l=e.target.result,o=new DataView(l),n=2,s=o.byteLength-4,f=n;if(65496===o.getUint16(0)){for(;n<s&&(65504<=(a=o.getUint16(n))&&a<=65519||65534===a);){if(n+(t=o.getUint16(n+2)+2)>o.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if((r=u.metaDataParsers.jpeg[a])&&!g.disableMetaDataParsers)for(i=0;i<r.length;i+=1)r[i].call(d,o,n,t,b,g);f=n+=t}!g.disableImageHead&&6<f&&(b.imageHead=u.bufferSlice.call(l,0,f))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(b)},"readAsArrayBuffer")||c(b)},u.replaceHead=function(a,t,r){u.parseMetaData(a,function(e){r(new Blob([t,u.blobSlice.call(a,e.imageHead.byteLength)],{type:"image/jpeg"}))},{maxMetaDataSize:256,disableMetaDataParsers:!0})};var l=u.transform;u.transform=function(a,t,r,i,e){u.requiresMetaData(t)?u.parseMetaData(i,function(e){l.call(u,a,t,r,i,e)},t,e):l.apply(u,arguments)}});