!function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-scale","./load-image-meta"],t):"object"==typeof module&&module.exports?t(require("./load-image"),require("./load-image-scale"),require("./load-image-meta")):t(window.loadImage)}(function(B){"use strict";var r=B.transform,e=B.requiresCanvas,a=B.requiresMetaData,l=B.transformCoordinates,Q=B.getTransformedOptions;function A(t,e){var a=t&&t.orientation;return!0===a&&!B.orientation||1===a&&B.orientation||(!e||B.orientation)&&1<a&&a<9}function m(t,e){return t!==e&&(1===t&&1<e&&e<9||1<t&&t<9)}function b(t,e){if(1<e&&e<9)switch(t){case 2:case 4:return 4<e;case 5:case 7:return e%2==0;case 6:case 8:return 2===e||4===e||5===e||7===e}}!function(e){if(e.global.document){var a=document.createElement("img");a.onload=function(){if(e.orientation=2===a.width&&3===a.height,e.orientation){var t=e.createCanvas(1,1,!0).getContext("2d");t.drawImage(a,1,1,1,1,0,0,1,1),e.orientationCropBug="255,255,255,255"!==t.getImageData(0,0,1,1).data.toString()}},a.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="}}(B),B.requiresCanvas=function(t){return A(t)||e.call(B,t)},B.requiresMetaData=function(t){return A(t,!0)||a.call(B,t)},B.transform=function(t,e,i,a,A){r.call(B,t,e,function(t,e){if(e){var a=B.orientation&&e.exif&&e.exif.get("Orientation");if(4<a&&a<9){var A=e.originalWidth,r=e.originalHeight;e.originalWidth=r,e.originalHeight=A}}i(t,e)},a,A)},B.getTransformedOptions=function(t,e,a){var A=Q.call(B,t,e),r=a.exif&&a.exif.get("Orientation"),i=A.orientation,o=B.orientation&&r;if(!0===i&&(i=r),!m(i,o))return A;var n=A.top,s=A.right,c=A.bottom,l=A.left,f={};for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(f[E]=A[E]);if((4<(f.orientation=i)&&!(4<o)||i<5&&4<o)&&(f.maxWidth=A.maxHeight,f.maxHeight=A.maxWidth,f.minWidth=A.minHeight,f.minHeight=A.minWidth,f.sourceWidth=A.sourceHeight,f.sourceHeight=A.sourceWidth),1<o){switch(o){case 2:s=A.left,l=A.right;break;case 3:n=A.bottom,s=A.left,c=A.top,l=A.right;break;case 4:n=A.bottom,c=A.top;break;case 5:n=A.left,s=A.bottom,c=A.right,l=A.top;break;case 6:n=A.left,s=A.top,c=A.right,l=A.bottom;break;case 7:n=A.right,s=A.top,c=A.left,l=A.bottom;break;case 8:n=A.right,s=A.bottom,c=A.left,l=A.top}if(b(i,o)){var h=n,g=s;n=c,s=l,c=h,l=g}}switch(f.top=n,f.right=s,f.bottom=c,f.left=l,i){case 2:f.right=l,f.left=s;break;case 3:f.top=c,f.right=l,f.bottom=n,f.left=s;break;case 4:f.top=c,f.bottom=n;break;case 5:f.top=l,f.right=c,f.bottom=s,f.left=n;break;case 6:f.top=s,f.right=c,f.bottom=l,f.left=n;break;case 7:f.top=s,f.right=n,f.bottom=l,f.left=c;break;case 8:f.top=l,f.right=n,f.bottom=s,f.left=c}return f},B.transformCoordinates=function(t,e,a){l.call(B,t,e,a);var A=e.orientation,r=B.orientation&&a.exif&&a.exif.get("Orientation");if(m(A,r)){var i=t.getContext("2d"),o=t.width,n=t.height,s=o,c=n;switch((4<A&&!(4<r)||A<5&&4<r)&&(t.width=n,t.height=o),4<A&&(s=n,c=o),r){case 2:i.translate(s,0),i.scale(-1,1);break;case 3:i.translate(s,c),i.rotate(Math.PI);break;case 4:i.translate(0,c),i.scale(1,-1);break;case 5:i.rotate(-.5*Math.PI),i.scale(-1,1);break;case 6:i.rotate(-.5*Math.PI),i.translate(-s,0);break;case 7:i.rotate(-.5*Math.PI),i.translate(-s,c),i.scale(1,-1);break;case 8:i.rotate(.5*Math.PI),i.translate(0,-c)}switch(b(A,r)&&(i.translate(s,c),i.rotate(Math.PI)),A){case 2:i.translate(o,0),i.scale(-1,1);break;case 3:i.translate(o,n),i.rotate(Math.PI);break;case 4:i.translate(0,n),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI),i.translate(o,-n),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-o,0)}}}});