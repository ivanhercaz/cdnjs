!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}(function(u){"use strict";var e="undefined"!=typeof Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);u.blobSlice=e&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},u.metaDataParsers={jpeg:{65505:[],65517:[]}},u.parseMetaData=function(e,g,p,b){b=b||{};var m=this,a=(p=p||{}).maxMetaDataSize||262144;!!("undefined"!=typeof DataView&&e&&12<=e.size&&"image/jpeg"===e.type&&u.blobSlice)&&u.readFile(u.blobSlice.call(e,0,a),function(e){if(e.target.error)return console.log(e.target.error),void g(b);var a,t,i,r,o,l,n=e.target.result,s=new DataView(n),c=2,f=s.byteLength-4,d=c;if(65496===s.getUint16(0)){for(;c<f&&(65504<=(a=s.getUint16(c))&&a<=65519||65534===a);){if(c+(t=s.getUint16(c+2)+2)>s.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if((i=u.metaDataParsers.jpeg[a])&&!p.disableMetaDataParsers)for(r=0;r<i.length;r+=1)i[r].call(m,s,c,t,b,p);d=c+=t}!p.disableImageHead&&6<d&&(n.slice?b.imageHead=n.slice(0,d):(o=new Uint8Array(n,0,d),(l=new Uint8Array(d)).set(o),b.imageHead=l.buffer))}else console.log("Invalid JPEG file: Missing JPEG marker.");g(b)},"readAsArrayBuffer")||g(b)},u.replaceHead=function(a,t,i){u.parseMetaData(a,function(e){i(new Blob([t,u.blobSlice.call(a,e.imageHead.byteLength)],{type:"image/jpeg"}))},{maxMetaDataSize:256,disableMetaDataParsers:!0})};var o=u.transform;u.transform=function(a,t,i,r,e){u.requiresMetaData(t)?u.parseMetaData(r,function(e){o.call(u,a,t,i,r,e)},t,e):o.apply(u,arguments)}});