!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(a){"use strict";function m(e){e&&(Object.defineProperty(this,"map",{value:this.privateIFDs[e].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[e]||{}}))}m.prototype.map={Orientation:274,Thumbnail:513,Exif:34665,GPSInfo:34853,Interoperability:40965},m.prototype.privateIFDs={34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},m.prototype.get=function(e){return this[e]||this[this.map[e]]};var x={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,i){return e.getUint16(t,i)},size:2},4:{getValue:function(e,t,i){return e.getUint32(t,i)},size:4},5:{getValue:function(e,t,i){return e.getUint32(t,i)/e.getUint32(t+4,i)},size:8},9:{getValue:function(e,t,i){return e.getInt32(t,i)},size:4},10:{getValue:function(e,t,i){return e.getInt32(t,i)/e.getInt32(t+4,i)},size:8}};function c(e,t,i,n,a,f){var s,o,r,l,g,u,d=x[n];if(d){if(!((o=4<(s=d.size*a)?t+e.getUint32(i+8,f):i+8)+s>e.byteLength)){if(1===a)return d.getValue(e,o,f);for(r=[],l=0;l<a;l+=1)r[l]=d.getValue(e,o+l*d.size,f);if(d.ascii){for(g="",l=0;l<r.length&&"\0"!==(u=r[l]);l+=1)g+=u;return g}return r}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")}function p(e,t,i,n,a,f,s,o){var r,l,g,u,d,x;if(i+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((l=i+2+12*(r=e.getUint16(i,n)))+4>e.byteLength)){for(g=0;g<r;g+=1)u=i+2+12*g,d=e.getUint16(u,n),s&&!s[d]||o&&!0===o[d]||(x=c(e,t,u,e.getUint16(u+2,n),e.getUint32(u+4,n),n),a[d]=x,f&&(f[d]=u));return e.getUint32(l,n)}console.log("Invalid Exif data: Invalid directory size.")}}x[7]=x[1],a.parseExifData=function(l,e,t,g,i){if(!i.disableExif){var u,n,d=i.includeExifTags,x=i.excludeExifTags||{34665:{37500:!0}},c=e+10;if(1165519206===l.getUint32(e+4))if(c+8>l.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===l.getUint16(e+8)){switch(l.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===l.getUint16(c+2,u)?(n=l.getUint32(c+4,u),g.exif=new m,i.disableExifOffsets||(g.exifOffsets=new m,g.exifTiffOffset=c,g.exifLittleEndian=u),(n=p(l,c,c+n,u,g.exif,g.exifOffsets,d,x))&&!i.disableExifThumbnail&&(n=p(l,c,c+n,u,g.exif,g.exifOffsets,d,x),g.exif[513]&&g.exif[514]&&(g.exif[513]=function(e,t,i){if(i&&!(t+i>e.byteLength))return new Blob([e.buffer.slice(t,t+i)],{type:"image/jpeg"});console.log("Invalid Exif data: Invalid thumbnail data.")}(l,c+g.exif[513],g.exif[514]))),Object.keys(g.exif.privateIFDs).forEach(function(e){var t,i,n,a,f,s,o,r;i=e,n=l,a=c,f=u,s=d,o=x,(r=(t=g).exif[i])&&(t.exif[i]=new m(i),t.exifOffsets&&(t.exifOffsets[i]=new m(i)),p(n,a,a+r,f,t.exif[i],t.exifOffsets&&t.exifOffsets[i],s&&s[i],o&&o[i]))})):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},a.metaDataParsers.jpeg[65505].push(a.parseExifData),a.exifWriters={274:function(e,t,i){return new DataView(e,t.exifOffsets[274]+8,2).setUint16(0,i,t.exifLittleEndian),e}},a.writeExifData=function(e,t,i,n){a.exifWriters[t.exif.map[i]](e,t,n)},a.ExifMap=m});