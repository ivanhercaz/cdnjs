!function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],t):"object"==typeof module&&module.exports?t(require("./load-image")):t(window.loadImage)}(function(b){"use strict";var n=b.transform;b.transform=function(t,e,i,o,a){n.call(b,b.scale(t,e,a),e,i,o,a)},b.transformCoordinates=function(){},b.getTransformedOptions=function(t,e){var i,o,a,n,r=e.aspectRatio;if(!r)return e;for(o in i={},e)Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i.crop=!0,r<(a=t.naturalWidth||t.width)/(n=t.naturalHeight||t.height)?(i.maxWidth=n*r,i.maxHeight=n):(i.maxWidth=a,i.maxHeight=a/r),i},b.renderImageToCanvas=function(t,e,i,o,a,n,r,h,d,g,m){var c=t.getContext("2d");return!1===m.imageSmoothingEnabled?c.imageSmoothingEnabled=!1:m.imageSmoothingQuality&&(c.imageSmoothingQuality=m.imageSmoothingQuality),c.drawImage(e,i,o,a,n,r,h,d,g),t},b.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},b.scale=function(t,e,i){e=e||{};var o,a,n,r,h,d,g,m,c,s,u,f=document.createElement("canvas"),l=t.getContext||b.hasCanvasOption(e)&&f.getContext,v=t.naturalWidth||t.width,p=t.naturalHeight||t.height,x=v,w=p;function C(){var t=Math.max((n||x)/x,(r||w)/w);1<t&&(x*=t,w*=t)}function y(){var t=Math.min((o||x)/x,(a||w)/w);t<1&&(x*=t,w*=t)}if(l&&(g=(e=b.getTransformedOptions(t,e,i)).left||0,m=e.top||0,e.sourceWidth?(h=e.sourceWidth,void 0!==e.right&&void 0===e.left&&(g=v-h-e.right)):h=v-g-(e.right||0),e.sourceHeight?(d=e.sourceHeight,void 0!==e.bottom&&void 0===e.top&&(m=p-d-e.bottom)):d=p-m-(e.bottom||0),x=h,w=d),o=e.maxWidth,a=e.maxHeight,n=e.minWidth,r=e.minHeight,l&&o&&a&&e.crop?(u=h/d-(x=o)/(w=a))<0?(d=a*h/o,void 0===e.top&&void 0===e.bottom&&(m=(p-d)/2)):0<u&&(h=o*d/a,void 0===e.left&&void 0===e.right&&(g=(v-h)/2)):((e.contain||e.cover)&&(n=o=o||n,r=a=a||r),e.cover?(y(),C()):(C(),y())),l){if(1<(c=e.pixelRatio)&&(f.style.width=x+"px",f.style.height=w+"px",x*=c,w*=c,f.getContext("2d").scale(c,c)),0<(s=e.downsamplingRatio)&&s<1&&x<h&&w<d)for(;x<h*s;)f.width=h*s,f.height=d*s,b.renderImageToCanvas(f,t,g,m,h,d,0,0,f.width,f.height,e),m=g=0,h=f.width,d=f.height,(t=document.createElement("canvas")).width=h,t.height=d,b.renderImageToCanvas(t,f,0,0,h,d,0,0,h,d,e);return f.width=x,f.height=w,b.transformCoordinates(f,e),b.renderImageToCanvas(f,t,g,m,h,d,0,0,x,w,e)}return t.width=x,t.height=w,t}});