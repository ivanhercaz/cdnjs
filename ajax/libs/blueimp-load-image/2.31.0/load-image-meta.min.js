!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}(function(b){"use strict";var e="undefined"!=typeof Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);b.blobSlice=e&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},b.metaDataParsers={jpeg:{65505:[],65517:[]}},b.parseMetaData=function(e,f,d,g){g=g||{};var p=this,a=(d=d||{}).maxMetaDataSize||262144;!!("undefined"!=typeof DataView&&e&&12<=e.size&&"image/jpeg"===e.type&&b.blobSlice)&&b.readFile(b.blobSlice.call(e,0,a),function(e){if(e.target.error)return console.log(e.target.error),void f(g);var a,t,i,o,r=e.target.result,n=new DataView(r),l=2,s=n.byteLength-4,c=l;if(65496===n.getUint16(0)){for(;l<s&&(65504<=(a=n.getUint16(l))&&a<=65519||65534===a);){if(l+(t=n.getUint16(l+2)+2)>n.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if((i=b.metaDataParsers.jpeg[a])&&!d.disableMetaDataParsers)for(o=0;o<i.length;o+=1)i[o].call(p,n,l,t,g,d);c=l+=t}!d.disableImageHead&&6<c&&(r.slice?g.imageHead=r.slice(0,c):g.imageHead=new Uint8Array(r).subarray(0,c))}else console.log("Invalid JPEG file: Missing JPEG marker.");f(g)},"readAsArrayBuffer")||f(g)},b.replaceHead=function(a,t,i){b.parseMetaData(a,function(e){i(new Blob([t,b.blobSlice.call(a,e.imageHead.byteLength)],{type:"image/jpeg"}))},{maxMetaDataSize:256,disableMetaDataParsers:!0})},b.hasMetaOption=function(e){return e&&e.meta};var r=b.transform;b.transform=function(a,t,i,o,e){b.hasMetaOption(t)?b.parseMetaData(o,function(e){r.call(b,a,t,i,o,e)},t,e):r.apply(b,arguments)}});