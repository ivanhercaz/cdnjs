!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(d){"use strict";d.ExifMap=function(){return this},d.ExifMap.prototype.map={Orientation:274},d.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},d.getExifThumbnail=function(e,i,t){if(t&&!(i+t>e.byteLength))return d.createObjectURL(new Blob([e.buffer.slice(i,i+t)]));console.log("Invalid Exif data: Invalid thumbnail data.")},d.exifTagTypes={1:{getValue:function(e,i){return e.getUint8(i)},size:1},2:{getValue:function(e,i){return String.fromCharCode(e.getUint8(i))},size:1,ascii:!0},3:{getValue:function(e,i,t){return e.getUint16(i,t)},size:2},4:{getValue:function(e,i,t){return e.getUint32(i,t)},size:4},5:{getValue:function(e,i,t){return e.getUint32(i,t)/e.getUint32(i+4,t)},size:8},9:{getValue:function(e,i,t){return e.getInt32(i,t)},size:4},10:{getValue:function(e,i,t){return e.getInt32(i,t)/e.getInt32(i+4,t)},size:8}},d.exifTagTypes[7]=d.exifTagTypes[1],d.getExifValue=function(e,i,t,n,a,f){var s,r,l,o,g,u,x=d.exifTagTypes[n];if(x){if(!((r=4<(s=x.size*a)?i+e.getUint32(t+8,f):t+8)+s>e.byteLength)){if(1===a)return x.getValue(e,r,f);for(l=[],o=0;o<a;o+=1)l[o]=x.getValue(e,r+o*x.size,f);if(x.ascii){for(g="",o=0;o<l.length&&"\0"!==(u=l[o]);o+=1)g+=u;return g}return l}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")},d.parseExifTag=function(e,i,t,n){return{number:e.getUint16(t,n),value:d.getExifValue(e,i,t,e.getUint16(t+2,n),e.getUint32(t+4,n),n)}},d.parseExifTags=function(e,i,t,n,a){var f,s,r,l,o;if(t+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((s=t+2+12*(f=e.getUint16(t,n)))+4>e.byteLength)){for(r=0;r<f;r+=1)l=t+2+12*r,o=this.parseExifTag(e,i,l,n,a),a.exif[o.number]=o.value,a.exifOffsets&&(a.exifOffsets[o.number]=l);return e.getUint32(s,n)}console.log("Invalid Exif data: Invalid directory size.")}},d.parseExifData=function(e,i,t,n,a){if(!a.disableExif){var f,s,r,l=i+10;if(1165519206===e.getUint32(i+4))if(l+8>e.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===e.getUint16(i+8)){switch(e.getUint16(l)){case 18761:f=!0;break;case 19789:f=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===e.getUint16(l+2,f)?(s=e.getUint32(l+4,f),n.exif=new d.ExifMap,a.disableExifOffsets||(n.exifOffsets=new d.ExifMap,n.exifTiffOffset=l,n.exifLittleEndian=f),(s=d.parseExifTags(e,l,l+s,f,n))&&!a.disableExifThumbnail&&(r={exif:{}},s=d.parseExifTags(e,l,l+s,f,r),r.exif[513]&&(n.exif.Thumbnail=d.getExifThumbnail(e,l+r.exif[513],r.exif[514]))),n.exif[34665]&&!a.disableExifSub&&d.parseExifTags(e,l,l+n.exif[34665],f,n),n.exif[34853]&&!a.disableExifGps&&d.parseExifTags(e,l,l+n.exif[34853],f,n)):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},d.metaDataParsers.jpeg[65505].push(d.parseExifData),d.exifWriters={274:function(e,i,t){return new DataView(e,i.exifOffsets[274]+8,2).setUint16(0,t,i.exifLittleEndian),e}},d.writeExifData=function(e,i,t,n){d.exifWriters[i.exif.map[t]](e,i,n)}});