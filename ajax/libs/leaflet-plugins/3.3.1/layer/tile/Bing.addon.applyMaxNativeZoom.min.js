L.BingLayer.mergeOptions({applyMaxNativeZoom:"auto",applyMaxNativeZoom_validityRadius:1e7}),L.BingLayer.addInitHook(function(){var a=this.options;"auto"!==a.applyMaxNativeZoom||a.maxNativeZoom||(a.applyMaxNativeZoom="Road"===a.imagerySet||"Aerial"===a.imagerySet.substring(0,6)),a.applyMaxNativeZoom&&this.on("add",function(){this.applyMaxNativeZoom(this._map.getCenter())})}),L.BingLayer.include({applyMaxNativeZoom:function(n){var m=this.options,a=this._makeApiUrl("Imagery/BasicMetadata",L.Util.template("{imagerySet}/{centerPoint}",{imagerySet:m.imagerySet,centerPoint:L.Util.template("{lat},{lng}",n)})),s=m.zoomOffset||0;return this._findVintage(a,m.maxZoom+s,function(a){if(a&&this._map){var t=this._map.getCenter(),i=this.options.applyMaxNativeZoom_validityRadius;if(t.distanceTo(n)>i)this.applyMaxNativeZoom(t);else{a-=s;var e=m.maxNativeZoom||m.maxZoom;m.maxNativeZoom=a;var o=this._map.getZoom();(a<e&&a<o||e<a&&e<o)&&this._resetView(),this.fire("maxNativeZoomApplied",{latlng:n,value:a,oldValue:e})}}}),this},_findVintage:function(t,i,e,o){this.callRestService(t+"&zoomLevel="+i,function(a){if(a.resourceSets[0].resources[0].vintageStart||0===i)return e.call(o||this,i);this._findVintage(t,i-1,e,o)})}});