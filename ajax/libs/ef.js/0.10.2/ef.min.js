!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ef={})}(this,function(e){"use strict";function o(){throw new SyntaxError("Octal escape sequences are not allowed in EFML.")}function c(e){if(e=e.substr(3,e.length-4),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");try{return String.fromCodePoint(e)}catch(e){throw new SyntaxError("Undefined Unicode code-point")}}function i(e){if(e=e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");return String.fromCharCode(e)}function s(e){if(e="00"+e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid hexadecimal escape sequence");return String.fromCharCode(e)}function q(e){for(var t=[],r=0,n=e.split(b);r<n.length;r+=1){var a=n[r].replace(x,o).replace($,c).replace(w,i).replace(N,s).replace(k,"\b").replace(_,"\t").replace(D,"\n").replace(O,"\v").replace(T,"\f").replace(F,"\r").replace(E,"");t.push(a)}return t.join(y)}function u(e,t){for(var r,n=[],a=!1,o=0,c=e.split(t);o<c.length;o+=1){var i=c[o];a?n[n.length-1]+=""+t+i:n.push(i),a=(r=i)[r.length-1]===y}return n}function B(e,t){for(var r=e.split(b),n=u(r.shift(),t),a=0,o=r;a<o.length;a+=1){var c=o[a],i=u(c,t);n[n.length-1]+=b+i.shift(),n.push.apply(n,i)}return n}function U(e,t){return void 0===t&&(t=-2),"Failed to parse eft template: "+e+". at line "+(t+1)}function p(e){return-1<["number","boolean","string"].indexOf(typeof e)}function l(t){if(!t)return[t,!1];try{var e=JSON.parse(t);return-1===["number","boolean"].indexOf(typeof e)?[q(t),!0]:[e,!1]}catch(e){return[q(t),!0]}}function a(e){e=e.slice(2,e.length-2);var t=B(e,"="),r=t[0],n=t.slice(1),a=B(r.trim(),".").map(q),o=l(n.join("=").trim()),c=o[0],i=o[1];return p(c)&&(i||!i&&""!==c)?[a,c]:[a]}function L(e){var t=e.split(j);if(1===t.length)return l(e)[0];var r=[];2!==t.length||t[0]||t[1]?r.push(t.map(q)):r.push(0);var n=e.match(j);return n&&r.push.apply(r,n.map(a)),r}function f(e,t){t&&e.push(t)}function M(e){var t=L(e);if(p(t))return[""+t];for(var r=t[0],n=t.slice(1),a=[],o=0;o<n.length;o++)f(a,r[o]),a.push(n[o]);return f(a,r[r.length-1]),a}function W(e){return e.replace(/\./g," ")}function K(e){var t=B(e,"=");return{name:q(t.shift().trim()),value:L(t.join("=").trim())}}function Z(e,t,r){var n=parseInt(r,10);if(isNaN(n))return function(e,t){switch(t){case"stop":e.s=1;break;case"stopImmediate":e.i=1;break;case"prevent":e.p=1;break;case"shift":e.h=1;break;case"alt":e.a=1;break;case"ctrl":e.c=1;break;case"meta":e.t=1;break;case"capture":e.u=1;break;default:console.warn("Abandoned unsupported eft event option '"+t+"'.")}}(e,q(r));t.push(n)}function h(e){var t,r,n=e.line,a=e.ast,o=e.parsingInfo,c=e.i;if(n.replace(/\s/,"")){var i,s;i=n,null===(s=o).offset&&(s.offset=i.match(/\s*/)[0],s.offset&&(s.offsetReg=s.offset));var u=function(e,t,r){if(t.offsetReg){var n=!1;if(e=e.replace(t.offsetReg,function(){return n=!0,""}),!n)throw new SyntaxError(U("Expected indent to be grater than 0 and less than "+(t.prevDepth+1)+", but got -1",r))}return e}(n,o,c);!function(e,t){if(!t.indentReg){var r=e.match(G)[2];r&&(t.indentReg=new RegExp(r,"g"))}}(u,o);var p,l,f,h,d,v,g,y,m,b=function(e,t,r){var n=0;t.indentReg&&(e=e.replace(/^\s*/,function(e){return e.replace(t.indentReg,"\t")}));var a=e.replace(/^\t*/,function(e){return n=e.length,""});if(/^\s/.test(a))throw new SyntaxError(U("Bad indent",r));return{depth:n,content:a}}(u,o,c),x=b.depth,$=b.content;if($){if(x<0||1<x-o.prevDepth||x-o.prevDepth==1&&-1===["comment","tag"].indexOf(o.prevType)||"comment"!==o.prevType&&0===x&&o.topExists)throw new SyntaxError(U("Expected indent to be grater than 0 and less than "+(o.prevDepth+1)+", but got "+x,c));var w=$[0];if(!($=$.slice(1))&&0<=">#%@.-+".indexOf(w))throw new SyntaxError(U("Empty content",c));switch((x<o.prevDepth||x===o.prevDepth&&"tag"===o.prevType)&&(o.currentNode=function(e,t){for(var r=e,n=0;n<t;n++)r=r[r.length-1];return r}(a,x)),o.prevDepth=x,w){case">":var N=(v={},g=B($.replace(J,function(e){return v.ref=e.slice(1),""}),"."),y=g[0],m=g.slice(1),v.tag=q(y),v.class=L(m.join(".")),"string"==typeof v.class?v.class=W(v.class).trim():v.class[0]&&(v.class[0]=v.class[0].map(W)),v),E=[{t:N.tag}];N.class&&(E[0].a={},E[0].a.class=N.class),N.ref&&(E[0].r=N.ref),o.currentNode.push(E),o.currentNode=E,o.prevType="tag";break;case"#":var k=K($),_=k.name,D=k.value;o.currentNode[0].a||(o.currentNode[0].a={}),o.currentNode[0].a[_]=D,o.prevType="attr";break;case"%":var O=K($),T=O.name,F=O.value;o.currentNode[0].p||(o.currentNode[0].p={}),o.currentNode[0].p[T]=F,o.prevType="prop";break;case"@":var j={name:(d=B($,"=")).shift().trim(),value:d.join("=").trim()},A=j.name,R=j.value;o.currentNode[0].e||(o.currentNode[0].e=[]);var C=function(e){var t={},r=[],n=B(e,"."),a=n[0],o=n.slice(1);t.l=q(a);for(var c=0,i=o;c<i.length;c+=1){var s=i[c];Z(t,r,s)}return 0<r.length&&(t.k=r),t}(A),P=(p=B(R,":"),l=p[0],f=p.slice(1).join(":"),h=q(l.trim()),f?[h,L(f)]:[h]),S=P[0],I=P[1];C.m=S,I&&(C.v=I),o.currentNode[0].e.push(C),o.prevType="event";break;case".":(t=o.currentNode).push.apply(t,M($)),o.prevType="text";break;case"|":1<o.currentNode.length&&($="\n"+$),(r=o.currentNode).push.apply(r,M($)),o.prevType="multiline-text";break;case"-":if(-1!==V.indexOf($))throw new SyntaxError(U("Reserved name '"+$+"' should not be used",c));o.currentNode.push({n:$,t:0}),o.prevType="node";break;case"+":o.currentNode.push({n:$,t:1}),o.prevType="list";break;default:o.prevType="comment"}}}}function d(e){if(!e)throw new TypeError(U("Template required, but nothing given"));var t=typeof e;if("string"!=t)throw new TypeError(U("Expected a string, but got a(n) "+t));for(var r=e.split(/\r?\n/),n=[{t:0}],a={indentReg:null,prevDepth:0,offset:null,offsetReg:null,prevType:"comment",currentNode:n,topExists:!1},o=0;o<r.length;o++)h({line:r[o],ast:n,parsingInfo:a,i:o});if(n.length<=1)throw new SyntaxError(U("Nothing to be parsed",r.length-1));return 2===n.length&&Array.isArray(n[1])&&Object.hasOwnProperty.call(n[1][0],"t")?n[1]:n}function m(e){return Array.isArray(e)?"array":typeof e}function v(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];for(var n="",a=0;a<t.length;a++)void 0===t[a]?n+=e[a]:n+=e[a]+t[a];return n+e[e.length-1]}function g(e){var t=e.dataNode[e._key];return void 0===t?"":t}var y="&",b=y+y,x=new RegExp("\\&[0-7]{1,3}","g"),$=new RegExp("\\&u\\[.*?\\]","g"),w=new RegExp("\\&u.{0,4}","g"),N=new RegExp("\\&x.{0,2}","g"),E=new RegExp("\\&","g"),k=new RegExp("\\&b","g"),_=new RegExp("\\&t","g"),D=new RegExp("\\&n","g"),O=new RegExp("\\&v","g"),T=new RegExp("\\&f","g"),F=new RegExp("\\&r","g"),V=["$ctx","$refs","$data","$methods","$mount","$umount","$subscribe","$unsubscribe","$update","$dispatch","$emit","$on","$off","$destroy","__DIRECTMOUNT__"],j=/\{\{.+?\}\}/g,G=/^(\t*)( *).*/,J=/#([^}]|}[^}])*$/,n=Array.prototype,A={copy:function(e){return n.slice.call(e,0)},empty:function(e){return e.length=0,e},equals:function(e,t){if(!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0},pop:function(e){return n.pop.call(e)},push:function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];return n.push.apply(e,t)},remove:function(e,t){var r=n.indexOf.call(e,t);if(-1<r)return n.splice.call(e,r,1),t},reverse:function(e){return n.reverse.call(e)},rightUnique:function(e){for(var t=[],r=0;r<e.length;r++){for(var n=r+1;n<e.length;n++)e[r]===e[n]&&(n=r+=1);t.push(e[r])}return t},shift:function(e){return n.shift.call(e)},slice:function(e,t,r){return n.slice.call(e,t,r)},sort:function(e,t){return n.sort.call(e,t)},splice:function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];return n.splice.apply(e,t)},unshift:function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];return n.unshift.apply(e,t)}};window.Set&&Array.from?A.unique=function(e){return Array.from(new Set(e))}:A.unique=A.rightUnique;function R(e){return re.push.apply(re,e)}function C(e){return ne.push(e)}function P(){return oe+=1}function t(){if(0!==ae.length){var e=A.unique(ae);A.empty(ae);for(var t=0,r=e;t<r.length;t+=1){(0,r[t])()}}}function S(e){return!e&&0<--oe||((oe=0)<re.length&&function(){if(0!==re.length){var e=A.unique(re);A.empty(re);for(var t=0,r=e;t<r.length;t+=1){(0,r[t])()}}}(),0<ne.length&&function(){if(0!==ne.length){var e=A.rightUnique(ne);A.empty(ne);for(var t=0,r=e;t<r.length;t+=1){(0,r[t])()}}}(),0<ae.length&&setTimeout(t,0)),oe}function r(e,t){for(var r in t)e[r]=t[r];return e}function I(e,t){var r={};return Object.defineProperty(t,e,{get:function(){return r},set:function(e){P(),ce(r,e),S()},configurable:!1,enumerable:!0}),r}function z(e){var t=e._path,r=e._key,n=e.data,a=e.handlers,o=e.subscribers,c=e.innerData,i=function(e,t){for(var r=0,n=e;r<n.length;r+=1){var a=n[r];t=t[a]?t[a]:I(a,t)}return t}(t,n),s=function(e){for(var t=e._path,r=e.handlers,n=e.subscribers,a=e.innerData,o=0,c=t;o<c.length;o+=1){var i=c[o];r[i]||(r[i]={}),n[i]||(n[i]={}),a[i]||(a[i]={}),r=r[i],n=n[i],a=a[i]}return{handlerNode:r,subscriberNode:n,dataNode:a}}({_path:t,handlers:a,subscribers:o,innerData:c}),u=s.handlerNode,p=s.subscriberNode,l=s.dataNode;return u[r]||(u[r]=[]),p[r]||(p[r]=[]),Object.prototype.hasOwnProperty.call(l,r)||(l[r]=void 0),{parentNode:i,handlerNode:u[r],subscriberNode:p[r],dataNode:l}}function H(e){return e!=e}function Q(e){var t,r,n,a,o,c,i,s,u=e.bind,p=e.ctx,l=e.handlers,f=e.subscribers,h=e.innerData,d=A.copy(u[0]),v=d.pop(),g=z({_path:d,_key:v,data:p.data,handlers:l,subscribers:f,innerData:h}),y=g.parentNode,m=g.handlerNode,b=g.subscriberNode,x=g.dataNode;return Object.prototype.hasOwnProperty.call(y,v)||(r=(t={parentNode:y,dataNode:x,handlerNode:m,subscriberNode:b,ctx:p,_key:v}).parentNode,n=t.dataNode,a=t.handlerNode,o=t.subscriberNode,c=t.ctx,i=t._key,s=!1,Object.defineProperty(r,i,{get:function(){return n[i]},set:function(e){if(!s&&!(n[i]===e||H(n[i])&&H(e))&&(n[i]=e,P(),R(a),S(),0<o.length)){s=!0,P();try{for(var t=0,r=o;t<r.length;t+=1){(0,r[t])({state:c.state,value:e})}}catch(e){te.error("Error caught when executing subscribers:\n",e)}S(),s=!1}},enumerable:!0})),1<u.length&&(y[v]=u[1]),{dataNode:x,parentNode:y,handlerNode:m,subscriberNode:b,_key:v}}function X(e,t){return e.constructor===t}function Y(e,t){for(var r=0,n=t;r<n.length;r+=1){var a=n[r];Object.defineProperty(e.prototype,a,{enumerable:!1})}return e}var ee="[EF] %s",te={log:console.log.bind(console,ee),info:console.info.bind(console,ee),warn:console.warn.bind(console,ee),error:console.error.bind(console,ee)},re=[],ne=[],ae=[],oe=0,ce=Object.assign||r,ie={},se=Node.prototype,ue=new WeakMap,pe={},le=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.appendTo=function(e){var t,r,n;pe.append.apply(null,(t=this,r=e,n=A.copy(t),A.unshift(n,r),n))},t.prototype.remove=function(){for(var e=0;e<this.length;e+=1){var t=this[e];pe.remove(t)}},t}(Array);pe.before=function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];var n=document.createDocumentFragment();P();for(var a=0,o=t;a<o.length;a+=1){var c=o[a];c instanceof ie.EFBaseComponent?c.$mount({target:n}):X(c,le)?c.appendTo(n):se.appendChild.call(n,c)}se.insertBefore.call(e.parentNode,n,e),S()},pe.after=function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];var n=document.createDocumentFragment();P();for(var a=0,o=t;a<o.length;a+=1){var c=o[a];c instanceof ie.EFBaseComponent?c.$mount({target:n}):X(c,le)?c.appendTo(n):se.appendChild.call(n,c)}e.nextSibling?se.insertBefore.call(e.parentNode,n,e.nextSibling):se.appendChild.call(e.parentNode,n),S()};function fe(e,t){var r=e.node;if(r)if(Array.isArray(r)&&r.clear)for(var n=0,a=r;n<a.length;n+=1){var o=a[n].$ctx.nodeInfo,c=o.element,i=o.placeholder;pe.append(t,c,i)}else{var s=r.$ctx.nodeInfo,u=s.element,p=s.placeholder;pe.append(t,u,p)}}pe.append=function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];if(X(e,le))return e.push.apply(e,t);if(e instanceof ie.EFBaseComponent){if(!Array.isArray(e.children)||!e.children.clear)return;P();for(var n=0,a=t;n<a.length;n+=1){var o=a[n];o instanceof Node&&(o=new ie.EFNodeWrapper(o)),e.children.push(o)}S()}else if(-1!==[1,9,11].indexOf(e.nodeType)){for(var c=document.createDocumentFragment(),i=0,s=t;i<s.length;i+=1){var u=s[i];if(X(u,le))u.appendTo(c);else if(u instanceof Node){se.appendChild.call(c,u);var p=ue.get(u);p&&fe(p,c)}else u instanceof ie.EFBaseComponent&&u.$mount({target:c})}se.appendChild.call(e,c)}},pe.remove=function(e){X(e,le)?e.remove():e instanceof ie.EFBaseComponent?e.$umount():se.removeChild.call(e.parentNode,e)};function he(e,t){void 0===t&&(t={bubbles:!1,cancelable:!1});var r=t.bubbles,n=t.cancelable,a=document.createEvent("CustomEvent");return a.initEvent(e,r,n),a}function de(e){return-1<["number","boolean","string"].indexOf(typeof e)}function ve(e){var t,r,n=e.tag,a=e.ref,o=e.refs,c=e.svg,i=e.custom,s=(t=n,r=c,i?new t:r?document.createElementNS("http://www.w3.org/2000/svg",t):"math"===t.toLowerCase()?document.createElementNS("http://www.w3.org/1998/Math/MathML",t):document.createElement(t));return a&&Object.defineProperty(o,a,{value:s,enumerable:!0}),s}function ge(e){var t=e.val,o=e.ctx,c=e.handlers,i=e.subscribers,s=e.innerData,r=e.handler;if(Array.isArray(t)){var n=t[0],a=t.slice(1),u=[n],p=function(){return r(function(e){for(var t=[],r=arguments.length-1;0<r--;)t[r]=arguments[r+1];if(!e)return g(t[0]);var n=[e];return n.push.apply(n,t.map(g)),v.apply(void 0,n)}.apply(void 0,u))};return u.push.apply(u,a.map(function(e){var t=Q({bind:e,ctx:o,handlers:c,subscribers:i,innerData:s}),r=t.dataNode,n=t.handlerNode,a=t._key;return n.push(p),{dataNode:r,_key:a}})),p}return function(){return t}}function ye(e){var t=e.parentNode,r=e.handlerNode,n=e._handler,a=e._key,o=e.value;A.remove(r,n),P(),t[a]=o,S(),A.push(r,n)}function me(e){var t=e.element,r=e.attr,n=e.key,a=e.ctx,o=e.handlers,c=e.subscribers,i=e.innerData,s=e.custom;if(de(r))return s?void(t[n]=r):0===n.indexOf("xlink:")?t.setAttributeNS(Fe,n,r):t.setAttribute(n,r);var u,p,l=(u=t,p=n,s?function(e){u[p]=e}:"class"===p?function(e){if(!(e=(""+e).replace(/\s+/g," ").trim()))return u.removeAttribute(p);u.setAttribute(p,e)}:0===p.indexOf("xlink:")?function(e){if(""===e)return u.removeAttributeNS(Fe,p);u.setAttributeNS(Fe,p,e)}:function(e){if(""===e)return u.removeAttribute(p);u.setAttribute(p,e)});R([ge({val:r,ctx:a,handlers:o,subscribers:c,innerData:i,handler:l})])}function be(e){var t=e.element,r=e.prop,n=e.key,a=e.ctx,o=e.handlers,c=e.subscribers,i=e.innerData,s=e.custom,u=n.split("."),p=u.pop();s&&u.unshift("$data");var l,f,h,d,v,g,y,m,b,x,$,w,N,E,k,_,D=function(e,t){for(var r=0,n=e;r<n.length;r+=1){var a=n[r];t[a]||(t[a]={}),t=t[a]}return t}(u,t);if(de(r))D[p]=r;else{var O=ge({val:r,ctx:a,handlers:o,subscribers:c,innerData:i,handler:function(e){D[p]=e}});"value"!==n&&"checked"!==n||r[0]||(l={_handler:O,ctx:a,handlers:o,subscribers:c,innerData:i,element:t,key:n,expr:r[1],custom:s},f=l._handler,h=l.ctx,d=l.handlers,v=l.subscribers,g=l.innerData,y=l.element,m=l.key,b=l.expr,x=l.custom,$=x?"$on":"addEventListener",w=x?"$dispatch":"dispatchEvent",N=Q({bind:b,ctx:h,handlers:d,subscribers:v,innerData:g}),E=N.parentNode,k=N.handlerNode,_=N._key,"value"===m?(y[$]("input",T,!0),y[$]("keyup",T,!0),y[$]("change",T,!0)):(y[$]("change",function(){if(y[w](he("ef-change-event"),{bubbles:!0,canceoable:!1}),"INPUT"===y.tagName&&"radio"===y.type&&""!==y.name){var e=document.querySelectorAll("input[name="+y.name+"][type=radio]");if(e){var t=A.copy(e);A.remove(t,y);for(var r=0,n=t;r<n.length;r+=1){n[r].dispatchEvent(he("ef-change-event"))}}}},!0),y[$]("ef-change-event",function(){return ye({parentNode:E,handlerNode:k,_handler:f,_key:_,value:y.checked})}))),R([O])}function T(){return ye({parentNode:E,handlerNode:k,_handler:f,_key:_,value:y.value})}}function xe(e){return e}function $e(e){var t=e.element,r=e.event,n=e.ctx,a=e.handlers,o=e.subscribers,c=e.innerData,i=e.custom?"$on":"addEventListener",s=r.l,u=r.m,p=r.s,l=r.i,f=r.p,h=r.h,d=r.a,v=r.c,g=r.t,y=r.u,m=r.k,b=r.v,x=ge({val:b,ctx:n,handlers:a,subscribers:o,innerData:c,handler:xe});t[i](s,function(e){!!h!=!!e.shiftKey||!!d!=!!e.altKey||!!v!=!!e.ctrlKey||!!g!=!!e.metaKey||m&&-1===m.indexOf(e.which)||(p&&e.stopPropagation(),l&&e.stopImmediatePropagation(),f&&e.preventDefault(),n.methods[u]&&n.methods[u]({e:e,value:x(),state:n.state}))},!!y)}function we(e){function t(){var e=p[f];s.textContent=void 0!==e?e:""}var r=e.node,n=e.ctx,a=e.handlers,o=e.subscribers,c=e.innerData,i=e.element,s=document.createTextNode(""),u=Q({bind:r,ctx:n,handlers:a,subscribers:o,innerData:c}),p=u.dataNode,l=u.handlerNode,f=u._key;l.push(t),R([t]),pe.append(i,s)}function Ne(e){var t,r,n=e.ctx,a=e.key,o=e.anchor,c=n.children,i=n.isFragment;c[a]={node:(t=[],r={ctx:n,key:a,anchor:o},Object.defineProperties(t,{empty:{value:je.empty},clear:{value:je.clear},pop:{value:je.pop},push:{value:je.push.bind(t,r)},remove:{value:je.remove},reverse:{value:je.reverse.bind(t,r)},shift:{value:je.shift},sort:{value:je.sort.bind(t,r)},splice:{value:je.splice},unshift:{value:je.unshift.bind(t,r)}}),t),anchor:o},i&&(pe.append(n.safeZone,o),ue.set(o,c[a]))}function Ee(e){var t,r,n,a,o,c,i=e.node,s=e.nodeType,u=e.element,p=e.ctx,l=e.innerData,f=e.refs,h=e.handlers,d=e.subscribers,v=e.svg,g=e.create;switch(s){case"string":pe.append(u,document.createTextNode(i));break;case"array":"object"===m(i[0])?pe.append(u,g({node:i,ctx:p,innerData:l,refs:f,handlers:h,subscribers:d,svg:v})):we({node:i,ctx:p,handlers:h,subscribers:d,innerData:l,element:u});break;case"object":var y=document.createTextNode("");0===i.t?(t={ctx:p,key:i.n,anchor:y},r=t.ctx,n=t.key,a=t.anchor,o=r.children,c=r.isFragment,o[n]={anchor:a},c&&(pe.append(r.safeZone,a),ue.set(a,o[n]))):Ne({ctx:p,key:i.n,anchor:y}),pe.append(u,y)}}function ke(e,t){var r=e.base,n=e.key,a=t.checkTrue,o=t.get,c=t.set;if(o){if(!c)throw new Error("Setter must be defined when getter exists");return o}return a?function(){return a(r(this)[n],this)}:function(){return r(this)[n]}}function _e(e,t){var a=e.base,o=e.key,r=t.checkTrue,c=t.trueVal,i=t.falseVal,n=t.get,s=t.set;if(s){if(!n)throw new Error("Getter must be defined when setter exists");return s}return r?function(e){var t=a(this),r=c,n=i;"function"!=typeof c&&(c=function(){return r}),"function"!=typeof i&&(i=function(){return n}),t[o]=(e?c:i)(this)}:function(e){a(this)[o]=e}}function De(e){return e.$data}function Oe(n){return n?"function"==typeof n?n:("string"==typeof n&&(n=n.split(".")),function(e){for(var t=0,r=n;t<r.length;t+=1){e=e[r[t]]}return e}):De}function Te(e,t){for(var r in t){var n=t[r],a={base:Oe(n.base),key:n.key||r},o=ke(a,n),c=_e(a,n);Object.defineProperty(e.prototype,r,{get:o,set:c,enumerable:!0,configurable:!1})}return e}var Fe="http://www.w3.org/1999/xlink",je={empty:function(){P();for(var e=0,t=A.copy(this);e<t.length;e+=1){t[e].$destroy()}S(),A.empty(this)},clear:function(){P();for(var e=0,t=A.copy(this);e<t.length;e+=1){t[e].$umount()}S(),A.empty(this)},pop:function(){if(0!==this.length){var e=A.pop(this);return e.$umount(),e}},push:function(e){for(var t=e.ctx,r=e.key,n=e.anchor,a=[],o=arguments.length-1;0<o--;)a[o]=arguments[o+1];var c=[];P();for(var i=0,s=a;i<s.length;i+=1){var u=s[i];A.push(c,u.$mount({parent:t.state,key:r}))}return 0===this.length?pe.after.apply(pe,[n].concat(c)):pe.after.apply(pe,[this[this.length-1].$ctx.nodeInfo.placeholder].concat(c)),S(),A.push.apply(A,[this].concat(a))},remove:function(e){if(-1!==this.indexOf(e))return e.$umount(),e},reverse:function(e){var t=e.ctx,r=e.key,n=e.anchor;if(0===this.length)return this;var a=A.copy(this),o=[];P();for(var c=a.length-1;0<=c;c--)a[c].$umount(),A.push(o,a[c].$mount({parent:t.state,key:r}));return A.push.apply(A,[this].concat(A.reverse(a))),pe.after.apply(pe,[n].concat(o)),S(),this},shift:function(){if(0!==this.length){var e=A.shift(this);return e.$umount(),e}},sort:function(e,t){var r=e.ctx,n=e.key,a=e.anchor;if(0===this.length)return this;var o=A.copy(A.sort(this,t)),c=[];P();for(var i=0,s=o;i<s.length;i+=1){var u=s[i];u.$umount(),A.push(c,u.$mount({parent:r.state,key:n}))}return A.push.apply(A,[this].concat(o)),pe.after.apply(pe,[a].concat(c)),S(),this},splice:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(0===this.length)return this;var r=A.splice.apply(A,[A.copy(this)].concat(e));P();for(var n=0,a=r;n<a.length;n+=1){a[n].$umount()}return S(),r},unshift:function(e){for(var t,r=e.ctx,n=e.key,a=e.anchor,o=[],c=arguments.length-1;0<c--;)o[c]=arguments[c+1];if(0===this.length)return(t=this).push.apply(t,o).length;var i=[];P();for(var s=0,u=o;s<u.length;s+=1){var p=u[s];A.push(i,p.$mount({parent:r.state,key:n}))}return pe.after.apply(pe,[a].concat(i)),S(),A.unshift.apply(A,[this].concat(o))}},Ae={BEFORE:"before",AFTER:"after",APPEND:"append",REPLACE:"replace"},Re=Object.create(null),Ce=[function(e){var t=e.ctx,r=e.key,n=e.value,a=t.children[r],o=a.anchor,c=a.node;c!==n&&(n instanceof Node?n=new ie.EFNodeWrapper(n):n instanceof ie.EFBaseComponent||(n=new ie.EFTextFragment(""+n)),P(),c&&(n===Re?n=null:c.$umount()),(a.node=n)&&n.$mount({target:o,parent:t.state,option:Ae.BEFORE,key:r}),S())},function(e){var t=e.ctx,r=e.key,n=e.value,a=t.children[r],o=a.anchor,c=a.node;if(!A.equals(c,n)){n=n?A.copy(n):[];var i=document.createDocumentFragment();if(P(),c){c.clear();for(var s=0,u=n;s<u.length;s+=1){var p=u[s];p instanceof Node?p=new ie.EFNodeWrapper(p):p instanceof ie.EFBaseComponent||(p=new ie.EFTextFragment(""+p)),p.$ctx.nodeInfo.parent&&p.$umount(),pe.append(i,p.$mount({parent:t.state,key:r}))}}else for(var l=0,f=n;l<f.length;l+=1){var h=f[l];pe.append(i,h.$mount({parent:t.state,key:r}))}c.length=0,A.push.apply(A,[c].concat(n)),pe.after(o,i),S()}}],Pe=function(e){var t=e.node,r=e.ctx,n=e.innerData,a=e.refs,o=e.handlers,c=e.subscribers,i=e.svg,s=t[0],u=t.slice(1),p=0===s.t,l=Object.isPrototypeOf.call(ie.EFBaseComponent,r.scope[s.t]||s.t);p||i||"svg"!==s.t.toLowerCase()||(i=!0);var f=function(e){var t=e.info,r=e.ctx,n=e.innerData,a=e.refs,o=e.handlers,c=e.subscribers,i=e.svg,s=e.fragment,u=e.custom;if(s)return new le;var p=t.t,l=t.a,f=t.p,h=t.e,d=t.r,v=r.scope[p]||p,g=ve({tag:v,ref:d,refs:a,svg:i,custom:u});for(var y in l)me({element:g,custom:u,attr:l[y],key:y,ctx:r,handlers:o,subscribers:c,innerData:n});for(var m in f)be({element:g,custom:u,prop:f[m],key:m,ctx:r,handlers:o,subscribers:c,innerData:n});for(var b in h)$e({element:g,custom:u,event:h[b],ctx:r,handlers:o,subscribers:c,innerData:n});return g}({info:s,ctx:r,innerData:n,refs:a,handlers:o,subscribers:c,svg:i,fragment:p,custom:l});i&&"foreignobject"===s.t.toLowerCase()&&(i=!1);for(var h=0,d=u;h<d.length;h+=1){var v=d[h];v instanceof ie.EFBaseComponent?v.$mount({target:f}):Ee({node:v,nodeType:m(v),element:f,ctx:r,innerData:n,refs:a,handlers:o,subscribers:c,svg:i,create:Pe})}return f},Se=function(){function e(e,t){void 0===t&&(t={});var r={},n={},a={},o={},c={placeholder:null,replace:[],parent:null,key:null},i=document.createDocumentFragment();c.placeholder=document.createTextNode("");function s(){if(0<c.replace.length){for(var e=0,t=c.replace;e<t.length;e+=1){var r=t[e];pe.remove(r)}A.empty(c.replace)}pe.before(c.placeholder,c.element)}var u={scope:t,mount:s,refs:r,data:{},innerData:n,methods:{},handlers:a,subscribers:o,nodeInfo:c,safeZone:i,children:{},state:this,isFragment:0===e[0].t};Object.defineProperty(this,"$ctx",{value:u,enumerable:!1,configurable:!0}),P(),c.element=Pe({node:e,ctx:u,innerData:n,refs:r,handlers:a,subscribers:o,svg:!1}),pe.append(i,c.placeholder),C(s),S()}var t={$data:{configurable:!0},$methods:{configurable:!0},$refs:{configurable:!0}};return t.$data.get=function(){return this.$ctx.data},t.$data.set=function(e){P(),ce(this.$ctx.data,e),S()},t.$methods.get=function(){return this.$ctx.methods},t.$methods.set=function(e){this.$ctx.methods=e},t.$refs.get=function(){return this.$ctx.refs},e.prototype.$mount=function(e){var t=e.target,r=e.option,n=e.parent,a=e.key,o=this.$ctx,c=o.nodeInfo,i=o.mount;if("string"==typeof t&&(t=document.querySelector(t)),P(),c.parent&&this.$umount(),n=n||t,a=a||"__DIRECTMOUNT__",c.parent=n,c.key=a,C(i),!t)return S(),c.placeholder;switch(r){case Ae.BEFORE:pe.before(t,c.placeholder);break;case Ae.AFTER:pe.after(t,c.placeholder);break;case Ae.REPLACE:pe.before(t,c.placeholder),c.replace.push(t);break;case Ae.APPEND:default:X(n,le)?pe.append(t,c.element):pe.append(t,c.placeholder)}return S()},e.prototype.$umount=function(){var e=this.$ctx,t=e.nodeInfo,r=e.safeZone,n=e.mount,a=t.parent,o=t.key;return t.parent=null,t.key=null,P(),a&&("__DIRECTMOUNT__"!==o?a[o]&&(Array.isArray(a[o])?A.remove(a[o],this):a[o]=Re):X(a,le)&&A.remove(a.$ctx.nodeInfo.element,t.element)),pe.append(r,t.placeholder),C(n),S()},e.prototype.$subscribe=function(e,t){var r=this.$ctx,n=r.handlers,a=r.subscribers,o=r.innerData,c=e.split("."),i=Q({bind:[c],ctx:r,handlers:n,subscribers:a,innerData:o}),s=i.dataNode,u=i.subscriberNode,p=i._key;P();try{t({state:this,value:s[p]}),u.push(t)}catch(e){te.error("Error caught when registering subscriber:\n",e)}S()},e.prototype.$unsubscribe=function(e,t){var r,n,a=this.$ctx.subscribers;r=t,n=function(e,t){for(var r=e.split("."),n=r.pop(),a=0,o=r;a<o.length;a+=1){var c=o[a];t[c]||(t[c]={}),t=t[c]}return t[n]}(e,a),A.remove(n,r)},e.prototype.$update=function(e){P(),r(this,e),S()},e.prototype.$dispatch=function(e){this.$ctx.nodeInfo.placeholder.dispatchEvent(e)},e.prototype.$emit=function(e,t){this.$dispatch(he(e,t))},e.prototype.$on=function(){for(var e,t=[],r=arguments.length;r--;)t[r]=arguments[r];(e=this.$ctx.nodeInfo.placeholder).addEventListener.apply(e,t)},e.prototype.$off=function(){for(var e,t=[],r=arguments.length;r--;)t[r]=arguments[r];(e=this.$ctx.nodeInfo.placeholder).removeEventListener.apply(e,t)},e.prototype.$destroy=function(){var e=this.$ctx,t=e.nodeInfo,r=e.isFragment,n=e.children;if(P(),this.$umount(),r)for(var a in n)ue.delete(n[a].anchor);for(var o in this)"array"===m(this[o])?this[o].clear():this[o]=null;return delete this.$ctx,C(function(){pe.remove(t.element),pe.remove(t.placeholder)}),S()},Object.defineProperties(e.prototype,t),e}(),Ie=[{t:0}],qe=function(n){function e(){for(var e,t=[],r=arguments.length;r--;)t[r]=arguments[r];n.call(this,Ie),(e=this.$ctx.nodeInfo.element).push.apply(e,t),this.$ctx.elements=t}n&&(e.__proto__=n),(e.prototype=Object.create(n&&n.prototype)).constructor=e;var t={$el:{configurable:!0}};return t.$el.get=function(){return this.$ctx.elements},Object.defineProperties(e.prototype,t),e}(Se),Be=function(r){function e(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];r.call(this,[{t:0}].concat(e))}return r&&(e.__proto__=r),(e.prototype=Object.create(r&&r.prototype)).constructor=e}(Se),Ue=[{t:0},[["text"]]],Le=function(t){function e(e){P(),t.call(this,Ue),this.text=e,S()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e}(Se);Te(Le,{text:{}}),Y(Se,["$mount","$umount","$subscribe","$unsubscribe","$update","$dispatch","$emit","$on","$off","$destroy"]),Y(qe,["$el"]),ie.EFBaseComponent=Se,ie.EFNodeWrapper=qe,ie.EFTextFragment=Le,ie.Fragment=Be;function Me(e){return"string"==typeof e?new Le(e):e}function We(e){var n,t,r=m(e);if("string"===r)e=(Ze||d)(e);else if("array"!==r)throw new TypeError("Cannot create new component without proper template or AST!");return Ke(n=e,t=function(r){function e(e,t){P(),r.call(this,n,t),e&&this.$update(e),S()}return r&&(e.__proto__=r),(e.prototype=Object.create(r&&r.prototype)).constructor=e}(Se)),Object.defineProperty(t.prototype,"constructor",{enumerable:!1}),t}var Ke=function(e,t){var r,n,a,o=m(e);switch(o){case"array":var c=e[0],i=e.slice(1);if("object"===m(c))for(var s=0,u=i;s<u.length;s+=1){var p=u[s];Ke(p,t)}break;case"object":if(1<e.t)throw new TypeError("[EF] Not a standard ef.js AST: Unknown mounting point type '"+e.t+"'");r=e.t,n=e.n,a=t,Object.defineProperty(a.prototype,n,{get:function(){return this.$ctx.children[n].node},set:function(e){var t=this.$ctx;Ce[r]({ctx:t,key:n,value:e})},enumerable:!0});break;case"string":break;default:throw new TypeError("[EF] Not a standard ef.js AST: Unknown node type '"+o+"'")}},Ze=d;e.EFNodeWrapper=qe,e.EFTextFragment=Le,e.Fragment=Be,e.bundle=function(e){P();try{return S(e(P,S))}catch(e){return te.error("Error caught when executing bundle:\n",e),S()}},e.create=We,e.createElement=function(e,t){for(var r=[],n=arguments.length-2;0<n--;)r[n]=arguments[n+2];if(e===Be)return new(Function.prototype.bind.apply(Be,[null].concat(r)));if(Object.isPrototypeOf.call(Se,e))return r.length<=0?new e(t):new e(ce({children:r.map(Me)},t||{}));var a=ce({},t);for(var o in a)!0===a[o]&&(a[o]="");return new Se([{t:e,a:a}].concat(r))},e.exec=S,e.inform=P,e.isPaused=function(){return 0<oe},e.mountOptions=Ae,e.onNextRender=function(e){return ae.push(e)},e.parseEft=d,e.registerProps=Te,e.scoped=function(e,n){return function(r){function e(e,t){void 0===t&&(t=n),r.call(this,e,t)}return r&&(e.__proto__=r),(e.prototype=Object.create(r&&r.prototype)).constructor=e}(e)},e.setParser=function(e){Ze=e},e.t=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return We(v.apply(void 0,e))},e.version="0.10.2",Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ef.min.js.map
