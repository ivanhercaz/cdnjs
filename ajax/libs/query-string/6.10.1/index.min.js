"use strict";const strictUriEncode=require("strict-uri-encode"),decodeComponent=require("decode-uri-component"),splitOnFirst=require("split-on-first");function encoderForArrayFormat(e){switch(e.arrayFormat){case"index":return r=>(t,o)=>{const n=t.length;return void 0===o||e.skipNull&&null===o?t:null===o?[...t,[encode(r,e),"[",n,"]"].join("")]:[...t,[encode(r,e),"[",encode(n,e),"]=",encode(o,e)].join("")]};case"bracket":return r=>(t,o)=>void 0===o||e.skipNull&&null===o?t:null===o?[...t,[encode(r,e),"[]"].join("")]:[...t,[encode(r,e),"[]=",encode(o,e)].join("")];case"comma":return r=>(t,o)=>null==o||0===o.length?t:0===t.length?[[encode(r,e),"=",encode(o,e)].join("")]:[[t,encode(o,e)].join(",")];default:return r=>(t,o)=>void 0===o||e.skipNull&&null===o?t:null===o?[...t,encode(r,e)]:[...t,[encode(r,e),"=",encode(o,e)].join("")]}}function parserForArrayFormat(e){let r;switch(e.arrayFormat){case"index":return(e,t,o)=>{r=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),r?(void 0===o[e]&&(o[e]={}),o[e][r[1]]=t):o[e]=t};case"bracket":return(e,t,o)=>{r=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),r?void 0!==o[e]?o[e]=[].concat(o[e],t):o[e]=[t]:o[e]=t};case"comma":return(e,r,t)=>{const o="string"==typeof r&&r.split("").indexOf(",")>-1?r.split(","):r;t[e]=o};default:return(e,r,t)=>{void 0!==t[e]?t[e]=[].concat(t[e],r):t[e]=r}}}function encode(e,r){return r.encode?r.strict?strictUriEncode(e):encodeURIComponent(e):e}function decode(e,r){return r.decode?decodeComponent(e):e}function keysSorter(e){return Array.isArray(e)?e.sort():"object"==typeof e?keysSorter(Object.keys(e)).sort((e,r)=>Number(e)-Number(r)).map(r=>e[r]):e}function removeHash(e){const r=e.indexOf("#");return-1!==r&&(e=e.slice(0,r)),e}function getHash(e){let r="";const t=e.indexOf("#");return-1!==t&&(r=e.slice(t)),r}function extract(e){const r=(e=removeHash(e)).indexOf("?");return-1===r?"":e.slice(r+1)}function parseValue(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!r.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function parse(e,r){const t=parserForArrayFormat(r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",parseNumbers:!1,parseBooleans:!1},r)),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const n of e.split("&")){let[e,s]=splitOnFirst(r.decode?n.replace(/\+/g," "):n,"=");s=void 0===s?null:decode(s,r),t(decode(e,r),s,o)}for(const e of Object.keys(o)){const t=o[e];if("object"==typeof t&&null!==t)for(const e of Object.keys(t))t[e]=parseValue(t[e],r);else o[e]=parseValue(t,r)}return!1===r.sort?o:(!0===r.sort?Object.keys(o).sort():Object.keys(o).sort(r.sort)).reduce((e,r)=>{const t=o[r];return Boolean(t)&&"object"==typeof t&&!Array.isArray(t)?e[r]=keysSorter(t):e[r]=t,e},Object.create(null))}exports.extract=extract,exports.parse=parse,exports.stringify=((e,r)=>{if(!e)return"";const t=encoderForArrayFormat(r=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},r)),o=Object.assign({},e);if(r.skipNull)for(const e of Object.keys(o))void 0!==o[e]&&null!==o[e]||delete o[e];const n=Object.keys(o);return!1!==r.sort&&n.sort(r.sort),n.map(o=>{const n=e[o];return void 0===n?"":null===n?encode(o,r):Array.isArray(n)?n.reduce(t(o),[]).join("&"):encode(o,r)+"="+encode(n,r)}).filter(e=>e.length>0).join("&")}),exports.parseUrl=((e,r)=>({url:removeHash(e).split("?")[0]||"",query:parse(extract(e),r)})),exports.stringifyUrl=((e,r)=>{const t=removeHash(e.url).split("?")[0]||"",o=exports.extract(e.url),n=exports.parse(o),s=getHash(e.url),c=Object.assign(n,e.query);let i=exports.stringify(c,r);return i&&(i=`?${i}`),`${t}${i}${s}`});