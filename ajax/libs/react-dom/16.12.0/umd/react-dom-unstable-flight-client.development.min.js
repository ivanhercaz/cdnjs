"use strict";!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.ReactFlightDOMClient=r()}(this,function(){var i=!0;var s={stream:!0};var a=0,f=1,c=2;function u(e){var r={},n=d();p(r,"model",n);var t=new Map;t.set(0,n);var o={source:e,partialRow:"",modelRoot:r,chunks:t,fromJSON:function(e,r){return function(e,r,n,t){if("string"!=typeof t||"$"!==t[0])return t;{if("$"===t[1])return t.substring(1);var o=parseInt(t.substring(1),16),u=e.chunks,a=u.get(o);if(a){if(a.status===f)return a.value}else a=d(),u.set(o,a);return void p(r,n,a)}}(o,this,e,r)}};return i&&(o.stringDecoder=new TextDecoder),o}function d(){var r=null,e=new Promise(function(e){return r=e});return{status:a,value:e,resolve:r}}function l(e,r){if(e.status===a){var n=e.resolve,t=e;t.status=c,t.value=r,t.resolve=null,n()}}function v(e,r){e.chunks.forEach(function(e){l(e,r)})}function p(e,r,n){Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:function(){if(n.status===f)return n.value;throw n.value}})}function g(e,r,n){var t=JSON.parse(n,e.fromJSON),o=e.chunks,u=o.get(r);u?function(e,r){if(e.status===a){var n=e.resolve,t=e;t.status=f,t.value=r,t.resolve=null,n()}}(u,t):o.set(r,{status:f,value:t,resolve:null})}function b(e,r){if(""!==r)switch(r[0]){case"J":var n=r.indexOf(":",1);return void g(e,parseInt(r.substring(1,n),16),r.substring(n+1));case"E":var t=r.indexOf(":",1),o=parseInt(r.substring(1,t),16),u=r.substring(t+1),a=JSON.parse(u),i=new Error(a.message);i.stack=a.stack;var s=e.chunks,f=s.get(o);return void(f?l(f,i):s.set(o,{status:c,value:i,resolve:null}));default:return void g(e,0,r)}}function h(e,r){if(!i)throw new Error("This environment don't support binary chunks.");for(var n,t,o,u=e.stringDecoder,a=r.indexOf(10);-1<a;){b(e,e.partialRow+(n=u,t=r.subarray(0,a),n.decode(t))),e.partialRow="",a=(r=r.subarray(a+1)).indexOf(10)}e.partialRow+=(o=r,u.decode(o,s))}function m(e){v(e,new Error("Connection closed."))}function w(e){return e.modelRoot}function n(o,e){var u=e.getReader();function a(e){v(o,e)}u.read().then(function e(r){var n=r.done,t=r.value;if(!n)return h(o,t),u.read().then(e,a);m(o)},a)}var e={readFromXHR:function(n){var t=u(n),o=0;function r(e){var r=n.responseText;!function(e,r,n){for(var t=r.indexOf("\n",n);-1<t;){b(e,e.partialRow+r.substring(n,t)),e.partialRow="",n=t+1,t=r.indexOf("\n",n)}e.partialRow+=r.substring(n)}(t,r,o),o=r.length}function e(e){v(t,new TypeError("Network error"))}return n.addEventListener("progress",r),n.addEventListener("load",function(e){r(),m(t)}),n.addEventListener("error",e),n.addEventListener("abort",e),n.addEventListener("timeout",e),w(t)},readFromFetch:function(e){var r=u(e);return e.then(function(e){n(r,e.body)},function(e){v(r,e)}),w(r)},readFromReadableStream:function(e){var r=u(e);return n(r,e),w(r)}},r=Object.freeze({default:e}),t=r?e:r;return t.default||t});