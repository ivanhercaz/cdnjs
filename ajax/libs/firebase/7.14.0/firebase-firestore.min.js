!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(vp){"use strict";try{(function(){vp=vp&&Object.prototype.hasOwnProperty.call(vp,"default")?vp.default:vp;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(m,f=Error),m);function m(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,g.prototype.create),n}var g=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,T=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},_=N;function S(t){return"string"==typeof t}function D(t){return"number"==typeof t}function k(t,e){t=t.split("."),e=e||_;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function x(){}function R(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function O(t){return"array"==R(t)}function L(t){var e=R(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var U="closure_uid_"+(1e9*Math.random()>>>0),C=0;function V(t,e,n){return t.call.apply(t.bind,arguments)}function M(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:M).apply(null,arguments)}function F(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var j=Date.now||function(){return+new Date};function G(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function B(){this.j=this.j,this.i=this.i}B.prototype.j=!1,B.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[U]||(this[U]=++C))},B.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var z=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},K=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function Y(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var X,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:e<t?1:0}t:{var Z=_.navigator;if(Z){var tt=Z.userAgent;if(tt){X=tt;break t}}X=""}function et(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<rt.length;o++)n=rt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){return ot[" "](t),t}ot[" "]=x;var st,ut,at=J(X,"Opera"),ht=J(X,"Trident")||J(X,"MSIE"),ct=J(X,"Edge"),ft=ct||ht,lt=J(X,"Gecko")&&!(J(X.toLowerCase(),"webkit")&&!J(X,"Edge"))&&!(J(X,"Trident")||J(X,"MSIE"))&&!J(X,"Edge"),pt=J(X.toLowerCase(),"webkit")&&!J(X,"Edge");function dt(){var t=_.document;return t?t.documentMode:void 0}t:{var yt="",vt=(ut=X,lt?/rv:([^\);]+)(\)|;)/.exec(ut):ct?/Edge\/([\d\.]+)/.exec(ut):ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):pt?/WebKit\/(\S+)/.exec(ut):at?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);if(vt&&(yt=vt?vt[1]:""),ht){var mt=dt();if(null!=mt&&mt>parseFloat(yt)){st=String(mt);break t}}st=yt}var gt,wt={};function bt(u){return t=u,e=function(){for(var t=0,e=Q(String(st)).split("."),n=Q(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=$(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||$(0==o[2].length,0==s[2].length)||$(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=wt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var Tt=_.document;gt=Tt&&ht?dt()||("CSS1Compat"==Tt.compatMode?parseInt(st,10):5):void 0;var Et=!ht||9<=Number(gt),It=ht&&!bt("9"),Nt=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{_.addEventListener("test",x,e),_.removeEventListener("test",x,e)}catch(t){}return t}();function At(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function _t(t,e){if(At.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(lt){t:{try{ot(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}At.prototype.b=function(){this.Ia=!1},G(_t,At);var St={2:"touch",3:"pen",4:"mouse"};_t.prototype.b=function(){_t.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Dt="closure_listenable_"+(1e6*Math.random()|0),kt=0;function xt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++kt,this.X=this.Z=!1}function Rt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Ot(t){this.src=t,this.a={},this.b=0}function Lt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=z(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Rt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Ot.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Pt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new xt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ut="closure_lm_"+(1e6*Math.random()|0),Ct={};function Vt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(O(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Kt(r),e&&e[Dt]?e.Aa(n,r,P(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(O(e)){for(var o=0;o<e.length;o++)Vt(t,e[o],n,r,i);return null}return n=Kt(n),t&&t[Dt]?t.za(e,n,P(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!Et)return null;var u,a,h=Bt(t);if(h||(t[Ut]=h=new Ot(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=Gt,r=a=Et?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Nt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ft(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!D(t)&&t&&!t.X){var e=t.src;if(e&&e[Dt])Lt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ft(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(Lt(n,t),0==n.b&&(n.src=null,e[Ut]=null)):Rt(t)}}}function Ft(t){return t in Ct?Ct[t]:Ct[t]="on"+t}function jt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function Gt(t,e){return!!t.X||jt(t,Et?new _t(e,this):e=new _t(e||k("window.event"),this))}function Bt(t){return(t=t[Ut])instanceof Ot?t:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kt(e){return"function"==R(e)?e:(e[zt]||(e[zt]=function(t){return e.handleEvent(t)}),e[zt])}function Wt(){B.call(this),this.c=new Ot(this),(this.J=this).B=null}function Yt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var u=s.listener,a=s.da||s.src;s.Z&&Lt(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&0!=r.Ia}G(Wt,B),Wt.prototype[Dt]=!0,(I=Wt.prototype).addEventListener=function(t,e,n,r){Vt(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(O(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=Kt(r),e&&e[Dt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Pt(s=e.a[n],r,i,o))&&(Rt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Bt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Pt(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new At(t,n);else if(t instanceof At)t.target=t.target||n;else{var i=t;it(t=new At(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Yt(s,r,!0,t)&&i}if(i=Yt(s=t.a=n,r,!0,t)&&i,i=Yt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Yt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(Wt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Rt(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ht=_.JSON.stringify;function Xt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Qt(){this.b=this.a=null}Xt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Jt,$t=new Xt(function(){return new Zt},function(t){t.reset()});function Zt(){this.next=this.b=this.a=null}function te(t){_.setTimeout(function(){throw t},0)}function ee(t,e){var n;Jt||(n=_.Promise.resolve(void 0),Jt=function(){n.then(ie)}),ne||(Jt(),ne=!0),re.add(t,e)}Qt.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ne=!(Zt.prototype.reset=function(){this.next=this.b=this.a=null}),re=new Qt;function ie(){for(var t;r=n=void 0,r=null,(n=re).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){te(t)}var e=$t;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ne=!1}function oe(t,e){Wt.call(this),this.b=t||1,this.a=e||_,this.f=q(this.gb,this),this.g=j()}function se(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ue(t,e,n){if("function"==R(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:_.setTimeout(t,e||0)}function ae(t,e,n){B.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function he(t){t.U=ue(t.b,t.c),t.f.apply(null,t.a)}function ce(t){B.call(this),this.b=t,this.a={}}G(oe,Wt),(I=oe.prototype).ba=!1,I.L=null,I.gb=function(){if(this.ba){var t=j()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(se(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=j())},I.G=function(){oe.N.G.call(this),se(this),delete this.a},G(ae,B),(I=ae.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:he(this)},I.G=function(){ae.N.G.call(this),this.U&&(_.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,he(this))},G(ce,B);var fe=[];function le(t,e,n,r){O(n)||(n&&(fe[0]=n.toString()),n=fe);for(var i=0;i<n.length;i++){var o=Vt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function pe(t){et(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function de(){}ce.prototype.G=function(){ce.N.G.call(this),pe(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ye=new Wt;function ve(t){At.call(this,"serverreachability",t)}function me(){ye.dispatchEvent(new ve(ye))}function ge(t){At.call(this,"statevent",t)}function we(){ye.dispatchEvent(new ge(ye))}function be(t){At.call(this,"timingevent",t)}function Te(t,e){if("function"!=R(t))throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){t()},e)}G(ve,At),G(ge,At),G(be,At);var Ee={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Ie={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Ne(){}function Ae(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Ne.prototype.a=null;var Se,De={OPEN:"a",ib:"b",Ma:"c",rb:"d"};function ke(){At.call(this,"d")}function xe(){At.call(this,"c")}function Re(){}function Oe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new ce(this),this.O=Le,t=ft?125:void 0,this.P=new oe(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}G(ke,At),G(xe,At),G(Re,Ne),Se=new Re;var Le=45e3,Pe={},Ue={};function Ce(t,e,n){t.F=1,t.f=un(Ze(e)),t.l=n,t.H=!0,Me(t,null)}function Ve(t,e,n,r){t.F=1,t.f=un(Ze(e)),t.l=null,t.H=n,Me(t,r)}function Me(t,e){t.v=j(),Fe(t),t.D=Ze(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ae(q(t.Ja,t,t.a),t.J)),le(t.I,t.a,"readystatechange",t.cb),e=t.h?nt(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),me()}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=(s=n,a=u=void 0,u=(o=t).A,-1==(a=s.indexOf("\n",u))?Ue:(u=Number(s.substring(u,a)),isNaN(u)?Pe:(a+=1)+u>s.length?Ue:(s=s.substr(a,u),o.A=a+u,s)));if(i==Ue){4==e&&(t.c=4,we(),r=!1);break}if(i==Pe){t.c=4,we(),r=!1;break}Ke(t,i)}var o,s,u,a;4==e&&0==n.length&&(t.c=1,we(),r=!1),t.b=t.b&&r,r||(ze(t),Be(t))}function Fe(t){t.R=j()+t.O,je(t,t.O)}function je(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Te(q(t.ab,t),e)}function Ge(t){t.i&&(_.clearTimeout(t.i),t.i=null)}function Be(t){t.g.Ca()||t.m||t.g.na(t)}function ze(t){Ge(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,se(t.P),pe(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Ke(t,e){try{t.g.Fa(t,e),me()}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(L(t)||S(t))K(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(L(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(L(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ye(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ye)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t,e){Qe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xe(t))}function Xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=Oe.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Zn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Zn(this.a),n=this.a.ya();this.a.T();if(!(e<3||3==e&&!ft&&!this.a.aa())){this.m||4!=e||7==n||me(),Ge(this);var r=this.a.T();this.o=r;var i=this.a.aa();if(this.b=200==r){if(this.S&&!this.s){e:{if(this.a){var o=tr(this.a,"X-HTTP-Initial-Response");if(o&&!H(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.c=3,we(),ze(this),Be(this);break t}this.s=!0,Ke(this,s)}this.H?(qe(this,e,i),ft&&this.b&&3==e&&(le(this.I,this.P,"tick",this.bb),this.P.start())):Ke(this,i),4==e&&ze(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Fe(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.c=3:this.c=0,we(),ze(this),Be(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Zn(this.a),e=this.a.aa();this.A<e.length&&(Ge(this),qe(this,t,e),this.b&&4!=t&&Fe(this))}},I.cancel=function(){this.m=!0,ze(this)},I.ab=function(){this.i=null;var t=j();0<=t-this.R?(2!=this.F&&(me(),we()),ze(this),this.c=2,Be(this)):je(this,this.R-t)},(I=Ye.prototype).C=function(){Xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Xe(this),this.a.concat()},I.get=function(t,e){return Qe(this.b,t)?this.b[t]:e},I.set=function(t,e){Qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,Tn(t.c)),this.g=t.g):t&&(n=String(t).match(Je))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=an(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=an(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=an(n[7]||"")):(this.h=!!e,this.c=new vn(null,this.h))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?an(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?an(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){var r,i;e instanceof vn?(t.c=e,r=t.c,(i=t.h)&&!r.f&&(mn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},r)),r.f=i):(n||(e=hn(e,dn)),t.c=new vn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){O(n)||(n=[String(n)]),bn(t.c,e,n)}function un(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^j()).toString(36)),t}function an(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,yn)),t.join("")},$e.prototype.resolve=function(t){var e=Ze(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(J(i,"./")||J(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var u=i[s++];"."==u?r&&s==i.length&&o.push(""):".."==u?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(u),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,Tn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,yn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(u){u.a||(u.a=new Ye,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n=t[e].indexOf("="),r=null;if(0<=n){var i=t[e].substring(0,n);r=t[e].substring(n+1)}else i=t[e];o=i,s=r?decodeURIComponent(r.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function gn(t,e){mn(t),e=En(t,e),Qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He(t.a,e))}function wn(t,e){return mn(t),e=En(t,e),Qe(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(En(t,e),Y(n)),t.b+=n.length)}function Tn(t){var e=new vn;return e.c=t.c,t.a&&(e.a=new Ye(t.a),e.b=t.b),e}function En(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function In(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Nn(t){var e=t.a.F.a;if(null!=e)we(),e?(we(),lr(t.a,t,!1)):(we(),lr(t.a,t,!0));else{t.b=new Oe(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),we(),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Ve(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function _n(){this.a=new Ye}function Sn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[U]||(t[U]=++C)):e.charAt(0)+t}function Dn(t,e){this.b=t,this.a=e}function kn(t){this.g=t||xn,t=_.PerformanceNavigationTiming?0<(t=_.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(_.ka&&_.ka.Da&&_.ka.Da()&&_.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new _n),this.b=null,this.c=[]}(I=vn.prototype).add=function(t,e){mn(this),this.c=null,t=En(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){K(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=W(e,this.a.get(En(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=En(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},G(function(){},function(){}),(I=In.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yr(e,2)}else 1==this.M&&(this.g?we():"11111"==e?(we(),this.g=!0,(!ht||10<=Number(gt))&&(this.c=200,this.b.cancel(),we(),lr(this.a,this,!0))):(we(),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Nn(this)):1==this.M&&(this.g?(we(),lr(this.a,this,!0)):(we(),lr(this.a,this,!1)));else{0!=this.M&&1!=this.M||we();var t=this.a;t.m=this.c,yr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},_n.prototype.add=function(t){this.a.set(Sn(t),t)},_n.prototype.C=function(){return this.a.C()};var xn=10;function Rn(t,e){!t.a&&(J(e,"spdy")||J(e,"quic")||J(e,"h2"))&&(t.f=t.g,t.a=new _n,t.b&&(Un(t,t.b),t.b=null))}function On(t){return t.b||t.a&&t.a.a.c>=t.f}function Ln(t){return t.b?1:t.a?t.a.a.c:0}function Pn(t,e){return t.b?t.b==e:!!t.a&&(e=Sn(e),Qe(t.a.a.b,e))}function Un(t,e){t.a?t.a.add(e):t.b=e}function Cn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Sn(e),n=Qe(t.a.a.b,n)),n&&He(t.a.a,Sn(e)))}function Vn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Y(t.c);var e=t.c;return K(t.a.C(),function(t){e=e.concat(t.j)}),e}function Mn(){}function qn(){this.a=new Mn}function Fn(t,r,e){var i=e||"";try{We(t,function(t,e){var n=t;P(t)&&(n=Ht(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}kn.prototype.cancel=function(){var t;this.c=Vn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(K(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},Mn.prototype.stringify=function(t){return _.JSON.stringify(t,void 0)},Mn.prototype.parse=function(t){return _.JSON.parse(t,void 0)};var Gn=_.JSON.parse;function Bn(t){Wt.call(this),this.headers=new Ye,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=zn,this.D=this.F=!1}G(Bn,Wt);var zn="",Kn=/^https?$/i,Wn=["POST","PUT"];function Yn(t){return"content-type"==t.toLowerCase()}function Hn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Xn(t),Jn(t)}function Xn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Qn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=Zn(t)||2!=t.T()))if(t.l&&4==Zn(t))ue(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Je)[1]||null;if(!o&&_.self&&_.self.location){var s=_.self.location.protocol;o=s.substr(0,s.length-1)}i=!Kn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Zn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.T()+"]",Xn(t)}}finally{Jn(t)}}}function Jn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(_.clearTimeout(t.m),t.m=null)}function Zn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;var i;if(i="",et(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var o=""}else o=t.substring(r+1,n);n=(t=[t.substr(0,r),o,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!k("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=k("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=k("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=k("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=k("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new kn(t&&t.concurrentRequestLimit),this.ja=new qn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Ze(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ar(t,n),(e=new Oe(t,e,void 0)).F=2,e.f=un(Ze(n)),n=!1,_.navigator&&_.navigator.sendBeacon&&(n=_.navigator.sendBeacon(e.f.toString(),"")),!n&&_.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=j(),Fe(e)}vr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(_.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(D(t.h)&&_.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new Dn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){On(t.b)||t.h||(t.h=!0,ee(t.Ha,t),t.A=0)}function ur(t,e){var n;n=e?e.W:t.P++;var r=Ze(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ar(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new Oe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Un(t.b,n),Ce(n,r,e)}function ar(t,n){t.c&&We({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Fn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,ee(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=Te(q(t.Ga,t),dr(t,t.v)),t.v++,1)}function lr(t,e,n){var r=e.l;r&&Rn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(_.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function yr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),_.location&&"http"==_.location.protocol||tn(n,"https"),un(n)),function(t,e){var n=new de;if(_.Image){var r=new Image;r.onload=F(jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=F(jn,n,r,"TestLoadImage: error",!1,e),r.onabort=F(jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=F(jn,n,r,"TestLoadImage: timeout",!1,e),_.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else we();t.u=0,t.c&&t.c.ta(e),vr(t),ir(t)}function vr(t){t.u=0,t.m=-1,t.c&&(0==Vn(t.b).length&&0==t.f.length||(t.b.c.length=0,Y(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r,i,o,s,u,a,h=(r=n)instanceof $e?Ze(r):new $e(r,void 0);if(""!=h.b)e&&en(h,e+"."+h.b),nn(h,h.i);else{var c,f=_.location;c=e?e+"."+f.hostname:f.hostname,i=f.protocol,o=c,s=+f.port,u=n,a=new $e(null,void 0),i&&tn(a,i),o&&en(a,o),s&&nn(a,s),u&&(a.a=u),h=a}return t.V&&et(t.V,function(t,e){on(h,e,t)}),e=t.j,n=t.I,e&&n&&on(h,e,n),on(h,"VER",t.wa),ar(t,h),h}function gr(){}function wr(){if(ht&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function br(t,e){Wt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.fb?e.fb:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Ir(this)}function Tr(t){ke.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Er(){xe.call(this),this.status=1}function Ir(t){this.a=t}(I=Bn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ae(this.H):Ae(Se),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Hn(this,t)}t=n||"";var i,o=new Ye(this.headers);r&&We(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Yn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(o.K()),n=_.FormData&&t instanceof _.FormData,0<=z(Wn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=(i=this.a,ht&&bt(9)&&D(i.timeout)&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=ue(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Hn(this,t)}},I.Ba=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Jn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Jn(this,!0)),Bn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Qn(this):this.Za())},I.Za=function(){Qn(this)},I.T=function(){try{return 2<Zn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Gn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Oe(this,t,void 0),r=this.i;if(this.J&&(r?it(r=nt(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ar(this,i),this.g&&r&&er(i,this.g,r),Un(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Ce(n,i,null)):Ce(n,i,e),this.u=2}}else 3==this.u&&(t?ur(this,t):0==this.f.length||On(this.b)||ur(this))},I.Ga=function(){this.l=null,this.a=new Oe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ze(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ar(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ve(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Pn(this.b,t)))if(this.m=t.o,!t.s&&Pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(O(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),we()}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Te(q(this.Ya,this),6e3));if(Ln(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yr(this,11)}else if(!t.s&&this.a!=t||pr(this),!H(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&D(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&Rn(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Cn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ge(r),Fe(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||yr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),we())},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Pn(this.b,t))return;e=t.j,Cn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=j()-t.v,ye.dispatchEvent(new be(ye,t.l&&t.l.length,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){if(!(Ln(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.f=e.j.concat(t.f),1;if(!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa)))return t.h=Te(q(t.Ha,t,e),dr(t,t.A)),t.A++,1}}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:yr(this,5);break;case 4:yr(this,10);break;case 3:yr(this,6);break;default:yr(this,2)}}},I.eb=function(t){we()},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Bn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},G(br,Wt),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;we(),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new In(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),we(),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Nn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new Oe(t,void 0,void 0),t.b.h=t.h,Ve(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Ht(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},G(Tr,ke),G(Er,xe),G(Ir,gr),Ir.prototype.va=function(){this.a.dispatchEvent("a")},Ir.prototype.ua=function(t){this.a.dispatchEvent(new Tr(t))},Ir.prototype.ta=function(t){this.a.dispatchEvent(new Er)},Ir.prototype.sa=function(){this.a.dispatchEvent("b")};var Nr=F(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(_e.EventType=De).OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",Wt.prototype.listen=Wt.prototype.za,Bn.prototype.listenOnce=Bn.prototype.Aa,Bn.prototype.getLastError=Bn.prototype.Xa,Bn.prototype.getLastErrorCode=Bn.prototype.ya,Bn.prototype.getStatus=Bn.prototype.T,Bn.prototype.getResponseJson=Bn.prototype.Ua,Bn.prototype.getResponseText=Bn.prototype.aa,Bn.prototype.send=Bn.prototype.ca;var Ar={createWebChannelTransport:Nr,ErrorCode:Ee,EventType:Ie,WebChannel:_e,XhrIo:Bn},_r=Ar.createWebChannelTransport,Sr=Ar.ErrorCode,Dr=Ar.EventType,kr=Ar.WebChannel,xr=Ar.XhrIo,Rr=vp.SDK_VERSION,Or=(Lr.prototype.t=function(){return null!=this.uid},Lr.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},Lr.prototype.isEqual=function(t){return t.uid===this.uid},Lr);function Lr(t){this.uid=t}function Pr(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}Or.UNAUTHENTICATED=new Or(null),Or.i=new Or("google-credentials-uid"),Or.o=new Or("first-party-uid");var Ur,Cr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Vr=(n(Qr,Ur=Error),Qr),Mr=(Xr.prototype.getToken=function(){return Promise.resolve(null)},Xr.prototype._=function(){},Xr.prototype.l=function(t){(this.u=t)(Or.UNAUTHENTICATED)},Xr.prototype.T=function(){this.u=null},Xr),qr=(Hr.prototype.getToken=function(){var e=this,n=this.R,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.R!==n)throw new Vr(Cr.ABORTED,"getToken aborted due to token change.");return t?(mu("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Pr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Hr.prototype._=function(){this.forceRefresh=!0},Hr.prototype.l=function(t){this.u=t,this.I&&t(this.currentUser)},Hr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.m),this.m=null,this.u=null},Hr.prototype.A=function(){var t=this.auth&&this.auth.getUid();return mu(null===t||"string"==typeof t,"Received invalid UID: "+t),new Or(t)},Hr),Fr=(Object.defineProperty(Yr.prototype,"h",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Yr),jr=(Wr.prototype.getToken=function(){return Promise.resolve(new Fr(this.P,this.V))},Wr.prototype.l=function(t){t(Or.o)},Wr.prototype.T=function(){},Wr.prototype._=function(){},Wr),Gr=(Kr.now=function(){return Kr.fromMillis(Date.now())},Kr.fromDate=function(t){return Kr.fromMillis(t.getTime())},Kr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Kr(e,1e6*(t-1e3*e))},Kr.prototype.toDate=function(){return new Date(this.toMillis())},Kr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Kr.prototype.p=function(t){return this.seconds===t.seconds?bu(this.nanoseconds,t.nanoseconds):bu(this.seconds,t.seconds)},Kr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Kr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Kr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Kr),Br=(zr.v=function(t){return new zr(t)},zr.S=function(){return zr.MIN},zr.prototype.D=function(t){return this.timestamp.p(t.timestamp)},zr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},zr.prototype.C=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},zr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},zr.prototype.k=function(){return this.timestamp},zr);function zr(t){this.timestamp=t}function Kr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Vr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Vr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Vr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Wr(t,e){this.P=t,this.V=e}function Yr(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=Or.o}function Hr(t){var e=this;this.m=null,this.currentUser=Or.UNAUTHENTICATED,this.I=!1,this.R=0,this.u=null,this.forceRefresh=!1,this.m=function(){e.R++,e.currentUser=e.A(),e.I=!0,e.u&&e.u(e.currentUser)},this.R=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.m):(this.m(null),t.get().then(function(t){e.auth=t,e.m&&e.auth.addAuthTokenListener(e.m)},function(){}))}function Xr(){this.u=null}function Qr(t,e){var n=this;return(n=Ur.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Br.MIN=new Br(new Gr(0,0));var Jr,$r=(Object.defineProperty(ei.prototype,"length",{get:function(){return this.N},enumerable:!0,configurable:!0}),ei.prototype.isEqual=function(t){return 0===ei.F(this,t)},ei.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ei?t.forEach(function(t){e.push(t)}):e.push(t),this.$(e)},ei.prototype.limit=function(){return this.offset+this.length},ei.prototype.M=function(t){return t=void 0===t?1:t,this.$(this.segments,this.offset+t,this.length-t)},ei.prototype.L=function(){return this.$(this.segments,this.offset,this.length-1)},ei.prototype.O=function(){return this.segments[this.offset]},ei.prototype.B=function(){return this.get(this.length-1)},ei.prototype.get=function(t){return this.segments[this.offset+t]},ei.prototype.U=function(){return 0===this.length},ei.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ei.prototype.W=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ei.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ei.prototype.j=function(){return this.segments.slice(this.offset,this.limit())},ei.F=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ei),Zr=(n(ti,Jr=$r),ti.prototype.$=function(t,e,n){return new ti(t,e,n)},ti.prototype.K=function(){return this.j().join("/")},ti.prototype.toString=function(){return this.K()},ti.G=function(t){if(0<=t.indexOf("//"))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ti(t.split("/").filter(function(t){return 0<t.length}))},ti);function ti(){return null!==Jr&&Jr.apply(this,arguments)||this}function ei(t,e,n){void 0===e?e=0:e>t.length&&vu("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&vu("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.N=n}Zr.H=new Zr([]);var ni,ri=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ii=(n(oi,ni=$r),oi.prototype.$=function(t,e,n){return new oi(t,e,n)},oi.J=function(t){return ri.test(t)},oi.prototype.K=function(){return this.j().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),oi.J(t)||(t="`"+t+"`"),t}).join(".")},oi.prototype.toString=function(){return this.K()},oi.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},oi.X=function(){return new oi(["__name__"])},oi.Z=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Vr(Cr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Vr(Cr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Vr(Cr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new oi(e)},oi);function oi(){return null!==ni&&ni.apply(this,arguments)||this}ii.H=new ii([]);var si=(ui.tt=function(t){return new ui(Zr.G(t).M(5))},ui.prototype.et=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ui.prototype.isEqual=function(t){return null!==t&&0===Zr.F(this.path,t.path)},ui.prototype.toString=function(){return this.path.toString()},ui.F=function(t,e){return Zr.F(t.path,e.path)},ui.st=function(t){return t.length%2==0},ui.nt=function(t){return new ui(new Zr(t.slice()))},ui);function ui(t){this.path=t}si.EMPTY=new si(new Zr([]));var ai=(pi.prototype.it=function(t,e){return new pi(this.F,this.root.it(t,e,this.F).rt(null,null,ci.ot,null,null))},pi.prototype.remove=function(t){return new pi(this.F,this.root.remove(t,this.F).rt(null,null,ci.ot,null,null))},pi.prototype.get=function(t){for(var e=this.root;!e.U();){var n=this.F(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},pi.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.U();){var r=this.F(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},pi.prototype.U=function(){return this.root.U()},Object.defineProperty(pi.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),pi.prototype.ht=function(){return this.root.ht()},pi.prototype.at=function(){return this.root.at()},pi.prototype.ut=function(t){return this.root.ut(t)},pi.prototype.forEach=function(n){this.ut(function(t,e){return n(t,e),!1})},pi.prototype.toString=function(){var n=[];return this.ut(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},pi.prototype.ct=function(t){return this.root.ct(t)},pi.prototype._t=function(){return new hi(this.root,null,this.F,!1)},pi.prototype.lt=function(t){return new hi(this.root,t,this.F,!1)},pi.prototype.dt=function(){return new hi(this.root,null,this.F,!0)},pi.prototype.ft=function(t){return new hi(this.root,t,this.F,!0)},pi),hi=(li.prototype.Et=function(){var t=this.wt.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.U();)this.wt.push(t),t=t.right;else for(t=t.right;!t.U();)this.wt.push(t),t=t.left;return e},li.prototype.It=function(){return 0<this.wt.length},li.prototype.Rt=function(){if(0===this.wt.length)return null;var t=this.wt[this.wt.length-1];return{key:t.key,value:t.value}},li),ci=(fi.prototype.rt=function(t,e,n,r,i){return new fi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},fi.prototype.U=function(){return!1},fi.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},fi.prototype.ct=function(t){return this.right.ct(t)||t(this.key,this.value)||this.left.ct(t)},fi.prototype.min=function(){return this.left.U()?this:this.left.min()},fi.prototype.ht=function(){return this.min().key},fi.prototype.at=function(){return this.right.U()?this.key:this.right.at()},fi.prototype.it=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.rt(null,null,null,r.left.it(t,e,n),null):0===i?r.rt(null,e,null,null,null):r.rt(null,null,null,null,r.right.it(t,e,n))).At()},fi.prototype.Pt=function(){if(this.left.U())return fi.EMPTY;var t=this;return t.left.Vt()||t.left.left.Vt()||(t=t.gt()),(t=t.rt(null,null,null,t.left.Pt(),null)).At()},fi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.U()||r.left.Vt()||r.left.left.Vt()||(r=r.gt()),r=r.rt(null,null,null,r.left.remove(t,e),null);else{if(r.left.Vt()&&(r=r.pt()),r.right.U()||r.right.Vt()||r.right.left.Vt()||(r=r.yt()),0===e(t,r.key)){if(r.right.U())return fi.EMPTY;n=r.right.min(),r=r.rt(n.key,n.value,null,null,r.right.Pt())}r=r.rt(null,null,null,null,r.right.remove(t,e))}return r.At()},fi.prototype.Vt=function(){return this.color},fi.prototype.At=function(){var t=this;return t.right.Vt()&&!t.left.Vt()&&(t=t.bt()),t.left.Vt()&&t.left.left.Vt()&&(t=t.pt()),t.left.Vt()&&t.right.Vt()&&(t=t.vt()),t},fi.prototype.gt=function(){var t=this.vt();return t.right.left.Vt()&&(t=(t=(t=t.rt(null,null,null,null,t.right.pt())).bt()).vt()),t},fi.prototype.yt=function(){var t=this.vt();return t.left.left.Vt()&&(t=(t=t.pt()).vt()),t},fi.prototype.bt=function(){var t=this.rt(null,null,fi.RED,null,this.right.left);return this.right.rt(null,null,this.color,t,null)},fi.prototype.pt=function(){var t=this.rt(null,null,fi.RED,this.left.right,null);return this.left.rt(null,null,this.color,null,t)},fi.prototype.vt=function(){var t=this.left.rt(null,null,!this.left.color,null,null),e=this.right.rt(null,null,!this.right.color,null,null);return this.rt(null,null,!this.color,t,e)},fi.prototype.St=function(){var t=this.Dt();return Math.pow(2,t)<=this.size+1},fi.prototype.Dt=function(){if(this.Vt()&&this.left.Vt())throw vu("Red node has red child("+this.key+","+this.value+")");if(this.right.Vt())throw vu("Right child of ("+this.key+","+this.value+") is red");var t=this.left.Dt();if(t!==this.right.Dt())throw vu("Black depths differ");return t+(this.Vt()?0:1)},fi);function fi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:fi.RED,this.left=null!=r?r:fi.EMPTY,this.right=null!=i?i:fi.EMPTY,this.size=this.left.size+1+this.right.size}function li(t,e,n,r){this.Tt=r,this.wt=[];for(var i=1;!t.U();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Tt?t.left:t.right;else{if(0===i){this.wt.push(t);break}this.wt.push(t),t=this.Tt?t.right:t.left}}function pi(t,e){this.F=t,this.root=e||ci.EMPTY}function di(){this.size=0}ci.EMPTY=null,ci.RED=!0,ci.ot=!1,ci.EMPTY=(Object.defineProperty(di.prototype,"key",{get:function(){throw vu("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(di.prototype,"value",{get:function(){throw vu("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(di.prototype,"color",{get:function(){throw vu("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(di.prototype,"left",{get:function(){throw vu("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(di.prototype,"right",{get:function(){throw vu("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),di.prototype.rt=function(t,e,n,r,i){return this},di.prototype.it=function(t,e,n){return new ci(t,e)},di.prototype.remove=function(t,e){return this},di.prototype.U=function(){return!0},di.prototype.ut=function(t){return!1},di.prototype.ct=function(t){return!1},di.prototype.ht=function(){return null},di.prototype.at=function(){return null},di.prototype.Vt=function(){return!1},di.prototype.St=function(){return!0},di.prototype.Dt=function(){return 0},new di);var yi=(gi.prototype.has=function(t){return null!==this.data.get(t)},gi.prototype.first=function(){return this.data.ht()},gi.prototype.last=function(){return this.data.at()},Object.defineProperty(gi.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),gi.prototype.indexOf=function(t){return this.data.indexOf(t)},gi.prototype.forEach=function(n){this.data.ut(function(t,e){return n(t),!1})},gi.prototype.Ct=function(t,e){for(var n=this.data.lt(t[0]);n.It();){var r=n.Et();if(0<=this.F(r.key,t[1]))return;e(r.key)}},gi.prototype.kt=function(t,e){var n;for(n=void 0!==e?this.data.lt(e):this.data._t();n.It();)if(!t(n.Et().key))return},gi.prototype.Nt=function(t){var e=this.data.lt(t);return e.It()?e.Et().key:null},gi.prototype._t=function(){return new vi(this.data._t())},gi.prototype.lt=function(t){return new vi(this.data.lt(t))},gi.prototype.add=function(t){return this.rt(this.data.remove(t).it(t,!0))},gi.prototype.delete=function(t){return this.has(t)?this.rt(this.data.remove(t)):this},gi.prototype.U=function(){return this.data.U()},gi.prototype.Ft=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},gi.prototype.isEqual=function(t){if(!(t instanceof gi))return!1;if(this.size!==t.size)return!1;for(var e=this.data._t(),n=t.data._t();e.It();){var r=e.Et().key,i=n.Et().key;if(0!==this.F(r,i))return!1}return!0},gi.prototype.j=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},gi.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},gi.prototype.rt=function(t){var e=new gi(this.F);return e.data=t,e},gi),vi=(mi.prototype.Et=function(){return this.$t.Et().key},mi.prototype.It=function(){return this.$t.It()},mi);function mi(t){this.$t=t}function gi(t){this.F=t,this.data=new ai(this.F)}function wi(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function bi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ti(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ei=(Ii.fromBase64String=function(t){return new Ii(au.Lt().atob(t))},Ii.fromUint8Array=function(t){return new Ii(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Ii.prototype.toBase64=function(){return au.Lt().btoa(this.Mt)},Ii.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.Mt)},Ii.prototype.Ot=function(){return 2*this.Mt.length},Ii.prototype.D=function(t){return bu(this.Mt,t.Mt)},Ii.prototype.isEqual=function(t){return this.Mt===t.Mt},Ii);function Ii(t){this.Mt=t}function Ni(t){return null==t}function Ai(t){return-0===t&&1/t==-1/0}function _i(t){return"number"==typeof t&&Number.isInteger(t)&&!Ai(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function Si(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Di(t){var e=Ci(t.mapValue.fields.__local_write_time__.timestampValue);return new Gr(e.seconds,e.nanos)}Ei.xt=new Ei("");var ki=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Si(t)?4:10:vu("Invalid value type: "+JSON.stringify(t))}function Ri(i,t){var e,n,r,o=xi(i);if(o!==xi(t))return!1;switch(o){case 0:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return Di(i).isEqual(Di(t));case 3:return function(t){if("string"==typeof i.timestampValue&&"string"==typeof t.timestampValue&&i.timestampValue.length===t.timestampValue.length)return i.timestampValue===t.timestampValue;var e=Ci(i.timestampValue),n=Ci(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(t);case 5:return i.stringValue===t.stringValue;case 6:return r=t,Mi(i.bytesValue).isEqual(Mi(r.bytesValue));case 7:return i.referenceValue===t.referenceValue;case 8:return n=t,Vi((e=i).geoPointValue.latitude)===Vi(n.geoPointValue.latitude)&&Vi(e.geoPointValue.longitude)===Vi(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Vi(t.integerValue)===Vi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Vi(t.doubleValue),r=Vi(e.doubleValue);return n===r?Ai(n)===Ai(r):isNaN(n)&&isNaN(r)}return!1}(i,t);case 9:return Tu(i.arrayValue.values||[],t.arrayValue.values||[],Ri);case 10:return function(t){var e=i.mapValue.fields||{},n=t.mapValue.fields||{};if(wi(e)!==wi(n))return!1;for(var r in e)if(e.hasOwnProperty(r)&&(void 0===n[r]||!Ri(e[r],n[r])))return!1;return!0}(t);default:return vu("Unexpected value type: "+JSON.stringify(i))}}function Oi(t,e){return void 0!==(t.values||[]).find(function(t){return Ri(t,e)})}function Li(t,e){var n,r,i,o,s,u,a,h,c,f,l=xi(t),p=xi(e);if(l!==p)return bu(l,p);switch(l){case 0:return 0;case 1:return bu(t.booleanValue,e.booleanValue);case 2:return h=e,(c=Vi(t.integerValue||t.doubleValue))<(f=Vi(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return Pi(t.timestampValue,e.timestampValue);case 4:return Pi(Di(t),Di(e));case 5:return bu(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=Mi(o),a=Mi(s),u.D(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=bu(n[i],r[i]);if(0!==o)return o}return bu(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=bu(Vi(n.latitude),Vi(r.latitude)))?i:bu(Vi(n.longitude),Vi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Li(n[i],r[i]);if(o)return o}return bu(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=bu(r[s],o[s]);if(0!==u)return u;var a=Li(n[r[s]],i[o[s]]);if(0!==a)return a}return bu(r.length,o.length)}(t.mapValue,e.mapValue);default:throw vu("Invalid value type: "+l)}}function Pi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return bu(t,e);var n=Ci(t),r=Ci(e),i=bu(n.seconds,r.seconds);return 0!==i?i:bu(n.nanos,r.nanos)}function Ui(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Ci(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?Mi(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,si.tt(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):vu("Invalid value type: "+JSON.stringify(i));var t,e,n}(t)}function Ci(t){if(mu(!!t,"Cannot normalize null or undefined timestamp."),"string"!=typeof t)return{seconds:Vi(t.seconds),nanos:Vi(t.nanos)};var e=0,n=ki.exec(t);if(mu(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}function Vi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Mi(t){return"string"==typeof t?Ei.fromBase64String(t):Ei.fromUint8Array(t)}function qi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.K()}}function Fi(t){return t&&"integerValue"in t}function ji(t){return!!t&&"arrayValue"in t}function Gi(t){return t&&"nullValue"in t}function Bi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function zi(t){return t&&"mapValue"in t}var Ki=(Wi.prototype.Bt=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},Wi.prototype.Ut=function(t,e){return e},Wi.prototype.qt=function(t){return null},Wi.prototype.isEqual=function(t){return t instanceof Wi},Wi);function Wi(){}Ki.instance=new Ki;var Yi=($i.prototype.Bt=function(t,e){return this.apply(t)},$i.prototype.Ut=function(t,e){return this.apply(t)},$i.prototype.apply=function(t){for(var n=Zi(t),e=function(e){n.some(function(t){return Ri(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},$i.prototype.qt=function(t){return null},$i.prototype.isEqual=function(t){return t instanceof $i&&Tu(this.elements,t.elements,Ri)},$i),Hi=(Ji.prototype.Bt=function(t,e){return this.apply(t)},Ji.prototype.Ut=function(t,e){return this.apply(t)},Ji.prototype.apply=function(t){for(var n=Zi(t),e=function(e){n=n.filter(function(t){return!Ri(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Ji.prototype.qt=function(t){return null},Ji.prototype.isEqual=function(t){return t instanceof Ji&&Tu(this.elements,t.elements,Ri)},Ji),Xi=(Qi.prototype.Bt=function(t,e){var n=this.qt(t),r=this.asNumber(n)+this.asNumber(this.Qt);return Fi(n)&&Fi(this.Qt)?this.serializer.Wt(r):this.serializer.jt(r)},Qi.prototype.Ut=function(t,e){return e},Qi.prototype.qt=function(t){return Fi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},Qi.prototype.isEqual=function(t){return t instanceof Qi&&Ri(this.Qt,t.Qt)},Qi.prototype.asNumber=function(t){return Vi(t.integerValue||t.doubleValue)},Qi);function Qi(t,e){this.serializer=t,this.Qt=e}function Ji(t){this.elements=t}function $i(t){this.elements=t}function Zi(t){return ji(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function to(t,e){this.version=t,this.transformResults=e}var eo=(so.Kt=function(t){return new so(t)},so.Gt=function(t){var e=new yi(ii.F);return t.forEach(function(t){return e=e.add(t)}),new so(e)},so.prototype.zt=function(e){var n=!1;return this.fields.forEach(function(t){t.q(e)&&(n=!0)}),n},so.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},so),no=(oo.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},oo),ro=(io.exists=function(t){return new io(void 0,t)},io.updateTime=function(t){return new io(t)},Object.defineProperty(io.prototype,"Ht",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),io.prototype.Jt=function(t){return void 0!==this.updateTime?t instanceof Oo&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof Oo},io.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},io);function io(t,e){this.updateTime=t,this.exists=e}function oo(t,e){this.field=t,this.transform=e}function so(t){this.fields=t}ro.NONE=new ro;var uo,ao,ho,co,fo,lo=(_o.prototype.Yt=function(t){},_o.Xt=function(t){return t instanceof Oo?t.version:Br.MIN},_o),po=(n(Ao,fo=lo),Ao.prototype.Ut=function(t,e){this.Yt(t);var n=e.version;return new Oo(this.key,n,this.value,{hasCommittedMutations:!0})},Ao.prototype.Bt=function(t,e,n){if(this.Yt(t),!this.Zt.Jt(t))return t;var r=lo.Xt(t);return new Oo(this.key,r,this.value,{te:!0})},Ao.prototype.ee=function(t){return null},Ao.prototype.isEqual=function(t){return t instanceof Ao&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Zt.isEqual(t.Zt)},Ao),yo=(n(No,co=lo),No.prototype.Ut=function(t,e){if(this.Yt(t),!this.Zt.Jt(t))return new Po(this.key,e.version);var n=this.ne(t);return new Oo(this.key,e.version,n,{hasCommittedMutations:!0})},No.prototype.Bt=function(t,e,n){if(this.Yt(t),!this.Zt.Jt(t))return t;var r=lo.Xt(t),i=this.ne(t);return new Oo(this.key,r,i,{te:!0})},No.prototype.ee=function(t){return null},No.prototype.isEqual=function(t){return t instanceof No&&this.key.isEqual(t.key)&&this.se.isEqual(t.se)&&this.Zt.isEqual(t.Zt)},No.prototype.ne=function(t){var e;return e=t instanceof Oo?t.data():wo.EMPTY,this.ie(e)},No.prototype.ie=function(t){var n=this,r=t.re();return this.se.fields.forEach(function(t){if(!t.U()){var e=n.data.field(t);null!==e?r.set(t,e):r.delete(t)}}),r.oe()},No),vo=(n(Io,ho=lo),Io.prototype.Ut=function(t,e){if(this.Yt(t),mu(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.Zt.Jt(t))return new Po(this.key,e.version);var n=this.he(t),r=this.ae(t,e.transformResults),i=e.version,o=this.ue(n.data(),r);return new Oo(this.key,i,o,{hasCommittedMutations:!0})},Io.prototype.Bt=function(t,e,n){if(this.Yt(t),!this.Zt.Jt(t))return t;var r=this.he(t),i=this.ce(n,t,e),o=this.ue(r.data(),i);return new Oo(this.key,r.version,o,{te:!0})},Io.prototype.ee=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Oo?t.field(i.field):void 0,s=i.transform.qt(o||null);null!=s&&(e=null==e?wo._e().set(i.field,s):e.set(i.field,s))}return e?e.oe():null},Io.prototype.isEqual=function(t){return t instanceof Io&&this.key.isEqual(t.key)&&Tu(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Zt.isEqual(t.Zt)},Io.prototype.he=function(t){return t},Io.prototype.ae=function(t,e){var n=[];mu(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Oo&&(s=t.field(i.field)),n.push(o.Ut(s,e[r]))}return n},Io.prototype.ce=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof Oo&&(a=e.field(s.field)),null===a&&n instanceof Oo&&(a=n.field(s.field)),r.push(u.Bt(a,t))}return r},Io.prototype.ue=function(t,e){for(var n=t.re(),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.oe()},Io),mo=(n(Eo,ao=lo),Eo.prototype.Ut=function(t,e){return this.Yt(t),new Lo(this.key,e.version,{hasCommittedMutations:!0})},Eo.prototype.Bt=function(t,e,n){return this.Yt(t),this.Zt.Jt(t)?new Lo(this.key,Br.S()):t},Eo.prototype.ee=function(t){return null},Eo.prototype.isEqual=function(t){return t instanceof Eo&&this.key.isEqual(t.key)&&this.Zt.isEqual(t.Zt)},Eo),go=(n(To,uo=lo),To.prototype.Ut=function(t,e){vu("VerifyMutation should only be used in Transactions.")},To.prototype.Bt=function(t,e,n){vu("VerifyMutation should only be used in Transactions.")},To.prototype.ee=function(t){vu("VerifyMutation should only be used in Transactions.")},To.prototype.isEqual=function(t){return t instanceof To&&this.key.isEqual(t.key)&&this.Zt.isEqual(t.Zt)},To),wo=(bo._e=function(){return bo.EMPTY.re()},bo.prototype.field=function(t){if(t.U())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!zi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.B()])||null},bo.prototype.se=function(){return this.le(this.proto.mapValue)},bo.prototype.le=function(t){var i=this,o=new yi(ii.F);return bi(t.fields||{},function(t,e){var n=new ii([t]);if(10===xi(e)){var r=i.le(e.mapValue).fields;r.U()?o=o.add(n):r.forEach(function(t){o=o.add(n.child(t))})}else o=o.add(n)}),eo.Kt(o)},bo.prototype.isEqual=function(t){return Ri(this.proto,t.proto)},bo.prototype.re=function(){return new xo(this)},bo);function bo(t){this.proto=t}function To(t,e){var n=this;return(n=uo.call(this)||this).key=t,n.Zt=e,n.type=4,n}function Eo(t,e){var n=this;return(n=ao.call(this)||this).key=t,n.Zt=e,n.type=3,n}function Io(t,e){var n=this;return(n=ho.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Zt=ro.exists(!0),n}function No(t,e,n,r){var i=this;return(i=co.call(this)||this).key=t,i.data=e,i.se=n,i.Zt=r,i.type=1,i}function Ao(t,e,n){var r=this;return(r=fo.call(this)||this).key=t,r.value=e,r.Zt=n,r.type=0,r}function _o(){}wo.EMPTY=new wo({mapValue:{}});var So,Do,ko,xo=(Ko.prototype.set=function(t,e){return this.Te(t,e),this},Ko.prototype.delete=function(t){return this.Te(t,null),this},Ko.prototype.Te=function(t,e){for(var n=this.fe,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===xi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.B(),e)},Ko.prototype.oe=function(){var t=this.me(ii.H,this.fe);return null!=t?new wo(t):this.de},Ko.prototype.me=function(r,t){var i=this,o=!1,e=this.de.field(r),s=zi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){if(t instanceof Map){var n=i.me(r.child(e),t);null!=n&&(s[e]=n,o=!0)}else null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Ko),Ro=(zo.we=function(t,e){return si.F(t.key,e.key)},zo),Oo=(n(Bo,ko=Ro),Bo.prototype.field=function(t){return this.Ee.field(t)},Bo.prototype.data=function(){return this.Ee},Bo.prototype.Ie=function(){return this.Ee.proto},Bo.prototype.isEqual=function(t){return t instanceof Bo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.te===t.te&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ee.isEqual(t.Ee)},Bo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ee.toString()+", {hasLocalMutations: "+this.te+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Bo.prototype,"hasPendingWrites",{get:function(){return this.te||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Bo.Re=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Li(r,i):vu("Trying to compare documents on fields that don't exist")},Bo),Lo=(n(Go,Do=Ro),Go.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Go.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Go.prototype.isEqual=function(t){return t instanceof Go&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Go),Po=(n(jo,So=Ro),jo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(jo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),jo.prototype.isEqual=function(t){return t instanceof jo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},jo),Uo=(Fo.prototype.canonicalId=function(){if(null===this.Ae){var t=this.path.K();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),Ni(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Ae=t}return this.Ae},Fo.prototype.toString=function(){var t=this.path.K();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Ni(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Fo.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Fo.prototype.Pe=function(){return si.st(this.path)&&null===this.collectionGroup&&0===this.filters.length},Fo),Co=(qo.ve=function(t){return new qo(t)},Object.defineProperty(qo.prototype,"orderBy",{get:function(){if(null===this.pe){var t=this.Se(),e=this.De();if(null!==t&&null===e)t.Y()?this.pe=[ms]:this.pe=[new vs(t),ms];else{for(var n=!(this.pe=[]),r=0,i=this.Ve;r<i.length;r++){var o=i[r];this.pe.push(o),o.field.Y()&&(n=!0)}if(!n){var s=0<this.Ve.length?this.Ve[this.Ve.length-1].dir:is.ASCENDING;this.pe.push(s===is.ASCENDING?ms:gs)}}}return this.pe},enumerable:!0,configurable:!0}),qo.prototype.Ce=function(t){var e=this.filters.concat([t]);return new qo(this.path,this.collectionGroup,this.Ve.slice(),e,this.limit,this.ge,this.startAt,this.endAt)},qo.prototype.ke=function(t){var e=this.Ve.concat([t]);return new qo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.ge,this.startAt,this.endAt)},qo.prototype.Ne=function(t){return new qo(this.path,this.collectionGroup,this.Ve.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},qo.prototype.Fe=function(t){return new qo(this.path,this.collectionGroup,this.Ve.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},qo.prototype.$e=function(t){return new qo(this.path,this.collectionGroup,this.Ve.slice(),this.filters.slice(),this.limit,this.ge,t,this.endAt)},qo.prototype.Me=function(t){return new qo(this.path,this.collectionGroup,this.Ve.slice(),this.filters.slice(),this.limit,this.ge,this.startAt,t)},qo.prototype.Le=function(t){return new qo(t,null,this.Ve.slice(),this.filters.slice(),this.limit,this.ge,this.startAt,this.endAt)},qo.prototype.Oe=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Ve.length||1===this.Ve.length&&this.Ve[0].field.Y())},qo.prototype.canonicalId=function(){return this.xe().canonicalId()+"|lt:"+this.ge},qo.prototype.toString=function(){return"Query(target="+this.xe().toString()+"; limitType="+this.ge+")"},qo.prototype.isEqual=function(t){return this.xe().isEqual(t.xe())&&this.ge===t.ge},qo.prototype.Be=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},qo.prototype.matches=function(t){return this.Ue(t)&&this.qe(t)&&this.Qe(t)&&this.We(t)},qo.prototype.je=function(){return!Ni(this.limit)&&"F"===this.ge},qo.prototype.Ke=function(){return!Ni(this.limit)&&"L"===this.ge},qo.prototype.De=function(){return 0<this.Ve.length?this.Ve[0].field:null},qo.prototype.Se=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof $o&&n.Ge())return n.field}return null},qo.prototype.ze=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof $o&&0<=t.indexOf(r.op))return r.op}return null},qo.prototype.Pe=function(){return this.xe().Pe()},qo.prototype.He=function(){return null!==this.collectionGroup},qo.prototype.xe=function(){if(!this.ye)if("F"===this.ge)this.ye=new Uo(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===is.DESCENDING?is.ASCENDING:is.DESCENDING;t.push(new vs(r.field,i))}var o=this.endAt?new ys(this.endAt.position,!this.endAt.before):null,s=this.startAt?new ys(this.startAt.position,!this.startAt.before):null;this.ye=new Uo(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.ye},qo.prototype.Ue=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.et(this.collectionGroup)&&this.path.q(e):si.st(this.path)?this.path.isEqual(e):this.path.W(e)},qo.prototype.qe=function(t){for(var e=0,n=this.Ve;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},qo.prototype.Qe=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},qo.prototype.We=function(t){return!(this.startAt&&!this.startAt.Je(this.orderBy,t)||this.endAt&&this.endAt.Je(this.orderBy,t))},qo.prototype.be=function(t){},qo),Vo=(Mo.G=function(t){switch(t){case"<":return Mo.LESS_THAN;case"<=":return Mo.LESS_THAN_OR_EQUAL;case"==":return Mo.EQUAL;case">=":return Mo.GREATER_THAN_OR_EQUAL;case">":return Mo.GREATER_THAN;case"array-contains":return Mo.ARRAY_CONTAINS;case"in":return Mo.IN;case"array-contains-any":return Mo.ARRAY_CONTAINS_ANY;default:return vu("Unknown FieldFilter operator: "+t)}},Mo.prototype.toString=function(){return this.name},Mo.prototype.isEqual=function(t){return this.name===t.name},Mo);function Mo(t){this.name=t}function qo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Ve=n,this.filters=r,this.limit=i,this.ge=o,this.startAt=s,this.endAt=u,this.pe=null,this.ye=null,this.startAt&&this.be(this.startAt),this.endAt&&this.be(this.endAt)}function Fo(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Ae=null}function jo(){return null!==So&&So.apply(this,arguments)||this}function Go(t,e,n){var r=this;return(r=Do.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Bo(t,e,n,r){var i=this;return(i=ko.call(this,t,e)||this).Ee=n,i.te=!!r.te,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function zo(t,e){this.key=t,this.version=e}function Ko(t){this.de=t,this.fe=new Map}Vo.LESS_THAN=new Vo("<"),Vo.LESS_THAN_OR_EQUAL=new Vo("<="),Vo.EQUAL=new Vo("=="),Vo.GREATER_THAN=new Vo(">"),Vo.GREATER_THAN_OR_EQUAL=new Vo(">="),Vo.ARRAY_CONTAINS=new Vo("array-contains"),Vo.IN=new Vo("in"),Vo.ARRAY_CONTAINS_ANY=new Vo("array-contains-any");var Wo,Yo,Ho,Xo,Qo,Jo,$o=(n(fs,Jo=function(){}),fs.create=function(t,e,n){if(t.Y())return e===Vo.IN?new ts(t,n):new Zo(t,e,n);if(Gi(n)){if(e!==Vo.EQUAL)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new fs(t,e,n)}if(Bi(n)){if(e!==Vo.EQUAL)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new fs(t,e,n)}return e===Vo.ARRAY_CONTAINS?new es(t,n):e===Vo.IN?new ns(t,n):e===Vo.ARRAY_CONTAINS_ANY?new rs(t,n):new fs(t,e,n)},fs.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&xi(this.value)===xi(e)&&this.Ye(Li(e,this.value))},fs.prototype.Ye=function(t){switch(this.op){case Vo.LESS_THAN:return t<0;case Vo.LESS_THAN_OR_EQUAL:return t<=0;case Vo.EQUAL:return 0===t;case Vo.GREATER_THAN:return 0<t;case Vo.GREATER_THAN_OR_EQUAL:return 0<=t;default:return vu("Unknown FieldFilter operator: "+this.op)}},fs.prototype.Ge=function(){return 0<=[Vo.LESS_THAN,Vo.LESS_THAN_OR_EQUAL,Vo.GREATER_THAN,Vo.GREATER_THAN_OR_EQUAL].indexOf(this.op)},fs.prototype.canonicalId=function(){return this.field.K()+this.op.toString()+Ui(this.value)},fs.prototype.isEqual=function(t){return t instanceof fs&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&Ri(this.value,t.value)},fs.prototype.toString=function(){return this.field.K()+" "+this.op+" "+Ui(this.value)},fs),Zo=(n(cs,Qo=$o),cs.prototype.matches=function(t){var e=si.F(t.key,this.key);return this.Ye(e)},cs),ts=(n(hs,Xo=$o),hs.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},hs),es=(n(as,Ho=$o),as.prototype.matches=function(t){var e=t.field(this.field);return ji(e)&&Oi(e.arrayValue,this.value)},as),ns=(n(us,Yo=$o),us.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Oi(this.value.arrayValue,e)},us),rs=(n(ss,Wo=$o),ss.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!ji(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Oi(e.value.arrayValue,t)})},ss),is=(os.prototype.toString=function(){return this.name},os);function os(t){this.name=t}function ss(t,e){return Wo.call(this,t,Vo.ARRAY_CONTAINS_ANY,e)||this}function us(t,e){return Yo.call(this,t,Vo.IN,e)||this}function as(t,e){return Ho.call(this,t,Vo.ARRAY_CONTAINS,e)||this}function hs(t,e){var n=this;return(n=Xo.call(this,t,Vo.IN,e)||this).keys=(e.arrayValue.values||[]).map(function(t){return si.tt(t.referenceValue)}),n}function cs(t,e,n){var r=this;return(r=Qo.call(this,t,e,n)||this).key=si.tt(n.referenceValue),r}function fs(t,e,n){var r=this;return(r=Jo.call(this)||this).field=t,r.op=e,r.value=n,r}function ls(t){this.count=t}is.ASCENDING=new is("asc"),is.DESCENDING=new is("desc");var ps,ds,ys=(Es.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(function(t){return Ui(t)}).join(",")},Es.prototype.Je=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(n=i.field.Y()?si.F(si.tt(o.referenceValue),e.key):Li(o,e.field(i.field)),i.dir===is.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Es.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!Ri(this.position[e],t.position[e]))return!1;return!0},Es),vs=(Ts.prototype.compare=function(t,e){var n=this.Xe?Oo.we(t,e):Oo.Re(this.field,t,e);switch(this.dir){case is.ASCENDING:return n;case is.DESCENDING:return-1*n;default:return vu("Unknown direction: "+this.dir)}},Ts.prototype.canonicalId=function(){return this.field.K()+this.dir.toString()},Ts.prototype.toString=function(){return this.field.K()+" ("+this.dir+")"},Ts.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Ts),ms=new vs(ii.X(),is.ASCENDING),gs=new vs(ii.X(),is.DESCENDING),ws=(bs.prototype.es=function(t){return new bs(this.target,this.targetId,this.Ze,t,this.ts,this.lastLimboFreeSnapshotVersion,this.resumeToken)},bs.prototype.ss=function(t,e){return new bs(this.target,this.targetId,this.Ze,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},bs.prototype.ns=function(t){return new bs(this.target,this.targetId,this.Ze,this.sequenceNumber,this.ts,t,this.resumeToken)},bs);function bs(t,e,n,r,i,o,s){void 0===i&&(i=Br.MIN),void 0===o&&(o=Br.MIN),void 0===s&&(s=Ei.xt),this.target=t,this.targetId=e,this.Ze=n,this.sequenceNumber=r,this.ts=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ts(t,e){this.field=t,void 0===e&&(e=is.ASCENDING),this.dir=e,this.Xe=t.Y()}function Es(t,e){this.position=t,this.before=e}function Is(t){switch(t){case Cr.OK:return vu("Treated status OK as error");case Cr.CANCELLED:case Cr.UNKNOWN:case Cr.DEADLINE_EXCEEDED:case Cr.RESOURCE_EXHAUSTED:case Cr.INTERNAL:case Cr.UNAVAILABLE:case Cr.UNAUTHENTICATED:return;case Cr.INVALID_ARGUMENT:case Cr.NOT_FOUND:case Cr.ALREADY_EXISTS:case Cr.PERMISSION_DENIED:case Cr.FAILED_PRECONDITION:case Cr.ABORTED:case Cr.OUT_OF_RANGE:case Cr.UNIMPLEMENTED:case Cr.DATA_LOSS:return 1;default:return vu("Unknown status code: "+t)}}function Ns(t){if(void 0===t)return du("GRPC error has no .code"),Cr.UNKNOWN;switch(t){case ps.OK:return Cr.OK;case ps.CANCELLED:return Cr.CANCELLED;case ps.UNKNOWN:return Cr.UNKNOWN;case ps.DEADLINE_EXCEEDED:return Cr.DEADLINE_EXCEEDED;case ps.RESOURCE_EXHAUSTED:return Cr.RESOURCE_EXHAUSTED;case ps.INTERNAL:return Cr.INTERNAL;case ps.UNAVAILABLE:return Cr.UNAVAILABLE;case ps.UNAUTHENTICATED:return Cr.UNAUTHENTICATED;case ps.INVALID_ARGUMENT:return Cr.INVALID_ARGUMENT;case ps.NOT_FOUND:return Cr.NOT_FOUND;case ps.ALREADY_EXISTS:return Cr.ALREADY_EXISTS;case ps.PERMISSION_DENIED:return Cr.PERMISSION_DENIED;case ps.FAILED_PRECONDITION:return Cr.FAILED_PRECONDITION;case ps.ABORTED:return Cr.ABORTED;case ps.OUT_OF_RANGE:return Cr.OUT_OF_RANGE;case ps.UNIMPLEMENTED:return Cr.UNIMPLEMENTED;case ps.DATA_LOSS:return Cr.DATA_LOSS;default:return vu("Unknown status code: "+t)}}(ds=ps=ps||{})[ds.OK=0]="OK",ds[ds.CANCELLED=1]="CANCELLED",ds[ds.UNKNOWN=2]="UNKNOWN",ds[ds.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ds[ds.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ds[ds.NOT_FOUND=5]="NOT_FOUND",ds[ds.ALREADY_EXISTS=6]="ALREADY_EXISTS",ds[ds.PERMISSION_DENIED=7]="PERMISSION_DENIED",ds[ds.UNAUTHENTICATED=16]="UNAUTHENTICATED",ds[ds.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ds[ds.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ds[ds.ABORTED=10]="ABORTED",ds[ds.OUT_OF_RANGE=11]="OUT_OF_RANGE",ds[ds.UNIMPLEMENTED=12]="UNIMPLEMENTED",ds[ds.INTERNAL=13]="INTERNAL",ds[ds.UNAVAILABLE=14]="UNAVAILABLE",ds[ds.DATA_LOSS=15]="DATA_LOSS";var As=new ai(si.F);function _s(){return As}function Ss(){return _s()}var Ds=new ai(si.F);function ks(){return Ds}var xs=new ai(si.F);function Rs(){return xs}var Os=new yi(si.F);function Ls(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Os,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ps=new yi(bu);function Us(){return Ps}function Cs(t,e,n,r){this.ps=t,this.removedTargetIds=e,this.key=n,this.ys=r}function Vs(t,e){this.targetId=t,this.bs=e}function Ms(t,e,n,r){void 0===n&&(n=Ei.xt),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var qs=($s.hs=function(t){return new $s(t.F)},$s.prototype.has=function(t){return null!=this.rs.get(t)},$s.prototype.get=function(t){return this.rs.get(t)},$s.prototype.first=function(){return this.os.ht()},$s.prototype.last=function(){return this.os.at()},$s.prototype.U=function(){return this.os.U()},$s.prototype.indexOf=function(t){var e=this.rs.get(t);return e?this.os.indexOf(e):-1},Object.defineProperty($s.prototype,"size",{get:function(){return this.os.size},enumerable:!0,configurable:!0}),$s.prototype.forEach=function(n){this.os.ut(function(t,e){return n(t),!1})},$s.prototype.add=function(t){var e=this.delete(t.key);return e.rt(e.rs.it(t.key,t),e.os.it(t,null))},$s.prototype.delete=function(t){var e=this.get(t);return e?this.rt(this.rs.remove(t),this.os.remove(e)):this},$s.prototype.isEqual=function(t){if(!(t instanceof $s))return!1;if(this.size!==t.size)return!1;for(var e=this.os._t(),n=t.os._t();e.It();){var r=e.Et().key,i=n.Et().key;if(!r.isEqual(i))return!1}return!0},$s.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},$s.prototype.rt=function(t,e){var n=new $s;return n.F=this.F,n.rs=t,n.os=e,n},$s),Fs=(Js.prototype.track=function(t){var e=t.doc.key,n=this.as.get(e);!n||0!==t.type&&3===n.type?this.as=this.as.it(e,t):3===t.type&&1!==n.type?this.as=this.as.it(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.as=this.as.it(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.as=this.as.it(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.as=this.as.remove(e):1===t.type&&2===n.type?this.as=this.as.it(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.as=this.as.it(e,{type:2,doc:t.doc}):vu("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n))},Js.prototype.us=function(){var n=[];return this.as.ut(function(t,e){n.push(e)}),n},Js),js=(Qs.fs=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Qs(t,e,qs.hs(e),i,n,r,!0,!1)},Object.defineProperty(Qs.prototype,"hasPendingWrites",{get:function(){return!this._s.U()},enumerable:!0,configurable:!0}),Qs.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.ls===t.ls&&this._s.isEqual(t._s)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.cs.isEqual(t.cs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Qs),Gs=(Xs.Is=function(t,e){var n=new Map;return n.set(t,Bs.Rs(t,e)),new Xs(Br.MIN,n,Us(),_s(),Ls())},Xs),Bs=(Hs.Rs=function(t,e){return new Hs(Ei.xt,e,Ls(),Ls(),Ls())},Hs),zs=(Object.defineProperty(Ys.prototype,"As",{get:function(){return this.Cs},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"resumeToken",{get:function(){return this.Ds},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"Ns",{get:function(){return 0!==this.vs},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"Fs",{get:function(){return this.ks},enumerable:!0,configurable:!0}),Ys.prototype.$s=function(t){0<t.Ot()&&(this.ks=!0,this.Ds=t)},Ys.prototype.Ms=function(){var n=Ls(),r=Ls(),i=Ls();return this.Ss.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:vu("Encountered invalid change type: "+e)}}),new Bs(this.Ds,this.Cs,n,r,i)},Ys.prototype.Ls=function(){this.ks=!1,this.Ss=tu()},Ys.prototype.Os=function(t,e){this.ks=!0,this.Ss=this.Ss.it(t,e)},Ys.prototype.xs=function(t){this.ks=!0,this.Ss=this.Ss.remove(t)},Ys.prototype.Bs=function(){this.vs+=1},Ys.prototype.Us=function(){--this.vs},Ys.prototype.qs=function(){this.ks=!0,this.Cs=!0},Ys),Ks=(Ws.prototype.zs=function(t){for(var e=0,n=t.ps;e<n.length;e++){var r=n[e];t.ys instanceof Oo?this.Hs(r,t.ys):t.ys instanceof Lo&&this.Js(r,t.key,t.ys)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Js(s,t.key,t.ys)}},Ws.prototype.Ys=function(n){var r=this;this.Xs(n,function(t){var e=r.Zs(t);switch(n.state){case 0:r.tn(t)&&e.$s(n.resumeToken);break;case 1:e.Us(),e.Ns||e.Ls(),e.$s(n.resumeToken);break;case 2:e.Us(),e.Ns||r.removeTarget(t);break;case 3:r.tn(t)&&(e.qs(),e.$s(n.resumeToken));break;case 4:r.tn(t)&&(r.en(t),e.$s(n.resumeToken));break;default:vu("Unknown target watch change state: "+n.state)}})},Ws.prototype.Xs=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ws.forEach(function(t,e){r.tn(e)&&n(e)})},Ws.prototype.sn=function(t){var e=t.targetId,n=t.bs.count,r=this.nn(e);if(r){var i=r.target;if(i.Pe())if(0===n){var o=new si(i.path);this.Js(e,o,new Lo(o,Br.S()))}else mu(1===n,"Single document existence filter with count: "+n);else this.in(e)!==n&&(this.en(e),this.Gs=this.Gs.add(e))}},Ws.prototype.rn=function(i){var o=this,s=new Map;this.Ws.forEach(function(t,e){var n=o.nn(e);if(n){if(t.As&&n.target.Pe()){var r=new si(n.target.path);null!==o.js.get(r)||o.on(e,r)||o.Js(e,r,new Lo(r,i))}t.Fs&&(s.set(e,t.Ms()),t.Ls())}});var r=Ls();this.Ks.forEach(function(t,e){var n=!0;e.kt(function(t){var e=o.nn(t);return!e||2===e.Ze||(n=!1)}),n&&(r=r.add(t))});var t=new Gs(i,s,this.Gs,this.js,r);return this.js=_s(),this.Ks=Zs(),this.Gs=new yi(bu),t},Ws.prototype.Hs=function(t,e){if(this.tn(t)){var n=this.on(t,e.key)?2:0;this.Zs(t).Os(e.key,n),this.js=this.js.it(e.key,e),this.Ks=this.Ks.it(e.key,this.hn(e.key).add(t))}},Ws.prototype.Js=function(t,e,n){if(this.tn(t)){var r=this.Zs(t);this.on(t,e)?r.Os(e,1):r.xs(e),this.Ks=this.Ks.it(e,this.hn(e).delete(t)),n&&(this.js=this.js.it(e,n))}},Ws.prototype.removeTarget=function(t){this.Ws.delete(t)},Ws.prototype.in=function(t){var e=this.Zs(t).Ms();return this.Qs.an(t).size+e.Ps.size-e.gs.size},Ws.prototype.Bs=function(t){this.Zs(t).Bs()},Ws.prototype.Zs=function(t){var e=this.Ws.get(t);return e||(e=new zs,this.Ws.set(t,e)),e},Ws.prototype.hn=function(t){var e=this.Ks.get(t);return e||(e=new yi(bu),this.Ks=this.Ks.it(t,e)),e},Ws.prototype.tn=function(t){var e=null!==this.nn(t);return e||pu("WatchChangeAggregator","Detected inactive target",t),e},Ws.prototype.nn=function(t){var e=this.Ws.get(t);return e&&e.Ns?null:this.Qs.un(t)},Ws.prototype.en=function(e){var n=this;this.Ws.set(e,new zs),this.Qs.an(e).forEach(function(t){n.Js(e,t,null)})},Ws.prototype.on=function(t,e){return this.Qs.an(t).has(e)},Ws);function Ws(t){this.Qs=t,this.Ws=new Map,this.js=_s(),this.Ks=Zs(),this.Gs=new yi(bu)}function Ys(){this.vs=0,this.Ss=tu(),this.Ds=Ei.xt,this.Cs=!1,this.ks=!0}function Hs(t,e,n,r,i){this.resumeToken=t,this.As=e,this.Ps=n,this.Vs=r,this.gs=i}function Xs(t,e,n,r,i){this.ts=t,this.Ts=e,this.ms=n,this.ws=r,this.Es=i}function Qs(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.cs=n,this.docChanges=r,this._s=i,this.fromCache=o,this.ls=s,this.ds=u}function Js(){this.as=new ai(si.F)}function $s(n){this.F=n?function(t,e){return n(t,e)||si.F(t.key,e.key)}:function(t,e){return si.F(t.key,e.key)},this.rs=ks(),this.os=new ai(this.F)}function Zs(){return new ai(si.F)}function tu(){return new ai(si.F)}var eu,nu,ru=((nu={})[is.ASCENDING.name]="ASCENDING",nu[is.DESCENDING.name]="DESCENDING",nu),iu=((eu={})[Vo.LESS_THAN.name]="LESS_THAN",eu[Vo.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",eu[Vo.GREATER_THAN.name]="GREATER_THAN",eu[Vo.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",eu[Vo.EQUAL.name]="EQUAL",eu[Vo.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",eu[Vo.IN.name]="IN",eu[Vo.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",eu),ou=(su.prototype._n=function(t){var e=void 0===t.code?Cr.UNKNOWN:Ns(t.code);return new Vr(e,t.message||"")},su.prototype.ln=function(t){return this.options.dn||Ni(t)?t:{value:t}},su.prototype.fn=function(t){var e;return Ni(e="object"==typeof t?t.value:t)?null:e},su.prototype.Wt=function(t){return{integerValue:""+t}},su.prototype.jt=function(t){if(this.options.dn){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ai(t)?"-0":t}},su.prototype.Tn=function(t){return _i(t)?this.Wt(t):this.jt(t)},su.prototype.k=function(t){return this.options.dn?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},su.prototype.v=function(t){var e=Ci(t);return new Gr(e.seconds,e.nanos)},su.prototype.mn=function(t){return this.options.dn?t.toBase64():t.toUint8Array()},su.prototype.wn=function(t){return this.options.dn?(mu(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),Ei.fromBase64String(t||"")):(mu(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),Ei.fromUint8Array(t||new Uint8Array))},su.prototype.toVersion=function(t){return this.k(t.k())},su.prototype.fromVersion=function(t){return mu(!!t,"Trying to deserialize version that isn't set"),Br.v(this.v(t))},su.prototype.En=function(t,e){return this.In(e||this.cn).child("documents").child(t).K()},su.prototype.Rn=function(t){var e=Zr.G(t);return mu(uu(e),"Tried to deserialize invalid key "+e.toString()),e},su.prototype.An=function(t){return this.En(t.path)},su.prototype.tt=function(t){var e=this.Rn(t);return mu(e.get(1)===this.cn.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.cn.projectId),mu(!e.get(3)&&!this.cn.database||e.get(3)===this.cn.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.cn.database),new si(this.Pn(e))},su.prototype.Vn=function(t){return this.En(t)},su.prototype.gn=function(t){var e=this.Rn(t);return 4===e.length?Zr.H:this.Pn(e)},Object.defineProperty(su.prototype,"pn",{get:function(){return new Zr(["projects",this.cn.projectId,"databases",this.cn.database]).K()},enumerable:!0,configurable:!0}),su.prototype.In=function(t){return new Zr(["projects",t.projectId,"databases",t.database])},su.prototype.Pn=function(t){return mu(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.M(5)},su.prototype.yn=function(t,e){return{name:this.An(t),fields:e.proto.mapValue.fields}},su.prototype.bn=function(t){return{name:this.An(t.key),fields:t.Ie().mapValue.fields,updateTime:this.k(t.version.k())}},su.prototype.vn=function(t,e){var n=this.tt(t.name),r=this.fromVersion(t.updateTime),i=new wo({mapValue:{fields:t.fields}});return new Oo(n,r,i,{hasCommittedMutations:!!e})},su.prototype.Sn=function(t){mu(!!t.found,"Tried to deserialize a found document from a missing document."),t.found.name,t.found.updateTime;var e=this.tt(t.found.name),n=this.fromVersion(t.found.updateTime),r=new wo({mapValue:{fields:t.found.fields}});return new Oo(e,n,r,{})},su.prototype.Dn=function(t){mu(!!t.missing,"Tried to deserialize a missing document from a found document."),mu(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.tt(t.missing),n=this.fromVersion(t.readTime);return new Lo(e,n)},su.prototype.Cn=function(t){return"found"in t?this.Sn(t):"missing"in t?this.Dn(t):vu("invalid batch get response: "+JSON.stringify(t))},su.prototype.kn=function(t){var e;if("targetChange"in t){t.targetChange;var n=this.Nn(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=this.wn(t.targetChange.resumeToken),o=t.targetChange.cause;e=new Ms(n,r,i,o&&this._n(o)||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var u=this.tt(s.document.name),a=this.fromVersion(s.document.updateTime),h=new wo({mapValue:{fields:s.document.fields}}),c=new Oo(u,a,h,{});e=new Cs(s.targetIds||[],s.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){t.documentDelete;var f=t.documentDelete;f.document;var l=this.tt(f.document),p=f.readTime?this.fromVersion(f.readTime):Br.S(),d=new Lo(l,p);e=new Cs([],f.removedTargetIds||[],d.key,d)}else if("documentRemove"in t){t.documentRemove;var y=t.documentRemove;y.document;var v=this.tt(y.document);e=new Cs([],y.removedTargetIds||[],v,null)}else{if(!("filter"in t))return vu("Unknown change type "+JSON.stringify(t));t.filter;var m=t.filter;m.targetId;var g=new ls(m.count||0);e=new Vs(m.targetId,g)}return e},su.prototype.Nn=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:vu("Got unexpected TargetChange.state: "+t)},su.prototype.Fn=function(t){if(!("targetChange"in t))return Br.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Br.MIN:this.fromVersion(e.readTime)},su.prototype.$n=function(t){var e,n=this;if(t instanceof po)e={update:this.yn(t.key,t.value)};else if(t instanceof mo)e={delete:this.An(t.key)};else if(t instanceof yo)e={update:this.yn(t.key,t.data),updateMask:this.Mn(t.se)};else if(t instanceof vo)e={transform:{document:this.An(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Ln(t)})}};else{if(!(t instanceof go))return vu("Unknown mutation type "+t.type);e={verify:this.An(t.key)}}return t.Zt.Ht||(e.currentDocument=this.On(t.Zt)),e},su.prototype.xn=function(t){var e=this,n=t.currentDocument?this.Bn(t.currentDocument):ro.NONE;if(t.update){t.update.name;var r=this.tt(t.update.name),i=new wo({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.Un(t.updateMask);return new yo(r,i,o,n)}return new po(r,i,n)}if(t.delete){var s=this.tt(t.delete);return new mo(s,n)}if(t.transform){var u=this.tt(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.qn(t)});return mu(!0===n.exists,'Transforms only support precondition "exists == true"'),new vo(u,a)}if(t.verify){var h=this.tt(t.verify);return new go(h,n)}return vu("unknown mutation proto: "+JSON.stringify(t))},su.prototype.On=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:vu("Unknown precondition")},su.prototype.Bn=function(t){return void 0!==t.updateTime?ro.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ro.exists(t.exists):ro.NONE},su.prototype.Qn=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Br.MIN)&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new to(n,r)},su.prototype.Wn=function(t,e){var n=this;return t&&0<t.length?(mu(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.Qn(t,e)})):[]},su.prototype.Ln=function(t){var e=t.transform;if(e instanceof Ki)return{fieldPath:t.field.K(),setToServerValue:"REQUEST_TIME"};if(e instanceof Yi)return{fieldPath:t.field.K(),appendMissingElements:{values:e.elements}};if(e instanceof Hi)return{fieldPath:t.field.K(),removeAllFromArray:{values:e.elements}};if(e instanceof Xi)return{fieldPath:t.field.K(),increment:e.Qt};throw vu("Unknown transform: "+t.transform)},su.prototype.qn=function(t){var e=null;if("setToServerValue"in t)mu("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),e=Ki.instance;else if("appendMissingElements"in t){var n=t.appendMissingElements.values||[];e=new Yi(n)}else if("removeAllFromArray"in t){var r=t.removeAllFromArray.values||[];e=new Hi(r)}else"increment"in t?e=new Xi(this,t.increment):vu("Unknown transform proto: "+JSON.stringify(t));var i=ii.Z(t.fieldPath);return new no(i,e)},su.prototype.jn=function(t){return{documents:[this.Vn(t.path)]}},su.prototype.Kn=function(t){var e=t.documents.length;mu(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Co.ve(this.gn(n)).xe()},su.prototype.Gn=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Vn(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Vn(n.L()),e.structuredQuery.from=[{collectionId:n.B()}]);var r=this.zn(t.filters);r&&(e.structuredQuery.where=r);var i=this.Hn(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ln(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Jn(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Jn(t.endAt)),e},su.prototype.Yn=function(t){var e=this.gn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){mu(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.Xn(n.where));var u=[];n.orderBy&&(u=this.Zn(n.orderBy));var a=null;n.limit&&(a=this.fn(n.limit));var h=null;n.startAt&&(h=this.ti(n.startAt));var c=null;return n.endAt&&(c=this.ti(n.endAt)),new Co(e,i,u,s,a,"F",h,c).xe()},su.prototype.ei=function(t){var e=this.si(t.Ze);return null==e?null:{"goog-listen-tags":e}},su.prototype.si=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return vu("Unrecognized query purpose: "+t)}},su.prototype.xe=function(t){var e,n=t.target;return(e=n.Pe()?{documents:this.jn(n)}:{query:this.Gn(n)}).targetId=t.targetId,0<t.resumeToken.Ot()&&(e.resumeToken=this.mn(t.resumeToken)),e},su.prototype.zn=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof $o?e.ni(t):vu("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},su.prototype.Xn=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.ii(t)]:void 0!==t.fieldFilter?[this.ri(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.Xn(t)}).reduce(function(t,e){return t.concat(e)}):vu("Unknown filter: "+JSON.stringify(t)):[]},su.prototype.Hn=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.oi(t)})},su.prototype.Zn=function(t){var e=this;return t.map(function(t){return e.hi(t)})},su.prototype.Jn=function(t){return{before:t.before,values:t.position}},su.prototype.ti=function(t){var e=!!t.before,n=t.values||[];return new ys(n,e)},su.prototype.ai=function(t){return ru[t.name]},su.prototype.ui=function(t){switch(t){case"ASCENDING":return is.ASCENDING;case"DESCENDING":return is.DESCENDING;default:return}},su.prototype.ci=function(t){return iu[t.name]},su.prototype._i=function(t){switch(t){case"EQUAL":return Vo.EQUAL;case"GREATER_THAN":return Vo.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Vo.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Vo.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Vo.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Vo.ARRAY_CONTAINS;case"IN":return Vo.IN;case"ARRAY_CONTAINS_ANY":return Vo.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return vu("Unspecified operator");default:return vu("Unknown operator")}},su.prototype.li=function(t){return{fieldPath:t.K()}},su.prototype.di=function(t){return ii.Z(t.fieldPath)},su.prototype.oi=function(t){return{field:this.li(t.field),direction:this.ai(t.dir)}},su.prototype.hi=function(t){return new vs(this.di(t.field),this.ui(t.direction))},su.prototype.ri=function(t){return $o.create(this.di(t.fieldFilter.field),this._i(t.fieldFilter.op),t.fieldFilter.value)},su.prototype.ni=function(t){if(t.op===Vo.EQUAL){if(Bi(t.value))return{unaryFilter:{field:this.li(t.field),op:"IS_NAN"}};if(Gi(t.value))return{unaryFilter:{field:this.li(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.li(t.field),op:this.ci(t.op),value:t.value}}},su.prototype.ii=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.di(t.unaryFilter.field);return $o.create(e,Vo.EQUAL,{doubleValue:NaN});case"IS_NULL":var n=this.di(t.unaryFilter.field);return $o.create(n,Vo.EQUAL,{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return vu("Unspecified filter");default:return vu("Unknown filter")}},su.prototype.Mn=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.K())}),{fieldPaths:e}},su.prototype.Un=function(t){var e=(t.fieldPaths||[]).map(function(t){return ii.Z(t)});return eo.Gt(e)},su);function su(t,e){this.cn=t,this.options=e}function uu(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var au=(cu.fi=function(t){cu.platform&&vu("Platform already defined"),cu.platform=t},cu.Lt=function(){return cu.platform||vu("Platform not set"),cu.platform},cu),hu=new h("@firebase/firestore");function cu(){}function fu(){return hu.logLevel}function lu(t){hu.logLevel=t}function pu(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(hu.logLevel<=l.DEBUG){var r=e.map(yu);hu.debug.apply(hu,i(["Firestore ("+Rr+"): "+t],r))}}function du(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(hu.logLevel<=l.ERROR){var r=e.map(yu);hu.error.apply(hu,i(["Firestore ("+Rr+"): "+t],r))}}function yu(t){if("string"==typeof t)return t;var e=au.Lt();try{return e.Ti(t)}catch(e){return t}}function vu(t){var e="FIRESTORE ("+Rr+") INTERNAL ASSERTION FAILED: "+t;throw du(e),new Error(e)}function mu(t,e){t||vu(e)}var gu=(wu.mi=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},wu);function wu(){}function bu(t,e){return t<e?-1:e<t?1:0}function Tu(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Eu(t){return t+"\0"}function Iu(t,e,n,r,i){this.cn=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Nu=(Object.defineProperty(Hu.prototype,"wi",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Hu.prototype.isEqual=function(t){return t instanceof Hu&&t.projectId===this.projectId&&t.database===this.database},Hu.prototype.D=function(t){return bu(this.projectId,t.projectId)||bu(this.database,t.database)},Hu),Au=(Yu.prototype.get=function(t){var e=this.Ei(t),n=this.Ii[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},Yu.prototype.has=function(t){return void 0!==this.get(t)},Yu.prototype.set=function(t,e){var n=this.Ei(t),r=this.Ii[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Ii[n]=[[t,e]]},Yu.prototype.delete=function(t){var e=this.Ei(t),n=this.Ii[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Ii[e]:n.splice(r,1),!0;return!1},Yu.prototype.forEach=function(u){bi(this.Ii,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},Yu.prototype.U=function(){return Ti(this.Ii)},Yu),_u=(Wu.prototype.Ut=function(t,e,n){for(var r=n.Ai,i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Ut(e,s)}}return e},Wu.prototype.Bt=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.Bt(e,e,this.Ri))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.Bt(e,o,this.Ri))}return e},Wu.prototype.Pi=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Bt(t.key,n.get(t.key));e&&(i=i.it(t.key,e))}),i},Wu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ls())},Wu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Tu(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Tu(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},Wu),Su=(Ku.from=function(t,e,n,r){mu(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=Rs(),o=t.mutations,s=0;s<o.length;s++)i=i.it(o[s].key,n[s].version);return new Ku(t,e,n,r,i)},Ku),Du=(zu.prototype.U=function(){return this.pi.U()},zu.prototype.vi=function(t,e){var n=new ku(t,e);this.pi=this.pi.add(n),this.yi=this.yi.add(n)},zu.prototype.Si=function(t,e){var n=this;t.forEach(function(t){return n.vi(t,e)})},zu.prototype.Di=function(t,e){this.Ci(new ku(t,e))},zu.prototype.ki=function(t,e){var n=this;t.forEach(function(t){return n.Di(t,e)})},zu.prototype.Ni=function(t){var e=this,n=si.EMPTY,r=new ku(n,t),i=new ku(n,t+1),o=[];return this.yi.Ct([r,i],function(t){e.Ci(t),o.push(t.key)}),o},zu.prototype.Fi=function(){var e=this;this.pi.forEach(function(t){return e.Ci(t)})},zu.prototype.Ci=function(t){this.pi=this.pi.delete(t),this.yi=this.yi.delete(t)},zu.prototype.$i=function(t){var e=si.EMPTY,n=new ku(e,t),r=new ku(e,t+1),i=Ls();return this.yi.Ct([n,r],function(t){i=i.add(t.key)}),i},zu.prototype.Mi=function(t){var e=new ku(t,0),n=this.pi.Nt(e);return null!==n&&t.isEqual(n.key)},zu),ku=(Bu.we=function(t,e){return si.F(t.key,e.key)||bu(t.Li,e.Li)},Bu.bi=function(t,e){return bu(t.Li,e.Li)||si.F(t.key,e.key)},Bu),xu=(Gu.prototype.catch=function(t){return this.next(void 0,t)},Gu.prototype.next=function(r,i){var o=this;return this.Ui&&vu("Called next() or catch() twice for PersistencePromise"),this.Ui=!0,this.Bi?this.error?this.qi(i,this.error):this.Qi(r,this.result):new Gu(function(e,n){o.Oi=function(t){o.Qi(r,t).next(e,n)},o.xi=function(t){o.qi(i,t).next(e,n)}})},Gu.prototype.Wi=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Gu.prototype.ji=function(t){try{var e=t();return e instanceof Gu?e:Gu.resolve(e)}catch(t){return Gu.reject(t)}},Gu.prototype.Qi=function(t,e){return t?this.ji(function(){return t(e)}):Gu.resolve(e)},Gu.prototype.qi=function(t,e){return t?this.ji(function(){return t(e)}):Gu.reject(e)},Gu.resolve=function(n){return new Gu(function(t,e){t(n)})},Gu.reject=function(n){return new Gu(function(t,e){e(n)})},Gu.Ki=function(t){return new Gu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Gu.Gi=function(t){for(var n=Gu.resolve(!1),e=function(e){n=n.next(function(t){return t?Gu.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Gu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Ki(i)},Gu),Ru=(Object.defineProperty(ju.prototype,"readTime",{get:function(){return this.Ji},set:function(t){this.Ji=t},enumerable:!0,configurable:!0}),ju.prototype.Yi=function(t,e){this.Xi(),this.readTime=e,this.zi.set(t.key,t)},ju.prototype.Zi=function(t,e){this.Xi(),e&&(this.readTime=e),this.zi.set(t,null)},ju.prototype.tr=function(t,e){this.Xi();var n=this.zi.get(e);return void 0!==n?xu.resolve(n):this.er(t,e)},ju.prototype.getEntries=function(t,e){return this.sr(t,e)},ju.prototype.apply=function(t){return this.Xi(),this.Hi=!0,this.nr(t)},ju.prototype.Xi=function(){},ju),Ou="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lu=(Fu.prototype.rr=function(t){this.ir.push(t)},Fu.prototype.or=function(){this.ir.forEach(function(t){return t()})},Fu),Pu=(qu.prototype.cr=function(e,n){var r=this;return this.ar._r(e,n).next(function(t){return r.lr(e,n,t)})},qu.prototype.lr=function(t,r,i){return this.hr.tr(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Bt(r,t);return t})},qu.prototype.dr=function(t,e,i){var o=Ss();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Bt(t,e);o=o.it(t,e)}),o},qu.prototype.Tr=function(e,t){var n=this;return this.hr.getEntries(e,t).next(function(t){return n.mr(e,t)})},qu.prototype.mr=function(r,i){var o=this;return this.ar.wr(r,i).next(function(t){var e=o.dr(r,i,t),n=_s();return e.forEach(function(t,e){e=e||new Lo(t,Br.S()),n=n.it(t,e)}),n})},qu.prototype.Er=function(t,e,n){return e.Pe()?this.Ir(t,e.path):e.He()?this.Rr(t,e,n):this.Ar(t,e,n)},qu.prototype.Ir=function(t,e){return this.cr(t,new si(e)).next(function(t){var e=ks();return t instanceof Oo&&(e=e.it(t.key,t)),e})},qu.prototype.Rr=function(n,r,i){var o=this,s=r.collectionGroup,u=ks();return this.ur.Pr(n,s).next(function(t){return xu.forEach(t,function(t){var e=r.Le(t.child(s));return o.Ar(n,e,i).next(function(t){t.forEach(function(t,e){u=u.it(t,e)})})}).next(function(){return u})})},qu.prototype.Ar=function(e,n,t){var c,f,r=this;return this.hr.Er(e,n,t).next(function(t){return c=t,r.ar.Vr(e,n)}).next(function(t){return f=t,r.gr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.Bt(a,a,r.Ri);c=h instanceof Oo?c.it(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},qu.prototype.gr=function(t,e,n){for(var r=Ls(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof yo&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.hr.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Oo&&(h=h.it(t,e))}),h})},qu),Uu=(Mu.br=function(t,e){for(var n=Ls(),r=Ls(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Mu(t,e.fromCache,n,r)},Mu),Cu=(Vu.prototype.Sr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Vu.prototype.next=function(){var t=++this.previousValue;return this.Dr&&this.Dr(t),t},Vu);function Vu(t,e){var n=this;this.previousValue=t,e&&(e.vr=function(t){return n.Sr(t)},this.Dr=function(t){return e.Cr(t)})}function Mu(t,e,n,r){this.targetId=t,this.fromCache=e,this.pr=n,this.yr=r}function qu(t,e,n){this.hr=t,this.ar=e,this.ur=n}function Fu(){this.ir=[]}function ju(){this.zi=new Au(function(t){return t.toString()}),this.Hi=!1}function Gu(t){var e=this;this.Oi=null,this.xi=null,this.result=void 0,this.error=void 0,this.Bi=!1,this.Ui=!1,t(function(t){e.Bi=!0,e.result=t,e.Oi&&e.Oi(t)},function(t){e.Bi=!0,e.error=t,e.xi&&e.xi(t)})}function Bu(t,e){this.key=t,this.Li=e}function zu(){this.pi=new yi(ku.we),this.yi=new yi(ku.bi)}function Ku(t,e,n,r,i){this.batch=t,this.Vi=e,this.Ai=n,this.streamToken=r,this.gi=i}function Wu(t,e,n,r){this.batchId=t,this.Ri=e,this.baseMutations=n,this.mutations=r}function Yu(t){this.Ei=t,this.Ii={}}function Hu(t,e){this.projectId=t,this.database=e||"(default)"}function Xu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}Cu.kr=-1;var Qu=(Zu.Or=function(t,e,n,r,i){var o=new Zu(t,e,Date.now()+n,r,i);return o.start(n),o},Zu.prototype.start=function(t){var e=this;this.xr=setTimeout(function(){return e.Br()},t)},Zu.prototype.Ur=function(){return this.Br()},Zu.prototype.cancel=function(t){null!==this.xr&&(this.clearTimeout(),this.Lr.reject(new Vr(Cr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Zu.prototype.Br=function(){var e=this;this.Nr.qr(function(){return null!==e.xr?(e.clearTimeout(),e.op().then(function(t){return e.Lr.resolve(t)})):Promise.resolve()})},Zu.prototype.clearTimeout=function(){null!==this.xr&&(this.Mr(this),clearTimeout(this.xr),this.xr=null)},Zu),Ju=(Object.defineProperty($u.prototype,"Hr",{get:function(){return this.Wr},enumerable:!0,configurable:!0}),$u.prototype.qr=function(t){this.enqueue(t)},$u.prototype.Jr=function(t){this.Yr(),this.Xr(t)},$u.prototype.Zr=function(t){return this.Yr(),this.Xr(t)},$u.prototype.to=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Yr(),this.Wr?[3,2]:(this.Wr=!0,[4,this.Zr(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},$u.prototype.enqueue=function(t){return this.Yr(),this.Wr?new Promise(function(t){}):this.Xr(t)},$u.prototype.Xr=function(t){var e=this,n=this.Qr.then(function(){return e.Gr=!0,t().catch(function(t){throw e.Kr=t,e.Gr=!1,du("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.Gr=!1,t})});return this.Qr=n},$u.prototype.eo=function(t,e,n){var r=this;this.Yr(),-1<this.zr.indexOf(t)&&(e=0);var i=Qu.Or(this,t,e,n,function(t){return r.so(t)});return this.jr.push(i),i},$u.prototype.Yr=function(){this.Kr&&vu("AsyncQueue is already failed: "+(this.Kr.stack||this.Kr.message))},$u.prototype.no=function(){},$u.prototype.io=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Qr];case 1:t.sent(),t.label=2;case 2:if(e!==this.Qr)return[3,0];t.label=3;case 3:return[2]}})})},$u.prototype.ro=function(t){for(var e=0,n=this.jr;e<n.length;e++)if(n[e].Fr===t)return!0;return!1},$u.prototype.oo=function(r){var i=this;return this.io().then(function(){i.jr.sort(function(t,e){return t.$r-e.$r});for(var t=0,e=i.jr;t<e.length;t++){var n=e[t];if(n.Ur(),"all"!==r&&n.Fr===r)break}return i.io()})},$u.prototype.ho=function(t){this.zr.push(t)},$u.prototype.so=function(t){var e=this.jr.indexOf(t);this.jr.splice(e,1)},$u);function $u(){this.Qr=Promise.resolve(),this.Wr=!1,this.jr=[],this.Kr=null,this.Gr=!1,this.zr=[]}function Zu(t,e,n,r,i){this.Nr=t,this.Fr=e,this.$r=n,this.op=r,this.Mr=i,this.Lr=new Xu,this.then=this.Lr.promise.then.bind(this.Lr.promise),this.catch=this.Lr.promise.catch.bind(this.Lr.promise),this.Lr.promise.catch(function(t){})}function ta(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=bu(n,i);return 0===s?bu(r,o):s}var ea=(oa.prototype.co=function(){return++this.uo},oa.prototype._o=function(t){var e=[t,this.co()];if(this.buffer.size<this.ao)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ta(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(oa.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),oa),na={lo:!1,do:0,fo:0,To:0},ra=(ia.Io=function(t){return new ia(t,ia.Ro,ia.Ao)},ia);function ia(t,e,n){this.mo=t,this.wo=e,this.Eo=n}function oa(t){this.ao=t,this.buffer=new yi(ta),this.uo=0}ra.Po=-1,ra.Vo=1048576,ra.po=41943040,ra.Ro=10,ra.Ao=1e3,ra.yo=new ra(ra.po,ra.Ro,ra.Ao),ra.DISABLED=new ra(ra.Po,0,0);var sa=(fa.prototype.start=function(t){this.bo.Do.mo!==ra.Po&&this.Co(t)},fa.prototype.stop=function(){this.So&&(this.So.cancel(),this.So=null)},Object.defineProperty(fa.prototype,"ko",{get:function(){return null!==this.So},enumerable:!0,configurable:!0}),fa.prototype.Co=function(t){var e=this,n=this.vo?3e5:6e4;pu("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.So=this.Nr.eo("lru_garbage_collection",n,function(){return e.So=null,e.vo=!0,t.No(e.bo).then(function(){return e.Co(t)}).catch(la)})},fa),ua=(ca.prototype.$o=function(t,e){return this.Fo.Mo(t).next(function(t){return Math.floor(e/100*t)})},ca.prototype.Lo=function(t,e){var n=this;if(0===e)return xu.resolve(Cu.kr);var r=new ea(e);return this.Fo.Xs(t,function(t){return r._o(t.sequenceNumber)}).next(function(){return n.Fo.Oo(t,function(t){return r._o(t)})}).next(function(){return r.maxValue})},ca.prototype.xo=function(t,e,n){return this.Fo.xo(t,e,n)},ca.prototype.Bo=function(t,e){return this.Fo.Bo(t,e)},ca.prototype.Uo=function(e,n){var r=this;return this.Do.mo===ra.Po?(pu("LruGarbageCollector","Garbage collection skipped; disabled"),xu.resolve(na)):this.qo(e).next(function(t){return t<r.Do.mo?(pu("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.Do.mo),na):r.Qo(e,n)})},ca.prototype.qo=function(t){return this.Fo.qo(t)},ca.prototype.Qo=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.$o(e,this.Do.wo).next(function(t){return i=t>c.Do.Eo?(pu("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.Do.Eo+" from "+t),c.Do.Eo):t,s=Date.now(),c.Lo(e,i)}).next(function(t){return r=t,u=Date.now(),c.xo(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Bo(e,r)}).next(function(t){return h=Date.now(),fu()<=l.DEBUG&&pu("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),xu.resolve({lo:!0,do:i,fo:o,To:t})})},ca),aa=(ha.prototype.start=function(){return this.rh()},ha.prototype.oh=function(i){return y(this,void 0,void 0,function(){var e,g,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.ar,g=this.sh,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var m;return r.ar.hh(v).next(function(t){return m=t,e=r.persistence.Yo(i),g=new Pu(r.Xo,e,r.persistence.nh()),e.hh(v)}).next(function(t){for(var e=[],n=[],r=Ls(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++){var h=a[u];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return g.Tr(v,r).next(function(t){return{ah:t,uh:e,_h:n}})})})];case 1:return n=t.sent(),[2,(this.ar=e,this.sh=g,this.Wo.ih(this.sh),n)]}})})},ha.prototype.lh=function(u){var a,h=this,c=Gr.now(),t=u.reduce(function(t,e){return t.add(e.key)},Ls());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.sh.Tr(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.ee(a.get(i.key));null!=o&&e.push(new yo(i.key,o,o.se(),ro.exists(!0)))}return h.ar.dh(s,c,e,u)})}).then(function(t){var e=t.Pi(a);return{batchId:t.batchId,zi:e}})},ha.prototype.fh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.ar.Th(e,t).next(function(t){return t?n.sh.Tr(e,t):xu.resolve(null)})})},ha.prototype.mh=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.Xo.wh({Eh:!0});return i.ar.mh(t,r.batch,r.streamToken).next(function(){return i.Ih(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.ar.Rh(t)}).next(function(){return i.sh.Tr(t,e)})})},ha.prototype.Ah=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.ar.Ph(e,t).next(function(t){return mu(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.ar.Vh(e,t)}).next(function(){return r.ar.Rh(e)}).next(function(){return r.sh.Tr(e,n)})})},ha.prototype.gh=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.ar.gh(t)})},ha.prototype.ph=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.ar.ph(t)})},ha.prototype.yh=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.ar.yh(t,e)})},ha.prototype.bh=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.th.bh(t)})},ha.prototype.vh=function(a){var h=this,c=a.ts,f=this.Ko;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.Xo.wh({Eh:!0});f=h.Ko;var s=[];a.Ts.forEach(function(t,e){var n=f.get(e);if(n){s.push(h.th.Sh(o,t.gs,e).next(function(){return h.th.Dh(o,t.Ps,e)}));var r=t.resumeToken;if(0<r.Ot()){var i=n.ss(r,c).es(o.Ch);f=f.it(e,i),ha.kh(n,i,t)&&s.push(h.th.Nh(o,i))}}});var u=_s(),n=Ls();if(a.ws.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.ws.forEach(function(t,e){var n=r.get(t);e instanceof Lo&&e.version.isEqual(Br.MIN)?(i.Zi(t,c),u=u.it(t,e)):null==n||0<e.version.D(n.version)||0===e.version.D(n.version)&&n.hasPendingWrites?(i.Yi(e,c),u=u.it(t,e)):pu("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Es.has(t)&&s.push(h.persistence.Jo.Fh(o,t))})})),!c.isEqual(Br.MIN)){var t=h.th.bh(o).next(function(t){return h.th.$h(o,o.Ch,c)});s.push(t)}return xu.Ki(s).next(function(){return i.apply(o)}).next(function(){return h.sh.mr(o,u)})}).then(function(t){return h.Ko=f,t})},ha.kh=function(t,e,n){return mu(0<e.resumeToken.Ot(),"Attempted to persist target data with no resume token"),0===t.resumeToken.Ot()||e.ts.C()-t.ts.C()>=this.Mh||0<n.Ps.size+n.Vs.size+n.gs.size},ha.prototype.Lh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.jo.Si(i.pr,o),this.jo.ki(i.yr,o),!i.fromCache){var s=this.Ko.get(o),u=s.ts,a=s.ns(u);this.Ko=this.Ko.it(o,a)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return xu.forEach(t,function(t){return xu.forEach(t.yr,function(t){return n.persistence.Jo.Di(e,t)})})})},ha.prototype.Oh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.ar.xh(t,e)})},ha.prototype.Bh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.sh.cr(t,e)})},ha.prototype.Uh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.th.qh(e,r).next(function(t){return t?(n=t,xu.resolve(n)):i.th.Qh(e).next(function(t){return n=new ws(r,t,0,e.Ch),i.th.Wh(e,n).next(function(){return n})})})}).then(function(t){return null===i.Ko.get(t.targetId)&&(i.Ko=i.Ko.it(t.targetId,t),i.Go.set(r,t.targetId)),t})},ha.prototype.qh=function(t,e){var n=this.Go.get(e);return void 0!==n?xu.resolve(this.Ko.get(n)):this.th.qh(t,e)},ha.prototype.jh=function(n,r){var i=this,o=this.Ko.get(n),t=r?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",t,function(e){var t=i.jo.Ni(n);return r?xu.resolve():xu.forEach(t,function(t){return i.persistence.Jo.Di(e,t)}).next(function(){i.persistence.Jo.removeTarget(e,o)})}).then(function(){i.Ko=i.Ko.remove(n),i.Go.delete(o.target)})},ha.prototype.Kh=function(t,n){var r=this,i=Br.MIN,o=Ls();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.qh(e,t.xe()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.th.Gh(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Wo.Er(e,t,n?i:Br.MIN,n?o:Ls())}).next(function(t){return{documents:t,zh:o}})})},ha.prototype.Hh=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.th.Gh(t,e)})},ha.prototype.Jh=function(){return this.persistence.Jh()},ha.prototype.Yh=function(t){this.ar.Xh(t)},ha.prototype.Zh=function(t){this.persistence.Zh(t)},ha.prototype.Ih=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=xu.resolve();return n.forEach(function(r){u=u.next(function(){return o.tr(t,r)}).next(function(t){var e=t,n=i.gi.get(r);mu(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.D(n)<0)&&(e=s.Ut(r,e,i))&&o.Yi(e,i.Vi)})}),u.next(function(){return e.ar.Vh(t,s)})},ha.prototype.No=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Uo(t,n.Ko)})},ha.prototype.ta=function(e){var n=this,t=this.Ko.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.th.un(t,e).next(function(t){return t?t.target:null})})},ha.prototype.ea=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.Xo.ea(t,r.zo)}).then(function(t){var e=t.sa,n=t.readTime;return r.zo=n,e})},ha.prototype.rh=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Xo.na(t)})];case 1:return e.zo=t.sent(),[2]}})})},ha);function ha(t,e,n){this.persistence=t,this.Wo=e,this.jo=new Du,this.Ko=new ai(bu),this.Go=new Au(function(t){return t.canonicalId()}),this.zo=Br.MIN,this.persistence.Jo.Ho(this.jo),this.ar=t.Yo(n),this.Xo=t.Zo(),this.th=t.eh(),this.sh=new Pu(this.Xo,this.ar,this.persistence.nh()),this.Wo.ih(this.sh)}function ca(t,e){this.Fo=t,this.Do=e}function fa(t,e){this.bo=t,this.Nr=e,this.vo=!1,this.So=null}function la(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Cr.FAILED_PRECONDITION||e.message!==Ou)throw e;return pu("LocalStore","Unexpectedly lost primary lease"),[2]})})}function pa(t,e){if(0!==e.length)throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+xa(e.length,"argument")+".")}function da(t,e,n){if(e.length!==n)throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires "+xa(n,"argument")+", but was called with "+xa(e.length,"argument")+".")}function ya(t,e,n){if(e.length<n)throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+xa(n,"argument")+", but was called with "+xa(e.length,"argument")+".")}function va(t,e,n,r){if(e.length<n||e.length>r)throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+xa(e.length,"argument")+".")}function ma(t,e,n,r){Ea(t,e,ka(n)+" argument",r)}function ga(t,e,n,r){void 0!==r&&ma(t,e,n,r)}function wa(t,e,n,r){Ea(t,e,n+" option",r)}function ba(t,e,n,r){void 0!==r&&wa(t,e,n,r)}function Ta(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Na(s))}var u=Na(n);throw new Vr(Cr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Ea(t,e,n,r){if(!("object"===e?Ia(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Na(r);throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Ia(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Na(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":vu("Unknown wrong type: "+typeof e);if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Aa(t,e,n){if(void 0===n)throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ka(e)+" argument, but it was undefined.")}function _a(n,t,r){bi(t,function(t,e){if(r.indexOf(t)<0)throw new Vr(Cr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Sa(t,e,n,r){var i=Na(r);return new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires its "+ka(n)+" argument to be a "+e+", but it was: "+i)}function Da(t,e,n){if(n<=0)throw new Vr(Cr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+ka(e)+" argument to be a positive number, but it was: "+n+".")}function ka(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function xa(t,e){return t+" "+e+(1===t?"":"s")}function Ra(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Vr(Cr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function Oa(){if("undefined"==typeof Uint8Array)throw new Vr(Cr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function La(){if(!au.Lt().ia)throw new Vr(Cr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}aa.Mh=3e8;var Pa=(Ma.fromBase64String=function(t){da("Blob.fromBase64String",arguments,1),ma("Blob.fromBase64String","string",1,t),La();try{return new Ma(Ei.fromBase64String(t))}catch(t){throw new Vr(Cr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Ma.fromUint8Array=function(t){if(da("Blob.fromUint8Array",arguments,1),Oa(),!(t instanceof Uint8Array))throw Sa("Blob.fromUint8Array","Uint8Array",1,t);return new Ma(Ei.fromUint8Array(t))},Ma.prototype.toBase64=function(){return da("Blob.toBase64",arguments,0),La(),this.ra.toBase64()},Ma.prototype.toUint8Array=function(){return da("Blob.toUint8Array",arguments,0),Oa(),this.ra.toUint8Array()},Ma.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Ma.prototype.isEqual=function(t){return this.ra.isEqual(t.ra)},Ma),Ua=Ra(Pa,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Ca=(Va.documentId=function(){return Va.ha},Va.prototype.isEqual=function(t){if(!(t instanceof Va))throw Sa("isEqual","FieldPath",1,t);return this.oa.isEqual(t.oa)},Va);function Va(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new Vr(Cr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(ma("FieldPath","string",n,t[n]),0===t[n].length)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.oa=new ii(t)}function Ma(t){La(),this.ra=t}Ca.ha=new Ca(ii.X().K());var qa,Fa=new RegExp("[~\\*/\\[\\]]"),ja=(za.delete=function(){return pa("FieldValue.delete",arguments),Ga.instance},za.serverTimestamp=function(){return pa("FieldValue.serverTimestamp",arguments),Wa.instance},za.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ya("FieldValue.arrayUnion",arguments,1),new Ja(t)},za.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ya("FieldValue.arrayRemove",arguments,1),new $a(t)},za.increment=function(t){return ma("FieldValue.increment","number",1,t),da("FieldValue.increment",arguments,1),new Za(t)},za.prototype.isEqual=function(t){return this===t},za),Ga=(n(Ba,qa=ja),Ba);function Ba(){return qa.call(this,"FieldValue.delete")||this}function za(t){this.aa=t}Ga.instance=new Ga;var Ka,Wa=(n(Ya,Ka=ja),Ya);function Ya(){return Ka.call(this,"FieldValue.serverTimestamp")||this}Wa.instance=new Wa;var Ha,Xa,Qa,Ja=(n(ch,Qa=ja),ch),$a=(n(hh,Xa=ja),hh),Za=(n(ah,Ha=ja),ah),th=Ra(ja,"Use FieldValue.<field>() instead."),eh=(Object.defineProperty(uh.prototype,"latitude",{get:function(){return this._a},enumerable:!0,configurable:!0}),Object.defineProperty(uh.prototype,"longitude",{get:function(){return this.la},enumerable:!0,configurable:!0}),uh.prototype.isEqual=function(t){return this._a===t._a&&this.la===t.la},uh.prototype.p=function(t){return bu(this._a,t._a)||bu(this.la,t.la)},uh),nh=/^__.*__$/,rh=(sh.prototype.da=function(t,e){var n=[];return null!==this.se?n.push(new yo(t,this.data,this.se,e)):n.push(new po(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new vo(t,this.fieldTransforms)),n},sh),ih=(oh.prototype.da=function(t,e){var n=[new yo(t,this.data,this.se,e)];return 0<this.fieldTransforms.length&&n.push(new vo(t,this.fieldTransforms)),n},oh);function oh(t,e,n){this.data=t,this.se=e,this.fieldTransforms=n}function sh(t,e,n){this.data=t,this.se=e,this.fieldTransforms=n}function uh(t,e){if(da("GeoPoint",arguments,2),ma("GeoPoint","number",1,t),ma("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Vr(Cr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Vr(Cr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._a=t,this.la=e}function ah(t){var e=this;return(e=Ha.call(this,"FieldValue.increment")||this).ca=t,e}function hh(t){var e=this;return(e=Xa.call(this,"FieldValue.arrayRemove")||this).ua=t,e}function ch(t){var e=this;return(e=Qa.call(this,"FieldValue.arrayUnion")||this).ua=t,e}function fh(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw vu("Unexpected case for UserDataSource: "+t)}}var lh=(vh.prototype.wa=function(t){var e=null==this.path?null:this.path.child(t),n=new vh(this.fa,this.methodName,e,!1,this.fieldTransforms,this.se);return n.Ea(t),n},vh.prototype.Ia=function(t){var e=null==this.path?null:this.path.child(t),n=new vh(this.fa,this.methodName,e,!1,this.fieldTransforms,this.se);return n.ma(),n},vh.prototype.Ra=function(t){return new vh(this.fa,this.methodName,null,!0,this.fieldTransforms,this.se)},vh.prototype.Aa=function(t){var e=null===this.path||this.path.U()?"":" (found in field "+this.path.toString()+")";return new Vr(Cr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},vh.prototype.contains=function(e){return void 0!==this.se.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},vh.prototype.ma=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Ea(this.path.get(t))},vh.prototype.Ea=function(t){if(0===t.length)throw this.Aa("Document fields must not be empty");if(fh(this.fa)&&nh.test(t))throw this.Aa('Document fields cannot begin and end with "__"')},vh),ph=function(t,e){this.cn=t,this.key=e},dh=(yh.prototype.Va=function(t,e){var n=new lh(0,t,ii.H);gh("Data must be an object, but it was:",n,e);var r=this.ga(e,n);return new rh(new wo(r),null,n.fieldTransforms)},yh.prototype.pa=function(t,e,n){var r=new lh(2,t,ii.H);gh("Data must be an object, but it was:",r,e);var i,o,s=this.ga(e,r);if(n){for(var u=new yi(ii.F),a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof Ca)f=c.oa;else{if("string"!=typeof c)throw vu("Expected stringOrFieldPath to be a string or a FieldPath");f=bh(t,c)}if(!r.contains(f))throw new Vr(Cr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");u=u.add(f)}i=eo.Kt(u),o=r.fieldTransforms.filter(function(t){return i.zt(t.field)})}else i=eo.Gt(r.se),o=r.fieldTransforms;return new rh(new wo(s),i,o)},yh.prototype.ya=function(o,t){var s=this,u=new lh(1,o,ii.H);gh("Data must be an object, but it was:",u,t);var a=new yi(ii.F),h=wo._e();bi(t,function(t,e){var n=bh(o,t),r=u.Ia(n);if((e=s.ba(e,r))instanceof Ga)a=a.add(n);else{var i=s.va(e,r);null!=i&&(a=a.add(n),h.set(n,i))}});var e=eo.Kt(a);return new ih(h.oe(),e,u.fieldTransforms)},yh.prototype.Sa=function(t,e,n,r){var i=new lh(1,t,ii.H),o=[wh(t,e)],s=[n];if(r.length%2!=0)throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(wh(t,r[u])),s.push(r[u+1]);for(var a=new yi(ii.F),h=wo._e(),c=0;c<o.length;++c){var f=o[c],l=i.Ia(f),p=this.ba(s[c],l);if(p instanceof Ga)a=a.add(f);else{var d=this.va(p,l);null!=d&&(a=a.add(f),h.set(f,d))}}var y=eo.Kt(a);return new ih(h.oe(),y,i.fieldTransforms)},yh.prototype.Da=function(t,e,n){void 0===n&&(n=!1);var r=new lh(n?4:3,t,ii.H);return this.va(e,r)},yh.prototype.ba=function(t,e){try{return this.Pa(t)}catch(t){var n=Th(t);throw e.Aa(n)}},yh.prototype.va=function(t,e){if(mh(t=this.ba(t,e)))return gh("Unsupported field value:",e,t),this.ga(t,e);if(t instanceof ja)return this.Ca(t,e),null;if(e.path&&e.se.push(e.path),t instanceof Array){if(e.Ta&&4!==e.fa)throw e.Aa("Nested arrays are not supported");return this.ka(t,e)}return this.Na(t,e)},yh.prototype.ga=function(t,r){var i=this,o={};return Ti(t)?r.path&&0<r.path.length&&r.se.push(r.path):bi(t,function(t,e){var n=i.va(e,r.wa(t));null!=n&&(o[t]=n)}),{mapValue:{fields:o}}},yh.prototype.ka=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],u=this.va(s,e.Ra(r));null==u&&(u={nullValue:"NULL_VALUE"}),n.push(u),r++}return{arrayValue:{values:n}}},yh.prototype.Ca=function(t,e){if(!fh(e.fa))throw e.Aa(t.aa+"() can only be used with update() and set()");if(null===e.path)throw e.Aa(t.aa+"() is not currently supported inside arrays");if(t instanceof Ga){if(2!==e.fa)throw 1===e.fa?e.Aa("FieldValue.delete() can only appear at the top level of your update data"):e.Aa("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.se.push(e.path)}else if(t instanceof Wa)e.fieldTransforms.push(new no(e.path,Ki.instance));else if(t instanceof Ja){var n=this.Fa(t.aa,t.ua),r=new Yi(n);e.fieldTransforms.push(new no(e.path,r))}else if(t instanceof $a){var i=this.Fa(t.aa,t.ua),o=new Hi(i);e.fieldTransforms.push(new no(e.path,o))}else if(t instanceof Za){var s=this.Da("FieldValue.increment",t.ca),u=new Xi(this.serializer,s);e.fieldTransforms.push(new no(e.path,u))}else vu("Unknown FieldValue type: "+t)},yh.prototype.Na=function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return this.serializer.Tn(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Gr.fromDate(t);return{timestampValue:this.serializer.k(n)}}if(t instanceof Gr){var r=new Gr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:this.serializer.k(r)}}if(t instanceof eh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Pa)return{bytesValue:this.serializer.mn(t)};if(t instanceof ph)return{referenceValue:this.serializer.En(t.key.path,t.cn)};throw e.Aa("Unsupported field value: "+Na(t))},yh.prototype.Fa=function(r,t){var i=this;return t.map(function(t,e){var n=new lh(3,r,ii.H);return i.va(t,n.Ra(e))})},yh);function yh(t,e){this.serializer=t,this.Pa=e}function vh(t,e,n,r,i,o){this.fa=t,this.methodName=e,this.path=n,this.Ta=r,void 0===i&&this.ma(),this.Ta=void 0!==r&&r,this.fieldTransforms=i||[],this.se=o||[]}function mh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Gr||t instanceof eh||t instanceof Pa||t instanceof ph||t instanceof ja)}function gh(t,e,n){if(!mh(n)||!Ia(n)){var r=Na(n);throw"an object"===r?e.Aa(t+" a custom object"):e.Aa(t+" "+r)}}function wh(t,e){if(e instanceof Ca)return e.oa;if("string"==typeof e)return bh(t,e);throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function bh(t,e){try{return function(e){if(0<=e.search(Fa))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Ca.bind.apply(Ca,i([void 0],e.split("."))))}catch(t){throw new Vr(Cr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).oa}catch(e){var n=Th(e);throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Th(t){return t instanceof Error?t.message:t.toString()}var Eh,Ih,Nh=(qh.prototype.reset=function(){this.xa=0},qh.prototype.qa=function(){this.xa=this.Oa},qh.prototype.Qa=function(t){var e=this;this.cancel();var n=Math.floor(this.xa+this.Wa()),r=Math.max(0,Date.now()-this.Ua),i=Math.max(0,n-r);0<this.xa&&pu("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.xa+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ba=this.$a.eo(this.Fr,i,function(){return e.Ua=Date.now(),t()}),this.xa*=this.La,this.xa<this.Ma&&(this.xa=this.Ma),this.xa>this.Oa&&(this.xa=this.Oa)},qh.prototype.cancel=function(){null!==this.Ba&&(this.Ba.cancel(),this.Ba=null)},qh.prototype.Wa=function(){return(Math.random()-.5)*this.xa},qh),Ah=(Mh.prototype.Ya=function(){return 1===this.state||2===this.state||4===this.state},Mh.prototype.Xa=function(){return 2===this.state},Mh.prototype.start=function(){3!==this.state?this.auth():this.Za()},Mh.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ya()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Mh.prototype.tu=function(){this.state=0,this.Ja.reset()},Mh.prototype.eu=function(){var t=this;this.Xa()&&null===this.Ha&&(this.Ha=this.$a.eo(this.ja,6e4,function(){return t.su()}))},Mh.prototype.nu=function(t){this.iu(),this.stream.send(t)},Mh.prototype.su=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Xa()?[2,this.close(0)]:[2]})})},Mh.prototype.iu=function(){this.Ha&&(this.Ha.cancel(),this.Ha=null)},Mh.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.iu(),this.Ja.cancel(),this.za++,3!==e?this.Ja.reset():n&&n.code===Cr.RESOURCE_EXHAUSTED?(du(n.toString()),du("Using maximum backoff delay to prevent overloading the backend."),this.Ja.qa()):n&&n.code===Cr.UNAUTHENTICATED&&this.Ga._(),null!==this.stream&&(this.ru(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ou(n)];case 1:return t.sent(),[2]}})})},Mh.prototype.ru=function(){},Mh.prototype.auth=function(){var n=this;this.state=1;var t=this.hu(this.za),e=this.za;this.Ga.getToken().then(function(t){n.za===e&&n.au(t)},function(e){t(function(){var t=new Vr(Cr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.uu(t)})})},Mh.prototype.au=function(t){var e=this,n=this.hu(this.za);this.stream=this.cu(t),this.stream._u(function(){n(function(){return e.state=2,e.listener._u()})}),this.stream.ou(function(t){n(function(){return e.uu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Mh.prototype.Za=function(){var t=this;this.state=4,this.Ja.Qa(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Mh.prototype.uu=function(t){return pu("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Mh.prototype.hu=function(e){var n=this;return function(t){n.$a.qr(function(){return n.za===e?t():(pu("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Mh),_h=(n(Vh,Ih=Ah),Vh.prototype.cu=function(t){return this.Ka.lu("Listen",t)},Vh.prototype.onMessage=function(t){this.Ja.reset();var e=this.serializer.kn(t),n=this.serializer.Fn(t);return this.listener.du(e,n)},Vh.prototype.fu=function(t){var e={};e.database=this.serializer.pn,e.addTarget=this.serializer.xe(t);var n=this.serializer.ei(t);n&&(e.labels=n),this.nu(e)},Vh.prototype.Tu=function(t){var e={};e.database=this.serializer.pn,e.removeTarget=t,this.nu(e)},Vh),Sh=(n(Ch,Eh=Ah),Object.defineProperty(Ch.prototype,"wu",{get:function(){return this.mu},enumerable:!0,configurable:!0}),Ch.prototype.start=function(){this.mu=!1,Eh.prototype.start.call(this)},Ch.prototype.ru=function(){this.mu&&this.Eu([])},Ch.prototype.cu=function(t){return this.Ka.lu("Write",t)},Ch.prototype.onMessage=function(t){if(mu(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.wn(t.streamToken),this.mu){this.Ja.reset();var e=this.serializer.Wn(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Iu(n,e)}return mu(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.mu=!0,this.listener.Ru()},Ch.prototype.Au=function(){var t={};t.database=this.serializer.pn,this.nu(t)},Ch.prototype.Eu=function(t){var e=this,n={streamToken:this.serializer.mn(this.lastStreamToken),writes:t.map(function(t){return e.serializer.$n(t)})};this.nu(n)},Ch),Dh=(Uh.prototype.Pu=function(t){return new Sh(this.$a,this.Ka,this.credentials,this.serializer,t)},Uh.prototype.Vu=function(t){return new _h(this.$a,this.Ka,this.credentials,this.serializer,t)},Uh.prototype.commit=function(t){var e=this,n={database:this.serializer.pn,writes:t.map(function(t){return e.serializer.$n(t)})};return this.gu("Commit",n).then(function(t){return e.serializer.Wn(t.writeResults,t.commitTime)})},Uh.prototype.pu=function(e){var i=this,t={database:this.serializer.pn,documents:e.map(function(t){return i.serializer.An(t)})};return this.yu("BatchGetDocuments",t).then(function(t){var n=_s();t.forEach(function(t){var e=i.serializer.Cn(t);n=n.it(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);mu(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},Uh.prototype.gu=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Ka.gu(e,n,t)}).catch(function(t){throw t.code===Cr.UNAUTHENTICATED&&r.credentials._(),t})},Uh.prototype.yu=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Ka.yu(e,n,t)}).catch(function(t){throw t.code===Cr.UNAUTHENTICATED&&r.credentials._(),t})},Uh),kh=(Ph.prototype.pu=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.ku(),0<this.mutations.length)throw new Vr(Cr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.bu.pu(r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Lo||t instanceof Oo?n.Nu(t):vu("Document in a transaction was a "+t.constructor.name)}),e)]}})})},Ph.prototype.set=function(t,e){this.write(e.da(t,this.Zt(t))),this.Cu.add(t)},Ph.prototype.update=function(t,e){try{this.write(e.da(t,this.Fu(t)))}catch(t){this.Du=t}this.Cu.add(t)},Ph.prototype.delete=function(t){this.write([new mo(t,this.Zt(t))]),this.Cu.add(t)},Ph.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.ku(),this.Du)throw this.Du;return e=this.vu,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new go(t,n.Zt(t)))}),[4,this.bu.commit(this.mutations)];case 1:return t.sent(),this.Su=!0,[2]}})})},Ph.prototype.Nu=function(t){var e;if(t instanceof Oo)e=t.version;else{if(!(t instanceof Lo))throw vu("Document in a transaction was a "+t.constructor.name);e=Br.S()}var n=this.vu.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Vr(Cr.ABORTED,"Document version changed between two reads.")}else this.vu=this.vu.it(t.key,e)},Ph.prototype.Zt=function(t){var e=this.vu.get(t);return!this.Cu.has(t)&&e?ro.updateTime(e):ro.NONE},Ph.prototype.Fu=function(t){var e=this.vu.get(t);if(this.Cu.has(t)||!e)return ro.exists(!0);if(e.isEqual(Br.S()))throw new Vr(Cr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ro.updateTime(e)},Ph.prototype.write=function(t){this.ku(),this.mutations=this.mutations.concat(t)},Ph.prototype.ku=function(){},Ph),xh=(Lh.prototype.xu=function(){var t=this;0===this.Mu&&(this.Bu("Unknown"),this.Lu=this.Nr.eo("online_state_timeout",1e4,function(){return t.Lu=null,t.Uu("Backend didn't respond within 10 seconds."),t.Bu("Offline"),Promise.resolve()}))},Lh.prototype.qu=function(t){"Online"===this.state?this.Bu("Unknown"):(this.Mu++,1<=this.Mu&&(this.Qu(),this.Uu("Connection failed 1 times. Most recent error: "+t.toString()),this.Bu("Offline")))},Lh.prototype.set=function(t){this.Qu(),this.Mu=0,"Online"===t&&(this.Ou=!1),this.Bu(t)},Lh.prototype.Bu=function(t){t!==this.state&&(this.state=t,this.$u(t))},Lh.prototype.Uu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ou?(du(e),this.Ou=!1):pu("OnlineStateTracker",e)},Lh.prototype.Qu=function(){null!==this.Lu&&(this.Lu.cancel(),this.Lu=null)},Lh),Rh=(Oh.prototype.start=function(){return this.enableNetwork()},Oh.prototype.enableNetwork=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.Ju()?(e=this.nc,[4,this.Wu.ph()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.hc()?this.ac():this.Xu.set("Unknown"),[4,this.uc()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Oh.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.cc()];case 1:return t.sent(),this.Xu.set("Offline"),[2]}})})},Oh.prototype.cc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.nc.stop()];case 1:return t.sent(),[4,this.Zu.stop()];case 2:return t.sent(),0<this.ju.length&&(pu("RemoteStore","Stopping write stream with "+this.ju.length+" pending writes"),this.ju=[]),this._c(),[2]}})})},Oh.prototype.lc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return pu("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.cc()];case 1:return t.sent(),this.zu.lc(),this.Xu.set("Unknown"),[2]}})})},Oh.prototype.listen=function(t){this.Ku.has(t.targetId)||(this.Ku.set(t.targetId,t),this.hc()?this.ac():this.Zu.Xa()&&this.dc(t))},Oh.prototype.fc=function(t){this.Ku.delete(t),this.Zu.Xa()&&this.Tc(t),0===this.Ku.size&&(this.Zu.Xa()?this.Zu.eu():this.Ju()&&this.Xu.set("Unknown"))},Oh.prototype.un=function(t){return this.Ku.get(t)||null},Oh.prototype.an=function(t){return this.mc.an(t)},Oh.prototype.dc=function(t){this.Gu.Bs(t.targetId),this.Zu.fu(t)},Oh.prototype.Tc=function(t){this.Gu.Bs(t),this.Zu.Tu(t)},Oh.prototype.ac=function(){this.Gu=new Ks(this),this.Zu.start(),this.Xu.xu()},Oh.prototype.hc=function(){return this.Ju()&&!this.Zu.Ya()&&0<this.Ku.size},Oh.prototype.Ju=function(){return this.isPrimary&&this.networkEnabled},Oh.prototype._c=function(){this.Gu=null},Oh.prototype.tc=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.Ku.forEach(function(t,e){n.dc(t)}),[2]})})},Oh.prototype.ec=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this._c(),this.hc()?(this.Xu.qu(e),this.ac()):this.Xu.set("Unknown"),[2]})})},Oh.prototype.sc=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Xu.set("Online"),n instanceof Ms&&2===n.state&&n.cause?[2,this.wc(n)]:(n instanceof Cs?this.Gu.zs(n):n instanceof Vs?this.Gu.sn(n):this.Gu.Ys(n),r.isEqual(Br.MIN)?[3,4]:[4,this.Wu.bh()]);case 1:return e=t.sent(),0<=r.D(e)?[4,this.Ec(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:t.label=4;case 4:return[2]}})})},Oh.prototype.Ec=function(r){var i=this,t=this.Gu.rn(r);return t.Ts.forEach(function(t,e){if(0<t.resumeToken.Ot()){var n=i.Ku.get(e);n&&i.Ku.set(e,n.ss(t.resumeToken,r))}}),t.ms.forEach(function(t){var e=i.Ku.get(t);if(e){i.Ku.set(t,e.ss(Ei.xt,e.ts)),i.Tc(t);var n=new ws(e.target,t,1,e.sequenceNumber);i.dc(n)}}),this.mc.vh(t)},Oh.prototype.wc=function(t){var n=this,r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return y(n,void 0,void 0,function(){return v(this,function(t){return this.Ku.has(e)?[2,(this.Ku.delete(e),this.Gu.removeTarget(e),this.mc.Ic(e,r))]:[2]})})})}),i},Oh.prototype.uc=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Rc()?(e=0<this.ju.length?this.ju[this.ju.length-1].batchId:-1,[4,this.Wu.Oh(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.ju.length&&this.nc.eu(),[3,4]);case 2:return this.Ac(n),[4,this.uc()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.Pc()&&this.Vc(),[2]}})})},Oh.prototype.Rc=function(){return this.Ju()&&this.ju.length<10},Oh.prototype.gc=function(){return this.ju.length},Oh.prototype.Ac=function(t){this.ju.push(t),this.nc.Xa()&&this.nc.wu&&this.nc.Eu(t.mutations)},Oh.prototype.Pc=function(){return this.Ju()&&!this.nc.Ya()&&0<this.ju.length},Oh.prototype.Vc=function(){this.nc.start()},Oh.prototype.ic=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.nc.Au(),[2]})})},Oh.prototype.oc=function(){var r=this;return this.Wu.yh(this.nc.lastStreamToken).then(function(){for(var t=0,e=r.ju;t<e.length;t++){var n=e[t];r.nc.Eu(n.mutations)}}).catch(la)},Oh.prototype.Iu=function(t,e){var n=this,r=this.ju.shift(),i=Su.from(r,t,e,this.nc.lastStreamToken);return this.mc.pc(i).then(function(){return n.uc()})},Oh.prototype.rc=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){return n&&0<this.ju.length?[2,(this.nc.wu?this.yc(n):this.bc(n)).then(function(){e.Pc()&&e.Vc()})]:[2]})})},Oh.prototype.bc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Is(e.code)?[2,(pu("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.nc.lastStreamToken),this.nc.lastStreamToken=Ei.xt,this.Wu.yh(Ei.xt).catch(la))]:[2]})})},Oh.prototype.yc=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Is(n=i.code)&&n!==Cr.ABORTED?(e=this.ju.shift(),[2,(this.nc.tu(),this.mc.vc(e.batchId,i).then(function(){return r.uc()}))]):[2]})})},Oh.prototype.Sc=function(){return new kh(this.bu)},Oh.prototype.Yu=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.cc()];case 1:return t.sent(),this.Xu.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Oh.prototype.Dc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ju()?(pu("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.Yu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Oh.prototype.Cc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.cc()];case 3:t.sent(),this.Xu.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Oh);function Oh(t,e,n,r,i){var o=this;this.Wu=t,this.bu=e,this.ju=[],this.Ku=new Map,this.Gu=null,this.networkEnabled=!1,this.isPrimary=!1,this.zu=i,this.zu.Hu(function(t){n.qr(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ju()?(pu("RemoteStore","Restarting streams for network reachability change."),[4,this.Yu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Xu=new xh(n,r),this.Zu=this.bu.Vu({_u:this.tc.bind(this),ou:this.ec.bind(this),du:this.sc.bind(this)}),this.nc=this.bu.Pu({_u:this.ic.bind(this),ou:this.rc.bind(this),Ru:this.oc.bind(this),Iu:this.Iu.bind(this)})}function Lh(t,e){this.Nr=t,this.$u=e,this.state="Unknown",this.Mu=0,this.Lu=null,this.Ou=!0}function Ph(t){this.bu=t,this.vu=Rs(),this.mutations=[],this.Su=!1,this.Du=null,this.Cu=new Set}function Uh(t,e,n,r){this.$a=t,this.Ka=e,this.credentials=n,this.serializer=r}function Ch(t,e,n,r,i){var o=this;return(o=Eh.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.mu=!1,o.lastStreamToken=Ei.xt,o}function Vh(t,e,n,r,i){var o=this;return(o=Ih.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Mh(t,e,n,r,i,o){this.$a=t,this.ja=n,this.Ka=r,this.Ga=i,this.listener=o,this.state=0,this.za=0,this.Ha=null,this.stream=null,this.Ja=new Nh(t,e)}function qh(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.$a=t,this.Fr=e,this.Ma=n,this.La=r,this.Oa=i,this.xa=0,this.Ba=null,this.Ua=Date.now(),this.reset()}function Fh(t,e){return"firestore_clients_"+t+"_"+e}function jh(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function Gh(t,e){return"firestore_targets_"+t+"_"+e}function Bh(t){this.key=t}function zh(t){this.key=t}function Kh(t,e,n){this.query=t,this.targetId=e,this.view=n}function Wh(t){this.key=t,this.Y_=!1}function Yh(){this.kl=null,this.targetId=0,this.Nl=[]}var Hh=(Tc.kc=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Vr(r.error.code,r.error.message)),i?new Tc(t,e,r.state,o):(du("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Tc.prototype.Nc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Tc),Xh=(bc.kc=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Vr(n.error.code,n.error.message)),r?new bc(t,n.state,i):(du("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},bc.prototype.Nc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bc),Qh=(wc.kc=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Us(),o=0;r&&o<n.activeTargetIds.length;++o)r=_i(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new wc(t,i):(du("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},wc),Jh=(gc.kc=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new gc(e.clientId,e.onlineState):(du("SharedClientState","Failed to parse online state: "+t),null)},gc),$h=(mc.prototype.Fc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},mc.prototype.$c=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},mc.prototype.Nc=function(){var t={activeTargetIds:this.activeTargetIds.j(),updateTimeMs:Date.now()};return JSON.stringify(t)},mc),Zh=(vc.Uc=function(t){return!(!t.window||null==t.window.localStorage)},vc.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.mc.Jh()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Mc&&(o=this.getItem(Fh(this.persistenceKey,i)))&&(s=Qh.kc(i,o))&&(this.Lc[s.clientId]=s);for(this.zc(),(u=this.storage.getItem(this.Gc))&&(a=this.Hc(u))&&this.Jc(a),h=0,c=this.Bc;h<c.length;h++)f=c[h],this.xc(f);return this.Bc=[],this.platform.window.addEventListener("unload",function(){return l.lc()}),this.ko=!0,[2]}})})},vc.prototype.Cr=function(t){this.setItem(this.Qc,JSON.stringify(t))},vc.prototype.Yc=function(){var n=Us();return bi(this.Lc,function(t,e){n=n.Ft(e.activeTargetIds)}),n},vc.prototype.Xc=function(t){for(var e in this.Lc)if(this.Lc.hasOwnProperty(e)&&this.Lc[e].activeTargetIds.has(t))return!0;return!1},vc.prototype.Zc=function(t){this.t_(t,"pending")},vc.prototype.e_=function(t,e,n){this.t_(t,e,n),this.s_(t)},vc.prototype.n_=function(t){var e="not-current";if(this.Xc(t)){var n=this.storage.getItem(Gh(this.persistenceKey,t));if(n){var r=Xh.kc(t,n);r&&(e=r.state)}}return this.i_.Fc(t),this.zc(),e},vc.prototype.r_=function(t){this.i_.$c(t),this.zc()},vc.prototype.o_=function(t){return this.i_.activeTargetIds.has(t)},vc.prototype.h_=function(t){this.removeItem(Gh(this.persistenceKey,t))},vc.prototype.a_=function(t,e,n){this.u_(t,e,n)},vc.prototype.oh=function(t,e,n){var r=this;e.forEach(function(t){r.s_(t)}),this.currentUser=t,n.forEach(function(t){r.Zc(t)})},vc.prototype.c_=function(t){this.__(t)},vc.prototype.lc=function(){this.ko&&(this.platform.window.removeEventListener("storage",this.Oc),this.removeItem(this.qc),this.ko=!1)},vc.prototype.getItem=function(t){var e=this.storage.getItem(t);return pu("SharedClientState","READ",t,e),e},vc.prototype.setItem=function(t,e){pu("SharedClientState","SET",t,e),this.storage.setItem(t,e)},vc.prototype.removeItem=function(t){pu("SharedClientState","REMOVE",t),this.storage.removeItem(t)},vc.prototype.xc=function(u){var t=this;if(u.storageArea===this.storage){if(pu("SharedClientState","EVENT",u.key,u.newValue),u.key===this.qc)return void du("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.$a.qr(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.ko){if(null!==u.key)if(this.Wc.test(u.key)){if(null==u.newValue)return e=this.l_(u.key),[2,this.d_(e,null)];if(n=this.f_(u.key,u.newValue))return[2,this.d_(n.clientId,n)]}else if(this.jc.test(u.key)){if(null!==u.newValue&&(r=this.T_(u.key,u.newValue)))return[2,this.m_(r)]}else if(this.Kc.test(u.key)){if(null!==u.newValue&&(i=this.w_(u.key,u.newValue)))return[2,this.E_(i)]}else if(u.key===this.Gc){if(null!==u.newValue&&(o=this.Hc(u.newValue)))return[2,this.Jc(o)]}else u.key===this.Qc&&(s=function(t){var e=Cu.kr;if(null!=t)try{var n=JSON.parse(t);mu("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){du("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==Cu.kr&&this.vr(s)}else this.Bc.push(u);return[2]})})})}},Object.defineProperty(vc.prototype,"i_",{get:function(){return this.Lc[this.Mc]},enumerable:!0,configurable:!0}),vc.prototype.zc=function(){this.setItem(this.qc,this.i_.Nc())},vc.prototype.t_=function(t,e,n){var r=new Hh(this.currentUser,t,e,n),i=jh(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Nc())},vc.prototype.s_=function(t){var e=jh(this.persistenceKey,this.currentUser,t);this.removeItem(e)},vc.prototype.__=function(t){var e={clientId:this.Mc,onlineState:t};this.storage.setItem(this.Gc,JSON.stringify(e))},vc.prototype.u_=function(t,e,n){var r=Gh(this.persistenceKey,t),i=new Xh(t,e,n);this.setItem(r,i.Nc())},vc.prototype.l_=function(t){var e=this.Wc.exec(t);return e?e[1]:null},vc.prototype.f_=function(t,e){var n=this.l_(t);return Qh.kc(n,e)},vc.prototype.T_=function(t,e){var n=this.jc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Hh.kc(new Or(i),r,e)},vc.prototype.w_=function(t,e){var n=this.Kc.exec(t),r=Number(n[1]);return Xh.kc(r,e)},vc.prototype.Hc=function(t){return Jh.kc(t)},vc.prototype.m_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.mc.I_(e.batchId,e.state,e.error)]:(pu("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},vc.prototype.E_=function(t){return this.mc.R_(t.targetId,t.state,t.error)},vc.prototype.d_=function(t,e){var n=this,r=this.Yc();e?this.Lc[t]=e:delete this.Lc[t];var i=this.Yc(),o=[],s=[];return i.forEach(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.mc.A_(o,s)},vc.prototype.Jc=function(t){this.Lc[t.clientId]&&this.$u(t.onlineState)},vc),tc=(yc.prototype.Zc=function(t){},yc.prototype.e_=function(t,e,n){},yc.prototype.n_=function(t){return this.P_.Fc(t),this.V_[t]||"not-current"},yc.prototype.a_=function(t,e,n){this.V_[t]=e},yc.prototype.r_=function(t){this.P_.$c(t)},yc.prototype.o_=function(t){return this.P_.activeTargetIds.has(t)},yc.prototype.h_=function(t){delete this.V_[t]},yc.prototype.Yc=function(){return this.P_.activeTargetIds},yc.prototype.Xc=function(t){return this.P_.activeTargetIds.has(t)},yc.prototype.start=function(){return this.P_=new $h,Promise.resolve()},yc.prototype.oh=function(t,e,n){},yc.prototype.c_=function(t){},yc.prototype.lc=function(){},yc.prototype.Cr=function(t){},yc),ec=(dc.prototype.next=function(){return this.g_+=2,this.g_},dc.p_=function(){return new dc(0)},dc.y_=function(){return new dc(-1)},dc),nc=(Object.defineProperty(pc.prototype,"C_",{get:function(){return this.b_},enumerable:!0,configurable:!0}),pc.prototype.k_=function(t,e){var u=this,a=e?e.N_:new Fs,h=e?e.D_:this.D_,c=e?e._s:this._s,f=h,l=!1,p=this.query.je()&&h.size===this.query.limit?h.last():null,d=this.query.Ke()&&h.size===this.query.limit?h.first():null;if(t.ut(function(t,e){var n=h.get(t),r=e instanceof Oo?e:null;r=r&&(u.query.matches(r)?r:null);var i=!!n&&u._s.has(n.key),o=!!r&&(r.te||u._s.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.F_(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.Be(r,p)||d&&u.query.Be(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.je()||this.query.Ke())for(;f.size>this.query.limit;){var n=this.query.je()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),a.track({type:1,doc:n})}return{D_:f,N_:a,M_:l,_s:c}},pc.prototype.F_=function(t,e){return t.te&&e.hasCommittedMutations&&!e.te},pc.prototype.nr=function(t,e,n){var o=this,r=this.D_;this.D_=t.D_,this._s=t._s;var i=t.N_.us();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.Be(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return vu("Unknown ChangeType: "+t)}}var r,i}),this.L_(n);var s=e?this.O_():[],u=0===this.S_.size&&this.As?1:0,a=u!==this.v_;return this.v_=u,0!==i.length||a?{snapshot:new js(this.query,t.D_,r,i,t._s,0==u,a,!1),x_:s}:{x_:s}},pc.prototype.B_=function(t){return this.As&&"Offline"===t?(this.As=!1,this.nr({D_:this.D_,N_:new Fs,_s:this._s,M_:!1},!1)):{x_:[]}},pc.prototype.U_=function(t){return!this.b_.has(t)&&!!this.D_.has(t)&&!this.D_.get(t).te},pc.prototype.L_=function(t){var e=this;t&&(t.Ps.forEach(function(t){return e.b_=e.b_.add(t)}),t.Vs.forEach(function(t){}),t.gs.forEach(function(t){return e.b_=e.b_.delete(t)}),this.As=t.As)},pc.prototype.O_=function(){var e=this;if(!this.As)return[];var n=this.S_;this.S_=Ls(),this.D_.forEach(function(t){e.U_(t.key)&&(e.S_=e.S_.add(t.key))});var r=[];return n.forEach(function(t){e.S_.has(t)||r.push(new zh(t))}),this.S_.forEach(function(t){n.has(t)||r.push(new Bh(t))}),r},pc.prototype.q_=function(t){this.b_=t.zh,this.S_=Ls();var e=this.k_(t.documents);return this.nr(e,!0)},pc.prototype.Q_=function(){return js.fs(this.query,this.D_,this._s,0===this.v_)},pc),rc=(lc.prototype.K_=function(){this.G_()},lc.prototype.G_=function(){var t=this;this.Ja.Qa(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.W_.Sc(),(n=this.z_(e))&&n.then(function(t){r.Nr.qr(function(){return e.commit().then(function(){r.Lr.resolve(t)}).catch(function(t){r.H_(t)})})}).catch(function(t){r.H_(t)}),[2]})})})},lc.prototype.z_=function(t){try{var e=this.updateFunction(t);return!Ni(e)&&e.catch&&e.then?e:(this.Lr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Lr.reject(t),null}},lc.prototype.H_=function(t){var e=this;0<this.j_&&this.J_(t)?(--this.j_,this.Nr.qr(function(){return e.G_(),Promise.resolve()})):this.Lr.reject(t)},lc.prototype.J_=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Is(e)},lc),ic=(Object.defineProperty(fc.prototype,"cl",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),fc.prototype.subscribe=function(t){this.tl=t},fc.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this._l("listen()"),(r=this.el.get(s))?(e=r.targetId,this.X_.n_(e),n=r.view.Q_(),[3,4]):[3,1];case 1:return[4,this.Wu.Uh(s.xe())];case 2:return i=t.sent(),o=this.X_.n_(i.targetId),e=i.targetId,[4,this.ll(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.W_.listen(i),t.label=4;case 4:return[2,(this.tl.du([n]),e)]}})})},fc.prototype.ll=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.Wu.Kh(u,!0)];case 1:return e=t.sent(),n=new nc(u,e.zh),r=n.k_(e.documents),i=Bs.Rs(a,h&&"Offline"!==this.onlineState),o=n.nr(r,!0===this.isPrimary,i),s=new Kh(u,a,n),[2,(this.el.set(u,s),this.sl.has(a)?this.sl.get(a).push(u):this.sl.set(a,[u]),o.snapshot)]}})})},fc.prototype.dl=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.Wu.Kh(r.query,!0)];case 1:return e=t.sent(),n=r.view.q_(e),[2,(this.isPrimary&&this.fl(r.targetId,n.x_),n)]}})})},fc.prototype.fc=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this._l("unlisten()"),e=this.el.get(i),1<(n=this.sl.get(e.targetId)).length?[2,(this.sl.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.el.delete(i))]:this.isPrimary?(this.X_.r_(e.targetId),this.X_.Xc(e.targetId)?[3,2]:[4,this.Wu.jh(e.targetId,!1).then(function(){r.X_.h_(e.targetId),r.W_.fc(e.targetId),r.Tl(e.targetId)}).catch(la)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Tl(e.targetId),[4,this.Wu.jh(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},fc.prototype.write=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this._l("write()"),[4,this.Wu.lh(n)];case 1:return e=t.sent(),this.X_.Zc(e.batchId),this.ml(e.batchId,r),[4,this.wl(e.zi)];case 2:return t.sent(),[4,this.W_.uc()];case 3:return t.sent(),[2]}})})},fc.prototype.runTransaction=function(t,e,n){new rc(t,this.W_,e,n).K_()},fc.prototype.vh=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this._l("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Wu.vh(n)];case 2:return e=t.sent(),n.Ts.forEach(function(t,e){var n=r.rl.get(e);n&&(mu(t.Ps.size+t.Vs.size+t.gs.size<=1,"Limbo resolution for single document contains multiple changes."),0<t.Ps.size?n.Y_=!0:0<t.Vs.size?mu(n.Y_,"Received change for limbo target document without add."):0<t.gs.size&&(mu(n.Y_,"Received remove for limbo target document without add."),n.Y_=!1))}),[4,this.wl(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,la(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},fc.prototype.B_=function(r,t){if(this.isPrimary&&0===t||!this.isPrimary&&1===t){this._l("applyOnlineStateChange()");var i=[];this.el.forEach(function(t,e){var n=e.view.B_(r);n.snapshot&&i.push(n.snapshot)}),this.tl.El(r),this.tl.du(i),this.onlineState=r,this.isPrimary&&this.X_.c_(r)}},fc.prototype.Ic=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this._l("rejectListens()"),this.X_.a_(u,"rejected",a),e=this.rl.get(u),(n=e&&e.key)?(this.il=this.il.remove(n),this.rl.delete(u),this.Il(),r=(r=new ai(si.F)).it(n,new Lo(n,Br.S())),i=Ls().add(n),o=new Gs(Br.MIN,new Map,new yi(bu),r,i),[2,this.vh(o)]):[4,this.Wu.jh(u,!1).then(function(){return s.Tl(u,a)}).catch(la)];case 1:return t.sent(),[2]}})})},fc.prototype.I_=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this._l("applyBatchState()"),[4,this.Wu.fh(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.W_.uc()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Rl(n,i||null),this.Wu.Yh(n)):vu("Unknown batchState: "+r),t.label=4;case 4:return[4,this.wl(e)];case 5:return t.sent(),[3,7];case 6:pu("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},fc.prototype.pc=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this._l("applySuccessfulWrite()"),e=r.batch.batchId,this.Rl(e,null),this.Al(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Wu.mh(r)];case 2:return n=t.sent(),this.X_.e_(e,"acknowledged"),[4,this.wl(n)];case 3:return t.sent(),[3,6];case 4:return[4,la(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},fc.prototype.vc=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this._l("rejectFailedWrite()"),this.Rl(n,r),this.Al(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Wu.Ah(n)];case 2:return e=t.sent(),this.X_.e_(n,"rejected",r),[4,this.wl(e)];case 3:return t.sent(),[3,6];case 4:return[4,la(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},fc.prototype.Pl=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.W_.Ju()||pu("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.Wu.gh()];case 1:return-1===(e=t.sent())?[2,void r.resolve()]:((n=this.al.get(e)||[]).push(r),this.al.set(e,n),[2])}})})},fc.prototype.Al=function(t){(this.al.get(t)||[]).forEach(function(t){t.resolve()}),this.al.delete(t)},fc.prototype.Vl=function(e){this.al.forEach(function(t){t.forEach(function(t){t.reject(new Vr(Cr.CANCELLED,e))})}),this.al.clear()},fc.prototype.ml=function(t,e){var n=this.hl[this.currentUser.s()];n=(n=n||new ai(bu)).it(t,e),this.hl[this.currentUser.s()]=n},fc.prototype.Rl=function(t,e){var n=this.hl[this.currentUser.s()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.hl[this.currentUser.s()]=n}},fc.prototype.Tl=function(t,e){var n=this;void 0===e&&(e=null),this.X_.r_(t);for(var r=0,i=this.sl.get(t);r<i.length;r++){var o=i[r];this.el.delete(o),e&&this.tl.gl(o,e)}if(this.sl.delete(t),this.isPrimary){var s=this.ol.$i(t);this.ol.Ni(t),s.forEach(function(t){n.ol.Mi(t)||n.pl(t)})}},fc.prototype.pl=function(t){var e=this.il.get(t);null!==e&&(this.W_.fc(e),this.il=this.il.remove(t),this.rl.delete(e),this.Il())},fc.prototype.fl=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Bh?(this.ol.vi(i.key,t),this.yl(i)):i instanceof zh?(pu("SyncEngine","Document no longer in limbo: "+i.key),this.ol.Di(i.key,t),this.ol.Mi(i.key)||this.pl(i.key)):vu("Unknown limbo change: "+JSON.stringify(i))}},fc.prototype.yl=function(t){var e=t.key;this.il.get(e)||(pu("SyncEngine","New document in limbo: "+e),this.nl.push(e),this.Il())},fc.prototype.Il=function(){for(;0<this.nl.length&&this.il.size<this.Z_;){var t=this.nl.shift(),e=this.ul.next();this.rl.set(e,new Wh(t)),this.il=this.il.it(t,e),this.W_.listen(new ws(Co.ve(t.path).xe(),e,2,Cu.kr))}},fc.prototype.bl=function(){return this.il},fc.prototype.vl=function(){return this.nl},fc.prototype.wl=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.el.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.k_(r);return n.M_?u.Wu.Kh(i.query,!1).then(function(t){var e=t.documents;return i.view.k_(e,n)}):n}).then(function(t){var e=a&&a.Ts.get(i.targetId),n=i.view.nr(t,!0===u.isPrimary,e);if(u.fl(i.targetId,n.x_),n.snapshot){u.isPrimary&&u.X_.a_(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=Uu.br(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.tl.du(o),[4,this.Wu.Lh(s)];case 2:return t.sent(),[2]}})})},fc.prototype._l=function(t){},fc.prototype.Dc=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.Vl("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.Wu.oh(r)]):[3,3];case 1:return n=t.sent(),this.X_.oh(r,n.uh,n._h),[4,this.wl(n.ah)];case 2:t.sent(),t.label=3;case 3:return[4,this.W_.Dc()];case 4:return t.sent(),[2]}})})},fc.prototype.Cc=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.W_.Cc(!0)]);case 1:return t.sent(),e=this.X_.Yc(),[4,this.Sl(e.j())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.W_.listen(o);return[3,7];case 3:return!1!==h||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),this.sl.forEach(function(t,e){a.X_.o_(e)?s.push(e):u=u.then(function(){return a.Tl(e),a.Wu.jh(e,!0)}),a.W_.fc(e)}),[4,u]);case 4:return t.sent(),[4,this.Sl(s)];case 5:return t.sent(),this.Dl(),[4,this.W_.Cc(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},fc.prototype.Dl=function(){var n=this;this.rl.forEach(function(t,e){n.W_.fc(e)}),this.ol.Fi(),this.rl=new Map,this.il=new ai(si.F)},fc.prototype.Sl=function(d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.sl.get(o))&&0!==u.length?[4,this.Wu.jh(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.Wu.Uh(u[0].xe())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.el.get(c),[4,this.dl(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.Wu.ta(o)];case 9:return p=t.sent(),[4,this.Wu.Uh(p)];case 10:return s=t.sent(),[4,this.ll(this.Cl(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.tl.du(n),e)]}})})},fc.prototype.Cl=function(t){return new Co(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},fc.prototype.Jh=function(){return this.Wu.Jh()},fc.prototype.R_=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.isPrimary?(pu("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.sl.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.Wu.ea()];case 3:return e=t.sent(),n=Gs.Is(r,"current"===i),[4,this.wl(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.Wu.jh(r,!0)];case 6:return t.sent(),this.Tl(r,o),[3,8];case 7:vu("Unexpected target state: "+i),t.label=8;case 8:return[2]}})})},fc.prototype.A_=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],[4,this.Wu.ta(r)]):[3,6];case 2:return i=t.sent(),[4,this.Wu.Uh(i)];case 3:return o=t.sent(),[4,this.ll(this.Cl(i),o.targetId,!1)];case 4:t.sent(),this.W_.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.sl.has(e)?[4,u.Wu.jh(e,!1).then(function(){f.W_.fc(e),f.Tl(e)}).catch(la)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},fc.prototype.enableNetwork=function(){return this.Wu.Zh(!0),this.W_.enableNetwork()},fc.prototype.disableNetwork=function(){return this.Wu.Zh(!1),this.W_.disableNetwork()},fc.prototype.an=function(t){var e=this.rl.get(t);if(e&&e.Y_)return Ls().add(e.key);var n=Ls(),r=this.sl.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.el.get(s);n=n.Ft(u.view.C_)}return n},fc),oc=(cc.prototype.listen=function(t){var e=t.query,n=!1,r=this.Fl.get(e);return r||(n=!0,r=new Yh,this.Fl.set(e,r)),r.Nl.push(t),t.B_(this.onlineState),r.kl&&t.Ml(r.kl)&&this.Ll(),n?this.mc.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},cc.prototype.fc=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.Fl.get(e))&&0<=(i=r.Nl.indexOf(o))&&(r.Nl.splice(i,1),n=0===r.Nl.length),n?[2,(this.Fl.delete(e),this.mc.fc(e))]:[2]})})},cc.prototype.du=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.Fl.get(o);if(s){for(var u=0,a=s.Nl;u<a.length;u++)a[u].Ml(i)&&(e=!0);s.kl=i}}e&&this.Ll()},cc.prototype.gl=function(t,e){var n=this.Fl.get(t);if(n)for(var r=0,i=n.Nl;r<i.length;r++)i[r].onError(e);this.Fl.delete(t)},cc.prototype.El=function(i){this.onlineState=i;var o=!1;this.Fl.forEach(function(t,e){for(var n=0,r=e.Nl;n<r.length;n++)r[n].B_(i)&&(o=!0)}),o&&this.Ll()},cc.prototype.Ol=function(t){this.$l.add(t),t.next()},cc.prototype.xl=function(t){this.$l.delete(t)},cc.prototype.Ll=function(){this.$l.forEach(function(t){t.next()})},cc),sc=(hc.prototype.Ml=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new js(t.query,t.docs,t.cs,e,t._s,t.fromCache,t.ls,!0)}var o=!1;return this.Ul?this.Ql(t)&&(this.Bl.next(t),o=!0):this.Wl(t,this.onlineState)&&(this.jl(t),o=!0),this.ql=t,o},hc.prototype.onError=function(t){this.Bl.error(t)},hc.prototype.B_=function(t){this.onlineState=t;var e=!1;return this.ql&&!this.Ul&&this.Wl(this.ql,t)&&(this.jl(this.ql),e=!0),e},hc.prototype.Wl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Kl&&n||t.docs.U()&&"Offline"!==e)},hc.prototype.Ql=function(t){if(0<t.docChanges.length)return!0;var e=this.ql&&this.ql.hasPendingWrites!==t.hasPendingWrites;return!(!t.ls&&!e)&&!0===this.options.includeMetadataChanges},hc.prototype.jl=function(t){t=js.fs(t.query,t.docs,t._s,t.fromCache),this.Ul=!0,this.Bl.next(t)},hc),uc=(ac.prototype.ih=function(t){this.Gl=t},ac.prototype.Er=function(e,r,i,o){var s=this;return r.Oe()||i.isEqual(Br.MIN)?this.zl(e,r):this.Gl.Tr(e,o).next(function(t){var n=s.Hl(r,t);return(r.je()||r.Ke())&&s.M_(r.ge,n,o,i)?s.zl(e,r):(fu()<=l.DEBUG&&pu("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Gl.Er(e,r,i).next(function(e){return n.forEach(function(t){e=e.it(t.key,t)}),e}))})},ac.prototype.Hl=function(n,t){var r=new yi(function(t,e){return n.Be(t,e)});return t.forEach(function(t,e){e instanceof Oo&&n.matches(e)&&(r=r.add(e))}),r},ac.prototype.M_=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.D(r))},ac.prototype.zl=function(t,e){return fu()<=l.DEBUG&&pu("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Gl.Er(t,e,Br.MIN)},ac);function ac(){}function hc(t,e,n){this.query=t,this.Bl=e,this.Ul=!1,this.ql=null,this.onlineState="Unknown",this.options=n||{}}function cc(t){this.mc=t,this.Fl=new Au(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.$l=new Set,this.mc.subscribe(this)}function fc(t,e,n,r,i){this.Wu=t,this.W_=e,this.X_=n,this.currentUser=r,this.Z_=i,this.tl=null,this.el=new Au(function(t){return t.canonicalId()}),this.sl=new Map,this.nl=[],this.il=new ai(si.F),this.rl=new Map,this.ol=new Du,this.hl={},this.al=new Map,this.ul=ec.y_(),this.isPrimary=void 0,this.onlineState="Unknown"}function lc(t,e,n,r){this.Nr=t,this.W_=e,this.updateFunction=n,this.Lr=r,this.j_=5,this.Ja=new Nh(this.Nr,"retry_transaction")}function pc(t,e){this.query=t,this.b_=e,this.v_=null,this.As=!1,this.S_=Ls(),this._s=Ls(),this.D_=new qs(t.Be.bind(t))}function dc(t){this.g_=t}function yc(){this.P_=new $h,this.V_={},this.mc=null,this.$u=null,this.vr=null}function vc(t,e,n,r,i){if(this.$a=t,this.platform=e,this.persistenceKey=n,this.Mc=r,this.mc=null,this.$u=null,this.vr=null,this.Lc={},this.Oc=this.xc.bind(this),this.ko=!1,this.Bc=[],!vc.Uc(this.platform))throw new Vr(Cr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.qc=Fh(this.persistenceKey,this.Mc),this.Qc="firestore_sequence_number_"+this.persistenceKey,this.Lc[this.Mc]=new $h,this.Wc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.jc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Kc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Gc="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Oc)}function mc(){this.activeTargetIds=Us()}function gc(t,e){this.clientId=t,this.onlineState=e}function wc(t,e){this.clientId=t,this.activeTargetIds=e}function bc(t,e,n){this.targetId=t,this.state=e,this.error=n}function Tc(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Ec(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Nc(e)),e=Ic(t.get(n),e);return Nc(e)}function Ic(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Nc(t){return t+""}function Ac(t){var e=t.length;if(mu(2<=e,"Invalid path "+t),2===e)return mu(""===t.charAt(0)&&""===t.charAt(1),"Non-empty path "+t+" had length 2"),Zr.H;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&vu('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:vu('Invalid encoded resource path: "'+t+'"')}o=s+2}return new Zr(r)}var _c=(Lc.Yl=function(o,t,s){return pu("SimpleDb","Opening database:",o),new xu(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Lc(e))},i.onblocked=function(){r(new Vr(Cr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Vr(Cr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){pu("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,af).next(function(){pu("SimpleDb","Database upgrade to version "+af+" complete")})}}).Wi()},Lc.delete=function(t){return pu("SimpleDb","Removing database:",t),Pc(window.indexedDB.deleteDatabase(t)).Wi()},Lc.Uc=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Lc.Xl())return!0;if(void 0===window.navigator)return!1;var t=p(),e=Lc.Jl(t),n=0<e&&e<10,r=Lc.Zl(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Lc.Xl=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.td)},Lc.ed=function(t,e){return t.store(e)},Lc.Jl=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Lc.Zl=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Lc.prototype.sd=function(e){this.db.onversionchange=function(t){return e(t)}},Lc.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Dc.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),xu.reject(t)}).Wi(),r={},n.catch(function(){}),[4,e.nd];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,pu("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Lc.prototype.close=function(){this.db.close()},Lc),Sc=(Object.defineProperty(Oc.prototype,"Bi",{get:function(){return this.od},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"ad",{get:function(){return this.hd},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"cursor",{set:function(t){this.rd=t},enumerable:!0,configurable:!0}),Oc.prototype.done=function(){this.od=!0},Oc.prototype.ud=function(t){this.hd=t},Oc.prototype.delete=function(){return Pc(this.rd.delete())},Oc),Dc=(Rc.open=function(t,e,n){return new Rc(t.transaction(n,e))},Object.defineProperty(Rc.prototype,"nd",{get:function(){return this._d.promise},enumerable:!0,configurable:!0}),Rc.prototype.abort=function(t){t&&this._d.reject(t),this.aborted||(pu("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Rc.prototype.store=function(t){var e=this.transaction.objectStore(t);return new kc(e)},Rc),kc=(xc.prototype.put=function(t,e){return Pc(void 0!==e?(pu("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(pu("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},xc.prototype.add=function(t){return pu("SimpleDb","ADD",this.store.name,t,t),Pc(this.store.add(t))},xc.prototype.get=function(e){var n=this;return Pc(this.store.get(e)).next(function(t){return void 0===t&&(t=null),pu("SimpleDb","GET",n.store.name,e,t),t})},xc.prototype.delete=function(t){return pu("SimpleDb","DELETE",this.store.name,t),Pc(this.store.delete(t))},xc.prototype.count=function(){return pu("SimpleDb","COUNT",this.store.name),Pc(this.store.count())},xc.prototype.ld=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.dd(n,function(t,e){r.push(e)}).next(function(){return r})},xc.prototype.fd=function(t,e){pu("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Td=!1;var r=this.cursor(n);return this.dd(r,function(t,e,n){return n.delete()})},xc.prototype.md=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.dd(r,e)},xc.prototype.wd=function(i){var t=this.cursor({});return new xu(function(n,r){t.onerror=function(t){var e=Cc(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},xc.prototype.dd=function(t,s){var u=[];return new xu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Sc(e),r=s(e.primaryKey,e.value,n);if(r instanceof xu){var i=r.catch(function(t){return n.done(),xu.reject(t)});u.push(i)}n.Bi?o():null===n.ad?e.continue():e.continue(n.ad)}else o()}}).next(function(){return xu.Ki(u)})},xc.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},xc.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Td?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},xc);function xc(t){this.store=t}function Rc(t){var n=this;this.transaction=t,this.aborted=!1,this._d=new Xu,this.transaction.oncomplete=function(){n._d.resolve()},this.transaction.onabort=function(){t.error?n._d.reject(t.error):n._d.resolve()},this.transaction.onerror=function(t){var e=Cc(t.target.error);n._d.reject(e)}}function Oc(t){this.rd=t,this.od=!1,this.hd=null}function Lc(t){this.db=t,12.2===Lc.Jl(p())&&du("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Pc(t){return new xu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Cc(t.target.error);r(e)}})}var Uc=!1;function Cc(t){var e=_c.Jl(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Vr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Uc||(Uc=!0,setTimeout(function(){throw r},0)),r}}return t}var Vc=(Mc.Id=function(t,e,n,r){return mu(""!==t.uid,"UserID must not be an empty string."),new Mc(t.t()?t.uid:"",e,n,r)},Mc.prototype.Rd=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return jc(t).md({index:yf.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Mc.prototype.mh=function(e,t,n){return this.Ad(e).next(function(t){return t.lastStreamToken=n.toBase64(),Bc(e).put(t)})},Mc.prototype.ph=function(t){return this.Ad(t).next(function(t){return Ei.fromBase64String(t.lastStreamToken)})},Mc.prototype.yh=function(e,n){return this.Ad(e).next(function(t){return t.lastStreamToken=n.toBase64(),Bc(e).put(t)})},Mc.prototype.dh=function(h,c,f,l){var p=this,d=Gc(h),y=jc(h);return y.add({}).next(function(t){mu("number"==typeof t,"Auto-generated key is not a number");for(var e=new _u(t,c,f,l),n=p.serializer.Pd(p.userId,e),r=[],i=new yi(function(t,e){return bu(t.K(),e.K())}),o=0,s=l;o<s.length;o++){var u=s[o],a=vf.key(p.userId,u.key.path,t);i=i.add(u.key.path.L()),r.push(y.put(n)),r.push(d.put(a,vf.PLACEHOLDER))}return i.forEach(function(t){r.push(p.ur.Vd(h,t))}),h.rr(function(){p.Ed[t]=e.keys()}),xu.Ki(r).next(function(){return e})})},Mc.prototype.Ph=function(t,e){var n=this;return jc(t).get(e).next(function(t){return t?(mu(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.gd(t)):null})},Mc.prototype.Th=function(t,n){var r=this;return this.Ed[n]?xu.resolve(this.Ed[n]):this.Ph(t,n).next(function(t){if(t){var e=t.keys();return r.Ed[n]=e}return null})},Mc.prototype.xh=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return jc(t).md({index:yf.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(mu(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.gd(e)),n.done()}).next(function(){return o})},Mc.prototype.gh=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return jc(t).md({index:yf.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Mc.prototype.hh=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return jc(t).ld(yf.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.gd(t)})})},Mc.prototype._r=function(u,a){var h=this,t=vf.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return Gc(u).md({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=Ac(i);if(r===h.userId&&a.path.isEqual(s))return jc(u).get(o).next(function(t){if(!t)throw vu("Dangling document-mutation reference found: "+e+" which points to "+o);mu(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.gd(t))});n.done()}).next(function(){return c})},Mc.prototype.wr=function(r,t){var a=this,h=new yi(bu),i=[];return t.forEach(function(u){var t=vf.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Gc(r).md({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ac(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),xu.Ki(i).next(function(){return a.pd(r,h)})},Mc.prototype.Vr=function(t,e){var u=this,a=e.path,h=a.length+1,n=vf.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new yi(bu);return Gc(t).md({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ac(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.pd(t,c)})},Mc.prototype.pd=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(jc(t).get(e).next(function(t){if(null===t)throw vu("Dangling document-mutation reference found, which points to "+e);mu(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.gd(t))}))}),xu.Ki(i).next(function(){return r})},Mc.prototype.Vh=function(e,n){var r=this;return Fc(e.yd,this.userId,n).next(function(t){return e.rr(function(){r.Xh(n.batchId)}),xu.forEach(t,function(t){return r.Jo.bd(e,t)})})},Mc.prototype.Xh=function(t){delete this.Ed[t]},Mc.prototype.Rh=function(n){var o=this;return this.Rd(n).next(function(t){if(!t)return xu.resolve();var e=IDBKeyRange.lowerBound(vf.prefixForUser(o.userId)),i=[];return Gc(n).md({range:e},function(t,e,n){if(t[0]===o.userId){var r=Ac(t[1]);i.push(r)}else n.done()}).next(function(){mu(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.K()}))})})},Mc.prototype.Mi=function(t,e){return qc(t,this.userId,e)},Mc.prototype.Ad=function(t){var e=this;return Bc(t).get(this.userId).next(function(t){return t||new df(e.userId,-1,"")})},Mc);function Mc(t,e,n,r){this.userId=t,this.serializer=e,this.ur=n,this.Jo=r,this.Ed={}}function qc(t,o,e){var n=vf.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Gc(t).md({range:r,Td:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Fc(t,e,n){var r=t.store(yf.store),i=t.store(vf.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.md({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){mu(1===u,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=vf.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return xu.Ki(o).next(function(){return h})}function jc(t){return Cf.ed(t,yf.store)}function Gc(t){return Cf.ed(t,vf.store)}function Bc(t){return Cf.ed(t,df.store)}var zc=(Kc.prototype.Qh=function(n){var r=this;return this.vd(n).next(function(t){var e=new ec(t.highestTargetId);return t.highestTargetId=e.next(),r.Sd(n,t).next(function(){return t.highestTargetId})})},Kc.prototype.bh=function(t){return this.vd(t).next(function(t){return Br.v(new Gr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Kc.prototype.Dd=function(t){return Hc(t.yd)},Kc.prototype.$h=function(e,n,r){var i=this;return this.vd(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.k()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Sd(e,t)})},Kc.prototype.Wh=function(e,n){var r=this;return this.Cd(e,n).next(function(){return r.vd(e).next(function(t){return t.targetCount+=1,r.kd(n,t),r.Sd(e,t)})})},Kc.prototype.Nh=function(t,e){return this.Cd(t,e)},Kc.prototype.Nd=function(e,t){var n=this;return this.Fd(e,t.targetId).next(function(){return Wc(e).delete(t.targetId)}).next(function(){return n.vd(e)}).next(function(t){return mu(0<t.targetCount,"Removing from an empty target cache"),--t.targetCount,n.Sd(e,t)})},Kc.prototype.xo=function(r,i,o){var s=this,u=0,a=[];return Wc(r).md(function(t,e){var n=s.serializer.$d(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.Nd(r,n)))}).next(function(){return xu.Ki(a)}).next(function(){return u})},Kc.prototype.Xs=function(t,r){var i=this;return Wc(t).md(function(t,e){var n=i.serializer.$d(e);r(n)})},Kc.prototype.vd=function(t){return Yc(t.yd)},Kc.prototype.Sd=function(t,e){return Cf.ed(t,Nf.store).put(Nf.key,e)},Kc.prototype.Cd=function(t,e){return Wc(t).put(this.serializer.Md(e))},Kc.prototype.kd=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Kc.prototype.Ld=function(t){return this.vd(t).next(function(t){return t.targetCount})},Kc.prototype.qh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Wc(t).md({range:n,index:Ef.queryTargetsIndexName},function(t,e,n){var r=o.serializer.$d(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Kc.prototype.Dh=function(n,t,r){var i=this,o=[],s=Xc(n);return t.forEach(function(t){var e=Ec(t.path);o.push(s.put(new If(r,e))),o.push(i.Jo.vi(n,t))}),xu.Ki(o)},Kc.prototype.Sh=function(n,t,r){var i=this,o=Xc(n);return xu.forEach(t,function(t){var e=Ec(t.path);return xu.Ki([o.delete([r,e]),i.Jo.Di(n,t)])})},Kc.prototype.Fd=function(t,e){var n=Xc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Kc.prototype.Gh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Xc(t),o=Ls();return r.md({range:n,Td:!0},function(t,e,n){var r=Ac(t[1]),i=new si(r);o=o.add(i)}).next(function(){return o})},Kc.prototype.Mi=function(t,e){var n=Ec(e.path),r=IDBKeyRange.bound([n],[Eu(n)],!1,!0),i=0;return Xc(t).md({index:If.documentTargetsIndex,Td:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Kc.prototype.un=function(t,e){var n=this;return Wc(t).get(e).next(function(t){return t?n.serializer.$d(t):null})},Kc);function Kc(t,e){this.Jo=t,this.serializer=e}function Wc(t){return Cf.ed(t,Ef.store)}function Yc(t){return _c.ed(t,Nf.store).get(Nf.key).next(function(t){return mu(null!==t,"Missing metadata row."),t})}function Hc(t){return Yc(t).next(function(t){return t.highestListenSequenceNumber})}function Xc(t){return Cf.ed(t,If.store)}var Qc,Jc=($c.prototype.Yi=function(t,e,n){return tf(t).put(ef(e),n)},$c.prototype.Zi=function(t,e){var n=tf(t),r=ef(e);return n.delete(r)},$c.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Od(e,t)})},$c.prototype.tr=function(t,e){var n=this;return tf(t).get(ef(e)).next(function(t){return n.xd(t)})},$c.prototype.Bd=function(t,e){var n=this;return tf(t).get(ef(e)).next(function(t){var e=n.xd(t);return e?{Ud:e,size:nf(t)}:null})},$c.prototype.getEntries=function(t,e){var r=this,i=Ss();return this.qd(t,e,function(t,e){var n=r.xd(e);i=i.it(t,n)}).next(function(){return i})},$c.prototype.Qd=function(t,e){var r=this,i=Ss(),o=new ai(si.F);return this.qd(t,e,function(t,e){var n=r.xd(e);o=n?(i=i.it(t,n),o.it(t,nf(e))):(i=i.it(t,null),o.it(t,0))}).next(function(){return{Wd:i,jd:o}})},$c.prototype.qd=function(t,e,i){if(e.U())return xu.resolve();var n=IDBKeyRange.bound(e.first().path.j(),e.last().path.j()),o=e._t(),s=o.Et();return tf(t).md({range:n},function(t,e,n){for(var r=si.nt(t);s&&si.F(s,r)<0;)i(s,null),s=o.Et();s&&s.isEqual(r)&&(i(s,e),s=o.It()?o.Et():null),s?n.ud(s.path.j()):n.done()}).next(function(){for(;s;)i(s,null),s=o.It()?o.Et():null})},$c.prototype.Er=function(t,i,e){var o=this,s=ks(),u=i.path.length+1,n={};if(e.isEqual(Br.MIN)){var r=i.path.j();n.range=IDBKeyRange.lowerBound(r)}else{var a=i.path.j(),h=this.serializer.Kd(e);n.range=IDBKeyRange.lowerBound([a,h],!0),n.index=bf.collectionReadTimeIndex}return tf(t).md(n,function(t,e,n){if(t.length===u){var r=o.serializer.Gd(e);i.path.q(r.key.path)?r instanceof Oo&&i.matches(r)&&(s=s.it(r.key,r)):n.done()}}).next(function(){return s})},$c.prototype.ea=function(t,e){var r=this,i=_s(),o=this.serializer.Kd(e),n=tf(t),s=IDBKeyRange.lowerBound(o,!0);return n.md({index:bf.readTimeIndex,range:s},function(t,e){var n=r.serializer.Gd(e);i=i.it(n.key,n),o=e.readTime}).next(function(){return{sa:i,readTime:r.serializer.zd(o)}})},$c.prototype.na=function(t){var r=this,e=tf(t),i=Br.MIN;return e.md({index:bf.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.zd(e.readTime)),n.done()}).next(function(){return i})},$c.prototype.wh=function(t){return new $c.Hd(this,!!t&&t.Eh)},$c.prototype.Jd=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},$c.prototype.getMetadata=function(t){return Zc(t).get(Tf.key).next(function(t){return mu(!!t,"Missing document cache metadata"),t})},$c.prototype.Od=function(t,e){return Zc(t).put(Tf.key,e)},$c.prototype.xd=function(t){if(t){var e=this.serializer.Gd(t);return e instanceof Lo&&e.version.isEqual(Br.S())?null:e}return null},$c);function $c(t,e){this.serializer=t,this.ur=e}function Zc(t){return Cf.ed(t,Tf.store)}function tf(t){return Cf.ed(t,bf.store)}function ef(t){return t.path.j()}function nf(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw vu("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}function rf(t,e){var n=this;return(n=Qc.call(this)||this).Yd=t,n.Eh=e,n.Xd=new Au(function(t){return t.toString()}),n}function of(t,e){this.seconds=t,this.nanoseconds=e}Jc.Hd=(n(rf,Qc=Ru),rf.prototype.nr=function(s){var u=this,a=[],h=0,c=new yi(function(t,e){return bu(t.K(),e.K())});return this.zi.forEach(function(t,e){var n=u.Xd.get(t);if(e){var r=u.Yd.serializer.Zd(e,u.readTime);c=c.add(t.path.L());var i=nf(r);h+=i-n,a.push(u.Yd.Yi(s,t,r))}else if(h-=n,u.Eh){var o=u.Yd.serializer.Zd(new Lo(t,Br.S()),u.readTime);a.push(u.Yd.Yi(s,t,o))}else a.push(u.Yd.Zi(s,t))}),c.forEach(function(t){a.push(u.Yd.ur.Vd(s,t))}),a.push(this.Yd.updateMetadata(s,h)),xu.Ki(a)},rf.prototype.er=function(t,e){var n=this;return this.Yd.Bd(t,e).next(function(t){return null===t?(n.Xd.set(e,0),null):(n.Xd.set(e,t.size),t.Ud)})},rf.prototype.sr=function(t,e){var n=this;return this.Yd.Qd(t,e).next(function(t){var e=t.Wd;return t.jd.forEach(function(t,e){n.Xd.set(t,e)}),e})},rf);var sf=(pf.prototype.Vd=function(t,e){return this.tf.add(e),xu.resolve()},pf.prototype.Pr=function(t,e){return xu.resolve(this.tf.getEntries(e))},pf),uf=(lf.prototype.add=function(t){var e=t.B(),n=t.L(),r=this.index[e]||new yi(Zr.F),i=!r.has(n);return this.index[e]=r.add(n),i},lf.prototype.has=function(t){var e=t.B(),n=t.L(),r=this.index[e];return r&&r.has(n)},lf.prototype.getEntries=function(t){return(this.index[t]||new yi(Zr.F)).j()},lf),af=10,hf=(ff.prototype.createOrUpgrade=function(n,r,t,e){var i=this;mu(t<e&&0<=t&&e<=af,"Unexpected schema upgrade from v"+t+" to v"+e+".");var o,s=new Dc(r);t<1&&1<=e&&(n.createObjectStore(cf.store),(o=n).createObjectStore(df.store,{keyPath:df.keyPath}),o.createObjectStore(yf.store,{keyPath:yf.keyPath,autoIncrement:!0}).createIndex(yf.userMutationsIndex,yf.userMutationsKeyPath,{unique:!0}),o.createObjectStore(vf.store),_f(n),n.createObjectStore(bf.store));var u,a=xu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(If.store),u.deleteObjectStore(Ef.store),u.deleteObjectStore(Nf.store),_f(n)),a=a.next(function(){return t=s.store(Nf.store),e=new Nf(0,0,Br.MIN.k(),0),t.put(Nf.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(yf.store).ld().next(function(t){r.deleteObjectStore(yf.store),r.createObjectStore(yf.store,{keyPath:yf.keyPath,autoIncrement:!0}).createIndex(yf.userMutationsIndex,yf.userMutationsKeyPath,{unique:!0});var e=i.store(yf.store),n=t.map(function(t){return e.put(t)});return xu.Ki(n)});var r,i})),a=a.next(function(){n.createObjectStore(Sf.store,{keyPath:Sf.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Tf.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(bf.store)).createIndex(bf.readTimeIndex,bf.readTimeIndexPath,{unique:!1}),t.createIndex(bf.collectionReadTimeIndex,bf.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},ff.prototype.addDocumentGlobal=function(e){var n=0;return e.store(bf.store).md(function(t,e){n+=nf(e)}).next(function(){var t=new Tf(n);return e.store(Tf.store).put(Tf.key,t)})},ff.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(df.store),e=r.store(yf.store);return t.ld().next(function(t){return xu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.ld(yf.userMutationsIndex,t).next(function(t){return xu.forEach(t,function(t){mu(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.gd(t);return Fc(r,n.userId,e).next(function(){})})})})})},ff.prototype.ensureSequenceNumbers=function(t){var s=t.store(If.store),e=t.store(bf.store);return Hc(t).next(function(i){var o=[];return e.md(function(t,e){var n=new Zr(t),r=[0,Ec(n)];o.push(s.get(r).next(function(t){return t?xu.resolve():s.put(new If(0,Ec(n),i))}))}).next(function(){return xu.Ki(o)})})},ff.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.B(),n=t.L();return i.put({collectionId:e,parent:Ec(n)})}}t.createObjectStore(Af.store,{keyPath:Af.keyPath});var i=e.store(Af.store),o=new uf;return e.store(bf.store).md({Td:!0},function(t,e){return r(new Zr(t).L())}).next(function(){return e.store(vf.store).md({Td:!0},function(t,e){t[0];var n=t[1];return r((t[2],Ac(n)).L())})})},ff.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Ef.store);return o.md(function(t,e){var n=i.serializer.$d(e),r=i.serializer.Md(n);return o.put(r)})},ff),cf=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function ff(t){this.serializer=t}function lf(){this.index={}}function pf(){this.tf=new uf}cf.store="owner",cf.key="owner";var df=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};df.store="mutationQueues",df.keyPath="userId";var yf=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};yf.store="mutations",yf.keyPath="batchId",yf.userMutationsIndex="userMutationsIndex",yf.userMutationsKeyPath=["userId","batchId"];var vf=(mf.prefixForUser=function(t){return[t]},mf.prefixForPath=function(t,e){return[t,Ec(e)]},mf.key=function(t,e,n){return[t,Ec(e),n]},mf);function mf(){}function gf(t,e){this.path=t,this.readTime=e}function wf(t,e){this.path=t,this.version=e}vf.store="documentMutations",vf.PLACEHOLDER=new vf;var bf=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};bf.store="remoteDocuments",bf.readTimeIndex="readTimeIndex",bf.readTimeIndexPath="readTime",bf.collectionReadTimeIndex="collectionReadTimeIndex",bf.collectionReadTimeIndexPath=["parentPath","readTime"];var Tf=function(t){this.byteSize=t};Tf.store="remoteDocumentGlobal",Tf.key="remoteDocumentGlobalKey";var Ef=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ef.store="targets",Ef.keyPath="targetId",Ef.queryTargetsIndexName="queryTargetsIndex",Ef.queryTargetsKeyPath=["canonicalId","targetId"];var If=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};If.store="targetDocuments",If.keyPath=["targetId","path"],If.documentTargetsIndex="documentTargetsIndex",If.documentTargetsKeyPath=["path","targetId"];var Nf=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Nf.key="targetGlobalKey",Nf.store="targetGlobal";var Af=function(t,e){this.collectionId=t,this.parent=e};function _f(t){t.createObjectStore(If.store,{keyPath:If.keyPath}).createIndex(If.documentTargetsIndex,If.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ef.store,{keyPath:Ef.keyPath}).createIndex(Ef.queryTargetsIndexName,Ef.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Nf.store)}Af.store="collectionParents",Af.keyPath=["collectionId","parent"];var Sf=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Sf.store="clientMetadata",Sf.keyPath="clientId";var Df=i(i(i([df.store,yf.store,vf.store,bf.store,Ef.store,cf.store,Nf.store,If.store],[Sf.store]),[Tf.store]),[Af.store]),kf=(xf.prototype.Vd=function(t,e){var n=this;if(this.ef.has(e))return xu.resolve();var r=e.B(),i=e.L();t.rr(function(){n.ef.add(e)});var o={collectionId:r,parent:Ec(i)};return Rf(t).put(o)},xf.prototype.Pr=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Eu(i),""],!1,!0);return Rf(t).ld(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ac(r.parent))}return o})},xf);function xf(){this.ef=new uf}function Rf(t){return Cf.ed(t,Af.store)}var Of,Lf=(qf.prototype.Gd=function(t){if(t.document)return this.sf.vn(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=si.nt(t.noDocument.path),n=this.nf(t.noDocument.readTime);return new Lo(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=si.nt(t.unknownDocument.path),i=this.nf(t.unknownDocument.version);return new Po(r,i)}return vu("Unexpected DbRemoteDocument")},qf.prototype.Zd=function(t,e){var n=this.Kd(e),r=t.key.path.L().j();if(t instanceof Oo){var i=this.sf.bn(t),o=t.hasCommittedMutations;return new bf(null,null,i,o,n,r)}if(t instanceof Lo){var s=t.key.path.j(),u=this.if(t.version),a=t.hasCommittedMutations;return new bf(null,new gf(s,u),null,a,n,r)}if(t instanceof Po){var h=t.key.path.j(),c=this.if(t.version);return new bf(new wf(h,c),null,null,!0,n,r)}return vu("Unexpected MaybeDocument")},qf.prototype.Kd=function(t){var e=t.k();return[e.seconds,e.nanoseconds]},qf.prototype.zd=function(t){var e=new Gr(t[0],t[1]);return Br.v(e)},qf.prototype.if=function(t){var e=t.k();return new of(e.seconds,e.nanoseconds)},qf.prototype.nf=function(t){var e=new Gr(t.seconds,t.nanoseconds);return Br.v(e)},qf.prototype.Pd=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.sf.$n(t)}),i=e.mutations.map(function(t){return n.sf.$n(t)});return new yf(t,e.batchId,e.Ri.toMillis(),r,i)},qf.prototype.gd=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.sf.xn(t)}),r=t.mutations.map(function(t){return e.sf.xn(t)}),i=Gr.fromMillis(t.localWriteTimeMs);return new _u(t.batchId,i,n,r)},qf.prototype.$d=function(t){var e,n=this.nf(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.nf(t.lastLimboFreeSnapshotVersion):Br.MIN;return e=void 0!==t.query.documents?this.sf.Kn(t.query):this.sf.Yn(t.query),new ws(e,t.targetId,0,t.lastListenSequenceNumber,n,r,Ei.fromBase64String(t.resumeToken))},qf.prototype.Md=function(t){var e,n=this.if(t.ts),r=this.if(t.lastLimboFreeSnapshotVersion);e=t.target.Pe()?this.sf.jn(t.target):this.sf.Gn(t.target);var i=t.resumeToken.toBase64();return new Ef(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},qf),Pf="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Uf=(n(Mf,Of=Lu),Mf),Cf=(Vf.ed=function(t,e){if(t instanceof Uf)return _c.ed(t.yd,e);throw vu("IndexedDbPersistence must use instances of IndexedDbTransaction")},Vf.mf=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:if(!Vf.Uc())throw new Vr(Cr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Vf(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.wf,n.$a,n.serializer,n.rf)).start()];case 1:return[2,(t.sent(),e)]}})})},Vf.prototype.start=function(){var e=this;return _c.Yl(this.df,af,new hf(this.serializer)).then(function(t){return e.Ef=t,e.If()}).then(function(){return e.Rf(),e.Af(),e.Pf(),e.Ef.runTransaction("readonly",[Nf.store],function(t){return Hc(t)})}).then(function(t){e.Vf=new Cu(t,e.rf)}).then(function(){e.hf=!0}).catch(function(t){return e.Ef&&e.Ef.close(),Promise.reject(t)})},Vf.prototype.gf=function(n){var t=this;return this.lf=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.ko?[2,n(e)]:[2]})})},n(this.isPrimary)},Vf.prototype.pf=function(n){var t=this;this.Ef.sd(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Vf.prototype.Zh=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.$a.qr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ko?[4,this.If()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Vf.prototype.If=function(){var n=this;return this.Ef.runTransaction("readwrite",Df,function(e){return jf(e).put(new Sf(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.yf(e).next(function(t){t||(n.isPrimary=!1,n.$a.qr(function(){return n.lf(!1)}))})}).next(function(){return n.bf(e)}).next(function(t){return n.isPrimary&&!t?n.vf(e).next(function(){return!1}):!!t&&n.Sf(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return pu("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.$a.qr(function(){return n.lf(t)}),n.isPrimary=t})},Vf.prototype.yf=function(t){var e=this;return Ff(t).get(cf.key).next(function(t){return xu.resolve(e.Df(t))})},Vf.prototype.Cf=function(t){return jf(t).delete(this.clientId)},Vf.prototype.kf=function(){return y(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Nf(this._f,18e5)?[3,2]:(this._f=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Vf.ed(t,Sf.store);return r.ld().next(function(t){var e=i.Ff(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return xu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.$f(t.clientId))}),t.label=2;case 2:return[2]}})})},Vf.prototype.Pf=function(){var t=this;this.cf=this.$a.eo("client_metadata_refresh",4e3,function(){return t.If().then(function(){return t.kf()}).then(function(){return t.Pf()})})},Vf.prototype.Df=function(t){return!!t&&t.ownerId===this.clientId},Vf.prototype.bf=function(e){var i=this;return Ff(e).get(cf.key).next(function(t){if(null!==t&&i.Nf(t.leaseTimestampMs,5e3)&&!i.Mf(t.ownerId)){if(i.Df(t)&&i.networkEnabled)return!0;if(!i.Df(t)){if(!t.allowTabSynchronization)throw new Vr(Cr.FAILED_PRECONDITION,Pf);return!1}}return!(!i.networkEnabled||!i.inForeground)||jf(e).ld().next(function(t){return void 0===i.Ff(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&pu("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Vf.prototype.lc=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.hf=!1,this.Lf(),this.cf&&(this.cf.cancel(),this.cf=null),this.Of(),this.xf(),[4,this.Ef.runTransaction("readwrite",[cf.store,Sf.store],function(t){return e.vf(t).next(function(){return e.Cf(t)})})];case 1:return t.sent(),this.Ef.close(),this.Bf(),[2]}})})},Vf.prototype.Ff=function(t,e){var n=this;return t.filter(function(t){return n.Nf(t.updateTimeMs,e)&&!n.Mf(t.clientId)})},Vf.prototype.Jh=function(){var e=this;return this.Ef.runTransaction("readonly",[Sf.store],function(t){return jf(t).ld().next(function(t){return e.Ff(t,18e5).map(function(t){return t.clientId})})})},Vf.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Vf.Uc()?(e=n+Vf.ff,[4,_c.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Vf.prototype,"ko",{get:function(){return this.hf},enumerable:!0,configurable:!0}),Vf.prototype.Yo=function(t){return Vc.Id(t,this.serializer,this.ur,this.Jo)},Vf.prototype.eh=function(){return this.th},Vf.prototype.Zo=function(){return this.hr},Vf.prototype.nh=function(){return this.ur},Vf.prototype.runTransaction=function(n,t,r){var i=this;pu("IndexedDbPersistence","Starting transaction:",n);var o,e="readonly"===t?"readonly":"readwrite";return this.Ef.runTransaction(e,Df,function(e){return o=new Uf(e,i.Vf.next()),"readwrite-primary"===t?i.yf(e).next(function(t){return!!t||i.bf(e)}).next(function(t){if(!t)throw du("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.$a.qr(function(){return i.lf(!1)}),new Vr(Cr.FAILED_PRECONDITION,Ou);return r(o)}).next(function(t){return i.Sf(e).next(function(){return t})}):i.Uf(e).next(function(){return r(o)})}).then(function(t){return o.or(),t})},Vf.prototype.Uf=function(t){var e=this;return Ff(t).get(cf.key).next(function(t){if(null!==t&&e.Nf(t.leaseTimestampMs,5e3)&&!e.Mf(t.ownerId)&&!e.Df(t)&&!t.allowTabSynchronization)throw new Vr(Cr.FAILED_PRECONDITION,Pf)})},Vf.prototype.Sf=function(t){var e=new cf(this.clientId,this.allowTabSynchronization,Date.now());return Ff(t).put(cf.key,e)},Vf.Uc=function(){return _c.Uc()},Vf.qf=function(t){var e=t.cn.projectId;return t.cn.wi||(e+="."+t.cn.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Vf.prototype.vf=function(t){var e=this,n=Ff(t);return n.get(cf.key).next(function(t){return e.Df(t)?(pu("IndexedDbPersistence","Releasing primary lease."),n.delete(cf.key)):xu.resolve()})},Vf.prototype.Nf=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(du("Detected an update time that is in the future: "+t+" > "+n),1))},Vf.prototype.Rf=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.uf=function(){t.$a.qr(function(){return t.inForeground="visible"===t.document.visibilityState,t.If()})},this.document.addEventListener("visibilitychange",this.uf),this.inForeground="visible"===this.document.visibilityState)},Vf.prototype.Of=function(){this.uf&&(this.document.removeEventListener("visibilitychange",this.uf),this.uf=null)},Vf.prototype.Af=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.af=function(){t.Lf(),t.$a.qr(function(){return t.lc()})},this.window.addEventListener("unload",this.af))},Vf.prototype.xf=function(){this.af&&(this.window.removeEventListener("unload",this.af),this.af=null)},Vf.prototype.Mf=function(t){try{var e=null!==this.Tf.getItem(this.$f(t));return pu("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return du("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Vf.prototype.Lf=function(){try{this.Tf.setItem(this.$f(this.clientId),String(Date.now()))}catch(t){du("Failed to set zombie client id.",t)}},Vf.prototype.Bf=function(){try{this.Tf.removeItem(this.$f(this.clientId))}catch(t){}},Vf.prototype.$f=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Vf);function Vf(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.$a=o,this.rf=u,this.hf=!1,this.isPrimary=!1,this.networkEnabled=!0,this.af=null,this.inForeground=!1,this.uf=null,this.cf=null,this._f=Number.NEGATIVE_INFINITY,this.lf=function(t){return Promise.resolve()},this.Jo=new Gf(this,i),this.df=e+Vf.ff,this.serializer=new Lf(s),this.document=r.document,this.th=new zc(this.Jo,this.serializer),this.ur=new kf,this.hr=new Jc(this.serializer,this.ur),!r.window||!r.window.localStorage)throw new Vr(Cr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Tf=this.window.localStorage}function Mf(t,e){var n=this;return(n=Of.call(this)||this).yd=t,n.Ch=e,n}function qf(t){this.sf=t}function Ff(t){return t.store(cf.store)}function jf(t){return t.store(Sf.store)}Cf.ff="main";var Gf=(Bf.prototype.Mo=function(t){var n=this.Wf(t);return this.db.eh().Ld(t).next(function(e){return n.next(function(t){return e+t})})},Bf.prototype.Wf=function(t){var e=0;return this.Oo(t,function(t){e++}).next(function(){return e})},Bf.prototype.Xs=function(t,e){return this.db.eh().Xs(t,e)},Bf.prototype.Oo=function(t,n){return this.jf(t,function(t,e){return n(e)})},Bf.prototype.Ho=function(t){this.Qf=t},Bf.prototype.vi=function(t,e){return zf(t,e)},Bf.prototype.Di=function(t,e){return zf(t,e)},Bf.prototype.xo=function(t,e,n){return this.db.eh().xo(t,e,n)},Bf.prototype.bd=function(t,e){return zf(t,e)},Bf.prototype.Kf=function(t,e){return this.Qf.Mi(e)?xu.resolve(!0):(r=e,i=!1,Bc(n=t).wd(function(t){return qc(n,t,r).next(function(t){return t&&(i=!0),xu.resolve(!t)})}).next(function(){return i}));var n,r,i},Bf.prototype.Bo=function(r,i){var o=this,s=this.db.Zo().wh(),u=[],a=0;return this.jf(r,function(e,t){if(t<=i){var n=o.Kf(r,e).next(function(t){if(!t)return a++,s.tr(r,e).next(function(){return s.Zi(e),Xc(r).delete([0,Ec(e.path)])})});u.push(n)}}).next(function(){return xu.Ki(u)}).next(function(){return s.apply(r)}).next(function(){return a})},Bf.prototype.removeTarget=function(t,e){var n=e.es(t.Ch);return this.db.eh().Nh(t,n)},Bf.prototype.Fh=function(t,e){return zf(t,e)},Bf.prototype.jf=function(t,o){var s,e=Xc(t),u=Cu.kr;return e.md({index:If.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==Cu.kr&&o(new si(Ac(s)),u),u=i,s=r):u=Cu.kr}).next(function(){u!==Cu.kr&&o(new si(Ac(s)),u)})},Bf.prototype.qo=function(t){return this.db.Zo().Jd(t)},Bf);function Bf(t,e){this.db=t,this.Qf=null,this.bo=new ua(this,e)}function zf(t,e){return Xc(t).put((n=t.Ch,new If(0,Ec(e.path),n)));var n}var Kf,Wf=(Xf.prototype.Rd=function(t){return xu.resolve(0===this.ar.length)},Xf.prototype.mh=function(t,e,n){var r=e.batchId,i=this.Hf(r,"acknowledged");return mu(0===i,"Can only acknowledge the first batch in the mutation queue"),this.ar[i],this.lastStreamToken=n,xu.resolve()},Xf.prototype.ph=function(t){return xu.resolve(this.lastStreamToken)},Xf.prototype.yh=function(t,e){return this.lastStreamToken=e,xu.resolve()},Xf.prototype.dh=function(t,e,n,r){var i=this.Gf;this.Gf++,0<this.ar.length&&this.ar[this.ar.length-1];var o=new _u(i,e,n,r);this.ar.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.zf=this.zf.add(new ku(a.key,i)),this.ur.Vd(t,a.key.path.L())}return xu.resolve(o)},Xf.prototype.Ph=function(t,e){return xu.resolve(this.Jf(e))},Xf.prototype.Th=function(t,e){var n=this.Jf(e);return xu.resolve(n.keys())},Xf.prototype.xh=function(t,e){var n=e+1,r=this.Yf(n),i=r<0?0:r;return xu.resolve(this.ar.length>i?this.ar[i]:null)},Xf.prototype.gh=function(){return xu.resolve(0===this.ar.length?-1:this.Gf-1)},Xf.prototype.hh=function(t){return xu.resolve(this.ar.slice())},Xf.prototype._r=function(t,e){var n=this,r=new ku(e,0),i=new ku(e,Number.POSITIVE_INFINITY),o=[];return this.zf.Ct([r,i],function(t){var e=n.Jf(t.Li);o.push(e)}),xu.resolve(o)},Xf.prototype.wr=function(t,e){var r=this,i=new yi(bu);return e.forEach(function(t){var e=new ku(t,0),n=new ku(t,Number.POSITIVE_INFINITY);r.zf.Ct([e,n],function(t){i=i.add(t.Li)})}),xu.resolve(this.Xf(i))},Xf.prototype.Vr=function(t,e){var n=e.path,r=n.length+1,i=n;si.st(i)||(i=i.child(""));var o=new ku(new si(i),0),s=new yi(bu);return this.zf.kt(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.Li)),!0)},o),xu.resolve(this.Xf(s))},Xf.prototype.Xf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Jf(t);null!==e&&r.push(e)}),r},Xf.prototype.Vh=function(n,r){var i=this;mu(0===this.Hf(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.ar.shift();var o=this.zf;return xu.forEach(r.mutations,function(t){var e=new ku(t.key,r.batchId);return o=o.delete(e),i.Jo.bd(n,t.key)}).next(function(){i.zf=o})},Xf.prototype.Xh=function(t){},Xf.prototype.Mi=function(t,e){var n=new ku(e,0),r=this.zf.Nt(n);return xu.resolve(e.isEqual(r&&r.key))},Xf.prototype.Rh=function(t){return this.ar.length,xu.resolve()},Xf.prototype.Hf=function(t,e){return this.Yf(t)},Xf.prototype.Yf=function(t){return 0===this.ar.length?0:t-this.ar[0].batchId},Xf.prototype.Jf=function(t){var e=this.Yf(t);return e<0||e>=this.ar.length?null:this.ar[e]},Xf),Yf=(Hf.prototype.Yi=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Zf(e);return this.docs=this.docs.it(r,{Ud:e,size:s,readTime:n}),this.size+=s-o,this.ur.Vd(t,r.path.L())},Hf.prototype.Zi=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Hf.prototype.tr=function(t,e){var n=this.docs.get(e);return xu.resolve(n?n.Ud:null)},Hf.prototype.getEntries=function(t,e){var n=this,r=Ss();return e.forEach(function(t){var e=n.docs.get(t);r=r.it(t,e?e.Ud:null)}),xu.resolve(r)},Hf.prototype.Er=function(t,e,n){for(var r=ks(),i=new si(e.path.child("")),o=this.docs.lt(i);o.It();){var s=o.Et(),u=s.key,a=s.value,h=a.Ud,c=a.readTime;if(!e.path.q(u.path))break;c.D(n)<=0||h instanceof Oo&&e.matches(h)&&(r=r.it(h.key,h))}return xu.resolve(r)},Hf.prototype.tT=function(t,e){return xu.forEach(this.docs,function(t){return e(t)})},Hf.prototype.ea=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},Hf.prototype.na=function(t){return xu.resolve(Br.MIN)},Hf.prototype.wh=function(t){return new Hf.Hd(this)},Hf.prototype.Jd=function(t){return xu.resolve(this.size)},Hf);function Hf(t,e){this.ur=t,this.Zf=e,this.docs=new ai(si.F),this.size=0}function Xf(t,e){this.ur=t,this.Jo=e,this.ar=[],this.Gf=1,this.lastStreamToken=Ei.xt,this.zf=new yi(ku.we)}function Qf(t){var e=this;return(e=Kf.call(this)||this).Yd=t,e}Yf.Hd=(n(Qf,Kf=Ru),Qf.prototype.nr=function(n){var r=this,i=[];return this.zi.forEach(function(t,e){e?i.push(r.Yd.Yi(n,e,r.readTime)):r.Yd.Zi(t)}),xu.Ki(i)},Qf.prototype.er=function(t,e){return this.Yd.tr(t,e)},Qf.prototype.sr=function(t,e){return this.Yd.getEntries(t,e)},Qf);var Jf,$f=(dl.prototype.Xs=function(t,n){return this.eT.forEach(function(t,e){return n(e)}),xu.resolve()},dl.prototype.bh=function(t){return xu.resolve(this.lastRemoteSnapshotVersion)},dl.prototype.Dd=function(t){return xu.resolve(this.sT)},dl.prototype.Qh=function(t){return this.highestTargetId=this.iT.next(),xu.resolve(this.highestTargetId)},dl.prototype.$h=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.sT&&(this.sT=e),xu.resolve()},dl.prototype.Cd=function(t){this.eT.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.iT=new ec(e),this.highestTargetId=e),t.sequenceNumber>this.sT&&(this.sT=t.sequenceNumber)},dl.prototype.Wh=function(t,e){return this.Cd(e),this.targetCount+=1,xu.resolve()},dl.prototype.Nh=function(t,e){return this.Cd(e),xu.resolve()},dl.prototype.Nd=function(t,e){return this.eT.delete(e.target),this.nT.Ni(e.targetId),--this.targetCount,xu.resolve()},dl.prototype.xo=function(n,r,i){var o=this,s=0,u=[];return this.eT.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.eT.delete(t),u.push(o.Fd(n,e.targetId)),s++)}),xu.Ki(u).next(function(){return s})},dl.prototype.Ld=function(t){return xu.resolve(this.targetCount)},dl.prototype.qh=function(t,e){var n=this.eT.get(e)||null;return xu.resolve(n)},dl.prototype.un=function(t,e){return vu("Not yet implemented.")},dl.prototype.Dh=function(e,t,n){this.nT.Si(t,n);var r=this.persistence.Jo,i=[];return r&&t.forEach(function(t){i.push(r.vi(e,t))}),xu.Ki(i)},dl.prototype.Sh=function(e,t,n){this.nT.ki(t,n);var r=this.persistence.Jo,i=[];return r&&t.forEach(function(t){i.push(r.Di(e,t))}),xu.Ki(i)},dl.prototype.Fd=function(t,e){return this.nT.Ni(e),xu.resolve()},dl.prototype.Gh=function(t,e){var n=this.nT.$i(e);return xu.resolve(n)},dl.prototype.Mi=function(t,e){return xu.resolve(this.nT.Mi(e))},dl),Zf=(pl.prototype.lc=function(){return this.hf=!1,Promise.resolve()},Object.defineProperty(pl.prototype,"ko",{get:function(){return this.hf},enumerable:!0,configurable:!0}),pl.prototype.Jh=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,[this.clientId]]})})},pl.prototype.gf=function(t){return t(!0)},pl.prototype.pf=function(){},pl.prototype.Zh=function(t){},pl.prototype.nh=function(){return this.ur},pl.prototype.Yo=function(t){var e=this.rT[t.s()];return e||(e=new Wf(this.ur,this.Jo),this.rT[t.s()]=e),e},pl.prototype.eh=function(){return this.th},pl.prototype.Zo=function(){return this.hr},pl.prototype.runTransaction=function(t,e,n){var r=this;pu("MemoryPersistence","Starting transaction:",t);var i=new tl(this.Vf.next());return this.Jo.hT(),n(i).next(function(t){return r.Jo.aT(i).next(function(){return t})}).Wi().then(function(t){return i.or(),t})},pl.prototype.uT=function(e,n){return xu.Gi(Object.values(this.rT).map(function(t){return function(){return t.Mi(e,n)}}))},pl),tl=(n(ll,Jf=Lu),ll),el=(fl._T=function(t){return new fl(t)},Object.defineProperty(fl.prototype,"lT",{get:function(){if(this.cT)return this.cT;throw vu("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),fl.prototype.Ho=function(t){this.Qf=t},fl.prototype.vi=function(t,e){return this.lT.delete(e),xu.resolve()},fl.prototype.Di=function(t,e){return this.lT.add(e),xu.resolve()},fl.prototype.bd=function(t,e){return this.lT.add(e),xu.resolve()},fl.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.eh();return r.Gh(t,e.targetId).next(function(t){t.forEach(function(t){return n.lT.add(t)})}).next(function(){return r.Nd(t,e)})},fl.prototype.hT=function(){this.cT=new Set},fl.prototype.aT=function(t){var n=this,r=this.persistence.Zo().wh();return xu.forEach(this.lT,function(e){return n.dT(t,e).next(function(t){t||r.Zi(e)})}).next(function(){return n.cT=null,r.apply(t)})},fl.prototype.Fh=function(t,e){var n=this;return this.dT(t,e).next(function(t){t?n.lT.delete(e):n.lT.add(e)})},fl.prototype.oT=function(t){return 0},fl.prototype.dT=function(t,e){var n=this;return xu.Gi([function(){return n.persistence.eh().Mi(t,e)},function(){return n.persistence.uT(t,e)},function(){return xu.resolve(n.Qf.Mi(e))}])},fl),nl=(cl.prototype.initialize=function(s,u,a,h,c,f,l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:if(e=Cf.qf(u),n=a.fT(u.cn),!Zh.Uc(a))throw new Vr(Cr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return this.X_=p.synchronizeTabs?new Zh(s,a,e,c,f):new tc,this.X_.$u=function(t){return o.mc.B_(t,1)},r=this,[4,Cf.mf({allowTabSynchronization:p.synchronizeTabs,persistenceKey:e,clientId:c,platform:a,$a:s,serializer:n,wf:ra.Io(p.cacheSizeBytes),rf:this.X_})];case 1:return r.persistence=t.sent(),i=this.persistence.Jo.bo,this.TT=new sa(i,s),this.Wu=new aa(this.persistence,new uc,f),this.W_=new Rh(this.Wu,h,s,function(t){return o.mc.B_(t,0)},a.mT()),this.mc=new ic(this.Wu,this.W_,this.X_,f,l),this.wT=new oc(this.mc),this.W_.mc=this.mc,this.X_.mc=this.mc,[4,this.X_.start()];case 2:return t.sent(),[4,this.W_.start()];case 3:return t.sent(),[4,this.Wu.start()];case 4:return t.sent(),[4,this.persistence.gf(function(e){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.mc.Cc(e)];case 1:return t.sent(),e&&!this.TT.ko?this.TT.start(this.Wu):e||this.TT.stop(),[2]}})})})];case 5:return t.sent(),[2]}})})},cl.prototype.clearPersistence=function(t){var e=Cf.qf(t);return Cf.clearPersistence(e)},cl),rl="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",il=(hl.prototype.initialize=function(n,t,r,i,o,s,u,a){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(a.IT)throw new Vr(Cr.FAILED_PRECONDITION,rl);return this.persistence=new Zf(o,this.ET),this.TT=null,this.X_=new tc,this.Wu=new aa(this.persistence,new uc,s),this.W_=new Rh(this.Wu,i,n,function(t){return e.mc.B_(t,0)},r.mT()),this.mc=new ic(this.Wu,this.W_,this.X_,s,u),this.wT=new oc(this.mc),this.W_.mc=this.mc,[4,this.W_.start()];case 1:return t.sent(),[4,this.W_.Cc(!0)];case 2:return t.sent(),[4,this.mc.Cc(!0)];case 3:return t.sent(),[2]}})})},hl.prototype.clearPersistence=function(){throw new Vr(Cr.FAILED_PRECONDITION,rl)},hl),ol=(al.prototype.start=function(e,n){var r=this;this.AT();var i=new Xu,o=new Xu,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,pu("FirestoreClient","Initializing. user=",t.uid),r.PT(e,n,t,o).then(i.resolve,i.reject);r.Nr.qr(function(){return r.Dc(t)})}),this.Nr.qr(function(){return i.promise}),o.promise},al.prototype.enableNetwork=function(){var t=this;return this.AT(),this.Nr.enqueue(function(){return t.mc.enableNetwork()})},al.prototype.PT=function(s,u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.VT(this.RT)];case 1:return e=t.sent(),n=this.platform.fT(this.RT.cn),r=new Dh(this.Nr,e,this.credentials,n),[4,s.initialize(this.Nr,this.RT,this.platform,r,this.clientId,a,100,u)];case 2:return t.sent(),this.persistence=s.persistence,this.X_=s.X_,this.Wu=s.Wu,this.W_=s.W_,this.mc=s.mc,this.TT=s.TT,this.gT=s.wT,this.persistence.pf(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),h.resolve(),[3,4];case 3:if(i=t.sent(),h.reject(i),!this.pT(i))throw i;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),this.PT(new il,{IT:!1},a,h))];case 4:return[2]}})})},al.prototype.pT=function(t){return"FirebaseError"===t.name?t.code===Cr.FAILED_PRECONDITION||t.code===Cr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},al.prototype.AT=function(){if(this.Nr.Hr)throw new Vr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")},al.prototype.Dc=function(t){return this.Nr.no(),pu("FirestoreClient","Credential Changed. Current user: "+t.uid),this.mc.Dc(t)},al.prototype.disableNetwork=function(){var t=this;return this.AT(),this.Nr.enqueue(function(){return t.mc.disableNetwork()})},al.prototype.terminate=function(){var t=this;return this.Nr.to(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.TT&&this.TT.stop(),[4,this.W_.lc()];case 1:return t.sent(),[4,this.X_.lc()];case 2:return t.sent(),[4,this.persistence.lc()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},al.prototype.waitForPendingWrites=function(){var t=this;this.AT();var e=new Xu;return this.Nr.qr(function(){return t.mc.Pl(e)}),e.promise},al.prototype.listen=function(t,e,n){var r=this;this.AT();var i=new sc(t,e,n);return this.Nr.qr(function(){return r.gT.listen(i)}),i},al.prototype.fc=function(t){var e=this;this.yT||this.Nr.qr(function(){return e.gT.fc(t)})},al.prototype.bT=function(t){var e=this;return this.AT(),this.Nr.enqueue(function(){return e.Wu.Bh(t)}).then(function(t){if(t instanceof Oo)return t;if(t instanceof Lo)return null;throw new Vr(Cr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},al.prototype.vT=function(i){var t=this;return this.AT(),this.Nr.enqueue(function(){return y(t,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.Wu.Kh(i,!0)];case 1:return e=t.sent(),n=new nc(i,e.zh),r=n.k_(e.documents),[2,n.nr(r,!1).snapshot]}})})})},al.prototype.write=function(t){var e=this;this.AT();var n=new Xu;return this.Nr.qr(function(){return e.mc.write(t,n)}),n.promise},al.prototype.cn=function(){return this.RT.cn},al.prototype.Ol=function(t){var e=this;this.AT(),this.Nr.qr(function(){return e.gT.Ol(t),Promise.resolve()})},al.prototype.xl=function(t){this.yT||this.gT.xl(t)},Object.defineProperty(al.prototype,"yT",{get:function(){return this.Nr.Hr},enumerable:!0,configurable:!0}),al.prototype.transaction=function(t){var e=this;this.AT();var n=new Xu;return this.Nr.qr(function(){return e.mc.runTransaction(e.Nr,t,n),Promise.resolve()}),n.promise},al),sl=(ul.prototype.next=function(t){this.ST(this.observer.next,t)},ul.prototype.error=function(t){this.ST(this.observer.error,t)},ul.prototype.DT=function(){this.muted=!0},ul.prototype.ST=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},ul);function ul(t){this.observer=t,this.muted=!1}function al(t,e,n,r){this.platform=t,this.RT=e,this.credentials=n,this.Nr=r,this.clientId=gu.mi()}function hl(t){void 0===t&&(t=el._T),this.ET=t}function cl(){}function fl(t){this.persistence=t,this.Qf=null,this.cT=null}function ll(t){var e=this;return(e=Jf.call(this)||this).Ch=t,e}function pl(t,e){var n=this;this.clientId=t,this.rT={},this.Vf=new Cu(0),this.hf=!1,this.hf=!0,this.Jo=e(this),this.th=new $f(this),this.ur=new sf,this.hr=new Yf(this.ur,function(t){return n.Jo.oT(t)})}function dl(t){this.persistence=t,this.eT=new Au(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Br.MIN,this.highestTargetId=0,this.sT=0,this.nT=new Du,this.targetCount=0,this.iT=ec.p_()}function yl(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var vl,ml,gl=(Gl.prototype.kT=function(t){switch(xi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Vi(t.integerValue||t.doubleValue);case 3:return this.NT(t.timestampValue);case 4:return this.FT(t);case 5:return t.stringValue;case 6:return new Pa(Mi(t.bytesValue));case 7:return this.$T(t.referenceValue);case 8:return new eh(t.geoPointValue.latitude,t.geoPointValue.longitude);case 9:return this.MT(t.arrayValue);case 10:return this.LT(t.mapValue);default:throw vu("Invalid value type: "+JSON.stringify(t))}},Gl.prototype.LT=function(t){var n=this,r={};return bi(t.fields||{},function(t,e){r[t]=n.kT(e)}),r},Gl.prototype.MT=function(t){var e=this;return(t.values||[]).map(function(t){return e.kT(t)})},Gl.prototype.FT=function(t){switch(this.CT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Si(n)?t(n):n}(t);return null==e?null:this.kT(e);case"estimate":return this.NT(Di(t));default:return null}},Gl.prototype.NT=function(t){var e=Ci(t),n=new Gr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Gl.prototype.$T=function(t){var e=Zr.G(t);mu(uu(e),"ReferenceValue is not valid "+t);var n=new Nu(e.get(1),e.get(3)),r=new si(e.M(5));return n.isEqual(this.firestore.OT)||du("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.OT.projectId+"/"+this.firestore.OT.database+") instead."),new Nl(r,this.firestore,this.converter)},Gl),wl=ra.Po,bl=(jl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},jl),Tl=(Fl.prototype.settings=function(t){da("Firestore.settings",arguments,1),ma("Firestore.settings","object",1,t);var e=new bl(t);if(this.qT&&!this.GT.isEqual(e))throw new Vr(Cr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.GT=e).credentials&&(this.jT=function(t){if(!t)return new Mr;switch(t.type){case"gapi":var e=t.JT;return mu(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new jr(e,t.V||"0");case"provider":return t.JT;default:throw new Vr(Cr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Fl.prototype.enableNetwork=function(){return this.UT(),this.qT.enableNetwork()},Fl.prototype.disableNetwork=function(){return this.UT(),this.qT.disableNetwork()},Fl.prototype.enablePersistence=function(t){var e,n;if(this.qT)throw new Vr(Cr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&du("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.YT(this.KT,{IT:!0,cacheSizeBytes:this.GT.cacheSizeBytes,synchronizeTabs:r})},Fl.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.qT&&!this.qT.yT)throw new Vr(Cr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new Xu,[2,(this.BT.Jr(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.XT(),[4,this.KT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},Fl.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Fl.prototype,"ZT",{get:function(){return this.UT(),this.qT.yT},enumerable:!0,configurable:!0}),Fl.prototype.waitForPendingWrites=function(){return this.UT(),this.qT.waitForPendingWrites()},Fl.prototype.onSnapshotsInSync=function(t){if(this.UT(),yl(t))return this.tm(t);ma("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.tm(e)},Fl.prototype.tm=function(t){var e=this,n=new sl({next:function(){t.next&&t.next()},error:function(t){throw vu("Uncaught Error in onSnapshotsInSync")}});return this.qT.Ol(n),function(){n.DT(),e.qT.xl(n)}},Fl.prototype.UT=function(){return this.qT||this.YT(new il,{IT:!1}),this.qT},Fl.prototype.XT=function(){return new Iu(this.OT,this.WT,this.GT.host,this.GT.ssl,this.GT.forceLongPolling)},Fl.prototype.YT=function(t,e){var n=this.XT();return this.qT=new ol(au.Lt(),n,this.jT,this.BT),this.qT.start(t,e)},Fl.prototype.HT=function(r){var t=new ou(r,{dn:au.Lt().dn});return new dh(t,function(t){if(t instanceof Nl){var e=r,n=t.firestore.OT;if(!n.isEqual(e))throw new Vr(Cr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new ph(r,t.em)}return t})},Fl.QT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Vr(Cr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Vr(Cr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Nu(n)},Object.defineProperty(Fl.prototype,"app",{get:function(){if(!this.xT)throw new Vr(Cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.xT},enumerable:!0,configurable:!0}),Fl.prototype.collection=function(t){return da("Firestore.collection",arguments,1),ma("Firestore.collection","non-empty string",1,t),this.UT(),new xl(Zr.G(t),this)},Fl.prototype.doc=function(t){return da("Firestore.doc",arguments,1),ma("Firestore.doc","non-empty string",1,t),this.UT(),Nl.sm(Zr.G(t),this)},Fl.prototype.collectionGroup=function(t){if(da("Firestore.collectionGroup",arguments,1),ma("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.UT(),new Dl(new Co(Zr.H,t),this)},Fl.prototype.runTransaction=function(e){var n=this;return da("Firestore.runTransaction",arguments,1),ma("Firestore.runTransaction","function",1,e),this.UT().transaction(function(t){return e(new El(n,t))})},Fl.prototype.batch=function(){return this.UT(),new Il(this)},Object.defineProperty(Fl,"logLevel",{get:function(){switch(fu()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),Fl.setLogLevel=function(t){switch(da("Firestore.setLogLevel",arguments,1),ma("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":lu(l.DEBUG);break;case"error":lu(l.ERROR);break;case"silent":lu(l.SILENT);break;default:throw new Vr(Cr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Fl.prototype.nm=function(){return this.GT.timestampsInSnapshots},Fl),El=(ql.prototype.get=function(t){var n=this;da("Transaction.get",arguments,1);var r=Wl("Transaction.get",t,this.im);return this.rm.pu([r.em]).then(function(t){if(!t||1!==t.length)return vu("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Lo)return new _l(n.im,r.em,null,!1,!1,r.om);if(e instanceof Oo)return new _l(n.im,r.em,e,!1,!1,r.om);throw vu("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},ql.prototype.set=function(t,e,n){va("Transaction.set",arguments,2,3);var r=Wl("Transaction.set",t,this.im);n=Bl("Transaction.set",n);var i=Yl(r.om,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.im.zT.pa(s,o,n.mergeFields):this.im.zT.Va(s,o);return this.rm.set(r.em,u),this},ql.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Ca?(ya("Transaction.update",arguments,3),r=Wl("Transaction.update",t,this.im),this.im.zT.Sa("Transaction.update",e,n,o)):(da("Transaction.update",arguments,2),r=Wl("Transaction.update",t,this.im),this.im.zT.ya("Transaction.update",e)),this.rm.update(r.em,i),this},ql.prototype.delete=function(t){da("Transaction.delete",arguments,1);var e=Wl("Transaction.delete",t,this.im);return this.rm.delete(e.em),this},ql),Il=(Ml.prototype.set=function(t,e,n){va("WriteBatch.set",arguments,2,3),this.um();var r=Wl("WriteBatch.set",t,this.im);n=Bl("WriteBatch.set",n);var i=Yl(r.om,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.im.zT.pa(s,o,n.mergeFields):this.im.zT.Va(s,o);return this.hm=this.hm.concat(u.da(r.em,ro.NONE)),this},Ml.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.um(),i="string"==typeof e||e instanceof Ca?(ya("WriteBatch.update",arguments,3),r=Wl("WriteBatch.update",t,this.im),this.im.zT.Sa("WriteBatch.update",e,n,o)):(da("WriteBatch.update",arguments,2),r=Wl("WriteBatch.update",t,this.im),this.im.zT.ya("WriteBatch.update",e)),this.hm=this.hm.concat(i.da(r.em,ro.exists(!0))),this},Ml.prototype.delete=function(t){da("WriteBatch.delete",arguments,1),this.um();var e=Wl("WriteBatch.delete",t,this.im);return this.hm=this.hm.concat(new mo(e.em,ro.NONE)),this},Ml.prototype.commit=function(){return this.um(),this.am=!0,0<this.hm.length?this.im.UT().write(this.hm):Promise.resolve()},Ml.prototype.um=function(){if(this.am)throw new Vr(Cr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Ml),Nl=(Vl.sm=function(t,e,n){if(t.length%2!=0)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.K()+" has "+t.length);return new Vl(new si(t),e,n)},Object.defineProperty(Vl.prototype,"id",{get:function(){return this.em.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Vl.prototype,"parent",{get:function(){return new xl(this.em.path.L(),this.firestore,this.om)},enumerable:!0,configurable:!0}),Object.defineProperty(Vl.prototype,"path",{get:function(){return this.em.path.K()},enumerable:!0,configurable:!0}),Vl.prototype.collection=function(t){if(da("DocumentReference.collection",arguments,1),ma("DocumentReference.collection","non-empty string",1,t),!t)throw new Vr(Cr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Zr.G(t);return new xl(this.em.path.child(e),this.firestore)},Vl.prototype.isEqual=function(t){if(!(t instanceof Vl))throw Sa("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.em.isEqual(t.em)&&this.om===t.om},Vl.prototype.set=function(t,e){va("DocumentReference.set",arguments,1,2),e=Bl("DocumentReference.set",e);var n=Yl(this.om,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.zT.pa(i,r,e.mergeFields):this.firestore.zT.Va(i,r);return this.qT.write(o.da(this.em,ro.NONE))},Vl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Ca?(ya("DocumentReference.update",arguments,2),this.firestore.zT.Sa("DocumentReference.update",t,e,r)):(da("DocumentReference.update",arguments,1),this.firestore.zT.ya("DocumentReference.update",t)),this.qT.write(n.da(this.em,ro.exists(!0)))},Vl.prototype.delete=function(){return da("DocumentReference.delete",arguments,0),this.qT.write([new mo(this.em,ro.NONE)])},Vl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];va("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||yl(t[i])||(_a("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),ba("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=yl(t[i])?t[i]:(ma("DocumentReference.onSnapshot","function",i,t[i]),ga("DocumentReference.onSnapshot","function",i+1,t[i+1]),ga("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.cm(o,n)},Vl.prototype.cm=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new sl({next:function(t){if(n.next){var e=t.docs.get(r.em);n.next(new _l(r.firestore,r.em,e,t.fromCache,t.hasPendingWrites,r.om))}},error:e}),o=this.qT.listen(Co.ve(this.em.path),i,t);return function(){i.DT(),r.qT.fc(o)}},Vl.prototype.get=function(n){var r=this;return va("DocumentReference.get",arguments,0,1),Kl("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.UT().bT(r.em).then(function(t){e(new _l(r.firestore,r.em,t,!0,t instanceof Oo&&t.te,r.om))},t):r._m(e,t,n)})},Vl.prototype._m=function(e,n,r){var i=this.cm({includeMetadataChanges:!0,Kl:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Vr(Cr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Vr(Cr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},Vl.prototype.withConverter=function(t){return new Vl(this.em,this.firestore,t)},Vl),Al=(Cl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Cl),_l=(Ul.prototype.data=function(t){if(va("DocumentSnapshot.data",arguments,0,1),t=zl("DocumentSnapshot.data",t),this.lm){if(this.om){var e=new Sl(this.im,this.em,this.lm,this.dm,this.fm);return this.om.fromFirestore(e,t)}return new gl(this.im,this.im.nm(),t.serverTimestamps,void 0).kT(this.lm.Ie())}},Ul.prototype.get=function(t,e){if(va("DocumentSnapshot.get",arguments,1,2),e=zl("DocumentSnapshot.get",e),this.lm){var n=this.lm.data().field(wh("DocumentSnapshot.get",t));if(null!==n)return new gl(this.im,this.im.nm(),e.serverTimestamps,this.om).kT(n)}},Object.defineProperty(Ul.prototype,"id",{get:function(){return this.em.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Ul.prototype,"ref",{get:function(){return new Nl(this.em,this.im,this.om)},enumerable:!0,configurable:!0}),Object.defineProperty(Ul.prototype,"exists",{get:function(){return null!==this.lm},enumerable:!0,configurable:!0}),Object.defineProperty(Ul.prototype,"metadata",{get:function(){return new Al(this.fm,this.dm)},enumerable:!0,configurable:!0}),Ul.prototype.isEqual=function(t){if(!(t instanceof Ul))throw Sa("isEqual","DocumentSnapshot",1,t);return this.im===t.im&&this.dm===t.dm&&this.em.isEqual(t.em)&&(null===this.lm?null===t.lm:this.lm.isEqual(t.lm))&&this.om===t.om},Ul),Sl=(n(Pl,ml=_l),Pl.prototype.data=function(t){return ml.prototype.data.call(this,t)},Pl),Dl=(Ll.prototype.where=function(t,e,n){var r;da("Query.where",arguments,3),Aa("Query.where",3,n),function(t,e){if(!t.some(function(t){return t===e}))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid value "+Na(e)+" provided to function Query.where() for its "+ka(2)+" argument. Acceptable values: "+t.join(", "))}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e);var i=wh("Query.where",t),o=Vo.G(e);if(i.Y()){if(o===Vo.ARRAY_CONTAINS||o===Vo.ARRAY_CONTAINS_ANY)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===Vo.IN){this.mm(n,o);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.wm(h))}r={arrayValue:{values:s}}}else r=this.wm(n)}else o!==Vo.IN&&o!==Vo.ARRAY_CONTAINS_ANY||this.mm(n,o),r=this.firestore.zT.Da("Query.where",n,o===Vo.IN);var c=$o.create(i,o,r);return this.Em(c),new Ll(this.Tm.Ce(c),this.firestore,this.om)},Ll.prototype.orderBy=function(t,e){var n;if(va("Query.orderBy",arguments,1,2),ga("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=is.ASCENDING;else{if("desc"!==e)throw new Vr(Cr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=is.DESCENDING}if(null!==this.Tm.startAt)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.Tm.endAt)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=wh("Query.orderBy",t),i=new vs(r,n);return this.Im(i),new Ll(this.Tm.ke(i),this.firestore,this.om)},Ll.prototype.limit=function(t){return da("Query.limit",arguments,1),ma("Query.limit","number",1,t),Da("Query.limit",1,t),new Ll(this.Tm.Ne(t),this.firestore,this.om)},Ll.prototype.limitToLast=function(t){return da("Query.limitToLast",arguments,1),ma("Query.limitToLast","number",1,t),Da("Query.limitToLast",1,t),new Ll(this.Tm.Fe(t),this.firestore,this.om)},Ll.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ya("Query.startAt",arguments,1);var r=this.Rm("Query.startAt",t,e,!0);return new Ll(this.Tm.$e(r),this.firestore,this.om)},Ll.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ya("Query.startAfter",arguments,1);var r=this.Rm("Query.startAfter",t,e,!1);return new Ll(this.Tm.$e(r),this.firestore,this.om)},Ll.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ya("Query.endBefore",arguments,1);var r=this.Rm("Query.endBefore",t,e,!0);return new Ll(this.Tm.Me(r),this.firestore,this.om)},Ll.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ya("Query.endAt",arguments,1);var r=this.Rm("Query.endAt",t,e,!1);return new Ll(this.Tm.Me(r),this.firestore,this.om)},Ll.prototype.isEqual=function(t){if(!(t instanceof Ll))throw Sa("isEqual","Query",1,t);return this.firestore===t.firestore&&this.Tm.isEqual(t.Tm)},Ll.prototype.withConverter=function(t){return new Ll(this.Tm,this.firestore,t)},Ll.prototype.Rm=function(t,e,n,r){if(Aa(t,1,e),e instanceof _l){if(0<n.length)throw new Vr(Cr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Vr(Cr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Am(i.lm,r)}var o=[e].concat(n);return this.Pm(t,o,r)},Ll.prototype.Am=function(t,e){for(var n=[],r=0,i=this.Tm.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(qi(this.firestore.OT,t.key));else{var s=t.field(o.field);if(Si(s))throw new Vr(Cr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.K();throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new ys(n,e)},Ll.prototype.Pm=function(t,e,n){var r=this.Tm.Ve;if(e.length>r.length)throw new Vr(Cr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.Tm.He()&&-1!==s.indexOf("/"))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.Tm.path.child(Zr.G(s));if(!si.st(u))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new si(u);i.push(qi(this.firestore.OT,a))}else{var h=this.firestore.zT.Da(t,s);i.push(h)}}return new ys(i,n)},Ll.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];va("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||yl(t[i])||(_a("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),ba("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=yl(t[i])?t[i]:(ma("Query.onSnapshot","function",i,t[i]),ga("Query.onSnapshot","function",i+1,t[i+1]),ga("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Vm(this.Tm),this.cm(r,n)},Ll.prototype.cm=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new sl({next:function(t){e.next&&e.next(new kl(n.firestore,n.Tm,t,n.om))},error:r}),o=this.firestore.UT(),s=o.listen(this.Tm,i,t);return function(){i.DT(),o.fc(s)}},Ll.prototype.Vm=function(t){if(t.Ke()&&0===t.Ve.length)throw new Vr(Cr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},Ll.prototype.get=function(n){var r=this;return va("Query.get",arguments,0,1),Kl("Query.get",n),this.Vm(this.Tm),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.UT().vT(r.Tm).then(function(t){e(new kl(r.firestore,r.Tm,t,r.om))},t):r._m(e,t,n)})},Ll.prototype._m=function(e,n,r){var i=this.cm({includeMetadataChanges:!0,Kl:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Vr(Cr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},Ll.prototype.wm=function(t){if("string"==typeof t){if(""===t)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.Tm.He()&&-1!==t.indexOf("/"))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.Tm.path.child(Zr.G(t));if(!si.st(e))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return qi(this.firestore.OT,new si(e))}if(t instanceof Nl){var n=t;return qi(this.firestore.OT,n.em)}throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Na(t)+".")},Ll.prototype.mm=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},Ll.prototype.Em=function(t){if(t instanceof $o){var e=[Vo.ARRAY_CONTAINS,Vo.ARRAY_CONTAINS_ANY],n=[Vo.IN,Vo.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.Ge()){var o=this.Tm.Se();if(null!==o&&!o.isEqual(t.field))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.Tm.De();null!==s&&this.gm(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.Tm.ze(n)),null===u&&r&&(u=this.Tm.ze(e)),null!=u)throw u===t.op?new Vr(Cr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Vr(Cr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},Ll.prototype.Im=function(t){if(null===this.Tm.De()){var e=this.Tm.Se();null!==e&&this.gm(e,t.field)}},Ll.prototype.gm=function(t,e){if(!e.isEqual(t))throw new Vr(Cr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},Ll),kl=(Object.defineProperty(Ol.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(Ol.prototype,"empty",{get:function(){return this.ym.docs.U()},enumerable:!0,configurable:!0}),Object.defineProperty(Ol.prototype,"size",{get:function(){return this.ym.docs.size},enumerable:!0,configurable:!0}),Ol.prototype.forEach=function(e,n){var r=this;va("QuerySnapshot.forEach",arguments,1,2),ma("QuerySnapshot.forEach","function",1,e),this.ym.docs.forEach(function(t){e.call(n,r.Sm(t))})},Object.defineProperty(Ol.prototype,"query",{get:function(){return new Dl(this.pm,this.im,this.om)},enumerable:!0,configurable:!0}),Ol.prototype.docChanges=function(t){t&&(_a("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ba("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.ym.ds)throw new Vr(Cr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.bm&&this.vm===e||(this.bm=function(i,e,o,s){if(o.cs.U()){var n=0;return o.docChanges.map(function(t){var e=new Sl(i,t.doc.key,t.doc,o.fromCache,o._s.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.cs;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new Sl(i,t.doc.key,t.doc,o.fromCache,o._s.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return vu("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.im,e,this.ym,this.om),this.vm=e),this.bm},Ol.prototype.isEqual=function(t){if(!(t instanceof Ol))throw Sa("isEqual","QuerySnapshot",1,t);return this.im===t.im&&this.pm.isEqual(t.pm)&&this.ym.isEqual(t.ym)&&this.om===t.om},Ol.prototype.Sm=function(t){return new Sl(this.im,t.key,t,this.metadata.fromCache,this.ym._s.has(t.key),this.om)},Ol),xl=(n(Rl,vl=Dl),Object.defineProperty(Rl.prototype,"id",{get:function(){return this.Tm.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.prototype,"parent",{get:function(){var t=this.Tm.path.L();return t.U()?null:new Nl(new si(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.prototype,"path",{get:function(){return this.Tm.path.K()},enumerable:!0,configurable:!0}),Rl.prototype.doc=function(t){if(va("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=gu.mi()),ma("CollectionReference.doc","non-empty string",1,t),""===t)throw new Vr(Cr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Zr.G(t);return Nl.sm(this.Tm.path.child(e),this.firestore,this.om)},Rl.prototype.add=function(t){da("CollectionReference.add",arguments,1),ma("CollectionReference.add","object",1,this.om?this.om.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Rl.prototype.withConverter=function(t){return new Rl(this.Dm,this.firestore,t)},Rl);function Rl(t,e,n){var r=this;if(((r=vl.call(this,Co.ve(t),e,n)||this).Dm=t).length%2!=1)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.K()+" has "+t.length);return r}function Ol(t,e,n,r){this.im=t,this.pm=e,this.ym=n,this.om=r,this.bm=null,this.vm=null,this.metadata=new Al(n.hasPendingWrites,n.fromCache)}function Ll(t,e,n){this.Tm=t,this.firestore=e,this.om=n}function Pl(){return null!==ml&&ml.apply(this,arguments)||this}function Ul(t,e,n,r,i,o){this.im=t,this.em=e,this.lm=n,this.dm=r,this.fm=i,this.om=o}function Cl(t,e){this.hasPendingWrites=t,this.fromCache=e}function Vl(t,e,n){this.em=t,this.firestore=e,this.om=n,this.qT=this.firestore.UT()}function Ml(t){this.im=t,this.hm=[],this.am=!1}function ql(t,e){this.im=t,this.rm=e}function Fl(t,e,n){var r=this;if(void 0===n&&(n=new il),this.xT=null,this.BT=new Ju,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.UT(),[4,this.qT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.xT=i,this.OT=Fl.QT(i),this.WT=i.name,this.jT=new qr(e)}else{var o=t;if(!o.projectId)throw new Vr(Cr.INVALID_ARGUMENT,"Must provide projectId");this.OT=new Nu(o.projectId,o.database),this.WT="[DEFAULT]",this.jT=new Mr}this.KT=n,this.GT=new bl({}),this.zT=this.HT(this.OT)}function jl(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(Cr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else wa("settings","non-empty string","host",t.host),this.host=t.host,ba("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(_a("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),ba("settings","object","credentials",t.credentials),this.credentials=t.credentials,ba("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?du("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&du("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,ba("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ra.po;else{if(t.cacheSizeBytes!==wl&&t.cacheSizeBytes<ra.Vo)throw new Vr(Cr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ra.Vo);this.cacheSizeBytes=t.cacheSizeBytes}ba("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function Gl(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.CT=n,this.converter=r}function Bl(t,e){if(void 0===e)return{merge:!1};if(_a(t,e,["merge","mergeFields"]),ba(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Na(n));for(var r=0;r<n.length;++r)if(!("string"==typeof(i=n[r])||i instanceof Ca))throw new Vr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+r+" was: "+Na(n[r]));var i}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr(Cr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function zl(t,e){return void 0===e?{}:(_a(t,e,["serverTimestamps"]),Ta(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Kl(t,e){ga(t,"object",1,e),e&&(_a(t,e,["source"]),Ta(t,0,"source",e.source,["default","server","cache"]))}function Wl(t,e,n){if(e instanceof Nl){if(e.firestore!==n)throw new Vr(Cr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Sa(t,"DocumentReference",1,e)}function Yl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Hl,Xl=Ra(Tl,"Use firebase.firestore() instead."),Ql=Ra(El,"Use firebase.firestore().runTransaction() instead."),Jl=Ra(Il,"Use firebase.firestore().batch() instead."),$l=Ra(Nl,"Use firebase.firestore().doc() instead."),Zl=Ra(_l),tp=Ra(Sl),ep=Ra(Dl),np=Ra(kl),rp=Ra(xl,"Use firebase.firestore().collection() instead."),ip={Firestore:Xl,GeoPoint:eh,Timestamp:Gr,Blob:Ua,Transaction:Ql,WriteBatch:Jl,DocumentReference:$l,DocumentSnapshot:Zl,Query:ep,QueryDocumentSnapshot:tp,QuerySnapshot:np,CollectionReference:rp,FieldPath:Ca,FieldValue:th,setLogLevel:Tl.setLogLevel,CACHE_SIZE_UNLIMITED:wl},op=(dp.prototype.Hu=function(t){},dp.prototype.lc=function(){},dp),sp=(pp.prototype.Hu=function(t){this.$m.push(t)},pp.prototype.lc=function(){window.removeEventListener("online",this.Cm),window.removeEventListener("offline",this.Nm)},pp.prototype.Mm=function(){window.addEventListener("online",this.Cm),window.addEventListener("offline",this.Nm)},pp.prototype.km=function(){pu("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.$m;t<e.length;t++)(0,e[t])(0)},pp.prototype.Fm=function(){pu("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.$m;t<e.length;t++)(0,e[t])(1)},pp.Uc=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},pp),up=(lp.prototype._u=function(t){this.xm=t},lp.prototype.ou=function(t){this.Bm=t},lp.prototype.onMessage=function(t){this.Um=t},lp.prototype.close=function(){this.Om()},lp.prototype.send=function(t){this.Lm(t)},lp.prototype.qm=function(){this.xm()},lp.prototype.Qm=function(t){this.Bm(t)},lp.prototype.Wm=function(t){this.Um(t)},lp),ap={BatchGetDocuments:"batchGet",Commit:"commit"},hp="gl-js/ fire/"+Rr,cp=(fp.prototype.Km=function(t,e){if(e)for(var n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n]);t["X-Goog-Api-Client"]=hp},fp.prototype.gu=function(a,r,i){var h=this,c=this.Gm(a);return new Promise(function(o,s){var u=new xr;u.listenOnce(Dr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Sr.NO_ERROR:var t=u.getResponseJson();pu("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Sr.TIMEOUT:pu("Connection",'RPC "'+a+'" timed out'),s(new Vr(Cr.DEADLINE_EXCEEDED,"Request time out"));break;case Sr.HTTP_ERROR:var e=u.getStatus();if(pu("Connection",'RPC "'+a+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Cr).indexOf(i)?i:Cr.UNKNOWN);s(new Vr(r,n.message))}else s(new Vr(Cr.UNKNOWN,"Server responded with status "+u.getStatus()))}else pu("Connection",'RPC "'+a+'" failed'),s(new Vr(Cr.UNAVAILABLE,"Connection failed."));break;default:vu('RPC "'+a+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{pu("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);pu("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Km(n,i),u.send(c,"POST",e,n,15)})},fp.prototype.yu=function(t,e,n){return this.gu(t,e,n)},fp.prototype.lu=function(t,e){var n,r,i=[this.jm,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=_r(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.cn.projectId+"/databases/"+this.cn.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Km(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}pu("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new up({Lm:function(t){f?pu("Connection","Not sending because WebChannel is closed:",t):(c||(pu("Connection","Opening WebChannel transport."),h.open(),c=!0),pu("Connection","WebChannel sending:",t),h.send(t))},Om:function(){return h.close()}});return a(kr.EventType.OPEN,function(){f||pu("Connection","WebChannel transport opened.")}),a(kr.EventType.CLOSE,function(){f||(f=!0,pu("Connection","WebChannel transport closed"),l.Qm())}),a(kr.EventType.ERROR,function(t){f||(f=!0,pu("Connection","WebChannel transport errored:",t),l.Qm(new Vr(Cr.UNAVAILABLE,"The operation could not be completed")))}),a(kr.EventType.MESSAGE,function(t){var e;if(!f){var n=t.data[0];mu(!!n,"Got a webchannel message without data.");var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){pu("Connection","WebChannel received error:",r);var i=r.status,o=function(){var t=ps[i];if(void 0!==t)return Ns(t)}(),s=r.message;void 0===o&&(o=Cr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.Qm(new Vr(o,s)),h.close()}else pu("Connection","WebChannel received:",n),l.Wm(n)}}),setTimeout(function(){l.qm()},0),l},fp.prototype.Gm=function(t){var e=ap[t];return this.jm+"/v1/projects/"+this.cn.projectId+"/databases/"+this.cn.database+"/documents:"+e},fp);function fp(t){this.cn=t.cn;var e=t.ssl?"https":"http";this.jm=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function lp(t){this.Lm=t.Lm,this.Om=t.Om}function pp(){var t=this;this.Cm=function(){return t.km()},this.Nm=function(){return t.Fm()},this.$m=[],this.Mm()}function dp(){}function yp(){this.dn=!0,this.ia="undefined"!=typeof atob}au.fi((Object.defineProperty(yp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(yp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),yp.prototype.VT=function(t){return Promise.resolve(new cp(t))},yp.prototype.mT=function(){return new(sp.Uc()?sp:op)},yp.prototype.fT=function(t){return new ou(t,{dn:!0})},yp.prototype.Ti=function(t){return JSON.stringify(t)},yp.prototype.atob=function(t){return atob(t)},yp.prototype.btoa=function(t){return btoa(t)},new yp)),(Hl=vp).INTERNAL.registerComponent(new T("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new Tl(e,n,new nl);var e,n},"PUBLIC").setServiceProps(Object.assign({},ip))),Hl.registerVersion("@firebase/firestore","1.14.0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});