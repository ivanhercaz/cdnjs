!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(ep){"use strict";try{(function(){ep=ep&&Object.prototype.hasOwnProperty.call(ep,"default")?ep.default:ep;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(g,f=Error),g);function g(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,E=(I.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},I.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},I.prototype.setServiceProps=function(t){return this.serviceProps=t,this},I);function I(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},S=_||self;function x(){}function k(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function L(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function D(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),O=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:V).apply(null,arguments)}function M(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var j=Date.now||function(){return+new Date};function U(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.da=function(){!this.j&&(this.j=!0,this.C(),0)&&(Object.prototype.hasOwnProperty.call(this,R)&&this[R]||(this[R]=++O))},q.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var K,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var Q=S.navigator;if(Q){var J=Q.userAgent;if(J){K=J;break t}}K=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=x;var rt,it,ot=X(K,"Opera"),st=X(K,"Trident")||X(K,"MSIE"),ut=X(K,"Edge"),at=ut||st,ht=X(K,"Gecko")&&!(X(K.toLowerCase(),"webkit")&&!X(K,"Edge"))&&!(X(K,"Trident")||X(K,"MSIE"))&&!X(K,"Edge"),ct=X(K.toLowerCase(),"webkit")&&!X(K,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=K,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt={};function vt(u){return t=u,e=function(){for(var t=0,e=W(String(rt)).split("."),n=W(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=yt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var gt=S.document&&st&&(ft()||parseInt(rt,10))||void 0,mt=!st||9<=Number(gt),wt=st&&!vt("9"),bt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",x,e),S.removeEventListener("test",x,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function It(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Tt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},U(It,Et);var Tt={2:"touch",3:"pen",4:"mouse"};It.prototype.b=function(){It.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,wt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),_t=0;function At(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++_t,this.V=this.X=!1}function St(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function xt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n,r,i,o=e.type;o in t.a&&(r=t.a[o],(n=0<=(i=F(r,e)))&&Array.prototype.splice.call(r,i,1),n&&(St(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Lt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Lt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new At(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Dt="closure_lm_"+(1e6*Math.random()|0),Rt={};function Ot(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ft(r),e&&e[Nt]?e.sa(n,r,D(i)?!!i.capture:!!i,o):Pt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ot(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[Nt]?t.ra(e,n,D(r)?!!r.capture:!!r,i):Pt(t,e,n,!1,r,i)}function Pt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=D(i)?!!i.capture:!!i;if(s&&!mt)return null;var u,a,h=Ut(t);if(h||(t[Dt]=h=new xt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=jt,r=a=mt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)bt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.V&&((e=t.src)&&e[Nt]?kt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ut(e))?(kt(n,t),0==n.b&&(n.src=null,e[Dt]=null)):St(t)))}function Ct(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Vt(t),n.call(r,e)}function jt(t,e){if(t.V)return!0;if(mt)return Mt(t,new It(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new It(e,this))}function Ut(t){return(t=t[Dt])instanceof xt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==k(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Bt(){q.call(this),this.c=new xt(this),(this.J=this).A=null}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.V&&a.capture==n&&(s=a.listener,u=a.aa||a.src,a.X&&kt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}U(Bt,q),Bt.prototype[Nt]=!0,(N=Bt.prototype).addEventListener=function(t,e,n,r){Ot(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=D(i)?!!i.capture:!!i,r=Ft(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Lt(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ut(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Lt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Et(t,n):t instanceof Et?t.target=t.target||n:(s=t,et(t=new Et(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Gt(o,r,!0,t)&&s;if(s=Gt(o=t.a=n,r,!0,t)&&s,s=Gt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Gt(o=t.a=e[i],r,!1,t)&&s;return s},N.C=function(){if(Bt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.A=null},N.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=S.JSON.stringify;function Ht(){this.b=this.a=null}var Kt,Wt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt(function(){return new Yt},function(t){t.reset()},100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Yt(){this.next=this.b=this.a=null}function Qt(t){S.setTimeout(function(){throw t},0)}function Jt(t,e){var n;Kt||(n=S.Promise.resolve(void 0),Kt=function(){n.then(te)}),Zt||(Kt(),Zt=!0),$t.add(t,e)}Ht.prototype.add=function(t,e){var n=Wt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Zt=!(Yt.prototype.reset=function(){this.next=this.b=this.a=null}),$t=new Ht;function te(){for(var t,e,n;n=e=void 0,n=null,(e=$t).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Qt(t)}var r=Wt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Zt=!1}function ee(t,e){Bt.call(this),this.b=t||1,this.a=e||S,this.f=C(this.Ua,this),this.g=j()}function ne(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function re(t,e,n){if("function"==k(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function ie(t,e,n){q.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function oe(t){t.T=re(t.b,t.c),t.f.apply(null,t.a)}function se(t){q.call(this),this.b=t,this.a={}}U(ee,Bt),(N=ee.prototype).Z=!1,N.L=null,N.Ua=function(){var t;this.Z&&(0<(t=j()-this.g)&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ne(this),this.start())))},N.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=j())},N.C=function(){ee.M.C.call(this),ne(this),delete this.a},U(ie,q),(N=ie.prototype).ba=!1,N.T=null,N.Ia=function(t){this.a=arguments,this.T?this.ba=!0:oe(this)},N.C=function(){ie.M.C.call(this),this.T&&(S.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},N.Pa=function(){this.T=null,this.ba&&(this.ba=!1,oe(this))},U(se,q);var ue=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=Ot(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){Z(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function ce(){}se.prototype.C=function(){se.M.C.call(this),he(this)},se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=null;function le(){return fe=fe||new Bt}function pe(t){Et.call(this,"serverreachability",t)}function de(){var t=le();t.dispatchEvent(new pe(t))}function ye(t){Et.call(this,"statevent",t)}function ve(){var t=le();t.dispatchEvent(new ye(t))}function ge(t){Et.call(this,"timingevent",t)}function me(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}U(pe,Et),U(ye,Et),U(ge,Et);var we={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},be={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ee(){}function Ie(t){var e;return(e=t.a)||(e=t.a={}),e}function Te(){}Ee.prototype.a=null;var Ne,_e={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function Ae(){Et.call(this,"d")}function Se(){Et.call(this,"c")}function xe(){}function ke(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new se(this),this.N=Le,t=at?125:void 0,this.O=new ee(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}U(Ae,Et),U(Se,Et),U(xe,Ee),Ne=new xe;var Le=45e3,De={},Re={};function Oe(t,e,n){t.B=1,t.f=tn(Xe(e)),t.j=n,t.F=!0,Pe(t,null)}function Pe(t,e){t.s=j(),Ce(t),t.A=Xe(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),dn(n.b,"t",r),t.w=0,t.a=or(t.g,t.g.w?e:null),0<t.J&&(t.D=new ie(C(t.ya,t,t.a),t.J)),ae(t.G,t.a,"readystatechange",t.Sa),e=t.m?$(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),de()}function Ve(t,e,n){for(var r,i,o,s,u=!0;!t.l&&t.w<n.length;){var a=(i=n,s=o=void 0,o=(r=t).w,-1==(s=i.indexOf("\n",o))?Re:(o=Number(i.substring(o,s)),isNaN(o)?De:(s+=1)+o>i.length?Re:(i=i.substr(s,o),r.w=s+o,i)));if(a==Re){4==e&&(t.c=4,ve(),u=!1);break}if(a==De){t.c=4,ve(),u=!1;break}Fe(t,a)}4==e&&0==n.length&&(t.c=1,ve(),u=!1),t.b=t.b&&u,u||(qe(t),Ue(t))}function Ce(t){t.P=j()+t.N,Me(t,t.N)}function Me(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=me(C(t.Qa,t),e)}function je(t){t.h&&(S.clearTimeout(t.h),t.h=null)}function Ue(t){0==t.g.u||t.l||tr(t.g,t)}function qe(t){je(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ne(t.O),he(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Fe(t,e){try{var n,r,i,o,s,u,a,h,c,f,l=t.g;if(0!=l.u&&(l.a==t||En(l.b,t)))if(l.A=t.H,!t.o&&En(l.b,t)&&3==l.u){try{var p=l.ja.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var d=p;if(0==d[0]){t:if(!l.i){if(l.a){if(!(l.a.s+3e3<t.s))break t;$n(l),l.a.cancel(),l.a=null}Zn(l),ve()}}else l.ia=d[1],0<l.ia-l.G&&d[2]<37500&&l.U&&0==l.m&&!l.l&&(l.l=me(C(l.Na,l),6e3));if(bn(l.b)<=1&&l.O){try{l.O()}catch(t){}l.O=void 0}}else nr(l,11)}else if(!t.o&&l.a!=t||$n(l),!H(e))for(e=p=l.ja.a.parse(e),p=0;p<e.length;p++){d=e[p],l.G=d[0],d=d[1],2==l.u?"c"==d[0]?(l.B=d[1],l.R=d[2],null!=(n=d[3])&&(l.oa=n),null!=(r=d[5])&&"number"==typeof r&&0<r&&(l.D=1.5*r),i=l,(o=t.a)&&(!(s=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=i.b).a&&(X(s,"spdy")||X(s,"quic")||X(s,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(In(u,u.b),u.b=null)),!i.s||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(i.ha=a,$e(i.v,i.s,a))),l.u=3,l.c&&l.c.na(),h=t,(i=l).ea=ir(i,i.w?i.R:null,i.P),h.o?(Tn(i.b,h),c=h,(f=i.D)&&c.setTimeout(f),c.h&&(je(c),Ce(c)),i.a=h):Jn(i),0<l.f.length&&Wn(l)):"stop"!=d[0]&&"close"!=d[0]||nr(l,7):3==l.u&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?nr(l,7):zn(l):"noop"!=d[0]&&l.c&&l.c.ma(d),l.m=0)}de()}catch(t){}}function Be(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(L(t)||"string"==typeof t)B(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(L(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(L(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ge(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ge)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];He(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)He(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function He(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=ke.prototype).setTimeout=function(t){this.N=t},N.Sa=function(t){t=t.target;var e=this.D;e&&3==qn(t)?e.Ia():this.ya(t)},N.ya=function(t){try{if(t==this.a)t:{var e=qn(this.a),n=this.a.qa();this.a.S();if(!(e<3||3==e&&!at&&!this.a.Y())){this.l||4!=e||7==n||de(),je(this);var r=this.a.S();this.H=r;var i=this.a.Y();if(this.b=200==r){if(this.R&&!this.o){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.c=3,ve(),qe(this),Ue(this);break t}this.o=!0,Fe(this,u)}this.F?(Ve(this,e,i),at&&this.b&&3==e&&(ae(this.G,this.O,"tick",this.Ra),this.O.start())):Fe(this,i),4==e&&qe(this),this.b&&!this.l&&(4==e?tr(this.g,this):(this.b=!1,Ce(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.c=3:this.c=0,ve(),qe(this),Ue(this)}}}catch(t){}},N.Ra=function(){var t,e;this.a&&(t=qn(this.a),e=this.a.Y(),this.w<e.length&&(je(this),Ve(this,t,e),this.b&&4!=t&&Ce(this)))},N.cancel=function(){this.l=!0,qe(this)},N.Qa=function(){this.h=null;var t=j();0<=t-this.P?(2!=this.B&&(de(),ve()),qe(this),this.c=2,Ue(this)):Me(this,this.P-t)},(N=Ge.prototype).I=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return ze(this),this.a.concat()},N.get=function(t,e){return He(this.b,t)?this.b[t]:e},N.set=function(t,e){He(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ke=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function We(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof We?(this.a=void 0!==e?e:t.a,Ye(this,t.f),this.j=t.j,Qe(this,t.c),Je(this,t.h),this.g=t.g,e=t.b,(n=new cn).c=e.c,e.a&&(n.a=new Ge(e.a),n.b=e.b),Ze(this,n),this.i=t.i):t&&(n=String(t).match(Ke))?(this.a=!!e,Ye(this,n[1]||"",!0),this.j=en(n[2]||""),Qe(this,n[3]||"",!0),Je(this,n[4]),this.g=en(n[5]||"",!0),Ze(this,n[6]||"",!0),this.i=en(n[7]||"")):(this.a=!!e,this.b=new cn(null,this.a))}function Xe(t){return new We(t)}function Ye(t,e,n){t.f=n?en(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Qe(t,e,n){t.c=n?en(e,!0):e}function Je(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ze(t,e,n){var r,i;e instanceof cn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(fn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ln(this,e),dn(this,n,t))},r)),r.f=i):(n||(e=nn(e,an)),t.b=new cn(e,t.a))}function $e(t,e,n){t.b.set(e,n)}function tn(t){return $e(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^j()).toString(36)),t}function en(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function nn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}We.prototype.toString=function(){var t=[],e=this.f;e&&t.push(nn(e,on,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(nn(e,on,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(nn(n,"/"==n.charAt(0)?un:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",nn(n,hn)),t.join("")};var on=/[#\/\?@]/g,sn=/[#\?:]/g,un=/[#\?]/g,an=/[#\?@]/g,hn=/#/g;function cn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(u){u.a||(u.a=new Ge,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],o=n,s=i?decodeURIComponent(i.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function ln(t,e){fn(t),e=yn(t,e),He(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function pn(t,e){return fn(t),e=yn(t,e),He(t.a.b,e)}function dn(t,e,n){ln(t,e),0<n.length&&(t.c=null,t.a.set(yn(t,e),z(n)),t.b+=n.length)}function yn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function vn(t,e){this.b=t,this.a=e}function gn(t){this.g=t||mn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ca&&S.ca.ua&&S.ca.ua()&&S.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=cn.prototype).add=function(t,e){fn(this),this.c=null,t=yn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){fn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},N.K=function(){fn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.I=function(t){fn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=G(e,this.a.get(yn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},N.set=function(t,e){return fn(this),this.c=null,pn(this,t=yn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.I(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var mn=10;function wn(t){return t.b||t.a&&t.a.size>=t.f}function bn(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function In(t,e){t.a?t.a.add(e):t.b=e}function Tn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.i)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function _n(){}function An(){this.a=new _n}function Sn(t,r,e){var i=e||"";try{Be(t,function(t,e){var n=t;D(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function xn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},_n.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},_n.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var kn=S.JSON.parse;function Ln(t){Bt.call(this),this.headers=new Ge,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Dn,this.B=this.F=!1}U(Ln,Bt);var Dn="",Rn=/^https?$/i,On=["POST","PUT"];function Pn(t){return"content-type"==t.toLowerCase()}function Vn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),jn(t)}function Cn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Mn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=qn(t)||2!=t.S()))if(t.l&&4==qn(t))re(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==qn(t)){t.b=!1;try{var e,n,r,i,o=t.S();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.D).match(Ke)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<qn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Cn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Un(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Un(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function qn(t){return t.a?t.a.readyState:0}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Z(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):$e(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Bn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Bn("baseRetryDelayMs",5e3,t),this.Ga=Bn("retryDelaySeedMs",1e4,t),this.Da=Bn("forwardChannelMaxRetries",2,t),this.ga=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new gn(t&&t.concurrentRequestLimit),this.ja=new An,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function zn(t){var e,n;Hn(t),3==t.u&&(e=t.H++,$e(n=Xe(t.v),"SID",t.B),$e(n,"RID",e),$e(n,"TYPE","terminate"),Yn(t,n),(e=new ke(t,e,void 0)).B=2,e.f=tn(Xe(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.f.toString(),"")),!n&&S.Image&&((new Image).src=e.f,n=!0),n||(e.a=or(e.g,null),e.a.$(e.f)),e.s=j(),Ce(e)),rr(t)}function Hn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(S.clearTimeout(t.i),t.i=null),$n(t),t.b.cancel(),t.g&&("number"==typeof t.g&&S.clearTimeout(t.g),t.g=null)}function Kn(t,e){t.f.push(new vn(t.Fa++,e)),3==t.u&&Wn(t)}function Wn(t){wn(t.b)||t.g||(t.g=!0,Jt(t.xa,t),t.o=0)}function Xn(t,e){var n=e?e.W:t.H++,r=Xe(t.v);$e(r,"SID",t.B),$e(r,"RID",n),$e(r,"AID",t.G),Yn(t,r),t.h&&t.j&&Fn(r,t.h,t.j),n=new ke(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Qn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),In(t.b,n),Oe(n,r,e)}function Yn(t,n){t.c&&Be({},function(t,e){$e(n,e,t)})}function Qn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Sn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function Jn(t){t.a||t.i||(t.J=1,Jt(t.wa,t),t.m=0)}function Zn(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=me(C(t.wa,t),er(t,t.m)),t.m++,1)}function $n(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function tr(t,e){var n,r=null;if(t.a==e){$n(t),t.a=null;var i=2}else{if(!En(t.b,e))return;r=e.i,Tn(t.b,e),i=1}if(t.A=e.H,0!=t.u)if(e.b){1==i?(r=e.j?e.j.length:0,e=j()-e.s,n=t.o,(i=le()).dispatchEvent(new ge(i)),Wn(t)):Jn(t)}else if(3==(n=e.c)||0==n&&0<t.A||!(1==i&&function(t,e){if(!(bn(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=me(C(t.xa,t,e),er(t,t.o)),t.o++,1}}(t,e)||2==i&&Zn(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function nr(t,e){var n,r,i,o,s,u;2==e?(n=null,t.c&&(n=null),r=C(t.Ta,t),n||(n=new We("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||Ye(n,"https"),tn(n)),i=n.toString(),o=r,u=new ce,S.Image?((s=new Image).onload=M(xn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=M(xn,u,s,"TestLoadImage: error",!1,o),s.onabort=M(xn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=M(xn,u,s,"TestLoadImage: timeout",!1,o),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):ve(),t.u=0,t.c&&t.c.la(e),rr(t),Hn(t)}function rr(t){t.u=0,t.A=-1,t.c&&(0==Nn(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.ka())}function ir(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof We?Xe(r):new We(r,void 0);return""!=c.c?(e&&Qe(c,e+"."+c.c),Je(c,c.h)):(o=(i=S.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new We(null,void 0),o&&Ye(h,o),s&&Qe(h,s),u&&Je(h,u),a&&(h.g=a),c=h),t.N&&Z(t.N,function(t,e){$e(c,e,t)}),e=t.s,n=t.ha,e&&n&&$e(c,e,n),$e(c,"VER",t.oa),Yn(t,c),c}function or(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ln(t.Ea)).F=t.w,e}function sr(){}function ur(){if(st&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function ar(t,e){Bt.call(this),this.a=new Gn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new fr(this)}function hr(t){Ae.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Se.call(this),this.status=1}function fr(t){this.a=t}(N=Ln.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Ie(this.G):Ie(Ne),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Vn(this,t)}t=n||"";var i,o=new Ge(this.headers);r&&Be(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Pn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=S.FormData&&t instanceof S.FormData,0<=F(On,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.B=(i=this.a,st&&vt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=re(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vn(this,t)}},N.ta=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jn(this))},N.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),Ln.M.C.call(this)},N.va=function(){this.j||(this.w||this.l||this.g?Mn(this):this.Oa())},N.Oa=function(){Mn(this)},N.S=function(){try{return 2<qn(this)?this.a.status:-1}catch(t){return-1}},N.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),kn(e)}},N.qa=function(){return this.h},N.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Gn.prototype).oa=8,N.u=1,N.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new ke(this,t,void 0),r=this.j;if(this.F&&(r?et(r=$(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Qn(this,n,e),$e(i=Xe(this.v),"RID",t),$e(i,"CVER",22),this.s&&$e(i,"X-HTTP-Session-Id",this.s),Yn(this,i),this.h&&r&&Fn(i,this.h,r),In(this.b,n),this.fa?($e(i,"$req",e),$e(i,"SID","null"),n.R=!0,Oe(n,i,null)):Oe(n,i,e),this.u=2}}else 3==this.u&&(t?Xn(this,t):0==this.f.length||wn(this.b)||Xn(this))},N.wa=function(){this.i=null,this.a=new ke(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Xe(this.ea);$e(t,"RID","rpc"),$e(t,"SID",this.B),$e(t,"CI",this.U?"0":"1"),$e(t,"AID",this.G),Yn(this,t),$e(t,"TYPE","xmlhttp"),this.h&&this.j&&Fn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=tn(Xe(t)),e.j=null,e.F=!0,Pe(e,n)},N.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Zn(this),ve())},N.Ta=function(t){ve()},(N=sr.prototype).na=function(){},N.ma=function(){},N.la=function(){},N.ka=function(){},N.Ha=function(){},ur.prototype.a=function(t,e){return new ar(t,e)},U(ar,Bt),(N=ar.prototype).addEventListener=function(t,e,n,r){ar.M.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){ar.M.removeEventListener.call(this,t,e,n,r)},N.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ve(),t.P=e,t.N=n||{},t.U=t.W,t.v=ir(t,null,t.P),Wn(t)},N.close=function(){zn(this.a)},N.La=function(t){var e;"string"==typeof t?((e={}).__data__=t,Kn(this.a,e)):this.g?((e={}).__data__=zt(t),Kn(this.a,e)):Kn(this.a,t)},N.C=function(){this.a.c=null,delete this.f,zn(this.a),delete this.a,ar.M.C.call(this)},U(hr,Ae),U(cr,Se),U(fr,sr),fr.prototype.na=function(){this.a.dispatchEvent("a")},fr.prototype.ma=function(t){this.a.dispatchEvent(new hr(t))},fr.prototype.la=function(t){this.a.dispatchEvent(new cr)},fr.prototype.ka=function(){this.a.dispatchEvent("b")},ur.prototype.createWebChannel=ur.prototype.a,ar.prototype.send=ar.prototype.La,ar.prototype.open=ar.prototype.Ka,ar.prototype.close=ar.prototype.close,we.NO_ERROR=0,we.TIMEOUT=8,we.HTTP_ERROR=6,be.COMPLETE="complete",(Te.EventType=_e).OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",Bt.prototype.listen=Bt.prototype.ra,Ln.prototype.listenOnce=Ln.prototype.sa,Ln.prototype.getLastError=Ln.prototype.Ma,Ln.prototype.getLastErrorCode=Ln.prototype.qa,Ln.prototype.getStatus=Ln.prototype.S,Ln.prototype.getResponseJson=Ln.prototype.Ja,Ln.prototype.getResponseText=Ln.prototype.Y,Ln.prototype.send=Ln.prototype.$;var lr={createWebChannelTransport:function(){return new ur},ErrorCode:we,EventType:be,WebChannel:Te,XhrIo:Ln},pr=lr.createWebChannelTransport,dr=lr.ErrorCode,yr=lr.EventType,vr=lr.WebChannel,gr=lr.XhrIo,mr=ep.SDK_VERSION,wr=(br.prototype.t=function(){return null!=this.uid},br.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},br.prototype.isEqual=function(t){return t.uid===this.uid},br);function br(t){this.uid=t}function Er(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}wr.UNAUTHENTICATED=new wr(null),wr.i=new wr("google-credentials-uid"),wr.h=new wr("first-party-uid");var Ir,Tr,Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_r=(n(Br,Tr=Error),Br),Ar=(Fr.prototype.getToken=function(){return Promise.resolve(null)},Fr.prototype._=function(){},Fr.prototype.l=function(t){(this.u=t)(wr.UNAUTHENTICATED)},Fr.prototype.T=function(){this.u=null},Fr),Sr=(qr.prototype.getToken=function(){var e=this,n=this.m,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.m!==n)throw new _r(Nr.ABORTED,"getToken aborted due to token change.");return t?(Hs("string"==typeof t.accessToken),new Er(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},qr.prototype._=function(){this.forceRefresh=!0},qr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},qr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},qr.prototype.A=function(){var t=this.auth&&this.auth.getUid();return Hs(null===t||"string"==typeof t),new wr(t)},qr),xr=(Object.defineProperty(Ur.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Ur),kr=(jr.prototype.getToken=function(){return Promise.resolve(new xr(this.P,this.V))},jr.prototype.l=function(t){t(wr.h)},jr.prototype.T=function(){},jr.prototype._=function(){},jr),Lr=(Mr.now=function(){return Mr.fromMillis(Date.now())},Mr.fromDate=function(t){return Mr.fromMillis(t.getTime())},Mr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Mr(e,1e6*(t-1e3*e))},Mr.prototype.toDate=function(){return new Date(this.toMillis())},Mr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Mr.prototype.p=function(t){return this.seconds===t.seconds?Xs(this.nanoseconds,t.nanoseconds):Xs(this.seconds,t.seconds)},Mr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Mr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Mr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Mr),Dr=(Cr.v=function(t){return new Cr(t)},Cr.min=function(){return new Cr(new Lr(0,0))},Cr.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Cr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Cr.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Cr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Cr.prototype.C=function(){return this.timestamp},Cr),Rr=(Object.defineProperty(Vr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),Vr.prototype.isEqual=function(t){return 0===Vr.N(this,t)},Vr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Vr?t.forEach(function(t){e.push(t)}):e.push(t),this.k(e)},Vr.prototype.limit=function(){return this.offset+this.length},Vr.prototype.$=function(t){return t=void 0===t?1:t,this.k(this.segments,this.offset+t,this.length-t)},Vr.prototype.M=function(){return this.k(this.segments,this.offset,this.length-1)},Vr.prototype.L=function(){return this.segments[this.offset]},Vr.prototype.O=function(){return this.get(this.length-1)},Vr.prototype.get=function(t){return this.segments[this.offset+t]},Vr.prototype.B=function(){return 0===this.length},Vr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Vr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},Vr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Vr),Or=(n(Pr,Ir=Rr),Pr.prototype.k=function(t,e,n){return new Pr(t,e,n)},Pr.prototype.j=function(){return this.W().join("/")},Pr.prototype.toString=function(){return this.j()},Pr.K=function(t){if(0<=t.indexOf("//"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Pr(t.split("/").filter(function(t){return 0<t.length}))},Pr);function Pr(){return null!==Ir&&Ir.apply(this,arguments)||this}function Vr(t,e,n){void 0===e?e=0:e>t.length&&zs(),void 0===n?n=t.length-e:n>t.length-e&&zs(),this.segments=t,this.offset=e,this.F=n}function Cr(t){this.timestamp=t}function Mr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function jr(t,e){this.P=t,this.V=e}function Ur(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=wr.h}function qr(t){var e=this;this.I=null,this.currentUser=wr.UNAUTHENTICATED,this.R=!1,this.m=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.m++,e.currentUser=e.A(),e.R=!0,e.u&&e.u(e.currentUser)},this.m=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function Fr(){this.u=null}function Br(t,e){var n=this;return(n=Tr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Or.G=new Or([]);var Gr,zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Hr=(n(Kr,Gr=Rr),Kr.prototype.k=function(t,e,n){return new Kr(t,e,n)},Kr.H=function(t){return zr.test(t)},Kr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Kr.H(t)||(t="`"+t+"`"),t}).join(".")},Kr.prototype.toString=function(){return this.j()},Kr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Kr.J=function(){return new Kr(["__name__"])},Kr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new _r(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _r(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new _r(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Kr(e)},Kr);function Kr(){return null!==Gr&&Gr.apply(this,arguments)||this}Hr.G=new Hr([]);var Wr=(Xr.Z=function(t){return new Xr(Or.K(t).$(5))},Xr.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Xr.prototype.isEqual=function(t){return null!==t&&0===Or.N(this.path,t.path)},Xr.prototype.toString=function(){return this.path.toString()},Xr.N=function(t,e){return Or.N(t.path,e.path)},Xr.et=function(t){return t.length%2==0},Xr.st=function(t){return new Xr(new Or(t.slice()))},Xr);function Xr(t){this.path=t}function Yr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Qr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Jr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Wr.EMPTY=new Wr(new Or([]));var Zr=($r.fromBase64String=function(t){return new $r(Cs.nt().atob(t))},$r.fromUint8Array=function(t){return new $r(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},$r.prototype.toBase64=function(){return Cs.nt().btoa(this.it)},$r.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},$r.prototype.rt=function(){return 2*this.it.length},$r.prototype.S=function(t){return Xs(this.it,t.it)},$r.prototype.isEqual=function(t){return this.it===t.it},$r);function $r(t){this.it=t}function ti(t){return null==t}function ei(t){return-0===t&&1/t==-1/0}function ni(t){return"number"==typeof t&&Number.isInteger(t)&&!ei(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function ri(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ii(t){var e=li(t.mapValue.fields.__local_write_time__.timestampValue);return new Lr(e.seconds,e.nanos)}Zr.ht=new Zr("");var oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ri(t)?4:10:zs()}function ui(r,i){var t,e,n,o=si(r);if(o!==si(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ii(r).isEqual(ii(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=li(r.timestampValue),n=li(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,di(r.bytesValue).isEqual(di(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,pi((t=r).geoPointValue.latitude)===pi(e.geoPointValue.latitude)&&pi(t.geoPointValue.longitude)===pi(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return pi(t.integerValue)===pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=pi(t.doubleValue),r=pi(e.doubleValue);return n===r?ei(n)===ei(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Ys(r.arrayValue.values||[],i.arrayValue.values||[],ui);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Yr(t)!==Yr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!ui(t[n],e[n])))return!1;return!0}();default:return zs()}}function ai(t,e){return void 0!==(t.values||[]).find(function(t){return ui(t,e)})}function hi(t,e){var n,r,i,o,s,u,a,h,c,f,l=si(t),p=si(e);if(l!==p)return Xs(l,p);switch(l){case 0:return 0;case 1:return Xs(t.booleanValue,e.booleanValue);case 2:return h=e,(c=pi(t.integerValue||t.doubleValue))<(f=pi(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return ci(t.timestampValue,e.timestampValue);case 4:return ci(ii(t),ii(e));case 5:return Xs(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=di(o),a=di(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Xs(n[i],r[i]);if(0!==o)return o}return Xs(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Xs(pi(n.latitude),pi(r.latitude)))?i:Xs(pi(n.longitude),pi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=hi(n[i],r[i]);if(o)return o}return Xs(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Xs(r[s],o[s]);if(0!==u)return u;var a=hi(n[r[s]],i[o[s]]);if(0!==a)return a}return Xs(r.length,o.length)}(t.mapValue,e.mapValue);default:throw zs()}}function ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Xs(t,e);var n=li(t),r=li(e),i=Xs(n.seconds,r.seconds);return 0!==i?i:Xs(n.nanos,r.nanos)}function fi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=li(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?di(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Wr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):zs();var t,e,n}(t)}function li(t){if(Hs(!!t),"string"!=typeof t)return{seconds:pi(t.seconds),nanos:pi(t.nanos)};var e,n=0,r=oi.exec(t);Hs(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function di(t){return"string"==typeof t?Zr.fromBase64String(t):Zr.fromUint8Array(t)}function yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function vi(t){return t&&"integerValue"in t}function gi(t){return!!t&&"arrayValue"in t}function mi(t){return t&&"nullValue"in t}function wi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bi(t){return t&&"mapValue"in t}var Ei=(Ii.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},Ii.prototype.at=function(t,e){return e},Ii.prototype.ut=function(t){return null},Ii.prototype.isEqual=function(t){return t instanceof Ii},Ii);function Ii(){}Ei.instance=new Ei;var Ti=(xi.prototype.ot=function(t,e){return this.apply(t)},xi.prototype.at=function(t,e){return this.apply(t)},xi.prototype.apply=function(t){for(var n=ki(t),e=function(e){n.some(function(t){return ui(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},xi.prototype.ut=function(t){return null},xi.prototype.isEqual=function(t){return t instanceof xi&&Ys(this.elements,t.elements,ui)},xi),Ni=(Si.prototype.ot=function(t,e){return this.apply(t)},Si.prototype.at=function(t,e){return this.apply(t)},Si.prototype.apply=function(t){for(var n=ki(t),e=function(e){n=n.filter(function(t){return!ui(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Si.prototype.ut=function(t){return null},Si.prototype.isEqual=function(t){return t instanceof Si&&Ys(this.elements,t.elements,ui)},Si),_i=(Ai.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return vi(n)&&vi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},Ai.prototype.at=function(t,e){return e},Ai.prototype.ut=function(t){return vi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},Ai.prototype.isEqual=function(t){return t instanceof Ai&&ui(this.ct,t.ct)},Ai.prototype.asNumber=function(t){return pi(t.integerValue||t.doubleValue)},Ai);function Ai(t,e){this.serializer=t,this.ct=e}function Si(t){this.elements=t}function xi(t){this.elements=t}function ki(t){return gi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Li(t,e){this.version=t,this.transformResults=e}var Di,Ri,Oi,Pi,Vi,Ci=(ro.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},ro.prototype.isEqual=function(t){return Ys(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ro),Mi=(no.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},no),ji=(eo.ft=function(){return new eo},eo.exists=function(t){return new eo(void 0,t)},eo.updateTime=function(t){return new eo(t)},Object.defineProperty(eo.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),eo.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof wo&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof wo},eo.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},eo),Ui=(to.prototype.It=function(t){},to.wt=function(t){return t instanceof wo?t.version:Dr.min()},to),qi=(n($i,Vi=Ui),$i.prototype.at=function(t,e){this.It(t);var n=e.version;return new wo(this.key,n,this.value,{hasCommittedMutations:!0})},$i.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Ui.wt(t);return new wo(this.key,r,this.value,{At:!0})},$i.prototype.Pt=function(t){return null},$i.prototype.isEqual=function(t){return t instanceof $i&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},$i),Fi=(n(Zi,Pi=Ui),Zi.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.gt(t);return new wo(this.key,e.version,n,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Ui.wt(t),i=this.gt(t);return new wo(this.key,r,i,{At:!0})},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},Zi.prototype.gt=function(t){var e=t instanceof wo?t.data():Hi.empty();return this.pt(e)},Zi.prototype.pt=function(t){var n=this,r=new Ki(t);return this.Vt.fields.forEach(function(t){var e;t.B()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.yt()},Zi),Bi=(n(Ji,Oi=Ui),Ji.prototype.at=function(t,e){if(this.It(t),Hs(null!=e.transformResults),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new wo(this.key,i,o,{hasCommittedMutations:!0})},Ji.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new wo(this.key,r.version,o,{At:!0})},Ji.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof wo?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Ki).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&Ys(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},Ji.prototype.bt=function(t){return t},Ji.prototype.vt=function(t,e){var n=[];Hs(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof wo&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},Ji.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof wo&&(a=e.field(s.field)),null===a&&n instanceof wo&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},Ji.prototype.St=function(t,e){for(var n=new Ki(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},Ji),Gi=(n(Qi,Ri=Ui),Qi.prototype.at=function(t,e){return this.It(t),new bo(this.key,e.version,{hasCommittedMutations:!0})},Qi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new bo(this.key,Dr.min()):t},Qi.prototype.Pt=function(t){return null},Qi.prototype.isEqual=function(t){return t instanceof Qi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Qi),zi=(n(Yi,Di=Ui),Yi.prototype.at=function(t,e){zs()},Yi.prototype.ot=function(t,e,n){zs()},Yi.prototype.Pt=function(t){zs()},Yi.prototype.isEqual=function(t){return t instanceof Yi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Yi),Hi=(Xi.empty=function(){return new Xi({mapValue:{}})},Xi.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!bi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},Xi.prototype.isEqual=function(t){return ui(this.proto,t.proto)},Xi),Ki=(Wi.prototype.set=function(t,e){return this.Nt(t,e),this},Wi.prototype.delete=function(t){return this.Nt(t,null),this},Wi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===si(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Wi.prototype.yt=function(){var t=this.kt(Hr.G,this.Ft);return null!=t?new Hi(t):this.Ct},Wi.prototype.kt=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=bi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.kt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Wi);function Wi(t){void 0===t&&(t=Hi.empty()),this.Ct=t,this.Ft=new Map}function Xi(t){this.proto=t}function Yi(t,e){var n=this;return(n=Di.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Qi(t,e){var n=this;return(n=Ri.call(this)||this).key=t,n.Rt=e,n.type=3,n}function Ji(t,e){var n=this;return(n=Oi.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=ji.exists(!0),n}function Zi(t,e,n,r){var i=this;return(i=Pi.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function $i(t,e,n){var r=this;return(r=Vi.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function to(){}function eo(t,e){this.updateTime=t,this.exists=e}function no(t,e){this.field=t,this.transform=e}function ro(t){(this.fields=t).sort(Hr.N)}function io(t){var u=[];return Qr(t.fields||{},function(t,e){var n=new Hr([t]);if(bi(e)){var r=io(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ci(u)}function oo(t,e){this.key=t,this.version=e}function so(t){this.count=t}var uo,ao,ho,co,fo,lo,po,yo,vo,go,mo,wo=(n(Ko,mo=oo),Ko.prototype.field=function(t){return this.$t.field(t)},Ko.prototype.data=function(){return this.$t},Ko.prototype.Mt=function(){return this.$t.proto},Ko.prototype.isEqual=function(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.$t.isEqual(t.$t)},Ko.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.$t.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Ko.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ko),bo=(n(Ho,go=oo),Ho.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ho.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ho.prototype.isEqual=function(t){return t instanceof Ho&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ho),Eo=(n(zo,vo=oo),zo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),zo.prototype.isEqual=function(t){return t instanceof zo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zo),Io=(Go.prototype.canonicalId=function(){var t;return null===this.Lt&&(t=this.path.j(),null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ti(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Lt=t),this.Lt},Go.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ti(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Go.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Go.prototype.xt=function(){return Wr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Go),To=(Bo.Wt=function(t){return new Bo(t)},Object.defineProperty(Bo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Do(t)),this.qt.push(new Do(Hr.J(),"asc"));else{for(var n,r=!1,i=0,o=this.Ot;i<o.length;i++){var s=o[i];this.qt.push(s),s.field.Y()&&(r=!0)}r||(n=0<this.Ot.length?this.Ot[this.Ot.length-1].dir:"asc",this.qt.push(new Do(Hr.J(),n)))}}return this.qt},enumerable:!0,configurable:!0}),Bo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Bo(this.path,this.collectionGroup,this.Ot.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.zt=function(t){var e=this.Ot.concat([t]);return new Bo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.Ht=function(t){return new Bo(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Bo.prototype.Yt=function(t){return new Bo(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Bo.prototype.Jt=function(t){return new Bo(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Bo.prototype.Xt=function(t){return new Bo(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Bo.prototype.Zt=function(t){return new Bo(t,null,this.Ot.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Ot.length||1===this.Ot.length&&this.Ot[0].field.Y())},Bo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Bo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Bo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Bo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Bo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Bo.prototype.oe=function(){return!ti(this.limit)&&"F"===this.Bt},Bo.prototype.ae=function(){return!ti(this.limit)&&"L"===this.Bt},Bo.prototype.Kt=function(){return 0<this.Ot.length?this.Ot[0].field:null},Bo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof No&&n.ue())return n.field}return null},Bo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof No&&0<=t.indexOf(r.op))return r.op}return null},Bo.prototype.xt=function(){return this.ee().xt()},Bo.prototype._e=function(){return null!==this.collectionGroup},Bo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new Io(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Do(r.field,i))}var o=this.endAt?new Lo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Lo(this.startAt.position,!this.startAt.before):null;this.Ut=new Io(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Bo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Wr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Bo.prototype.ne=function(t){for(var e=0,n=this.Ot;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Bo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Bo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Bo.prototype.Qt=function(t){},Bo),No=(n(Fo,yo=function(){}),Fo.create=function(t,e,n){if(t.Y())return"in"===e?new Ao(t,n):new _o(t,e,n);if(mi(n)){if("=="!==e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fo(t,e,n)}if(wi(n)){if("=="!==e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fo(t,e,n)}return"array-contains"===e?new So(t,n):"in"===e?new xo(t,n):"array-contains-any"===e?new ko(t,n):new Fo(t,e,n)},Fo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&si(this.value)===si(e)&&this.de(hi(e,this.value))},Fo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return zs()}},Fo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Fo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+fi(this.value)},Fo.prototype.isEqual=function(t){return t instanceof Fo&&this.op===t.op&&this.field.isEqual(t.field)&&ui(this.value,t.value)},Fo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+fi(this.value)},Fo),_o=(n(qo,po=No),qo.prototype.matches=function(t){var e=Wr.N(t.key,this.key);return this.de(e)},qo),Ao=(n(Uo,lo=No),Uo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Uo),So=(n(jo,fo=No),jo.prototype.matches=function(t){var e=t.field(this.field);return gi(e)&&ai(e.arrayValue,this.value)},jo),xo=(n(Mo,co=No),Mo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ai(this.value.arrayValue,e)},Mo),ko=(n(Co,ho=No),Co.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!gi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ai(e.value.arrayValue,t)})},Co),Lo=(Vo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(fi).join(",")},Vo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r],n=i.field.Y()?Wr.N(Wr.Z(o.referenceValue),e.key):hi(o,e.field(i.field));if("desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Vo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ui(this.position[e],t.position[e]))return!1;return!0},Vo),Do=(Po.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Wr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?hi(i,o):zs());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return zs()}},Po.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Po.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Po.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Po),Ro=(Oo.prototype.Ie=function(t){return new Oo(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Oo.prototype.we=function(t,e){return new Oo(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Oo.prototype.Re=function(t){return new Oo(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Oo);function Oo(t,e,n,r,i,o,s){void 0===i&&(i=Dr.min()),void 0===o&&(o=Dr.min()),void 0===s&&(s=Zr.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Po(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function Vo(t,e){this.position=t,this.before=e}function Co(t,e){return ho.call(this,t,"array-contains-any",e)||this}function Mo(t,e){return co.call(this,t,"in",e)||this}function jo(t,e){return fo.call(this,t,"array-contains",e)||this}function Uo(t,e){var n=this;return(n=lo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Wr.Z(t.referenceValue)}),n}function qo(t,e,n){var r=this;return(r=po.call(this,t,e,n)||this).key=Wr.Z(n.referenceValue),r}function Fo(t,e,n){var r=this;return(r=yo.call(this)||this).field=t,r.op=e,r.value=n,r}function Bo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Ot=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Go(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Lt=null}function zo(){return null!==vo&&vo.apply(this,arguments)||this}function Ho(t,e,n){var r=this;return(r=go.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Ko(t,e,n,r){var i=this;return(i=mo.call(this,t,e)||this).$t=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Wo(t){switch(t){case Nr.OK:return zs();case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return 1;default:return zs()}}function Xo(t){if(void 0===t)return Bs("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case uo.OK:return Nr.OK;case uo.CANCELLED:return Nr.CANCELLED;case uo.UNKNOWN:return Nr.UNKNOWN;case uo.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case uo.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case uo.INTERNAL:return Nr.INTERNAL;case uo.UNAVAILABLE:return Nr.UNAVAILABLE;case uo.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case uo.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case uo.NOT_FOUND:return Nr.NOT_FOUND;case uo.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case uo.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case uo.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case uo.ABORTED:return Nr.ABORTED;case uo.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case uo.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case uo.DATA_LOSS:return Nr.DATA_LOSS;default:return zs()}}(ao=uo=uo||{})[ao.OK=0]="OK",ao[ao.CANCELLED=1]="CANCELLED",ao[ao.UNKNOWN=2]="UNKNOWN",ao[ao.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ao[ao.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ao[ao.NOT_FOUND=5]="NOT_FOUND",ao[ao.ALREADY_EXISTS=6]="ALREADY_EXISTS",ao[ao.PERMISSION_DENIED=7]="PERMISSION_DENIED",ao[ao.UNAUTHENTICATED=16]="UNAUTHENTICATED",ao[ao.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ao[ao.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ao[ao.ABORTED=10]="ABORTED",ao[ao.OUT_OF_RANGE=11]="OUT_OF_RANGE",ao[ao.UNIMPLEMENTED=12]="UNIMPLEMENTED",ao[ao.INTERNAL=13]="INTERNAL",ao[ao.UNAVAILABLE=14]="UNAVAILABLE",ao[ao.DATA_LOSS=15]="DATA_LOSS";var Yo=(ts.prototype.me=function(t,e){return new ts(this.N,this.root.me(t,e,this.N).Ae(null,null,Jo.Pe,null,null))},ts.prototype.remove=function(t){return new ts(this.N,this.root.remove(t,this.N).Ae(null,null,Jo.Pe,null,null))},ts.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ts.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ts.prototype.B=function(){return this.root.B()},Object.defineProperty(ts.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),ts.prototype.Ve=function(){return this.root.Ve()},ts.prototype.ge=function(){return this.root.ge()},ts.prototype.pe=function(t){return this.root.pe(t)},ts.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},ts.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ts.prototype.ye=function(t){return this.root.ye(t)},ts.prototype.be=function(){return new Qo(this.root,null,this.N,!1)},ts.prototype.ve=function(t){return new Qo(this.root,t,this.N,!1)},ts.prototype.Se=function(){return new Qo(this.root,null,this.N,!0)},ts.prototype.De=function(t){return new Qo(this.root,t,this.N,!0)},ts),Qo=($o.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},$o.prototype.ke=function(){return 0<this.Fe.length},$o.prototype.$e=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},$o),Jo=(Zo.prototype.Ae=function(t,e,n,r,i){return new Zo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Zo.prototype.B=function(){return!1},Zo.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},Zo.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},Zo.prototype.min=function(){return this.left.B()?this:this.left.min()},Zo.prototype.Ve=function(){return this.min().key},Zo.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},Zo.prototype.me=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.Ae(null,null,null,r.left.me(t,e,n),null):0===i?r.Ae(null,e,null,null,null):r.Ae(null,null,null,null,r.right.me(t,e,n))).Me()},Zo.prototype.Le=function(){if(this.left.B())return Zo.EMPTY;var t=this;return t.left.xe()||t.left.left.xe()||(t=t.Oe()),(t=t.Ae(null,null,null,t.left.Le(),null)).Me()},Zo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.xe()||r.left.left.xe()||(r=r.Oe()),r=r.Ae(null,null,null,r.left.remove(t,e),null);else{if(r.left.xe()&&(r=r.Be()),r.right.B()||r.right.xe()||r.right.left.xe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return Zo.EMPTY;n=r.right.min(),r=r.Ae(n.key,n.value,null,null,r.right.Le())}r=r.Ae(null,null,null,null,r.right.remove(t,e))}return r.Me()},Zo.prototype.xe=function(){return this.color},Zo.prototype.Me=function(){var t=this;return t.right.xe()&&!t.left.xe()&&(t=t.Ue()),t.left.xe()&&t.left.left.xe()&&(t=t.Be()),t.left.xe()&&t.right.xe()&&(t=t.Qe()),t},Zo.prototype.Oe=function(){var t=this.Qe();return t.right.left.xe()&&(t=(t=(t=t.Ae(null,null,null,null,t.right.Be())).Ue()).Qe()),t},Zo.prototype.qe=function(){var t=this.Qe();return t.left.left.xe()&&(t=(t=t.Be()).Qe()),t},Zo.prototype.Ue=function(){var t=this.Ae(null,null,Zo.RED,null,this.right.left);return this.right.Ae(null,null,this.color,t,null)},Zo.prototype.Be=function(){var t=this.Ae(null,null,Zo.RED,this.left.right,null);return this.left.Ae(null,null,this.color,null,t)},Zo.prototype.Qe=function(){var t=this.left.Ae(null,null,!this.left.color,null,null),e=this.right.Ae(null,null,!this.right.color,null,null);return this.Ae(null,null,!this.color,t,e)},Zo.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},Zo.prototype.je=function(){if(this.xe()&&this.left.xe())throw zs();if(this.right.xe())throw zs();var t=this.left.je();if(t!==this.right.je())throw zs();return t+(this.xe()?0:1)},Zo);function Zo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Zo.RED,this.left=null!=r?r:Zo.EMPTY,this.right=null!=i?i:Zo.EMPTY,this.size=this.left.size+1+this.right.size}function $o(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function ts(t,e){this.N=t,this.root=e||Jo.EMPTY}function es(){this.size=0}Jo.EMPTY=null,Jo.RED=!0,Jo.Pe=!1,Jo.EMPTY=(Object.defineProperty(es.prototype,"key",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"value",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"color",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"left",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"right",{get:function(){throw zs()},enumerable:!0,configurable:!0}),es.prototype.Ae=function(t,e,n,r,i){return this},es.prototype.me=function(t,e,n){return new Jo(t,e)},es.prototype.remove=function(t,e){return this},es.prototype.B=function(){return!0},es.prototype.pe=function(t){return!1},es.prototype.ye=function(t){return!1},es.prototype.Ve=function(){return null},es.prototype.ge=function(){return null},es.prototype.xe=function(){return!1},es.prototype.We=function(){return!0},es.prototype.je=function(){return 0},new es);var ns=(ss.prototype.has=function(t){return null!==this.data.get(t)},ss.prototype.first=function(){return this.data.Ve()},ss.prototype.last=function(){return this.data.ge()},Object.defineProperty(ss.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),ss.prototype.indexOf=function(t){return this.data.indexOf(t)},ss.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},ss.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.ke();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},ss.prototype.Ge=function(t,e){for(var n=void 0!==e?this.data.ve(e):this.data.be();n.ke();)if(!t(n.Ne().key))return},ss.prototype.ze=function(t){var e=this.data.ve(t);return e.ke()?e.Ne().key:null},ss.prototype.be=function(){return new rs(this.data.be())},ss.prototype.ve=function(t){return new rs(this.data.ve(t))},ss.prototype.add=function(t){return this.Ae(this.data.remove(t).me(t,!0))},ss.prototype.delete=function(t){return this.has(t)?this.Ae(this.data.remove(t)):this},ss.prototype.B=function(){return this.data.B()},ss.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},ss.prototype.isEqual=function(t){if(!(t instanceof ss))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},ss.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ss.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ss.prototype.Ae=function(t){var e=new ss(this.N);return e.data=t,e},ss),rs=(os.prototype.Ne=function(){return this.Ye.Ne().key},os.prototype.ke=function(){return this.Ye.ke()},os),is=new Yo(Wr.N);function os(t){this.Ye=t}function ss(t){this.N=t,this.data=new Yo(this.N)}var us=new Yo(Wr.N);var as=new Yo(Wr.N);var hs=new ns(Wr.N);function cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var fs=new ns(Xs);function ls(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function ps(t,e){this.targetId=t,this.ms=e}function ds(t,e,n,r){void 0===n&&(n=Zr.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ys=(xs.Ze=function(t){return new xs(t.N)},xs.prototype.has=function(t){return null!=this.Je.get(t)},xs.prototype.get=function(t){return this.Je.get(t)},xs.prototype.first=function(){return this.Xe.Ve()},xs.prototype.last=function(){return this.Xe.ge()},xs.prototype.B=function(){return this.Xe.B()},xs.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(xs.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),xs.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},xs.prototype.add=function(t){var e=this.delete(t.key);return e.Ae(e.Je.me(t.key,t),e.Xe.me(t,null))},xs.prototype.delete=function(t){var e=this.get(t);return e?this.Ae(this.Je.remove(t),this.Xe.remove(e)):this},xs.prototype.isEqual=function(t){if(!(t instanceof xs))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},xs.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},xs.prototype.Ae=function(t,e){var n=new xs;return n.N=this.N,n.Je=t,n.Xe=e,n},xs),vs=(Ss.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.me(e,t):3===t.type&&1!==n.type?this.ts=this.ts.me(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.me(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.me(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):zs()},Ss.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},Ss),gs=(As.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new As(t,e,ys.Ze(e),i,n,r,!0,!1)},Object.defineProperty(As.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),As.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},As),ms=(_s.ls=function(t,e){var n=new Map;return n.set(t,ws.ds(t,e)),new _s(Dr.min(),n,fs,is,cs())},_s),ws=(Ns.ds=function(t,e){return new Ns(Zr.ht,e,cs(),cs(),cs())},Ns),bs=(Object.defineProperty(Ts.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"ys",{get:function(){return 0!==this.As},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Ts.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Ts.prototype.Ss=function(){var n=cs(),r=cs(),i=cs();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:zs()}}),new ws(this.Vs,this.gs,n,r,i)},Ts.prototype.Ds=function(){this.ps=!1,this.Ps=Ls()},Ts.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.me(t,e)},Ts.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Ts.prototype.Ns=function(){this.As+=1},Ts.prototype.ks=function(){--this.As},Ts.prototype.$s=function(){this.ps=!0,this.gs=!0},Ts),Es=(Is.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof wo?this.Us(r,t.Rs):t.Rs instanceof bo&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},Is.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.ks(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.ks(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.$s(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:zs()}})},Is.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ls.forEach(function(t,e){r.Gs(e)&&n(e)})},Is.prototype.Hs=function(t){var e,n,r=t.targetId,i=t.ms.count,o=this.Ys(r);o&&((e=o.target).xt()?0===i?(n=new Wr(e.path),this.Qs(r,n,new bo(n,Dr.min()))):Hs(1===i):this.Js(r)!==i&&(this.zs(r),this.Bs=this.Bs.add(r)))},Is.prototype.Xs=function(i){var o=this,s=new Map;this.Ls.forEach(function(t,e){var n,r=o.Ys(e);r&&(t.fs&&r.target.xt()&&(n=new Wr(r.target.path),null!==o.xs.get(n)||o.Zs(e,n)||o.Qs(e,n,new bo(n,i))),t.bs&&(s.set(e,t.Ss()),t.Ds()))});var r=cs();this.Os.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new ms(i,s,this.Bs,this.xs,r);return this.xs=is,this.Os=ks(),this.Bs=new ns(Xs),t},Is.prototype.Us=function(t,e){var n;this.Gs(t)&&(n=this.Zs(t,e.key)?2:0,this.Ks(t).Cs(e.key,n),this.xs=this.xs.me(e.key,e),this.Os=this.Os.me(e.key,this.ti(e.key).add(t)))},Is.prototype.Qs=function(t,e,n){var r;this.Gs(t)&&(r=this.Ks(t),this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.Os=this.Os.me(e,this.ti(e).delete(t)),n&&(this.xs=this.xs.me(e,n)))},Is.prototype.removeTarget=function(t){this.Ls.delete(t)},Is.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ms.ei(t).size+e.Ts.size-e.Is.size},Is.prototype.Ns=function(t){this.Ks(t).Ns()},Is.prototype.Ks=function(t){var e=this.Ls.get(t);return e||(e=new bs,this.Ls.set(t,e)),e},Is.prototype.ti=function(t){var e=this.Os.get(t);return e||(e=new ns(Xs),this.Os=this.Os.me(t,e)),e},Is.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Fs("WatchChangeAggregator","Detected inactive target",t),e},Is.prototype.Ys=function(t){var e=this.Ls.get(t);return e&&e.ys?null:this.Ms.si(t)},Is.prototype.zs=function(e){var n=this;this.Ls.set(e,new bs),this.Ms.ei(e).forEach(function(t){n.Qs(e,t,null)})},Is.prototype.Zs=function(t,e){return this.Ms.ei(t).has(e)},Is);function Is(t){this.Ms=t,this.Ls=new Map,this.xs=is,this.Os=ks(),this.Bs=new ns(Xs)}function Ts(){this.As=0,this.Ps=Ls(),this.Vs=Zr.ht,this.gs=!1,this.ps=!0}function Ns(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function _s(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function As(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Ss(){this.ts=new Yo(Wr.N)}function xs(n){this.N=n?function(t,e){return n(t,e)||Wr.N(t.key,e.key)}:function(t,e){return Wr.N(t.key,e.key)},this.Je=us,this.Xe=new Yo(this.N)}function ks(){return new Yo(Wr.N)}function Ls(){return new Yo(Wr.N)}var Ds={asc:"ASCENDING",desc:"DESCENDING"},Rs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Os=(Ps.prototype.ni=function(t){var e=void 0===t.code?Nr.UNKNOWN:Xo(t.code);return new _r(e,t.message||"")},Ps.prototype.ri=function(t){return this.options.hi||ti(t)?t:{value:t}},Ps.prototype.oi=function(t){var e;return ti(e="object"==typeof t?t.value:t)?null:e},Ps.prototype._t=function(t){return{integerValue:""+t}},Ps.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(t)?"-0":t}},Ps.prototype.ai=function(t){return ni(t)?this._t(t):this.lt(t)},Ps.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Ps.prototype.v=function(t){var e=li(t);return new Lr(e.seconds,e.nanos)},Ps.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Ps.prototype.ci=function(t){return this.options.hi?(Hs(void 0===t||"string"==typeof t),Zr.fromBase64String(t||"")):(Hs(void 0===t||t instanceof Uint8Array),Zr.fromUint8Array(t||new Uint8Array))},Ps.prototype.toVersion=function(t){return this.C(t.C())},Ps.prototype.fromVersion=function(t){return Hs(!!t),Dr.v(this.v(t))},Ps.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Ps.prototype.di=function(t){var e=Or.K(t);return Hs(Vs(e)),e},Ps.prototype.fi=function(t){return this._i(t.path)},Ps.prototype.Z=function(t){var e=this.di(t);return Hs(e.get(1)===this.ii.projectId),Hs(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Wr(this.Ti(e))},Ps.prototype.Ei=function(t){return this._i(t)},Ps.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Or.G:this.Ti(e)},Object.defineProperty(Ps.prototype,"wi",{get:function(){return new Or(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Ps.prototype.li=function(t){return new Or(["projects",t.projectId,"databases",t.database])},Ps.prototype.Ti=function(t){return Hs(4<t.length&&"documents"===t.get(4)),t.$(5)},Ps.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Ps.prototype.mi=function(t){return{name:this.fi(t.key),fields:t.Mt().mapValue.fields,updateTime:this.C(t.version.C())}},Ps.prototype.Ai=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Hi({mapValue:{fields:t.fields}});return new wo(n,r,i,{hasCommittedMutations:!!e})},Ps.prototype.Pi=function(t){Hs(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Hi({mapValue:{fields:t.found.fields}});return new wo(e,n,r,{})},Ps.prototype.Vi=function(t){Hs(!!t.missing),Hs(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new bo(e,n)},Ps.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):zs()},Ps.prototype.pi=function(t){if("targetChange"in t){t.targetChange;var e=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],r=this.ci(t.targetChange.resumeToken),i=t.targetChange.cause,o=new ds(e,n,r,i&&this.ni(i)||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var u=this.Z(s.document.name),a=this.fromVersion(s.document.updateTime),h=new Hi({mapValue:{fields:s.document.fields}}),c=new wo(u,a,h,{});o=new ls(s.targetIds||[],s.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){t.documentDelete;var f=t.documentDelete;f.document;var l=this.Z(f.document),p=f.readTime?this.fromVersion(f.readTime):Dr.min(),d=new bo(l,p);o=new ls([],f.removedTargetIds||[],d.key,d)}else if("documentRemove"in t){t.documentRemove;var y=t.documentRemove;y.document;var v=this.Z(y.document);o=new ls([],y.removedTargetIds||[],v,null)}else{if(!("filter"in t))return zs();t.filter;var g=t.filter;g.targetId;var m=new so(g.count||0);o=new ps(g.targetId,m)}return o},Ps.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:zs()},Ps.prototype.bi=function(t){if(!("targetChange"in t))return Dr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Dr.min():this.fromVersion(e.readTime)},Ps.prototype.vi=function(t){var e,n=this;if(t instanceof qi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Gi)e={delete:this.fi(t.key)};else if(t instanceof Fi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Bi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof zi))return zs();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Ps.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):ji.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Hi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.ki(t.updateMask);return new Fi(r,i,o,n)}return new qi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Gi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.$i(t)});return Hs(!0===n.exists),new Bi(u,a)}if(t.verify){var h=this.Z(t.verify);return new zi(h,n)}return zs()},Ps.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zs()},Ps.prototype.Ni=function(t){return void 0!==t.updateTime?ji.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ji.exists(t.exists):ji.ft()},Ps.prototype.Mi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Dr.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Li(n,r)},Ps.prototype.Li=function(t,e){var n=this;return t&&0<t.length?(Hs(void 0!==e),t.map(function(t){return n.Mi(t,e)})):[]},Ps.prototype.Di=function(t){var e=t.transform;if(e instanceof Ei)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ti)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Ni)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof _i)return{fieldPath:t.field.j(),increment:e.ct};throw zs()},Ps.prototype.$i=function(t){var e,n,r=null;"setToServerValue"in t?(Hs("REQUEST_TIME"===t.setToServerValue),r=Ei.instance):"appendMissingElements"in t?(e=t.appendMissingElements.values||[],r=new Ti(e)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Ni(n)):"increment"in t?r=new _i(this,t.increment):zs();var i=Hr.X(t.fieldPath);return new Mi(i,r)},Ps.prototype.xi=function(t){return{documents:[this.Ei(t.path)]}},Ps.prototype.Oi=function(t){Hs(1===t.documents.length);var e=t.documents[0];return To.Wt(this.Ii(e)).ee()},Ps.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.M()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Ps.prototype.Wi=function(t){var e,n=this.Ii(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Hs(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=this.ji(r.where));var u=[];r.orderBy&&(u=this.Ki(r.orderBy));var a=null;r.limit&&(a=this.oi(r.limit));var h=null;r.startAt&&(h=this.Gi(r.startAt));var c=null;return r.endAt&&(c=this.Gi(r.endAt)),new To(n,o,u,s,a,"F",h,c).ee()},Ps.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Ps.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zs()}},Ps.prototype.ee=function(t){var e,n=t.target;return(e=n.xt()?{documents:this.xi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Ps.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof No?e.Yi(t):zs()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Ps.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):zs():[]},Ps.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Ps.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Ps.prototype.Qi=function(t){return{before:t.before,values:t.position}},Ps.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new Lo(n,e)},Ps.prototype.en=function(t){return Ds[t]},Ps.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Ps.prototype.nn=function(t){return Rs[t]},Ps.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return zs()}},Ps.prototype.hn=function(t){return{fieldPath:t.j()}},Ps.prototype.on=function(t){return Hr.X(t.fieldPath)},Ps.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Ps.prototype.tn=function(t){return new Do(this.on(t.field),this.sn(t.direction))},Ps.prototype.Xi=function(t){return No.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Ps.prototype.Yi=function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(mi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Ps.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return No.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return No.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return zs()}},Ps.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Ps.prototype.ki=function(t){var e=t.fieldPaths||[];return new Ci(e.map(function(t){return Hr.X(t)}))},Ps);function Ps(t,e){this.ii=t,this.options=e}function Vs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Cs=(js.an=function(t){js.platform&&zs(),js.platform=t},js.nt=function(){return js.platform||zs(),js.platform},js),Ms=new h("@firebase/firestore");function js(){}function Us(){return Ms.logLevel}function qs(t){Ms.logLevel=t}function Fs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ms.logLevel<=l.DEBUG&&(e=n.map(Gs),Ms.debug.apply(Ms,i(["Firestore ("+mr+"): "+t],e)))}function Bs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ms.logLevel<=l.ERROR&&(e=n.map(Gs),Ms.error.apply(Ms,i(["Firestore ("+mr+"): "+t],e)))}function Gs(t){if("string"==typeof t)return t;var e=Cs.nt();try{return e.un(t)}catch(e){return t}}function zs(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+mr+") INTERNAL ASSERTION FAILED: "+t;throw Bs(e),new Error(e)}function Hs(t){t||zs()}var Ks=(Ws.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Cs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ws);function Ws(){}function Xs(t,e){return t<e?-1:e<t?1:0}function Ys(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Qs(t){return t+"\0"}function Js(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Zs=(Object.defineProperty(Iu.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Iu.prototype.isEqual=function(t){return t instanceof Iu&&t.projectId===this.projectId&&t.database===this.database},Iu.prototype.S=function(t){return Xs(this.projectId,t.projectId)||Xs(this.database,t.database)},Iu),$s=(Eu.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},Eu.prototype.has=function(t){return void 0!==this.get(t)},Eu.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},Eu.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},Eu.prototype.forEach=function(u){Qr(this.fn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},Eu.prototype.B=function(){return Jr(this.fn)},Eu),tu=(bu.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o,s=this.mutations[i];s.key.isEqual(t)&&(o=r[i],e=s.at(e,o))}return e},bu.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},bu.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.me(t.key,e))}),i},bu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cs())},bu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ys(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Ys(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},bu),eu=(wu.from=function(t,e,n,r){Hs(t.mutations.length===n.length);for(var i=as,o=t.mutations,s=0;s<o.length;s++)i=i.me(o[s].key,n[s].version);return new wu(t,e,n,r,i)},wu),nu=(mu.prototype.B=function(){return this.mn.B()},mu.prototype.gn=function(t,e){var n=new ru(t,e);this.mn=this.mn.add(n),this.Pn=this.Pn.add(n)},mu.prototype.pn=function(t,e){var n=this;t.forEach(function(t){return n.gn(t,e)})},mu.prototype.yn=function(t,e){this.bn(new ru(t,e))},mu.prototype.vn=function(t,e){var n=this;t.forEach(function(t){return n.yn(t,e)})},mu.prototype.Sn=function(t){var e=this,n=Wr.EMPTY,r=new ru(n,t),i=new ru(n,t+1),o=[];return this.Pn.Ke([r,i],function(t){e.bn(t),o.push(t.key)}),o},mu.prototype.Dn=function(){var e=this;this.mn.forEach(function(t){return e.bn(t)})},mu.prototype.bn=function(t){this.mn=this.mn.delete(t),this.Pn=this.Pn.delete(t)},mu.prototype.Cn=function(t){var e=Wr.EMPTY,n=new ru(e,t),r=new ru(e,t+1),i=cs();return this.Pn.Ke([n,r],function(t){i=i.add(t.key)}),i},mu.prototype.Fn=function(t){var e=new ru(t,0),n=this.mn.ze(e);return null!==n&&t.isEqual(n.key)},mu),ru=(gu.An=function(t,e){return Wr.N(t.key,e.key)||Xs(t.Nn,e.Nn)},gu.Vn=function(t,e){return Xs(t.Nn,e.Nn)||Wr.N(t.key,e.key)},gu),iu=(vu.prototype.catch=function(t){return this.next(void 0,t)},vu.prototype.next=function(r,i){var o=this;return this.Ln&&zs(),this.Ln=!0,this.Mn?this.error?this.xn(i,this.error):this.On(r,this.result):new vu(function(e,n){o.kn=function(t){o.On(r,t).next(e,n)},o.$n=function(t){o.xn(i,t).next(e,n)}})},vu.prototype.Bn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},vu.prototype.qn=function(t){try{var e=t();return e instanceof vu?e:vu.resolve(e)}catch(t){return vu.reject(t)}},vu.prototype.On=function(t,e){return t?this.qn(function(){return t(e)}):vu.resolve(e)},vu.prototype.xn=function(t,e){return t?this.qn(function(){return t(e)}):vu.reject(e)},vu.resolve=function(n){return new vu(function(t,e){t(n)})},vu.reject=function(n){return new vu(function(t,e){e(n)})},vu.Un=function(t){return new vu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},vu.Qn=function(t){for(var n=vu.resolve(!1),e=function(e){n=n.next(function(t){return t?vu.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},vu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Un(i)},vu),ou=(Object.defineProperty(yu.prototype,"readTime",{get:function(){return this.Kn},set:function(t){this.Kn=t},enumerable:!0,configurable:!0}),yu.prototype.Gn=function(t,e){this.zn(),this.readTime=e,this.Wn.set(t.key,t)},yu.prototype.Hn=function(t,e){this.zn(),e&&(this.readTime=e),this.Wn.set(t,null)},yu.prototype.Yn=function(t,e){this.zn();var n=this.Wn.get(e);return void 0!==n?iu.resolve(n):this.Jn(t,e)},yu.prototype.getEntries=function(t,e){return this.Xn(t,e)},yu.prototype.apply=function(t){return this.zn(),this.jn=!0,this.Zn(t)},yu.prototype.zn=function(){},yu),su="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",uu=(du.prototype.er=function(t){this.tr.push(t)},du.prototype.sr=function(){this.tr.forEach(function(t){return t()})},du),au=(pu.prototype.hr=function(e,n){var r=this;return this.nr.or(e,n).next(function(t){return r.ar(e,n,t)})},pu.prototype.ar=function(t,r,i){return this.ir.Yn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},pu.prototype.ur=function(t,e,i){var o=is;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.me(t,e)}),o},pu.prototype.cr=function(e,t){var n=this;return this.ir.getEntries(e,t).next(function(t){return n._r(e,t)})},pu.prototype._r=function(r,i){var o=this;return this.nr.lr(r,i).next(function(t){var e=o.ur(r,i,t),n=is;return e.forEach(function(t,e){e=e||new bo(t,Dr.min()),n=n.me(t,e)}),n})},pu.prototype.dr=function(t,e,n){return e.xt()?this.Tr(t,e.path):e._e()?this.Er(t,e,n):this.Ir(t,e,n)},pu.prototype.Tr=function(t,e){return this.hr(t,new Wr(e)).next(function(t){var e=us;return t instanceof wo&&(e=e.me(t.key,t)),e})},pu.prototype.Er=function(n,r,i){var o=this,s=r.collectionGroup,u=us;return this.rr.wr(n,s).next(function(t){return iu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.Ir(n,e,i).next(function(t){t.forEach(function(t,e){u=u.me(t,e)})})}).next(function(){return u})})},pu.prototype.Ir=function(e,n,t){var c,f,r=this;return this.ir.dr(e,n,t).next(function(t){return c=t,r.nr.Rr(e,n)}).next(function(t){return f=t,r.mr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.Tn);c=h instanceof wo?c.me(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},pu.prototype.mr=function(t,e,n){for(var r=cs(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Fi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.ir.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof wo&&(h=h.me(t,e))}),h})},pu),hu=(lu.Vr=function(t,e){for(var n=cs(),r=cs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new lu(t,e.fromCache,n,r)},lu),cu=(fu.prototype.pr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},fu.prototype.next=function(){var t=++this.previousValue;return this.yr&&this.yr(t),t},fu);function fu(t,e){var n=this;this.previousValue=t,e&&(e.gr=function(t){return n.pr(t)},this.yr=function(t){return e.br(t)})}function lu(t,e,n,r){this.targetId=t,this.fromCache=e,this.Ar=n,this.Pr=r}function pu(t,e,n){this.ir=t,this.nr=e,this.rr=n}function du(){this.tr=[]}function yu(){this.Wn=new $s(function(t){return t.toString()}),this.jn=!1}function vu(t){var e=this;this.kn=null,this.$n=null,this.result=void 0,this.error=void 0,this.Mn=!1,this.Ln=!1,t(function(t){e.Mn=!0,e.result=t,e.kn&&e.kn(t)},function(t){e.Mn=!0,e.error=t,e.$n&&e.$n(t)})}function gu(t,e){this.key=t,this.Nn=e}function mu(){this.mn=new ns(ru.An),this.Pn=new ns(ru.Vn)}function wu(t,e,n,r,i){this.batch=t,this.wn=e,this.En=n,this.streamToken=r,this.Rn=i}function bu(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function Eu(t){this.dn=t,this.fn={}}function Iu(t,e){this.projectId=t,this.database=e||"(default)"}function Tu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}cu.vr=-1;var Nu=(ku.prototype.reset=function(){this.kr=0},ku.prototype.Lr=function(){this.kr=this.Nr},ku.prototype.xr=function(t){var e=this;this.cancel();var n=Math.floor(this.kr+this.Or()),r=Math.max(0,Date.now()-this.Mr),i=Math.max(0,n-r);0<i&&Fs("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.kr+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.$r=this.Sr.Br(this.Dr,i,function(){return e.Mr=Date.now(),t()}),this.kr*=this.Fr,this.kr<this.Cr&&(this.kr=this.Cr),this.kr>this.Nr&&(this.kr=this.Nr)},ku.prototype.cancel=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},ku.prototype.Or=function(){return(Math.random()-.5)*this.kr},ku),_u=(xu.jr=function(t,e,n,r,i){var o=new xu(t,e,Date.now()+n,r,i);return o.start(n),o},xu.prototype.start=function(t){var e=this;this.Kr=setTimeout(function(){return e.Gr()},t)},xu.prototype.zr=function(){return this.Gr()},xu.prototype.cancel=function(t){null!==this.Kr&&(this.clearTimeout(),this.Wr.reject(new _r(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},xu.prototype.Gr=function(){var e=this;this.qr.Hr(function(){return null!==e.Kr?(e.clearTimeout(),e.op().then(function(t){return e.Wr.resolve(t)})):Promise.resolve()})},xu.prototype.clearTimeout=function(){null!==this.Kr&&(this.Qr(this),clearTimeout(this.Kr),this.Kr=null)},xu),Au=(Object.defineProperty(Su.prototype,"hh",{get:function(){return this.Xr},enumerable:!0,configurable:!0}),Su.prototype.Hr=function(t){this.enqueue(t)},Su.prototype.oh=function(t){this.ah(),this.uh(t)},Su.prototype._h=function(t){return this.ah(),this.uh(t)},Su.prototype.lh=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.ah(),this.Xr?[3,2]:(this.Xr=!0,(e=Cs.nt().window)&&e.removeEventListener("visibilitychange",this.nh),[4,this._h(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Su.prototype.enqueue=function(t){return this.ah(),this.Xr?new Promise(function(t){}):this.uh(t)},Su.prototype.dh=function(i){var t=this;this.ah(),this.Xr||(this.Jr=this.Jr.then(function(){var n=new Tu,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.ih.reset(),[3,3];case 2:if("IndexedDbTransactionError"!==(e=t.sent()).name)throw n.resolve(),e;return Fs("AsyncQueue","Operation failed with retryable error: "+e),this.ih.xr(r),[3,3];case 3:return[2]}})})};return t.Hr(r),n.promise}))},Su.prototype.uh=function(t){var e=this,n=this.Yr.then(function(){return e.eh=!0,t().catch(function(t){throw e.th=t,e.eh=!1,Bs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.eh=!1,t})});return this.Yr=n},Su.prototype.Br=function(t,e,n){var r=this;this.ah(),-1<this.sh.indexOf(t)&&(e=0);var i=_u.jr(this,t,e,n,function(t){return r.fh(t)});return this.Zr.push(i),i},Su.prototype.ah=function(){this.th&&zs()},Su.prototype.Th=function(){},Su.prototype.Eh=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Yr];case 1:t.sent(),t.label=2;case 2:if(e!==this.Yr)return[3,0];t.label=3;case 3:return[2]}})})},Su.prototype.Ih=function(t){for(var e=0,n=this.Zr;e<n.length;e++)if(n[e].Dr===t)return!0;return!1},Su.prototype.rh=function(r){var i=this;return this.Eh().then(function(){i.Zr.sort(function(t,e){return t.Ur-e.Ur});for(var t=0,e=i.Zr;t<e.length;t++){var n=e[t];if(n.zr(),"all"!==r&&n.Dr===r)break}return i.Eh()})},Su.prototype.wh=function(t){this.sh.push(t)},Su.prototype.fh=function(t){var e=this.Zr.indexOf(t);this.Zr.splice(e,1)},Su);function Su(){var t=this;this.Yr=Promise.resolve(),this.Jr=Promise.resolve(),this.Xr=!1,this.Zr=[],this.th=null,this.eh=!1,this.sh=[],this.ih=new Nu(this,"async_queue_retry"),this.nh=function(){t.rh("async_queue_retry")};var e=Cs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.nh)}function xu(t,e,n,r,i){this.qr=t,this.Dr=e,this.Ur=n,this.op=r,this.Qr=i,this.Wr=new Tu,this.then=this.Wr.promise.then.bind(this.Wr.promise),this.catch=this.Wr.promise.catch.bind(this.Wr.promise),this.Wr.promise.catch(function(t){})}function ku(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Sr=t,this.Dr=e,this.Cr=n,this.Fr=r,this.Nr=i,this.kr=0,this.$r=null,this.Mr=Date.now(),this.reset()}function Lu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Xs(n,i);return 0===s?Xs(r,o):s}var Du=(Vu.prototype.Ah=function(){return++this.mh},Vu.prototype.Ph=function(t){var e,n=[t,this.Ah()];this.buffer.size<this.Rh?this.buffer=this.buffer.add(n):Lu(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Vu.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Vu),Ru={Vh:!1,gh:0,ph:0,yh:0},Ou=(Pu.Dh=function(t){return new Pu(t,Pu.Ch,Pu.Fh)},Pu);function Pu(t,e,n){this.bh=t,this.vh=e,this.Sh=n}function Vu(t){this.Rh=t,this.buffer=new ns(Lu),this.mh=0}Ou.Nh=-1,Ou.kh=1048576,Ou.$h=41943040,Ou.Ch=10,Ou.Fh=1e3,Ou.Mh=new Ou(Ou.$h,Ou.Ch,Ou.Fh),Ou.DISABLED=new Ou(Ou.Nh,0,0);var Cu=(Uu.prototype.start=function(t){this.Lh.Bh.bh!==Ou.Nh&&this.qh(t)},Uu.prototype.stop=function(){this.Oh&&(this.Oh.cancel(),this.Oh=null)},Object.defineProperty(Uu.prototype,"Uh",{get:function(){return null!==this.Oh},enumerable:!0,configurable:!0}),Uu.prototype.qh=function(n){var t=this,e=this.xh?3e5:6e4;Fs("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Oh=this.qr.Br("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Oh=null,this.xh=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Qh(this.Lh)];case 2:return t.sent(),[3,7];case 3:return"IndexedDbTransactionError"!==(e=t.sent()).name?[3,4]:(Fs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]);case 4:return[4,mh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.qh(n)];case 8:return t.sent(),[2]}})})})},Uu),Mu=(ju.prototype.jh=function(t,e){return this.Wh.Kh(t).next(function(t){return Math.floor(e/100*t)})},ju.prototype.Gh=function(t,e){var n=this;if(0===e)return iu.resolve(cu.vr);var r=new Du(e);return this.Wh.js(t,function(t){return r.Ph(t.sequenceNumber)}).next(function(){return n.Wh.zh(t,function(t){return r.Ph(t)})}).next(function(){return r.maxValue})},ju.prototype.Hh=function(t,e,n){return this.Wh.Hh(t,e,n)},ju.prototype.Yh=function(t,e){return this.Wh.Yh(t,e)},ju.prototype.Jh=function(e,n){var r=this;return this.Bh.bh===Ou.Nh?(Fs("LruGarbageCollector","Garbage collection skipped; disabled"),iu.resolve(Ru)):this.Xh(e).next(function(t){return t<r.Bh.bh?(Fs("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.Bh.bh),Ru):r.Zh(e,n)})},ju.prototype.Xh=function(t){return this.Wh.Xh(t)},ju.prototype.Zh=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.jh(e,this.Bh.vh).next(function(t){return i=t>c.Bh.Sh?(Fs("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.Bh.Sh+" from "+t),c.Bh.Sh):t,s=Date.now(),c.Gh(e,i)}).next(function(t){return r=t,u=Date.now(),c.Hh(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Yh(e,r)}).next(function(t){return h=Date.now(),Us()<=l.DEBUG&&Fs("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),iu.resolve({Vh:!0,gh:i,ph:o,yh:t})})},ju);function ju(t,e){this.Wh=t,this.Bh=e}function Uu(t,e){this.Lh=t,this.qr=e,this.xh=!1,this.Oh=null}function qu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Bu(e)),e=Fu(t.get(n),e);return Bu(e)}function Fu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Bu(t){return t+""}function Gu(t){var e=t.length;if(Hs(2<=e),2===e)return Hs(""===t.charAt(0)&&""===t.charAt(1)),Or.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&zs(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:zs()}o=s+2}return new Or(r)}var zu,Hu=(ta.eo=function(o,t,s){return Fs("SimpleDb","Opening database:",o),new iu(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new ta(e))},i.onblocked=function(){r(new _r(Nr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new _r(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Fs("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,La).next(function(){Fs("SimpleDb","Database upgrade to version "+La+" complete")})}}).Bn()},ta.delete=function(t){return Fs("SimpleDb","Removing database:",t),ea(window.indexedDB.deleteDatabase(t)).Bn()},ta.so=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(ta.io())return!0;if(void 0===window.navigator)return!1;var t=p(),e=ta.to(t),n=0<e&&e<10,r=ta.no(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},ta.io=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.ro)},ta.ho=function(t,e){return t.store(e)},ta.to=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},ta.no=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},ta.prototype.oo=function(e){this.db.onversionchange=function(t){return e(t)}},ta.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Xu.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),iu.reject(t)}).Bn(),r={},n.catch(function(){}),[4,e.ao];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Fs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},ta.prototype.close=function(){this.db.close()},ta),Ku=(Object.defineProperty($u.prototype,"Mn",{get:function(){return this.co},enumerable:!0,configurable:!0}),Object.defineProperty($u.prototype,"lo",{get:function(){return this._o},enumerable:!0,configurable:!0}),Object.defineProperty($u.prototype,"cursor",{set:function(t){this.uo=t},enumerable:!0,configurable:!0}),$u.prototype.done=function(){this.co=!0},$u.prototype.do=function(t){this._o=t},$u.prototype.delete=function(){return ea(this.uo.delete())},$u),Wu=(n(Zu,zu=_r),Zu),Xu=(Ju.open=function(t,e,n){return new Ju(t.transaction(n,e))},Object.defineProperty(Ju.prototype,"ao",{get:function(){return this.fo.promise},enumerable:!0,configurable:!0}),Ju.prototype.abort=function(t){t&&this.fo.reject(t),this.aborted||(Fs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ju.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Yu(e)},Ju),Yu=(Qu.prototype.put=function(t,e){return ea(void 0!==e?(Fs("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Fs("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Qu.prototype.add=function(t){return Fs("SimpleDb","ADD",this.store.name,t,t),ea(this.store.add(t))},Qu.prototype.get=function(e){var n=this;return ea(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Fs("SimpleDb","GET",n.store.name,e,t),t})},Qu.prototype.delete=function(t){return Fs("SimpleDb","DELETE",this.store.name,t),ea(this.store.delete(t))},Qu.prototype.count=function(){return Fs("SimpleDb","COUNT",this.store.name),ea(this.store.count())},Qu.prototype.To=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Eo(n,function(t,e){r.push(e)}).next(function(){return r})},Qu.prototype.Io=function(t,e){Fs("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.wo=!1;var r=this.cursor(n);return this.Eo(r,function(t,e,n){return n.delete()})},Qu.prototype.Ro=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Eo(r,e)},Qu.prototype.mo=function(i){var t=this.cursor({});return new iu(function(n,r){t.onerror=function(t){var e=ra(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Qu.prototype.Eo=function(t,s){var u=[];return new iu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Ku(i),(n=s(i.primaryKey,i.value,e))instanceof iu&&(r=n.catch(function(t){return e.done(),iu.reject(t)}),u.push(r)),e.Mn?o():null===e.lo?i.continue():i.continue(e.lo)):o()}}).next(function(){return iu.Un(u)})},Qu.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Qu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.wo?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Qu);function Qu(t){this.store=t}function Ju(t){var n=this;this.transaction=t,this.aborted=!1,this.fo=new Tu,this.transaction.oncomplete=function(){n.fo.resolve()},this.transaction.onabort=function(){t.error?n.fo.reject(new Wu(t.error)):n.fo.resolve()},this.transaction.onerror=function(t){var e=ra(t.target.error);n.fo.reject(new Wu(e))}}function Zu(t){var e=this;return(e=zu.call(this,Nr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function $u(t){this.uo=t,this.co=!1,this._o=null}function ta(t){this.db=t,12.2===ta.to(p())&&Bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function ea(t){return new iu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=ra(t.target.error);r(e)}})}var na=!1;function ra(t){var e=Hu.to(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new _r("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return na||(na=!0,setTimeout(function(){throw r},0)),r}}return t}var ia=(oa.Vo=function(t,e,n,r){return Hs(""!==t.uid),new oa(t.t()?t.uid:"",e,n,r)},oa.prototype.po=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).Ro({index:Ma.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},oa.prototype.yo=function(e,t,n){return this.bo(e).next(function(t){return t.lastStreamToken=n.toBase64(),ca(e).put(t)})},oa.prototype.vo=function(t){return this.bo(t).next(function(t){return Zr.fromBase64String(t.lastStreamToken)})},oa.prototype.So=function(e,n){return this.bo(e).next(function(t){return t.lastStreamToken=n.toBase64(),ca(e).put(t)})},oa.prototype.Do=function(h,c,f,l){var p=this,d=ha(h),y=aa(h);return y.add({}).next(function(t){Hs("number"==typeof t);for(var e=new tu(t,c,f,l),n=p.serializer.Co(p.userId,e),r=[],i=new ns(function(t,e){return Xs(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=ja.key(p.userId,u.key.path,t),i=i.add(u.key.path.M());r.push(y.put(n)),r.push(d.put(a,ja.PLACEHOLDER))}return i.forEach(function(t){r.push(p.rr.Fo(h,t))}),h.er(function(){p.Po[t]=e.keys()}),iu.Un(r).next(function(){return e})})},oa.prototype.No=function(t,e){var n=this;return aa(t).get(e).next(function(t){return t?(Hs(t.userId===n.userId),n.serializer.ko(t)):null})},oa.prototype.$o=function(t,n){var r=this;return this.Po[n]?iu.resolve(this.Po[n]):this.No(t,n).next(function(t){if(t){var e=t.keys();return r.Po[n]=e}return null})},oa.prototype.Mo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return aa(t).Ro({index:Ma.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Hs(e.batchId>=i),o=r.serializer.ko(e)),n.done()}).next(function(){return o})},oa.prototype.Lo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return aa(t).Ro({index:Ma.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},oa.prototype.xo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).To(Ma.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.ko(t)})})},oa.prototype.or=function(u,a){var h=this,t=ja.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return ha(u).Ro({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Gu(i);if(r===h.userId&&a.path.isEqual(s))return aa(u).get(o).next(function(t){if(!t)throw zs();Hs(t.userId===h.userId),c.push(h.serializer.ko(t))});n.done()}).next(function(){return c})},oa.prototype.lr=function(r,t){var a=this,h=new ns(Xs),i=[];return t.forEach(function(u){var t=ja.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=ha(r).Ro({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Gu(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),iu.Un(i).next(function(){return a.Oo(r,h)})},oa.prototype.Rr=function(t,e){var u=this,a=e.path,h=a.length+1,n=ja.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new ns(Xs);return ha(t).Ro({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Gu(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.Oo(t,c)})},oa.prototype.Oo=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(aa(e).get(t).next(function(t){if(null===t)throw zs();Hs(t.userId===n.userId),r.push(n.serializer.ko(t))}))}),iu.Un(i).next(function(){return r})},oa.prototype.Bo=function(e,n){var r=this;return ua(e.qo,this.userId,n).next(function(t){return e.er(function(){r.Uo(n.batchId)}),iu.forEach(t,function(t){return r.Ao.Qo(e,t)})})},oa.prototype.Uo=function(t){delete this.Po[t]},oa.prototype.Wo=function(n){var o=this;return this.po(n).next(function(t){if(!t)return iu.resolve();var e=IDBKeyRange.lowerBound(ja.prefixForUser(o.userId)),i=[];return ha(n).Ro({range:e},function(t,e,n){var r;t[0]===o.userId?(r=Gu(t[1]),i.push(r)):n.done()}).next(function(){Hs(0===i.length)})})},oa.prototype.Fn=function(t,e){return sa(t,this.userId,e)},oa.prototype.bo=function(t){var e=this;return ca(t).get(this.userId).next(function(t){return t||new Ca(e.userId,-1,"")})},oa);function oa(t,e,n,r){this.userId=t,this.serializer=e,this.rr=n,this.Ao=r,this.Po={}}function sa(t,o,e){var n=ja.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return ha(t).Ro({range:r,wo:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function ua(t,e,n){var r=t.store(Ma.store),i=t.store(ja.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Ro({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Hs(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=ja.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return iu.Un(o).next(function(){return h})}function aa(t){return ih.ho(t,Ma.store)}function ha(t){return ih.ho(t,ja.store)}function ca(t){return ih.ho(t,Ca.store)}var fa=(da.prototype.next=function(){return this.jo+=2,this.jo},da.Ko=function(){return new da(0)},da.Go=function(){return new da(-1)},da),la=(pa.prototype.zo=function(n){var r=this;return this.Ho(n).next(function(t){var e=new fa(t.highestTargetId);return t.highestTargetId=e.next(),r.Yo(n,t).next(function(){return t.highestTargetId})})},pa.prototype.Jo=function(t){return this.Ho(t).next(function(t){return Dr.v(new Lr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},pa.prototype.Xo=function(t){return ga(t.qo)},pa.prototype.Zo=function(e,n,r){var i=this;return this.Ho(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Yo(e,t)})},pa.prototype.ta=function(e,n){var r=this;return this.ea(e,n).next(function(){return r.Ho(e).next(function(t){return t.targetCount+=1,r.sa(n,t),r.Yo(e,t)})})},pa.prototype.ia=function(t,e){return this.ea(t,e)},pa.prototype.na=function(e,t){var n=this;return this.ra(e,t.targetId).next(function(){return ya(e).delete(t.targetId)}).next(function(){return n.Ho(e)}).next(function(t){return Hs(0<t.targetCount),--t.targetCount,n.Yo(e,t)})},pa.prototype.Hh=function(r,i,o){var s=this,u=0,a=[];return ya(r).Ro(function(t,e){var n=s.serializer.ha(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.na(r,n)))}).next(function(){return iu.Un(a)}).next(function(){return u})},pa.prototype.js=function(t,r){var i=this;return ya(t).Ro(function(t,e){var n=i.serializer.ha(e);r(n)})},pa.prototype.Ho=function(t){return va(t.qo)},pa.prototype.Yo=function(t,e){return ih.ho(t,Ka.store).put(Ka.key,e)},pa.prototype.ea=function(t,e){return ya(t).put(this.serializer.oa(e))},pa.prototype.sa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},pa.prototype.aa=function(t){return this.Ho(t).next(function(t){return t.targetCount})},pa.prototype.ua=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return ya(t).Ro({range:n,index:za.queryTargetsIndexName},function(t,e,n){var r=o.serializer.ha(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},pa.prototype.ca=function(n,t,r){var i=this,o=[],s=ma(n);return t.forEach(function(t){var e=qu(t.path);o.push(s.put(new Ha(r,e))),o.push(i.Ao.gn(n,t))}),iu.Un(o)},pa.prototype._a=function(n,t,r){var i=this,o=ma(n);return iu.forEach(t,function(t){var e=qu(t.path);return iu.Un([o.delete([r,e]),i.Ao.yn(n,t)])})},pa.prototype.ra=function(t,e){var n=ma(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},pa.prototype.la=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ma(t),o=cs();return r.Ro({range:n,wo:!0},function(t,e,n){var r=Gu(t[1]),i=new Wr(r);o=o.add(i)}).next(function(){return o})},pa.prototype.Fn=function(t,e){var n=qu(e.path),r=IDBKeyRange.bound([n],[Qs(n)],!1,!0),i=0;return ma(t).Ro({index:Ha.documentTargetsIndex,wo:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},pa.prototype.si=function(t,e){var n=this;return ya(t).get(e).next(function(t){return t?n.serializer.ha(t):null})},pa);function pa(t,e){this.Ao=t,this.serializer=e}function da(t){this.jo=t}function ya(t){return ih.ho(t,za.store)}function va(t){return Hu.ho(t,Ka.store).get(Ka.key).next(function(t){return Hs(null!==t),t})}function ga(t){return va(t).next(function(t){return t.highestListenSequenceNumber})}function ma(t){return ih.ho(t,Ha.store)}var wa,ba=(Ea.prototype.Gn=function(t,e,n){return Ta(t).put(Na(e),n)},Ea.prototype.Hn=function(t,e){var n=Ta(t),r=Na(e);return n.delete(r)},Ea.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.da(e,t)})},Ea.prototype.Yn=function(t,e){var n=this;return Ta(t).get(Na(e)).next(function(t){return n.fa(t)})},Ea.prototype.Ta=function(t,e){var n=this;return Ta(t).get(Na(e)).next(function(t){var e=n.fa(t);return e?{Ea:e,size:_a(t)}:null})},Ea.prototype.getEntries=function(t,e){var r=this,i=is;return this.Ia(t,e,function(t,e){var n=r.fa(e);i=i.me(t,n)}).next(function(){return i})},Ea.prototype.wa=function(t,e){var r=this,i=is,o=new Yo(Wr.N);return this.Ia(t,e,function(t,e){var n=r.fa(e);o=n?(i=i.me(t,n),o.me(t,_a(e))):(i=i.me(t,null),o.me(t,0))}).next(function(){return{Ra:i,ma:o}})},Ea.prototype.Ia=function(t,e,i){if(e.B())return iu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return Ta(t).Ro({range:n},function(t,e,n){for(var r=Wr.st(t);s&&Wr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.ke()?o.Ne():null),s?n.do(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.ke()?o.Ne():null})},Ea.prototype.dr=function(t,i,e){var n,r,o,s=this,u=us,a=i.path.length+1,h={};return e.isEqual(Dr.min())?(n=i.path.W(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.W(),o=this.serializer.Aa(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Ba.collectionReadTimeIndex),Ta(t).Ro(h,function(t,e,n){var r;t.length===a&&(r=s.serializer.Pa(e),i.path.q(r.key.path)?r instanceof wo&&i.matches(r)&&(u=u.me(r.key,r)):n.done())}).next(function(){return u})},Ea.prototype.Va=function(t,e){var r=this,i=is,o=this.serializer.Aa(e),n=Ta(t),s=IDBKeyRange.lowerBound(o,!0);return n.Ro({index:Ba.readTimeIndex,range:s},function(t,e){var n=r.serializer.Pa(e);i=i.me(n.key,n),o=e.readTime}).next(function(){return{ga:i,readTime:r.serializer.pa(o)}})},Ea.prototype.ya=function(t){var r=this,e=Ta(t),i=Dr.min();return e.Ro({index:Ba.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.pa(e.readTime)),n.done()}).next(function(){return i})},Ea.prototype.ba=function(t){return new Ea.va(this,!!t&&t.Sa)},Ea.prototype.Da=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ea.prototype.getMetadata=function(t){return Ia(t).get(Ga.key).next(function(t){return Hs(!!t),t})},Ea.prototype.da=function(t,e){return Ia(t).put(Ga.key,e)},Ea.prototype.fa=function(t){if(t){var e=this.serializer.Pa(t);return e instanceof bo&&e.version.isEqual(Dr.min())?null:e}return null},Ea);function Ea(t,e){this.serializer=t,this.rr=e}function Ia(t){return ih.ho(t,Ga.store)}function Ta(t){return ih.ho(t,Ba.store)}function Na(t){return t.path.W()}function _a(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw zs();e=t.noDocument}return JSON.stringify(e).length}function Aa(t,e){var n=this;return(n=wa.call(this)||this).Ca=t,n.Sa=e,n.Fa=new $s(function(t){return t.toString()}),n}function Sa(t,e){this.seconds=t,this.nanoseconds=e}ba.va=(n(Aa,wa=ou),Aa.prototype.Zn=function(s){var u=this,a=[],h=0,c=new ns(function(t,e){return Xs(t.j(),e.j())});return this.Wn.forEach(function(t,e){var n,r,i,o=u.Fa.get(t);e?(n=u.Ca.serializer.Na(e,u.readTime),c=c.add(t.path.M()),r=_a(n),h+=r-o,a.push(u.Ca.Gn(s,t,n))):(h-=o,u.Sa?(i=u.Ca.serializer.Na(new bo(t,Dr.min()),u.readTime),a.push(u.Ca.Gn(s,t,i))):a.push(u.Ca.Hn(s,t)))}),c.forEach(function(t){a.push(u.Ca.rr.Fo(s,t))}),a.push(this.Ca.updateMetadata(s,h)),iu.Un(a)},Aa.prototype.Jn=function(t,e){var n=this;return this.Ca.Ta(t,e).next(function(t){return null===t?(n.Fa.set(e,0),null):(n.Fa.set(e,t.size),t.Ea)})},Aa.prototype.Xn=function(t,e){var n=this;return this.Ca.wa(t,e).next(function(t){var e=t.Ra;return t.ma.forEach(function(t,e){n.Fa.set(t,e)}),e})},Aa);var xa=(Va.prototype.Fo=function(t,e){return this.ka.add(e),iu.resolve()},Va.prototype.wr=function(t,e){return iu.resolve(this.ka.getEntries(e))},Va),ka=(Pa.prototype.add=function(t){var e=t.O(),n=t.M(),r=this.index[e]||new ns(Or.N),i=!r.has(n);return this.index[e]=r.add(n),i},Pa.prototype.has=function(t){var e=t.O(),n=t.M(),r=this.index[e];return r&&r.has(n)},Pa.prototype.getEntries=function(t){return(this.index[t]||new ns(Or.N)).W()},Pa),La=10,Da=(Oa.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Hs(t<e&&0<=t&&e<=La);var o,s=new Xu(r);t<1&&1<=e&&(n.createObjectStore(Ra.store),(o=n).createObjectStore(Ca.store,{keyPath:Ca.keyPath}),o.createObjectStore(Ma.store,{keyPath:Ma.keyPath,autoIncrement:!0}).createIndex(Ma.userMutationsIndex,Ma.userMutationsKeyPath,{unique:!0}),o.createObjectStore(ja.store),Xa(n),n.createObjectStore(Ba.store));var u,a=iu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Ha.store),u.deleteObjectStore(za.store),u.deleteObjectStore(Ka.store),Xa(n)),a=a.next(function(){return t=s.store(Ka.store),e=new Ka(0,0,Dr.min().C(),0),t.put(Ka.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Ma.store).To().next(function(t){r.deleteObjectStore(Ma.store),r.createObjectStore(Ma.store,{keyPath:Ma.keyPath,autoIncrement:!0}).createIndex(Ma.userMutationsIndex,Ma.userMutationsKeyPath,{unique:!0});var e=i.store(Ma.store),n=t.map(function(t){return e.put(t)});return iu.Un(n)});var r,i})),a=a.next(function(){n.createObjectStore(Ya.store,{keyPath:Ya.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Ga.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Ba.store)).createIndex(Ba.readTimeIndex,Ba.readTimeIndexPath,{unique:!1}),t.createIndex(Ba.collectionReadTimeIndex,Ba.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Oa.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ba.store).Ro(function(t,e){n+=_a(e)}).next(function(){var t=new Ga(n);return e.store(Ga.store).put(Ga.key,t)})},Oa.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Ca.store),e=r.store(Ma.store);return t.To().next(function(t){return iu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.To(Ma.userMutationsIndex,t).next(function(t){return iu.forEach(t,function(t){Hs(t.userId===n.userId);var e=i.serializer.ko(t);return ua(r,n.userId,e).next(function(){})})})})})},Oa.prototype.ensureSequenceNumbers=function(t){var s=t.store(Ha.store),e=t.store(Ba.store);return ga(t).next(function(i){var o=[];return e.Ro(function(t,e){var n=new Or(t),r=[0,qu(n)];o.push(s.get(r).next(function(t){return t?iu.resolve():s.put(new Ha(0,qu(n),i))}))}).next(function(){return iu.Un(o)})})},Oa.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.O(),n=t.M();return i.put({collectionId:e,parent:qu(n)})}}t.createObjectStore(Wa.store,{keyPath:Wa.keyPath});var i=e.store(Wa.store),o=new ka;return e.store(Ba.store).Ro({wo:!0},function(t,e){return r(new Or(t).M())}).next(function(){return e.store(ja.store).Ro({wo:!0},function(t,e){t[0];var n=t[1];return r((t[2],Gu(n)).M())})})},Oa.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(za.store);return o.Ro(function(t,e){var n=i.serializer.ha(e),r=i.serializer.oa(n);return o.put(r)})},Oa),Ra=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Oa(t){this.serializer=t}function Pa(){this.index={}}function Va(){this.ka=new ka}Ra.store="owner",Ra.key="owner";var Ca=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ca.store="mutationQueues",Ca.keyPath="userId";var Ma=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ma.store="mutations",Ma.keyPath="batchId",Ma.userMutationsIndex="userMutationsIndex",Ma.userMutationsKeyPath=["userId","batchId"];var ja=(Ua.prefixForUser=function(t){return[t]},Ua.prefixForPath=function(t,e){return[t,qu(e)]},Ua.key=function(t,e,n){return[t,qu(e),n]},Ua);function Ua(){}function qa(t,e){this.path=t,this.readTime=e}function Fa(t,e){this.path=t,this.version=e}ja.store="documentMutations",ja.PLACEHOLDER=new ja;var Ba=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ba.store="remoteDocuments",Ba.readTimeIndex="readTimeIndex",Ba.readTimeIndexPath="readTime",Ba.collectionReadTimeIndex="collectionReadTimeIndex",Ba.collectionReadTimeIndexPath=["parentPath","readTime"];var Ga=function(t){this.byteSize=t};Ga.store="remoteDocumentGlobal",Ga.key="remoteDocumentGlobalKey";var za=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};za.store="targets",za.keyPath="targetId",za.queryTargetsIndexName="queryTargetsIndex",za.queryTargetsKeyPath=["canonicalId","targetId"];var Ha=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ha.store="targetDocuments",Ha.keyPath=["targetId","path"],Ha.documentTargetsIndex="documentTargetsIndex",Ha.documentTargetsKeyPath=["path","targetId"];var Ka=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ka.key="targetGlobalKey",Ka.store="targetGlobal";var Wa=function(t,e){this.collectionId=t,this.parent=e};function Xa(t){t.createObjectStore(Ha.store,{keyPath:Ha.keyPath}).createIndex(Ha.documentTargetsIndex,Ha.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(za.store,{keyPath:za.keyPath}).createIndex(za.queryTargetsIndexName,za.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ka.store)}Wa.store="collectionParents",Wa.keyPath=["collectionId","parent"];var Ya=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ya.store="clientMetadata",Ya.keyPath="clientId";var Qa=i(i(i([Ca.store,Ma.store,ja.store,Ba.store,za.store,Ra.store,Ka.store,Ha.store],[Ya.store]),[Ga.store]),[Wa.store]),Ja=(Za.prototype.Fo=function(t,e){var n=this;if(this.$a.has(e))return iu.resolve();var r=e.O(),i=e.M();t.er(function(){n.$a.add(e)});var o={collectionId:r,parent:qu(i)};return $a(t).put(o)},Za.prototype.wr=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Qs(i),""],!1,!0);return $a(t).To(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Gu(r.parent))}return o})},Za);function Za(){this.$a=new ka}function $a(t){return ih.ho(t,Wa.store)}var th,eh=(uh.prototype.Pa=function(t){if(t.document)return this.Ma.Ai(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Wr.st(t.noDocument.path),n=this.La(t.noDocument.readTime);return new bo(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Wr.st(t.unknownDocument.path),i=this.La(t.unknownDocument.version);return new Eo(r,i)}return zs()},uh.prototype.Na=function(t,e){var n=this.Aa(e),r=t.key.path.M().W();if(t instanceof wo){var i=this.Ma.mi(t),o=t.hasCommittedMutations;return new Ba(null,null,i,o,n,r)}if(t instanceof bo){var s=t.key.path.W(),u=this.xa(t.version),a=t.hasCommittedMutations;return new Ba(null,new qa(s,u),null,a,n,r)}if(t instanceof Eo){var h=t.key.path.W(),c=this.xa(t.version);return new Ba(new Fa(h,c),null,null,!0,n,r)}return zs()},uh.prototype.Aa=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},uh.prototype.pa=function(t){var e=new Lr(t[0],t[1]);return Dr.v(e)},uh.prototype.xa=function(t){var e=t.C();return new Sa(e.seconds,e.nanoseconds)},uh.prototype.La=function(t){var e=new Lr(t.seconds,t.nanoseconds);return Dr.v(e)},uh.prototype.Co=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Ma.vi(t)}),i=e.mutations.map(function(t){return n.Ma.vi(t)});return new Ma(t,e.batchId,e.Tn.toMillis(),r,i)},uh.prototype.ko=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Ma.Fi(t)}),r=t.mutations.map(function(t){return e.Ma.Fi(t)}),i=Lr.fromMillis(t.localWriteTimeMs);return new tu(t.batchId,i,n,r)},uh.prototype.ha=function(t){var e=this.La(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?this.La(t.lastLimboFreeSnapshotVersion):Dr.min(),r=void 0!==t.query.documents?this.Ma.Oi(t.query):this.Ma.Wi(t.query);return new Ro(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Zr.fromBase64String(t.resumeToken))},uh.prototype.oa=function(t){var e=this.xa(t.Ee),n=this.xa(t.lastLimboFreeSnapshotVersion),r=t.target.xt()?this.Ma.xi(t.target):this.Ma.Bi(t.target),i=t.resumeToken.toBase64();return new za(t.targetId,t.target.canonicalId(),e,i,t.sequenceNumber,n,r)},uh),nh="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",rh=(n(sh,th=uu),sh),ih=(oh.ho=function(t,e){if(t instanceof rh)return Hu.ho(t.qo,e);throw zs()},oh.prototype.start=function(){var e=this;return Hu.eo(this.Ga,La,new Da(this.serializer)).then(function(t){return e.Ja=t,e.Xa()}).then(function(){return e.Za(),e.tu(),e.eu(),e.Ja.runTransaction("readonly",[Ka.store],ga)}).then(function(t){e.su=new cu(t,e.Ba)}).then(function(){e.qa=!0}).catch(function(t){return e.Ja&&e.Ja.close(),Promise.reject(t)})},oh.prototype.iu=function(n){var t=this;return this.Ka=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.Uh?[2,n(e)]:[2]})})},n(this.isPrimary)},oh.prototype.nu=function(n){var t=this;this.Ja.oo(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},oh.prototype.ru=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Sr.Hr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Uh?[4,this.Xa()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},oh.prototype.Xa=function(){var n=this;return this.Ja.runTransaction("readwrite",Qa,function(e){return hh(e).put(new Ya(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.hu(e).next(function(t){t||(n.isPrimary=!1,n.Sr.Hr(function(){return n.Ka(!1)}))})}).next(function(){return n.ou(e)}).next(function(t){return n.isPrimary&&!t?n.au(e).next(function(){return!1}):!!t&&n.uu(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Fs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Sr.Hr(function(){return n.Ka(t)}),n.isPrimary=t})},oh.prototype.hu=function(t){var e=this;return ah(t).get(Ra.key).next(function(t){return iu.resolve(e.cu(t))})},oh.prototype._u=function(t){return hh(t).delete(this.clientId)},oh.prototype.lu=function(){return y(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.du(this.ja,18e5)?[3,2]:(this.ja=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=oh.ho(t,Ya.store);return r.To().next(function(t){var e=i.fu(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return iu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.Tu(t.clientId))}),t.label=2;case 2:return[2]}})})},oh.prototype.eu=function(){var t=this;this.Wa=this.Sr.Br("client_metadata_refresh",4e3,function(){return t.Xa().then(function(){return t.lu()}).then(function(){return t.eu()})})},oh.prototype.cu=function(t){return!!t&&t.ownerId===this.clientId},oh.prototype.ou=function(e){var i=this;return ah(e).get(Ra.key).next(function(t){if(null!==t&&i.du(t.leaseTimestampMs,5e3)&&!i.Eu(t.ownerId)){if(i.cu(t)&&i.networkEnabled)return!0;if(!i.cu(t)){if(!t.allowTabSynchronization)throw new _r(Nr.FAILED_PRECONDITION,nh);return!1}}return!(!i.networkEnabled||!i.inForeground)||hh(e).To().next(function(t){return void 0===i.fu(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Fs("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},oh.prototype.Iu=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.qa=!1,this.wu(),this.Wa&&(this.Wa.cancel(),this.Wa=null),this.Ru(),this.mu(),[4,this.Ja.runTransaction("readwrite",[Ra.store,Ya.store],function(t){return e.au(t).next(function(){return e._u(t)})})];case 1:return t.sent(),this.Ja.close(),this.Au(),[2]}})})},oh.prototype.fu=function(t,e){var n=this;return t.filter(function(t){return n.du(t.updateTimeMs,e)&&!n.Eu(t.clientId)})},oh.prototype.Pu=function(){var e=this;return this.Ja.runTransaction("readonly",[Ya.store],function(t){return hh(t).To().next(function(t){return e.fu(t,18e5).map(function(t){return t.clientId})})})},oh.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return oh.so()?(e=n+oh.za,[4,Hu.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(oh.prototype,"Uh",{get:function(){return this.qa},enumerable:!0,configurable:!0}),oh.prototype.Vu=function(t){return ia.Vo(t,this.serializer,this.rr,this.Ao)},oh.prototype.gu=function(){return this.Ha},oh.prototype.pu=function(){return this.ir},oh.prototype.yu=function(){return this.rr},oh.prototype.runTransaction=function(n,t,r){var i=this;Fs("IndexedDbPersistence","Starting transaction:",n);var o,e="readonly"===t?"readonly":"readwrite";return this.Ja.runTransaction(e,Qa,function(e){return o=new rh(e,i.su.next()),"readwrite-primary"===t?i.hu(e).next(function(t){return!!t||i.ou(e)}).next(function(t){if(!t)throw Bs("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Sr.Hr(function(){return i.Ka(!1)}),new _r(Nr.FAILED_PRECONDITION,su);return r(o)}).next(function(t){return i.uu(e).next(function(){return t})}):i.bu(e).next(function(){return r(o)})}).then(function(t){return o.sr(),t})},oh.prototype.bu=function(t){var e=this;return ah(t).get(Ra.key).next(function(t){if(null!==t&&e.du(t.leaseTimestampMs,5e3)&&!e.Eu(t.ownerId)&&!e.cu(t)&&!t.allowTabSynchronization)throw new _r(Nr.FAILED_PRECONDITION,nh)})},oh.prototype.uu=function(t){var e=new Ra(this.clientId,this.allowTabSynchronization,Date.now());return ah(t).put(Ra.key,e)},oh.so=function(){return Hu.so()},oh.vu=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},oh.prototype.au=function(t){var e=this,n=ah(t);return n.get(Ra.key).next(function(t){return e.cu(t)?(Fs("IndexedDbPersistence","Releasing primary lease."),n.delete(Ra.key)):iu.resolve()})},oh.prototype.du=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Bs("Detected an update time that is in the future: "+t+" > "+n),1))},oh.prototype.Za=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qa=function(){t.Sr.Hr(function(){return t.inForeground="visible"===t.document.visibilityState,t.Xa()})},this.document.addEventListener("visibilitychange",this.Qa),this.inForeground="visible"===this.document.visibilityState)},oh.prototype.Ru=function(){this.Qa&&(this.document.removeEventListener("visibilitychange",this.Qa),this.Qa=null)},oh.prototype.tu=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Ua=function(){t.wu(),t.Sr.Hr(function(){return t.Iu()})},this.window.addEventListener("unload",this.Ua))},oh.prototype.mu=function(){this.Ua&&(this.window.removeEventListener("unload",this.Ua),this.Ua=null)},oh.prototype.Eu=function(t){try{var e=null!==this.Ya.getItem(this.Tu(t));return Fs("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},oh.prototype.wu=function(){try{this.Ya.setItem(this.Tu(this.clientId),String(Date.now()))}catch(t){Bs("Failed to set zombie client id.",t)}},oh.prototype.Au=function(){try{this.Ya.removeItem(this.Tu(this.clientId))}catch(t){}},oh.prototype.Tu=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},oh);function oh(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Sr=o,this.Ba=u,this.qa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ua=null,this.inForeground=!1,this.Qa=null,this.Wa=null,this.ja=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!oh.so())throw new _r(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.Ao=new ch(this,i),this.Ga=e+oh.za,this.serializer=new eh(s),this.document=r.document,this.Ha=new la(this.Ao,this.serializer),this.rr=new Ja,this.ir=new ba(this.serializer,this.rr),!r.window||!r.window.localStorage)throw new _r(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Ya=this.window.localStorage}function sh(t,e){var n=this;return(n=th.call(this)||this).qo=t,n.Oa=e,n}function uh(t){this.Ma=t}function ah(t){return t.store(Ra.store)}function hh(t){return t.store(Ya.store)}ih.za="main";var ch=(fh.prototype.Kh=function(t){var n=this.Du(t);return this.db.gu().aa(t).next(function(e){return n.next(function(t){return e+t})})},fh.prototype.Du=function(t){var e=0;return this.zh(t,function(t){e++}).next(function(){return e})},fh.prototype.js=function(t,e){return this.db.gu().js(t,e)},fh.prototype.zh=function(t,n){return this.Cu(t,function(t,e){return n(e)})},fh.prototype.Fu=function(t){this.Su=t},fh.prototype.gn=lh,fh.prototype.yn=lh,fh.prototype.Hh=function(t,e,n){return this.db.gu().Hh(t,e,n)},fh.prototype.Qo=lh,fh.prototype.Nu=function(t,e){return this.Su.Fn(e)?iu.resolve(!0):(r=e,i=!1,ca(n=t).mo(function(t){return sa(n,t,r).next(function(t){return t&&(i=!0),iu.resolve(!t)})}).next(function(){return i}));var n,r,i},fh.prototype.Yh=function(r,i){var o=this,s=this.db.pu().ba(),u=[],a=0;return this.Cu(r,function(e,t){var n;t<=i&&(n=o.Nu(r,e).next(function(t){if(!t)return a++,s.Yn(r,e).next(function(){return s.Hn(e),ma(r).delete([0,qu(e.path)])})}),u.push(n))}).next(function(){return iu.Un(u)}).next(function(){return s.apply(r)}).next(function(){return a})},fh.prototype.removeTarget=function(t,e){var n=e.Ie(t.Oa);return this.db.gu().ia(t,n)},fh.prototype.ku=lh,fh.prototype.Cu=function(t,o){var s,e=ma(t),u=cu.vr;return e.Ro({index:Ha.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==cu.vr&&o(new Wr(Gu(s)),u),u=i,s=r):u=cu.vr}).next(function(){u!==cu.vr&&o(new Wr(Gu(s)),u)})},fh.prototype.Xh=function(t){return this.db.pu().Da(t)},fh);function fh(t,e){this.db=t,this.Su=null,this.Lh=new Mu(this,e)}function lh(t,e){return ma(t).put((n=t.Oa,new Ha(0,qu(e.path),n)));var n}var ph=(dh.prototype.start=function(){return Promise.resolve()},dh.prototype.Qu=function(i){return y(this,void 0,void 0,function(){var e,m,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.nr,m=this.qu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.nr.xo(v).next(function(t){return g=t,e=r.persistence.Vu(i),m=new au(r.Bu,e,r.persistence.yu()),e.xo(v)}).next(function(t){for(var e=[],n=[],r=cs(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.cr(v,r).next(function(t){return{Wu:t,ju:e,Ku:n}})})})];case 1:return n=t.sent(),[2,(this.nr=e,this.qu=m,this.$u.Uu(this.qu),n)]}})})},dh.prototype.Gu=function(u){var a,h=this,c=Lr.now(),t=u.reduce(function(t,e){return t.add(e.key)},cs());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.qu.cr(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new Fi(i.key,o,io(o.proto.mapValue),ji.exists(!0)))}return h.nr.Do(s,c,e,u)})}).then(function(t){var e=t.In(a);return{batchId:t.batchId,Wn:e}})},dh.prototype.yo=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.Bu.ba({Sa:!0});return i.nr.yo(t,r.batch,r.streamToken).next(function(){return i.zu(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.nr.Wo(t)}).next(function(){return i.qu.cr(t,e)})})},dh.prototype.Hu=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.nr.No(e,t).next(function(t){return Hs(null!==t),n=t.keys(),r.nr.Bo(e,t)}).next(function(){return r.nr.Wo(e)}).next(function(){return r.qu.cr(e,n)})})},dh.prototype.Lo=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.nr.Lo(t)})},dh.prototype.vo=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.nr.vo(t)})},dh.prototype.So=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.nr.So(t,e)})},dh.prototype.Jo=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ha.Jo(t)})},dh.prototype.Yu=function(a){var h=this,c=a.Ee,f=this.Lu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.Bu.ba({Sa:!0});f=h.Lu;var s=[];a.as.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.Ha._a(o,t.Is,e).next(function(){return h.Ha.ca(o,t.Ts,e)})),0<(n=t.resumeToken).rt()&&(r=i.we(n,c).Ie(o.Oa),f=f.me(e,r),dh.Ju(i,r,t)&&s.push(h.Ha.ia(o,r))))});var t,u=is,n=cs();return a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof bo&&e.version.isEqual(Dr.min())?(i.Hn(t,c),u=u.me(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Gn(e,c),u=u.me(t,e)):Fs("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.Ao.ku(o,t))})})),c.isEqual(Dr.min())||(t=h.Ha.Jo(o).next(function(t){return h.Ha.Zo(o,o.Oa,c)}),s.push(t)),iu.Un(s).next(function(){return i.apply(o)}).next(function(){return h.qu._r(o,u)})}).then(function(t){return h.Lu=f,t})},dh.Ju=function(t,e,n){return Hs(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Xu||0<n.Ts.size+n.Es.size+n.Is.size},dh.prototype.Zu=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i,o,s,u=r[e],a=u.targetId;this.Mu.pn(u.Ar,a),this.Mu.vn(u.Pr,a),u.fromCache||(o=(i=this.Lu.get(a)).Ee,s=i.Re(o),this.Lu=this.Lu.me(a,s))}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return iu.forEach(t,function(t){return iu.forEach(t.Pr,function(t){return n.persistence.Ao.yn(e,t)})})})},dh.prototype.tc=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.nr.Mo(t,e)})},dh.prototype.ec=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.qu.hr(t,e)})},dh.prototype.sc=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ha.ua(e,r).next(function(t){return t?(n=t,iu.resolve(n)):i.Ha.zo(e).next(function(t){return n=new Ro(r,t,0,e.Oa),i.Ha.ta(e,n).next(function(){return n})})})}).then(function(t){return null===i.Lu.get(t.targetId)&&(i.Lu=i.Lu.me(t.targetId,t),i.xu.set(r,t.targetId)),t})},dh.prototype.ua=function(t,e){var n=this.xu.get(e);return void 0!==n?iu.resolve(this.Lu.get(n)):this.Ha.ua(t,e)},dh.prototype.ic=function(n,r){var i=this,o=this.Lu.get(n),t=r?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",t,function(e){var t=i.Mu.Sn(n);return r?iu.resolve():iu.forEach(t,function(t){return i.persistence.Ao.yn(e,t)}).next(function(){i.persistence.Ao.removeTarget(e,o)})}).then(function(){i.Lu=i.Lu.remove(n),i.xu.delete(o.target)})},dh.prototype.nc=function(t,n){var r=this,i=Dr.min(),o=cs();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.ua(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ha.la(e,t.targetId).next(function(t){o=t})}).next(function(){return r.$u.dr(e,t,n?i:Dr.min(),n?o:cs())}).next(function(t){return{documents:t,rc:o}})})},dh.prototype.hc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.Ha.la(t,e)})},dh.prototype.zu=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=iu.resolve();return n.forEach(function(r){u=u.next(function(){return o.Yn(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Hs(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Gn(e,i.wn)})}),u.next(function(){return e.nr.Bo(t,s)})},dh.prototype.Qh=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Jh(t,n.Lu)})},dh);function dh(t,e,n){this.persistence=t,this.$u=e,this.Mu=new nu,this.Lu=new Yo(Xs),this.xu=new $s(function(t){return t.canonicalId()}),this.Ou=Dr.min(),this.persistence.Ao.Fu(this.Mu),this.nr=t.Vu(n),this.Bu=t.pu(),this.Ha=t.gu(),this.qu=new au(this.Bu,this.nr,this.persistence.yu()),this.$u.Uu(this.qu)}ph.Xu=3e8;var yh,vh=(n(gh,yh=ph),gh.prototype.start=function(){return this.oc()},gh.prototype.ac=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.nr.$o(e,t).next(function(t){return t?n.qu.cr(e,t):iu.resolve(null)})})},gh.prototype.uc=function(t){this.nr.Uo(t)},gh.prototype.ru=function(t){this.persistence.ru(t)},gh.prototype.Pu=function(){return this.persistence.Pu()},gh.prototype.cc=function(e){var n=this,t=this.Lu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.Ha.si(t,e).next(function(t){return t?t.target:null})})},gh.prototype.Va=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.Bu.Va(t,r.Ou)}).then(function(t){var e=t.ga,n=t.readTime;return r.Ou=n,e})},gh.prototype.oc=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Bu.ya(t)})];case 1:return e.Ou=t.sent(),[2]}})})},gh);function gh(t,e,n){var r=this;return(r=yh.call(this,t,e,n)||this).persistence=t,r.nr=t.Vu(n),r.Bu=t.pu(),r.Ha=t.gu(),r}function mh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Nr.FAILED_PRECONDITION||e.message!==su)throw e;return Fs("LocalStore","Unexpectedly lost primary lease"),[2]})})}function wh(t,e){if(0!==e.length)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ch(e.length,"argument")+".")}function bh(t,e,n){if(e.length!==n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires "+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function Eh(t,e,n){if(e.length<n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function Ih(t,e,n,r){if(e.length<n||e.length>r)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ch(e.length,"argument")+".")}function Th(t,e,n,r){xh(t,e,Vh(n)+" argument",r)}function Nh(t,e,n,r){void 0!==r&&Th(t,e,n,r)}function _h(t,e,n,r){xh(t,e,n+" option",r)}function Ah(t,e,n,r){void 0!==r&&_h(t,e,n,r)}function Sh(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Lh(s))}var u=Lh(n);throw new _r(Nr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function xh(t,e,n,r){if(!("object"===e?kh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Lh(r);throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function kh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Lh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":zs();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Dh(t,e,n){if(void 0===n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Vh(e)+" argument, but it was undefined.")}function Rh(n,t,r){Qr(t,function(t,e){if(r.indexOf(t)<0)throw new _r(Nr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Oh(t,e,n,r){var i=Lh(r);return new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Vh(n)+" argument to be a "+e+", but it was: "+i)}function Ph(t,e,n){if(n<=0)throw new _r(Nr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Vh(e)+" argument to be a positive number, but it was: "+n+".")}function Vh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ch(t,e){return t+" "+e+(1===t?"":"s")}function Mh(){if("undefined"==typeof Uint8Array)throw new _r(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function jh(){if(!Cs.nt()._c)throw new _r(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Uh=(Bh.fromBase64String=function(t){bh("Blob.fromBase64String",arguments,1),Th("Blob.fromBase64String","string",1,t),jh();try{return new Bh(Zr.fromBase64String(t))}catch(t){throw new _r(Nr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Bh.fromUint8Array=function(t){if(bh("Blob.fromUint8Array",arguments,1),Mh(),!(t instanceof Uint8Array))throw Oh("Blob.fromUint8Array","Uint8Array",1,t);return new Bh(Zr.fromUint8Array(t))},Bh.prototype.toBase64=function(){return bh("Blob.toBase64",arguments,0),jh(),this.lc.toBase64()},Bh.prototype.toUint8Array=function(){return bh("Blob.toUint8Array",arguments,0),Mh(),this.lc.toUint8Array()},Bh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Bh.prototype.isEqual=function(t){return this.lc.isEqual(t.lc)},Bh),qh=(Fh.documentId=function(){return Fh.fc},Fh.prototype.isEqual=function(t){if(!(t instanceof Fh))throw Oh("isEqual","FieldPath",1,t);return this.dc.isEqual(t.dc)},Fh);function Fh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new _r(Nr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(Th("FieldPath","string",n,t[n]),0===t[n].length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.dc=new Hr(t)}function Bh(t){jh(),this.lc=t}qh.fc=new qh(Hr.J().j());var Gh,zh,Hh,Kh,Wh,Xh=new RegExp("[~\\*/\\[\\]]"),Yh=function(t){this.Tc=t},Qh=(n(lc,Wh=Yh),lc.prototype.Di=function(t){if(2!==t.Ec)throw 1===t.Ec?t.Ic("FieldValue.delete() can only appear at the top level of your update data"):t.Ic("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},lc.prototype.isEqual=function(t){return t instanceof lc},lc),Jh=(n(fc,Kh=Yh),fc.prototype.Di=function(t){return new Mi(t.path,Ei.instance)},fc.prototype.isEqual=function(t){return t instanceof fc},fc),Zh=(n(cc,Hh=Yh),cc.prototype.Di=function(t){var n=t.Rc({Ec:3,methodName:this.Tc}),e=this.wc.map(function(t,e){return mc(t,n.mc(e))}),r=new Ti(e);return new Mi(t.path,r)},cc.prototype.isEqual=function(t){return this===t},cc),$h=(n(hc,zh=Yh),hc.prototype.Di=function(t){var n=t.Rc({Ec:3,methodName:this.Tc}),e=this.wc.map(function(t,e){return mc(t,n.mc(e))}),r=new Ni(e);return new Mi(t.path,r)},hc.prototype.isEqual=function(t){return this===t},hc),tc=(n(ac,Gh=Yh),ac.prototype.Di=function(t){t.Rc({methodName:this.Tc});var e=mc(this.Ac,t),n=new _i(t.serializer,e);return new Mi(t.path,n)},ac.prototype.isEqual=function(t){return this===t},ac),ec=(Object.defineProperty(uc.prototype,"latitude",{get:function(){return this.Pc},enumerable:!0,configurable:!0}),Object.defineProperty(uc.prototype,"longitude",{get:function(){return this.Vc},enumerable:!0,configurable:!0}),uc.prototype.isEqual=function(t){return this.Pc===t.Pc&&this.Vc===t.Vc},uc.prototype.p=function(t){return Xs(this.Pc,t.Pc)||Xs(this.Vc,t.Vc)},uc),nc=/^__.*__$/,rc=(sc.prototype.gc=function(t,e){var n=[];return null!==this.Vt?n.push(new Fi(t,this.data,this.Vt,e)):n.push(new qi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},sc),ic=(oc.prototype.gc=function(t,e){var n=[new Fi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},oc);function oc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function sc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function uc(t,e){if(bh("GeoPoint",arguments,2),Th("GeoPoint","number",1,t),Th("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new _r(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new _r(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Pc=t,this.Vc=e}function ac(t){var e=this;return(e=Gh.call(this,"FieldValue.increment")||this).Ac=t,e}function hc(t){var e=this;return(e=zh.call(this,"FieldValue.arrayRemove")||this).wc=t,e}function cc(t){var e=this;return(e=Hh.call(this,"FieldValue.arrayUnion")||this).wc=t,e}function fc(){return Kh.call(this,"FieldValue.serverTimestamp")||this}function lc(){return Wh.call(this,"FieldValue.delete")||this}function pc(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw zs()}}var dc=(Object.defineProperty(gc.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(gc.prototype,"Ec",{get:function(){return this.settings.Ec},enumerable:!0,configurable:!0}),gc.prototype.Rc=function(t){return new gc(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.fieldTransforms,this.Vt)},gc.prototype.yc=function(t){var e=null==this.path?null:this.path.child(t),n=this.Rc({path:e,bc:!1});return n.vc(t),n},gc.prototype.Sc=function(t){var e=null==this.path?null:this.path.child(t),n=this.Rc({path:e,bc:!1});return n.pc(),n},gc.prototype.mc=function(t){return this.Rc({path:null,bc:!0})},gc.prototype.Ic=function(t){var e=null===this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new _r(Nr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},gc.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},gc.prototype.pc=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.vc(this.path.get(t))},gc.prototype.vc=function(t){if(0===t.length)throw this.Ic("Document fields must not be empty");if(pc(this.Ec)&&nc.test(t))throw this.Ic('Document fields cannot begin and end with "__"')},gc),yc=(vc.prototype.Cc=function(t,e){var n=this.Fc(0,t);Ec("Data must be an object, but it was:",n,e);var r=wc(e,n);return new rc(new Hi(r),null,n.fieldTransforms)},vc.prototype.Nc=function(t,e,n){var r=this.Fc(2,t);Ec("Data must be an object, but it was:",r,e);var i,o,s=wc(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof qh)f=c.dc;else{if("string"!=typeof c)throw zs();f=Tc(t,c)}if(!r.contains(f))throw new _r(Nr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Nc(u,f)||u.push(f)}i=new Ci(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=new Ci(r.Vt),o=r.fieldTransforms;return new rc(new Hi(s),i,o)},vc.prototype.kc=function(o,t){var s=this.Fc(1,o);Ec("Data must be an object, but it was:",s,t);var u=[],a=new Ki;Qr(t,function(t,e){var n,r=Tc(o,t),i=s.Sc(r);e instanceof Qh?u.push(r):null!=(n=mc(e,i))&&(u.push(r),a.set(r,n))});var e=new Ci(u);return new ic(a.yt(),e,s.fieldTransforms)},vc.prototype.$c=function(t,e,n,r){var i=this.Fc(1,t),o=[Ic(t,e)],s=[n];if(r.length%2!=0)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Ic(t,r[u])),s.push(r[u+1]);for(var a,h,c,f,l=[],p=new Ki,d=o.length-1;0<=d;--d){Nc(l,o[d])||(a=o[d],h=s[d],c=i.Sc(a),h instanceof Qh?l.push(a):null!=(f=mc(h,c))&&(l.push(a),p.set(a,f)))}var y=new Ci(l);return new ic(p.yt(),y,i.fieldTransforms)},vc.prototype.Fc=function(t,e){return new dc({Ec:t,methodName:e,path:Hr.G,bc:!1},this.ii,this.serializer)},vc.prototype.Mc=function(t,e,n){return void 0===n&&(n=!1),mc(e,this.Fc(n?4:3,t))},vc);function vc(t,e){this.ii=t,this.serializer=e||Cs.nt().Dc(t)}function gc(t,e,n,r,i){this.settings=t,this.ii=e,this.serializer=n,void 0===r&&this.pc(),this.fieldTransforms=r||[],this.Vt=i||[]}function mc(s,t){if(bc(s))return Ec("Unsupported field value:",t,s),wc(s,t);if(s instanceof Yh)return function(t,e){if(!pc(e.Ec))throw e.Ic(t.Tc+"() can only be used with update() and set()");if(null===e.path)throw e.Ic(t.Tc+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.bc&&4!==t.Ec)throw t.Ic("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=mc(i[r],t.mc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Lr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof Lr){var r=new Lr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof ec)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Uh)return{bytesValue:e.serializer.ui(t)};if(t instanceof ol){var i=e.ii,o=t.firestore.Lc;if(!o.isEqual(i))throw e.Ic("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.xc.path,t.firestore.Lc)}}throw e.Ic("Unsupported field value: "+Lh(t))}(s,t)}function wc(t,r){var i={};return Jr(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):Qr(t,function(t,e){var n=mc(e,r.yc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function bc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Lr||t instanceof ec||t instanceof Uh||t instanceof ol||t instanceof Yh)}function Ec(t,e,n){if(!bc(n)||!kh(n)){var r=Lh(n);throw"an object"===r?e.Ic(t+" a custom object"):e.Ic(t+" "+r)}}function Ic(t,e){if(e instanceof qh)return e.dc;if("string"==typeof e)return Tc(t,e);throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Tc(t,e){try{return function(e){if(0<=e.search(Xh))throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(qh.bind.apply(qh,i([void 0],e.split("."))))}catch(t){throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).dc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Nc(t,e){return t.some(function(t){return t.isEqual(e)})}var _c,Ac,Sc,xc=(Fc.prototype.Wc=function(){return 1===this.state||2===this.state||4===this.state},Fc.prototype.jc=function(){return 2===this.state},Fc.prototype.start=function(){3!==this.state?this.auth():this.Kc()},Fc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Wc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Fc.prototype.Gc=function(){this.state=0,this.ih.reset()},Fc.prototype.zc=function(){var t=this;this.jc()&&null===this.Qc&&(this.Qc=this.Sr.Br(this.Oc,6e4,function(){return t.Hc()}))},Fc.prototype.Yc=function(t){this.Jc(),this.stream.send(t)},Fc.prototype.Hc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.jc()?[2,this.close(0)]:[2]})})},Fc.prototype.Jc=function(){this.Qc&&(this.Qc.cancel(),this.Qc=null)},Fc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Jc(),this.ih.cancel(),this.Uc++,3!==e?this.ih.reset():n&&n.code===Nr.RESOURCE_EXHAUSTED?(Bs(n.toString()),Bs("Using maximum backoff delay to prevent overloading the backend."),this.ih.Lr()):n&&n.code===Nr.UNAUTHENTICATED&&this.qc._(),null!==this.stream&&(this.Xc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Zc(n)];case 1:return t.sent(),[2]}})})},Fc.prototype.Xc=function(){},Fc.prototype.auth=function(){var n=this;this.state=1;var t=this.t_(this.Uc),e=this.Uc;this.qc.getToken().then(function(t){n.Uc===e&&n.e_(t)},function(e){t(function(){var t=new _r(Nr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.s_(t)})})},Fc.prototype.e_=function(t){var e=this,n=this.t_(this.Uc);this.stream=this.i_(t),this.stream.n_(function(){n(function(){return e.state=2,e.listener.n_()})}),this.stream.Zc(function(t){n(function(){return e.s_(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Fc.prototype.Kc=function(){var t=this;this.state=4,this.ih.xr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Fc.prototype.s_=function(t){return Fs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Fc.prototype.t_=function(e){var n=this;return function(t){n.Sr.Hr(function(){return n.Uc===e?t():(Fs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Fc),kc=(n(qc,Sc=xc),qc.prototype.i_=function(t){return this.Bc.r_("Listen",t)},qc.prototype.onMessage=function(t){this.ih.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.h_(e,n)},qc.prototype.o_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Yc(e)},qc.prototype.a_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Yc(e)},qc),Lc=(n(Uc,Ac=xc),Object.defineProperty(Uc.prototype,"c_",{get:function(){return this.u_},enumerable:!0,configurable:!0}),Uc.prototype.start=function(){this.u_=!1,Ac.prototype.start.call(this)},Uc.prototype.Xc=function(){this.u_&&this.__([])},Uc.prototype.i_=function(t){return this.Bc.r_("Write",t)},Uc.prototype.onMessage=function(t){if(Hs(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.u_){this.ih.reset();var e=this.serializer.Li(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.l_(n,e)}return Hs(!t.writeResults||0===t.writeResults.length),this.u_=!0,this.listener.d_()},Uc.prototype.f_=function(){var t={};t.database=this.serializer.wi,this.Yc(t)},Uc.prototype.__=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.Yc(n)},Uc),Dc=(n(jc,_c=function(){this.T_=void 0}),jc.prototype.E_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Bc.E_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},jc.prototype.I_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Bc.I_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},jc),Rc=(Mc.prototype.V_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.g_(),0<this.mutations.length)throw new _r(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e={database:(n=s).serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.I_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Hs(!!e),o.push(e)}),o)]}})})}(this.w_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof bo||t instanceof wo?n.p_(t):zs()}),e)]}})})},Mc.prototype.set=function(t,e){this.write(e.gc(t,this.Rt(t))),this.P_.add(t)},Mc.prototype.update=function(t,e){try{this.write(e.gc(t,this.y_(t)))}catch(t){this.A_=t}this.P_.add(t)},Mc.prototype.delete=function(t){this.write([new Gi(t,this.Rt(t))]),this.P_.add(t)},Mc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.g_(),this.A_)throw this.A_;return e=this.R_,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new zi(t,n.Rt(t)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n={database:(e=i).serializer.wi,writes:o.map(function(t){return e.serializer.vi(t)})},[4,e.E_("Commit",n)];case 1:return r=t.sent(),[2,e.serializer.Li(r.writeResults,r.commitTime)]}})})}(this.w_,this.mutations)];case 1:return t.sent(),this.m_=!0,[2]}})})},Mc.prototype.p_=function(t){var e;if(t instanceof wo)e=t.version;else{if(!(t instanceof bo))throw zs();e=Dr.min()}var n=this.R_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new _r(Nr.ABORTED,"Document version changed between two reads.")}else this.R_=this.R_.me(t.key,e)},Mc.prototype.Rt=function(t){var e=this.R_.get(t);return!this.P_.has(t)&&e?ji.updateTime(e):ji.ft()},Mc.prototype.y_=function(t){var e=this.R_.get(t);if(this.P_.has(t)||!e)return ji.exists(!0);if(e.isEqual(Dr.min()))throw new _r(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ji.updateTime(e)},Mc.prototype.write=function(t){this.g_(),this.mutations=this.mutations.concat(t)},Mc.prototype.g_=function(){},Mc),Oc=(Cc.prototype.C_=function(){var t=this;0===this.v_&&(this.F_("Unknown"),this.S_=this.qr.Br("online_state_timeout",1e4,function(){return t.S_=null,t.N_("Backend didn't respond within 10 seconds."),t.F_("Offline"),Promise.resolve()}))},Cc.prototype.k_=function(t){"Online"===this.state?this.F_("Unknown"):(this.v_++,1<=this.v_&&(this.M_(),this.N_("Connection failed 1 times. Most recent error: "+t.toString()),this.F_("Offline")))},Cc.prototype.set=function(t){this.M_(),this.v_=0,"Online"===t&&(this.D_=!1),this.F_(t)},Cc.prototype.F_=function(t){t!==this.state&&(this.state=t,this.b_(t))},Cc.prototype.N_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.D_?(Bs(e),this.D_=!1):Fs("OnlineStateTracker",e)},Cc.prototype.M_=function(){null!==this.S_&&(this.S_.cancel(),this.S_=null)},Cc),Pc=(Vc.prototype.start=function(){return this.enableNetwork()},Vc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.el()},Vc.prototype.el=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.W_()?(e=this.J_,[4,this.L_.vo()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.sl()?this.il():this.K_.set("Unknown"),[4,this.nl()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Vc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.rl()];case 1:return t.sent(),this.K_.set("Offline"),[2]}})})},Vc.prototype.rl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.J_.stop()];case 1:return t.sent(),[4,this.G_.stop()];case 2:return t.sent(),0<this.x_.length&&(Fs("RemoteStore","Stopping write stream with "+this.x_.length+" pending writes"),this.x_=[]),this.hl(),[2]}})})},Vc.prototype.Iu=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.rl()];case 1:return t.sent(),this.U_.Iu(),this.K_.set("Unknown"),[2]}})})},Vc.prototype.listen=function(t){this.O_.has(t.targetId)||(this.O_.set(t.targetId,t),this.sl()?this.il():this.G_.jc()&&this.ol(t))},Vc.prototype.al=function(t){this.O_.delete(t),this.G_.jc()&&this.ul(t),0===this.O_.size&&(this.G_.jc()?this.G_.zc():this.W_()&&this.K_.set("Unknown"))},Vc.prototype.si=function(t){return this.O_.get(t)||null},Vc.prototype.ei=function(t){return this.cl.ei(t)},Vc.prototype.ol=function(t){this.B_.Ns(t.targetId),this.G_.o_(t)},Vc.prototype.ul=function(t){this.B_.Ns(t),this.G_.a_(t)},Vc.prototype.il=function(){this.B_=new Es(this),this.G_.start(),this.K_.C_()},Vc.prototype.sl=function(){return this.W_()&&!this.G_.Wc()&&0<this.O_.size},Vc.prototype.W_=function(){return!this.q_&&this.isPrimary&&this.networkEnabled},Vc.prototype.hl=function(){this.B_=null},Vc.prototype.z_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.O_.forEach(function(t,e){n.ol(t)}),[2]})})},Vc.prototype.H_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.hl(),this.sl()?(this.K_.k_(e),this.il()):this.K_.set("Unknown"),[2]})})},Vc.prototype.Y_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.K_.set("Online"),!(i instanceof ds&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this._l(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Fs("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.ll(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof ls?this.B_.qs(i):i instanceof ps?this.B_.Hs(i):this.B_.Ws(i),o.isEqual(Dr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.L_.Jo()];case 8:return n=t.sent(),0<=o.S(n)?[4,this.dl(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Fs("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.ll(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Vc.prototype.ll=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if("IndexedDbTransactionError"!==n.name)throw n;return this.q_=!0,[4,this.rl()];case 1:return t.sent(),this.K_.set("Offline"),this.qr.dh(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","Retrying IndexedDB access"),[4,this.L_.Jo()];case 1:return t.sent(),this.q_=!1,[4,this.el()];case 2:return t.sent(),[2]}})})}),[2]}})})},Vc.prototype.dl=function(r){var i=this,t=this.B_.Xs(r);return t.as.forEach(function(t,e){var n;0<t.resumeToken.rt()&&((n=i.O_.get(e))&&i.O_.set(e,n.we(t.resumeToken,r)))}),t.us.forEach(function(t){var e,n=i.O_.get(t);n&&(i.O_.set(t,n.we(Zr.ht,n.Ee)),i.ul(t),e=new Ro(n.target,t,1,n.sequenceNumber),i.ol(e))}),this.cl.Yu(t)},Vc.prototype._l=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.O_.has(i)?[4,this.cl.fl(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.O_.delete(i),this.B_.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Vc.prototype.nl=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Tl()?(e=0<this.x_.length?this.x_[this.x_.length-1].batchId:-1,[4,this.L_.tc(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.x_.length&&this.J_.zc(),[3,4]);case 2:return this.El(n),[4,this.nl()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.Il()&&this.wl(),[2]}})})},Vc.prototype.Tl=function(){return this.W_()&&this.x_.length<10},Vc.prototype.Rl=function(){return this.x_.length},Vc.prototype.El=function(t){this.x_.push(t),this.J_.jc()&&this.J_.c_&&this.J_.__(t.mutations)},Vc.prototype.Il=function(){return this.W_()&&!this.J_.Wc()&&0<this.x_.length},Vc.prototype.wl=function(){this.J_.start()},Vc.prototype.X_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.J_.f_(),[2]})})},Vc.prototype.tl=function(){var r=this;return this.L_.So(this.J_.lastStreamToken).then(function(){for(var t=0,e=r.x_;t<e.length;t++){var n=e[t];r.J_.__(n.mutations)}}).catch(mh)},Vc.prototype.l_=function(t,e){var n=this,r=this.x_.shift(),i=eu.from(r,t,e,this.J_.lastStreamToken);return this.cl.ml(i).then(function(){return n.nl()})},Vc.prototype.Z_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&0<this.x_.length?this.J_.c_?[4,this.Al(e)]:[3,2]:[3,5];case 1:return t.sent(),[3,4];case 2:return[4,this.Pl(e)];case 3:t.sent(),t.label=4;case 4:this.Il()&&this.wl(),t.label=5;case 5:return[2]}})})},Vc.prototype.Pl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Wo(e.code)?[2,(Fs("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.J_.lastStreamToken),this.J_.lastStreamToken=Zr.ht,this.L_.So(Zr.ht).catch(mh))]:[2]})})},Vc.prototype.Al=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Wo(n=i.code)&&n!==Nr.ABORTED?(e=this.x_.shift(),[2,(this.J_.Gc(),this.cl.Vl(e.batchId,i).then(function(){return r.nl()}))]):[2]})})},Vc.prototype.gl=function(){return new Rc(this.w_)},Vc.prototype.j_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.rl()];case 1:return t.sent(),this.K_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Vc.prototype.pl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.W_()?(Fs("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.j_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Vc.prototype.yl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.rl()];case 3:t.sent(),this.K_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Vc);function Vc(t,e,n,r,i){var o,s,u,a,h,c,f=this;this.L_=t,this.w_=e,this.qr=n,this.x_=[],this.O_=new Map,this.B_=null,this.networkEnabled=!1,this.isPrimary=!1,this.q_=!1,this.U_=i,this.U_.Q_(function(t){n.Hr(function(){return y(f,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.W_()?(Fs("RemoteStore","Restarting streams for network reachability change."),[4,this.j_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.K_=new Oc(n,r),this.G_=(a=this.w_,h=n,c={n_:this.z_.bind(this),Zc:this.H_.bind(this),h_:this.Y_.bind(this)},new kc(h,a.Bc,a.credentials,a.serializer,c)),this.J_=(o=this.w_,s=n,u={n_:this.X_.bind(this),Zc:this.Z_.bind(this),d_:this.tl.bind(this),l_:this.l_.bind(this)},new Lc(s,o.Bc,o.credentials,o.serializer,u))}function Cc(t,e){this.qr=t,this.b_=e,this.state="Unknown",this.v_=0,this.S_=null,this.D_=!0}function Mc(t){this.w_=t,this.R_=as,this.mutations=[],this.m_=!1,this.A_=null,this.P_=new Set}function jc(t,e,n){var r=this;return(r=_c.call(this)||this).Bc=t,r.credentials=e,r.serializer=n,r}function Uc(t,e,n,r,i){var o=this;return(o=Ac.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.u_=!1,o.lastStreamToken=Zr.ht,o}function qc(t,e,n,r,i){var o=this;return(o=Sc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Fc(t,e,n,r,i,o){this.Sr=t,this.Oc=n,this.Bc=r,this.qc=i,this.listener=o,this.state=0,this.Uc=0,this.Qc=null,this.stream=null,this.ih=new Nu(t,e)}function Bc(t,e){return"firestore_clients_"+t+"_"+e}function Gc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function zc(t,e){return"firestore_targets_"+t+"_"+e}function Hc(t){this.key=t}function Kc(t){this.key=t}function Wc(t,e,n){this.query=t,this.targetId=e,this.view=n}function Xc(t){this.key=t,this.Wd=!1}function Yc(){this.yf=void 0,this.bf=[]}var Qc,Jc,Zc=(Lf.bl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new _r(r.error.code,r.error.message)),i?new Lf(t,e,r.state,o):(Bs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Lf.prototype.vl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Lf),$c=(kf.bl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new _r(n.error.code,n.error.message)),r?new kf(t,n.state,i):(Bs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},kf.prototype.vl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},kf),tf=(xf.bl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fs,o=0;r&&o<n.activeTargetIds.length;++o)r=ni(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new xf(t,i):(Bs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},xf),ef=(Sf.bl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Sf(e.clientId,e.onlineState):(Bs("SharedClientState","Failed to parse online state: "+t),null)},Sf),nf=(Af.prototype.Sl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Af.prototype.Dl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Af.prototype.vl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Af),rf=(_f.so=function(t){return!(!t.window||null==t.window.localStorage)},_f.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.cl.Pu()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Cl&&(o=this.getItem(Bc(this.persistenceKey,i)))&&(s=tf.bl(i,o))&&(this.kl=this.kl.me(s.clientId,s));for(this.Ul(),(u=this.storage.getItem(this.ql))&&(a=this.Ql(u))&&this.Wl(a),h=0,c=this.$l;h<c.length;h++)f=c[h],this.Nl(f);return this.$l=[],this.platform.window.addEventListener("unload",function(){return l.Iu()}),this.Uh=!0,[2]}})})},_f.prototype.br=function(t){this.setItem(this.Ll,JSON.stringify(t))},_f.prototype.jl=function(){return this.Kl(this.kl)},_f.prototype.Gl=function(n){var r=!1;return this.kl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},_f.prototype.zl=function(t){this.Hl(t,"pending")},_f.prototype.Yl=function(t,e,n){this.Hl(t,e,n),this.Jl(t)},_f.prototype.Xl=function(t){var e,n,r="not-current";return this.Gl(t)&&(!(e=this.storage.getItem(zc(this.persistenceKey,t)))||(n=$c.bl(t,e))&&(r=n.state)),this.Zl.Sl(t),this.Ul(),r},_f.prototype.td=function(t){this.Zl.Dl(t),this.Ul()},_f.prototype.ed=function(t){return this.Zl.activeTargetIds.has(t)},_f.prototype.sd=function(t){this.removeItem(zc(this.persistenceKey,t))},_f.prototype.nd=function(t,e,n){this.rd(t,e,n)},_f.prototype.Qu=function(t,e,n){var r=this;e.forEach(function(t){r.Jl(t)}),this.currentUser=t,n.forEach(function(t){r.zl(t)})},_f.prototype.hd=function(t){this.od(t)},_f.prototype.Iu=function(){this.Uh&&(this.platform.window.removeEventListener("storage",this.Fl),this.removeItem(this.Ml),this.Uh=!1)},_f.prototype.getItem=function(t){var e=this.storage.getItem(t);return Fs("SharedClientState","READ",t,e),e},_f.prototype.setItem=function(t,e){Fs("SharedClientState","SET",t,e),this.storage.setItem(t,e)},_f.prototype.removeItem=function(t){Fs("SharedClientState","REMOVE",t),this.storage.removeItem(t)},_f.prototype.Nl=function(u){var t=this;if(u.storageArea===this.storage){if(Fs("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Ml)return void Bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Sr.dh(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.Uh){if(null!==u.key)if(this.xl.test(u.key)){if(null==u.newValue)return e=this.ad(u.key),[2,this.ud(e,null)];if(n=this._d(u.key,u.newValue))return[2,this.ud(n.clientId,n)]}else if(this.Ol.test(u.key)){if(null!==u.newValue&&(r=this.ld(u.key,u.newValue)))return[2,this.dd(r)]}else if(this.Bl.test(u.key)){if(null!==u.newValue&&(i=this.fd(u.key,u.newValue)))return[2,this.Td(i)]}else if(u.key===this.ql){if(null!==u.newValue&&(o=this.Ql(u.newValue)))return[2,this.Wl(o)]}else u.key===this.Ll&&(s=function(t){var e=cu.vr;if(null!=t)try{var n=JSON.parse(t);Hs("number"==typeof n),e=n}catch(t){Bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==cu.vr&&this.gr(s)}else this.$l.push(u);return[2]})})})}},Object.defineProperty(_f.prototype,"Zl",{get:function(){return this.kl.get(this.Cl)},enumerable:!0,configurable:!0}),_f.prototype.Ul=function(){this.setItem(this.Ml,this.Zl.vl())},_f.prototype.Hl=function(t,e,n){var r=new Zc(this.currentUser,t,e,n),i=Gc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.vl())},_f.prototype.Jl=function(t){var e=Gc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},_f.prototype.od=function(t){var e={clientId:this.Cl,onlineState:t};this.storage.setItem(this.ql,JSON.stringify(e))},_f.prototype.rd=function(t,e,n){var r=zc(this.persistenceKey,t),i=new $c(t,e,n);this.setItem(r,i.vl())},_f.prototype.ad=function(t){var e=this.xl.exec(t);return e?e[1]:null},_f.prototype._d=function(t,e){var n=this.ad(t);return tf.bl(n,e)},_f.prototype.ld=function(t,e){var n=this.Ol.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Zc.bl(new wr(i),r,e)},_f.prototype.fd=function(t,e){var n=this.Bl.exec(t),r=Number(n[1]);return $c.bl(r,e)},_f.prototype.Ql=function(t){return ef.bl(t)},_f.prototype.dd=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.cl.Ed(e.batchId,e.state,e.error)]:(Fs("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},_f.prototype.Td=function(t){return this.cl.Id(t.targetId,t.state,t.error)},_f.prototype.ud=function(t,e){var n=this,r=e?this.kl.me(t,e):this.kl.remove(t),i=this.Kl(this.kl),o=this.Kl(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.cl.wd(s,u).then(function(){n.kl=r})},_f.prototype.Wl=function(t){this.kl.get(t.clientId)&&this.b_(t.onlineState)},_f.prototype.Kl=function(t){var n=fs;return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},_f),of=(Nf.prototype.zl=function(t){},Nf.prototype.Yl=function(t,e,n){},Nf.prototype.Xl=function(t){return this.Rd.Sl(t),this.md[t]||"not-current"},Nf.prototype.nd=function(t,e,n){this.md[t]=e},Nf.prototype.td=function(t){this.Rd.Dl(t)},Nf.prototype.ed=function(t){return this.Rd.activeTargetIds.has(t)},Nf.prototype.sd=function(t){delete this.md[t]},Nf.prototype.jl=function(){return this.Rd.activeTargetIds},Nf.prototype.Gl=function(t){return this.Rd.activeTargetIds.has(t)},Nf.prototype.start=function(){return this.Rd=new nf,Promise.resolve()},Nf.prototype.Qu=function(t,e,n){},Nf.prototype.hd=function(t){},Nf.prototype.Iu=function(){},Nf.prototype.br=function(t){},Nf),sf=(Object.defineProperty(Tf.prototype,"pd",{get:function(){return this.Ad},enumerable:!0,configurable:!0}),Tf.prototype.yd=function(t,e){var u=this,a=e?e.bd:new vs,h=e?e.gd:this.gd,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=(r=e instanceof wo?e:null)&&(u.query.matches(r)?r:null),i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.vd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{gd:f,bd:a,Sd:l,ns:c}},Tf.prototype.vd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},Tf.prototype.Zn=function(t,e,n){var o=this,r=this.gd;this.gd=t.gd,this.ns=t.ns;var i=t.bd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zs()}}var r,i}),this.Dd(n);var s=e?this.Cd():[],u=0===this.Vd.size&&this.fs?1:0,a=u!==this.Pd;return this.Pd=u,0!==i.length||a?{snapshot:new gs(this.query,t.gd,r,i,t.ns,0==u,a,!1),Fd:s}:{Fd:s}},Tf.prototype.Nd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.Zn({gd:this.gd,bd:new vs,ns:this.ns,Sd:!1},!1)):{Fd:[]}},Tf.prototype.kd=function(t){return!this.Ad.has(t)&&!!this.gd.has(t)&&!this.gd.get(t).At},Tf.prototype.Dd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.Ad=e.Ad.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.Ad=e.Ad.delete(t)}),this.fs=t.fs)},Tf.prototype.Cd=function(){var e=this;if(!this.fs)return[];var n=this.Vd;this.Vd=cs(),this.gd.forEach(function(t){e.kd(t.key)&&(e.Vd=e.Vd.add(t.key))});var r=[];return n.forEach(function(t){e.Vd.has(t)||r.push(new Kc(t))}),this.Vd.forEach(function(t){n.has(t)||r.push(new Hc(t))}),r},Tf.prototype.$d=function(t){this.Ad=t.rc,this.Vd=cs();var e=this.yd(t.documents);return this.Zn(e,!0)},Tf.prototype.Md=function(){return gs.os(this.query,this.gd,this.ns,0===this.Pd)},Tf),uf=(If.prototype.Od=function(){this.Bd()},If.prototype.Bd=function(){var t=this;this.ih.xr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.Ld.gl(),(n=this.qd(e))&&n.then(function(t){r.qr.Hr(function(){return e.commit().then(function(){r.Wr.resolve(t)}).catch(function(t){r.Ud(t)})})}).catch(function(t){r.Ud(t)}),[2]})})})},If.prototype.qd=function(t){try{var e=this.updateFunction(t);return!ti(e)&&e.catch&&e.then?e:(this.Wr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Wr.reject(t),null}},If.prototype.Ud=function(t){var e=this;0<this.xd&&this.Qd(t)?(--this.xd,this.qr.Hr(function(){return e.Bd(),Promise.resolve()})):this.Wr.reject(t)},If.prototype.Qd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Wo(e)},If),af=(Object.defineProperty(Ef.prototype,"if",{get:function(){return!0},enumerable:!0,configurable:!0}),Ef.prototype.subscribe=function(t){this.Gd=t},Ef.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.nf("listen()"),(r=this.zd.get(s))?(e=r.targetId,this.jd.Xl(e),n=r.view.Md(),[3,4]):[3,1];case 1:return[4,this.L_.sc(s.ee())];case 2:return i=t.sent(),o=this.jd.Xl(i.targetId),e=i.targetId,[4,this.rf(s,e,"current"===o)];case 3:n=t.sent(),this.if&&this.Ld.listen(i),t.label=4;case 4:return[2,n]}})})},Ef.prototype.rf=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.L_.nc(u,!0)];case 1:return e=t.sent(),n=new sf(u,e.rc),r=n.yd(e.documents),i=ws.ds(a,h&&"Offline"!==this.onlineState),o=n.Zn(r,this.if,i),this.hf(a,o.Fd),s=new Wc(u,a,n),[2,(this.zd.set(u,s),this.Hd.has(a)?this.Hd.get(a).push(u):this.Hd.set(a,[u]),o.snapshot)]}})})},Ef.prototype.al=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.nf("unlisten()"),e=this.zd.get(i),1<(n=this.Hd.get(e.targetId)).length?[2,(this.Hd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.zd.delete(i))]:this.if?(this.jd.td(e.targetId),this.jd.Gl(e.targetId)?[3,2]:[4,this.L_.ic(e.targetId,!1).then(function(){r.jd.sd(e.targetId),r.Ld.al(e.targetId),r.af(e.targetId)}).catch(mh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.af(e.targetId),[4,this.L_.ic(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Ef.prototype.write=function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.nf("write()"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.L_.Gu(r)];case 2:return e=t.sent(),[3,4];case 3:if("IndexedDbTransactionError"===(n=t.sent()).name)return[2,(Bs("SyncEngine","Dropping write that cannot be persisted: "+n),void i.reject(new _r(Nr.UNAVAILABLE,"Failed to persist write: "+n)))];throw n;case 4:return this.jd.zl(e.batchId),this.uf(e.batchId,i),[4,this.cf(e.Wn)];case 5:return t.sent(),[4,this.Ld.nl()];case 6:return t.sent(),[2]}})})},Ef.prototype.runTransaction=function(t,e,n){new uf(t,this.Ld,e,n).Od()},Ef.prototype.Yu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.nf("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.L_.Yu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.Xd.get(e);n&&(Hs(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.Wd=!0:0<t.Es.size?Hs(n.Wd):0<t.Is.size&&(Hs(n.Wd),n.Wd=!1))}),[4,this.cf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,mh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Ef.prototype.Nd=function(r,t){this.nf("applyOnlineStateChange()");var i=[];this.zd.forEach(function(t,e){var n=e.view.Nd(r);n.snapshot&&i.push(n.snapshot)}),this.Gd._f(r),this.Gd.h_(i),this.onlineState=r},Ef.prototype.fl=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.nf("rejectListens()"),this.jd.nd(u,"rejected",a),e=this.Xd.get(u),(n=e&&e.key)?(this.Jd=this.Jd.remove(n),this.Xd.delete(u),this.lf(),r=(r=new Yo(Wr.N)).me(n,new bo(n,Dr.min())),i=cs().add(n),o=new ms(Dr.min(),new Map,new ns(Xs),r,i),[2,this.Yu(o)]):[4,this.L_.ic(u,!1).then(function(){return s.af(u,a)}).catch(mh)];case 1:return t.sent(),[2]}})})},Ef.prototype.ml=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.nf("applySuccessfulWrite()"),e=r.batch.batchId,this.df(e,null),this.ff(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.L_.yo(r)];case 2:return n=t.sent(),this.jd.Yl(e,"acknowledged"),[4,this.cf(n)];case 3:return t.sent(),[3,6];case 4:return[4,mh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Ef.prototype.Vl=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.nf("rejectFailedWrite()"),this.df(n,r),this.ff(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.L_.Hu(n)];case 2:return e=t.sent(),this.jd.Yl(n,"rejected",r),[4,this.cf(e)];case 3:return t.sent(),[3,6];case 4:return[4,mh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Ef.prototype.Tf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Ld.W_()||Fs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.L_.Lo()];case 1:return-1===(e=t.sent())?[2,void r.resolve()]:((n=this.ef.get(e)||[]).push(r),this.ef.set(e,n),[2])}})})},Ef.prototype.ff=function(t){(this.ef.get(t)||[]).forEach(function(t){t.resolve()}),this.ef.delete(t)},Ef.prototype.Ef=function(e){this.ef.forEach(function(t){t.forEach(function(t){t.reject(new _r(Nr.CANCELLED,e))})}),this.ef.clear()},Ef.prototype.uf=function(t,e){var n=(n=(n=this.tf[this.currentUser.s()])||new Yo(Xs)).me(t,e);this.tf[this.currentUser.s()]=n},Ef.prototype.df=function(t,e){var n,r=this.tf[this.currentUser.s()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.tf[this.currentUser.s()]=r)},Ef.prototype.af=function(t,e){var n=this;void 0===e&&(e=null),this.jd.td(t);for(var r,i=0,o=this.Hd.get(t);i<o.length;i++){var s=o[i];this.zd.delete(s),e&&this.Gd.If(s,e)}this.Hd.delete(t),this.if&&(r=this.Zd.Cn(t),this.Zd.Sn(t),r.forEach(function(t){n.Zd.Fn(t)||n.wf(t)}))},Ef.prototype.wf=function(t){var e=this.Jd.get(t);null!==e&&(this.Ld.al(e),this.Jd=this.Jd.remove(t),this.Xd.delete(e),this.lf())},Ef.prototype.hf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Hc?(this.Zd.gn(i.key,t),this.Rf(i)):i instanceof Kc?(Fs("SyncEngine","Document no longer in limbo: "+i.key),this.Zd.yn(i.key,t),this.Zd.Fn(i.key)||this.wf(i.key)):zs()}},Ef.prototype.Rf=function(t){var e=t.key;this.Jd.get(e)||(Fs("SyncEngine","New document in limbo: "+e),this.Yd.push(e),this.lf())},Ef.prototype.lf=function(){for(;0<this.Yd.length&&this.Jd.size<this.Kd;){var t=this.Yd.shift(),e=this.sf.next();this.Xd.set(e,new Xc(t)),this.Jd=this.Jd.me(t,e),this.Ld.listen(new Ro(To.Wt(t.path).ee(),e,2,cu.vr))}},Ef.prototype.mf=function(){return this.Jd},Ef.prototype.Af=function(){return this.Yd},Ef.prototype.cf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.zd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.yd(r);return n.Sd?u.L_.nc(i.query,!1).then(function(t){var e=t.documents;return i.view.yd(e,n)}):n}).then(function(t){var e,n=a&&a.as.get(i.targetId),r=i.view.Zn(t,u.if,n);u.hf(i.targetId,r.Fd),r.snapshot&&(u.if&&u.jd.nd(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=hu.Vr(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Gd.h_(o),[4,this.L_.Zu(s)];case 2:return t.sent(),[2]}})})},Ef.prototype.nf=function(t){},Ef.prototype.pl=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.Ef("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.L_.Qu(r)]):[3,3];case 1:return n=t.sent(),this.jd.Qu(r,n.ju,n.Ku),[4,this.cf(n.Wu)];case 2:t.sent(),t.label=3;case 3:return[4,this.Ld.pl()];case 4:return t.sent(),[2]}})})},Ef.prototype.enableNetwork=function(){return this.Ld.enableNetwork()},Ef.prototype.disableNetwork=function(){return this.Ld.disableNetwork()},Ef.prototype.ei=function(t){var e=this.Xd.get(t);if(e&&e.Wd)return cs().add(e.key);var n=cs(),r=this.Hd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.zd.get(s),n=n.He(u.view.pd);return n},Ef),hf=(n(bf,Qc=af),Object.defineProperty(bf.prototype,"if",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),bf.prototype.enableNetwork=function(){return this.L_.ru(!0),Qc.prototype.enableNetwork.call(this)},bf.prototype.disableNetwork=function(){return this.L_.ru(!1),Qc.prototype.disableNetwork.call(this)},bf.prototype.Pf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.L_.nc(r.query,!0)];case 1:return e=t.sent(),n=r.view.$d(e),[2,(this.isPrimary&&this.hf(r.targetId,n.Fd),n)]}})})},bf.prototype.Nd=function(t,e){this.if&&0===e&&(Qc.prototype.Nd.call(this,t,e),this.jd.hd(t)),this.if||1!==e||Qc.prototype.Nd.call(this,t,e)},bf.prototype.Ed=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.nf("applyBatchState()"),[4,this.L_.ac(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Ld.nl()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.df(n,i||null),this.L_.uc(n)):zs(),t.label=4;case 4:return[4,this.cf(e)];case 5:return t.sent(),[3,7];case 6:Fs("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},bf.prototype.yl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Ld.yl(!0)]);case 1:return t.sent(),e=this.jd.jl(),[4,this.Vf(e.W())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Ld.listen(o);return[3,7];case 3:return!1!==h||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),this.Hd.forEach(function(t,e){a.jd.ed(e)?s.push(e):u=u.then(function(){return a.af(e),a.L_.ic(e,!0)}),a.Ld.al(e)}),[4,u]);case 4:return t.sent(),[4,this.Vf(s)];case 5:return t.sent(),this.gf(),[4,this.Ld.yl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},bf.prototype.gf=function(){var n=this;this.Xd.forEach(function(t,e){n.Ld.al(e)}),this.Zd.Dn(),this.Xd=new Map,this.Jd=new Yo(Wr.N)},bf.prototype.Vf=function(d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.Hd.get(o))&&0!==u.length?[4,this.L_.ic(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.L_.sc(u[0].ee())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.zd.get(c),[4,this.Pf(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.L_.cc(o)];case 9:return p=t.sent(),[4,this.L_.sc(p)];case 10:return s=t.sent(),[4,this.rf(this.pf(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Gd.h_(n),e)]}})})},bf.prototype.pf=function(t){return new To(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},bf.prototype.Pu=function(){return this.L_.Pu()},bf.prototype.Id=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.isPrimary?(Fs("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.Hd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.L_.Va()];case 3:return e=t.sent(),n=ms.ls(r,"current"===i),[4,this.cf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.L_.ic(r,!0)];case 6:return t.sent(),this.af(r,o),[3,8];case 7:zs(),t.label=8;case 8:return[2]}})})},bf.prototype.wd=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.Hd.has(r)?(Fs("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.L_.cc(r)]):[3,6];case 2:return i=t.sent(),[4,this.L_.sc(i)];case 3:return o=t.sent(),[4,this.rf(this.pf(i),o.targetId,!1)];case 4:t.sent(),this.Ld.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.Hd.has(e)?[4,u.L_.ic(e,!1).then(function(){f.Ld.al(e),f.af(e)}).catch(mh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},bf),cf=(wf.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.vf.get(e))||(n=!0,r=new Yc),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.cl.listen(e)];case 2:return i.yf=t.sent(),[3,4];case 3:if(o=t.sent(),Bs("EventManager",s="Initialization of query '"+e+"' failed: "+o),"IndexedDbTransactionError"!==o.name)throw o;return[2,void u.onError(new _r(Nr.UNAVAILABLE,s))];case 4:return this.vf.set(e,r),r.bf.push(u),u.Nd(this.onlineState),r.yf&&u.Df(r.yf)&&this.Cf(),[2]}})})},wf.prototype.al=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.vf.get(e))&&0<=(i=r.bf.indexOf(o))&&(r.bf.splice(i,1),n=0===r.bf.length),n?[2,(this.vf.delete(e),this.cl.al(e))]:[2]})})},wf.prototype.h_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.vf.get(o);if(s){for(var u=0,a=s.bf;u<a.length;u++)a[u].Df(i)&&(e=!0);s.yf=i}}e&&this.Cf()},wf.prototype.If=function(t,e){var n=this.vf.get(t);if(n)for(var r=0,i=n.bf;r<i.length;r++)i[r].onError(e);this.vf.delete(t)},wf.prototype._f=function(i){this.onlineState=i;var o=!1;this.vf.forEach(function(t,e){for(var n=0,r=e.bf;n<r.length;n++)r[n].Nd(i)&&(o=!0)}),o&&this.Cf()},wf.prototype.Ff=function(t){this.Sf.add(t),t.next()},wf.prototype.Nf=function(t){this.Sf.delete(t)},wf.prototype.Cf=function(){this.Sf.forEach(function(t){t.next()})},wf),ff=(mf.prototype.Df=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new gs(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.$f?this.Lf(t)&&(this.kf.next(t),o=!0):this.xf(t,this.onlineState)&&(this.Of(t),o=!0),this.Mf=t,o},mf.prototype.onError=function(t){this.kf.error(t)},mf.prototype.Nd=function(t){this.onlineState=t;var e=!1;return this.Mf&&!this.$f&&this.xf(this.Mf,t)&&(this.Of(this.Mf),e=!0),e},mf.prototype.xf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Bf&&n||t.docs.B()&&"Offline"!==e)},mf.prototype.Lf=function(t){if(0<t.docChanges.length)return!0;var e=this.Mf&&this.Mf.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},mf.prototype.Of=function(t){t=gs.os(t.query,t.docs,t.ns,t.fromCache),this.$f=!0,this.kf.next(t)},mf),lf=(gf.prototype.Uu=function(t){this.qf=t},gf.prototype.dr=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Dr.min())?this.Uf(e,r):this.qf.cr(e,o).next(function(t){var n=s.Qf(r,t);return(r.oe()||r.ae())&&s.Sd(r.Bt,n,o,i)?s.Uf(e,r):(Us()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.qf.dr(e,r,i).next(function(e){return n.forEach(function(t){e=e.me(t.key,t)}),e}))})},gf.prototype.Qf=function(n,t){var r=new ns(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof wo&&n.matches(e)&&(r=r.add(e))}),r},gf.prototype.Sd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},gf.prototype.Uf=function(t,e){return Us()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.qf.dr(t,e,Dr.min())},gf),pf=(vf.prototype.po=function(t){return iu.resolve(0===this.nr.length)},vf.prototype.yo=function(t,e,n){var r=e.batchId,i=this.Kf(r,"acknowledged");return Hs(0===i),this.nr[i],this.lastStreamToken=n,iu.resolve()},vf.prototype.vo=function(t){return iu.resolve(this.lastStreamToken)},vf.prototype.So=function(t,e){return this.lastStreamToken=e,iu.resolve()},vf.prototype.Do=function(t,e,n,r){var i=this.Wf;this.Wf++,0<this.nr.length&&this.nr[this.nr.length-1];var o=new tu(i,e,n,r);this.nr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.jf=this.jf.add(new ru(a.key,i)),this.rr.Fo(t,a.key.path.M())}return iu.resolve(o)},vf.prototype.No=function(t,e){return iu.resolve(this.Gf(e))},vf.prototype.Mo=function(t,e){var n=e+1,r=this.zf(n),i=r<0?0:r;return iu.resolve(this.nr.length>i?this.nr[i]:null)},vf.prototype.Lo=function(){return iu.resolve(0===this.nr.length?-1:this.Wf-1)},vf.prototype.xo=function(t){return iu.resolve(this.nr.slice())},vf.prototype.or=function(t,e){var n=this,r=new ru(e,0),i=new ru(e,Number.POSITIVE_INFINITY),o=[];return this.jf.Ke([r,i],function(t){var e=n.Gf(t.Nn);o.push(e)}),iu.resolve(o)},vf.prototype.lr=function(t,e){var r=this,i=new ns(Xs);return e.forEach(function(t){var e=new ru(t,0),n=new ru(t,Number.POSITIVE_INFINITY);r.jf.Ke([e,n],function(t){i=i.add(t.Nn)})}),iu.resolve(this.Hf(i))},vf.prototype.Rr=function(t,e){var n=e.path,r=n.length+1,i=n;Wr.et(i)||(i=i.child(""));var o=new ru(new Wr(i),0),s=new ns(Xs);return this.jf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.Nn)),!0)},o),iu.resolve(this.Hf(s))},vf.prototype.Hf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Gf(t);null!==e&&r.push(e)}),r},vf.prototype.Bo=function(n,r){var i=this;Hs(0===this.Kf(r.batchId,"removed")),this.nr.shift();var o=this.jf;return iu.forEach(r.mutations,function(t){var e=new ru(t.key,r.batchId);return o=o.delete(e),i.Ao.Qo(n,t.key)}).next(function(){i.jf=o})},vf.prototype.Uo=function(t){},vf.prototype.Fn=function(t,e){var n=new ru(e,0),r=this.jf.ze(n);return iu.resolve(e.isEqual(r&&r.key))},vf.prototype.Wo=function(t){return this.nr.length,iu.resolve()},vf.prototype.Kf=function(t,e){return this.zf(t)},vf.prototype.zf=function(t){return 0===this.nr.length?0:t-this.nr[0].batchId},vf.prototype.Gf=function(t){var e=this.zf(t);return e<0||e>=this.nr.length?null:this.nr[e]},vf),df=(yf.prototype.Gn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Yf(e);return this.docs=this.docs.me(r,{Ea:e,size:s,readTime:n}),this.size+=s-o,this.rr.Fo(t,r.path.M())},yf.prototype.Hn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},yf.prototype.Yn=function(t,e){var n=this.docs.get(e);return iu.resolve(n?n.Ea:null)},yf.prototype.getEntries=function(t,e){var n=this,r=is;return e.forEach(function(t){var e=n.docs.get(t);r=r.me(t,e?e.Ea:null)}),iu.resolve(r)},yf.prototype.dr=function(t,e,n){for(var r=us,i=new Wr(e.path.child("")),o=this.docs.ve(i);o.ke();){var s=o.Ne(),u=s.key,a=s.value,h=a.Ea,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof wo&&e.matches(h)&&(r=r.me(h.key,h))}return iu.resolve(r)},yf.prototype.Jf=function(t,e){return iu.forEach(this.docs,function(t){return e(t)})},yf.prototype.ba=function(t){return new yf.va(this)},yf.prototype.Da=function(t){return iu.resolve(this.size)},yf);function yf(t,e){this.rr=t,this.Yf=e,this.docs=new Yo(Wr.N),this.size=0}function vf(t,e){this.rr=t,this.Ao=e,this.nr=[],this.Wf=1,this.lastStreamToken=Zr.ht,this.jf=new ns(ru.An)}function gf(){}function mf(t,e,n){this.query=t,this.kf=e,this.$f=!1,this.Mf=null,this.onlineState="Unknown",this.options=n||{}}function wf(t){this.cl=t,this.vf=new $s(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.Sf=new Set,this.cl.subscribe(this)}function bf(t,e,n,r,i){var o=this;return(o=Qc.call(this,t,e,n,r,i)||this).L_=t,o.isPrimary=void 0,o}function Ef(t,e,n,r,i){this.L_=t,this.Ld=e,this.jd=n,this.currentUser=r,this.Kd=i,this.Gd=null,this.zd=new $s(function(t){return t.canonicalId()}),this.Hd=new Map,this.Yd=[],this.Jd=new Yo(Wr.N),this.Xd=new Map,this.Zd=new nu,this.tf={},this.ef=new Map,this.sf=fa.Go(),this.onlineState="Unknown"}function If(t,e,n,r){this.qr=t,this.Ld=e,this.updateFunction=n,this.Wr=r,this.xd=5,this.ih=new Nu(this.qr,"transaction_retry")}function Tf(t,e){this.query=t,this.Ad=e,this.Pd=null,this.fs=!1,this.Vd=cs(),this.ns=cs(),this.gd=new ys(t.se.bind(t))}function Nf(){this.Rd=new nf,this.md={},this.cl=null,this.b_=null,this.gr=null}function _f(t,e,n,r,i){if(this.Sr=t,this.platform=e,this.persistenceKey=n,this.Cl=r,this.cl=null,this.b_=null,this.gr=null,this.Fl=this.Nl.bind(this),this.kl=new Yo(Xs),this.Uh=!1,this.$l=[],!_f.so(this.platform))throw new _r(Nr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Ml=Bc(this.persistenceKey,this.Cl),this.Ll="firestore_sequence_number_"+this.persistenceKey,this.kl=this.kl.me(this.Cl,new nf),this.xl=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Ol=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Bl=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ql="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Fl)}function Af(){this.activeTargetIds=fs}function Sf(t,e){this.clientId=t,this.onlineState=e}function xf(t,e){this.clientId=t,this.activeTargetIds=e}function kf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Lf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Df(t){var e=this;return(e=Jc.call(this)||this).Ca=t,e}df.va=(n(Df,Jc=ou),Df.prototype.Zn=function(n){var r=this,i=[];return this.Wn.forEach(function(t,e){e?i.push(r.Ca.Gn(n,e,r.readTime)):r.Ca.Hn(t)}),iu.Un(i)},Df.prototype.Jn=function(t,e){return this.Ca.Yn(t,e)},Df.prototype.Xn=function(t,e){return this.Ca.getEntries(t,e)},Df);var Rf,Of,Pf=(Yf.prototype.js=function(t,n){return this.Xf.forEach(function(t,e){return n(e)}),iu.resolve()},Yf.prototype.Jo=function(t){return iu.resolve(this.lastRemoteSnapshotVersion)},Yf.prototype.Xo=function(t){return iu.resolve(this.Zf)},Yf.prototype.zo=function(t){return this.highestTargetId=this.eT.next(),iu.resolve(this.highestTargetId)},Yf.prototype.Zo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Zf&&(this.Zf=e),iu.resolve()},Yf.prototype.ea=function(t){this.Xf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.eT=new fa(e),this.highestTargetId=e),t.sequenceNumber>this.Zf&&(this.Zf=t.sequenceNumber)},Yf.prototype.ta=function(t,e){return this.ea(e),this.targetCount+=1,iu.resolve()},Yf.prototype.ia=function(t,e){return this.ea(e),iu.resolve()},Yf.prototype.na=function(t,e){return this.Xf.delete(e.target),this.tT.Sn(e.targetId),--this.targetCount,iu.resolve()},Yf.prototype.Hh=function(n,r,i){var o=this,s=0,u=[];return this.Xf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Xf.delete(t),u.push(o.ra(n,e.targetId)),s++)}),iu.Un(u).next(function(){return s})},Yf.prototype.aa=function(t){return iu.resolve(this.targetCount)},Yf.prototype.ua=function(t,e){var n=this.Xf.get(e)||null;return iu.resolve(n)},Yf.prototype.ca=function(e,t,n){this.tT.pn(t,n);var r=this.persistence.Ao,i=[];return r&&t.forEach(function(t){i.push(r.gn(e,t))}),iu.Un(i)},Yf.prototype._a=function(e,t,n){this.tT.vn(t,n);var r=this.persistence.Ao,i=[];return r&&t.forEach(function(t){i.push(r.yn(e,t))}),iu.Un(i)},Yf.prototype.ra=function(t,e){return this.tT.Sn(e),iu.resolve()},Yf.prototype.la=function(t,e){var n=this.tT.Cn(e);return iu.resolve(n)},Yf.prototype.Fn=function(t,e){return iu.resolve(this.tT.Fn(e))},Yf),Vf=(Xf.prototype.start=function(){return Promise.resolve()},Xf.prototype.Iu=function(){return this.qa=!1,Promise.resolve()},Object.defineProperty(Xf.prototype,"Uh",{get:function(){return this.qa},enumerable:!0,configurable:!0}),Xf.prototype.nu=function(){},Xf.prototype.yu=function(){return this.rr},Xf.prototype.Vu=function(t){var e=this.sT[t.s()];return e||(e=new pf(this.rr,this.Ao),this.sT[t.s()]=e),e},Xf.prototype.gu=function(){return this.Ha},Xf.prototype.pu=function(){return this.ir},Xf.prototype.runTransaction=function(t,e,n){var r=this;Fs("MemoryPersistence","Starting transaction:",t);var i=new Cf(this.su.next());return this.Ao.nT(),n(i).next(function(t){return r.Ao.rT(i).next(function(){return t})}).Bn().then(function(t){return i.sr(),t})},Xf.prototype.hT=function(e,n){return iu.Qn(Object.values(this.sT).map(function(t){return function(){return t.Fn(e,n)}}))},Xf),Cf=(n(Wf,Of=uu),Wf),Mf=(Kf.aT=function(t){return new Kf(t)},Object.defineProperty(Kf.prototype,"uT",{get:function(){if(this.oT)return this.oT;throw zs()},enumerable:!0,configurable:!0}),Kf.prototype.Fu=function(t){this.Su=t},Kf.prototype.gn=function(t,e){return this.uT.delete(e),iu.resolve()},Kf.prototype.yn=function(t,e){return this.uT.add(e),iu.resolve()},Kf.prototype.Qo=function(t,e){return this.uT.add(e),iu.resolve()},Kf.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.gu();return r.la(t,e.targetId).next(function(t){t.forEach(function(t){return n.uT.add(t)})}).next(function(){return r.na(t,e)})},Kf.prototype.nT=function(){this.oT=new Set},Kf.prototype.rT=function(t){var n=this,r=this.persistence.pu().ba();return iu.forEach(this.uT,function(e){return n.cT(t,e).next(function(t){t||r.Hn(e)})}).next(function(){return n.oT=null,r.apply(t)})},Kf.prototype.ku=function(t,e){var n=this;return this.cT(t,e).next(function(t){t?n.uT.delete(e):n.uT.add(e)})},Kf.prototype.iT=function(t){return 0},Kf.prototype.cT=function(t,e){var n=this;return iu.Qn([function(){return n.persistence.gu().Fn(t,e)},function(){return n.persistence.hT(t,e)},function(){return iu.resolve(n.Su.Fn(e))}])},Kf),jf=(Hf.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.jd=this._T(n),this.persistence=this.lT(n),[4,this.persistence.start()];case 1:return t.sent(),this.dT=this.fT(n),this.L_=this.TT(n),this.Ld=this.ET(n),this.cl=this.IT(n),this.wT=this.RT(n),this.jd.b_=function(t){return e.cl.Nd(t,1)},this.Ld.cl=this.cl,[4,this.L_.start()];case 2:return t.sent(),[4,this.jd.start()];case 3:return t.sent(),[4,this.Ld.start()];case 4:return t.sent(),[4,this.Ld.yl(this.cl.if)];case 5:return t.sent(),[2]}})})},Hf.prototype.RT=function(t){return new cf(this.cl)},Hf.prototype.fT=function(t){return null},Hf.prototype.TT=function(t){return new ph(this.persistence,new lf,t.mT)},Hf.prototype.lT=function(t){return new Vf(Mf.aT)},Hf.prototype.ET=function(t){var e=this;return new Pc(this.L_,t.w_,t.qr,function(t){return e.cl.Nd(t,0)},t.platform.AT())},Hf.prototype._T=function(t){return new of},Hf.prototype.IT=function(t){return new af(this.L_,this.Ld,this.jd,t.mT,t.Kd)},Hf.prototype.clearPersistence=function(t){throw new _r(Nr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},Hf),Uf=(n(zf,Rf=jf),zf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Rf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.iu(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.cl.yl(e)];case 1:return t.sent(),this.dT&&(e&&!this.dT.Uh?this.dT.start(this.L_):e||this.dT.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},zf.prototype.TT=function(t){return new vh(this.persistence,new lf,t.mT)},zf.prototype.IT=function(t){var e=new hf(this.L_,this.Ld,this.jd,t.mT,t.Kd);return this.jd instanceof rf&&(this.jd.cl=e),e},zf.prototype.fT=function(t){var e=this.persistence.Ao.Lh;return new Cu(e,t.qr)},zf.prototype.lT=function(t){var e=ih.vu(t.PT),n=t.platform.Dc(t.PT.ii);return new ih(t.VT.synchronizeTabs,e,t.clientId,t.platform,Ou.Dh(t.VT.cacheSizeBytes),t.qr,n,this.jd)},zf.prototype._T=function(t){if(t.VT.gT&&t.VT.synchronizeTabs){if(!rf.so(t.platform))throw new _r(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=ih.vu(t.PT);return new rf(t.qr,t.platform,e,t.clientId,t.mT)}return new of},zf.prototype.clearPersistence=function(t){var e=ih.vu(t);return ih.clearPersistence(e)},zf),qf=(Gf.prototype.start=function(e,n){var r=this;this.pT();var i=new Tu,o=new Tu,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,Fs("FirestoreClient","Initializing. user=",t.uid),r.yT(e,n,t,o).then(i.resolve,i.reject);r.qr.Hr(function(){return r.pl(t)})}),this.qr.Hr(function(){return i.promise}),o.promise},Gf.prototype.enableNetwork=function(){var t=this;return this.pT(),this.qr.enqueue(function(){return t.cl.enableNetwork()})},Gf.prototype.yT=function(u,a,h,c){return y(this,void 0,void 0,function(){var n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.bT(this.PT)];case 1:return n=t.sent(),r=this.platform.Dc(this.PT.ii),e=this.credentials,i=new Dc(n,e,r),[4,u.initialize({qr:this.qr,PT:this.PT,platform:this.platform,w_:i,clientId:this.clientId,mT:h,Kd:100,VT:a})];case 2:return t.sent(),this.persistence=u.persistence,this.jd=u.jd,this.L_=u.L_,this.Ld=u.Ld,this.cl=u.cl,this.dT=u.dT,this.vT=u.wT,this.persistence.nu(function(){return y(s,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),c.resolve(),[3,4];case 3:if(o=t.sent(),c.reject(o),!this.ST(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.yT(new jf,{gT:!1},h,c))];case 4:return[2]}var e})})},Gf.prototype.ST=function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Gf.prototype.pT=function(){if(this.qr.hh)throw new _r(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},Gf.prototype.pl=function(t){return this.qr.Th(),Fs("FirestoreClient","Credential Changed. Current user: "+t.uid),this.cl.pl(t)},Gf.prototype.disableNetwork=function(){var t=this;return this.pT(),this.qr.enqueue(function(){return t.cl.disableNetwork()})},Gf.prototype.terminate=function(){var t=this;return this.qr.lh(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.dT&&this.dT.stop(),[4,this.Ld.Iu()];case 1:return t.sent(),[4,this.jd.Iu()];case 2:return t.sent(),[4,this.persistence.Iu()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},Gf.prototype.waitForPendingWrites=function(){var t=this;this.pT();var e=new Tu;return this.qr.Hr(function(){return t.cl.Tf(e)}),e.promise},Gf.prototype.listen=function(t,e,n){var r=this;this.pT();var i=new ff(t,e,n);return this.qr.Hr(function(){return r.vT.listen(i)}),i},Gf.prototype.al=function(t){var e=this;this.DT||this.qr.Hr(function(){return e.vT.al(t)})},Gf.prototype.CT=function(t){var e=this;return this.pT(),this.qr.enqueue(function(){return e.L_.ec(t)}).then(function(t){if(t instanceof wo)return t;if(t instanceof bo)return null;throw new _r(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Gf.prototype.FT=function(i){var t=this;return this.pT(),this.qr.enqueue(function(){return y(t,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.L_.nc(i,!0)];case 1:return e=t.sent(),n=new sf(i,e.rc),r=n.yd(e.documents),[2,n.Zn(r,!1).snapshot]}})})})},Gf.prototype.write=function(t){var e=this;this.pT();var n=new Tu;return this.qr.Hr(function(){return e.cl.write(t,n)}),n.promise},Gf.prototype.ii=function(){return this.PT.ii},Gf.prototype.Ff=function(t){var e=this;this.pT(),this.qr.Hr(function(){return e.vT.Ff(t),Promise.resolve()})},Gf.prototype.Nf=function(t){this.DT||this.vT.Nf(t)},Object.defineProperty(Gf.prototype,"DT",{get:function(){return this.qr.hh},enumerable:!0,configurable:!0}),Gf.prototype.transaction=function(t){var e=this;this.pT();var n=new Tu;return this.qr.Hr(function(){return e.cl.runTransaction(e.qr,t,n),Promise.resolve()}),n.promise},Gf),Ff=(Bf.prototype.next=function(t){this.NT(this.observer.next,t)},Bf.prototype.error=function(t){this.NT(this.observer.error,t)},Bf.prototype.kT=function(){this.muted=!0},Bf.prototype.NT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Bf);function Bf(t){this.observer=t,this.muted=!1}function Gf(t,e,n,r){this.platform=t,this.PT=e,this.credentials=n,this.qr=r,this.clientId=Ks.cn()}function zf(){return null!==Rf&&Rf.apply(this,arguments)||this}function Hf(){}function Kf(t){this.persistence=t,this.Su=null,this.oT=null}function Wf(t){var e=this;return(e=Of.call(this)||this).Oa=t,e}function Xf(t){var e=this;this.sT={},this.su=new cu(0),this.qa=!1,this.qa=!0,this.Ao=t(this),this.Ha=new Pf(this),this.rr=new xa,this.ir=new df(this.rr,function(t){return e.Ao.iT(t)})}function Yf(t){this.persistence=t,this.Xf=new $s(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Dr.min(),this.highestTargetId=0,this.Zf=0,this.tT=new nu,this.targetCount=0,this.eT=fa.Ko()}function Qf(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Jf,Zf,$f=(Tl.prototype.MT=function(t){switch(si(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pi(t.integerValue||t.doubleValue);case 3:return this.LT(t.timestampValue);case 4:return this.xT(t);case 5:return t.stringValue;case 6:return new Uh(di(t.bytesValue));case 7:return this.OT(t.referenceValue);case 8:return this.BT(t.geoPointValue);case 9:return this.qT(t.arrayValue);case 10:return this.UT(t.mapValue);default:throw zs()}},Tl.prototype.UT=function(t){var n=this,r={};return Qr(t.fields||{},function(t,e){r[t]=n.MT(e)}),r},Tl.prototype.BT=function(t){return new ec(pi(t.latitude),pi(t.longitude))},Tl.prototype.qT=function(t){var e=this;return(t.values||[]).map(function(t){return e.MT(t)})},Tl.prototype.xT=function(t){switch(this.$T){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return ri(n)?t(n):n}(t);return null==e?null:this.MT(e);case"estimate":return this.LT(ii(t));default:return null}},Tl.prototype.LT=function(t){var e=li(t),n=new Lr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Tl.prototype.OT=function(t){var e=Or.K(t);Hs(Vs(e));var n=new Zs(e.get(1),e.get(3)),r=new Wr(e.$(5));return n.isEqual(this.firestore.Lc)||Bs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.Lc.projectId+"/"+this.firestore.Lc.database+") instead."),new ol(r,this.firestore,this.converter)},Tl),tl=Ou.Nh,el=(Il.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Il),nl=(El.prototype.settings=function(t){bh("Firestore.settings",arguments,1),Th("Firestore.settings","object",1,t);var e=new el(t);if(this.KT&&!this.JT.isEqual(e))throw new _r(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.JT=e).credentials&&(this.HT=function(t){if(!t)return new Ar;switch(t.type){case"gapi":var e=t.ZT;return Hs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new kr(e,t.V||"0");case"provider":return t.ZT;default:throw new _r(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},El.prototype.enableNetwork=function(){return this.jT(),this.KT.enableNetwork()},El.prototype.disableNetwork=function(){return this.jT(),this.KT.disableNetwork()},El.prototype.enablePersistence=function(t){var e,n;if(this.KT)throw new _r(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Bs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.tE(this.YT,{gT:!0,cacheSizeBytes:this.JT.cacheSizeBytes,synchronizeTabs:r})},El.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.KT&&!this.KT.DT)throw new _r(Nr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new Tu,[2,(this.WT.oh(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.eE(),[4,this.YT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},El.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(El.prototype,"sE",{get:function(){return this.jT(),this.KT.DT},enumerable:!0,configurable:!0}),El.prototype.waitForPendingWrites=function(){return this.jT(),this.KT.waitForPendingWrites()},El.prototype.onSnapshotsInSync=function(t){if(this.jT(),Qf(t))return this.iE(t);Th("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.iE(e)},El.prototype.iE=function(t){var e=this,n=new Ff({next:function(){t.next&&t.next()},error:function(t){throw zs()}});return this.KT.Ff(n),function(){n.kT(),e.KT.Nf(n)}},El.prototype.jT=function(){return this.KT||this.tE(new jf,{gT:!1}),this.KT},El.prototype.eE=function(){return new Js(this.Lc,this.zT,this.JT.host,this.JT.ssl,this.JT.forceLongPolling)},El.prototype.tE=function(t,e){var n=this.eE();return this.KT=new qf(Cs.nt(),n,this.HT,this.WT),this.KT.start(t,e)},El.GT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new _r(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new _r(Nr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Zs(n)},Object.defineProperty(El.prototype,"app",{get:function(){if(!this.QT)throw new _r(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.QT},enumerable:!0,configurable:!0}),El.prototype.collection=function(t){return bh("Firestore.collection",arguments,1),Th("Firestore.collection","non-empty string",1,t),this.jT(),new fl(Or.K(t),this)},El.prototype.doc=function(t){return bh("Firestore.doc",arguments,1),Th("Firestore.doc","non-empty string",1,t),this.jT(),ol.nE(Or.K(t),this)},El.prototype.collectionGroup=function(t){if(bh("Firestore.collectionGroup",arguments,1),Th("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.jT(),new hl(new To(Or.G,t),this)},El.prototype.runTransaction=function(e){var n=this;return bh("Firestore.runTransaction",arguments,1),Th("Firestore.runTransaction","function",1,e),this.jT().transaction(function(t){return e(new rl(n,t))})},El.prototype.batch=function(){return this.jT(),new il(this)},Object.defineProperty(El,"logLevel",{get:function(){switch(Us()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),El.setLogLevel=function(t){switch(bh("Firestore.setLogLevel",arguments,1),Th("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":qs(l.DEBUG);break;case"error":qs(l.ERROR);break;case"silent":qs(l.SILENT);break;default:throw new _r(Nr.INVALID_ARGUMENT,"Invalid log level: "+t)}},El.prototype.rE=function(){return this.JT.timestampsInSnapshots},El),rl=(bl.prototype.get=function(t){var n=this;bh("Transaction.get",arguments,1);var r=Sl("Transaction.get",t,this.hE);return this.oE.V_([r.xc]).then(function(t){if(!t||1!==t.length)return zs();var e=t[0];if(e instanceof bo)return new ul(n.hE,r.xc,null,!1,!1,r.aE);if(e instanceof wo)return new ul(n.hE,r.xc,e,!1,!1,r.aE);throw zs()})},bl.prototype.set=function(t,e,n){Ih("Transaction.set",arguments,2,3);var r=Sl("Transaction.set",t,this.hE);n=Nl("Transaction.set",n);var i=xl(r.aE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.hE.XT.Nc(s,o,n.mergeFields):this.hE.XT.Cc(s,o);return this.oE.set(r.xc,u),this},bl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof qh?(Eh("Transaction.update",arguments,3),r=Sl("Transaction.update",t,this.hE),this.hE.XT.$c("Transaction.update",e,n,o)):(bh("Transaction.update",arguments,2),r=Sl("Transaction.update",t,this.hE),this.hE.XT.kc("Transaction.update",e)),this.oE.update(r.xc,i),this},bl.prototype.delete=function(t){bh("Transaction.delete",arguments,1);var e=Sl("Transaction.delete",t,this.hE);return this.oE.delete(e.xc),this},bl),il=(wl.prototype.set=function(t,e,n){Ih("WriteBatch.set",arguments,2,3),this._E();var r=Sl("WriteBatch.set",t,this.hE);n=Nl("WriteBatch.set",n);var i=xl(r.aE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.hE.XT.Nc(s,o,n.mergeFields):this.hE.XT.Cc(s,o);return this.uE=this.uE.concat(u.gc(r.xc,ji.ft())),this},wl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this._E(),i="string"==typeof e||e instanceof qh?(Eh("WriteBatch.update",arguments,3),r=Sl("WriteBatch.update",t,this.hE),this.hE.XT.$c("WriteBatch.update",e,n,o)):(bh("WriteBatch.update",arguments,2),r=Sl("WriteBatch.update",t,this.hE),this.hE.XT.kc("WriteBatch.update",e)),this.uE=this.uE.concat(i.gc(r.xc,ji.exists(!0))),this},wl.prototype.delete=function(t){bh("WriteBatch.delete",arguments,1),this._E();var e=Sl("WriteBatch.delete",t,this.hE);return this.uE=this.uE.concat(new Gi(e.xc,ji.ft())),this},wl.prototype.commit=function(){return this._E(),this.cE=!0,0<this.uE.length?this.hE.jT().write(this.uE):Promise.resolve()},wl.prototype._E=function(){if(this.cE)throw new _r(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},wl),ol=(ml.nE=function(t,e,n){if(t.length%2!=0)throw new _r(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new ml(new Wr(t),e,n)},Object.defineProperty(ml.prototype,"id",{get:function(){return this.xc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(ml.prototype,"parent",{get:function(){return new fl(this.xc.path.M(),this.firestore,this.aE)},enumerable:!0,configurable:!0}),Object.defineProperty(ml.prototype,"path",{get:function(){return this.xc.path.j()},enumerable:!0,configurable:!0}),ml.prototype.collection=function(t){if(bh("DocumentReference.collection",arguments,1),Th("DocumentReference.collection","non-empty string",1,t),!t)throw new _r(Nr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Or.K(t);return new fl(this.xc.path.child(e),this.firestore)},ml.prototype.isEqual=function(t){if(!(t instanceof ml))throw Oh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.xc.isEqual(t.xc)&&this.aE===t.aE},ml.prototype.set=function(t,e){Ih("DocumentReference.set",arguments,1,2),e=Nl("DocumentReference.set",e);var n=xl(this.aE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.XT.Nc(i,r,e.mergeFields):this.firestore.XT.Cc(i,r);return this.KT.write(o.gc(this.xc,ji.ft()))},ml.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof qh?(Eh("DocumentReference.update",arguments,2),this.firestore.XT.$c("DocumentReference.update",t,e,r)):(bh("DocumentReference.update",arguments,1),this.firestore.XT.kc("DocumentReference.update",t)),this.KT.write(n.gc(this.xc,ji.exists(!0)))},ml.prototype.delete=function(){return bh("DocumentReference.delete",arguments,0),this.KT.write([new Gi(this.xc,ji.ft())])},ml.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ih("DocumentReference.onSnapshot",arguments,1,4);var n={includeMetadataChanges:!1},r=0;"object"!=typeof t[r]||Qf(t[r])||(Rh("DocumentReference.onSnapshot",n=t[r],["includeMetadataChanges"]),Ah("DocumentReference.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges),r++);var i={includeMetadataChanges:n.includeMetadataChanges},o=Qf(t[r])?t[r]:(Th("DocumentReference.onSnapshot","function",r,t[r]),Nh("DocumentReference.onSnapshot","function",r+1,t[r+1]),Nh("DocumentReference.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]});return this.lE(i,o)},ml.prototype.lE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Ff({next:function(t){var e;n.next&&(e=t.docs.get(r.xc),n.next(new ul(r.firestore,r.xc,e,t.fromCache,t.hasPendingWrites,r.aE)))},error:e}),o=this.KT.listen(To.Wt(this.xc.path),i,t);return function(){i.kT(),r.KT.al(o)}},ml.prototype.get=function(n){var r=this;return Ih("DocumentReference.get",arguments,0,1),Al("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.jT().CT(r.xc).then(function(t){e(new ul(r.firestore,r.xc,t,!0,t instanceof wo&&t.At,r.aE))},t):r.dE(e,t,n)})},ml.prototype.dE=function(e,n,r){var i=this.lE({includeMetadataChanges:!0,Bf:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new _r(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new _r(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},ml.prototype.withConverter=function(t){return new ml(this.xc,this.firestore,t)},ml),sl=(gl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},gl),ul=(vl.prototype.data=function(t){if(Ih("DocumentSnapshot.data",arguments,0,1),t=_l("DocumentSnapshot.data",t),this.fE){if(this.aE){var e=new al(this.hE,this.xc,this.fE,this.TE,this.EE);return this.aE.fromFirestore(e,t)}return new $f(this.hE,this.hE.rE(),t.serverTimestamps,void 0).MT(this.fE.Mt())}},vl.prototype.get=function(t,e){if(Ih("DocumentSnapshot.get",arguments,1,2),e=_l("DocumentSnapshot.get",e),this.fE){var n=this.fE.data().field(Ic("DocumentSnapshot.get",t));if(null!==n)return new $f(this.hE,this.hE.rE(),e.serverTimestamps,this.aE).MT(n)}},Object.defineProperty(vl.prototype,"id",{get:function(){return this.xc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(vl.prototype,"ref",{get:function(){return new ol(this.xc,this.hE,this.aE)},enumerable:!0,configurable:!0}),Object.defineProperty(vl.prototype,"exists",{get:function(){return null!==this.fE},enumerable:!0,configurable:!0}),Object.defineProperty(vl.prototype,"metadata",{get:function(){return new sl(this.EE,this.TE)},enumerable:!0,configurable:!0}),vl.prototype.isEqual=function(t){if(!(t instanceof vl))throw Oh("isEqual","DocumentSnapshot",1,t);return this.hE===t.hE&&this.TE===t.TE&&this.xc.isEqual(t.xc)&&(null===this.fE?null===t.fE:this.fE.isEqual(t.fE))&&this.aE===t.aE},vl),al=(n(yl,Zf=ul),yl.prototype.data=function(t){return Zf.prototype.data.call(this,t)},yl),hl=(dl.prototype.where=function(t,e,n){bh("Query.where",arguments,3),Dh("Query.where",3,n);var r,i=function(t,e){if(!t.some(function(t){return t===e}))throw new _r(Nr.INVALID_ARGUMENT,"Invalid value "+Lh(e)+" provided to function Query.where() for its "+Vh(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Ic("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.wE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.RE(h))}r={arrayValue:{values:s}}}else r=this.RE(n)}else"in"!==i&&"array-contains-any"!==i||this.wE(n,i),r=this.firestore.XT.Mc("Query.where",n,"in"===i);var c=No.create(o,i,r);return this.mE(c),new dl(this.IE.Gt(c),this.firestore,this.aE)},dl.prototype.orderBy=function(t,e){var n;if(Ih("Query.orderBy",arguments,1,2),Nh("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new _r(Nr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.IE.startAt)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.IE.endAt)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Ic("Query.orderBy",t),i=new Do(r,n);return this.AE(i),new dl(this.IE.zt(i),this.firestore,this.aE)},dl.prototype.limit=function(t){return bh("Query.limit",arguments,1),Th("Query.limit","number",1,t),Ph("Query.limit",1,t),new dl(this.IE.Ht(t),this.firestore,this.aE)},dl.prototype.limitToLast=function(t){return bh("Query.limitToLast",arguments,1),Th("Query.limitToLast","number",1,t),Ph("Query.limitToLast",1,t),new dl(this.IE.Yt(t),this.firestore,this.aE)},dl.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.startAt",arguments,1);var r=this.PE("Query.startAt",t,e,!0);return new dl(this.IE.Jt(r),this.firestore,this.aE)},dl.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.startAfter",arguments,1);var r=this.PE("Query.startAfter",t,e,!1);return new dl(this.IE.Jt(r),this.firestore,this.aE)},dl.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.endBefore",arguments,1);var r=this.PE("Query.endBefore",t,e,!0);return new dl(this.IE.Xt(r),this.firestore,this.aE)},dl.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.endAt",arguments,1);var r=this.PE("Query.endAt",t,e,!1);return new dl(this.IE.Xt(r),this.firestore,this.aE)},dl.prototype.isEqual=function(t){if(!(t instanceof dl))throw Oh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.IE.isEqual(t.IE)},dl.prototype.withConverter=function(t){return new dl(this.IE,this.firestore,t)},dl.prototype.PE=function(t,e,n,r){if(Dh(t,1,e),e instanceof ul){if(0<n.length)throw new _r(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new _r(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.VE(i.fE,r)}var o=[e].concat(n);return this.gE(t,o,r)},dl.prototype.VE=function(t,e){for(var n=[],r=0,i=this.IE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(yi(this.firestore.Lc,t.key));else{var s=t.field(o.field);if(ri(s))throw new _r(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new Lo(n,e)},dl.prototype.gE=function(t,e,n){var r=this.IE.Ot;if(e.length>r.length)throw new _r(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.IE._e()&&-1!==s.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.IE.path.child(Or.K(s));if(!Wr.et(u))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Wr(u);i.push(yi(this.firestore.Lc,a))}else{var h=this.firestore.XT.Mc(t,s);i.push(h)}}return new Lo(i,n)},dl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ih("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Qf(t[i])||(Rh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ah("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Qf(t[i])?t[i]:(Th("Query.onSnapshot","function",i,t[i]),Nh("Query.onSnapshot","function",i+1,t[i+1]),Nh("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.pE(this.IE),this.lE(r,n)},dl.prototype.lE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Ff({next:function(t){e.next&&e.next(new cl(n.firestore,n.IE,t,n.aE))},error:r}),o=this.firestore.jT(),s=o.listen(this.IE,i,t);return function(){i.kT(),o.al(s)}},dl.prototype.pE=function(t){if(t.ae()&&0===t.Ot.length)throw new _r(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},dl.prototype.get=function(n){var r=this;return Ih("Query.get",arguments,0,1),Al("Query.get",n),this.pE(this.IE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.jT().FT(r.IE).then(function(t){e(new cl(r.firestore,r.IE,t,r.aE))},t):r.dE(e,t,n)})},dl.prototype.dE=function(e,n,r){var i=this.lE({includeMetadataChanges:!0,Bf:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new _r(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},dl.prototype.RE=function(t){if("string"==typeof t){if(""===t)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.IE._e()&&-1!==t.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.IE.path.child(Or.K(t));if(!Wr.et(e))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return yi(this.firestore.Lc,new Wr(e))}if(t instanceof ol)return yi(this.firestore.Lc,t.xc);throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Lh(t)+".")},dl.prototype.wE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},dl.prototype.mE=function(t){if(t instanceof No){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.IE.jt();if(null!==o&&!o.isEqual(t.field))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.IE.Kt();null!==s&&this.yE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.IE.ce(n)),null===u&&r&&(u=this.IE.ce(e)),null!=u)throw u===t.op?new _r(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new _r(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},dl.prototype.AE=function(t){var e;null!==this.IE.Kt()||null!==(e=this.IE.jt())&&this.yE(e,t.field)},dl.prototype.yE=function(t,e){if(!e.isEqual(t))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},dl),cl=(Object.defineProperty(pl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"empty",{get:function(){return this.vE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"size",{get:function(){return this.vE.docs.size},enumerable:!0,configurable:!0}),pl.prototype.forEach=function(e,n){var r=this;Ih("QuerySnapshot.forEach",arguments,1,2),Th("QuerySnapshot.forEach","function",1,e),this.vE.docs.forEach(function(t){e.call(n,r.CE(t))})},Object.defineProperty(pl.prototype,"query",{get:function(){return new hl(this.bE,this.hE,this.aE)},enumerable:!0,configurable:!0}),pl.prototype.docChanges=function(t){t&&(Rh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ah("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.vE.hs)throw new _r(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.SE&&this.DE===e||(this.SE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new al(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new al(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zs()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.hE,e,this.vE,this.aE),this.DE=e),this.SE},pl.prototype.isEqual=function(t){if(!(t instanceof pl))throw Oh("isEqual","QuerySnapshot",1,t);return this.hE===t.hE&&this.bE.isEqual(t.bE)&&this.vE.isEqual(t.vE)&&this.aE===t.aE},pl.prototype.CE=function(t){return new al(this.hE,t.key,t,this.metadata.fromCache,this.vE.ns.has(t.key),this.aE)},pl),fl=(n(ll,Jf=hl),Object.defineProperty(ll.prototype,"id",{get:function(){return this.IE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"parent",{get:function(){var t=this.IE.path.M();return t.B()?null:new ol(new Wr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"path",{get:function(){return this.IE.path.j()},enumerable:!0,configurable:!0}),ll.prototype.doc=function(t){if(Ih("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Ks.cn()),Th("CollectionReference.doc","non-empty string",1,t),""===t)throw new _r(Nr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Or.K(t);return ol.nE(this.IE.path.child(e),this.firestore,this.aE)},ll.prototype.add=function(t){bh("CollectionReference.add",arguments,1),Th("CollectionReference.add","object",1,this.aE?this.aE.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},ll.prototype.withConverter=function(t){return new ll(this.FE,this.firestore,t)},ll);function ll(t,e,n){var r=this;if(((r=Jf.call(this,To.Wt(t),e,n)||this).FE=t).length%2!=1)throw new _r(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function pl(t,e,n,r){this.hE=t,this.bE=e,this.vE=n,this.aE=r,this.SE=null,this.DE=null,this.metadata=new sl(n.hasPendingWrites,n.fromCache)}function dl(t,e,n){this.IE=t,this.firestore=e,this.aE=n}function yl(){return null!==Zf&&Zf.apply(this,arguments)||this}function vl(t,e,n,r,i,o){this.hE=t,this.xc=e,this.fE=n,this.TE=r,this.EE=i,this.aE=o}function gl(t,e){this.hasPendingWrites=t,this.fromCache=e}function ml(t,e,n){this.xc=t,this.firestore=e,this.aE=n,this.KT=this.firestore.jT()}function wl(t){this.hE=t,this.uE=[],this.cE=!1}function bl(t,e){this.hE=t,this.oE=e}function El(t,e,n){var r=this;if(void 0===n&&(n=new jf),this.QT=null,this.WT=new Au,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.jT(),[4,this.KT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.QT=i,this.Lc=El.GT(i),this.zT=i.name,this.HT=new Sr(e)}else{var o=t;if(!o.projectId)throw new _r(Nr.INVALID_ARGUMENT,"Must provide projectId");this.Lc=new Zs(o.projectId,o.database),this.zT="[DEFAULT]",this.HT=new Ar}this.YT=n,this.JT=new el({}),this.XT=new yc(this.Lc)}function Il(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new _r(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else _h("settings","non-empty string","host",t.host),this.host=t.host,Ah("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Rh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ah("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ah("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Bs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Bs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Ah("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ou.$h;else{if(t.cacheSizeBytes!==tl&&t.cacheSizeBytes<Ou.kh)throw new _r(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ou.kh);this.cacheSizeBytes=t.cacheSizeBytes}Ah("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function Tl(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.$T=n,this.converter=r}function Nl(t,e){if(void 0===e)return{merge:!1};if(Rh(t,e,["merge","mergeFields"]),Ah(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Lh(n));for(var r,i=0;i<n.length;++i)if(!("string"==typeof(r=n[i])||r instanceof qh))throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Lh(n[i]))}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new _r(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function _l(t,e){return void 0===e?{}:(Rh(t,e,["serverTimestamps"]),Sh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Al(t,e){Nh(t,"object",1,e),e&&(Rh(t,e,["source"]),Sh(t,0,"source",e.source,["default","server","cache"]))}function Sl(t,e,n){if(e instanceof ol){if(e.firestore!==n)throw new _r(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Oh(t,"DocumentReference",1,e)}function xl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function kl(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new _r(Nr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var Ll,Dl=kl(nl,"Use firebase.firestore() instead."),Rl=kl(rl,"Use firebase.firestore().runTransaction() instead."),Ol=kl(il,"Use firebase.firestore().batch() instead."),Pl=kl(ol,"Use firebase.firestore().doc() instead."),Vl=kl(ul),Cl=kl(al),Ml=kl(hl),jl=kl(cl),Ul=kl(fl,"Use firebase.firestore().collection() instead."),ql=kl(($l.delete=function(){return wh("FieldValue.delete",arguments),new Qh},$l.serverTimestamp=function(){return wh("FieldValue.serverTimestamp",arguments),new Jh},$l.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Eh("FieldValue.arrayUnion",arguments,1),new Zh(t)},$l.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Eh("FieldValue.arrayRemove",arguments,1),new $h(t)},$l.increment=function(t){return Th("FieldValue.increment","number",1,t),bh("FieldValue.increment",arguments,1),new tc(t)},$l.prototype.isEqual=function(t){return this===t},$l),"Use FieldValue.<field>() instead."),Fl=kl(Uh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Bl={Firestore:Dl,GeoPoint:ec,Timestamp:Lr,Blob:Fl,Transaction:Rl,WriteBatch:Ol,DocumentReference:Pl,DocumentSnapshot:Vl,Query:Ml,QueryDocumentSnapshot:Cl,QuerySnapshot:jl,CollectionReference:Ul,FieldPath:qh,FieldValue:ql,setLogLevel:nl.setLogLevel,CACHE_SIZE_UNLIMITED:tl},Gl=(Zl.prototype.Q_=function(t){},Zl.prototype.Iu=function(){},Zl),zl=(Jl.prototype.Q_=function(t){this.LE.push(t)},Jl.prototype.Iu=function(){window.removeEventListener("online",this.NE),window.removeEventListener("offline",this.$E)},Jl.prototype.xE=function(){window.addEventListener("online",this.NE),window.addEventListener("offline",this.$E)},Jl.prototype.kE=function(){Fs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.LE;t<e.length;t++)(0,e[t])(0)},Jl.prototype.ME=function(){Fs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.LE;t<e.length;t++)(0,e[t])(1)},Jl.so=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Jl),Hl=(Ql.prototype.n_=function(t){this.qE=t},Ql.prototype.Zc=function(t){this.UE=t},Ql.prototype.onMessage=function(t){this.QE=t},Ql.prototype.close=function(){this.BE()},Ql.prototype.send=function(t){this.OE(t)},Ql.prototype.WE=function(){this.qE()},Ql.prototype.jE=function(t){this.UE(t)},Ql.prototype.KE=function(t){this.QE(t)},Ql),Kl={BatchGetDocuments:"batchGet",Commit:"commit"},Wl="gl-js/ fire/"+mr,Xl=(Yl.prototype.zE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=Wl},Yl.prototype.E_=function(a,r,i){var h=this,c=this.HE(a);return new Promise(function(o,s){var u=new gr;u.listenOnce(yr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case dr.NO_ERROR:var t=u.getResponseJson();Fs("Connection","XHR received:",JSON.stringify(t)),o(t);break;case dr.TIMEOUT:Fs("Connection",'RPC "'+a+'" timed out'),s(new _r(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var e,n,r=u.getStatus();Fs("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Nr).indexOf(i)?i:Nr.UNKNOWN,s(new _r(n,e.message))):s(new _r(Nr.UNKNOWN,"Server responded with status "+u.getStatus())):(Fs("Connection",'RPC "'+a+'" failed'),s(new _r(Nr.UNAVAILABLE,"Connection failed.")));break;default:zs()}}finally{Fs("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Fs("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.zE(n,i),u.send(c,"POST",e,n,15)})},Yl.prototype.I_=function(t,e,n){return this.E_(t,e,n)},Yl.prototype.r_=function(t,e){var n,r,i=[this.GE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=pr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.zE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Fs("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new Hl({OE:function(t){f?Fs("Connection","Not sending because WebChannel is closed:",t):(c||(Fs("Connection","Opening WebChannel transport."),h.open(),c=!0),Fs("Connection","WebChannel sending:",t),h.send(t))},BE:function(){return h.close()}});return a(vr.EventType.OPEN,function(){f||Fs("Connection","WebChannel transport opened.")}),a(vr.EventType.CLOSE,function(){f||(f=!0,Fs("Connection","WebChannel transport closed"),l.jE())}),a(vr.EventType.ERROR,function(t){f||(f=!0,Fs("Connection","WebChannel transport errored:",t),l.jE(new _r(Nr.UNAVAILABLE,"The operation could not be completed")))}),a(vr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Hs(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Fs("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=uo[i];if(void 0!==t)return Xo(t)}(),s=r.message,void 0===o&&(o=Nr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.jE(new _r(o,s)),h.close()):(Fs("Connection","WebChannel received:",n),l.KE(n)))}),setTimeout(function(){l.WE()},0),l},Yl.prototype.HE=function(t){var e=Kl[t];return this.GE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},Yl);function Yl(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.GE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Ql(t){this.OE=t.OE,this.BE=t.BE}function Jl(){var t=this;this.NE=function(){return t.kE()},this.$E=function(){return t.ME()},this.LE=[],this.xE()}function Zl(){}function $l(){}function tp(){this._c="undefined"!=typeof atob}Cs.an((Object.defineProperty(tp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(tp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),tp.prototype.bT=function(t){return Promise.resolve(new Xl(t))},tp.prototype.AT=function(){return new(zl.so()?zl:Gl)},tp.prototype.Dc=function(t){return new Os(t,{hi:!0})},tp.prototype.un=function(t){return JSON.stringify(t)},tp.prototype.atob=function(t){return atob(t)},tp.prototype.btoa=function(t){return btoa(t)},tp.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new tp)),(Ll=ep).INTERNAL.registerComponent(new E("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new nl(e,n,new Uf);var e,n},"PUBLIC").setServiceProps(Object.assign({},Bl))),Ll.registerVersion("@firebase/firestore","1.14.3-0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});