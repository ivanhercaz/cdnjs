!function(t,i){"function"==typeof define&&define.amd?define(["leaflet","mapbox-gl"],i):"object"==typeof exports?module.exports=i(require("leaflet"),require("mapbox-gl")):t.returnExports=i(window.L,window.mapboxgl)}(this,function(r,_){r.MapboxGL=r.Layer.extend({options:{updateInterval:32},initialize:function(t){if(r.setOptions(this,t),!t.accessToken)throw new Error("You should provide a Mapbox GL access token as a token option.");_.accessToken=t.accessToken;var i,o,a,n,e,s,h;this._throttledUpdate=(i=r.Util.bind(this._update,this),o=this.options.updateInterval,h=function(){n=!1,e&&(s.apply(a,e),e=!1)},s=function(){n?e=arguments:(i.apply(a,arguments),setTimeout(h,o),n=!0)})},onAdd:function(t){this._glContainer||this._initContainer(),this.getPane().appendChild(this._glContainer),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&r.DomEvent.on(t._proxy,r.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(t){this._map._proxy&&this._map.options.zoomAnimation&&r.DomEvent.off(this._map._proxy,r.DomUtil.TRANSITION_END,this._transitionEnd,this),this.getPane().removeChild(this._glContainer),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd}},_initContainer:function(){var t=this._glContainer=r.DomUtil.create("div","leaflet-gl-layer"),i=this._map.getSize();t.style.width=i.x+"px",t.style.height=i.y+"px"},_initGL:function(){var t=this._map.getCenter(),i=r.extend({},this.options,{container:this._glContainer,interactive:!1,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new _.Map(i),this._glMap.transform.latRange=null,this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas,r.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-image-layer"),r.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-zoom-animated")},_update:function(t){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var i=this._map.getSize(),o=this._glContainer,a=this._glMap,n=this._map.containerPointToLayerPoint([0,0]);r.DomUtil.setPosition(o,n);var e=this._map.getCenter(),s=a.transform;s.center=_.LngLat.convert([e.lng,e.lat]),s.zoom=this._map.getZoom()-1,a.transform.width!==i.x||a.transform.height!==i.y?(o.style.width=i.x+"px",o.style.height=i.y+"px",null!==a._resize&&void 0!==a._resize?a._resize():a.resize()):null!==a._update&&void 0!==a._update?a._update():a.update()}},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),o=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center);r.DomUtil.setTransform(this._glMap._actualCanvas,o.subtract(this._offset),i)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var t=this._map.getZoomScale(this._map.getZoom()),i=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),this._map.getZoom(),this._map.getCenter());r.DomUtil.setTransform(this._glMap._actualCanvas,i.subtract(this._offset),t),this._zooming=!1,this._update()},_transitionEnd:function(t){r.Util.requestAnimFrame(function(){var t=this._map.getZoom(),i=this._map.getCenter(),o=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());r.DomUtil.setTransform(this._glMap._actualCanvas,o,1),this._glMap.once("moveend",r.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:i,zoom:t-1})},this)}}),r.mapboxGL=function(t){return new r.MapboxGL(t)}});