var _=require("lodash"),utils=require("./utils"),encode=utils.encode,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,formatAttrs=function(e){if(e){var r,n="";for(var t in e)n&&(n+=" "),(r=e[t])||!rboolean.test(t)&&"/"!==t?n+=t+'="'+encode(r)+'"':n+=t;return n}},singleTag={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1,include:1,yield:1},tagType={tag:1,script:1,link:1,style:1,template:1},render=module.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]);var a="",d=(t=t||{}).xmlMode;return _.each(e,function(e){var r,n=tagType[e.type];r=n?renderTag(e,d):("directive"===e.type?renderDirective:"comment"===e.type?renderComment:"cdata"===e.type?renderCdata:renderText)(e),e.children&&"cdata"!==e.type&&(r+=render(e.children,t)),!n||singleTag[e.name]&&!d||isClosedTag(e,d)||(r+="</"+e.name+">"),a+=r}),a},isClosedTag=function(e,r){return r&&(!e.children||0===e.children.length)},renderTag=function(e,r){var n="<"+e.name,t=formatAttrs(e.attribs);return t&&(n+=" "+t),isClosedTag(e,r)&&(n+="/"),n+">"},renderDirective=function(e){return"<"+e.data+">"},renderText=function(e){return e.data||""},renderCdata=function(e){return"<![CDATA["+e.children[0].data+"]]>"},renderComment=function(e){return"\x3c!--"+e.data+"--\x3e"};