var htmlparser=require("htmlparser2"),_=require("lodash"),utils=require("./utils"),decode=utils.decode,isTag=utils.isTag,camelCase=require("./utils").camelCase;exports=module.exports=function(e,r){var a=evaluate(e,r),t={type:"root",name:"root",parent:null,prev:null,next:null,children:[]};return update(a,t),t};var evaluate=exports.evaluate=function(e,r){var a;return a=_.isString(e)?htmlparser.parseDOM(e,r):e,_.forEach(a,parseData),a},update=exports.update=function(e,r){Array.isArray(e)||(e=[e]),r?r.children=e:r=null;for(var a=0;a<e.length;a++){var t=e[a],l=t.parent&&t.parent.children;l&&l!==e&&(l.splice(l.indexOf(t),1),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev)),r?(t.prev=e[a-1]||null,t.next=e[a+1]||null):t.prev=t.next=null,r&&"root"===r.type?(t.root=r,t.parent=null):(t.root=null,t.parent=r)}return r},parseData=exports.parseData=function(e){var r;for(var a in void 0===e.data&&(e.data={}),e.attribs)r=decode(e.attribs[a]),"data-"===a.substr(0,5)?(a=a.slice(5),a=camelCase(a),e.data[a]=r):e.attribs[a]=r;_.forEach(e.children,parseData)};