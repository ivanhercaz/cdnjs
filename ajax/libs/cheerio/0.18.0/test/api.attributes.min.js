var expect=require("expect.js"),cheerio=require(".."),fruits=require("./fixtures").fruits,vegetables=require("./fixtures").vegetables,food=require("./fixtures").food,chocolates=require("./fixtures").chocolates,inputs=require("./fixtures").inputs,toArray=Function.call.bind(Array.prototype.slice);describe("$(...)",function(){var s;beforeEach(function(){s=cheerio.load(fruits)}),describe(".attr",function(){it("() : should get all the attributes",function(){var e=s("ul").attr();expect(e.id).to.equal("fruits")}),it("(invalid key) : invalid attr should get undefined",function(){var e=s(".apple").attr("lol");expect(e).to.be(void 0)}),it("(valid key) : valid attr should get value",function(){var e=s(".apple").attr("class");expect(e).to.equal("apple")}),it("(valid key) : valid attr should get name when boolean",function(){var e=s("<input name=email autofocus>").attr("autofocus");expect(e).to.equal("autofocus")}),it("(key, value) : should set attr",function(){var e=s(".pear").attr("id","pear");expect(s("#pear")).to.have.length(1),expect(e).to.be.a(s)}),it("(key, value) : should set attr",function(){var e=cheerio("<div></div> <div></div>").attr("class","pear");expect(e[0].attribs.class).to.equal("pear"),expect(e[1].attribs).to.equal(void 0),expect(e[2].attribs.class).to.equal("pear")}),it("(key, value) : should return an empty object for an empty object",function(){var e=s().attr("key","value");expect(e.length).to.equal(0),expect(e[0]).to.be(void 0)}),it("(map) : object map should set multiple attributes",function(){s(".apple").attr({id:"apple",style:"color:red;","data-url":"http://apple.com"});var e=s(".apple").attr();expect(e.id).to.equal("apple"),expect(e.style).to.equal("color:red;"),expect(e["data-url"]).to.equal("http://apple.com")}),it("(key, function) : should call the function and update the attribute with the return value",function(){var e=s("#fruits");e.attr("id",function(e,t){return expect(e).to.equal(0),expect(t).to.equal("fruits"),"ninja"});var t=e.attr();expect(t.id).to.equal("ninja")}),it("(key, value) : should correctly encode then decode unsafe values",function(){var e=s(".apple");e.attr("href",'http://github.com/"><script>alert("XSS!")<\/script><br'),expect(e.attr("href")).to.equal('http://github.com/"><script>alert("XSS!")<\/script><br'),e.attr("href",'http://github.com/"><script>alert("XSS!")<\/script><br'),expect(e.html()).to.not.contain('<script>alert("XSS!")<\/script>')}),it("(key, value) : should coerce values to a string",function(){var e=s(".apple");e.attr("data-test",1),expect(e[0].attribs["data-test"]).to.equal("1"),expect(e.attr("data-test")).to.equal("1")}),it("(key, value) : handle removed boolean attributes",function(){var e=s(".apple");e.attr("autofocus","autofocus"),expect(e.attr("autofocus")).to.equal("autofocus"),e.removeAttr("autofocus"),expect(e.attr("autofocus")).to.be(void 0)}),it("(key, value) : should remove non-boolean attributes with names or values similar to boolean ones",function(){var e=s(".apple");e.attr("data-autofocus","autofocus"),expect(e.attr("data-autofocus")).to.equal("autofocus"),e.removeAttr("data-autofocus"),expect(e.attr("data-autofocus")).to.be(void 0)})}),describe(".data",function(){beforeEach(function(){s=cheerio.load(chocolates)}),it("() : should get all data attributes initially declared in the markup",function(){var e=s(".linth").data();expect(e).to.eql({highlight:"Lindor",origin:"swiss"})}),it("() : should get all data set via `data`",function(){var e=cheerio("<div>");e.data("a",1),e.data("b",2),expect(e.data()).to.eql({a:1,b:2})}),it("() : should get all data attributes initially declared in the markup merged with all data additionally set via `data`",function(){var e=cheerio('<div data-a="a">');e.data("b","b"),expect(e.data()).to.eql({a:"a",b:"b"})}),it("() : no data attribute should return an empty object",function(){var e=s(".cailler").data();expect(e).to.be.empty()}),it("(invalid key) : invalid data attribute should return `undefined` ",function(){var e=s(".frey").data("lol");expect(e).to.be(void 0)}),it("(valid key) : valid data attribute should get value",function(){var e=s(".linth").data("highlight"),t=s(".linth").data("origin");expect(e).to.equal("Lindor"),expect(t).to.equal("swiss")}),it("(key) : should translate camel-cased key values to hyphen-separated versions",function(){var e=cheerio('<div data--three-word-attribute="a" data-foo-Bar_BAZ-="b">');expect(e.data("ThreeWordAttribute")).to.be("a"),expect(e.data("fooBar_baz-")).to.be("b")}),it("(key) : should retrieve object values",function(){var e={},t=cheerio("<div>");t.data("test",e),expect(t.data("test")).to.be(e)}),it("(key) : should parse JSON data derived from the markup",function(){var e=cheerio('<div data-json="[1, 2, 3]">');expect(e.data("json")).to.eql([1,2,3])}),it("(key) : should not parse JSON data set via the `data` API",function(){var e=cheerio("<div>");e.data("json","[1, 2, 3]"),expect(e.data("json")).to.be("[1, 2, 3]")}),it("(key) : should ignore the markup value after the first access",function(){var e=cheerio('<div data-test="a">');expect(e.data("test")).to.be("a"),e.attr("data-test","b"),expect(e.data("test")).to.be("a")}),it("(hyphen key) : data addribute with hyphen should be camelized ;-)",function(){var e=s(".frey").data();expect(e).to.eql({taste:"sweet",bestCollection:"Mahony"})}),it("(key, value) : should set data attribute",function(){var e=s(".frey").data({balls:"giandor"}),t=s(".linth").data("snack","chocoletti");expect(e.data("balls")).to.eql("giandor"),expect(t.data("snack")).to.eql("chocoletti")}),it("(map) : object map should set multiple data attributes",function(){var e=s(".linth").data({id:"Cailler",flop:"Pippilotti Rist",top:"Frigor",url:"http://www.cailler.ch/"})[0].data;expect(e.id).to.equal("Cailler"),expect(e.flop).to.equal("Pippilotti Rist"),expect(e.top).to.equal("Frigor"),expect(e.url).to.equal("http://www.cailler.ch/")}),describe("(attr) : data-* attribute type coercion :",function(){it("boolean",function(){var e=cheerio('<div data-bool="true">');expect(e.data("bool")).to.be(!0)}),it("number",function(){var e=cheerio('<div data-number="23">');expect(e.data("number")).to.be(23)}),it("number (scientific notation is not coerced)",function(){var e=cheerio('<div data-sci="1E10">');expect(e.data("sci")).to.be("1E10")}),it("null",function(){var e=cheerio('<div data-null="null">');expect(e.data("null")).to.be(null)}),it("object",function(){var e=cheerio("<div data-obj='{ \"a\": 45 }'>");expect(e.data("obj")).to.eql({a:45})}),it("array",function(){var e=cheerio('<div data-array="[1, 2, 3]">');expect(e.data("array")).to.eql([1,2,3])})})}),describe(".val",function(){beforeEach(function(){s=cheerio.load(inputs)}),it(".val(): on select should get value",function(){var e=s("select#one").val();expect(e).to.equal("option_selected")}),it(".val(): on option should get value",function(){var e=s("select#one option").eq(0).val();expect(e).to.equal("option_not_selected")}),it(".val(): on text input should get value",function(){var e=s('input[type="text"]').val();expect(e).to.equal("input_text")}),it(".val(): on checked checkbox should get value",function(){var e=s('input[name="checkbox_on"]').val();expect(e).to.equal("on")}),it(".val(): on unchecked checkbox should get value",function(){var e=s('input[name="checkbox_off"]').val();expect(e).to.equal("off")}),it(".val(): on radio should get value",function(){var e=s('input[type="radio"]').val();expect(e).to.equal("on")}),it(".val(): on multiple select should get an array of values",function(){var e=s("select#multi").val();expect(e).to.have.length(2)}),it(".val(value): on input text should set value",function(){var e=s('input[type="text"]').val("test");expect(e.val()).to.equal("test")}),it(".val(value): on select should set value",function(){var e=s("select#one").val("option_not_selected");expect(e.val()).to.equal("option_not_selected")}),it(".val(value): on option should set value",function(){var e=s("select#one option").eq(0).val("option_changed");expect(e.val()).to.equal("option_changed")}),it(".val(value): on radio should set value",function(){var e=s('input[name="radio"]').val("off");expect(e.val()).to.equal("off")}),it(".val(value): on radio with special characters should set value",function(){var e=s('input[name="radio[brackets]"]').val("off");expect(e.val()).to.equal("off")}),it(".val(values): on multiple select should set multiple values",function(){var e=s("select#multi").val(["1","3","4"]);expect(e.val()).to.have.length(3)})}),describe(".removeAttr",function(){it("(key) : should remove a single attr",function(){var e=s("#fruits");expect(e.attr("id")).to.not.be(void 0),e.removeAttr("id"),expect(e.attr("id")).to.be(void 0)}),it("should return cheerio object",function(){var e=s("ul").removeAttr("id");expect(e).to.be.a(s)})}),describe(".hasClass",function(){function t(e){return cheerio('<div class="'+e+'"></div>')}it("(valid class) : should return true",function(){var e=s(".apple").hasClass("apple");expect(e).to.be.ok(),expect(t("foo").hasClass("foo")).to.be.ok(),expect(t("foo bar").hasClass("foo")).to.be.ok(),expect(t("bar foo").hasClass("foo")).to.be.ok(),expect(t("bar foo bar").hasClass("foo")).to.be.ok()}),it("(invalid class) : should return false",function(){var e=s("#fruits").hasClass("fruits");expect(e).to.not.be.ok(),expect(t("foo-bar").hasClass("foo")).to.not.be.ok(),expect(t("foo-bar").hasClass("foo")).to.not.be.ok(),expect(t("foo-bar").hasClass("foo-ba")).to.not.be.ok()}),it("should check multiple classes",function(){s(".apple").addClass("red"),expect(s(".apple").hasClass("apple")).to.be.ok(),expect(s(".apple").hasClass("red")).to.be.ok(),s(".apple").removeClass("apple"),expect(s("li").eq(0).hasClass("apple")).to.not.be.ok()})}),describe(".addClass",function(){it("(first class) : should add the class to the element",function(){var e=s("#fruits");e.addClass("fruits");var t=e.hasClass("fruits");expect(t).to.be.ok()}),it("(single class) : should add the class to the element",function(){s(".apple").addClass("fruit");var e=s(".apple").hasClass("fruit");expect(e).to.be.ok()}),it("(class): adds classes to many selected items",function(){s("li").addClass("fruit"),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".orange").hasClass("fruit")).to.be.ok(),expect(s(".pear").hasClass("fruit")).to.be.ok()}),it("(class class class) : should add multiple classes to the element",function(){s(".apple").addClass("fruit red tasty"),expect(s(".apple").hasClass("apple")).to.be.ok(),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".apple").hasClass("red")).to.be.ok(),expect(s(".apple").hasClass("tasty")).to.be.ok()}),it("(fn) : should add classes returned from the function",function(){var e=s("#fruits").children(),t=[],a=[],o=["apple red","",void 0];e.addClass(function(e){return t.push(toArray(arguments)),a.push(this),o[e]}),expect(t).to.eql([[0,"apple"],[1,"orange"],[2,"pear"]]),expect(a).to.eql([e[0],e[1],e[2]]),expect(e.eq(0).hasClass("apple")).to.be.ok(),expect(e.eq(0).hasClass("red")).to.be.ok(),expect(e.eq(1).hasClass("orange")).to.be.ok(),expect(e.eq(2).hasClass("pear")).to.be.ok()})}),describe(".removeClass",function(){it("() : should remove all the classes",function(){s(".pear").addClass("fruit"),s(".pear").removeClass(),expect(s(".pear").attr("class")).to.be(void 0)}),it('("") : should not modify class list',function(){s("#fruits").children().removeClass(""),expect(s(".apple")).to.have.length(1)}),it("(invalid class) : should not remove anything",function(){s(".pear").removeClass("fruit"),expect(s(".pear").hasClass("pear")).to.be.ok()}),it("(no class attribute) : should not throw an exception",function(){var e=cheerio(vegetables);expect(function(){s("li",e).removeClass("vegetable")}).to.not.throwException()}),it("(single class) : should remove a single class from the element",function(){s(".pear").addClass("fruit"),expect(s(".pear").hasClass("fruit")).to.be.ok(),s(".pear").removeClass("fruit"),expect(s(".pear").hasClass("fruit")).to.not.be.ok(),expect(s(".pear").hasClass("pear")).to.be.ok()}),it("(single class) : should remove a single class from multiple classes on the element",function(){s(".pear").addClass("fruit green tasty"),expect(s(".pear").hasClass("fruit")).to.be.ok(),expect(s(".pear").hasClass("green")).to.be.ok(),expect(s(".pear").hasClass("tasty")).to.be.ok(),s(".pear").removeClass("green"),expect(s(".pear").hasClass("fruit")).to.be.ok(),expect(s(".pear").hasClass("green")).to.not.be.ok(),expect(s(".pear").hasClass("tasty")).to.be.ok()}),it("(class class class) : should remove multiple classes from the element",function(){s(".apple").addClass("fruit red tasty"),expect(s(".apple").hasClass("apple")).to.be.ok(),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".apple").hasClass("red")).to.be.ok(),expect(s(".apple").hasClass("tasty")).to.be.ok(),s(".apple").removeClass("apple red tasty"),expect(s(".fruit").hasClass("apple")).to.not.be.ok(),expect(s(".fruit").hasClass("red")).to.not.be.ok(),expect(s(".fruit").hasClass("tasty")).to.not.be.ok(),expect(s(".fruit").hasClass("fruit")).to.be.ok()}),it("(class) : should remove all occurrences of a class name",function(){var e=cheerio('<div class="x x y x z"></div>');expect(e.removeClass("x").hasClass("x")).to.be(!1)}),it("(fn) : should remove classes returned from the function",function(){var e=s("#fruits").children(),t=[],a=[],o=["apple red","",void 0];e.removeClass(function(e){return t.push(toArray(arguments)),a.push(this),o[e]}),expect(t).to.eql([[0,"apple"],[1,"orange"],[2,"pear"]]),expect(a).to.eql([e[0],e[1],e[2]]),expect(e.eq(0).hasClass("apple")).to.not.be.ok(),expect(e.eq(0).hasClass("red")).to.not.be.ok(),expect(e.eq(1).hasClass("orange")).to.be.ok(),expect(e.eq(2).hasClass("pear")).to.be.ok()})}),describe(".toggleClass",function(){it("(class class) : should toggle multiple classes from the element",function(){s(".apple").addClass("fruit"),expect(s(".apple").hasClass("apple")).to.be.ok(),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".apple").hasClass("red")).to.not.be.ok(),s(".apple").toggleClass("apple red"),expect(s(".fruit").hasClass("apple")).to.not.be.ok(),expect(s(".fruit").hasClass("red")).to.be.ok(),expect(s(".fruit").hasClass("fruit")).to.be.ok()}),it("(class class, true) : should add multiple classes to the element",function(){s(".apple").addClass("fruit"),expect(s(".apple").hasClass("apple")).to.be.ok(),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".apple").hasClass("red")).to.not.be.ok(),s(".apple").toggleClass("apple red",!0),expect(s(".fruit").hasClass("apple")).to.be.ok(),expect(s(".fruit").hasClass("red")).to.be.ok(),expect(s(".fruit").hasClass("fruit")).to.be.ok()}),it("(class true) : should add only one instance of class",function(){s(".apple").toggleClass("tasty",!0),s(".apple").toggleClass("tasty",!0),expect(s(".apple").attr("class").match(/tasty/g).length).to.equal(1)}),it("(class class, false) : should remove multiple classes from the element",function(){s(".apple").addClass("fruit"),expect(s(".apple").hasClass("apple")).to.be.ok(),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".apple").hasClass("red")).to.not.be.ok(),s(".apple").toggleClass("apple red",!1),expect(s(".fruit").hasClass("apple")).to.not.be.ok(),expect(s(".fruit").hasClass("red")).to.not.be.ok(),expect(s(".fruit").hasClass("fruit")).to.be.ok()}),it("(fn) : should toggle classes returned from the function",function(){(s=cheerio.load(food))(".apple").addClass("fruit"),s(".carrot").addClass("vegetable"),expect(s(".apple").hasClass("fruit")).to.be.ok(),expect(s(".apple").hasClass("vegetable")).to.not.be.ok(),expect(s(".orange").hasClass("fruit")).to.not.be.ok(),expect(s(".orange").hasClass("vegetable")).to.not.be.ok(),expect(s(".carrot").hasClass("fruit")).to.not.be.ok(),expect(s(".carrot").hasClass("vegetable")).to.be.ok(),expect(s(".sweetcorn").hasClass("fruit")).to.not.be.ok(),expect(s(".sweetcorn").hasClass("vegetable")).to.not.be.ok(),s("li").toggleClass(function(){return s(this).parent().is("#fruits")?"fruit":"vegetable"}),expect(s(".apple").hasClass("fruit")).to.not.be.ok(),expect(s(".apple").hasClass("vegetable")).to.not.be.ok(),expect(s(".orange").hasClass("fruit")).to.be.ok(),expect(s(".orange").hasClass("vegetable")).to.not.be.ok(),expect(s(".carrot").hasClass("fruit")).to.not.be.ok(),expect(s(".carrot").hasClass("vegetable")).to.not.be.ok(),expect(s(".sweetcorn").hasClass("fruit")).to.not.be.ok(),expect(s(".sweetcorn").hasClass("vegetable")).to.be.ok()})}),describe(".is",function(){it("() : should return false",function(){expect(s("li.apple").is()).to.be(!1)}),it("(true selector) : should return true",function(){expect(cheerio("#vegetables",vegetables).is("ul")).to.be(!0)}),it("(false selector) : should return false",function(){expect(cheerio("#vegetables",vegetables).is("div")).to.be(!1)}),it("(true selection) : should return true",function(){var e=cheerio("li",vegetables);expect(e.is(e.eq(1))).to.be(!0)}),it("(false selection) : should return false",function(){var e=cheerio(vegetables),t=e.find("li");expect(t.is(e)).to.be(!1)}),it("(true element) : should return true",function(){var e=cheerio("li",vegetables);expect(e.is(e[0])).to.be(!0)}),it("(false element) : should return false",function(){var e=cheerio(vegetables),t=e.find("li");expect(t.is(e[0])).to.be(!1)}),it("(true predicate) : should return true",function(){var e=s("li").is(function(){return"li"===this.tagName&&s(this).hasClass("pear")});expect(e).to.be(!0)}),it("(false predicate) : should return false",function(){var e=s("li").last().is(function(){return"ul"===this.tagName});expect(e).to.be(!1)})})});