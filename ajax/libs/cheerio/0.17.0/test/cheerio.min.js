var expect=require("expect.js"),_=require("lodash"),htmlparser2=require("htmlparser2"),$=require("../"),fixtures=require("./fixtures"),fruits=fixtures.fruits,food=fixtures.food,script='<script src="script.js" type="text/javascript"><\/script>',multiclass='<p><a class="btn primary" href="#">Save</a></p>';describe("cheerio",function(){it("should get the version",function(){expect(/\d+\.\d+\.\d+/.test($.version)).to.be.ok()}),it("$(null) should return be empty",function(){expect($(null)).to.be.empty()}),it("$(undefined) should be empty",function(){expect($(void 0)).to.be.empty()}),it("$(null) should be empty",function(){expect($("")).to.be.empty()}),it("$(selector) with no context or root should be empty",function(){expect($(".h2")).to.be.empty(),expect($("#fruits")).to.be.empty()}),it("$(node) : should override previously-loaded nodes",function(){var e=$.load("<div><span></span></div>"),t=e("span")[0],a=e(t);expect(a[0]).to.equal(t)}),it("should be able to create html without a root or context",function(){var e=$("<h2>");expect(e).to.not.be.empty(),expect(e).to.have.length(1),expect(e[0].name).to.equal("h2")}),it("should be able to create complicated html",function(){var e=$(script);expect(e).to.not.be.empty(),expect(e).to.have.length(1),expect(e[0].attribs.src).to.equal("script.js"),expect(e[0].attribs.type).to.equal("text/javascript"),expect(e[0].children).to.be.empty()});function o(e){expect(e).to.have.length(1),e=e[0],expect(e.parent.name).to.equal("ul"),expect(e.prev).to.be(null),expect(e.next.attribs.class).to.equal("orange"),expect(e.children).to.have.length(1),expect(e.children[0].data).to.equal("Apple")}it("should be able to select .apple with only a context",function(){var e=$(".apple",fruits);o(e)}),it("should be able to select .apple with a node as context",function(){var e=$(".apple",$(fruits)[0]);o(e)}),it("should be able to select .apple with only a root",function(){var e=$(".apple",null,fruits);o(e)}),it("should be able to select an id",function(){var e=$("#fruits",null,fruits);expect(e).to.have.length(1),expect(e[0].attribs.id).to.equal("fruits")}),it("should be able to select a tag",function(){var e=$("ul",fruits);expect(e).to.have.length(1),expect(e[0].name).to.equal("ul")}),it("should be able to filter down using the context",function(){var e=$.load(fruits),t=e(".apple","ul"),a=e("li","ul");expect(t).to.have.length(1),expect(a).to.have.length(3)}),it("should accept a node reference as a context",function(){var e=$("<div><span></span></div>");expect($("span",e[0])).to.have.length(1)}),it("should accept an array of node references as a context",function(){var e=$("<div><span></span></div>");expect($("span",e.toArray())).to.have.length(1)}),it("should select only elements inside given context (Issue #193)",function(){var e=$.load(food),t=e("#fruits"),a=e("li",t);expect(a).to.have.length(3)}),it("should allow loading a pre-parsed DOM",function(){var e=htmlparser2.parseDOM(food),t=$.load(e);expect(t("ul")).to.have.length(3)}),it("should be able to select multiple tags",function(){var e=$("li",null,fruits);expect(e).to.have.length(3);var a=["apple","orange","pear"];e.each(function(e,t){expect(t.attribs.class).to.equal(a[e])})}),it('should be able to do: $("#fruits .apple")',function(){var e=$("#fruits .apple",fruits);o(e)}),it('should be able to do: $("li.apple")',function(){var e=$("li.apple",fruits);o(e)}),it("should be able to select by attributes",function(){var e=$("li[class=apple]",fruits);o(e)}),it('should be able to select multiple classes: $(".btn.primary")',function(){var e=$(".btn.primary",multiclass);expect(e).to.have.length(1),expect(e[0].children[0].data).to.equal("Save")}),it("should not create a top-level node",function(){var e=$("* div","<div>");expect(e).to.have.length(0)}),it('should be able to select multiple elements: $(".apple, #fruits")',function(){var e=$(".apple, #fruits",fruits);expect(e).to.have.length(2);var t=_.filter(e,function(e){return"apple"===e.attribs.class}),a=_.filter(e,function(e){return"fruits"===e.attribs.id});o(t),expect(a[0].attribs.id).to.equal("fruits")}),it("should select first element $(:first)"),it('should be able to select immediate children: $("#fruits > .pear")',function(){var e=$(food);$(".pear",e).append('<li class="pear">Another Pear!</li>'),expect($("#fruits .pear",e)).to.have.length(2);var t=$("#fruits > .pear",e);expect(t).to.have.length(1),expect(t.attr("class")).to.equal("pear")}),it('should be able to select immediate children: $(".apple + .pear")',function(){var e=$(".apple + li",fruits);expect(e).to.have.length(1),e=$(".apple + .pear",fruits),expect(e).to.have.length(0),e=$(".apple + .orange",fruits),expect(e).to.have.length(1),expect(e.attr("class")).to.equal("orange")}),it('should be able to select immediate children: $(".apple ~ .pear")',function(){var e=$(".apple ~ li",fruits);expect(e).to.have.length(2),e=$(".apple ~ .pear",fruits),expect(e.attr("class")).to.equal("pear")}),it('should handle wildcards on attributes: $("li[class*=r]")',function(){var e=$("li[class*=r]",fruits);expect(e).to.have.length(2),expect(e.eq(0).attr("class")).to.equal("orange"),expect(e.eq(1).attr("class")).to.equal("pear")}),it('should handle beginning of attr selectors: $("li[class^=o]")',function(){var e=$("li[class^=o]",fruits);expect(e).to.have.length(1),expect(e.eq(0).attr("class")).to.equal("orange")}),it('should handle beginning of attr selectors: $("li[class$=e]")',function(){var e=$("li[class$=e]",fruits);expect(e).to.have.length(2),expect(e.eq(0).attr("class")).to.equal("apple"),expect(e.eq(1).attr("class")).to.equal("orange")}),it("should gracefully degrade on complex, unmatched queries",function(){var e=$("Eastern States Cup #8-fin&nbsp;<br>Downhill&nbsp;");expect(e).to.have.length(0)}),it("(extended Array) should not interfere with prototype methods (issue #119)",function(){var e=[],t=(e.find=e.children=e.each=function(){},$(e));expect(t.find).to.be($.prototype.find),expect(t.children).to.be($.prototype.children),expect(t.each).to.be($.prototype.each)}),it("should render xml in html() when options.xmlMode = true",function(){var e=$.load('<MixedCaseTag UPPERCASEATTRIBUTE=""></MixedCaseTag>',{xmlMode:!0});expect(e("MixedCaseTag").get(0).name).to.equal("MixedCaseTag"),expect(e.html()).to.be('<MixedCaseTag UPPERCASEATTRIBUTE=""/>')}),it("should render xml in html() when options.xmlMode = true passed to html()",function(){var e=$.load('<MixedCaseTag UPPERCASEATTRIBUTE=""></MixedCaseTag>');expect(e("MixedCaseTag").get(0).name).to.equal("mixedcasetag"),expect(e.html()).to.be('<mixedcasetag uppercaseattribute=""></mixedcasetag>'),expect(e.html({xmlMode:!0})).to.be('<mixedcasetag uppercaseattribute=""/>')}),it("should respect options on the element level",function(){var e="<!doctype html><html><head><title>Some test</title></head><body><footer><p>Copyright &copy; 2003-2014</p></footer></body></html>",t=$.load(e,{decodeEntities:!1}),a=$.load(e);expect(t("footer").html()).to.be("<p>Copyright &copy; 2003-2014</p>"),expect(a("footer").html()).to.be("<p>Copyright &#xA9; 2003-2014</p>")})});