var expect=require("expect.js"),parse=require("../lib/parse"),defaultOpts=require("..").prototype.options,basic="<html></html>",siblings="<h2></h2><p></p>",single="<br/>",singleWrong="<br>",children="<html><br/></html>",li='<li class="durian">Durian</li>',attributes='<img src="hello.png" alt="man waving">',noValueAttribute="<textarea disabled></textarea>",comment="\x3c!-- sexy --\x3e",conditional='\x3c!--[if IE 8]><html class="no-js ie8" lang="en"><![endif]--\x3e',text="lorem ipsum",script='<script type="text/javascript">alert("hi world!");<\/script>',scriptEmpty="<script><\/script>",style='<style type="text/css"> h2 { color:blue; } </style>',styleEmpty="<style></style>",directive="<!doctype html>";describe("parse",function(){describe(".eval",function(){it("should parse basic empty tags: "+basic,function(){var e=parse.evaluate(basic,defaultOpts)[0];expect(e.type).to.equal("tag"),expect(e.tagName).to.equal("html"),expect(e.childNodes).to.be.empty()}),it("should handle sibling tags: "+siblings,function(){var e=parse.evaluate(siblings,defaultOpts),t=e[0],a=e[1];expect(e).to.have.length(2),expect(t.tagName).to.equal("h2"),expect(a.tagName).to.equal("p")}),it("should handle single tags: "+single,function(){var e=parse.evaluate(single,defaultOpts)[0];expect(e.type).to.equal("tag"),expect(e.tagName).to.equal("br"),expect(e.childNodes).to.be.empty()}),it("should handle malformatted single tags: "+singleWrong,function(){var e=parse.evaluate(singleWrong,defaultOpts)[0];expect(e.type).to.equal("tag"),expect(e.tagName).to.equal("br"),expect(e.childNodes).to.be.empty()}),it("should handle tags with children: "+children,function(){var e=parse.evaluate(children,defaultOpts)[0];expect(e.type).to.equal("tag"),expect(e.tagName).to.equal("html"),expect(e.childNodes).to.be.ok(),expect(e.childNodes).to.have.length(1)}),it("should handle tags with children: "+li,function(){var e=parse.evaluate(li,defaultOpts)[0];expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].data).to.equal("Durian")}),it("should handle tags with attributes: "+attributes,function(){var e=parse.evaluate(attributes,defaultOpts)[0].attribs;expect(e).to.be.ok(),expect(e.src).to.equal("hello.png"),expect(e.alt).to.equal("man waving")}),it("should handle value-less attributes: "+noValueAttribute,function(){var e=parse.evaluate(noValueAttribute,defaultOpts)[0].attribs;expect(e).to.be.ok(),expect(e.disabled).to.equal("")}),it("should handle comments: "+comment,function(){var e=parse.evaluate(comment,defaultOpts)[0];expect(e.type).to.equal("comment"),expect(e.data).to.equal(" sexy ")}),it("should handle conditional comments: "+conditional,function(){var e=parse.evaluate(conditional,defaultOpts)[0];expect(e.type).to.equal("comment"),expect(e.data).to.equal(conditional.replace("\x3c!--","").replace("--\x3e",""))}),it("should handle text: "+text,function(){var e=parse.evaluate(text,defaultOpts)[0];expect(e.type).to.equal("text"),expect(e.data).to.equal("lorem ipsum")}),it("should handle script tags: "+script,function(){var e=parse.evaluate(script,defaultOpts)[0];expect(e.type).to.equal("script"),expect(e.tagName).to.equal("script"),expect(e.attribs.type).to.equal("text/javascript"),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("text"),expect(e.childNodes[0].data).to.equal('alert("hi world!");')}),it("should handle style tags: "+style,function(){var e=parse.evaluate(style,defaultOpts)[0];expect(e.type).to.equal("style"),expect(e.tagName).to.equal("style"),expect(e.attribs.type).to.equal("text/css"),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("text"),expect(e.childNodes[0].data).to.equal(" h2 { color:blue; } ")}),it("should handle directives: "+directive,function(){var e=parse.evaluate(directive,defaultOpts)[0];expect(e.type).to.equal("directive"),expect(e.data).to.equal("!doctype html"),expect(e.tagName).to.equal("!doctype")})}),describe(".parse",function(){function t(e){expect(e.tagName).to.equal("root"),expect(e.nextSibling).to.be(null),expect(e.previousSibling).to.be(null),expect(e.parentNode).to.be(null);var t=e.childNodes[0];expect(t.parentNode).to.be(null)}it("should add root to: "+basic,function(){var e=parse(basic,defaultOpts);t(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].tagName).to.equal("html")}),it("should add root to: "+siblings,function(){var e=parse(siblings,defaultOpts);t(e),expect(e.childNodes).to.have.length(2),expect(e.childNodes[0].tagName).to.equal("h2"),expect(e.childNodes[1].tagName).to.equal("p"),expect(e.childNodes[1].parent).to.equal(null)}),it("should add root to: "+comment,function(){var e=parse(comment,defaultOpts);t(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("comment")}),it("should add root to: "+text,function(){var e=parse(text,defaultOpts);t(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("text")}),it("should add root to: "+scriptEmpty,function(){var e=parse(scriptEmpty,defaultOpts);t(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("script")}),it("should add root to: "+styleEmpty,function(){var e=parse(styleEmpty,defaultOpts);t(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("style")}),it("should add root to: "+directive,function(){var e=parse(directive,defaultOpts);t(e),expect(e.childNodes).to.have.length(1),expect(e.childNodes[0].type).to.equal("directive")}),it("should expose the DOM level 1 API",function(){var e=parse("<div><a></a><span></span><p></p></div>",defaultOpts).childNodes[0],t=e.childNodes;expect(t).to.have.length(3),expect(e.tagName).to.be("div"),expect(e.firstChild).to.be(t[0]),expect(e.lastChild).to.be(t[2]),expect(t[0].tagName).to.be("a"),expect(t[0].previousSibling).to.be(null),expect(t[0].nextSibling).to.be(t[1]),expect(t[0].parentNode).to.be(e),expect(t[0].childNodes).to.have.length(0),expect(t[0].firstChild).to.be(null),expect(t[0].lastChild).to.be(null),expect(t[1].tagName).to.be("span"),expect(t[1].previousSibling).to.be(t[0]),expect(t[1].nextSibling).to.be(t[2]),expect(t[1].parentNode).to.be(e),expect(t[1].childNodes).to.have.length(0),expect(t[1].firstChild).to.be(null),expect(t[1].lastChild).to.be(null),expect(t[2].tagName).to.be("p"),expect(t[2].previousSibling).to.be(t[1]),expect(t[2].nextSibling).to.be(null),expect(t[2].parentNode).to.be(e),expect(t[2].childNodes).to.have.length(0),expect(t[2].firstChild).to.be(null),expect(t[2].lastChild).to.be(null)})})});