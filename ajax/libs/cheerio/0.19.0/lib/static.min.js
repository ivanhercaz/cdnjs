var select=require("css-select"),parse=require("./parse"),serialize=require("dom-serializer"),_=require("lodash");function render(t,e,r){if(e)"string"==typeof e&&(e=select(e,t._root,r));else{if(!t._root||!t._root.children)return"";e=t._root.children}return serialize(e,r)}exports.load=function(t,n){var i=require("./cheerio");n=_.defaults(n||{},i.prototype.options);var s=parse(t,n),p=function(t,e,r,o){return this instanceof p?(o=_.defaults(o||{},n),i.call(this,t,e,r||s,o)):new p(t,e,r,o)};return p.prototype=Object.create(i.prototype),(p.prototype.constructor=p).fn=p.prototype,p.prototype._originalRoot=s,_.merge(p,exports),p._root=s,p._options=n,p},exports.html=function(t,e){var r=require("./cheerio");return"[object Object]"!==Object.prototype.toString.call(t)||e||"length"in t||"type"in t||(e=t,t=void 0),render(this,t,e=_.defaults(e||{},this._options,r.prototype.options))},exports.xml=function(t){return render(this,t,_.defaults({xmlMode:!0},this._options))},exports.text=function(t){if(!t)return"";for(var e,r="",o=t.length,n=0;n<o;n++)"text"===(e=t[n]).type?r+=e.data:e.children&&"comment"!==e.type&&(r+=exports.text(e.children));return r},exports.parseHTML=function(t,e,r){var o;return t&&"string"==typeof t?("boolean"==typeof e&&(r=e),o=this.load(t),r||o("script").remove(),o.root()[0].children.slice()):null},exports.root=function(){return this(this._root)},exports.contains=function(t,e){if(e===t)return!1;for(;e&&e!==e.parent;)if((e=e.parent)===t)return!0;return!1};