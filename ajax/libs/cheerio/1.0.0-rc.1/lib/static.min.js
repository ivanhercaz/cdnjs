var serialize=require("dom-serializer"),defaultOptions=require("./options").default,flattenOptions=require("./options").flatten,select=require("css-select"),parse=require("./parse"),_={merge:require("lodash/merge"),defaults:require("lodash/defaults")};function render(t,e,r){if(e)"string"==typeof e&&(e=select(e,t._root,r));else{if(!t._root||!t._root.children)return"";e=t._root.children}return serialize(e,r)}function isArrayLike(t){if(Array.isArray(t))return!0;if("object"!=typeof t)return!1;if(!t.hasOwnProperty("length"))return!1;if("number"!=typeof t.length)return!1;if(t.length<0)return!1;for(var e=0;e<t.length;){if(!(e in t))return!1;e++}return!0}exports.load=function(t,n,e){var i=require("./cheerio");n=_.defaults(flattenOptions(n||{}),defaultOptions),void 0===e&&(e=!0);var s=parse(t,n,e),l=function(t,e,r,o){return this instanceof l?(o=_.defaults(o||{},n),i.call(this,t,e,r||s,o)):new l(t,e,r,o)};return l.prototype=Object.create(i.prototype),(l.prototype.constructor=l).fn=l.prototype,l.prototype._originalRoot=s,_.merge(l,exports),l._root=s,l._options=n,l},exports.html=function(t,e){return"[object Object]"!==Object.prototype.toString.call(t)||e||"length"in t||"type"in t||(e=t,t=void 0),render(this,t,e=_.defaults(flattenOptions(e||{}),this._options,defaultOptions))},exports.xml=function(t){return render(this,t,_.defaults({xmlMode:!0},this._options))},exports.text=function(t){for(var e,r="",o=(t=t||this.root()).length,n=0;n<o;n++)"text"===(e=t[n]).type?r+=e.data:e.children&&"comment"!==e.type&&"script"!==e.tagName&&"style"!==e.tagName&&(r+=exports.text(e.children));return r},exports.parseHTML=function(t,e,r){var o;return t&&"string"==typeof t?("boolean"==typeof e&&(r=e),o=this.load(t,defaultOptions,!1),r||o("script").remove(),o.root()[0].children.slice()):null},exports.root=function(){return this(this._root)},exports.contains=function(t,e){if(e===t)return!1;for(;e&&e!==e.parent;)if((e=e.parent)===t)return!0;return!1},exports.merge=function(t,e){if(isArrayLike(t)&&isArrayLike(e)){for(var r=t.length+e.length,o=0;o<e.length;)t[o+t.length]=e[o],o++;return t.length=r,t}};