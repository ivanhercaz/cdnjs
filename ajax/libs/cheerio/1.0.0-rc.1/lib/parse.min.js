var htmlparser=require("htmlparser2"),parse5=require("parse5");function parseWithParse5(r,e){return(e?parse5.parse:parse5.parseFragment)(r,{treeAdapter:parse5.treeAdapters.htmlparser2}).children}exports=module.exports=function(r,e,t){var a=exports.evaluate(r,e,t),p=exports.evaluate("<root></root>",e,!1)[0];return p.type="root",p.parent=null,exports.update(a,p),p},exports.evaluate=function(r,e,t){var a;(Buffer.isBuffer(r)&&(r=r.toString()),"string"==typeof r)?a=e.xmlMode||e.useHtmlParser2?htmlparser.parseDOM(r,e):parseWithParse5(r,t):a=r;return a},exports.update=function(r,e){Array.isArray(r)||(r=[r]),e?e.children=r:e=null;for(var t=0;t<r.length;t++){var a=r[t],p=a.parent||a.root,n=p&&p.children;n&&n!==r&&(n.splice(n.indexOf(a),1),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev)),e?(a.prev=r[t-1]||null,a.next=r[t+1]||null):a.prev=a.next=null,e&&"root"===e.type?(a.root=e,a.parent=null):(a.root=null,a.parent=e)}return e};