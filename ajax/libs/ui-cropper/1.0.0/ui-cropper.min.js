!function(){var e=angular.module("uiCropper",[]);e.factory("cropAreaCircle",["cropArea",function(t){function e(){t.apply(this,arguments),this._boxResizeBaseSize=25,this._boxResizeNormalRatio=1,this._boxResizeHoverRatio=1.2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio,this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._boxResizeIsHover=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!1,this._areaIsDragging=!1}return(e.prototype=new t).getType=function(){return"circle"},e.prototype._calcCirclePerimeterCoords=function(e){var t=this._size.w/2,i=e*(Math.PI/180);return[this.getCenterPoint().x+t*Math.cos(i),this.getCenterPoint().y+t*Math.sin(i)]},e.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},e.prototype._isCoordWithinArea=function(e){return Math.sqrt((e[0]-this.getCenterPoint().x)*(e[0]-this.getCenterPoint().x)+(e[1]-this.getCenterPoint().y)*(e[1]-this.getCenterPoint().y))<this._size.w/2},e.prototype._isCoordWithinBoxResize=function(e){var t=this._calcResizeIconCenterCoords(),i=this._boxResizeHoverSize/2;return e[0]>t[0]-i&&e[0]<t[0]+i&&e[1]>t[1]-i&&e[1]<t[1]+i},e.prototype._drawArea=function(e,t,i){e.arc(t.x,t.y,i.w/2,0,2*Math.PI)},e.prototype.draw=function(){t.prototype.draw.apply(this,arguments);var e=this.getCenterPoint();this._cropCanvas.drawIconMove([e.x,e.y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio),this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},e.prototype.processMouseMove=function(e,t){var i="default",r=!1;if(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)this.setCenterPointOnMove({x:e-this._posDragStartX,y:t-this._posDragStartY}),i="move",r=this._areaIsHover=!0,this._events.trigger("area-move");else if(this._boxResizeIsDragging){var n,o,s;i="nesw-resize",o=e-this._posResizeStartX,n=(s=this._posResizeStartY-t)<o?this._posResizeStartSize.w+2*s:this._posResizeStartSize.w+2*o;var a=(this.getCenterPoint(),{}),h={};a.x=this.getCenterPoint().x-.5*n,h.x=this.getCenterPoint().x+.5*n,a.y=this.getCenterPoint().y-.5*n,h.y=this.getCenterPoint().y+.5*n,this.CircleOnMove(a,h),r=this._boxResizeIsHover=!0,this._events.trigger("area-resize")}else this._isCoordWithinBoxResize([e,t])?(i="nesw-resize",this._areaIsHover=!1,r=this._boxResizeIsHover=!0):this._isCoordWithinArea([e,t])&&(i="move",r=this._areaIsHover=!0);return angular.element(this._ctx.canvas).css({cursor:i}),r},e.prototype.processMouseDown=function(e,t){if(this._isCoordWithinBoxResize([e,t]))this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start");else if(this._isCoordWithinArea([e,t])){this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1;var i=this.getCenterPoint();this._posDragStartX=e-i.x,this._posDragStartY=t-i.y,this._events.trigger("area-move-start")}},e.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},e}]),e.factory("cropAreaRectangle",["cropArea",function(o){function e(){o.apply(this,arguments),this._resizeCtrlBaseRadius=15,this._resizeCtrlNormalRatio=.6,this._resizeCtrlHoverRatio=.7,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize={w:0,h:0},this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1}return(e.prototype=new o).getType=function(){return"rectangle"},e.prototype._calcRectangleCorners=function(){var e=this.getSize(),t=this.getSouthEastBound();return[[e.x,e.y],[t.x,e.y],[e.x,t.y],[t.x,t.y]]},e.prototype._calcRectangleDimensions=function(){var e=this.getSize(),t=this.getSouthEastBound();return{left:e.x,top:e.y,right:t.x,bottom:t.y}},e.prototype._isCoordWithinArea=function(e){var t=this._calcRectangleDimensions();return e[0]>=t.left&&e[0]<=t.right&&e[1]>=t.top&&e[1]<=t.bottom},e.prototype._isCoordWithinResizeCtrl=function(e){for(var t=this._calcRectangleCorners(),i=-1,r=0,n=t.length;r<n;r++){var o=t[r];if(e[0]>o[0]-this._resizeCtrlHoverRadius&&e[0]<o[0]+this._resizeCtrlHoverRadius&&e[1]>o[1]-this._resizeCtrlHoverRadius&&e[1]<o[1]+this._resizeCtrlHoverRadius){i=r;break}}return i},e.prototype._drawArea=function(e,t,i){e.rect(i.x,i.y,i.w,i.h)},e.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var e=this.getCenterPoint();this._cropCanvas.drawIconMove([e.x,e.y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var t=this._calcRectangleCorners(),i=0,r=t.length;i<r;i++){var n=t[i];this._cropCanvas.drawIconResizeBoxBase(n,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},e.prototype.processMouseMove=function(e,t){var i="default",r=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this.setCenterPointOnMove({x:e-this._posDragStartX,y:t-this._posDragStartY}),i="move",r=this._areaIsHover=!0,this._events.trigger("area-move");else if(-1<this._resizeCtrlIsDragging){var n=this.getSize(),o=this.getSouthEastBound(),s=e;switch(this._resizeCtrlIsDragging){case 0:this._aspect&&(s=o.x-(o.y-t)*this._aspect),this.setSizeByCorners({x:s,y:t},{x:o.x,y:o.y}),i="nwse-resize";break;case 1:this._aspect&&(s=n.x+(o.y-t)*this._aspect),this.setSizeByCorners({x:n.x,y:t},{x:s,y:o.y}),i="nesw-resize";break;case 2:this._aspect&&(s=o.x-(t-n.y)*this._aspect),this.setSizeByCorners({x:s,y:n.y},{x:o.x,y:t}),i="nesw-resize";break;case 3:this._aspect&&(s=n.x+(t-n.y)*this._aspect),this.setSizeByCorners({x:n.x,y:n.y},{x:s,y:t}),i="nwse-resize"}this._resizeCtrlIsHover=this._resizeCtrlIsDragging,r=!0,this._events.trigger("area-resize")}else{var a=this._isCoordWithinResizeCtrl([e,t]);if(-1<a){switch(a){case 0:i="nwse-resize";break;case 1:case 2:i="nesw-resize";break;case 3:i="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=a,r=!0}else this._isCoordWithinArea([e,t])&&(i="move",r=this._areaIsHover=!0)}return angular.element(this._ctx.canvas).css({cursor:i}),r},e.prototype.processMouseDown=function(e,t){var i=this._isCoordWithinResizeCtrl([e,t]);if(-1<i)this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=i,this._resizeCtrlIsHover=i,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start");else if(this._isCoordWithinArea([e,t])){this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1;var r=this.getCenterPoint();this._posDragStartX=e-r.x,this._posDragStartY=t-r.y,this._events.trigger("area-move-start")}},e.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),-1<this._resizeCtrlIsDragging&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},e}]),e.factory("cropAreaSquare",["cropArea",function(o){function e(){o.apply(this,arguments),this._resizeCtrlBaseRadius=15,this._resizeCtrlNormalRatio=.6,this._resizeCtrlHoverRatio=.7,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1}return(e.prototype=new o).getType=function(){return"square"},e.prototype._calcSquareCorners=function(){var e=this.getSize(),t=this.getSouthEastBound();return[[e.x,e.y],[t.x,e.y],[e.x,t.y],[t.x,t.y]]},e.prototype._calcSquareDimensions=function(){var e=this.getSize(),t=this.getSouthEastBound();return{left:e.x,top:e.y,right:t.x,bottom:t.y}},e.prototype._isCoordWithinArea=function(e){var t=this._calcSquareDimensions();return e[0]>=t.left&&e[0]<=t.right&&e[1]>=t.top&&e[1]<=t.bottom},e.prototype._isCoordWithinResizeCtrl=function(e){for(var t=this._calcSquareCorners(),i=-1,r=0,n=t.length;r<n;r++){var o=t[r];if(e[0]>o[0]-this._resizeCtrlHoverRadius&&e[0]<o[0]+this._resizeCtrlHoverRadius&&e[1]>o[1]-this._resizeCtrlHoverRadius&&e[1]<o[1]+this._resizeCtrlHoverRadius){i=r;break}}return i},e.prototype._drawArea=function(e,t,i){e.rect(i.x,i.y,i.w,i.h)},e.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var e=this.getCenterPoint();this._cropCanvas.drawIconMove([e.x,e.y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var t=this._calcSquareCorners(),i=0,r=t.length;i<r;i++){var n=t[i];this._cropCanvas.drawIconResizeBoxBase(n,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},e.prototype._clampPoint=function(e,t){var i=this._ctx.canvas.width;return e<0&&(t-=Math.abs(e),e=0),t<0&&(e-=Math.abs(t),t=0),i<e&&(t-=i-e,e=i),i<t&&(e-=i-t,t=i),{x:e,y:t}},e.prototype.processMouseMove=function(e,t){var i="default",r=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this.setCenterPointOnMove({x:e-this._posDragStartX,y:t-this._posDragStartY}),i="move",r=this._areaIsHover=!0,this._events.trigger("area-move");else if(-1<this._resizeCtrlIsDragging){var n,o;switch(this._resizeCtrlIsDragging){case 0:o=n=-1,i="nwse-resize";break;case 1:o=-(n=1),i="nesw-resize";break;case 2:n=-1,o=1,i="nesw-resize";break;case 3:o=n=1,i="nwse-resize"}var s,a=(e-this._posResizeStartX)*n,h=(t-this._posResizeStartY)*o;s=h<a?this._posResizeStartSize.w+h:this._posResizeStartSize.w+a;var c=Math.max(this._minSize.w,s),u={},l={},g={},f={},d=this.getSize(),p=this.getSouthEastBound();switch(this._resizeCtrlIsDragging){case 0:u.x=p.x-c,u.y=p.y-c,u=this._clampPoint(u.x,u.y),this.setSizeByCorners(u,{x:p.x,y:p.y}),i="nwse-resize";break;case 1:f.x=d.x+c,f.y=p.y-c,f=this._clampPoint(f.x,f.y),this.setSizeByCorners({x:d.x,y:f.y},{x:f.x,y:p.y}),i="nesw-resize";break;case 2:g.x=p.x-c,g.y=d.y+c,g=this._clampPoint(g.x,g.y),this.setSizeByCorners({x:g.x,y:d.y},{x:p.x,y:g.y}),i="nesw-resize";break;case 3:l.x=d.x+c,l.y=d.y+c,l=this._clampPoint(l.x,l.y),this.setSizeByCorners({x:d.x,y:d.y},l),i="nwse-resize"}this._resizeCtrlIsHover=this._resizeCtrlIsDragging,r=!0,this._events.trigger("area-resize")}else{var v=this._isCoordWithinResizeCtrl([e,t]);if(-1<v){switch(v){case 0:i="nwse-resize";break;case 1:case 2:i="nesw-resize";break;case 3:i="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=v,r=!0}else this._isCoordWithinArea([e,t])&&(i="move",r=this._areaIsHover=!0)}return angular.element(this._ctx.canvas).css({cursor:i}),r},e.prototype.processMouseDown=function(e,t){var i=this._isCoordWithinResizeCtrl([e,t]);if(-1<i)this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=i,this._resizeCtrlIsHover=i,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start");else if(this._isCoordWithinArea([e,t])){this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1;var r=this.getCenterPoint();this._posDragStartX=e-r.x,this._posDragStartY=t-r.y,this._events.trigger("area-move-start")}},e.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),-1<this._resizeCtrlIsDragging&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},e}]),e.factory("cropArea",["cropCanvas",function(i){function e(e,t){this._ctx=e,this._events=t,this._minSize={x:0,y:0,w:80,h:80},this._initSize=void 0,this._initCoords=void 0,this._allowCropResizeOnCorners=!1,this._forceAspectRatio=!1,this._aspect=null,this._cropCanvas=new i(e),this._image=new Image,this._size={x:0,y:0,w:150,h:150}}return e.prototype.setAllowCropResizeOnCorners=function(e){this._allowCropResizeOnCorners=e},e.prototype.getImage=function(){return this._image},e.prototype.setImage=function(e){this._image=e},e.prototype.setForceAspectRatio=function(e){this._forceAspectRatio=e},e.prototype.setAspect=function(e){this._aspect=e},e.prototype.getAspect=function(){return this._aspect},e.prototype.getCanvasSize=function(){return{w:this._ctx.canvas.width,h:this._ctx.canvas.height}},e.prototype.getSize=function(){return this._size},e.prototype.setSize=function(e){e=this._processSize(e),this._size=this._preventBoundaryCollision(e)},e.prototype.setSizeOnMove=function(e){e=this._processSize(e),this._size=this._allowCropResizeOnCorners?this._preventBoundaryCollision(e):this._allowMouseOutsideCanvas(e)},e.prototype.CircleOnMove=function(e,t){var i={x:e.x,y:e.y,w:t.x-e.x,h:t.y-e.y},r=this._ctx.canvas.height,n=this._ctx.canvas.width;(i.w>n||i.h>r)&&(n<r?(i.w=n,i.h=n):(i.w=r,i.h=r)),i.x+i.w>n&&(i.x=n-i.w),i.y+i.h>r&&(i.y=r-i.h),i.x<0&&(i.x=0),i.y<0&&(i.y=0),this._minSize.w>i.w&&(i.w=this._minSize.w,i.x=this._size.x),this._minSize.h>i.h&&(i.h=this._minSize.h,i.y=this._size.y),this._size=i},e.prototype.setSizeByCorners=function(e,t){var i={x:e.x,y:e.y,w:t.x-e.x,h:t.y-e.y};this.setSize(i)},e.prototype.getSouthEastBound=function(){return this._southEastBound(this.getSize())},e.prototype.setMinSize=function(e){this._minSize=this._processSize(e),this.setSize(this._minSize)},e.prototype.getMinSize=function(){return this._minSize},e.prototype.getCenterPoint=function(){var e=this.getSize();return{x:e.x+e.w/2,y:e.y+e.h/2}},e.prototype.setCenterPoint=function(e){var t=this.getSize();this.setSize({x:e.x-t.w/2,y:e.y-t.h/2,w:t.w,h:t.h})},e.prototype.setCenterPointOnMove=function(e){var t=this.getSize();this.setSizeOnMove({x:e.x-t.w/2,y:e.y-t.h/2,w:t.w,h:t.h})},e.prototype.setInitSize=function(e){this._initSize=this._processSize(e),this.setSize(this._initSize)},e.prototype.getInitSize=function(){return this._initSize},e.prototype.setInitCoords=function(e){e.h=this.getSize().h,e.w=this.getSize().w,this._initCoords=this._processSize(e),this.setSize(this._initCoords)},e.prototype.getInitCoords=function(){return this._initCoords},e.prototype.getType=function(){return"circle"},e.prototype._allowMouseOutsideCanvas=function(e){var t=this._ctx.canvas.height,i=this._ctx.canvas.width,r={w:e.w,h:e.h};return r.x=e.x<0?0:e.x+e.w>i?i-e.w:e.x,r.y=e.y<0?0:e.y+e.h>t?t-e.h:e.y,r},e.prototype._preventBoundaryCollision=function(e){var t=this._ctx.canvas.height,i=this._ctx.canvas.width,r={x:e.x,y:e.y},n=this._southEastBound(e);r.x<0&&(r.x=0),r.y<0&&(r.y=0),n.x>i&&(n.x=i),n.y>t&&(n.y=t);var o=this._forceAspectRatio?e.w:n.x-r.x,s=this._forceAspectRatio?e.h:n.y-r.y;t<s&&(s=t),this._aspect&&(o=s*this._aspect,r.x+o>i&&(s=(o=i-r.x)/this._aspect,this._minSize.w>o&&(o=this._minSize.w),this._minSize.h>s&&(s=this._minSize.h),r.x=i-o),r.y+s>t&&(r.y=t-s)),this._forceAspectRatio&&(o=s,r.x+o>i&&((o=i-r.x)<this._minSize.w&&(o=this._minSize.w),s=o));var a={x:r.x,y:r.y,w:o,h:s};return a.w<this._minSize.w&&!this._forceAspectRatio&&(a.w=this._minSize.w,(n=this._southEastBound(a)).x>i&&(n.x=i,r.x=Math.max(n.x-i,n.x-this._minSize.w),a={x:r.x,y:r.y,w:n.x-r.x,h:n.y-r.y})),a.h<this._minSize.h&&!this._forceAspectRatio&&(a.h=this._minSize.h,(n=this._southEastBound(a)).y>t&&(n.y=t,r.y=Math.max(n.y-t,n.y-this._minSize.h),a={x:r.x,y:r.y,w:n.x-r.x,h:n.y-r.y})),this._forceAspectRatio&&((n=this._southEastBound(a)).y>t&&(a.y=t-a.h),n.x>i&&(a.x=i-a.w)),a},e.prototype._dontDragOutside=function(){var e=this._ctx.canvas.height,t=this._ctx.canvas.width;this._width>t&&(this._width=t),this._height>e&&(this._height=e),this._x<this._width/2&&(this._x=this._width/2),this._x>t-this._width/2&&(this._x=t-this._width/2),this._y<this._height/2&&(this._y=this._height/2),this._y>e-this._height/2&&(this._y=e-this._height/2)},e.prototype._drawArea=function(){},e.prototype._processSize=function(e){"number"==typeof e&&(e={w:e,h:e});var t=e.w;return this._aspect&&(t=e.h*this._aspect),{x:void 0===e.x?this.getSize().x:e.x,y:void 0===e.y?this.getSize().y:e.y,w:t||this._minSize.w,h:e.h||this._minSize.h}},e.prototype._southEastBound=function(e){return{x:e.x+e.w,y:e.y+e.h}},e.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,this.getCenterPoint(),this._size,this._drawArea)},e.prototype.processMouseMove=function(){},e.prototype.processMouseDown=function(){},e.prototype.processMouseUp=function(){},e}]),e.factory("cropCanvas",[function(){var n=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],o=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],s=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],c=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],i=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],u=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],l=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],g=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],f="#fff",d="#bababa",p="#444",v="#fff",m="#bababa",y="#444",S="#fff",w=1;return function(h){function a(e,t,i){return[i*e[0]+t[0],i*e[1]+t[1]]}function r(e,t,i,r){h.save(),h.fillStyle=t,h.beginPath();var n,o=a(e[0],i,r);for(var s in h.moveTo(o[0],o[1]),e)0<s&&(n=a(e[s],i,r),h.lineTo(n[0],n[1]));h.lineTo(o[0],o[1]),h.fill(),h.closePath(),h.restore()}this.drawIconMove=function(e,t){r(i,S,e,t),r(u,S,e,t),r(l,S,e,t),r(g,S,e,t)},this.drawIconResizeCircle=function(e,t,i){var r=t*i;h.save(),h.strokeStyle=m,h.lineWidth=w,h.fillStyle=y,h.beginPath(),h.arc(e[0],e[1],r,0,2*Math.PI),h.fill(),h.stroke(),h.closePath(),h.restore()},this.drawIconResizeBoxBase=function(e,t,i){var r=t*i;h.save(),h.strokeStyle=d,h.lineWidth=w,h.fillStyle=p,h.fillRect(e[0]-r/2,e[1]-r/2,r,r),h.strokeRect(e[0]-r/2,e[1]-r/2,r,r),h.restore()},this.drawIconResizeBoxNESW=function(e,t,i){this.drawIconResizeBoxBase(e,t,i),r(o,v,e,i),r(s,v,e,i)},this.drawIconResizeBoxNWSE=function(e,t,i){this.drawIconResizeBoxBase(e,t,i),r(n,v,e,i),r(c,v,e,i)},this.drawCropArea=function(e,t,i,r){var n=Math.abs(e.width/h.canvas.width),o=Math.abs(e.height/h.canvas.height),s=Math.abs(t.x-i.w/2),a=Math.abs(t.y-i.h/2);h.save(),h.strokeStyle=f,h.lineWidth=w,h.setLineDash([5,5]),h.beginPath(),r(h,t,i),h.stroke(),h.clip(),0<i.w&&h.drawImage(e,s*n,a*o,Math.abs(i.w*n),Math.abs(i.h*o),s,a,Math.abs(i.w),Math.abs(i.h)),h.beginPath(),r(h,t,i),h.stroke(),h.clip(),h.restore()}}}]),e.service("cropEXIF",[function(){function n(e){return e.exifdata}function i(r,n){function t(e){var t=h(e),i=function(e){var t=new DataView(e);if(g&&console.log("Got file of length "+e.byteLength),255!==t.getUint8(0)||216!==t.getUint8(1))return g&&console.log("Not a valid JPEG"),!1;for(var i=2,r=e.byteLength;i<r;){if(h=i,56===(a=t).getUint8(h)&&66===a.getUint8(h+1)&&73===a.getUint8(h+2)&&77===a.getUint8(h+3)&&4===a.getUint8(h+4)&&4===a.getUint8(h+5)){var n=t.getUint8(i+7);n%2!=0&&(n+=1),0===n&&(n=4);var o=i+8+n,s=t.getUint16(i+6+n);return c(e,o,s)}i++}var a,h}(e);r.exifdata=t||{},r.iptcdata=i||{},n&&n.call(r)}var e,i,o,s=new FileReader;if(r.src){if(/^data\:/i.test(r.src))t(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),r=i.length,n=new ArrayBuffer(r),o=new Uint8Array(n),s=0;s<r;s++)o[s]=i.charCodeAt(s);return n}(r.src));else/^blob\:/i.test(r.src)&&(s.onload=function(e){t(e.target.result)},e=r.src,i=function(e){s.readAsArrayBuffer(e)},(o=new XMLHttpRequest).open("GET",e,!0),o.responseType="blob",o.onload=function(){200!==this.status&&0!==this.status||i(this.response)},o.send());var a=new XMLHttpRequest;a.onload=function(){if(200!==this.status&&0!==this.status)throw"Could not load image";t(a.response),a=null},a.responseType="arraybuffer",a.open("GET",r.src,!0);try{a.send(null)}catch(e){}}else window.FileReader&&(r instanceof window.Blob||r instanceof window.File)&&(s.onload=function(e){g&&console.log("Got file of length "+e.target.result.byteLength),t(e.target.result)},s.readAsArrayBuffer(r))}function h(e){var t=new DataView(e);if(g&&console.log("Got file of length "+e.byteLength),255!==t.getUint8(0)||216!==t.getUint8(1))return g&&console.log("Not a valid JPEG"),!1;for(var i,r=2,n=e.byteLength;r<n;){if(255!==t.getUint8(r))return g&&console.log("Not a valid marker at offset "+r+", found: "+t.getUint8(r)),!1;if(i=t.getUint8(r+1),g&&console.log(i),225===i)return g&&console.log("Found 0xFFE1 marker"),o(t,r+4,t.getUint16(r+2));r+=2+t.getUint16(r+2)}}function c(e,t,i){for(var r,n,o,s,a=new DataView(e),h={},c=t;c<t+i;)28===a.getUint8(c)&&2===a.getUint8(c+1)&&((s=a.getUint8(c+2))in y&&(o=a.getInt16(c+3),n=y[s],r=d(a,c+5,o),h.hasOwnProperty(n)?h[n]instanceof Array?h[n].push(r):h[n]=[h[n],r]:h[n]=r)),c++;return h}function u(e,t,i,r,n){var o,s,a,h=e.getUint16(i,!n),c={};for(a=0;a<h;a++)o=i+12*a+2,!(s=r[e.getUint16(o,!n)])&&g&&console.log("Unknown tag: "+e.getUint16(o,!n)),c[s]=l(e,o,t,0,n);return c}function l(e,t,i,r,n){var o,s,a,h,c,u,l=e.getUint16(t+2,!n),g=e.getUint32(t+4,!n),f=e.getUint32(t+8,!n)+i;switch(l){case 1:case 7:if(1===g)return e.getUint8(t+8,!n);for(o=4<g?f:t+8,s=[],h=0;h<g;h++)s[h]=e.getUint8(o+h);return s;case 2:return d(e,o=4<g?f:t+8,g-1);case 3:if(1===g)return e.getUint16(t+8,!n);for(o=2<g?f:t+8,s=[],h=0;h<g;h++)s[h]=e.getUint16(o+2*h,!n);return s;case 4:if(1===g)return e.getUint32(t+8,!n);for(s=[],h=0;h<g;h++)s[h]=e.getUint32(f+4*h,!n);return s;case 5:if(1===g)return(a=(c=e.getUint32(f,!n))/(u=e.getUint32(f+4,!n))).numerator=c,a.denominator=u,a;for(s=[],h=0;h<g;h++)c=e.getUint32(f+8*h,!n),u=e.getUint32(f+4+8*h,!n),s[h]=c/u,s[h].numerator=c,s[h].denominator=u;return s;case 9:if(1===g)return e.getInt32(t+8,!n);for(s=[],h=0;h<g;h++)s[h]=e.getInt32(f+4*h,!n);return s;case 10:if(1===g)return e.getInt32(f,!n)/e.getInt32(f+4,!n);for(s=[],h=0;h<g;h++)s[h]=e.getInt32(f+8*h,!n)/e.getInt32(f+4+8*h,!n);return s}}function d(e,t,i){for(var r="",n=t;n<t+i;n++)r+=String.fromCharCode(e.getUint8(n));return r}function o(e,t){if("Exif"!==d(e,t,4))return g&&console.log("Not valid EXIF data! "+d(e,t,4)),!1;var i,r,n,o,s,a=t+6;if(18761===e.getUint16(a))i=!1;else{if(19789!==e.getUint16(a))return g&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!==e.getUint16(a+2,!i))return g&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=e.getUint32(a+4,!i);if(h<8)return g&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(a+4,!i)),!1;if((r=u(e,a,a+h,p,i)).ExifIFDPointer)for(n in o=u(e,a,a+r.ExifIFDPointer,f,i)){switch(n){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[n]=m[n][o[n]];break;case"ExifVersion":case"FlashpixVersion":o[n]=String.fromCharCode(o[n][0],o[n][1],o[n][2],o[n][3]);break;case"ComponentsConfiguration":o[n]=m.Components[o[n][0]]+m.Components[o[n][1]]+m.Components[o[n][2]]+m.Components[o[n][3]]}r[n]=o[n]}if(r.GPSInfoIFDPointer)for(n in s=u(e,a,a+r.GPSInfoIFDPointer,v,i)){switch(n){case"GPSVersionID":s[n]=s[n][0]+"."+s[n][1]+"."+s[n][2]+"."+s[n][3]}r[n]=s[n]}return r}var g=!1,f=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},p=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},m=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},y={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(e,t){return!((e instanceof Image||e instanceof HTMLImageElement)&&!e.complete)&&(n(e)?t&&t.call(e):i(e,t),!0)},this.getTag=function(e,t){return n(e)?e.exifdata[t]:void 0},this.getAllTags=function(e){if(!n(e))return{};var t,i=e.exifdata,r={};for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t]);return r},this.pretty=function(e){if(!n(e))return"";var t,i=e.exifdata,r="";for(t in i)i.hasOwnProperty(t)&&(r+="object"==typeof i[t]?i[t]instanceof Number?t+" : "+i[t]+" ["+i[t].numerator+"/"+i[t].denominator+"]\r\n":t+" : ["+i[t].length+" values]\r\n":t+" : "+i[t]+"\r\n");return r},this.readFromBinaryFile=function(e){return h(e)}}]),e.factory("cropHost",["$document","$q","cropAreaCircle","cropAreaSquare","cropAreaRectangle","cropEXIF",function(I,R,b,D,P,M){function F(e){var t=e.getBoundingClientRect(),i=document.body,r=document.documentElement,n=window.pageYOffset||r.scrollTop||i.scrollTop,o=window.pageXOffset||r.scrollLeft||i.scrollLeft,s=r.clientTop||i.clientTop||0,a=r.clientLeft||i.clientLeft||0,h=t.top+n-s,c=t.left+o-a;return{top:Math.round(h),left:Math.round(c)}}return function(l,e,f){function g(){d.clearRect(0,0,d.canvas.width,d.canvas.height),null!==p&&(d.drawImage(p,0,0,d.canvas.width,d.canvas.height),d.save(),d.fillStyle="rgba(0, 0, 0, 0.65)",d.fillRect(0,0,d.canvas.width,d.canvas.height),d.restore(),v.draw())}var d=null,p=null,v=null,h=null,c=null,u=this,m=[100,100],y=[300,300],S=null,i=[],r={w:200,h:200},n=null,w="image/png",_=null,C=!1;this.setInitMax=function(e){h=e},this.setAllowCropResizeOnCorners=function(e){v.setAllowCropResizeOnCorners(e)};function z(){if(null!==p){v.setImage(p);var e=[p.width,p.height],t=p.width/p.height,i=e;i[0]>y[0]?(i[0]=y[0],i[1]=i[0]/t):i[0]<m[0]&&(i[0]=m[0],i[1]=i[0]/t),"fixed-height"===S&&i[1]>y[1]?(i[1]=y[1],i[0]=i[1]*t):i[1]<m[1]&&(i[1]=m[1],i[0]=i[1]*t),l.prop("width",i[0]).prop("height",i[1]),"fixed-height"===S&&l.css({"margin-left":-i[0]/2+"px","margin-top":-i[1]/2+"px"});var r=d.canvas.width,n=d.canvas.height,o=u.getAreaType();if("circle"===o||"square"===o)n<r&&(r=n),n=r;else if("rectangle"===o&&c){var s=v.getAspect();s<r/n?r=s*n:n=s*r}if(h?v.setSize({w:r,h:n}):void 0!==v.getInitSize()?v.setSize({w:Math.min(v.getInitSize().w,r/2),h:Math.min(v.getInitSize().h,n/2)}):v.setSize({w:Math.min(200,r/2),h:Math.min(200,n/2)}),v.getInitCoords())if(u.areaInitIsRelativeToImage){var a=p.width/i[0];v.setSize({w:v.getInitSize().w/a,h:v.getInitSize().h/a,x:v.getInitCoords().x/a,y:v.getInitCoords().y/a})}else v.setSize({w:v.getSize().w,h:v.getSize().h,x:v.getInitCoords().x,y:v.getInitCoords().y});else v.setCenterPoint({x:d.canvas.width/2,y:d.canvas.height/2})}else l.prop("width",0).prop("height",0).css({"margin-top":0});g()}function o(e){return angular.isDefined(e.changedTouches)?e.changedTouches:e.originalEvent.changedTouches}function t(e){if(null!==p){var t,i,r=F(d.canvas);i="touchmove"===e.type?(t=o(e)[0].pageX,o(e)[0].pageY):(t=e.pageX,e.pageY),v.processMouseMove(t-r.left,i-r.top),g()}}function s(e){if(e.preventDefault(),e.stopPropagation(),null!==p){var t,i,r=F(d.canvas);i="touchstart"===e.type?(t=o(e)[0].pageX,o(e)[0].pageY):(t=e.pageX,e.pageY),v.processMouseDown(t-r.left,i-r.top),g()}}function a(e){if(null!==p){var t,i,r=F(d.canvas);i="touchend"===e.type?(t=o(e)[0].pageX,o(e)[0].pageY):(t=e.pageX,e.pageY),v.processMouseUp(t-r.left,i-r.top),g()}}function x(e){var t,i,r=e,n=v.getCenterPoint(),o={dataURI:null,imageData:null};if(t=(i=angular.element("<canvas></canvas>")[0]).getContext("2d"),i.width=r.w,i.height=r.h,null!==p){var s=(n.x-v.getSize().w/2)*(p.width/d.canvas.width),a=(n.y-v.getSize().h/2)*(p.height/d.canvas.height),h=v.getSize().w*(p.width/d.canvas.width),c=v.getSize().h*(p.height/d.canvas.height);if(C)t.drawImage(p,s,a,h,c,0,0,r.w,r.h);else{var u,l,g=h/c;1<g?u=(l=r.w)/g:l=(u=r.h)*g,t.drawImage(p,s,a,h,c,0,0,Math.round(l),Math.round(u))}o.dataURI=null!==_?i.toDataURL(w,_):i.toDataURL(w)}return o}this.getResultImage=function(){if(0===i.length)return x(this.getResultImageSize());for(var e=[],t=0;t<i.length;t++)e.push({dataURI:x(i[t]).dataURI,w:i[t].w,h:i[t].h});return e},this.getResultImageDataBlob=function(){var e,t,i=v.getCenterPoint(),r=this.getResultImageSize(),n=R.defer();if(e=(t=angular.element("<canvas></canvas>")[0]).getContext("2d"),t.width=r.w,t.height=r.h,null!==p){var o=(i.x-v.getSize().w/2)*(p.width/d.canvas.width),s=(i.y-v.getSize().h/2)*(p.height/d.canvas.height),a=v.getSize().w*(p.width/d.canvas.width),h=v.getSize().h*(p.height/d.canvas.height);if(C)e.drawImage(p,o,s,a,h,0,0,r.w,r.h);else{var c,u,l=a/h;1<l?c=(u=r.w)/l:u=(c=r.h)*l,e.drawImage(p,o,s,a,h,0,0,Math.round(u),Math.round(c))}}return null!==_?t.toBlob(function(e){n.resolve(e)},w,_):t.toBlob(function(e){n.resolve(e)},w),n.promise},this.getAreaCoords=function(){return v.getSize()},this.getArea=function(){return v},this.setNewImageSource=function(e){if(p=null,z(),e){var g=new Image;g.onload=function(){f.trigger("load-done"),M.getData(g,function(){var e=M.getTag(g,"Orientation");if(-1<[3,6,8].indexOf(e)){var t=document.createElement("canvas"),i=t.getContext("2d"),r=g.width,n=g.height,o=0,s=0,a=0,h=0,c=0;switch(h=r,c=n,e){case 3:o=-g.width,s=-g.height,a=180;break;case 6:r=g.height,n=g.width,s=-g.height,h=n,c=r,a=90;break;case 8:r=g.height,n=g.width,o=-g.width,h=n,c=r,a=270}var u=1e3;if(u<r||u<n){var l=0;u<r?(l=u/r,r=u,n*=l):u<n&&(l=u/n,n=u,r*=l),s*=l,o*=l,h*=l,c*=l}t.width=r,t.height=n,i.rotate(a*Math.PI/180),i.drawImage(g,o,s,h,c),(p=new Image).onload=function(){z(),f.trigger("image-updated")},p.src=t.toDataURL(w)}else p=g,f.trigger("image-updated");z()})},g.onerror=function(){f.trigger("load-error")},f.trigger("load-start"),e instanceof window.Blob?g.src=URL.createObjectURL(e):("http"!==e.substring(0,4).toLowerCase()&&"//"!==e.substring(0,2)||(g.crossOrigin="anonymous"),g.src=e)}},this.setMaxDimensions=function(e,t){if(y=[e,t],null!==p){var i=d.canvas.width,r=d.canvas.height,n=[p.width,p.height],o=p.width/p.height,s=n;s[0]>y[0]?(s[0]=y[0],s[1]=s[0]/o):s[0]<m[0]&&(s[0]=m[0],s[1]=s[0]/o),"fixed-height"===S&&s[1]>y[1]?(s[1]=y[1],s[0]=s[1]*o):s[1]<m[1]&&(s[1]=m[1],s[0]=s[1]*o),l.prop("width",s[0]).prop("height",s[1]),"fixed-height"===S&&l.css({"margin-left":-s[0]/2+"px","margin-top":-s[1]/2+"px"});var a=d.canvas.width/i,h=d.canvas.height/r,c=Math.min(a,h),u=v.getCenterPoint();v.setSize({w:v.getSize().w*c,h:v.getSize().h*c}),v.setCenterPoint({x:u.x*a,y:u.y*h})}else l.prop("width",0).prop("height",0).css({"margin-top":0});g()},this.setAreaMinSize=function(e){angular.isUndefined(e)||(e="number"==typeof e||"string"==typeof e?{w:parseInt(parseInt(e),10),h:parseInt(parseInt(e),10)}:{w:parseInt(e.w,10),h:parseInt(e.h,10)},isNaN(e.w)||isNaN(e.h)||(v.setMinSize(e),g()))},this.setAreaMinRelativeSize=function(e){if(null!==p&&!angular.isUndefined(e)){var t=v.getCanvasSize();e="number"==typeof e||"string"==typeof e?(n={w:e,h:e},{w:t.w/(p.width/parseInt(parseInt(e),10)),h:t.h/(p.height/parseInt(parseInt(e),10))}):(n=e,{w:t.w/(p.width/parseInt(parseInt(e.w),10)),h:t.h/(p.height/parseInt(parseInt(e.h),10))}),isNaN(e.w)||isNaN(e.h)||(v.setMinSize(e),g())}},this.setAreaInitSize=function(e){angular.isUndefined(e)||(e="number"==typeof e||"string"==typeof e?{w:parseInt(parseInt(e),10),h:parseInt(parseInt(e),10)}:{w:parseInt(e.w,10),h:parseInt(e.h,10)},isNaN(e.w)||isNaN(e.h)||(v.setInitSize(e),g()))},this.setAreaInitCoords=function(e){angular.isUndefined(e)||(e={x:parseInt(e.x,10),y:parseInt(e.y,10)},isNaN(e.x)||isNaN(e.y)||(v.setInitCoords(e),g()))},this.setMaxCanvasDimensions=function(e){if(!angular.isUndefined(e)){var t;t="number"==typeof e||"string"==typeof e?[parseInt(parseInt(e),10),parseInt(parseInt(e),10)]:[parseInt(e.w,10),parseInt(e.h,10)],!isNaN(t[0])&&0<t[0]&&t[0]>m[0]&&!isNaN(t[1])&&0<t[1]&&t[1]>m[1]&&(y=t)}},this.setMinCanvasDimensions=function(e){if(!angular.isUndefined(e)){var t;t="number"==typeof e||"string"==typeof e?[parseInt(parseInt(e),10),parseInt(parseInt(e),10)]:[parseInt(e.w,10),parseInt(e.h,10)],!isNaN(t[0])&&0<=t[0]&&!isNaN(t[1])&&0<=t[1]&&(m=t)}},this.setScalemode=function(e){S=e},this.getScalemode=function(){return S},this.getResultImageSize=function(){if("selection"===r)return v.getSize();if("max"!==r)return r;var e=1;p&&d&&d.canvas&&(e=p.width/d.canvas.width);var t={w:e*v.getSize().w,h:e*v.getSize().h};return n&&(t.w<n.w&&(t.w=n.w),t.h<n.h&&(t.h=n.h)),t},this.setResultImageSize=function(e){if(angular.isArray(e))return i=e.slice(),void(e={w:parseInt(e[0].w,10),h:parseInt(e[0].h,10)});if(!angular.isUndefined(e)){if(angular.isString(e))return void(r=e);angular.isNumber(e)&&(e={w:e=parseInt(e,10),h:e}),e={w:parseInt(e.w,10),h:parseInt(e.h,10)},isNaN(e.w)||isNaN(e.h)||(r=e,g())}},this.setResultImageFormat=function(e){w=e},this.setResultImageQuality=function(e){e=parseFloat(e),!isNaN(e)&&0<=e&&e<=1&&(_=e)},this.getAreaType=function(){return v.getType()},this.setAreaType=function(e){var t=v.getCenterPoint(),i=v.getSize(),r=v.getMinSize(),n=t.x,o=t.y,s=b;"square"===e?s=D:"rectangle"===e&&(s=P),(v=new s(d,f)).setMinSize(r),v.setSize(i),"square"===e||"circle"===e?(C=!0,v.setForceAspectRatio(!0)):(C=!1,v.setForceAspectRatio(!1)),v.setCenterPoint({x:n,y:o}),null!==p&&v.setImage(p),g()},this.getDominantColor=function(e){var t=new Image,i=new ColorThief,r=null,n=R.defer();return t.src=e,t.onload=function(){r=i.getColor(t),n.resolve(r)},n.promise},this.getPalette=function(e){var t=new Image,i=new ColorThief,r=null,n=R.defer();return t.src=e,t.onload=function(){r=i.getPalette(t,colorPaletteLength),n.resolve(r)},n.promise},this.setPaletteColorLength=function(e){colorPaletteLength=e},this.setAspect=function(e){c=!0,v.setAspect(e);var t=v.getMinSize();t.w=t.h*e,v.setMinSize(t);var i=v.getSize();i.w=i.h*e,v.setSize(i)},d=l[0].getContext("2d"),v=new b(d,f),I.on("mousemove",t),l.on("mousedown",s),I.on("mouseup",a),I.on("touchmove",t),l.on("touchstart",s),I.on("touchend",a),this.destroy=function(){I.off("mousemove",t),l.off("mousedown",s),I.off("mouseup",a),I.off("touchmove",t),l.off("touchstart",s),I.off("touchend",a),l.remove()}}}]),e.factory("cropPubSub",[function(){return function(){var i={};this.on=function(e,t){return e.split(" ").forEach(function(e){i[e]||(i[e]=[]),i[e].push(t)}),this},this.trigger=function(e,t){return angular.forEach(i[e],function(e){e.call(null,t)}),this}}}])}(),function(e){"use strict";var u,l=e.Uint8Array,t=e.HTMLCanvasElement,i=t&&t.prototype,h=/\s*;\s*base64\s*(?:;|$)/i,c="toDataURL";l&&(u=new l([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),t&&!i.toBlob&&(i.toBlob=function(e,t){if(t=t||"image/png",this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))e(this.msToBlob());else{var i,r=Array.prototype.slice.call(arguments,1),n=this[c].apply(this,r),o=n.indexOf(","),s=n.substring(o+1),a=h.test(n.substring(0,o));Blob.fake?((i=new Blob).encoding=a?"base64":"URI",i.data=s,i.size=s.length):l&&(i=a?new Blob([function(e){for(var t,i,r=e.length,n=new l(r/4*3|0),o=0,s=0,a=[0,0],h=0,c=0;r--;)i=e.charCodeAt(o++),255!==(t=u[i-43])&&void 0!==t&&(a[1]=a[0],a[0]=i,c=c<<6|t,4===++h&&(n[s++]=c>>>16,61!==a[1]&&(n[s++]=c>>>8),61!==a[0]&&(n[s++]=c),h=0));return n}(s)],{type:t}):new Blob([decodeURIComponent(s)],{type:t})),void 0!==e&&e(i)}},i.toBlobHD=i.toDataURLHD?function(){c="toDataURLHD";var e=this.toBlob();return c="toDataURL",e}:i.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),function(){function d(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=e.width,this.height=this.canvas.height=e.height,this.context.drawImage(e,0,0,this.width,this.height)}d.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},d.prototype.update=function(e){this.context.putImageData(e,0,0)},d.prototype.getPixelCount=function(){return this.width*this.height},d.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},d.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};function e(){}if(e.prototype.getColor=function(e,t){return this.getPalette(e,5,t)[0]},e.prototype.getPalette=function(e,t,i){void 0===t&&(t=10),(void 0===i||i<1)&&(i=10);for(var r,n,o,s,a=new d(e),h=a.getImageData().data,c=a.getPixelCount(),u=[],l=0;l<c;l+=i)n=h[0+(r=4*l)],o=h[1+r],s=h[2+r],125<=h[3+r]&&(250<n&&250<o&&250<s||u.push([n,o,s]));var g=p.quantize(u,t),f=g?g.palette():null;return a.removeCanvas(),f},!x)var x={map:function(e,i){var r={};return i?e.map(function(e,t){return r.index=t,i.call(r,e)}):e.slice()},naturalOrder:function(e,t){return e<t?-1:t<e?1:0},sum:function(e,r){var n={};return e.reduce(r?function(e,t,i){return n.index=i,e+r.call(n,t)}:function(e,t){return e+t},0)},max:function(e,t){return Math.max.apply(null,t?x.map(e,t):e)}};var I,R,p=(R=8-(I=5),P.prototype={volume:function(e){var t=this;return t._volume&&!e||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(e){var t=this,i=t.histo;if(!t._count_set||e){var r,n,o,s=0;for(r=t.r1;r<=t.r2;r++)for(n=t.g1;n<=t.g2;n++)for(o=t.b1;o<=t.b2;o++)index=b(r,n,o),s+=i[index]||0;t._count=s,t._count_set=!0}return t._count},copy:function(){var e=this;return new P(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var t=this,i=t.histo;if(!t._avg||e){var r,n,o,s,a=0,h=1<<8-I,c=0,u=0,l=0;for(n=t.r1;n<=t.r2;n++)for(o=t.g1;o<=t.g2;o++)for(s=t.b1;s<=t.b2;s++)a+=r=i[b(n,o,s)]||0,c+=r*(n+.5)*h,u+=r*(o+.5)*h,l+=r*(s+.5)*h;t._avg=a?[~~(c/a),~~(u/a),~~(l/a)]:[~~(h*(t.r1+t.r2+1)/2),~~(h*(t.g1+t.g2+1)/2),~~(h*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(e){var t=this,i=e[0]>>R;return gval=e[1]>>R,bval=e[2]>>R,i>=t.r1&&i<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},M.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,i=0;i<t.size();i++)if(t.peek(i).vbox.contains(e))return t.peek(i).color;return this.nearest(e)},nearest:function(e){for(var t,i,r,n=this.vboxes,o=0;o<n.size();o++)((i=Math.sqrt(Math.pow(e[0]-n.peek(o).color[0],2)+Math.pow(e[1]-n.peek(o).color[1],2)+Math.pow(e[2]-n.peek(o).color[2],2)))<t||void 0===t)&&(t=i,r=n.peek(o).color);return r},forcebw:function(){var e=this.vboxes;e.sort(function(e,t){return x.naturalOrder(x.sum(e.color),x.sum(t.color))});var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var i=e.length-1,r=e[i].color;251<r[0]&&251<r[1]&&251<r[2]&&(e[i].color=[255,255,255])}},{quantize:function(e,t){function i(e,t){for(var i,r=1,n=0;n<1e3;)if((i=e.pop()).count()){var o=F(c,i),s=o[0],a=o[1];if(!s)return;if(e.push(s),a&&(e.push(a),r++),t<=r)return;if(1e3<n++)return}else e.push(i),n++}if(!e.length||t<2||256<t)return!1;var r,n,o,s,a,h,c=(r=e,h=new Array(1<<3*I),r.forEach(function(e){o=e[0]>>R,s=e[1]>>R,a=e[2]>>R,n=b(o,s,a),h[n]=(h[n]||0)+1}),h);c.forEach(function(){});var u,l,g,f,d,p,v,m,y,S,w=(u=c,y=v=d=1e6,S=m=p=0,e.forEach(function(e){l=e[0]>>R,g=e[1]>>R,f=e[2]>>R,l<d?d=l:p<l&&(p=l),g<v?v=g:m<g&&(m=g),f<y?y=f:S<f&&(S=f)}),new P(d,p,v,m,y,S,u)),_=new D(function(e,t){return x.naturalOrder(e.count(),t.count())});_.push(w),i(_,.75*t);for(var C=new D(function(e,t){return x.naturalOrder(e.count()*e.volume(),t.count()*t.volume())});_.size();)C.push(_.pop());i(C,t-C.size());for(var z=new M;C.size();)z.push(C.pop());return z}});function b(e,t,i){return(e<<2*I)+(t<<I)+i}function D(e){function t(){i.sort(e),r=!0}var i=[],r=!1;return{push:function(e){i.push(e),r=!1},peek:function(e){return r||t(),void 0===e&&(e=i.length-1),i[e]},pop:function(){return r||t(),i.pop()},size:function(){return i.length},map:function(e){return i.map(e)},debug:function(){return r||t(),i}}}function P(e,t,i,r,n,o,s){var a=this;a.r1=e,a.r2=t,a.g1=i,a.g2=r,a.b1=n,a.b2=o,a.histo=s}function M(){this.vboxes=new D(function(e,t){return x.naturalOrder(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function F(e,c){function t(e){var t,i,r,n,o,s=e+"1",a=e+"2",h=0;for(u=c[s];u<=c[a];u++)if(g[u]>l/2){for(r=c.copy(),n=c.copy(),o=(t=u-c[s])<=(i=c[a]-u)?Math.min(c[a]-1,~~(u+i/2)):Math.max(c[s],~~(u-1-t/2));!g[o];)o++;for(h=f[o];!h&&g[o-1];)h=f[--o];return r[a]=o,n[s]=r[a]+1,[r,n]}}if(c.count()){var i=c.r2-c.r1+1,r=c.g2-c.g1+1,n=c.b2-c.b1+1,o=x.max([i,r,n]);if(1==c.count())return[c.copy()];var u,s,a,h,l=0,g=[],f=[];if(o==i)for(u=c.r1;u<=c.r2;u++){for(h=0,s=c.g1;s<=c.g2;s++)for(a=c.b1;a<=c.b2;a++)h+=e[b(u,s,a)]||0;l+=h,g[u]=l}else if(o==r)for(u=c.g1;u<=c.g2;u++){for(h=0,s=c.r1;s<=c.r2;s++)for(a=c.b1;a<=c.b2;a++)h+=e[b(s,u,a)]||0;l+=h,g[u]=l}else for(u=c.b1;u<=c.b2;u++){for(h=0,s=c.r1;s<=c.r2;s++)for(a=c.g1;a<=c.g2;a++)h+=e[b(s,a,u)]||0;l+=h,g[u]=l}return g.forEach(function(e,t){f[t]=l-e}),t(o==i?"r":o==r?"g":"b")}}"function"==typeof define&&define.amd?define([],function(){return e}):"object"==typeof exports?module.exports=e:this.ColorThief=e}.call(this),function(){function o(e){return e.exifdata}function i(r,n){function t(e){var t=h(e),i=function(e){var t=new DataView(e);if(g&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return g&&console.log("Not a valid JPEG"),!1;for(var i=2,r=e.byteLength;i<r;){if(h=i,56===(a=t).getUint8(h)&&66===a.getUint8(h+1)&&73===a.getUint8(h+2)&&77===a.getUint8(h+3)&&4===a.getUint8(h+4)&&4===a.getUint8(h+5)){var n=t.getUint8(i+7);n%2!=0&&(n+=1),0===n&&(n=4);var o=i+8+n,s=t.getUint16(i+6+n);return c(e,o,s)}i++}var a,h}(e);r.exifdata=t||{},r.iptcdata=i||{},n&&n.call(r)}if(r.src)if(/^data\:/i.test(r.src)){t(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),r=i.length,n=new ArrayBuffer(r),o=new Uint8Array(n),s=0;s<r;s++)o[s]=i.charCodeAt(s);return n}(r.src))}else if(/^blob\:/i.test(r.src)){(i=new FileReader).onload=function(e){t(e.target.result)},o=r.src,s=function(e){i.readAsArrayBuffer(e)},(a=new XMLHttpRequest).open("GET",o,!0),a.responseType="blob",a.onload=function(){200!=this.status&&0!==this.status||s(this.response)},a.send()}else{var e=new XMLHttpRequest;e.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";t(e.response),e=null},e.open("GET",r.src,!0),e.responseType="arraybuffer",e.send(null)}else if(window.FileReader&&(r instanceof window.Blob||r instanceof window.File)){var i;(i=new FileReader).onload=function(e){g&&console.log("Got file of length "+e.target.result.byteLength),t(e.target.result)},i.readAsArrayBuffer(r)}var o,s,a}function h(e){var t=new DataView(e);if(g&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return g&&console.log("Not a valid JPEG"),!1;for(var i,r=2,n=e.byteLength;r<n;){if(255!=t.getUint8(r))return g&&console.log("Not a valid marker at offset "+r+", found: "+t.getUint8(r)),!1;if(i=t.getUint8(r+1),g&&console.log(i),225==i)return g&&console.log("Found 0xFFE1 marker"),s(t,r+4,t.getUint16(r+2));r+=2+t.getUint16(r+2)}}function c(e,t,i){for(var r,n,o,s,a=new DataView(e),h={},c=t;c<t+i;)28===a.getUint8(c)&&2===a.getUint8(c+1)&&((s=a.getUint8(c+2))in y&&(o=a.getInt16(c+3),n=y[s],r=d(a,c+5,o),h.hasOwnProperty(n)?h[n]instanceof Array?h[n].push(r):h[n]=[h[n],r]:h[n]=r)),c++;return h}function u(e,t,i,r,n){var o,s,a,h=e.getUint16(i,!n),c={};for(a=0;a<h;a++)o=i+12*a+2,!(s=r[e.getUint16(o,!n)])&&g&&console.log("Unknown tag: "+e.getUint16(o,!n)),c[s]=l(e,o,t,0,n);return c}function l(e,t,i,r,n){var o,s,a,h,c,u,l=e.getUint16(t+2,!n),g=e.getUint32(t+4,!n),f=e.getUint32(t+8,!n)+i;switch(l){case 1:case 7:if(1==g)return e.getUint8(t+8,!n);for(o=4<g?f:t+8,s=[],h=0;h<g;h++)s[h]=e.getUint8(o+h);return s;case 2:return d(e,o=4<g?f:t+8,g-1);case 3:if(1==g)return e.getUint16(t+8,!n);for(o=2<g?f:t+8,s=[],h=0;h<g;h++)s[h]=e.getUint16(o+2*h,!n);return s;case 4:if(1==g)return e.getUint32(t+8,!n);for(s=[],h=0;h<g;h++)s[h]=e.getUint32(f+4*h,!n);return s;case 5:if(1==g)return c=e.getUint32(f,!n),u=e.getUint32(f+4,!n),(a=new Number(c/u)).numerator=c,a.denominator=u,a;for(s=[],h=0;h<g;h++)c=e.getUint32(f+8*h,!n),u=e.getUint32(f+4+8*h,!n),s[h]=new Number(c/u),s[h].numerator=c,s[h].denominator=u;return s;case 9:if(1==g)return e.getInt32(t+8,!n);for(s=[],h=0;h<g;h++)s[h]=e.getInt32(f+4*h,!n);return s;case 10:if(1==g)return e.getInt32(f,!n)/e.getInt32(f+4,!n);for(s=[],h=0;h<g;h++)s[h]=e.getInt32(f+8*h,!n)/e.getInt32(f+4+8*h,!n);return s}}function d(e,t,i){var r="";for(n=t;t+i>n;n++)r+=String.fromCharCode(e.getUint8(n));return r}function s(e,t){if("Exif"!=d(e,t,4))return g&&console.log("Not valid EXIF data! "+d(e,t,4)),!1;var i,r,n,o,s,a=t+6;if(18761==e.getUint16(a))i=!1;else{if(19789!=e.getUint16(a))return g&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=e.getUint16(a+2,!i))return g&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=e.getUint32(a+4,!i);if(h<8)return g&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(a+4,!i)),!1;if((r=u(e,a,a+h,p,i)).ExifIFDPointer)for(n in o=u(e,a,a+r.ExifIFDPointer,f,i)){switch(n){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[n]=m[n][o[n]];break;case"ExifVersion":case"FlashpixVersion":o[n]=String.fromCharCode(o[n][0],o[n][1],o[n][2],o[n][3]);break;case"ComponentsConfiguration":o[n]=m.Components[o[n][0]]+m.Components[o[n][1]]+m.Components[o[n][2]]+m.Components[o[n][3]]}r[n]=o[n]}if(r.GPSInfoIFDPointer)for(n in s=u(e,a,a+r.GPSInfoIFDPointer,v,i)){switch(n){case"GPSVersionID":s[n]=s[n][0]+"."+s[n][1]+"."+s[n][2]+"."+s[n][3]}r[n]=s[n]}return r}var g=!1,t=function(e){return e instanceof t?e:this instanceof t?void(this.EXIFwrapped=e):new t(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.EXIF=t):this.EXIF=t;var f=t.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},p=t.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=t.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},m=t.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},y={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};t.getData=function(e,t){return!((e instanceof Image||e instanceof HTMLImageElement)&&!e.complete)&&(o(e)?t&&t.call(e):i(e,t),!0)},t.getTag=function(e,t){return o(e)?e.exifdata[t]:void 0},t.getAllTags=function(e){if(!o(e))return{};var t,i=e.exifdata,r={};for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t]);return r},t.pretty=function(e){if(!o(e))return"";var t,i=e.exifdata,r="";for(t in i)i.hasOwnProperty(t)&&(r+="object"==typeof i[t]?i[t]instanceof Number?t+" : "+i[t]+" ["+i[t].numerator+"/"+i[t].denominator+"]\r\n":t+" : ["+i[t].length+" values]\r\n":t+" : "+i[t]+"\r\n");return r},t.readFromBinaryFile=function(e){return h(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return t})}.call(this),function(){function y(e,t,i,r){var n=e.naturalWidth,o=e.naturalHeight;if(n+o!==!1){var s=i.width,a=i.height,h=t.getContext("2d");h.save(),function(e,t,i,r,n){switch(n){case 5:case 6:case 7:case 8:e.width=r,e.height=i;break;default:e.width=i,e.height=r}switch(n){case 2:t.translate(i,0),t.scale(-1,1);break;case 3:t.translate(i,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(i,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-i,0)}}(t,h,s,a,i.orientation),function(e){var t=e.naturalWidth;if(1048576<t*e.naturalHeight){var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}(e)&&(n/=2,o/=2);var c=1024,u=document.createElement("canvas");u.width=u.height=c;for(var l=u.getContext("2d"),g=r?function(e,t){var i=document.createElement("canvas");i.width=1,i.height=t;var r=i.getContext("2d");r.drawImage(e,0,0);for(var n=r.getImageData(0,0,1,t).data,o=0,s=t,a=t;o<a;){0===n[4*(a-1)+3]?s=a:o=a,a=s+o>>1}var h=a/t;return 0==h?1:h}(e,o):1,f=Math.ceil(c*s/n),d=Math.ceil(c*a/o/g),p=0,v=0;p<o;){for(var m=0,y=0;m<n;)l.clearRect(0,0,c,c),l.drawImage(e,-m,-p),h.drawImage(u,0,0,c,c,y,v,f,d),m+=c,y+=f;p+=c,v+=d}h.restore(),u=l=null}}function e(e){if(window.Blob&&e instanceof Blob){if(!S)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=S.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=e.onerror=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,i=e.length;t<i;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}var S=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;e.prototype.render=function(e,t,i){if(this.imageLoadListeners){var r=this;this.imageLoadListeners.push(function(){r.render(e,t,i)})}else{t=t||{};var n=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,s=t.width,a=t.height,h=t.maxWidth,c=t.maxHeight,u=!this.blob||"image/jpeg"===this.blob.type;s&&!a?a=o*s/n<<0:a&&!s?s=n*a/o<<0:(s=n,a=o),h&&h<s&&(a=o*(s=h)/n<<0),c&&c<a&&(s=n*(a=c)/o<<0);var l={width:s,height:a};for(var g in t)l[g]=t[g];var f,d,p,v,m=e.tagName.toLowerCase();"img"===m?e.src=(f=this.srcImage,d=l,p=u,v=document.createElement("canvas"),y(f,v,d,p),v.toDataURL("image/jpeg",d.quality||.8)):"canvas"===m&&y(this.srcImage,e,l,u),"function"==typeof this.onrender&&this.onrender(e),i&&i(),this.blob&&(this.blob=null,S.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return e}):"object"==typeof exports?module.exports=e:this.MegaPixImage=e}();