function pkcs1unpad2(t,e){for(var r=t.toByteArray(),i=0;i<r.length&&0==r[i];)++i;if(r.length-i!=e-1||2!=r[i])return null;for(++i;0!=r[i];)if(++i>=r.length)return null;for(var n="";++i<r.length;){var s=255&r[i];s<128?n+=String.fromCharCode(s):191<s&&s<224?(n+=String.fromCharCode((31&s)<<6|63&r[i+1]),++i):(n+=String.fromCharCode((15&s)<<12|(63&r[i+1])<<6|63&r[i+2]),i+=2)}return n}function oaep_mgf1_str(t,e,r){for(var i="",n=0;i.length<e;)i+=r(t+String.fromCharCode.apply(String,[(4278190080&n)>>24,(16711680&n)>>16,(65280&n)>>8,255&n])),n+=1;return i}function oaep_unpad(t,e,r,i){var n=KJUR.crypto.MessageDigest,s=KJUR.crypto.Util,h=null;for("string"==typeof(r=r||"sha1")&&(h=n.getCanonicalAlgName(r),i=n.getHashLength(h),r=function(t){return hextorstr(s.hashHex(rstrtohex(t),h))}),t=t.toByteArray(),o=0;o<t.length;o+=1)t[o]&=255;for(;t.length<e;)t.unshift(0);if((t=String.fromCharCode.apply(String,t)).length<2*i+2)throw"Cipher too short";var o,a=t.substr(1,i),p=t.substr(i+1),g=oaep_mgf1_str(p,i,r),l=[];for(o=0;o<a.length;o+=1)l[o]=a.charCodeAt(o)^g.charCodeAt(o);var f=oaep_mgf1_str(String.fromCharCode.apply(String,l),t.length-i,r),u=[];for(o=0;o<p.length;o+=1)u[o]=p.charCodeAt(o)^f.charCodeAt(o);if((u=String.fromCharCode.apply(String,u)).substr(0,i)!==r(""))throw"Hash mismatch";var d=(u=u.substr(i)).indexOf("");if((-1!=d?u.substr(0,d).lastIndexOf("\0"):-1)+1!=d)throw"Malformed data";return u.substr(d+1)}function RSASetPrivate(t,e,r){if(this.isPrivate=!0,"string"!=typeof t)this.n=t,this.e=e,this.d=r;else{if(!(null!=t&&null!=e&&0<t.length&&0<e.length))throw"Invalid RSA private key";this.n=parseBigInt(t,16),this.e=parseInt(e,16),this.d=parseBigInt(r,16)}}function RSASetPrivateEx(t,e,r,i,n,s,h,o){if(this.isPrivate=!0,this.isPublic=!1,null==t)throw"RSASetPrivateEx N == null";if(null==e)throw"RSASetPrivateEx E == null";if(0==t.length)throw"RSASetPrivateEx N.length == 0";if(0==e.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=t&&null!=e&&0<t.length&&0<e.length))throw"Invalid RSA private key in RSASetPrivateEx";this.n=parseBigInt(t,16),this.e=parseInt(e,16),this.d=parseBigInt(r,16),this.p=parseBigInt(i,16),this.q=parseBigInt(n,16),this.dmp1=parseBigInt(s,16),this.dmq1=parseBigInt(h,16),this.coeff=parseBigInt(o,16)}function RSAGenerate(t,e){var r=new SecureRandom,i=t>>1;this.e=parseInt(e,16);for(var n=new BigInteger(e,16);;){for(;this.p=new BigInteger(t-i,1,r),0!=this.p.subtract(BigInteger.ONE).gcd(n).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(i,1,r),0!=this.q.subtract(BigInteger.ONE).gcd(n).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var h=this.p.subtract(BigInteger.ONE),o=this.q.subtract(BigInteger.ONE),a=h.multiply(o);if(0==a.gcd(n).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(a),this.dmp1=this.d.mod(h),this.dmq1=this.d.mod(o),this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=!0}function RSADoPrivate(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),r=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(r)<0;)e=e.add(this.p);return e.subtract(r).multiply(this.coeff).mod(this.p).multiply(this.q).add(r)}function RSADecrypt(t){var e=parseBigInt(t,16),r=this.doPrivate(e);return null==r?null:pkcs1unpad2(r,this.n.bitLength()+7>>3)}function RSADecryptOAEP(t,e,r){var i=parseBigInt(t,16),n=this.doPrivate(i);return null==n?null:oaep_unpad(n,this.n.bitLength()+7>>3,e,r)}RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP;