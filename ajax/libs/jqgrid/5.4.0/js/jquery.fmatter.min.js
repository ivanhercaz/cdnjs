!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(g){"use strict";g.fmatter={},g.extend(g.fmatter,{isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e&&("object"==typeof e||g.isFunction(e))||!1},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isValue:function(e){return this.isObject(e)||this.isString(e)||this.isNumber(e)||this.isBoolean(e)},isEmpty:function(e){return!(!this.isString(e)&&this.isValue(e))&&(!this.isValue(e)||""===(e=g.trim(e).replace(/\&nbsp\;/gi,"").replace(/\&#160\;/gi,"")))}}),g.fn.fmatter=function(e,t,i,r,o){var n=t;i=g.extend({},g.jgrid.getRegional(this,"formatter"),i);try{n=g.fn.fmatter[e].call(this,t,i,r,o)}catch(e){}return n},g.fmatter.util={NumberFormat:function(e,t){if(g.fmatter.isNumber(e)||(e*=1),g.fmatter.isNumber(e)){var i,r=e<0,o=String(e),n=t.decimalSeparator||".";if(g.fmatter.isNumber(t.decimalPlaces)){var a=t.decimalPlaces;if(i=(o=String(Number(Math.round(e+"e"+a)+"e-"+a))).lastIndexOf("."),0<a)for(i<0?i=(o+=n).length-1:"."!==n&&(o=o.replace(".",n));o.length-1-i<a;)o+="0"}if(t.thousandsSeparator){var l=t.thousandsSeparator;i=-1<(i=o.lastIndexOf(n))?i:o.length;var d,s=o.substring(i),f=-1;for(d=i;0<d;d--)++f%3==0&&d!==i&&(!r||1<d)&&(s=l+s),s=o.charAt(d-1)+s;o=s}return o=t.prefix?t.prefix+o:o,o=t.suffix?o+t.suffix:o}return e}},g.fn.fmatter.defaultFormat=function(e,t){return g.fmatter.isValue(e)&&""!==e?e:t.defaultValue||"&#160;"},g.fn.fmatter.email=function(e,t){return g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):'<a href="mailto:'+e+'">'+e+"</a>"},g.fn.fmatter.checkbox=function(e,t){var i,r=g.extend({},t.checkbox);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(r=g.extend({},r,t.colModel.formatoptions)),i=!0===r.disabled?'disabled="disabled"':"",!g.fmatter.isEmpty(e)&&void 0!==e||(e=g.fn.fmatter.defaultFormat(e,r)),'<input type="checkbox" '+((e=((e=String(e))+"").toLowerCase()).search(/(false|f|0|no|n|off|undefined)/i)<0?" checked='checked' ":"")+' value="'+e+'" offval="no" '+i+"/>"},g.fn.fmatter.link=function(e,t){var i={target:t.target},r="";return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),i.target&&(r="target="+i.target),g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):"<a "+r+' href="'+e+'">'+e+"</a>"},g.fn.fmatter.showlink=function(e,t){var i,r={baseLinkUrl:t.baseLinkUrl,showAction:t.showAction,addParam:t.addParam||"",target:t.target,idName:t.idName},o="";return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(r=g.extend({},r,t.colModel.formatoptions)),r.target&&(o="target="+r.target),i=r.baseLinkUrl+r.showAction+"?"+r.idName+"="+t.rowId+r.addParam,g.fmatter.isString(e)||g.fmatter.isNumber(e)?"<a "+o+' href="'+i+'">'+e+"</a>":g.fn.fmatter.defaultFormat(e,t)},g.fn.fmatter.integer=function(e,t){var i=g.extend({},t.integer);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),g.fmatter.isEmpty(e)?i.defaultValue:g.fmatter.util.NumberFormat(e,i)},g.fn.fmatter.number=function(e,t){var i=g.extend({},t.number);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),g.fmatter.isEmpty(e)?i.defaultValue:g.fmatter.util.NumberFormat(e,i)},g.fn.fmatter.currency=function(e,t){var i=g.extend({},t.currency);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(i=g.extend({},i,t.colModel.formatoptions)),g.fmatter.isEmpty(e)?i.defaultValue:g.fmatter.util.NumberFormat(e,i)},g.fn.fmatter.date=function(e,t,i,r){var o=g.extend({},t.date);return void 0!==t.colModel&&void 0!==t.colModel.formatoptions&&(o=g.extend({},o,t.colModel.formatoptions)),o.reformatAfterEdit||"edit"!==r?g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):g.jgrid.parseDate.call(this,o.srcformat,e,o.newformat,o):g.fn.fmatter.defaultFormat(e,t)},g.fn.fmatter.select=function(e,t){e=String(e);var i,r,o=!1,n=[];if(void 0!==t.colModel.formatoptions?(o=t.colModel.formatoptions.value,i=void 0===t.colModel.formatoptions.separator?":":t.colModel.formatoptions.separator,r=void 0===t.colModel.formatoptions.delimiter?";":t.colModel.formatoptions.delimiter):void 0!==t.colModel.editoptions&&(o=t.colModel.editoptions.value,i=void 0===t.colModel.editoptions.separator?":":t.colModel.editoptions.separator,r=void 0===t.colModel.editoptions.delimiter?";":t.colModel.editoptions.delimiter),o){var a,l=!0==(null!=t.colModel.editoptions&&!0===t.colModel.editoptions.multiple),d=[];if(l&&(d=e.split(","),d=g.map(d,function(e){return g.trim(e)})),g.fmatter.isString(o)){var s,f=o.split(r),c=0;for(s=0;s<f.length;s++)if(2<(a=f[s].split(i)).length&&(a[1]=g.map(a,function(e,t){if(0<t)return e}).join(i)),l)-1<g.inArray(a[0],d)&&(n[c]=a[1],c++);else if(g.trim(a[0])===g.trim(e)){n[0]=a[1];break}}else g.fmatter.isObject(o)&&(l?n=g.map(d,function(e){return o[e]}):n[0]=o[e]||"")}return""===(e=n.join(", "))?g.fn.fmatter.defaultFormat(e,t):e},g.fn.fmatter.rowactions=function(e){function t(e){g.isFunction(f.afterRestore)&&f.afterRestore.call(a,e),s.find("div.ui-inline-edit,div.ui-inline-del").show(),s.find("div.ui-inline-save,div.ui-inline-cancel").hide()}var i=g(this).closest("tr.jqgrow"),r=i.attr("id"),o=g(this).closest("table.ui-jqgrid-btable").attr("id").replace(/_frozen([^_]*)$/,"$1"),n=g("#"+o),a=n[0],l=a.p,d=l.colModel[g.jgrid.getCellIndex(this)],s=d.frozen?g("tr#"+r+" td:eq("+g.jgrid.getCellIndex(this)+") > div",n):g(this).parent(),f={extraparam:{}};if(void 0!==d.formatoptions){var c=g.extend(!0,{},d.formatoptions);f=g.extend(f,c)}void 0!==l.editOptions&&(f.editOptions=l.editOptions),void 0!==l.delOptions&&(f.delOptions=l.delOptions),i.hasClass("jqgrid-new-row")&&(f.extraparam[l.prmNames.oper]=l.prmNames.addoper);var u={keys:f.keys,oneditfunc:f.onEdit,successfunc:f.onSuccess,url:f.url,extraparam:f.extraparam,aftersavefunc:function(e,t){g.isFunction(f.afterSave)&&f.afterSave.call(a,e,t),s.find("div.ui-inline-edit,div.ui-inline-del").show(),s.find("div.ui-inline-save,div.ui-inline-cancel").hide()},errorfunc:f.onError,afterrestorefunc:t,restoreAfterError:f.restoreAfterError,mtype:f.mtype};switch(e){case"edit":n.jqGrid("editRow",r,u),s.find("div.ui-inline-edit,div.ui-inline-del").hide(),s.find("div.ui-inline-save,div.ui-inline-cancel").show(),n.triggerHandler("jqGridAfterGridComplete");break;case"save":n.jqGrid("saveRow",r,u)&&(s.find("div.ui-inline-edit,div.ui-inline-del").show(),s.find("div.ui-inline-save,div.ui-inline-cancel").hide(),n.triggerHandler("jqGridAfterGridComplete"));break;case"cancel":n.jqGrid("restoreRow",r,t),s.find("div.ui-inline-edit,div.ui-inline-del").show(),s.find("div.ui-inline-save,div.ui-inline-cancel").hide(),n.triggerHandler("jqGridAfterGridComplete");break;case"del":n.jqGrid("delGridRow",r,f.delOptions);break;case"formedit":n.jqGrid("setSelection",r),n.jqGrid("editGridRow",r,f.editOptions)}},g.fn.fmatter.actions=function(e,t){var i,r={keys:!1,editbutton:!0,delbutton:!0,editformbutton:!1},o=t.rowId,n="",a=g.jgrid.getRegional(this,"nav"),l=g.jgrid.styleUI[t.styleUI||"jQueryUI"].fmatter,d=g.jgrid.styleUI[t.styleUI||"jQueryUI"].common;if(void 0!==t.colModel.formatoptions&&(r=g.extend(r,t.colModel.formatoptions)),void 0===o||g.fmatter.isEmpty(o))return"";var s="onmouseover=jQuery(this).addClass('"+d.hover+"'); onmouseout=jQuery(this).removeClass('"+d.hover+"');  ";return r.editformbutton?(i="id='jEditButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'formedit'); "+s,n+="<div title='"+a.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+i+"><span class='"+d.icon_base+" "+l.icon_edit+"'></span></div>"):r.editbutton&&(i="id='jEditButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'edit'); "+s,n+="<div title='"+a.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+i+"><span class='"+d.icon_base+" "+l.icon_edit+"'></span></div>"),r.delbutton&&(i="id='jDeleteButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'del'); "+s,n+="<div title='"+a.deltitle+"' style='float:left;' class='ui-pg-div ui-inline-del' "+i+"><span class='"+d.icon_base+" "+l.icon_del+"'></span></div>"),i="id='jSaveButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'save'); "+s,n+="<div title='"+a.savetitle+"' style='float:left;display:none' class='ui-pg-div ui-inline-save' "+i+"><span class='"+d.icon_base+" "+l.icon_save+"'></span></div>",i="id='jCancelButton_"+o+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'cancel'); "+s,"<div style='margin-left:8px;'>"+(n+="<div title='"+a.canceltitle+"' style='float:left;display:none;' class='ui-pg-div ui-inline-cancel' "+i+"><span class='"+d.icon_base+" "+l.icon_cancel+"'></span></div>")+"</div>"},g.unformat=function(e,t,i,r){var o,n,a=t.colModel.formatter,l=t.colModel.formatoptions||{},d=/([\.\*\_\'\(\)\{\}\+\?\\])/g,s=t.colModel.unformat||g.fn.fmatter[a]&&g.fn.fmatter[a].unformat;if(void 0!==s&&g.isFunction(s))o=s.call(this,g(e).text(),t,e);else if(void 0!==a&&g.fmatter.isString(a)){var f,c=g.jgrid.getRegional(this,"formatter")||{};switch(a){case"integer":n=(l=g.extend({},c.integer,l)).thousandsSeparator.replace(d,"\\$1"),f=new RegExp(n,"g"),o=g(e).text().replace(f,"");break;case"number":n=(l=g.extend({},c.number,l)).thousandsSeparator.replace(d,"\\$1"),f=new RegExp(n,"g"),o=g(e).text().replace(f,"").replace(l.decimalSeparator,".");break;case"currency":n=(l=g.extend({},c.currency,l)).thousandsSeparator.replace(d,"\\$1"),f=new RegExp(n,"g"),o=g(e).text(),l.prefix&&l.prefix.length&&(o=o.substr(l.prefix.length)),l.suffix&&l.suffix.length&&(o=o.substr(0,o.length-l.suffix.length)),o=o.replace(f,"").replace(l.decimalSeparator,".");break;case"checkbox":var u=t.colModel.editoptions?t.colModel.editoptions.value.split(":"):["Yes","No"];o=g("input",e).is(":checked")?u[0]:u[1];break;case"select":o=g.unformat.select(e,t,i,r);break;case"actions":return"";default:o=g(e).text()}}return void 0!==o?o:!0===r?g(e).text():g.jgrid.htmlDecode(g(e).html())},g.unformat.select=function(e,t,i,r){var o=[],n=g(e).text();if(!0===r)return n;var a=g.extend({},void 0!==t.colModel.formatoptions?t.colModel.formatoptions:t.colModel.editoptions),l=void 0===a.separator?":":a.separator,d=void 0===a.delimiter?";":a.delimiter;if(a.value){var s,f=a.value,c=!0===a.multiple,u=[];if(c&&(u=n.split(","),u=g.map(u,function(e){return g.trim(e)})),g.fmatter.isString(f)){var m,p=f.split(d),v=0;for(m=0;m<p.length;m++)if(2<(s=p[m].split(l)).length&&(s[1]=g.map(s,function(e,t){if(0<t)return e}).join(l)),a.decodeValue&&!0===a.decodeValue&&(s[1]=g.jgrid.htmlDecode(s[1])),c)-1<g.inArray(g.trim(s[1]),u)&&(o[v]=s[0],v++);else if(g.trim(s[1])===g.trim(n)){o[0]=s[0];break}}else(g.fmatter.isObject(f)||g.isArray(f))&&(c||(u[0]=n),o=g.map(u,function(i){var r;if(g.each(f,function(e,t){if(t===i)return r=e,!1}),void 0!==r)return r}));return o.join(", ")}return n||""},g.unformat.date=function(e,t){var i=g.jgrid.getRegional(this,"formatter.date")||{};return void 0!==t.formatoptions&&(i=g.extend({},i,t.formatoptions)),g.fmatter.isEmpty(e)?g.fn.fmatter.defaultFormat(e,t):g.jgrid.parseDate.call(this,i.newformat,e,i.srcformat,i)}});