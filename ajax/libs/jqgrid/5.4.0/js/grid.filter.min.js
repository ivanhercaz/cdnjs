!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],e):e(jQuery)}(function(_){"use strict";_.fn.jqFilter=function(e){if("string"==typeof e){var t=_.fn.jqFilter[e];if(!t)throw"jqFilter - No such method: "+e;var r=_.makeArray(arguments).slice(1);return t.apply(this,r)}var I=_.extend(!0,{filter:null,columns:[],sortStrategy:null,onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,uniqueSearchFields:!1,direction:"ltr",addsubgrup:"Add subgroup",addrule:"Add rule",delgroup:"Delete group",delrule:"Delete rule",autoencode:!1},_.jgrid.filter,e||{});return this.each(function(){if(!this.filter){this.p=I,null!==this.p.filter&&void 0!==this.p.filter||(this.p.filter={groupOp:this.p.groupOps[0].op,rules:[],groups:[]}),null!=this.p.sortStrategy&&_.isFunction(this.p.sortStrategy)&&this.p.columns.sort(this.p.sortStrategy);var e,t,r=this.p.columns.length,x=/msie/i.test(navigator.userAgent)&&!window.opera;if(this.p.initFilter=_.extend(!0,{},this.p.filter),r){for(e=0;e<r;e++)(t=this.p.columns[e]).stype?t.inputtype=t.stype:t.inputtype||(t.inputtype="text"),t.sorttype?t.searchtype=t.sorttype:t.searchtype||(t.searchtype="string"),void 0===t.hidden&&(t.hidden=!1),t.label||(t.label=t.name),t.index&&(t.name=t.index),t.hasOwnProperty("searchoptions")||(t.searchoptions={}),t.hasOwnProperty("searchrules")||(t.searchrules={}),void 0===t.search?t.inlist=!0:t.inlist=t.search;var q=function(){return _("#"+_.jgrid.jqID(I.id))[0]||null},a=q(),D=_.jgrid.styleUI[a.p.styleUI||"jQueryUI"].filter,w=_.jgrid.styleUI[a.p.styleUI||"jQueryUI"].common;this.p.showQuery&&_(this).append("<table class='queryresult "+D.table_widget+"' style='display:block;max-width:440px;border:0px none;' dir='"+this.p.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var o=function(e,t){var r=[!0,""],a=q();if(_.isFunction(t.searchrules))r=t.searchrules.call(a,e,t);else if(_.jgrid&&_.jgrid.checkValues)try{r=_.jgrid.checkValues.call(a,e,-1,t.searchrules,t.label)}catch(e){}r&&r.length&&!1===r[0]&&(I.error=!r[0],I.errmsg=r[1])};this.onchange=function(){return this.p.error=!1,this.p.errmsg="",!!_.isFunction(this.p.onChange)&&this.p.onChange.call(this,this.p)},this.reDraw=function(){_("table.group:first",this).remove();var e=this.createTableForGroup(I.filter,null);_(this).append(e),_.isFunction(this.p.afterRedraw)&&this.p.afterRedraw.call(this,this.p)},this.createTableForGroup=function(a,e){var s,i=this,t=_("<table class='group "+D.table_widget+" ui-search-table' style='border:0px none;'><tbody></tbody></table>"),r="left";"rtl"===this.p.direction&&(r="right",t.attr("dir","rtl")),null===e&&t.append("<tr class='error' style='display:none;'><th colspan='5' class='"+w.error+"' align='"+r+"'></th></tr>");var o=_("<tr></tr>");t.append(o);var l=_("<th colspan='5' align='"+r+"'></th>");if(o.append(l),!0===this.p.ruleButtons){var n=_("<select size='1' class='opsel "+D.srSelect+"'></select>");l.append(n);var p,c="";for(s=0;s<I.groupOps.length;s++)p=a.groupOp===i.p.groupOps[s].op?" selected='selected'":"",c+="<option value='"+i.p.groupOps[s].op+"'"+p+">"+i.p.groupOps[s].text+"</option>";n.append(c).on("change",function(){a.groupOp=_(n).val(),i.onchange()})}var u="<span></span>";if(this.p.groupButton&&(u=_("<input type='button' value='+ {}' title='"+i.p.subgroup+"' class='add-group "+w.button+"'/>")).on("click",function(){return void 0===a.groups&&(a.groups=[]),a.groups.push({groupOp:I.groupOps[0].op,rules:[],groups:[]}),i.reDraw(),i.onchange(),!1}),l.append(u),!0===this.p.ruleButtons){var d,h=_("<input type='button' value='+' title='"+i.p.addrule+"' class='add-rule ui-add "+w.button+"'/>");h.on("click",function(){for(void 0===a.rules&&(a.rules=[]),s=0;s<i.p.columns.length;s++){var e=void 0===i.p.columns[s].search||i.p.columns[s].search,t=!0===i.p.columns[s].hidden;if(!0===i.p.columns[s].searchoptions.searchhidden&&e||e&&!t){d=i.p.columns[s];break}}return d&&(r=d.searchoptions.sopt?d.searchoptions.sopt:i.p.sopt?i.p.sopt:-1!==_.inArray(d.searchtype,i.p.strarr)?i.p.stropts:i.p.numopts,a.rules.push({field:d.name,op:r[0],data:""}),i.reDraw()),!1;var r}),l.append(h)}if(null!==e){var f=_("<input type='button' value='-' title='"+i.p.delgroup+"' class='delete-group "+w.button+"'/>");l.append(f),f.on("click",function(){for(s=0;s<e.groups.length;s++)if(e.groups[s]===a){e.groups.splice(s,1);break}return i.reDraw(),i.onchange(),!1})}if(void 0!==a.groups)for(s=0;s<a.groups.length;s++){var g=_("<tr></tr>");t.append(g);var m=_("<td class='first'></td>");g.append(m);var v=_("<td colspan='4'></td>");v.append(this.createTableForGroup(a.groups[s],a)),g.append(v)}void 0===a.groupOp&&(a.groupOp=i.p.groupOps[0].op);var y,b=i.p.ruleButtons&&i.p.uniqueSearchFields;if(b)for(y=0;y<i.p.columns.length;y++)i.p.columns[y].inlist&&(i.p.columns[y].search=!0);if(void 0!==a.rules)for(s=0;s<a.rules.length;s++)if(t.append(this.createTableRowForRule(a.rules[s],a)),b){var j=a.rules[s].field;for(y=0;y<i.p.columns.length;y++)if(j===i.p.columns[y].name){i.p.columns[y].search=!1;break}}return t},this.createTableRowForRule=function(o,e){var l,n,p,c,t,u=this,d=q(),r=_("<tr></tr>"),a="";r.append("<td class='first'></td>");var s=_("<td class='columns'></td>");r.append(s);var h,f=_("<select size='1' class='"+D.srSelect+"'></select>"),g=[];s.append(f),f.on("change",function(){if(u.p.ruleButtons&&u.p.uniqueSearchFields){var e=parseInt(_(this).data("curr"),10),t=this.selectedIndex;0<=e&&(u.p.columns[e].search=!0,_(this).data("curr",t),u.p.columns[t].search=!1)}for(o.field=_(f).val(),p=_(this).parents("tr:first"),_(".data",p).empty(),l=0;l<u.p.columns.length;l++)if(u.p.columns[l].name===o.field){c=u.p.columns[l];break}if(c){c.searchoptions.id=_.jgrid.randId(),c.searchoptions.name=o.field,c.searchoptions.oper="filter",x&&"text"===c.inputtype&&(c.searchoptions.size||(c.searchoptions.size=10));var r=_.jgrid.createEl.call(d,c.inputtype,c.searchoptions,"",!0,u.p.ajaxSelectOptions||{},!0);_(r).addClass("input-elm "+D.srInput),n=c.searchoptions.sopt?c.searchoptions.sopt:u.p.sopt?u.p.sopt:-1!==_.inArray(c.searchtype,u.p.strarr)?u.p.stropts:u.p.numopts;var a="",s=0;for(g=[],_.each(u.p.ops,function(){g.push(this.oper)}),l=0;l<n.length;l++)-1!==(h=_.inArray(n[l],g))&&(0===s&&(o.op=u.p.ops[h].oper),a+="<option value='"+u.p.ops[h].oper+"'>"+u.p.ops[h].text+"</option>",s++);if(_(".selectopts",p).empty().append(a),_(".selectopts",p)[0].selectedIndex=0,_.jgrid.msie()&&_.jgrid.msiever()<9){var i=parseInt(_("select.selectopts",p)[0].offsetWidth,10)+1;_(".selectopts",p).width(i),_(".selectopts",p).css("width","auto")}_(".data",p).append(r),_.jgrid.bindEv.call(d,r,c.searchoptions),_(".input-elm",p).on("change",function(e){var t=e.target;"custom"===c.inputtype&&_.isFunction(c.searchoptions.custom_value)?o.data=c.searchoptions.custom_value.call(d,_(".customelement",this),"get"):o.data=_(t).val(),"select"===c.inputtype&&c.searchoptions.multiple&&(o.data=o.data.join(",")),u.onchange()}),setTimeout(function(){o.data=_(r).val(),"select"===c.inputtype&&c.searchoptions.multiple&&_.isArray(o.data)&&(o.data=o.data.join(",")),u.onchange()},0)}});var i=0;for(l=0;l<u.p.columns.length;l++){var m=void 0===u.p.columns[l].search||u.p.columns[l].search,v=!0===u.p.columns[l].hidden;(!0===u.p.columns[l].searchoptions.searchhidden&&m||m&&!v)&&(t="",o.field===u.p.columns[l].name&&(t=" selected='selected'",i=l),a+="<option value='"+u.p.columns[l].name+"'"+t+">"+u.p.columns[l].label+"</option>")}f.append(a),f.data("curr",i);var y=_("<td class='operators'></td>");r.append(y),(c=I.columns[i]).searchoptions.id=_.jgrid.randId(),x&&"text"===c.inputtype&&(c.searchoptions.size||(c.searchoptions.size=10)),c.searchoptions.name=o.field,c.searchoptions.oper="filter";var b=_.jgrid.createEl.call(d,c.inputtype,c.searchoptions,o.data,!0,u.p.ajaxSelectOptions||{},!0);"nu"!==o.op&&"nn"!==o.op||(_(b).attr("readonly","true"),_(b).attr("disabled","true"));var j=_("<select size='1' class='selectopts "+D.srSelect+"'></select>");for(y.append(j),j.on("change",function(){o.op=_(j).val(),p=_(this).parents("tr:first");var e=_(".input-elm",p)[0];"nu"===o.op||"nn"===o.op?(o.data="","SELECT"!==e.tagName.toUpperCase()&&(e.value=""),e.setAttribute("readonly","true"),e.setAttribute("disabled","true")):("SELECT"===e.tagName.toUpperCase()&&(o.data=e.value),e.removeAttribute("readonly"),e.removeAttribute("disabled")),u.onchange()}),n=c.searchoptions.sopt?c.searchoptions.sopt:u.p.sopt?u.p.sopt:-1!==_.inArray(c.searchtype,u.p.strarr)?u.p.stropts:u.p.numopts,a="",_.each(u.p.ops,function(){g.push(this.oper)}),l=0;l<n.length;l++)-1!==(h=_.inArray(n[l],g))&&(t=o.op===u.p.ops[h].oper?" selected='selected'":"",a+="<option value='"+u.p.ops[h].oper+"'"+t+">"+u.p.ops[h].text+"</option>");j.append(a);var S=_("<td class='data'></td>");r.append(S),S.append(b),_.jgrid.bindEv.call(d,b,c.searchoptions),_(b).addClass("input-elm "+D.srInput).on("change",function(){o.data="custom"===c.inputtype?c.searchoptions.custom_value.call(d,_(".customelement",this),"get"):_(this).val(),u.onchange()});var F=_("<td></td>");if(r.append(F),!0===this.p.ruleButtons){var O=_("<input type='button' value='-' title='"+u.p.delrule+"' class='delete-rule ui-del "+w.button+"'/>");F.append(O),O.on("click",function(){for(l=0;l<e.rules.length;l++)if(e.rules[l]===o){e.rules.splice(l,1);break}return u.reDraw(),u.onchange(),!1})}return r},this.getStringForGroup=function(e){var t,r="(";if(void 0!==e.groups)for(t=0;t<e.groups.length;t++){1<r.length&&(r+=" "+e.groupOp+" ");try{r+=this.getStringForGroup(e.groups[t])}catch(e){alert(e)}}if(void 0!==e.rules)try{for(t=0;t<e.rules.length;t++)1<r.length&&(r+=" "+e.groupOp+" "),r+=this.getStringForRule(e.rules[t])}catch(e){alert(e)}return"()"===(r+=")")?"":r},this.getStringForRule=function(e){var t,r,a,s="",i="";for(t=0;t<this.p.ops.length;t++)if(this.p.ops[t].oper===e.op){s=this.p.operands.hasOwnProperty(e.op)?this.p.operands[e.op]:"",i=this.p.ops[t].oper;break}for(t=0;t<this.p.columns.length;t++)if(this.p.columns[t].name===e.field){r=this.p.columns[t];break}return void 0===r?"":(a=this.p.autoencode?_.jgrid.htmlEncode(e.data):e.data,"bw"!==i&&"bn"!==i||(a+="%"),"ew"!==i&&"en"!==i||(a="%"+a),"cn"!==i&&"nc"!==i||(a="%"+a+"%"),"in"!==i&&"ni"!==i||(a=" ("+a+")"),I.errorcheck&&o(e.data,r),-1!==_.inArray(r.searchtype,["int","integer","float","number","currency"])||"nn"===i||"nu"===i?e.field+" "+s+" "+a:e.field+" "+s+' "'+a+'"')},this.resetFilter=function(){this.p.filter=_.extend(!0,{},this.p.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){_("th."+w.error,this).html(""),_("tr.error",this).hide()},this.showError=function(){_("th."+w.error,this).html(this.p.errmsg),_("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(I.filter)},this.toString=function(){var a=this;function s(e){if(a.p.errorcheck){var t,r;for(t=0;t<a.p.columns.length;t++)if(a.p.columns[t].name===e.field){r=a.p.columns[t];break}r&&o(e.data,r)}return e.op+"(item."+e.field+",'"+e.data+"')"}return function e(t){var r,a="(";if(void 0!==t.groups)for(r=0;r<t.groups.length;r++)1<a.length&&("OR"===t.groupOp?a+=" || ":a+=" && "),a+=e(t.groups[r]);if(void 0!==t.rules)for(r=0;r<t.rules.length;r++)1<a.length&&("OR"===t.groupOp?a+=" || ":a+=" && "),a+=s(t.rules[r]);return"()"==(a+=")")?"":a}(this.p.filter)},this.reDraw(),this.p.showQuery&&this.onchange(),this.filter=!0}}})},_.extend(_.fn.jqFilter,{toSQLString:function(){var e="";return this.each(function(){e=this.toUserFriendlyString()}),e},filterData:function(){var e;return this.each(function(){e=this.p.filter}),e},getParameter:function(r){var a=null;return void 0!==r&&this.each(function(e,t){t.p.hasOwnProperty(r)&&(a=t.p[r])}),a||this[0].p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(e){"string"==typeof e&&(e=_.jgrid.parse(e)),this.each(function(){this.p.filter=e,this.reDraw(),this.onchange()})}}),_.extend(_.jgrid,{filterRefactor:function(e){var t,r,a,s,i,o={};try{if((o="string"==typeof e.ruleGroup?_.jgrid.parse(e.ruleGroup):e.ruleGroup).rules&&o.rules.length)for(t=o.rules,r=0;r<t.length;r++)a=t[r],_.inArray(a.filed,e.ssfield)&&1<(s=a.data.split(e.splitSelect)).length&&(void 0===o.groups&&(o.groups=[]),i={groupOp:e.groupOpSelect,groups:[],rules:[]},o.groups.push(i),_.each(s,function(e){s[e]&&i.rules.push({data:s[e],op:a.op,field:a.field})}),t.splice(r,1),r--)}catch(e){}return o}}),_.jgrid.extend({filterToolbar:function(q){var r=_.jgrid.getRegional(this[0],"search");return q=_.extend({autosearch:!0,autosearchDelay:500,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,onClearSearchValue:null,url:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw",searchOperators:!1,resetIcon:"x",splitSelect:",",groupOpSelect:"OR",errorcheck:!0,operands:{eq:"==",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^",in:"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#",bt:"..."}},r,q||{}),this.each(function(){var x=this;if(!x.p.filterToolbar){if(_(x).data("filterToolbar")||_(x).data("filterToolbar",q),x.p.force_regional&&(q=_.extend(q,r)),void 0!==x.p.customFilterDef)for(var e in x.p.customFilterDef)x.p.customFilterDef.hasOwnProperty(e)&&!q.operands.hasOwnProperty(e)&&(q.odata.push({oper:e,text:x.p.customFilterDef[e].text}),q.operands[e]=x.p.customFilterDef[e].operand);var m,v,t,y=_.jgrid.styleUI[x.p.styleUI||"jQueryUI"].filter,d=_.jgrid.styleUI[x.p.styleUI||"jQueryUI"].common,b=_.jgrid.styleUI[x.p.styleUI||"jQueryUI"].base,j=function(){var t,r,a,s,i={},o=0,l={},n=!1,p=[],c=!1,u=[!0,"",""],d=!1;if(_.each(x.p.colModel,function(){var e=_("#gs_"+x.p.idPrefix+_.jgrid.jqID(this.name),!0===this.frozen&&!0===x.p.frozenColumns?x.grid.fhDiv:x.grid.hDiv);if(r=this.index||this.name,s=this.searchoptions||{},a=q.searchOperators&&s.searchOperMenu?e.parent().prev().children("a").attr("soper")||q.defaultSearch:s.sopt?s.sopt[0]:"select"===this.stype?"eq":q.defaultSearch,t="custom"===this.stype&&_.isFunction(s.custom_value)&&0<e.length?s.custom_value.call(x,e,"get"):e.val(),"select"===this.stype&&s.multiple&&_.isArray(t)&&(t=0<t.length?(n=!0,p.push(r),1===t.length?t[0]:t):""),this.searchrules&&q.errorcheck&&(_.isFunction(this.searchrules)?u=this.searchrules.call(x,t,this):_.jgrid&&_.jgrid.checkValues&&(u=_.jgrid.checkValues.call(x,t,-1,this.searchrules,this.label||this.name)),u&&u.length&&!1===u[0]))return this.searchrules.hasOwnProperty("validationError")&&(d=this.searchrules.validationError),!1;if("bt"===a&&(c=!0),t||"nu"===a||"nn"===a)i[r]=t,l[r]=a,o++;else try{delete x.p.postData[r]}catch(e){}}),!1!==u[0]){var e,h=0<o;if(!0===q.stringResult||"local"===x.p.datatype||!0===q.searchOperators){var f,g,m,v,y,b,j='{"groupOp":"'+q.groupOp+'","rules":[',S=0;if(_.each(i,function(e,t){0<S&&(j+=","),j+='{"field":"'+e+'",',j+='"op":"'+l[e]+'",',j+='"data":"'+(t+="").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',S++}),j+="]}",n&&(f=_.jgrid.filterRefactor({ruleGroup:j,ssfield:p,splitSelect:q.splitSelect,groupOpSelect:q.groupOpSelect}),j=JSON.stringify(f)),c&&(_.isPlainObject(f)||(f=_.jgrid.parse(j)),f.rules&&f.rules.length))for(g=f.rules,m=0;m<g.length;m++)"bt"===(v=g[m]).op&&1<(y=v.data.split("...")).length&&(void 0===f.groups&&(f.groups=[]),b={groupOp:"AND",groups:[],rules:[]},f.groups.push(b),_.each(y,function(e){var t=0===e?"ge":"le";y[e]&&b.rules.push({data:y[e],op:t,field:v.field})}),g.splice(m,1),m--);(c||n)&&(j=JSON.stringify(f)),_.extend(x.p.postData,{filters:j}),_.each(["searchField","searchString","searchOper"],function(e,t){x.p.postData.hasOwnProperty(t)&&delete x.p.postData[t]})}else _.extend(x.p.postData,i);q.url&&(e=x.p.url,_(x).jqGrid("setGridParam",{url:q.url}));var F="stop"===_(x).triggerHandler("jqGridToolbarBeforeSearch");!F&&_.isFunction(q.beforeSearch)&&(F=q.beforeSearch.call(x)),F||_(x).jqGrid("setGridParam",{search:h}).trigger("reloadGrid",[{page:1}]),e&&_(x).jqGrid("setGridParam",{url:e}),_(x).triggerHandler("jqGridToolbarAfterSearch"),_.isFunction(q.afterSearch)&&q.afterSearch.call(x)}else if(_.isFunction(d))d.call(x,u[1]);else{var O=_.jgrid.getRegional(x,"errors");_.jgrid.info_dialog(O.errcap,u[1],"",{styleUI:x.p.styleUI})}},S=_("<tr class='ui-search-toolbar' role='row'></tr>");q.restoreFromFilters&&(t=x.p.postData.filters)&&("string"==typeof t&&(t=_.jgrid.parse(t)),v=!!t.rules.length&&t.rules),_.each(x.p.colModel,function(e){var t,r,a,s,i,o,l,n,p=this,c="",u="=",d=_("<th role='columnheader' class='"+b.headerBox+" ui-th-"+x.p.direction+"' id='gsh_"+x.p.id+"_"+p.name+"' ></th>"),h=_("<div></div>"),f=_("<table class='ui-search-table' cellspacing='0'><tr><td class='ui-search-oper' headers=''></td><td class='ui-search-input' headers=''></td><td class='ui-search-clear' headers=''></td></tr></table>");if(!0===this.hidden&&_(d).css("display","none"),this.search=!1!==this.search,void 0===this.stype&&(this.stype="text"),this.searchoptions=this.searchoptions||{},void 0===this.searchoptions.searchOperMenu&&(this.searchoptions.searchOperMenu=!0),t=_.extend({},this.searchoptions,{name:p.index||p.name,id:"gs_"+x.p.idPrefix+p.name,oper:"search"}),this.search){if(q.restoreFromFilters&&v){n=!1;for(var g=0;g<v.length;g++){if(v[g].field)if((p.index||p.name)===v[g].field){n=v[g];break}}}if(q.searchOperators){for(r=t.sopt?t.sopt[0]:"select"===p.stype?"eq":q.defaultSearch,q.restoreFromFilters&&n&&(r=n.op),a=0;a<q.odata.length;a++)if(q.odata[a].oper===r){u=q.operands[r]||"";break}s=null!=t.searchtitle?t.searchtitle:q.operandTitle,c=this.searchoptions.searchOperMenu?"<a title='"+s+"' style='padding-right: 0.5em;' soper='"+r+"' class='soptclass' colname='"+this.name+"'>"+u+"</a>":""}switch(_("td:eq(0)",f).attr("columname",p.name).append(c),void 0===t.clearSearch&&(t.clearSearch=!0),t.clearSearch?(i=q.resetTitle||"Clear Search Value",_("td:eq(2)",f).append("<a title='"+i+"' style='padding-right: 0.3em;padding-left: 0.3em;' class='clearsearchclass'>"+q.resetIcon+"</a>")):_("td:eq(2)",f).hide(),this.surl&&(t.dataUrl=this.surl),o="",t.defaultValue&&(o=_.isFunction(t.defaultValue)?t.defaultValue.call(x):t.defaultValue),q.restoreFromFilters&&n&&(o=n.data),l=_.jgrid.createEl.call(x,this.stype,t,o,!1,_.extend({},_.jgrid.ajaxOptions,x.p.ajaxSelectOptions||{})),_(l).addClass(y.srInput),_("td:eq(1)",f).append(l),_(h).append(f),null==t.dataEvents&&(t.dataEvents=[]),this.stype){case"select":!0===q.autosearch&&t.dataEvents.push({type:"change",fn:function(){return j(),!1}});break;case"text":!0===q.autosearch&&(q.searchOnEnter?t.dataEvents.push({type:"keypress",fn:function(e){return 13===(e.charCode||e.keyCode||0)?(j(),!1):this}}):t.dataEvents.push({type:"keydown",fn:function(e){switch(e.which){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:m&&clearTimeout(m),m=setTimeout(function(){j()},q.autosearchDelay)}}}))}_.jgrid.bindEv.call(x,l,t)}_(d).append(h),_(S).append(d),q.searchOperators&&""!==c||_("td:eq(0)",f).hide()}),_("table thead",x.grid.hDiv).append(S),q.searchOperators&&(_(".soptclass",S).click(function(e){var t=_(this).offset();!function(a,e,t){_("#sopt_menu").remove(),e=parseInt(e,10),t=parseInt(t,10)+18;for(var r,s='<ul id="sopt_menu" class="ui-search-menu modal-content" role="menu" tabindex="0" style="font-size:'+(_(".ui-jqgrid").css("font-size")||"11px")+";left:"+e+"px;top:"+t+'px;">',i=_(a).attr("soper"),o=[],l=0,n=_(a).attr("colname"),p=x.p.colModel.length;l<p&&x.p.colModel[l].name!==n;)l++;var c=x.p.colModel[l],u=_.extend({},c.searchoptions);for(u.sopt||(u.sopt=[],u.sopt[0]="select"===c.stype?"eq":q.defaultSearch),_.each(q.odata,function(){o.push(this.oper)}),l=0;l<u.sopt.length;l++)-1!==(r=_.inArray(u.sopt[l],o))&&(s+='<li class="ui-menu-item '+(i===q.odata[r].oper?d.highlight:"")+'" role="presentation"><a class="'+d.cornerall+' g-menu-item" tabindex="0" role="menuitem" value="'+q.odata[r].oper+'" oper="'+q.operands[q.odata[r].oper]+'"><table class="ui-common-table"><tr><td width="25px">'+q.operands[q.odata[r].oper]+"</td><td>"+q.odata[r].text+"</td></tr></table></a></li>");s+="</ul>",_("body").append(s),_("#sopt_menu").addClass("ui-menu "+y.menu_widget),_("#sopt_menu > li > a").hover(function(){_(this).addClass(d.hover)},function(){_(this).removeClass(d.hover)}).click(function(){var e=_(this).attr("value"),t=_(this).attr("oper");if(_(x).triggerHandler("jqGridToolbarSelectOper",[e,t,a]),_("#sopt_menu").hide(),_(a).text(t).attr("soper",e),!0===q.autosearch){var r=_(a).parent().next().children()[0];!_(r).val()&&"nu"!==e&&"nn"!==e||j()}})}(this,t.left,t.top),e.stopPropagation()}),_("body").on("click",function(e){"soptclass"!==e.target.className&&_("#sopt_menu").remove()})),_(".clearsearchclass",S).click(function(){for(var e=_(this).parents("tr:first"),t=_("td.ui-search-oper",e).attr("columname"),r=0,a=x.p.colModel.lenght;r<a&&x.p.colModel[r].name!==t;)r++;var s,i=_.extend({},x.p.colModel[r].searchoptions||{}),o=i.defaultValue?i.defaultValue:"";"select"===x.p.colModel[r].stype?(s=_("td.ui-search-input select",e),o?s.val(o):s[0].selectedIndex=0):(s=_("td.ui-search-input input",e)).val(o),_(x).triggerHandler("jqGridToolbarClearVal",[s[0],r,i,o]),_.isFunction(q.onClearSearchValue)&&q.onClearSearchValue.call(x,s[0],r,i,o),!0===q.autosearch&&j()}),_(x.grid.hDiv).on("scroll",function(e){x.grid.bDiv.scrollLeft=x.grid.hDiv.scrollLeft}),this.p.filterToolbar=!0,this.triggerToolbar=j,this.clearToolbar=function(e){var r,a={},s=0;e="boolean"!=typeof e||e,_.each(x.p.colModel,function(){var t,e=_("#gs_"+x.p.idPrefix+_.jgrid.jqID(this.name),!0===this.frozen&&!0===x.p.frozenColumns?x.grid.fhDiv:x.grid.hDiv);switch(this.searchoptions&&void 0!==this.searchoptions.defaultValue&&(t=this.searchoptions.defaultValue),r=this.index||this.name,this.stype){case"select":if(e.find("option").each(function(e){if(0===e&&(this.selected=!0),_(this).val()===t)return!(this.selected=!0)}),void 0!==t)a[r]=t,s++;else try{delete x.p.postData[r]}catch(e){}break;case"text":if(e.val(t||""),void 0!==t)a[r]=t,s++;else try{delete x.p.postData[r]}catch(e){}break;case"custom":_.isFunction(this.searchoptions.custom_value)&&0<e.length&&this.searchoptions.custom_value.call(x,e,"set",t||"")}});var t,i=0<s;if((x.p.resetsearch=!0)===q.stringResult||"local"===x.p.datatype){var o='{"groupOp":"'+q.groupOp+'","rules":[',l=0;_.each(a,function(e,t){0<l&&(o+=","),o+='{"field":"'+e+'",',o+='"op":"eq",',o+='"data":"'+(t+="").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',l++}),o+="]}",_.extend(x.p.postData,{filters:o}),_.each(["searchField","searchString","searchOper"],function(e,t){x.p.postData.hasOwnProperty(t)&&delete x.p.postData[t]})}else _.extend(x.p.postData,a);q.url&&(t=x.p.url,_(x).jqGrid("setGridParam",{url:q.url}));var n="stop"===_(x).triggerHandler("jqGridToolbarBeforeClear");!n&&_.isFunction(q.beforeClear)&&(n=q.beforeClear.call(x)),n||e&&_(x).jqGrid("setGridParam",{search:i}).trigger("reloadGrid",[{page:1}]),t&&_(x).jqGrid("setGridParam",{url:t}),_(x).triggerHandler("jqGridToolbarAfterClear"),_.isFunction(q.afterClear)&&q.afterClear()},this.toggleToolbar=function(){var e=_("tr.ui-search-toolbar",x.grid.hDiv);!0===x.p.frozenColumns&&_(x).jqGrid("destroyFrozenColumns"),"none"===e.css("display")?e.show():e.hide(),!0===x.p.frozenColumns&&_(x).jqGrid("setFrozenColumns")}}})},destroyFilterToolbar:function(){return this.each(function(){this.p.filterToolbar&&(this.triggerToolbar=null,this.clearToolbar=null,this.toggleToolbar=null,this.p.filterToolbar=!1,_(this.grid.hDiv).find("table thead tr.ui-search-toolbar").remove())})},refreshFilterToolbar:function(f){return f=_.extend(!0,{filters:"",onClearVal:null,onSetVal:null},f||{}),this.each(function(){var s,i,o,e,l,n,p,c=this,u=c.p.colModel,d=c.p.colModel.length,h=[];if(c.p.filterToolbar){for(i=_(c).data("filterToolbar"),s=0;s<d;s++){switch(h.push(u[s].name),o=_("#gs_"+c.p.idPrefix+_.jgrid.jqID(u[s].name)),u[s].stype){case"select":case"text":o.val("")}_.isFunction(f.onClearVal)&&f.onClearVal.call(c,o,u[s].name)}"string"==typeof f.filters&&(f.filters.length?e=f.filters:c.p.postData.hasOwnProperty("filters")&&(e=c.p.postData.filters),e=_.jgrid.parse(e)),_.isPlainObject(e)&&function e(t){if(t&&t.rules){for(l=t.rules,d=l.length,s=0;s<d;s++)if(n=l[s],-1!==(p=_.inArray(n.field,h))&&0<(o=_("#gs_"+c.p.idPrefix+_.jgrid.jqID(u[p].name))).length&&("select"===u[p].stype?o.find("option[value='"+_.jgrid.jqID(n.data)+"']").prop("selected",!0):"text"===u[p].stype&&o.val(n.data),_.isFunction(f.onSetVal)&&f.onSetVal.call(c,o,u[p].name),i&&i.searchOperators)){var r=o.parent().prev();r.hasClass("ui-search-oper")&&(_(".soptclass",r).attr("soper",n.op),i.operands.hasOwnProperty(n.op)&&_(".soptclass",r).html(i.operands[n.op]))}if(t.groups)for(var a=0;a<t.groups.length;a++)e(t.groups[a])}}(e)}})},searchGrid:function(I){var e=_.jgrid.getRegional(this[0],"search");return I=_.extend(!0,{recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,afterChange:null,sortStrategy:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,searchOnEnter:!1,multipleSearch:!1,multipleGroup:!1,top:0,left:0,jqModal:!0,modal:!1,resize:!0,width:450,height:"auto",dataheight:"auto",showQuery:!1,errorcheck:!0,sopt:null,stringResult:void 0,onClose:null,onSearch:null,onReset:null,toTop:!0,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:!1,layer:null,splitSelect:",",groupOpSelect:"OR",operands:{eq:"=",ne:"<>",lt:"<",le:"<=",gt:">",ge:">=",bw:"LIKE",bn:"NOT LIKE",in:"IN",ni:"NOT IN",ew:"LIKE",en:"NOT LIKE",cn:"LIKE",nc:"NOT LIKE",nu:"IS NULL",nn:"ISNOT NULL"},buttons:[]},e,I||{}),this.each(function(){var s=this;if(s.grid){var a,i="fbox_"+s.p.id,t=!0,o=!0,l={themodal:"searchmod"+i,modalhead:"searchhd"+i,modalcontent:"searchcnt"+i,scrollelm:i},r=_.isPlainObject(s.p_savedFilter)&&!_.isEmptyObject(s.p_savedFilter)?s.p_savedFilter:s.p.postData[I.sFilter],e=_.jgrid.styleUI[s.p.styleUI||"jQueryUI"].filter,n=_.jgrid.styleUI[s.p.styleUI||"jQueryUI"].common;if(I.styleUI=s.p.styleUI,"string"==typeof r&&(r=_.jgrid.parse(r)),!0===I.recreateFilter&&_("#"+_.jgrid.jqID(l.themodal)).remove(),void 0!==_("#"+_.jgrid.jqID(l.themodal))[0])w(_("#fbox_"+_.jgrid.jqID(s.p.id)));else{var p=_("<div><div id='"+i+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+_.jgrid.jqID(s.p.id)),c="left",u="";"rtl"===s.p.direction&&(c="right",u=" style='text-align:left'",p.attr("dir","rtl"));var d,h,f=_.extend([],s.p.colModel),g="<a id='"+i+"_search' class='fm-button "+n.button+" fm-button-icon-right ui-search'><span class='"+n.icon_base+" "+e.icon_search+"'></span>"+I.Find+"</a>",m="<a id='"+i+"_reset' class='fm-button "+n.button+" fm-button-icon-left ui-reset'><span class='"+n.icon_base+" "+e.icon_reset+"'></span>"+I.Reset+"</a>",v="",y="",b=!1,j=-1,S=!1,F=[];I.showQuery&&(v="<a id='"+i+"_query' class='fm-button "+n.button+" fm-button-icon-left'><span class='"+n.icon_base+" "+e.icon_query+"'></span>Query</a>");var O=_.jgrid.buildButtons(I.buttons,v+g,n);if(I.columns.length?(f=I.columns,d=f[j=0].index||f[0].name):_.each(f,function(e,t){if(t.label||(t.label=s.p.colNames[e]),!b){var r=void 0===t.search||t.search,a=!0===t.hidden;(t.searchoptions&&!0===t.searchoptions.searchhidden&&r||r&&!a)&&(b=!0,d=t.index||t.name,j=e)}"select"===t.stype&&t.searchoptions&&t.searchoptions.multiple&&(S=!0,F.push(t.index||t.name))}),!r&&d||!1===I.multipleSearch){var x="eq";0<=j&&f[j].searchoptions&&f[j].searchoptions.sopt?x=f[j].searchoptions.sopt[0]:I.sopt&&I.sopt.length&&(x=I.sopt[0]),r={groupOp:"AND",rules:[{field:d,op:x,data:""}]}}if(b=!1,I.tmplNames&&I.tmplNames.length&&(b=!0,y="<tr><td class='ui-search-label'>"+I.tmplLabel+"</td>",y+="<td><select size='1' class='ui-template "+e.srSelect+"'>",y+="<option value='default'>Default</option>",_.each(I.tmplNames,function(e,t){y+="<option value='"+e+"'>"+t+"</option>"}),y+="</select></td></tr>"),void 0!==s.p.customFilterDef)for(var q in s.p.customFilterDef)s.p.customFilterDef.hasOwnProperty(q)&&!I.operands.hasOwnProperty(q)&&(I.odata.push({oper:q,text:s.p.customFilterDef[q].text}),I.operands[q]=s.p.customFilterDef[q].operand);h="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+i+"_2'><tbody><tr><td colspan='2'><hr class='"+n.content+"' style='margin:1px'/></td></tr>"+y+"<tr><td class='EditButton' style='text-align:"+c+"'>"+m+"</td><td class='EditButton' "+u+">"+O+"</td></tr></tbody></table>",i=_.jgrid.jqID(i),_("#"+i).jqFilter({columns:f,sortStrategy:I.sortStrategy,filter:I.loadDefaults?r:null,showQuery:I.showQuery,errorcheck:I.errorcheck,sopt:I.sopt,groupButton:I.multipleGroup,ruleButtons:I.multipleSearch,uniqueSearchFields:I.uniqueSearchFields,afterRedraw:I.afterRedraw,ops:I.odata,operands:I.operands,ajaxSelectOptions:s.p.ajaxSelectOptions,groupOps:I.groupOps,addsubgrup:I.addsubgrup,addrule:I.addrule,delgroup:I.delgroup,delrule:I.delrule,autoencode:s.p.autoencode,onChange:function(){this.p.showQuery&&_(".query",this).html(this.toUserFriendlyString()),_.isFunction(I.afterChange)&&I.afterChange.call(s,_("#"+i),I)},direction:s.p.direction,id:s.p.id}),p.append(h),_("#"+i+"_2").find("[data-index]").each(function(){var t=parseInt(_(this).attr("data-index"),10);0<=t&&_(this).on("click",function(e){I.buttons[t].click.call(s,_("#"+i),I,e)})}),b&&I.tmplFilters&&I.tmplFilters.length&&_(".ui-template",p).on("change",function(){var e=_(this).val();return"default"===e?_("#"+i).jqFilter("addFilter",r):_("#"+i).jqFilter("addFilter",I.tmplFilters[parseInt(e,10)]),!1}),!0===I.multipleGroup&&(I.multipleSearch=!0),_(s).triggerHandler("jqGridFilterInitialize",[_("#"+i)]),_.isFunction(I.onInitializeSearch)&&I.onInitializeSearch.call(s,_("#"+i)),I.gbox="#gbox_"+i;var D=_(".ui-jqgrid").css("font-size")||"11px";I.layer?_.jgrid.createModal(l,p,I,"#gview_"+_.jgrid.jqID(s.p.id),_("#gbox_"+_.jgrid.jqID(s.p.id))[0],"string"==typeof I.layer?"#"+_.jgrid.jqID(I.layer):I.layer,"string"==typeof I.layer?{position:"relative","font-size":D}:{"font-size":D}):_.jgrid.createModal(l,p,I,"#gview_"+_.jgrid.jqID(s.p.id),_("#gbox_"+_.jgrid.jqID(s.p.id))[0],null,{"font-size":D}),(I.searchOnEnter||I.closeOnEscape)&&_("#"+_.jgrid.jqID(l.themodal)).keydown(function(e){var t=_(e.target);return!I.searchOnEnter||13!==e.which||t.hasClass("add-group")||t.hasClass("add-rule")||t.hasClass("delete-group")||t.hasClass("delete-rule")||t.hasClass("fm-button")&&t.is("[id$=_query]")?I.closeOnEscape&&27===e.which?(_("#"+_.jgrid.jqID(l.modalhead)).find(".ui-jqdialog-titlebar-close").click(),!1):void 0:(_("#"+i+"_search").click(),!1)}),v&&_("#"+i+"_query").on("click",function(){return _(".queryresult",p).toggle(),!1}),void 0===I.stringResult&&(I.stringResult=I.multipleSearch),_("#"+i+"_search").on("click",function(){var e,t,r={};if((a=_("#"+i)).find(".input-elm:focus").change(),S&&I.multipleSearch?(s.p_savedFilter={},t=_.jgrid.filterRefactor({ruleGroup:_.extend(!0,{},a.jqFilter("filterData")),ssfield:F,splitSelect:I.splitSelect,groupOpSelect:I.groupOpSelect}),s.p_savedFilter=_.extend(!0,{},a.jqFilter("filterData"))):t=a.jqFilter("filterData"),I.errorcheck&&(a[0].hideError(),I.showQuery||a.jqFilter("toSQLString"),a[0].p.error))return a[0].showError(),!1;if(I.stringResult){try{e=JSON.stringify(t)}catch(e){}"string"==typeof e&&(r[I.sFilter]=e,_.each([I.sField,I.sValue,I.sOper],function(){r[this]=""}))}else I.multipleSearch?(r[I.sFilter]=t,_.each([I.sField,I.sValue,I.sOper],function(){r[this]=""})):(r[I.sField]=t.rules[0].field,r[I.sValue]=t.rules[0].data,r[I.sOper]=t.rules[0].op,r[I.sFilter]="");return s.p.search=!0,_.extend(s.p.postData,r),void 0===(o=_(s).triggerHandler("jqGridFilterSearch"))&&(o=!0),o&&_.isFunction(I.onSearch)&&(o=I.onSearch.call(s,s.p.filters)),!1!==o&&_(s).trigger("reloadGrid",[{page:1}]),I.closeAfterSearch&&_.jgrid.hideModal("#"+_.jgrid.jqID(l.themodal),{gb:"#gbox_"+_.jgrid.jqID(s.p.id),jqm:I.jqModal,onClose:I.onClose}),!1}),_("#"+i+"_reset").on("click",function(){var e={},t=_("#"+i);return s.p.search=!1,!(s.p.resetsearch=!0)===I.multipleSearch?e[I.sField]=e[I.sValue]=e[I.sOper]="":e[I.sFilter]="",t[0].resetFilter(),b&&_(".ui-template",p).val("default"),_.extend(s.p.postData,e),void 0===(o=_(s).triggerHandler("jqGridFilterReset"))&&(o=!0),o&&_.isFunction(I.onReset)&&(o=I.onReset.call(s)),!1!==o&&_(s).trigger("reloadGrid",[{page:1}]),I.closeAfterReset&&_.jgrid.hideModal("#"+_.jgrid.jqID(l.themodal),{gb:"#gbox_"+_.jgrid.jqID(s.p.id),jqm:I.jqModal,onClose:I.onClose}),!1}),w(_("#"+i)),_(".fm-button:not(."+n.disabled+")",p).hover(function(){_(this).addClass(n.hover)},function(){_(this).removeClass(n.hover)})}}function w(e){void 0===(t=_(s).triggerHandler("jqGridFilterBeforeShow",[e]))&&(t=!0),t&&_.isFunction(I.beforeShowSearch)&&(t=I.beforeShowSearch.call(s,e)),t&&(_.jgrid.viewModal("#"+_.jgrid.jqID(l.themodal),{gbox:"#gbox_"+_.jgrid.jqID(s.p.id),jqm:I.jqModal,modal:I.modal,overlay:I.overlay,toTop:I.toTop}),_(s).triggerHandler("jqGridFilterAfterShow",[e]),_.isFunction(I.afterShowSearch)&&I.afterShowSearch.call(s,e))}})},filterInput:function(l,n){return n=_.extend(!0,{defaultSearch:"cn",groupOp:"OR",searchAll:!1,beforeSearch:null,afterSearch:null},n||{}),this.each(function(){var r=this;if(r.grid){var e,t,a,s='{"groupOp":"'+n.groupOp+'","rules":[',i=0;if(l+="","local"===r.p.datatype){_.each(r.p.colModel,function(){e=this.index||this.name,t=this.searchoptions||{},a=n.defaultSearch?n.defaultSearch:t.sopt?t.sopt[0]:n.defaultSearch,this.search=!1!==this.search,(this.search||n.searchAll)&&(0<i&&(s+=","),s+='{"field":"'+e+'",',s+='"op":"'+a+'",',s+='"data":"'+l.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',i++)}),s+="]}",_.extend(r.p.postData,{filters:s}),_.each(["searchField","searchString","searchOper"],function(e,t){r.p.postData.hasOwnProperty(t)&&delete r.p.postData[t]});var o="stop"===_(r).triggerHandler("jqGridFilterInputBeforeSearch");!o&&_.isFunction(n.beforeSearch)&&(o=n.beforeSearch.call(r)),o||_(r).jqGrid("setGridParam",{search:!0}).trigger("reloadGrid",[{page:1}]),_(r).triggerHandler("jqGridFilterInputAfterSearch"),_.isFunction(n.afterSearch)&&n.afterSearch.call(r)}}})},autoSelect:function(c){return c=_.extend(!0,{field:"",direction:"asc",src_date:"Y-m-d",allValues:"All",count_item:!0,create_value:!0},c||{}),this.each(function(){var e,t=this,r="";if(c.field&&t.p.data&&_.isArray(t.p.data)){var a,s,i,o,l,n,p=[];try{n=(l=_.jgrid.from.call(t,t.p.data).groupBy(c.field,c.direction,"text",c.src_date)).length}catch(e){}if(l&&l.length){for(a=_("#gsh_"+t.p.id+"_"+c.field).find("td.ui-search-input > select"),n=l.length,c.allValues&&(r="<option value=''>"+c.allValues+"</option>",p.push(":"+c.allValues));n--;)e=l[n],s=c.count_item?" ("+e.items.length+")":"",r+="<option value='"+e.unique+"'>"+e.unique+s+"</option>",p.push(e.unique+":"+e.unique+s);if(a.append(r),a.on("change",function(){t.triggerToolbar()}),c.create_value){for(n=0,o=t.p.colModel.length;n<o;n++)if(t.p.colModel[n].name===c.field){i=t.p.colModel[n];break}i&&(i.searchoptions?_.extend(i.searchoptions,{value:p.join(";")}):(i.searchoptions={},i.searchoptions.value=p.join(";")))}}}})}})});