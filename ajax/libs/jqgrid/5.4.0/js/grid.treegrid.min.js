!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(m){"use strict";m.jgrid.extend({setTreeNode:function(j,R){return this.each(function(){var d=this;if(d.grid&&d.p.treeGrid){var e,r,t,i,a,s,l,n,p=d.p.expColInd,o=d.p.treeReader.expanded_field,f=d.p.treeReader.leaf_field,h=d.p.treeReader.level_field,c=d.p.treeReader.icon_field,g=d.p.treeReader.loaded,u=m.jgrid.styleUI[d.p.styleUI||"jQueryUI"].common,G=j;for(m(d).triggerHandler("jqGridBeforeSetTreeNode",[G,R]),m.isFunction(d.p.beforeSetTreeNode)&&d.p.beforeSetTreeNode.call(d,G,R);j<R;){var v=m.jgrid.stripPref(d.p.idPrefix,d.rows[j].id),_=d.p._index[v];l=d.p.data[_],"nested"===d.p.treeGridModel&&(l[f]||(e=parseInt(l[d.p.treeReader.left_field],10),r=parseInt(l[d.p.treeReader.right_field],10),l[f]=r===e+1?"true":"false",d.rows[j].cells[d.p._treeleafpos].innerHTML=l[f])),t=parseInt(l[h],10),a=0===d.p.tree_root_level?(i=t+1,t):(i=t)-1,s="<div class='tree-wrap tree-wrap-"+d.p.direction+"' style='width:"+18*i+"px;'>",s+="<div style='"+("rtl"===d.p.direction?"right:":"left:")+18*a+"px;' class='"+u.icon_base+" ",void 0!==l[g]&&("true"===l[g]||!0===l[g]?l[g]=!0:l[g]=!1),n="true"===l[f]||!0===l[f]?(s+=(void 0!==l[c]&&""!==l[c]?l[c]:d.p.treeIcons.leaf)+" tree-leaf treeclick",l[f]=!0,"leaf"):(l[f]=!1,""),l[o]=("true"===l[o]||!0===l[o])&&(l[g]||void 0===l[g]),!1===l[o]?s+=!0===l[f]?"'":d.p.treeIcons.plus+" tree-plus treeclick'":s+=!0===l[f]?"'":d.p.treeIcons.minus+" tree-minus treeclick'",s+="></div></div>",m(d.rows[j].cells[p]).wrapInner("<span class='cell-wrapper"+n+"'></span>").prepend(s),t!==parseInt(d.p.tree_root_level,10)&&(m(d).jqGrid("isVisibleNode",l)||m(d.rows[j]).css("display","none")),m(d.rows[j].cells[p]).find("div.treeclick").on("click",function(e){var r=e.target||e.srcElement,t=m.jgrid.stripPref(d.p.idPrefix,m(r,d.rows).closest("tr.jqgrow")[0].id),i=d.p._index[t];return d.p.data[i][f]||(d.p.data[i][o]?(m(d).jqGrid("collapseRow",d.p.data[i]),m(d).jqGrid("collapseNode",d.p.data[i])):(m(d).jqGrid("expandRow",d.p.data[i]),m(d).jqGrid("expandNode",d.p.data[i]))),!1}),!0===d.p.ExpandColClick&&m(d.rows[j].cells[p]).find("span.cell-wrapper").css("cursor","pointer").on("click",function(e){var r=e.target||e.srcElement,t=m.jgrid.stripPref(d.p.idPrefix,m(r,d.rows).closest("tr.jqgrow")[0].id),i=d.p._index[t];return d.p.data[i][f]||(d.p.data[i][o]?(m(d).jqGrid("collapseRow",d.p.data[i]),m(d).jqGrid("collapseNode",d.p.data[i])):(m(d).jqGrid("expandRow",d.p.data[i]),m(d).jqGrid("expandNode",d.p.data[i]))),m(d).jqGrid("setSelection",t),!1}),j++}m(d).triggerHandler("jqGridAfterSetTreeNode",[G,R]),m.isFunction(d.p.afterSetTreeNode)&&d.p.afterSetTreeNode.call(d,G,R)}})},setTreeGrid:function(){return this.each(function(){var e,r,t,i,d=this,a=0,s=!1,l=[],n=m.jgrid.styleUI[d.p.styleUI||"jQueryUI"].treegrid;if(d.p.treeGrid){for(t in d.p.treedatatype||m.extend(d.p,{treedatatype:d.p.datatype}),d.p.loadonce&&(d.p.treedatatype="local"),d.p.subGrid=!1,d.p.altRows=!1,d.p.treeGrid_bigData||(d.p.pgbuttons=!1,d.p.pginput=!1,d.p.rowList=[]),d.p.gridview=!0,null!==d.p.rowTotal||d.p.treeGrid_bigData||(d.p.rowNum=1e4),d.p.multiselect=!1,d.p.expColInd=0,e=n.icon_plus,"jQueryUI"===d.p.styleUI&&(e+="rtl"===d.p.direction?"w":"e"),d.p.treeIcons=m.extend({plus:e,minus:n.icon_minus,leaf:n.icon_leaf},d.p.treeIcons||{}),"nested"===d.p.treeGridModel?d.p.treeReader=m.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.p.treeReader):"adjacency"===d.p.treeGridModel&&(d.p.treeReader=m.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.p.treeReader)),d.p.colModel)if(d.p.colModel.hasOwnProperty(t))for(i in(r=d.p.colModel[t].name)!==d.p.ExpandColumn||s||(s=!0,d.p.expColInd=a),a++,d.p.treeReader)d.p.treeReader.hasOwnProperty(i)&&d.p.treeReader[i]===r&&l.push(r);m.each(d.p.treeReader,function(e,r){r&&-1===m.inArray(r,l)&&("leaf_field"===e&&(d.p._treeleafpos=a),a++,d.p.colNames.push(r),d.p.colModel.push({name:r,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}})},expandRow:function(s){this.each(function(){var r=this;if(!r.p.treeGrid_bigData)var e=r.p.lastpage;if(r.grid&&r.p.treeGrid){var t=m(r).jqGrid("getNodeChildren",s),i=r.p.treeReader.expanded_field,d=s[r.p.localReader.id],a=m(r).triggerHandler("jqGridBeforeExpandTreeGridRow",[d,s,t]);void 0===a&&(a=!0),a&&m.isFunction(r.p.beforeExpandTreeGridRow)&&(a=r.p.beforeExpandTreeGridRow.call(r,d,s,t)),!1!==a&&(m(t).each(function(){var e=r.p.idPrefix+m.jgrid.getAccessor(this,r.p.localReader.id);m(m(r).jqGrid("getGridRowById",e)).css("display",""),this[i]&&m(r).jqGrid("expandRow",this)}),m(r).triggerHandler("jqGridAfterExpandTreeGridRow",[d,s,t]),m.isFunction(r.p.afterExpandTreeGridRow)&&r.p.afterExpandTreeGridRow.call(r,d,s,t),r.p.treeGrid_bigData||(r.p.lastpage=e))}})},collapseRow:function(a){this.each(function(){var r=this;if(r.grid&&r.p.treeGrid){var e=m(r).jqGrid("getNodeChildren",a),t=r.p.treeReader.expanded_field,i=a[r.p.localReader.id],d=m(r).triggerHandler("jqGridBeforeCollapseTreeGridRow",[i,a,e]);void 0===d&&(d=!0),d&&m.isFunction(r.p.beforeCollapseTreeGridRow)&&(d=r.p.beforeCollapseTreeGridRow.call(r,i,a,e)),!1!==d&&(m(e).each(function(){var e=r.p.idPrefix+m.jgrid.getAccessor(this,r.p.localReader.id);m(m(r).jqGrid("getGridRowById",e)).css("display","none"),this[t]&&m(r).jqGrid("collapseRow",this)}),m(r).triggerHandler("jqGridAfterCollapseTreeGridRow",[i,a,e]),m.isFunction(r.p.afterCollapseTreeGridRow)&&r.p.afterCollapseTreeGridRow.call(r,i,a,e))}})},getRootNodes:function(){var d=[];return this.each(function(){var e,r,t=this,i=t.p.data;if(t.grid&&t.p.treeGrid)switch(t.p.treeGridModel){case"nested":e=t.p.treeReader.level_field,m(i).each(function(){parseInt(this[e],10)===parseInt(t.p.tree_root_level,10)&&d.push(this)});break;case"adjacency":r=t.p.treeReader.parent_id_field,m(i).each(function(){null!==this[r]&&"null"!==String(this[r]).toLowerCase()||d.push(this)})}}),d},getNodeDepth:function(r){var t=null;return this.each(function(){if(this.grid&&this.p.treeGrid){switch(this.p.treeGridModel){case"nested":var e=this.p.treeReader.level_field;t=parseInt(r[e],10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":t=m(this).jqGrid("getNodeAncestors",r).length}}}),t},getNodeParent:function(f){var h=null;return this.each(function(){var e=this;if(e.grid&&e.p.treeGrid)switch(e.p.treeGridModel){case"nested":var r=e.p.treeReader.left_field,t=e.p.treeReader.right_field,i=e.p.treeReader.level_field,d=parseInt(f[r],10),a=parseInt(f[t],10),s=parseInt(f[i],10);m(this.p.data).each(function(){if(parseInt(this[i],10)===s-1&&parseInt(this[r],10)<d&&parseInt(this[t],10)>a)return h=this,!1});break;case"adjacency":for(var l=e.p.treeReader.parent_id_field,n=e.p.localReader.id,p=f[n],o=e.p._index[p];o--;)if(String(e.p.data[o][n])===String(m.jgrid.stripPref(e.p.idPrefix,f[l]))){h=e.p.data[o];break}}}),h},getNodeChildren:function(h){var c=[];return this.each(function(){var e=this;if(e.grid&&e.p.treeGrid){var r,t,i=this.p.data.length;switch(e.p.treeGridModel){case"nested":var d=e.p.treeReader.left_field,a=e.p.treeReader.right_field,s=e.p.treeReader.level_field,l=parseInt(h[d],10),n=parseInt(h[a],10),p=parseInt(h[s],10);for(r=0;r<i;r++)(t=e.p.data[r])&&parseInt(t[s],10)===p+1&&parseInt(t[d],10)>l&&parseInt(t[a],10)<n&&c.push(t);break;case"adjacency":var o=e.p.treeReader.parent_id_field,f=e.p.localReader.id;for(r=0;r<i;r++)(t=e.p.data[r])&&String(t[o])===String(m.jgrid.stripPref(e.p.idPrefix,h[f]))&&c.push(t)}}}),c},getFullTreeNode:function(f,h){var c=[];return this.each(function(){var r,t=this,i=t.p.treeReader.expanded_field;if(t.grid&&t.p.treeGrid)switch(null!=h&&"boolean"==typeof h||(h=!1),t.p.treeGridModel){case"nested":var e=t.p.treeReader.left_field,d=t.p.treeReader.right_field,a=t.p.treeReader.level_field,s=parseInt(f[e],10),l=parseInt(f[d],10),n=parseInt(f[a],10);m(this.p.data).each(function(){parseInt(this[a],10)>=n&&parseInt(this[e],10)>=s&&parseInt(this[e],10)<=l&&(h&&(this[i]=!0),c.push(this))});break;case"adjacency":if(f){c.push(f);var p=t.p.treeReader.parent_id_field,o=t.p.localReader.id;m(this.p.data).each(function(e){for(r=c.length,e=0;e<r;e++)if(String(m.jgrid.stripPref(t.p.idPrefix,c[e][o]))===String(this[p])){h&&(this[i]=!0),c.push(this);break}})}}}),c},getNodeAncestors:function(r,t,i){var d=[];return void 0===t&&(t=!1),this.each(function(){if(this.grid&&this.p.treeGrid){i=void 0!==i&&this.p.treeReader.expanded_field;for(var e=m(this).jqGrid("getNodeParent",r);e;){if(i)try{e[i]=!0}catch(e){}t?d.unshift(e):d.push(e),e=m(this).jqGrid("getNodeParent",e)}}}),d},isVisibleNode:function(t){var i=!0;return this.each(function(){if(this.grid&&this.p.treeGrid){var e=m(this).jqGrid("getNodeAncestors",t),r=this.p.treeReader.expanded_field;m(e).each(function(){if(!(i=i&&this[r]))return!1})}}),i},isNodeLoaded:function(i){var d;return this.each(function(){var e=this;if(e.grid&&e.p.treeGrid){var r=e.p.treeReader.leaf_field,t=e.p.treeReader.loaded;d=void 0!==i&&(void 0!==i[t]?i[t]:!!(i[r]||0<m(e).jqGrid("getNodeChildren",i).length))}}),d},setLeaf:function(a,s,l){return this.each(function(){var e=m.jgrid.getAccessor(a,this.p.localReader.id),r=m("#"+e,this.grid.bDiv)[0],t=this.p.treeReader.leaf_field;try{var i=this.p._index[e];null!=i&&(this.p.data[i][t]=s)}catch(e){}if(!0===s)m("div.treeclick",r).removeClass(this.p.treeIcons.minus+" tree-minus "+this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.leaf+" tree-leaf");else if(!1===s){var d=this.p.treeIcons.minus+" tree-minus";l&&(d=this.p.treeIcons.plus+" tree-plus"),m("div.treeclick",r).removeClass(this.p.treeIcons.leaf+" tree-leaf").addClass(d)}})},reloadNode:function(f,h){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.localReader.id,r=this.p.selrow;m(this).jqGrid("delChildren",f[e]),void 0===h&&(h=!1),h||jQuery._data(this,"events").jqGridAfterSetTreeNode||m(this).on("jqGridAfterSetTreeNode.reloadNode",function(){var e=this.p.treeReader.leaf_field;if(this.p.reloadnode){var r=this.p.reloadnode,t=m(this).jqGrid("getNodeChildren",r);r[e]&&t.length?m(this).jqGrid("setLeaf",r,!1):r[e]||0!==t.length||m(this).jqGrid("setLeaf",r,!0)}this.p.reloadnode=!1});var t=this.p.treeReader.expanded_field,i=this.p.treeReader.parent_id_field,d=this.p.treeReader.loaded,a=this.p.treeReader.level_field,s=this.p.treeReader.leaf_field,l=this.p.treeReader.left_field,n=this.p.treeReader.right_field,p=m.jgrid.getAccessor(f,this.p.localReader.id),o=m("#"+p,this.grid.bDiv)[0];f[t]=!0,f[s]||m("div.treeclick",o).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=o.rowIndex,this.p.datatype=this.p.treedatatype,this.p.reloadnode=f,h&&(this.p.treeANode=0<o.rowIndex?o.rowIndex-1:1,m(this).jqGrid("delRowData",p)),"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{postData:{nodeid:p,n_left:f[l],n_right:f[n],n_level:f[a]}}):m(this).jqGrid("setGridParam",{postData:{nodeid:p,parentid:f[i],n_level:f[a]}}),m(this).trigger("reloadGrid"),f[d]=!0,"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{selrow:r,postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):m(this).jqGrid("setGridParam",{selrow:r,postData:{nodeid:"",parentid:"",n_level:""}})}})},expandNode:function(o){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.treeReader.expanded_field,r=this.p.treeReader.parent_id_field,t=this.p.treeReader.loaded,i=this.p.treeReader.level_field,d=this.p.treeReader.left_field,a=this.p.treeReader.right_field;if(!o[e]){var s=m.jgrid.getAccessor(o,this.p.localReader.id),l=m("#"+this.p.idPrefix+m.jgrid.jqID(s),this.grid.bDiv)[0],n=this.p._index[s],p=m(this).triggerHandler("jqGridBeforeExpandTreeGridNode",[s,o]);if(void 0===p&&(p=!0),p&&m.isFunction(this.p.beforeExpandTreeGridNode)&&(p=this.p.beforeExpandTreeGridNode.call(this,s,o)),!1===p)return;m(this).jqGrid("isNodeLoaded",this.p.data[n])?(o[e]=!0,m("div.treeclick",l).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")):this.grid.hDiv.loading||(o[e]=!0,m("div.treeclick",l).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=l.rowIndex,this.p.datatype=this.p.treedatatype,"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{postData:{nodeid:s,n_left:o[d],n_right:o[a],n_level:o[i]}}):m(this).jqGrid("setGridParam",{postData:{nodeid:s,parentid:o[r],n_level:o[i]}}),m(this).trigger("reloadGrid"),o[t]=!0,"nested"===this.p.treeGridModel?m(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):m(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}})),m(this).triggerHandler("jqGridAfterExpandTreeGridNode",[s,o]),m.isFunction(this.p.afterExpandTreeGridNode)&&this.p.afterExpandTreeGridNode.call(this,s,o)}}})},collapseNode:function(d){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.treeReader.expanded_field;if(d[e]){var r=m.jgrid.getAccessor(d,this.p.localReader.id),t=m("#"+this.p.idPrefix+m.jgrid.jqID(r),this.grid.bDiv)[0],i=m(this).triggerHandler("jqGridBeforeCollapseTreeGridNode",[r,d]);if(void 0===i&&(i=!0),i&&m.isFunction(this.p.beforeCollapseTreeGridNode)&&(i=this.p.beforeCollapseTreeGridNode.call(this,r,d)),(d[e]=!1)===i)return;m("div.treeclick",t).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus"),m(this).triggerHandler("jqGridAfterCollapseTreeGridNode",[r,d]),m.isFunction(this.p.afterCollapseTreeGridNode)&&this.p.afterCollapseTreeGridNode.call(this,r,d)}}})},SortTree:function(n,p,o,f){return this.each(function(){if(this.grid&&this.p.treeGrid){var e,r,t,i,d,a=[],s=this,l=m(this).jqGrid("getRootNodes",s.p.search);for((i=m.jgrid.from.call(this,l)).orderBy(n,p,o,f),e=0,r=(d=i.select()).length;e<r;e++)t=d[e],a.push(t),m(this).jqGrid("collectChildrenSortTree",a,t,n,p,o,f);m.each(a,function(e){var r=m.jgrid.getAccessor(this,s.p.localReader.id);m("#"+m.jgrid.jqID(s.p.id)+" tbody tr:eq("+e+")").after(m("tr#"+m.jgrid.jqID(r),s.grid.bDiv))}),a=d=i=null}})},searchTree:function(r){var t,i,d,a,s,l,n=r.length||0,p=[],o=[],f=[];return this.each(function(){if(this.grid&&this.p.treeGrid&&n)for(t=this.p.localReader.id;n--;)if((p=m(this).jqGrid("getNodeAncestors",r[n],!0,!0)).push(r[n]),i=p[0][t],-1===m.inArray(i,o))o.push(i),f=f.concat(p);else for(s=0,d=p.length;s<d;s++){var e=!1;for(l=0,a=f.length;l<a;l++)if(p[s][t]===f[l][t]){e=!0;break}e||f.push(p[s])}}),f},collectChildrenSortTree:function(s,l,n,p,o,f){return this.each(function(){var e,r,t,i,d,a;if(this.grid&&this.p.treeGrid)for(i=m(this).jqGrid("getNodeChildren",l,this.p.search),(d=m.jgrid.from.call(this,i)).orderBy(n,p,o,f),e=0,r=(a=d.select()).length;e<r;e++)t=a[e],s.push(t),m(this).jqGrid("collectChildrenSortTree",s,t,n,p,o,f)})},setTreeRow:function(e,r){var t=!1;return this.each(function(){this.grid&&this.p.treeGrid&&(t=m(this).jqGrid("setRowData",e,r))}),t},delTreeNode:function(f){return this.each(function(){var e,r,t,i,d,a=this,s=a.p.localReader.id,l=a.p.treeReader.left_field,n=a.p.treeReader.right_field;if(a.grid&&a.p.treeGrid){f=m.jgrid.stripPref(a.p.idPrefix,f);var p=a.p._index[f];if(void 0!==p){t=(r=parseInt(a.p.data[p][n],10))-parseInt(a.p.data[p][l],10)+1;var o=m(a).jqGrid("getFullTreeNode",a.p.data[p]);if(0<o.length)for(e=0;e<o.length;e++)m(a).jqGrid("delRowData",a.p.idPrefix+o[e][s]);if("nested"===a.p.treeGridModel){if((i=m.jgrid.from.call(a,a.p.data).greater(l,r,{stype:"integer"}).select()).length)for(d in i)i.hasOwnProperty(d)&&(i[d][l]=parseInt(i[d][l],10)-t);if((i=m.jgrid.from.call(a,a.p.data).greater(n,r,{stype:"integer"}).select()).length)for(d in i)i.hasOwnProperty(d)&&(i[d][n]=parseInt(i[d][n],10)-t)}}}})},delChildren:function(f){return this.each(function(){var e,r,t,i,d=this,a=d.p.localReader.id,s=d.p.treeReader.left_field,l=d.p.treeReader.right_field;if(d.grid&&d.p.treeGrid){f=m.jgrid.stripPref(d.p.idPrefix,f);var n=d.p._index[f];if(void 0!==n){r=(e=parseInt(d.p.data[n][l],10))-parseInt(d.p.data[n][s],10)+1;var p=m(d).jqGrid("getFullTreeNode",d.p.data[n]);if(0<p.length)for(var o=0;o<p.length;o++)p[o][a]!==f&&m(d).jqGrid("delRowData",d.p.idPrefix+p[o][a]);if("nested"===d.p.treeGridModel){if((t=m.jgrid.from(d.p.data).greater(s,e,{stype:"integer"}).select()).length)for(i in t)t.hasOwnProperty(i)&&(t[i][s]=parseInt(t[i][s],10)-r);if((t=m.jgrid.from(d.p.data).greater(l,e,{stype:"integer"}).select()).length)for(i in t)t.hasOwnProperty(i)&&(t[i][l]=parseInt(t[i][l],10)-r)}}}})},addChildNode:function(e,r,t,i){var d=this[0];if(t){var a,s,l,n,p,o,f,h,c=d.p.treeReader.expanded_field,g=d.p.treeReader.leaf_field,u=d.p.treeReader.level_field,G=d.p.treeReader.parent_id_field,v=d.p.treeReader.left_field,_=d.p.treeReader.right_field,j=d.p.treeReader.loaded,R=0,I=r;if(void 0===i&&(i=!1),null==e){if(0<=(p=d.p.data.length-1))for(;0<=p;)R=Math.max(R,parseInt(d.p.data[p][d.p.localReader.id],10)),p--;e=R+1}var w,x,q=m(d).jqGrid("getInd",r);if(f=!1,null==r||""===r)I=r=null,a="last",n=d.p.tree_root_level,p=d.p.data.length+1;else{a="after";var N=m.jgrid.stripPref(d.p.idPrefix,r);s=d.p._index[N],r=(l=d.p.data[s])[d.p.localReader.id],n=parseInt(l[u],10)+1;var y=m(d).jqGrid("getFullTreeNode",l);if(p=y.length?(I=p=y[y.length-1][d.p.localReader.id],m(d).jqGrid("getInd",d.p.idPrefix+I)):m(d).jqGrid("getInd",d.p.idPrefix+r),l[g]&&(f=!0,l[c]=!0,m(d.rows[q]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(d.p.treeIcons.leaf+" tree-leaf").addClass(d.p.treeIcons.minus+" tree-minus"),d.p.data[s][g]=!1,l[j]=!0),!1===p)throw"Parent item with id: "+I+" ("+r+") can't be found";p++}if(o=p+1,void 0===t[c]&&(t[c]=!1),void 0===t[j]&&(t[j]=!1),t[u]=n,void 0===t[g]&&(t[g]=!0),"adjacency"===d.p.treeGridModel&&(t[G]=r),"nested"===d.p.treeGridModel)if(null!==r){if(h=parseInt(l[_],10),(w=m.jgrid.from.call(d,d.p.data).greaterOrEquals(_,h,{stype:"integer"}).select()).length)for(x in w)w.hasOwnProperty(x)&&(w[x][v]=w[x][v]>h?parseInt(w[x][v],10)+2:w[x][v],w[x][_]=w[x][_]>=h?parseInt(w[x][_],10)+2:w[x][_]);t[v]=h,t[_]=h+1}else{if(h=parseInt(m(d).jqGrid("getCol",_,!1,"max"),10),(w=m.jgrid.from.call(d,d.p.data).greater(v,h,{stype:"integer"}).select()).length)for(x in w)w.hasOwnProperty(x)&&(w[x][v]=parseInt(w[x][v],10)+2);if((w=m.jgrid.from.call(d,d.p.data).greater(_,h,{stype:"integer"}).select()).length)for(x in w)w.hasOwnProperty(x)&&(w[x][_]=parseInt(w[x][_],10)+2);t[v]=h+1,t[_]=h+2}(null===r||m(d).jqGrid("isNodeLoaded",l)||f)&&(m(d).jqGrid("addRowData",e,t,a,d.p.idPrefix+I),m(d).jqGrid("setTreeNode",p,o)),l&&!l[c]&&i&&m(d.rows[q]).find("div.treeclick").click()}}})});