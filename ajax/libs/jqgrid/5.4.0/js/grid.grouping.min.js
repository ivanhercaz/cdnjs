!function(r){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],r):r(jQuery)}(function(T){"use strict";T.jgrid.extend({groupingSetup:function(){return this.each(function(){var r,e,i,t=this,o=t.p.colModel,s=t.p.groupingView,n=T.jgrid.styleUI[t.p.styleUI||"jQueryUI"].grouping;if(null===s||"object"!=typeof s&&!T.isFunction(s))t.p.grouping=!1;else if(s.plusicon||(s.plusicon=n.icon_plus),s.minusicon||(s.minusicon=n.icon_minus),s.groupField.length){for(void 0===s.visibiltyOnNextGrouping&&(s.visibiltyOnNextGrouping=[]),s.lastvalues=[],s._locgr||(s.groups=[]),s.counters=[],r=0;r<s.groupField.length;r++)s.groupOrder[r]||(s.groupOrder[r]="asc"),s.groupText[r]||(s.groupText[r]="{0}"),"boolean"!=typeof s.groupColumnShow[r]&&(s.groupColumnShow[r]=!0),"boolean"!=typeof s.groupSummary[r]&&(s.groupSummary[r]=!1),s.groupSummaryPos[r]||(s.groupSummaryPos[r]="footer"),!0===s.groupColumnShow[r]?(s.visibiltyOnNextGrouping[r]=!0,T(t).jqGrid("showCol",s.groupField[r])):(s.visibiltyOnNextGrouping[r]=T("#"+T.jgrid.jqID(t.p.id+"_"+s.groupField[r])).is(":visible"),T(t).jqGrid("hideCol",s.groupField[r]));for(s.summary=[],s.hideFirstGroupCol&&T.isArray(s.formatDisplayField)&&!T.isFunction(s.formatDisplayField[0])&&(s.formatDisplayField[0]=function(r){return r}),e=0,i=o.length;e<i;e++)s.hideFirstGroupCol&&(o[e].hidden||s.groupField[0]!==o[e].name||(o[e].formatter=function(){return""})),o[e].summaryType&&(o[e].summaryDivider?s.summary.push({nm:o[e].name,st:o[e].summaryType,v:"",sd:o[e].summaryDivider,vd:"",sr:o[e].summaryRound,srt:o[e].summaryRoundType||"round"}):s.summary.push({nm:o[e].name,st:o[e].summaryType,v:"",sr:o[e].summaryRound,srt:o[e].summaryRoundType||"round"}))}else t.p.grouping=!1})},groupingPrepare:function(d,p){return this.each(function(){function r(){T.isFunction(this.st)?this.v=this.st.call(a,this.v,this.nm,d):(this.v=T(a).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,d),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=T(a).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,d)))}var e,i,t,o,s,n=this.p.groupingView,a=this,u=n.groupField.length,l=0;for(e=0;e<u;e++)i=n.groupField[e],o=n.displayField[e],t=d[i],null==(s=null==o?null:d[o])&&(s=t),void 0!==t&&(0===p?(n.groups.push({idx:e,dataIndex:i,value:t,displayValue:s,startRow:p,cnt:1,summary:[]}),n.lastvalues[e]=t,n.counters[e]={cnt:1,pos:n.groups.length-1,summary:T.extend(!0,[],n.summary)}):"object"==typeof t||(T.isArray(n.isInTheSameGroup)&&T.isFunction(n.isInTheSameGroup[e])?n.isInTheSameGroup[e].call(a,n.lastvalues[e],t,e,n):n.lastvalues[e]===t)?1===l?(n.groups.push({idx:e,dataIndex:i,value:t,displayValue:s,startRow:p,cnt:1,summary:[]}),n.lastvalues[e]=t,n.counters[e]={cnt:1,pos:n.groups.length-1,summary:T.extend(!0,[],n.summary)}):(n.counters[e].cnt+=1,n.groups[n.counters[e].pos].cnt=n.counters[e].cnt):(n.groups.push({idx:e,dataIndex:i,value:t,displayValue:s,startRow:p,cnt:1,summary:[]}),n.lastvalues[e]=t,l=1,n.counters[e]={cnt:1,pos:n.groups.length-1,summary:T.extend(!0,[],n.summary)}),T.each(n.counters[e].summary,r),n.groups[n.counters[e].pos].summary=n.counters[e].summary)}),this},groupingToggle:function(x){return this.each(function(){var r=this,e=r.p.groupingView,i=x.split("_"),t=parseInt(i[i.length-2],10);i.splice(i.length-2,2);function o(r){var e=T.map(r.split(" "),function(r){if(r.substring(0,u.length+1)===u+"_")return parseInt(r.substring(u.length+1),10)});return 0<e.length?e[0]:void 0}var s,n,a,u=i.join("_"),l=e.minusicon,d=e.plusicon,p=T("#"+T.jgrid.jqID(x)),g=p.length?p[0].nextSibling:null,h=T("#"+T.jgrid.jqID(x)+" span.tree-wrap-"+r.p.direction),c=!1,m=!1,f=!!r.p.frozenColumns&&r.p.id+"_frozen",y=!!f&&T("#"+T.jgrid.jqID(x),"#"+T.jgrid.jqID(f)),v=y&&y.length?y[0].nextSibling:null;if(h.hasClass(l)){if(g)for(;g&&!(void 0!==(s=o(g.className))&&s<=t);)a=parseInt(T(g).attr("jqfootlevel"),10),(m=!isNaN(a)&&(e.showSummaryOnHide&&a<=t))||T(g).hide(),g=g.nextSibling,f&&(m||T(v).hide(),v=v.nextSibling);h.removeClass(l).addClass(d),c=!0}else{if(g)for(n=void 0;g;){if(s=o(g.className),void 0===n&&(n=void 0===s),m=T(g).hasClass("ui-subgrid")&&T(g).hasClass("ui-sg-collapsed"),void 0!==s){if(s<=t)break;s===t+1&&(m||(T(g).show().find(">td>span.tree-wrap-"+r.p.direction).removeClass(l).addClass(d),f&&T(v).show().find(">td>span.tree-wrap-"+r.p.direction).removeClass(l).addClass(d)))}else n&&(m||(T(g).show(),f&&T(v).show()));g=g.nextSibling,f&&(v=v.nextSibling)}h.removeClass(d).addClass(l)}T(r).triggerHandler("jqGridGroupingClickGroup",[x,c]),T.isFunction(r.p.onClickGroup)&&r.p.onClickGroup.call(r,x,c)}),!1},groupingRender:function(G,S,I,D){return this.each(function(){var p,g,h,c=this,m=c.p.groupingView,f="",y="",v=m.groupCollapse?m.plusicon:m.minusicon,x=[],j=m.groupField.length,w=T.jgrid.styleUI[c.p.styleUI||"jQueryUI"].common;v=v+" tree-wrap-"+c.p.direction,T.each(c.p.colModel,function(r,e){var i;for(i=0;i<j;i++)if(m.groupField[i]===e.name){x[i]=r;break}});var C=0;function b(r,e,i,t,o){var s,n,a,u,l=function(r,e,i){var t,o=!1;if(0===e)o=i[r];else{var s=i[r].idx;if(0===s)o=i[r];else for(t=r;0<=t;t--)if(i[t].idx===s-e){o=i[t];break}}return o}(r,e,i),d=c.p.colModel,p=l.cnt,g="",h=!1;for(n=t;n<S;n++)d[n].hidden?a="<td "+c.formatCol(n,1,"")+">&#160;</td>":!h&&o?(a=o,h=!0):a="<td "+c.formatCol(n,1,"")+">&#160;</td>",T.each(l.summary,function(){if(this.nm===d[n].name){u=d[n].summaryTpl?d[n].summaryTpl:"{0}","string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&0<p&&(this.v=this.v/p));try{this.groupCount=l.cnt,this.groupIndex=l.dataIndex,this.groupValue=l.value,s=c.formatter("",this.v,n,this)}catch(r){s=this.v}return a="<td "+c.formatCol(n,1,"")+">"+T.jgrid.template(u,s,l.cnt,l.dataIndex,l.displayValue)+"</td>",!1}}),g+=a;return g}var q,F=T.makeArray(m.groupSummary);F.reverse(),q=c.p.multiselect?' colspan="2"':"",T.each(m.groups,function(r,e){if(m._locgr&&!(e.startRow+e.cnt>(I-1)*D&&e.startRow<I*D))return!0;C++,g=c.p.id+"ghead_"+e.idx,p=g+"_"+r,y="<span style='cursor:pointer;margin-right:8px;margin-left:5px;' class='"+w.icon_base+" "+v+"' onclick=\"jQuery('#"+T.jgrid.jqID(c.p.id)+"').jqGrid('groupingToggle','"+p+"');return false;\"></span>";try{h=T.isArray(m.formatDisplayField)&&T.isFunction(m.formatDisplayField[e.idx])?m.formatDisplayField[e.idx].call(c,e.displayValue,e.value,c.p.colModel[x[e.idx]],e.idx,m):c.formatter(p,e.displayValue,x[e.idx],e.value)}catch(r){h=e.displayValue}var i="";if("string"!=typeof(i=T.isFunction(m.groupText[e.idx])?m.groupText[e.idx].call(c,h,e.cnt,e.summary):T.jgrid.template(m.groupText[e.idx],h,e.cnt,e.summary))&&"number"!=typeof i&&(i=h),"header"===m.groupSummaryPos[e.idx]?(f+='<tr id="'+p+'"'+(m.groupCollapse&&0<e.idx?' style="display:none;" ':" ")+'role="row" class= "'+w.content+" jqgroup ui-row-"+c.p.direction+" "+g+'">',f+=b(r,0,m.groups,q?1:0,'<td style="padding-left:'+12*e.idx+'px;"'+q+">"+y+i+"</td>"),f+="</tr>"):f+='<tr id="'+p+'"'+(m.groupCollapse&&0<e.idx?' style="display:none;" ':" ")+'role="row" class= "'+w.content+" jqgroup ui-row-"+c.p.direction+" "+g+'"><td style="padding-left:'+12*e.idx+'px;" colspan="'+(!1===m.groupColumnShow[e.idx]?S-1:S)+'">'+y+i+"</td></tr>",j-1===e.idx){var t,o,s=m.groups[r+1],n=0,a=e.startRow,u=void 0!==s?s.startRow:m.groups[r].startRow+m.groups[r].cnt;for(m._locgr&&(n=(I-1)*D)>e.startRow&&(a=n),t=a;t<u&&G[t-n];t++)f+=G[t-n].join("");if("header"!==m.groupSummaryPos[e.idx]){var l;if(void 0!==s){for(l=0;l<m.groupField.length&&s.dataIndex!==m.groupField[l];l++);C=m.groupField.length-l}for(o=0;o<C;o++)if(F[o]){var d="";m.groupCollapse&&!m.showSummaryOnHide&&(d=' style="display:none;"'),f+="<tr"+d+' jqfootlevel="'+(e.idx-o)+'" role="row" class="'+w.content+" jqfoot ui-row-"+c.p.direction+'">',f+=b(r,o,m.groups,0,!1),f+="</tr>"}C=l}}}),T("#"+T.jgrid.jqID(c.p.id)+" tbody:first").append(f),f=null})},groupingGroupBy:function(t,o){return this.each(function(){var r=this;"string"==typeof t&&(t=[t]);var e,i=r.p.groupingView;for(r.p.grouping=!0,i._locgr=!1,void 0===i.visibiltyOnNextGrouping&&(i.visibiltyOnNextGrouping=[]),e=0;e<i.groupField.length;e++)!i.groupColumnShow[e]&&i.visibiltyOnNextGrouping[e]&&T(r).jqGrid("showCol",i.groupField[e]);for(e=0;e<t.length;e++)i.visibiltyOnNextGrouping[e]=T("#"+T.jgrid.jqID(r.p.id)+"_"+T.jgrid.jqID(t[e])).is(":visible");r.p.groupingView=T.extend(r.p.groupingView,o||{}),i.groupField=t,T(r).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){var r=this;if(void 0===t&&(t=!0),!(r.p.grouping=!1)===t){var e,i=r.p.groupingView;for(e=0;e<i.groupField.length;e++)!i.groupColumnShow[e]&&i.visibiltyOnNextGrouping[e]&&T(r).jqGrid("showCol",i.groupField);T("tr.jqgroup, tr.jqfoot","#"+T.jgrid.jqID(r.p.id)+" tbody:first").remove(),T("tr.jqgrow:hidden","#"+T.jgrid.jqID(r.p.id)+" tbody:first").show()}else T(r).trigger("reloadGrid")})},groupingCalculations:{handler:function(r,e,i,t,o,s){var n={sum:function(){return parseFloat(e||0)+parseFloat(s[i]||0)},min:function(){return""===e?parseFloat(s[i]||0):Math.min(parseFloat(e),parseFloat(s[i]||0))},max:function(){return""===e?parseFloat(s[i]||0):Math.max(parseFloat(e),parseFloat(s[i]||0))},count:function(){return""===e&&(e=0),s.hasOwnProperty(i)?e+1:0},avg:function(){return n.sum()}};if(!n[r])throw"jqGrid Grouping No such method: "+r;var a=n[r]();if(null!=t)if("fixed"===o)a=a.toFixed(t);else{var u=Math.pow(10,t);a=Math.round(a*u)/u}return a}},setGroupHeaders:function(S){return S=T.extend({useColSpanStyle:!1,groupHeaders:[]},S||{}),this.each(function(){var r,e,i,t,o,s,n,a,u,l,d,p,g,h,c=this,m=0,f=c.p.colModel,y=f.length,v=c.grid.headers,x=T("table.ui-jqgrid-htable",c.grid.hDiv),j=x.children("thead").children("tr.ui-jqgrid-labels:last").addClass("jqg-second-row-header"),w=x.children("thead"),C=x.find(".jqg-first-row-header"),b=T.jgrid.styleUI[c.p.styleUI||"jQueryUI"].base;c.p.groupHeader||(c.p.groupHeader=[]),c.p.groupHeader.push(S),void 0===C[0]?C=T("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):C.empty();function q(r,e){var i,t=e.length;for(i=0;i<t;i++)if(e[i].startColumnName===r)return i;return-1}var F;for(T(c).prepend(w),i=T("<tr>",{role:"row"}).addClass("ui-jqgrid-labels jqg-third-row-header"),r=0;r<y;r++)if(o=v[r].el,s=T(o),e=f[r],n={height:"0px",width:v[r].width+"px",display:e.hidden?"none":""},T("<th>",{role:"gridcell"}).css(n).addClass("ui-first-th-"+c.p.direction).appendTo(C),o.style.width="",0<=(a=q(e.name,S.groupHeaders))){for(l=(u=S.groupHeaders[a]).numberOfColumns,d=u.titleText,g=u.className||"",a=p=0;a<l&&r+a<y;a++)f[r+a].hidden||p++;t=T("<th>").attr({role:"columnheader"}).addClass(b.headerBox+" ui-th-column-header ui-th-"+c.p.direction+" "+g).html(d),0<p&&t.attr("colspan",String(p)),c.p.headertitles&&t.attr("title",t.text()),0===p&&t.hide(),s.before(t),i.append(o),m=l-1}else if(0===m)if(S.useColSpanStyle){var G=s.attr("rowspan")?parseInt(s.attr("rowspan"),10)+1:2;s.attr("rowspan",G)}else T("<th>",{role:"columnheader"}).addClass(b.headerBox+" ui-th-column-header ui-th-"+c.p.direction).css({display:e.hidden?"none":""}).insertBefore(s),i.append(o);else i.append(o),m--;(h=T(c).children("thead")).prepend(C),i.insertAfter(j),x.append(h),S.useColSpanStyle&&(x.find("span.ui-jqgrid-resize").each(function(){var r=T(this).parent();r.is(":visible")&&(this.style.cssText="height: "+r.height()+"px !important; cursor: col-resize;")}),x.find("div.ui-jqgrid-sortable").each(function(){var r=T(this),e=r.parent();e.is(":visible")&&e.is(":has(span.ui-jqgrid-resize)")&&r.css("top",(e.height()-r.outerHeight())/2-4+"px")})),F=h.find("tr.jqg-first-row-header"),T(c).on("jqGridResizeStop.setGroupHeaders",function(r,e,i){F.find("th").eq(i)[0].style.width=e+"px"})})},destroyGroupHeader:function(d){return void 0===d&&(d=!0),this.each(function(){var r,e,i,t,o,s,n,a=this.grid,u=T("table.ui-jqgrid-htable thead",a.hDiv),l=this.p.colModel;if(a){for(T(this).off(".setGroupHeaders"),r=T("<tr>",{role:"row"}).addClass("ui-jqgrid-labels"),e=0,i=(t=a.headers).length;e<i;e++){n=l[e].hidden?"none":"",o=T(t[e].el).width(t[e].width).css("display",n);try{o.removeAttr("rowSpan")}catch(r){o.attr("rowSpan",1)}r.append(o),0<(s=o.children("span.ui-jqgrid-resize")).length&&(s[0].style.height=""),o.children("div")[0].style.top=""}T(u).children("tr.ui-jqgrid-labels").remove(),T(u).prepend(r),!0===d&&T(this).jqGrid("setGridParam",{groupHeader:null})}})}})});