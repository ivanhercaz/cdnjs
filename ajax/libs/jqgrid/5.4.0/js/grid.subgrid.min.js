!function(i){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],i):i(jQuery)}(function(x){"use strict";x.jgrid.extend({setSubGrid:function(){return this.each(function(){var i,e,s=this,d=x.jgrid.styleUI[s.p.styleUI||"jQueryUI"].subgrid,r={plusicon:d.icon_plus,minusicon:d.icon_minus,openicon:d.icon_open,expandOnLoad:!1,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0};if(s.p.subGridOptions=x.extend(r,s.p.subGridOptions||{}),s.p.colNames.unshift(""),s.p.colModel.unshift({name:"subgrid",width:x.jgrid.cell_width?s.p.subGridWidth+s.p.cellLayout:s.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),(i=s.p.subGridModel)[0])for(i[0].align=x.extend([],i[0].align||[]),e=0;e<i[0].name.length;e++)i[0].align[e]=i[0].align[e]||"left"})},addSubGridCell:function(i,e){var s,d,r,t="";return this.each(function(){t=this.formatCol(i,e),d=this.p.id,s=this.p.subGridOptions.plusicon,r=x.jgrid.styleUI[this.p.styleUI||"jQueryUI"].common}),'<td role="gridcell" aria-describedby="'+d+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+t+"><a style='cursor:pointer;' class='ui-sghref'><span class='"+r.icon_base+" "+s+"'></span></a></td>"},addSubGrid:function(m,j){return this.each(function(){var c=this;if(c.grid){var e,s,d,r,t,g=x.jgrid.styleUI[c.p.styleUI||"jQueryUI"].base,b=x.jgrid.styleUI[c.p.styleUI||"jQueryUI"].common,h=function(i,e,s){var d=x("<td align='"+c.p.subGridModel[0].align[s]+"'></td>").html(e);x(i).append(d)},n=function(i,e){var s,d,r,t=x("<table class='"+g.rowTable+" ui-common-table'><tbody></tbody></table>"),n=x("<tr></tr>");for(d=0;d<c.p.subGridModel[0].name.length;d++)s=x("<th class='"+g.headerBox+" ui-th-subgrid ui-th-column ui-th-"+c.p.direction+"'></th>"),x(s).html(c.p.subGridModel[0].name[d]),x(s).width(c.p.subGridModel[0].width[d]),x(n).append(s);x(t).append(n),i&&(r=c.p.xmlReader.subgrid,x(r.root+" "+r.row,i).each(function(){if(n=x("<tr class='"+b.content+" ui-subtblcell'></tr>"),!0===r.repeatitems)x(r.cell,this).each(function(i){h(n,x(this).text()||"&#160;",i)});else{var i=c.p.subGridModel[0].mapping||c.p.subGridModel[0].name;if(i)for(d=0;d<i.length;d++)h(n,x.jgrid.getXmlData(this,i[d])||"&#160;",d)}x(t).append(n)}));var a=x("table:first",c.grid.bDiv).attr("id")+"_";return x("#"+x.jgrid.jqID(a+e)).append(t),c.grid.hDiv.loading=!1,x("#load_"+x.jgrid.jqID(c.p.id)).hide(),!1},a=function(i,e){var s,d,r,t,n,a,l=x("<table class='"+g.rowTable+" ui-common-table'><tbody></tbody></table>"),o=x("<tr></tr>");for(r=0;r<c.p.subGridModel[0].name.length;r++)s=x("<th class='"+g.headerBox+" ui-th-subgrid ui-th-column ui-th-"+c.p.direction+"'></th>"),x(s).html(c.p.subGridModel[0].name[r]),x(s).width(c.p.subGridModel[0].width[r]),x(o).append(s);if(x(l).append(o),i&&(n=c.p.jsonReader.subgrid,void 0!==(d=x.jgrid.getAccessor(i,n.root))))for(r=0;r<d.length;r++){if(t=d[r],o=x("<tr class='"+b.content+" ui-subtblcell'></tr>"),!0===n.repeatitems)for(n.cell&&(t=t[n.cell]),a=0;a<t.length;a++)h(o,t[a]||"&#160;",a);else{var p=c.p.subGridModel[0].mapping||c.p.subGridModel[0].name;if(p.length)for(a=0;a<p.length;a++)h(o,x.jgrid.getAccessor(t,p[a])||"&#160;",a)}x(l).append(o)}var u=x("table:first",c.grid.bDiv).attr("id")+"_";return x("#"+x.jgrid.jqID(u+e)).append(l),c.grid.hDiv.loading=!1,x("#load_"+x.jgrid.jqID(c.p.id)).hide(),!1},l=function(i){var e,s,d,r;if(e=x(i).attr("id"),(s={nd_:(new Date).getTime()})[c.p.prmNames.subgridid]=e,!c.p.subGridModel[0])return!1;if(c.p.subGridModel[0].params)for(r=0;r<c.p.subGridModel[0].params.length;r++)for(d=0;d<c.p.colModel.length;d++)c.p.colModel[d].name===c.p.subGridModel[0].params[r]&&(s[c.p.colModel[d].name]=x("td:eq("+d+")",i).text().replace(/\&#160\;/gi,""));if(!c.grid.hDiv.loading)switch(c.grid.hDiv.loading=!0,x("#load_"+x.jgrid.jqID(c.p.id)).show(),c.p.subgridtype||(c.p.subgridtype=c.p.datatype),x.isFunction(c.p.subgridtype)?c.p.subgridtype.call(c,s):c.p.subgridtype=c.p.subgridtype.toLowerCase(),c.p.subgridtype){case"xml":case"json":x.ajax(x.extend({type:c.p.mtype,url:x.isFunction(c.p.subGridUrl)?c.p.subGridUrl.call(c,s):c.p.subGridUrl,dataType:c.p.subgridtype,data:x.isFunction(c.p.serializeSubGridData)?c.p.serializeSubGridData.call(c,s):s,complete:function(i){"xml"===c.p.subgridtype?n(i.responseXML,e):a(x.jgrid.parse(i.responseText),e),i=null}},x.jgrid.ajaxOptions,c.p.ajaxSubgridOptions||{}))}return!1},o=0;x.each(c.p.colModel,function(){!0!==this.hidden&&"rn"!==this.name&&"cb"!==this.name||o++});var i,p=c.rows.length,u=1,f=x.isFunction(c.p.isHasSubGrid);for(void 0!==j&&0<j&&(p=(u=j)+1);u<p;)x(c.rows[u]).hasClass("jqgrow")&&(c.p.scroll&&x(c.rows[u].cells[m]).off("click"),i=null,f&&(i=c.p.isHasSubGrid.call(c,c.rows[u].id)),!1===i?c.rows[u].cells[m].innerHTML="":x(c.rows[u].cells[m]).on("click",function(){var i=x(this).parent("tr")[0];if(s=c.p.id,e=i.id,t=x("#"+s+"_"+e+"_expandedContent"),x(this).hasClass("sgcollapsed")){if((r=!1!==(r=x(c).triggerHandler("jqGridSubGridBeforeExpand",[s+"_"+e,e]))&&"stop"!==r)&&x.isFunction(c.p.subGridBeforeExpand)&&(r=c.p.subGridBeforeExpand.call(c,s+"_"+e,e)),!1===r)return!1;!0===c.p.subGridOptions.reloadOnExpand||!1===c.p.subGridOptions.reloadOnExpand&&!t.hasClass("ui-subgrid")?(d=1<=m?"<td colspan='"+m+"'>&#160;</td>":"",x(i).after("<tr role='row' id='"+s+"_"+e+"_expandedContent' class='ui-subgrid ui-sg-expanded'>"+d+"<td class='"+b.content+" subgrid-cell'><span class='"+b.icon_base+" "+c.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(c.p.colNames.length-1-o,10)+"' class='"+b.content+" subgrid-data'><div id="+s+"_"+e+" class='tablediv'></div></td></tr>"),x(c).triggerHandler("jqGridSubGridRowExpanded",[s+"_"+e,e]),x.isFunction(c.p.subGridRowExpanded)?c.p.subGridRowExpanded.call(c,s+"_"+e,e):l(i)):t.show().removeClass("ui-sg-collapsed").addClass("ui-sg-expanded"),x(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+b.icon_base+" "+c.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),c.p.subGridOptions.selectOnExpand&&x(c).jqGrid("setSelection",e)}else if(x(this).hasClass("sgexpanded")){if((r=!1!==(r=x(c).triggerHandler("jqGridSubGridRowColapsed",[s+"_"+e,e]))&&"stop"!==r)&&x.isFunction(c.p.subGridRowColapsed)&&(r=c.p.subGridRowColapsed.call(c,s+"_"+e,e)),!1===r)return!1;!0===c.p.subGridOptions.reloadOnExpand?t.remove(".ui-subgrid"):t.hasClass("ui-subgrid")&&t.hide().addClass("ui-sg-collapsed").removeClass("ui-sg-expanded"),x(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+b.icon_base+" "+c.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed"),c.p.subGridOptions.selectOnCollapse&&x(c).jqGrid("setSelection",e)}return!1})),u++;if(!0===c.p.subGridOptions.expandOnLoad){var G=0;c.p.multiselect&&G++,c.p.rownumbers&&G++,x(c.rows).filter(".jqgrow").each(function(i,e){x(e.cells[G]).click()})}c.subGridXml=function(i,e){n(i,e)},c.subGridJson=function(i,e){a(i,e)}}})},expandSubGridRow:function(s){return this.each(function(){if((this.grid||s)&&!0===this.p.subGrid){var i=x(this).jqGrid("getInd",s,!0);if(i){var e=x("td.sgcollapsed",i)[0];e&&x(e).trigger("click")}}})},collapseSubGridRow:function(s){return this.each(function(){if((this.grid||s)&&!0===this.p.subGrid){var i=x(this).jqGrid("getInd",s,!0);if(i){var e=x("td.sgexpanded",i)[0];e&&x(e).trigger("click")}}})},toggleSubGridRow:function(s){return this.each(function(){if((this.grid||s)&&!0===this.p.subGrid){var i=x(this).jqGrid("getInd",s,!0);if(i){var e=x("td.sgcollapsed",i)[0];e?x(e).trigger("click"):(e=x("td.sgexpanded",i)[0])&&x(e).trigger("click")}}})}})});