!function(e,a){document.MBLOADED||("function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(t){return a(e,t)}):e.Mobilebone=a(e,{}))}(this,function(l,L){if(document.MBLOADED)return"Don't repeat load Mobilebone!";var w={},S=[].slice,c=/^#?\w+(?:[\-_]\w+)*$/i,q="WebkitAppearance"in document.documentElement.style||void 0!==document.webkitHidden,T="pushState"in history&&"replaceState"in history;L.support=T;var u=!1;if(L.VERSION="2.7.4",L.captureLink=!0,L.captureForm=!0,L.rootTransition=l,L.mergeCallback=!0,L.classAnimation="slide",L.classPage="page",L.classMask="mask",L.pushStateEnabled=!0,L.evalScript=!1,0<=window.navigator.userAgent.indexOf("Firefox")&&window.top!==window&&(L.pushStateEnabled=!1),0==T)return L;history.popstate=!1,L.transition=function(t,e,a,s){if(0!=arguments.length&&t!=e){3==arguments.length&&1==isNaN(1*a)&&(a=(s=a).back),e=e||null,a=a||!1,s=s||{};function l(a){if(!a||!a.getAttribute)return{};var n={},i=B(a.getAttribute("data-params")||"");return["title","root","form"].forEach(function(t){n[t]=a.getAttribute("data-"+t)||i[t]||s[t]||r[t]}),"string"==typeof n.root&&(n.root=L.getFunction(n.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(t){if(1==L.mergeCallback&&"function"==typeof r[t]){var e=a.getAttribute("data-"+t)||i[t];"function"==typeof n.root[e]?n[t]=function(){r[t].apply(this,arguments),n.root[e].apply(this,arguments)}:"function"==typeof s[t]?n[t]=function(){r[t].apply(this,arguments),s[t].apply(this,arguments)}:n[t]=r[t]}else n[t]=a.getAttribute("data-"+t)||i[t]||s[t]||r[t]}),n}var r={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},n=l(e),c=l(t);if(null!=e&&e.classList){var i=n.preventdefault,o=!1;"string"==typeof i&&(i=n.root[i])}if(null!=t&&t.classList){var u=c.preventdefault,d=!1;"string"==typeof u&&(u=c.root[u])}if("function"==typeof i&&(o=i.call(n.root,t,e,s)),1==o&&i===u)return!1;if("function"==typeof u&&(d=u.call(c.root,t,e,s)),1==d)return!1;function f(r,o){1!=r.flagAniBind&&["animationstart","animationend"].forEach(function(t,e){var a=c[t],n="webkit"+t.replace(/^a|s|e/g,function(t){return t.toUpperCase()}),i=q?n:t;e&&r.addEventListener(i,function(){0==this.classList.contains("in")&&(this.style.display="none"),this.classList.remove(l(this).form)}),"string"==typeof a&&c.root[a]?r.addEventListener(i,function(){o.root[a].call(o.root,this,this.classList.contains("in")?"into":"out",s)}):"function"==typeof a&&r.addEventListener(i,function(){a.call(o.root,this,this.classList.contains("in")?"into":"out",s)}),r.flagAniBind=!0})}if(null!=e&&e.classList&&1!=o){e.classList.add(n.form),e.offsetWidth=e.offsetWidth,e.style.display="block",e.classList.add("out"),e.classList.remove("in"),e.classList[a?"add":"remove"]("reverse"),e.removeSelf=e.removeSelf||null,f(e,n);var p=n.fallback;"string"==typeof p&&(p=n.root[p]),"function"==typeof p&&p.call(n.root,t,e,s)}if(null!=t&&t.classList){var h=c.title,m=document.querySelector("h1"),g=document.querySelector("."+this.classPage);h&&!1!==s.title?(document.title=h,m&&(m.innerHTML=h,m.title=h)):g==t&&!e&&document.title&&t.setAttribute("data-title",document.title);var y=s.id||t.id,v=s.id||t.id;e&&t.classList.add(c.form),t.offsetWidth=t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[a?"add":"remove"]("reverse");var b=c.onpagefirstinto;t.firstintoBind||("string"==typeof b&&c.root[b]?c.root[b].call(c.root,t,e,s):"function"==typeof b&&b.call(c.root,t,e,s),S.call(t.querySelectorAll("form")).forEach(function(t){L.submit(t)}),t.firstintoBind=!0),f(t,c);var k,A=v;A&&0==/^#/.test(A)&&(A="#"+A),k=A.replace(/^#/,"#&"),T&&this.pushStateEnabled&&!1!==s.history&&A&&k!=location.hash&&(history.popstate=!1,history[e?"pushState":"replaceState"](null,document.title,A.replace(/^#/,"#&"))),w[y]||(w[y]=t);var E=c.callback;"string"==typeof E&&(E=c.root[E]),"function"==typeof E&&E.call(c.root,t,e,s),setTimeout(function(){history.popstate=!0},17)}}},L.remove=function(t){if(!t)return this;var e=t,a=t;if("string"==typeof a?e=w[a]:e.tagName&&"a"==e.tagName.toLowerCase()&&(a=this.getCleanUrl(e),e=w[a]),e&&e.parentElement)for(var n in e.parentElement.removeChild(e),w)w[n]==e&&delete w[n]},L.getCleanUrl=function(t,e,a){var n="",i="",r="";if(t)if(1==t.nodeType)if(t.action){if(n=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return n;window.$&&$.fn&&$.fn.serialize?i=$(t).serialize():(i={},S.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){if(t.name&&!t.disabled){var e=t.value.trim(),a=t.name;/^radio|checkbox/i.test(t.type)?t.checked&&(i[a]?i[a].push(e):i[a]=[e]):i[a]=[e]}}))}else{n=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-data")||"";var o="container",s=t.getAttribute("data-"+o);if(-1==i.indexOf(o)&&s){var l=o+"="+s;i=i?i+"&"+l:l}}else t.url&&(n=t.url,i=t.data);if(!(n=n||e))return"";if("object"==typeof(i=i||a||"")){var c=[];for(key in i)i[key].forEach||(i[key]=[i[key]]),i[key].forEach(function(t){c.push(key+"="+encodeURIComponent(t))});i=0<c.length?c.join("&"):""}return"?"==(r=n.split("#")[0].replace(/&+$/,"")).slice(-1)&&(r=r.split("?")[0]),""!=i&&(/\?/.test(r)?r=r+"&"+(i=i.replace(/^&|\?/,"")):""!=i&&(r=r+"?"+(i=i.replace("?","")))),r},L.createPage=function(t,e,a){var n=null,i=null,r=this.classPage,o=null;if(t){void 0===a&&"object"==typeof e&&(a=e),a=a||{};var s,l,c,u={};e&&(1==e.nodeType?((e.href||e.action)&&(s=e.getAttribute("data-title")||a.title),n=a.response,l=e.getAttribute("data-container"),i=document.getElementById(l),c=e.getAttribute("data-classpage"),o=(u.target=e).getAttribute("data-reload"),("form"==e.tagName.toLowerCase()||null!==o&&"false"!=o)&&(u.reload=!0),u.back="back"==e.getAttribute("data-rel"),"false"==e.getAttribute("data-history")&&(u.history=!1)):(n=e.response||a.response,s=e.title||a.title,i=e.container||a.container,c=e.classPage||a.classPage,u.target=e.target,u.back=e.back||a.back),i&&c&&(r=c));var d=(r==c?i:document).querySelector(".in."+r),f=null,p=document.createElement("div");"string"==typeof t?p.innerHTML=t:p.appendChild(t),1==L.evalScript&&1!=t.firstintoBind&&S.call(p.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.getAttribute("type");if(""!=e.trim()&&!t.src){var n=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");a&&(i.type=a),i.appendChild(document.createTextNode(e)),setTimeout(function(){n.insertBefore(i,n.firstChild),n.removeChild(i),i=null},17),t=null}});var h=p.getElementsByTagName("title")[0];(f=p.querySelector("."+r))||(p.className=r+" out",f=p),"string"==typeof s?f.setAttribute("data-title",s):h&&h.innerText&&f.setAttribute("data-title",h.innerText),u.response=n||t,u.id=this.getCleanUrl(e)||f.id||a.id||a.url||"unique"+Date.now(),"object"==typeof a&&(void 0!==a.history&&(u.history=a.history),void 0!==a.remove&&(u.remove=a.remove),void 0!==a.target&&(u.target=a.target),void 0!==a.title&&(u.title=a.title),void 0!==a.query&&(u.query=a.query)),r==c&&(u.history=!1,u.classPage=r),i=i||document.body,1==u.remove&&u.id&&this.remove(u.id);var m=u.id.split("?")[0];m&&w[m]&&i.contains(w[m])?i.insertBefore(f,w[m]):i.appendChild(f),p=null,this.transition(f,d,u)}},L.getFunction=function(t){if("string"==typeof t){for(var e=L.rootTransition,a=t.split("."),n=0;n<a.length&&(e=e[a[n]]);n+=1);return e}},L.ajax=function(a){if(a){var t,e={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},n={},i=null,r=null,o=this.classMask,s={};if(1==a.nodeType){for(c in s=B(a.getAttribute("data-params")||""),e)n[c]=a.getAttribute("data-"+c)||s[c]||e[c],"function"==typeof e[c]&&"string"==typeof n[c]&&(n[c]=this.getFunction(n[c]),"function"!=typeof n[c]&&(n[c]=e[c]));n.url=this.getCleanUrl(a,n.url);var l=B(n.url.split("?")[1]);for(var c in l)void 0===s[c]&&(s[c]=l[c]);n.query=s,n.target=a,n.back="back"==a.getAttribute("data-rel");var u=a.tagName.toLowerCase();if("form"==u)n.type=a.method,r=new FormData(a);else if("a"==u){var d=a.getAttribute("data-container"),f=a.getAttribute("data-classpage"),p=d&&document.getElementById(d);p&&f&&f!=L.classPage&&(n.history=!1,n.title=!1)}"true"!=(t=a.getAttribute("data-mask"))&&""!=t||(i=a.querySelector("."+o))}else{if(!a.url)return;for(key2 in e)n[key2]=a[key2]||e[key2];n.url=this.getCleanUrl(null,n.url,n.data),n.title=a.title,n.back=a.back,n.container=a.container,n.query=B(a.url.split("?")[1])}var h=p||document.body;"string"!=typeof t&&(i=[].slice.call(h.children).filter(function(t){return t.classList.contains(o)})[0]),null==i&&((i=document.createElement("div")).className=o,i.innerHTML='<i class="loading"></i>',"string"==typeof t?a.appendChild(i):h.appendChild(i)),i.style.display="inline",this.showLoading&&this.showLoading();var m=new XMLHttpRequest;m.open(n.type||"GET",n.url+(/\?/.test(n.url)?"&":"?")+"r="+Date.now(),n.async,n.username,n.password),m.timeout=n.timeout,m.onload=function(){var e=null;if(200==m.status){if("json"==n.dataType||"JSON"==n.dataType)try{e=JSON.parse(m.response),n.response=e,L.createPage(L.jsonHandle(e,n),a,n)}catch(t){n.message="JSON parse errorï¼š"+t.message,n.error.call(n,m,m.status)}else if("unknown"==n.dataType){n.history=!1;try{e=JSON.parse(m.response),n.response=e,L.createPage(L.jsonHandle(e,n),a,n)}catch(t){e=m.response,L.createPage(e,a,n)}}else e=m.response,L.createPage(e,a,n);n.success.call(n,e,m.status)}else n.message="The status code exception!",n.error.call(n,m,m.status);n.complete.call(n,m,m.status),i.style.display="none",this.hideLoading&&this.hideLoading()},m.onerror=function(t){n.message="Illegal request address or an unexpected network error!",n.error.call(n,m,m.status),i.style.display="none",this.hideLoading&&this.hideLoading()},m.ontimeout=function(){n.message="The request timeout!",n.error.call(n,m,m.status),i.style.display="none",this.hideLoading&&this.hideLoading()},m.setRequestHeader("Type","ajax"),m.setRequestHeader("From","mobilebone"),m.send(r)}},L.submit=function(t){if(t&&"string"==typeof t.action){var e=t.getAttribute("data-ajax");"false"==e||0==L.captureForm&&"true"!=e||t.addEventListener("submit",function(t){var e=this.getAttribute("data-preventdefault"),a=L.getFunction(e);if("function"==typeof a&&1==a(this))return t.preventDefault(),!1;L.ajax(this),t.preventDefault()})}},L.isBack=function(t,e){return 1==history.tempBack?!(history.tempBack=null):void 0===t||!!e&&4==t.compareDocumentPosition(e)},L.jsonHandle=function(t,e){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},L.init=function(){if(1==u)return"Don't repeat initialization!";var t=location.hash.replace("#&","#"),e=null,a=null,n=t.split("?")[0],i=t.split("?")[1],r={query:{}};i&&(r.query=B(i)),""==n||"#"==n?this.transition(document.querySelector("."+this.classPage)):1==c.test(n)&&(e=document.querySelector(n))&&e.classList.contains(this.classPage)?(r.id=t.replace(/^#/,""),this.transition(e,null,r)):(2==t.split("container=").length&&(a=document.getElementById(t.split("container=")[1].split("&")[0])),this.ajax({url:t.replace("#",""),dataType:"unknown",container:a,error:function(){r.id=t.replace(/^#/,""),e=document.querySelector("."+L.classPage),L.transition(e,null,r)}}));var o=l.$||l.jQuery||l.Zepto;o&&o.fn&&o.fn.tap&&"ontouchstart"in window==1?(o(document).tap(this.handleTapEvent),document.addEventListener("click",function(t){var e=t.target;if(e&&("a"==e.tagName.toLowerCase()||(e=e.getParentElementByTag("a")))){var a=e.getAttribute("data-ajax"),n=e.href;"external"==e.getAttribute("data-rel")||"false"==a||n.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0]&&"true"!=a||0==L.captureLink&&"true"!=a?/^http/i.test(n)&&(location.href=n):t.preventDefault()}})):document.addEventListener("click",this.handleTapEvent);var s=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.hidden&&!window.chrome;"ontouchstart"in window==1&&s&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),u=!0},L.handleTapEvent=function(t){var e=null;t&&1==t.nodeType&&((e=t).preventDefault=function(){});var a=(e=e||t.target||t.touches[0]).href;a&&0!=/a/i.test(e.tagName)||!(e=e.getParentElementByTag("a"))||(a=e.href);var n=document.querySelector(".in."+L.classPage);if(null!=n&&e){var i={target:e},r=e.getAttribute("data-preventdefault")||B(e.getAttribute("data-params")||"").preventdefault,o=L.getFunction(r);if("function"==typeof o&&1==o(e))return t.preventDefault(),!1;var s=e.getElementsByClassName(L.classMask)[0];if(s&&"none"!=s.style.display)return t.preventDefault(),!1;var l=e.getAttribute("data-container"),c=e.getAttribute("data-classpage"),u=l&&document.getElementById(l);u&&c&&c!=L.classPage&&(n=u.querySelector(".in."+c)||u.querySelector(c),i.history=!1,i.title=!1,i.classPage=c),"false"==e.getAttribute("data-history")&&(i.history=!1);var d=1==L.captureLink,f=e.getAttribute("data-rel"),p=!1;"back"==f&&(p=!0);var h="external"==f;if(a)if(a=a.replace("#&","#"),""!==e.getAttribute("href").replace(/#/g,"")){if(/^javascript/.test(a)){if(0==p)return}else if((1==(h=h||a.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0])||0==d)&&"true"!=e.getAttribute("data-ajax"))return;var m=e.getAttribute("href");if(1==/^#/.test(m)){var g=a.split("#")[1],y=g.split("?")[0],v=g.split("?")[1];i.query=B(v),i.id=g;var b=y&&document.getElementById(y);0==p&&"auto"==f&&(p=L.isBack(b,n)),b&&L.transition(b,n,p,i),t.preventDefault()}else if(/^javascript/.test(a))history.tempBack=!0,history.back();else if("false"!=e.getAttribute("data-ajax")){var k=L.getCleanUrl(e);i.query=B(k.split("?")[1]);var A=e.getAttribute("data-reload");if(null!=A&&"false"!=A||!w[k])"string"==typeof A&&"false"!=A&&(""!=A&&"true"!=A?S.call(document.querySelectorAll('a[data-reload="'+A+'"]')).forEach(function(t){L.remove(t)}):L.remove(w[k])),L.ajax(e);else{0==p&&"auto"==f&&(p=L.isBack(w[k],n)),i.id=k;var E=u||document.body;0==E.contains(w[k])&&E.appendChild(w[k]),L.transition(w[k],n,p,i)}t.preventDefault()}}else t.preventDefault()}},Element.prototype.getParentElementByTag=function(e){if(!e)return null;var a=null,n=this,i=function(){if(!(n=n.parentElement))return null;var t=n.tagName.toLowerCase();t===e?a=n:"body"==t?a=null:i()};return i(),a};var B=function(t){var a={};return"string"==typeof t&&t.split("&").forEach(function(t){var e=t.split("=");1<e.length&&(a[e[0]]=t.replace(e[0]+"=",""))}),a};return window.addEventListener("DOMContentLoaded",function(){0==u&&L.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0!=history.popstate){var t=location.hash.replace("#&","#").replace(/^#/,""),e=t.split("?")[0],a=null,n=null;if(""==t){if((a=document.querySelector("."+L.classPage)).id)return}else if(a=w[e]||w[t],2==t.split("container=").length&&(n=document.getElementById(t.split("container=")[1].split("&")[0])),a&&0==c.test(e))return void L.transition(a,document.querySelector(".in."+L.classPage),!0,{id:t,history:!1,container:n,query:B(t.split("?")[1])});if(!a){if(0==c.test(t))return void L.ajax({url:t,dataType:"unknown",back:L.isBack(),container:n});a=document.querySelector("#"+e)||document.querySelector("#"+t)}var i=document.querySelector(".in."+L.classPage);a&&a==i||0==L.pushStateEnabled||a&&L.transition(a,i,L.isBack(a,i),{id:t,history:!1,query:B(t.split("?")[1])})}else history.popstate=!0}),document.MBLOADED=!0,L});