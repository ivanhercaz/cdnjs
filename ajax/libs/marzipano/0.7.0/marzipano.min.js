!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Marzipano=t()}}(function(){var Wt;return function o(s,a,l){function h(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[e]={exports:{}};s[e][0].call(r.exports,function(t){return h(s[e][1][t]||t)},r,r.exports,o,s,a,l)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(t,e,i){var n,r;n=this,r=function(){function s(i){function t(t){var e=i.match(t);return e&&1<e.length&&e[1]||""}function e(t){var e=i.match(t);return e&&1<e.length&&e[2]||""}var n,r=t(/(ipod|iphone|ipad)/i).toLowerCase(),o=!/like android/i.test(i)&&/android/i.test(i),s=/nexus\s*[0-6]\s*/i.test(i),a=!s&&/nexus\s*[0-9]+/i.test(i),l=/CrOS/.test(i),h=/silk/i.test(i),u=/sailfish/i.test(i),c=/tizen/i.test(i),p=/(web|hpw)os/i.test(i),d=/windows phone/i.test(i),f=(/SamsungBrowser/i.test(i),!d&&/windows/i.test(i)),m=!r&&!h&&/macintosh/i.test(i),v=!o&&!u&&!c&&!p&&/linux/i.test(i),_=e(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),y=t(/version\/(\d+(\.\d+)?)/i),g=/tablet/i.test(i)&&!/tablet pc/i.test(i),x=!g&&/[^-]mobi/i.test(i),w=/xbox/i.test(i);/opera/i.test(i)?n={name:"Opera",opera:S,version:y||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(i)?n={name:"Opera",opera:S,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||y}:/SamsungBrowser/i.test(i)?n={name:"Samsung Internet for Android",samsungBrowser:S,version:y||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(i)?n={name:"Opera Coast",coast:S,version:y||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(i)?n={name:"Yandex Browser",yandexbrowser:S,version:y||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(i)?n={name:"UC Browser",ucbrowser:S,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(i)?n={name:"Maxthon",maxthon:S,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(i)?n={name:"Epiphany",epiphany:S,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(i)?n={name:"Puffin",puffin:S,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(i)?n={name:"Sleipnir",sleipnir:S,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(i)?n={name:"K-Meleon",kMeleon:S,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:d?(n={name:"Windows Phone",osname:"Windows Phone",windowsphone:S},_?(n.msedge=S,n.version=_):(n.msie=S,n.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(i)?n={name:"Internet Explorer",msie:S,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:l?n={name:"Chrome",osname:"Chrome OS",chromeos:S,chromeBook:S,chrome:S,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(i)?n={name:"Microsoft Edge",msedge:S,version:_}:/vivaldi/i.test(i)?n={name:"Vivaldi",vivaldi:S,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||y}:u?n={name:"Sailfish",osname:"Sailfish OS",sailfish:S,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(i)?n={name:"SeaMonkey",seamonkey:S,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(i)?(n={name:"Firefox",firefox:S,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(i)&&(n.firefoxos=S,n.osname="Firefox OS")):h?n={name:"Amazon Silk",silk:S,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(i)?n={name:"PhantomJS",phantom:S,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(i)?n={name:"SlimerJS",slimer:S,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(i)||/rim\stablet/i.test(i)?n={name:"BlackBerry",osname:"BlackBerry OS",blackberry:S,version:y||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(n={name:"WebOS",osname:"WebOS",webos:S,version:y||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(i)&&(n.touchpad=S)):/bada/i.test(i)?n={name:"Bada",osname:"Bada",bada:S,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:c?n={name:"Tizen",osname:"Tizen",tizen:S,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||y}:/qupzilla/i.test(i)?n={name:"QupZilla",qupzilla:S,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||y}:/chromium/i.test(i)?n={name:"Chromium",chromium:S,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||y}:/chrome|crios|crmo/i.test(i)?n={name:"Chrome",chrome:S,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?n={name:"Android",version:y}:/safari|applewebkit/i.test(i)?(n={name:"Safari",safari:S},y&&(n.version=y)):r?(n={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},y&&(n.version=y)):n=/googlebot/i.test(i)?{name:"Googlebot",googlebot:S,version:t(/googlebot\/(\d+(\.\d+))/i)||y}:{name:t(/^(.*)\/(.*) /),version:e(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(i)?(/(apple)?webkit\/537\.36/i.test(i)?(n.name=n.name||"Blink",n.blink=S):(n.name=n.name||"Webkit",n.webkit=S),!n.version&&y&&(n.version=y)):!n.opera&&/gecko\//i.test(i)&&(n.name=n.name||"Gecko",n.gecko=S,n.version=n.version||t(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||!o&&!n.silk?!n.windowsphone&&r?(n[r]=S,n.ios=S,n.osname="iOS"):m?(n.mac=S,n.osname="macOS"):w?(n.xbox=S,n.osname="Xbox"):f?(n.windows=S,n.osname="Windows"):v&&(n.linux=S,n.osname="Linux"):(n.android=S,n.osname="Android");var M="";n.windows?M=function(){switch(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}():n.windowsphone?M=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?M=(M=t(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):r?M=(M=t(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):o?M=t(/android[ \/-](\d+(\.\d+)*)/i):n.webos?M=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?M=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?M=t(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(M=t(/tizen[\/\s](\d+(\.\d+)*)/i)),M&&(n.osversion=M);var b=!n.windows&&M.split(".")[0];return g||a||"ipad"==r||o&&(3==b||4<=b&&!x)||n.silk?n.tablet=S:(x||"iphone"==r||"ipod"==r||o||s||n.blackberry||n.webos||n.bada)&&(n.mobile=S),n.msedge||n.msie&&10<=n.version||n.yandexbrowser&&15<=n.version||n.vivaldi&&1<=n.version||n.chrome&&20<=n.version||n.samsungBrowser&&4<=n.version||n.firefox&&20<=n.version||n.safari&&6<=n.version||n.opera&&10<=n.version||n.ios&&n.osversion&&6<=n.osversion.split(".")[0]||n.blackberry&&10.1<=n.version||n.chromium&&20<=n.version?n.a=S:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=S:n.x=S,n}function n(t){return t.split(".").length}function r(t,e){var i,n=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(i=0;i<t.length;i++)n.push(e(t[i]));return n}function a(t){for(var i=Math.max(n(t[0]),n(t[1])),e=r(t,function(t){var e=i-n(t);return r((t+=new Array(1+e).join(".0")).split("."),function(t){return new Array(20-t.length).join("0")+t}).reverse()});0<=--i;){if(e[0][i]>e[1][i])return 1;if(e[0][i]!==e[1][i])return-1;if(0===i)return 0}}function o(t,e,i){var n=l;"string"==typeof e&&(i=e,e=void 0),void 0===e&&(e=!1),i&&(n=s(i));var r=""+n.version;for(var o in t)if(t.hasOwnProperty(o)&&n[o]){if("string"!=typeof t[o])throw new Error("Browser version in the minVersion map should be a string: "+o+": "+String(t));return a([r,t[o]])<0}return e}var S=!0,l=s("undefined"!=typeof navigator&&navigator.userAgent||"");return l.test=function(t){for(var e=0;e<t.length;++e){var i=t[e];if("string"==typeof i&&i in l)return!0}return!1},l.isUnsupportedBrowser=o,l.compareVersions=a,l.check=function(t,e,i){return!o(t,e,i)},l._detect=s,l.detect=s,l},void 0!==e&&e.exports?e.exports=r():n.bowser=r()},{}],2:[function(t,e,i){i.glMatrix=t("./gl-matrix/common.js"),i.mat2=t("./gl-matrix/mat2.js"),i.mat2d=t("./gl-matrix/mat2d.js"),i.mat3=t("./gl-matrix/mat3.js"),i.mat4=t("./gl-matrix/mat4.js"),i.quat=t("./gl-matrix/quat.js"),i.vec2=t("./gl-matrix/vec2.js"),i.vec3=t("./gl-matrix/vec3.js"),i.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":3,"./gl-matrix/mat2.js":4,"./gl-matrix/mat2d.js":5,"./gl-matrix/mat3.js":6,"./gl-matrix/mat4.js":7,"./gl-matrix/quat.js":8,"./gl-matrix/vec2.js":9,"./gl-matrix/vec3.js":10,"./gl-matrix/vec4.js":11}],3:[function(t,e,i){var n={EPSILON:1e-6};n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===this.Float32Array&&"undefined"!=typeof SIMD,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(t){n.ARRAY_TYPE=t};var r=Math.PI/180;n.toRadian=function(t){return t*r},n.equals=function(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.exports=n},{}],4:[function(t,e,i){var u=t("./common.js"),n={create:function(){var t=new u.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new u.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,e,i,n){var r=new u.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},set:function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},transpose:function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*o-r*n;return s?(s=1/s,t[0]=o*s,t[1]=-n*s,t[2]=-r*s,t[3]=i*s,t):null},adjoint:function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],l=i[1],h=i[2],u=i[3];return t[0]=n*a+o*l,t[1]=r*a+s*l,t[2]=n*h+o*u,t[3]=r*h+s*u,t}};n.mul=n.multiply,n.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*a,t[1]=r*l+s*a,t[2]=n*-a+o*l,t[3]=r*-a+s*l,t},n.scale=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],l=i[1];return t[0]=n*a,t[1]=r*a,t[2]=o*l,t[3]=s*l,t},n.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},n.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},n.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=e[0],a=e[1],l=e[2],h=e[3];return Math.abs(i-s)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-h)<=u.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},e.exports=n},{"./common.js":3}],5:[function(t,e,i){var f=t("./common.js"),n={create:function(){var t=new f.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new f.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,e,i,n,r,o){var s=new f.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s},set:function(t,e,i,n,r,o,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=i*o-n*r;return l?(l=1/l,t[0]=o*l,t[1]=-n*l,t[2]=-r*l,t[3]=i*l,t[4]=(r*a-o*s)*l,t[5]=(n*s-i*a)*l,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=i[0],u=i[1],c=i[2],p=i[3],d=i[4],f=i[5];return t[0]=n*h+o*u,t[1]=r*h+s*u,t[2]=n*c+o*p,t[3]=r*c+s*p,t[4]=n*d+o*f+a,t[5]=r*d+s*f+l,t}};n.mul=n.multiply,n.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=Math.sin(i),u=Math.cos(i);return t[0]=n*u+o*h,t[1]=r*u+s*h,t[2]=n*-h+o*u,t[3]=r*-h+s*u,t[4]=a,t[5]=l,t},n.scale=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=i[0],u=i[1];return t[0]=n*h,t[1]=r*h,t[2]=o*u,t[3]=s*u,t[4]=a,t[5]=l,t},n.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=i[0],u=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=n*h+o*u+a,t[5]=r*h+s*u+l,t},n.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},n.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},n.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=e[0],h=e[1],u=e[2],c=e[3],p=e[4],d=e[5];return Math.abs(i-l)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-u)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-c)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-p)<=f.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-d)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},e.exports=n},{"./common.js":3}],6:[function(t,e,i){var x=t("./common.js"),n={create:function(){var t=new x.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new x.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,i,n,r,o,s,a,l){var h=new x.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=i,h[3]=n,h[4]=r,h[5]=o,h[6]=s,h[7]=a,h[8]=l,h},set:function(t,e,i,n,r,o,s,a,l,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=u*s-a*h,p=-u*o+a*l,d=h*o-s*l,f=i*c+n*p+r*d;return f?(f=1/f,t[0]=c*f,t[1]=(-u*n+r*h)*f,t[2]=(a*n-r*s)*f,t[3]=p*f,t[4]=(u*i-r*l)*f,t[5]=(-a*i+r*o)*f,t[6]=d*f,t[7]=(-h*i+n*l)*f,t[8]=(s*i-n*o)*f,t):null},adjoint:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],h=e[7],u=e[8];return t[0]=s*u-a*h,t[1]=r*h-n*u,t[2]=n*a-r*s,t[3]=a*l-o*u,t[4]=i*u-r*l,t[5]=r*o-i*a,t[6]=o*h-s*l,t[7]=n*l-i*h,t[8]=i*s-n*o,t},determinant:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],h=t[8];return e*(h*o-s*l)+i*(-h*r+s*a)+n*(l*r-o*a)},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],p=i[0],d=i[1],f=i[2],m=i[3],v=i[4],_=i[5],y=i[6],g=i[7],x=i[8];return t[0]=p*n+d*s+f*h,t[1]=p*r+d*a+f*u,t[2]=p*o+d*l+f*c,t[3]=m*n+v*s+_*h,t[4]=m*r+v*a+_*u,t[5]=m*o+v*l+_*c,t[6]=y*n+g*s+x*h,t[7]=y*r+g*a+x*u,t[8]=y*o+g*l+x*c,t}};n.mul=n.multiply,n.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],p=i[0],d=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=p*n+d*s+h,t[7]=p*r+d*a+u,t[8]=p*o+d*l+c,t},n.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],p=Math.sin(i),d=Math.cos(i);return t[0]=d*n+p*s,t[1]=d*r+p*a,t[2]=d*o+p*l,t[3]=d*s-p*n,t[4]=d*a-p*r,t[5]=d*l-p*o,t[6]=h,t[7]=u,t[8]=c,t},n.scale=function(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},n.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},n.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,l=r+r,h=i*s,u=n*s,c=n*a,p=r*s,d=r*a,f=r*l,m=o*s,v=o*a,_=o*l;return t[0]=1-c-f,t[3]=u-_,t[6]=p+v,t[1]=u+_,t[4]=1-h-f,t[7]=d-m,t[2]=p-v,t[5]=d+m,t[8]=1-h-c,t},n.normalFromMat4=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=e[9],p=e[10],d=e[11],f=e[12],m=e[13],v=e[14],_=e[15],y=i*a-n*s,g=i*l-r*s,x=i*h-o*s,w=n*l-r*a,M=n*h-o*a,b=r*h-o*l,S=u*m-c*f,I=u*v-p*f,E=u*_-d*f,D=c*v-p*m,L=c*_-d*m,T=p*_-d*v,F=y*T-g*L+x*D+w*E-M*I+b*S;return F?(F=1/F,t[0]=(a*T-l*L+h*D)*F,t[1]=(l*E-s*T-h*I)*F,t[2]=(s*L-a*E+h*S)*F,t[3]=(r*L-n*T-o*D)*F,t[4]=(i*T-r*E+o*I)*F,t[5]=(n*E-i*L-o*S)*F,t[6]=(m*b-v*M+_*w)*F,t[7]=(v*x-f*b-_*g)*F,t[8]=(f*M-m*x+_*y)*F,t):null},n.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},n.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],h=t[7],u=t[8],c=e[0],p=e[1],d=e[2],f=e[3],m=e[4],v=e[5],_=e[6],y=e[7],g=e[8];return Math.abs(i-c)<=x.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-p)<=x.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(r-d)<=x.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-f)<=x.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=x.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-v)<=x.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-_)<=x.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-y)<=x.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(u-g)<=x.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))},e.exports=n},{"./common.js":3}],7:[function(t,e,i){var A=t("./common.js"),b={scalar:{},SIMD:{},create:function(){var t=new A.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new A.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,e,i,n,r,o,s,a,l,h,u,c,p,d,f,m){var v=new A.ARRAY_TYPE(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=n,v[4]=r,v[5]=o,v[6]=s,v[7]=a,v[8]=l,v[9]=h,v[10]=u,v[11]=c,v[12]=p,v[13]=d,v[14]=f,v[15]=m,v},set:function(t,e,i,n,r,o,s,a,l,h,u,c,p,d,f,m,v){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=h,t[9]=u,t[10]=c,t[11]=p,t[12]=d,t[13]=f,t[14]=m,t[15]=v,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}};b.scalar.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=r,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},b.SIMD.transpose=function(t,e){var i,n,r,o,s,a,l,h,u,c;return i=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.shuffle(i,n,0,1,4,5),a=SIMD.Float32x4.shuffle(r,o,0,1,4,5),l=SIMD.Float32x4.shuffle(s,a,0,2,4,6),h=SIMD.Float32x4.shuffle(s,a,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,h),s=SIMD.Float32x4.shuffle(i,n,2,3,6,7),a=SIMD.Float32x4.shuffle(r,o,2,3,6,7),u=SIMD.Float32x4.shuffle(s,a,0,2,4,6),c=SIMD.Float32x4.shuffle(s,a,1,3,5,7),SIMD.Float32x4.store(t,8,u),SIMD.Float32x4.store(t,12,c),t},b.transpose=A.USE_SIMD?b.SIMD.transpose:b.scalar.transpose,b.scalar.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=e[9],p=e[10],d=e[11],f=e[12],m=e[13],v=e[14],_=e[15],y=i*a-n*s,g=i*l-r*s,x=i*h-o*s,w=n*l-r*a,M=n*h-o*a,b=r*h-o*l,S=u*m-c*f,I=u*v-p*f,E=u*_-d*f,D=c*v-p*m,L=c*_-d*m,T=p*_-d*v,F=y*T-g*L+x*D+w*E-M*I+b*S;return F?(F=1/F,t[0]=(a*T-l*L+h*D)*F,t[1]=(r*L-n*T-o*D)*F,t[2]=(m*b-v*M+_*w)*F,t[3]=(p*M-c*b-d*w)*F,t[4]=(l*E-s*T-h*I)*F,t[5]=(i*T-r*E+o*I)*F,t[6]=(v*x-f*b-_*g)*F,t[7]=(u*b-p*x+d*g)*F,t[8]=(s*L-a*E+h*S)*F,t[9]=(n*E-i*L-o*S)*F,t[10]=(f*M-m*x+_*y)*F,t[11]=(c*x-u*M-d*y)*F,t[12]=(a*I-s*D-l*S)*F,t[13]=(i*D-n*I+r*S)*F,t[14]=(m*g-f*w-v*y)*F,t[15]=(u*w-c*g+p*y)*F,t):null},b.SIMD.invert=function(t,e){var i,n,r,o,s,a,l,h,u,c,p=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),f=SIMD.Float32x4.load(e,8),m=SIMD.Float32x4.load(e,12);return s=SIMD.Float32x4.shuffle(p,d,0,1,4,5),n=SIMD.Float32x4.shuffle(f,m,0,1,4,5),i=SIMD.Float32x4.shuffle(s,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,s,1,3,5,7),s=SIMD.Float32x4.shuffle(p,d,2,3,6,7),o=SIMD.Float32x4.shuffle(f,m,2,3,6,7),r=SIMD.Float32x4.shuffle(s,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,s,1,3,5,7),s=SIMD.Float32x4.mul(r,o),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.mul(n,s),l=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,s),a),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),s=SIMD.Float32x4.mul(n,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),a),u=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(o,s)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),s=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),o),s=SIMD.Float32x4.swizzle(s,1,0,3,2),r=SIMD.Float32x4.swizzle(r,2,3,0,1),a=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),a),h=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(r,s)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),s=SIMD.Float32x4.mul(i,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),h),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),u),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,s),h),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(r,s)),s=SIMD.Float32x4.mul(i,o),s=SIMD.Float32x4.swizzle(s,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,s)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),h),s=SIMD.Float32x4.swizzle(s,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),l),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,s)),s=SIMD.Float32x4.mul(i,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,s)),s=SIMD.Float32x4.swizzle(s,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(o,s)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),u),c=SIMD.Float32x4.mul(i,a),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c),s=SIMD.Float32x4.reciprocalApproximation(c),c=SIMD.Float32x4.sub(SIMD.Float32x4.add(s,s),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(s,s))),(c=SIMD.Float32x4.swizzle(c,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(c,a)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(c,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(c,h)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(c,u)),t):null},b.invert=A.USE_SIMD?b.SIMD.invert:b.scalar.invert,b.scalar.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=e[9],p=e[10],d=e[11],f=e[12],m=e[13],v=e[14],_=e[15];return t[0]=a*(p*_-d*v)-c*(l*_-h*v)+m*(l*d-h*p),t[1]=-(n*(p*_-d*v)-c*(r*_-o*v)+m*(r*d-o*p)),t[2]=n*(l*_-h*v)-a*(r*_-o*v)+m*(r*h-o*l),t[3]=-(n*(l*d-h*p)-a*(r*d-o*p)+c*(r*h-o*l)),t[4]=-(s*(p*_-d*v)-u*(l*_-h*v)+f*(l*d-h*p)),t[5]=i*(p*_-d*v)-u*(r*_-o*v)+f*(r*d-o*p),t[6]=-(i*(l*_-h*v)-s*(r*_-o*v)+f*(r*h-o*l)),t[7]=i*(l*d-h*p)-s*(r*d-o*p)+u*(r*h-o*l),t[8]=s*(c*_-d*m)-u*(a*_-h*m)+f*(a*d-h*c),t[9]=-(i*(c*_-d*m)-u*(n*_-o*m)+f*(n*d-o*c)),t[10]=i*(a*_-h*m)-s*(n*_-o*m)+f*(n*h-o*a),t[11]=-(i*(a*d-h*c)-s*(n*d-o*c)+u*(n*h-o*a)),t[12]=-(s*(c*v-p*m)-u*(a*v-l*m)+f*(a*p-l*c)),t[13]=i*(c*v-p*m)-u*(n*v-r*m)+f*(n*p-r*c),t[14]=-(i*(a*v-l*m)-s*(n*v-r*m)+f*(n*l-r*a)),t[15]=i*(a*p-l*c)-s*(n*p-r*c)+u*(n*l-r*a),t},b.SIMD.adjoint=function(t,e){var i,n,r,o,s,a,l,h,u,c,p,d,f;return i=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),u=SIMD.Float32x4.shuffle(i,n,0,1,4,5),a=SIMD.Float32x4.shuffle(r,o,0,1,4,5),s=SIMD.Float32x4.shuffle(u,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,u,1,3,5,7),u=SIMD.Float32x4.shuffle(i,n,2,3,6,7),h=SIMD.Float32x4.shuffle(r,o,2,3,6,7),l=SIMD.Float32x4.shuffle(u,h,0,2,4,6),h=SIMD.Float32x4.shuffle(h,u,1,3,5,7),u=SIMD.Float32x4.mul(l,h),u=SIMD.Float32x4.swizzle(u,1,0,3,2),c=SIMD.Float32x4.mul(a,u),p=SIMD.Float32x4.mul(s,u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,u),c),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,u),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),u=SIMD.Float32x4.mul(a,l),u=SIMD.Float32x4.swizzle(u,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,u),c),f=SIMD.Float32x4.mul(s,u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(h,u)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,u),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),u=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,3,0,1),h),u=SIMD.Float32x4.swizzle(u,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,u),c),d=SIMD.Float32x4.mul(s,u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(l,u)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,u),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),u=SIMD.Float32x4.mul(s,a),u=SIMD.Float32x4.swizzle(u,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,u),d),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,u),f),u=SIMD.Float32x4.swizzle(u,2,3,0,1),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,u),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,u)),u=SIMD.Float32x4.mul(s,h),u=SIMD.Float32x4.swizzle(u,1,0,3,2),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,u)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,u),d),u=SIMD.Float32x4.swizzle(u,2,3,0,1),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,u),p),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(a,u)),u=SIMD.Float32x4.mul(s,l),u=SIMD.Float32x4.swizzle(u,1,0,3,2),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,u),p),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(a,u)),u=SIMD.Float32x4.swizzle(u,2,3,0,1),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(h,u)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,u),f),SIMD.Float32x4.store(t,0,c),SIMD.Float32x4.store(t,4,p),SIMD.Float32x4.store(t,8,d),SIMD.Float32x4.store(t,12,f),t},b.adjoint=A.USE_SIMD?b.SIMD.adjoint:b.scalar.adjoint,b.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],p=t[11],d=t[12],f=t[13],m=t[14],v=t[15];return(e*s-i*o)*(c*v-p*m)-(e*a-n*o)*(u*v-p*f)+(e*l-r*o)*(u*m-c*f)+(i*a-n*s)*(h*v-p*d)-(i*l-r*s)*(h*m-c*d)+(n*l-r*a)*(h*f-u*d)},b.SIMD.multiply=function(t,e,i){var n=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.load(i,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,3,3,3,3),s))));SIMD.Float32x4.store(t,0,l);var h=SIMD.Float32x4.load(i,4),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),s))));SIMD.Float32x4.store(t,4,u);var c=SIMD.Float32x4.load(i,8),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),s))));SIMD.Float32x4.store(t,8,p);var d=SIMD.Float32x4.load(i,12),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),s))));return SIMD.Float32x4.store(t,12,f),t},b.scalar.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],p=e[9],d=e[10],f=e[11],m=e[12],v=e[13],_=e[14],y=e[15],g=i[0],x=i[1],w=i[2],M=i[3];return t[0]=g*n+x*a+w*c+M*m,t[1]=g*r+x*l+w*p+M*v,t[2]=g*o+x*h+w*d+M*_,t[3]=g*s+x*u+w*f+M*y,g=i[4],x=i[5],w=i[6],M=i[7],t[4]=g*n+x*a+w*c+M*m,t[5]=g*r+x*l+w*p+M*v,t[6]=g*o+x*h+w*d+M*_,t[7]=g*s+x*u+w*f+M*y,g=i[8],x=i[9],w=i[10],M=i[11],t[8]=g*n+x*a+w*c+M*m,t[9]=g*r+x*l+w*p+M*v,t[10]=g*o+x*h+w*d+M*_,t[11]=g*s+x*u+w*f+M*y,g=i[12],x=i[13],w=i[14],M=i[15],t[12]=g*n+x*a+w*c+M*m,t[13]=g*r+x*l+w*p+M*v,t[14]=g*o+x*h+w*d+M*_,t[15]=g*s+x*u+w*f+M*y,t},b.multiply=A.USE_SIMD?b.SIMD.multiply:b.scalar.multiply,b.mul=b.multiply,b.scalar.translate=function(t,e,i){var n,r,o,s,a,l,h,u,c,p,d,f,m=i[0],v=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*_+e[12],t[13]=e[1]*m+e[5]*v+e[9]*_+e[13],t[14]=e[2]*m+e[6]*v+e[10]*_+e[14],t[15]=e[3]*m+e[7]*v+e[11]*_+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],p=e[9],d=e[10],f=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=h,t[7]=u,t[8]=c,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+a*v+c*_+e[12],t[13]=r*m+l*v+p*_+e[13],t[14]=o*m+h*v+d*_+e[14],t[15]=s*m+u*v+f*_+e[15]),t},b.SIMD.translate=function(t,e,i){var n=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4(i[0],i[1],i[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(a,0,0,0,0)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(a,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(a,2,2,2,2));var l=SIMD.Float32x4.add(n,SIMD.Float32x4.add(r,SIMD.Float32x4.add(o,s)));return SIMD.Float32x4.store(t,12,l),t},b.translate=A.USE_SIMD?b.SIMD.translate:b.scalar.translate,b.scalar.scale=function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},b.SIMD.scale=function(t,e,i){var n,r,o,s=SIMD.Float32x4(i[0],i[1],i[2],0);return n=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,0,0,0,0))),r=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,1,1,1,1))),o=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},b.scale=A.USE_SIMD?b.SIMD.scale:b.scalar.scale,b.rotate=function(t,e,i,n){var r,o,s,a,l,h,u,c,p,d,f,m,v,_,y,g,x,w,M,b,S,I,E,D,L=n[0],T=n[1],F=n[2],C=Math.sqrt(L*L+T*T+F*F);return Math.abs(C)<A.EPSILON?null:(L*=C=1/C,T*=C,F*=C,r=Math.sin(i),s=1-(o=Math.cos(i)),a=e[0],l=e[1],h=e[2],u=e[3],c=e[4],p=e[5],d=e[6],f=e[7],m=e[8],v=e[9],_=e[10],y=e[11],g=L*L*s+o,x=T*L*s+F*r,w=F*L*s-T*r,M=L*T*s-F*r,b=T*T*s+o,S=F*T*s+L*r,I=L*F*s+T*r,E=T*F*s-L*r,D=F*F*s+o,t[0]=a*g+c*x+m*w,t[1]=l*g+p*x+v*w,t[2]=h*g+d*x+_*w,t[3]=u*g+f*x+y*w,t[4]=a*M+c*b+m*S,t[5]=l*M+p*b+v*S,t[6]=h*M+d*b+_*S,t[7]=u*M+f*b+y*S,t[8]=a*I+c*E+m*D,t[9]=l*I+p*E+v*D,t[10]=h*I+d*E+_*D,t[11]=u*I+f*E+y*D,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},b.scalar.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],h=e[8],u=e[9],c=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*n,t[5]=s*r+u*n,t[6]=a*r+c*n,t[7]=l*r+p*n,t[8]=h*r-o*n,t[9]=u*r-s*n,t[10]=c*r-a*n,t[11]=p*r-l*n,t},b.SIMD.rotateX=function(t,e,i){var n=SIMD.Float32x4.splat(Math.sin(i)),r=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,4),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(s,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,r),SIMD.Float32x4.mul(o,n))),t},b.rotateX=A.USE_SIMD?b.SIMD.rotateX:b.scalar.rotateX,b.scalar.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],h=e[8],u=e[9],c=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-h*n,t[1]=s*r-u*n,t[2]=a*r-c*n,t[3]=l*r-p*n,t[8]=o*n+h*r,t[9]=s*n+u*r,t[10]=a*n+c*r,t[11]=l*n+p*r,t},b.SIMD.rotateY=function(t,e,i){var n=SIMD.Float32x4.splat(Math.sin(i)),r=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(s,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(s,r))),t},b.rotateY=A.USE_SIMD?b.SIMD.rotateY:b.scalar.rotateY,b.scalar.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],h=e[4],u=e[5],c=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+h*n,t[1]=s*r+u*n,t[2]=a*r+c*n,t[3]=l*r+p*n,t[4]=h*r-o*n,t[5]=u*r-s*n,t[6]=c*r-a*n,t[7]=p*r-l*n,t},b.SIMD.rotateZ=function(t,e,i){var n=SIMD.Float32x4.splat(Math.sin(i)),r=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(s,n))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,r),SIMD.Float32x4.mul(o,n))),t},b.rotateZ=A.USE_SIMD?b.SIMD.rotateZ:b.scalar.rotateZ,b.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},b.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},b.fromRotation=function(t,e,i){var n,r,o,s=i[0],a=i[1],l=i[2],h=Math.sqrt(s*s+a*a+l*l);return Math.abs(h)<A.EPSILON?null:(s*=h=1/h,a*=h,l*=h,n=Math.sin(e),o=1-(r=Math.cos(e)),t[0]=s*s*o+r,t[1]=a*s*o+l*n,t[2]=l*s*o-a*n,t[3]=0,t[4]=s*a*o-l*n,t[5]=a*a*o+r,t[6]=l*a*o+s*n,t[7]=0,t[8]=s*l*o+a*n,t[9]=a*l*o-s*n,t[10]=l*l*o+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},b.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},b.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},b.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},b.fromRotationTranslation=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=n+n,l=r+r,h=o+o,u=n*a,c=n*l,p=n*h,d=r*l,f=r*h,m=o*h,v=s*a,_=s*l,y=s*h;return t[0]=1-(d+m),t[1]=c+y,t[2]=p-_,t[3]=0,t[4]=c-y,t[5]=1-(u+m),t[6]=f+v,t[7]=0,t[8]=p+_,t[9]=f-v,t[10]=1-(u+d),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},b.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},b.getScaling=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[4],s=e[5],a=e[6],l=e[8],h=e[9],u=e[10];return t[0]=Math.sqrt(i*i+n*n+r*r),t[1]=Math.sqrt(o*o+s*s+a*a),t[2]=Math.sqrt(l*l+h*h+u*u),t},b.getRotation=function(t,e){var i=e[0]+e[5]+e[10],n=0;return 0<i?(n=2*Math.sqrt(i+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},b.fromRotationTranslationScale=function(t,e,i,n){var r=e[0],o=e[1],s=e[2],a=e[3],l=r+r,h=o+o,u=s+s,c=r*l,p=r*h,d=r*u,f=o*h,m=o*u,v=s*u,_=a*l,y=a*h,g=a*u,x=n[0],w=n[1],M=n[2];return t[0]=(1-(f+v))*x,t[1]=(p+g)*x,t[2]=(d-y)*x,t[3]=0,t[4]=(p-g)*w,t[5]=(1-(c+v))*w,t[6]=(m+_)*w,t[7]=0,t[8]=(d+y)*M,t[9]=(m-_)*M,t[10]=(1-(c+f))*M,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},b.fromRotationTranslationScaleOrigin=function(t,e,i,n,r){var o=e[0],s=e[1],a=e[2],l=e[3],h=o+o,u=s+s,c=a+a,p=o*h,d=o*u,f=o*c,m=s*u,v=s*c,_=a*c,y=l*h,g=l*u,x=l*c,w=n[0],M=n[1],b=n[2],S=r[0],I=r[1],E=r[2];return t[0]=(1-(m+_))*w,t[1]=(d+x)*w,t[2]=(f-g)*w,t[3]=0,t[4]=(d-x)*M,t[5]=(1-(p+_))*M,t[6]=(v+y)*M,t[7]=0,t[8]=(f+g)*b,t[9]=(v-y)*b,t[10]=(1-(p+m))*b,t[11]=0,t[12]=i[0]+S-(t[0]*S+t[4]*I+t[8]*E),t[13]=i[1]+I-(t[1]*S+t[5]*I+t[9]*E),t[14]=i[2]+E-(t[2]*S+t[6]*I+t[10]*E),t[15]=1,t},b.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,l=r+r,h=i*s,u=n*s,c=n*a,p=r*s,d=r*a,f=r*l,m=o*s,v=o*a,_=o*l;return t[0]=1-c-f,t[1]=u+_,t[2]=p-v,t[3]=0,t[4]=u-_,t[5]=1-h-f,t[6]=d+m,t[7]=0,t[8]=p+v,t[9]=d-m,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},b.frustum=function(t,e,i,n,r,o,s){var a=1/(i-e),l=1/(r-n),h=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*l,t[10]=(s+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*h,t[15]=0,t},b.perspective=function(t,e,i,n,r){var o=1/Math.tan(e/2),s=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t},b.perspectiveFromFieldOfView=function(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+a),h=2/(r+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(s-a)*l*.5,t[9]=(r-o)*h*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},b.ortho=function(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),h=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(s+o)*h,t[15]=1,t},b.lookAt=function(t,e,i,n){var r,o,s,a,l,h,u,c,p,d,f=e[0],m=e[1],v=e[2],_=n[0],y=n[1],g=n[2],x=i[0],w=i[1],M=i[2];return Math.abs(f-x)<A.EPSILON&&Math.abs(m-w)<A.EPSILON&&Math.abs(v-M)<A.EPSILON?b.identity(t):(u=f-x,c=m-w,p=v-M,r=y*(p*=d=1/Math.sqrt(u*u+c*c+p*p))-g*(c*=d),o=g*(u*=d)-_*p,s=_*c-y*u,(d=Math.sqrt(r*r+o*o+s*s))?(r*=d=1/d,o*=d,s*=d):s=o=r=0,a=c*s-p*o,l=p*r-u*s,h=u*o-c*r,(d=Math.sqrt(a*a+l*l+h*h))?(a*=d=1/d,l*=d,h*=d):h=l=a=0,t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=c,t[7]=0,t[8]=s,t[9]=h,t[10]=p,t[11]=0,t[12]=-(r*f+o*m+s*v),t[13]=-(a*f+l*m+h*v),t[14]=-(u*f+c*m+p*v),t[15]=1,t)},b.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},b.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},b.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},b.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t},b.sub=b.subtract,b.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},b.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},b.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},b.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],h=t[7],u=t[8],c=t[9],p=t[10],d=t[11],f=t[12],m=t[13],v=t[14],_=t[15],y=e[0],g=e[1],x=e[2],w=e[3],M=e[4],b=e[5],S=e[6],I=e[7],E=e[8],D=e[9],L=e[10],T=e[11],F=e[12],C=e[13],z=e[14],R=e[15];return Math.abs(i-y)<=A.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-g)<=A.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-x)<=A.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-w)<=A.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-M)<=A.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(a-b)<=A.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-S)<=A.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-I)<=A.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(u-E)<=A.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-D)<=A.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(p-L)<=A.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(d-T)<=A.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(f-F)<=A.EPSILON*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(m-C)<=A.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(v-z)<=A.EPSILON*Math.max(1,Math.abs(v),Math.abs(z))&&Math.abs(_-R)<=A.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},e.exports=b},{"./common.js":3}],8:[function(t,e,i){var s,a,r,o,l,h,n=t("./common.js"),u=t("./mat3.js"),c=t("./vec3.js"),p=t("./vec4.js"),d={};d.create=function(){var t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},d.rotationTo=(o=c.create(),l=c.fromValues(1,0,0),h=c.fromValues(0,1,0),function(t,e,i){var n=c.dot(e,i);return n<-.999999?(c.cross(o,l,e),c.length(o)<1e-6&&c.cross(o,h,e),c.normalize(o,o),d.setAxisAngle(t,o,Math.PI),t):.999999<n?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(c.cross(o,e,i),t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=1+n,d.normalize(t,t))}),d.setAxes=(r=u.create(),function(t,e,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],d.normalize(t,d.fromMat3(t,r))}),d.clone=p.clone,d.fromValues=p.fromValues,d.copy=p.copy,d.set=p.set,d.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},d.setAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},d.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i},d.add=p.add,d.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],l=i[1],h=i[2],u=i[3];return t[0]=n*u+s*a+r*h-o*l,t[1]=r*u+s*l+o*a-n*h,t[2]=o*u+s*h+n*l-r*a,t[3]=s*u-n*a-r*l-o*h,t},d.mul=d.multiply,d.scale=p.scale,d.rotateX=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+s*a,t[1]=r*l+o*a,t[2]=o*l-r*a,t[3]=s*l-n*a,t},d.rotateY=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l-o*a,t[1]=r*l+s*a,t[2]=o*l+n*a,t[3]=s*l-r*a,t},d.rotateZ=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*a,t[1]=r*l-n*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},d.calculateW=function(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t},d.dot=p.dot,d.lerp=p.lerp,d.slerp=function(t,e,i,n){var r,o,s,a,l,h=e[0],u=e[1],c=e[2],p=e[3],d=i[0],f=i[1],m=i[2],v=i[3];return(o=h*d+u*f+c*m+p*v)<0&&(o=-o,d=-d,f=-f,m=-m,v=-v),l=1e-6<1-o?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-n)*r)/s,Math.sin(n*r)/s):(a=1-n,n),t[0]=a*h+l*d,t[1]=a*u+l*f,t[2]=a*c+l*m,t[3]=a*p+l*v,t},d.sqlerp=(s=d.create(),a=d.create(),function(t,e,i,n,r,o){return d.slerp(s,e,r,o),d.slerp(a,i,n,o),d.slerp(t,s,a,2*o*(1-o)),t}),d.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o,a=s?1/s:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-r*a,t[3]=o*a,t},d.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},d.length=p.length,d.len=d.length,d.squaredLength=p.squaredLength,d.sqrLen=d.squaredLength,d.normalize=p.normalize,d.fromMat3=function(t,e){var i,n=e[0]+e[4]+e[8];if(0<n)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*o+s]-e[3*s+o])*i,t[o]=(e[3*o+r]+e[3*r+o])*i,t[s]=(e[3*s+r]+e[3*r+s])*i}return t},d.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},d.exactEquals=p.exactEquals,d.equals=p.equals,e.exports=d},{"./common.js":3,"./mat3.js":6,"./vec3.js":10,"./vec4.js":11}],9:[function(t,e,i){var l,s=t("./common.js"),n={};n.create=function(){var t=new s.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new s.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var i=new s.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,i){return t[0]=e,t[1]=i,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},n.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;return 0<r&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},n.lerp=function(t,e,i,n){var r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t},n.random=function(t,e){e=e||1;var i=2*s.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},n.transformMat2=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t},n.transformMat2d=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t},n.transformMat3=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t},n.transformMat4=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t},n.forEach=(l=n.create(),function(t,e,i,n,r,o){var s,a;for(e=e||2,i=i||0,a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)l[0]=t[s],l[1]=t[s+1],r(l,l,o),t[s]=l[0],t[s+1]=l[1];return t}),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},n.equals=function(t,e){var i=t[0],n=t[1],r=e[0],o=e[1];return Math.abs(i-r)<=s.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-o)<=s.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))},e.exports=n},{"./common.js":3}],10:[function(t,e,i){var l,h=t("./common.js"),o={};o.create=function(){var t=new h.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new h.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,i){var n=new h.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},o.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},o.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},o.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},o.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+n*n+r*r)},o.dist=o.distance,o.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},o.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return 0<o&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s,t},o.lerp=function(t,e,i,n){var r=e[0],o=e[1],s=e[2];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=s+n*(i[2]-s),t},o.hermite=function(t,e,i,n,r,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,h=s*(o-1),u=s*(3-2*o);return t[0]=e[0]*a+i[0]*l+n[0]*h+r[0]*u,t[1]=e[1]*a+i[1]*l+n[1]*h+r[1]*u,t[2]=e[2]*a+i[2]*l+n[2]*h+r[2]*u,t},o.bezier=function(t,e,i,n,r,o){var s=1-o,a=s*s,l=o*o,h=a*s,u=3*o*a,c=3*l*s,p=l*o;return t[0]=e[0]*h+i[0]*u+n[0]*c+r[0]*p,t[1]=e[1]*h+i[1]*u+n[1]*c+r[1]*p,t[2]=e[2]*h+i[2]*u+n[2]*c+r[2]*p,t},o.random=function(t,e){e=e||1;var i=2*h.RANDOM()*Math.PI,n=2*h.RANDOM()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t},o.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return s=s||1,t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,t},o.transformMat3=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t},o.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2],h=i[3],u=h*n+a*o-l*r,c=h*r+l*n-s*o,p=h*o+s*r-a*n,d=-s*n-a*r-l*o;return t[0]=u*h+d*-s+c*-l-p*-a,t[1]=c*h+d*-a+p*-s-u*-l,t[2]=p*h+d*-l+u*-a-c*-s,t},o.rotateX=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},o.rotateY=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},o.rotateZ=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},o.forEach=(l=o.create(),function(t,e,i,n,r,o){var s,a;for(e=e||3,i=i||0,a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)l[0]=t[s],l[1]=t[s+1],l[2]=t[s+2],r(l,l,o),t[s]=l[0],t[s+1]=l[1],t[s+2]=l[2];return t}),o.angle=function(t,e){var i=o.fromValues(t[0],t[1],t[2]),n=o.fromValues(e[0],e[1],e[2]);o.normalize(i,i),o.normalize(n,n);var r=o.dot(i,n);return 1<r?0:r<-1?Math.PI:Math.acos(r)},o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(i-o)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},e.exports=o},{"./common.js":3}],11:[function(t,e,i){var l,u=t("./common.js"),n={};n.create=function(){var t=new u.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},n.clone=function(t){var e=new u.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,n){var r=new u.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(i*i+n*n+r*r+o*o)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return i*i+n*n+r*r+o*o},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},n.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o;return 0<s&&(s=1/Math.sqrt(s),t[0]=i*s,t[1]=n*s,t[2]=r*s,t[3]=o*s),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,n){var r=e[0],o=e[1],s=e[2],a=e[3];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=s+n*(i[2]-s),t[3]=a+n*(i[3]-a),t},n.random=function(t,e){return e=e||1,t[0]=u.RANDOM(),t[1]=u.RANDOM(),t[2]=u.RANDOM(),t[3]=u.RANDOM(),n.normalize(t,t),n.scale(t,t,e),t},n.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t},n.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2],h=i[3],u=h*n+a*o-l*r,c=h*r+l*n-s*o,p=h*o+s*r-a*n,d=-s*n-a*r-l*o;return t[0]=u*h+d*-s+c*-l-p*-a,t[1]=c*h+d*-a+p*-s-u*-l,t[2]=p*h+d*-l+u*-a-c*-s,t[3]=e[3],t},n.forEach=(l=n.create(),function(t,e,i,n,r,o){var s,a;for(e=e||4,i=i||0,a=n?Math.min(n*e+i,t.length):t.length,s=i;s<a;s+=e)l[0]=t[s],l[1]=t[s+1],l[2]=t[s+2],l[3]=t[s+3],r(l,l,o),t[s]=l[0],t[s+1]=l[1],t[s+2]=l[2],t[s+3]=l[3];return t}),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=e[0],a=e[1],l=e[2],h=e[3];return Math.abs(i-s)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-h)<=u.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},e.exports=n},{"./common.js":3}],12:[function(t,e,i){e.exports=function(t){"string"==typeof t&&(t=[t]);for(var e=[].slice.call(arguments,1),i=[],n=0;n<t.length-1;n++)i.push(t[n],e[n]||"");return i.push(t[n]),i.join("")}},{}],13:[function(t,qt,e){!function(i,a,c){"use strict";function l(t,e,i){return setTimeout(h(t,i),e)}function n(t,e,i){return Array.isArray(t)&&(r(t,i[e],i),1)}function r(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==c)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function o(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===c)&&(t[n[r]]=e[n[r]]),r++;return t}function s(t,e){return o(t,e,!0)}function t(t,e,i){var n,r=e.prototype;(n=t.prototype=function(t){if(Object.create)return Object.create(t);function e(){}e.prototype=t;var i=new e;return e.prototype=null,i}(r)).constructor=t,n._super=r,i&&o(n,i)}function h(t,e){return function(){return t.apply(e,arguments)}}function u(t,e){return typeof t==K?t.apply(e&&e[0]||c,e):t}function p(t,e){return t===c?e:t}function e(e,t,i){r(v(t),function(t){e.addEventListener(t,i,!1)})}function d(e,t,i){r(v(t),function(t){e.removeEventListener(t,i,!1)})}function f(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function m(t,e){return-1<t.indexOf(e)}function v(t){return t.trim().split(/\s+/g)}function _(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function y(t){return Array.prototype.slice.call(t,0)}function g(t,i,e){for(var n=[],r=[],o=0;o<t.length;){var s=i?t[o][i]:t[o];_(r,s)<0&&n.push(t[o]),r[o]=s,o++}return e&&(n=i?n.sort(function(t,e){return t[i]>e[i]}):n.sort()),n}function x(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),o=0;o<U.length;){if((n=(i=U[o])?i+r:e)in t)return n;o++}return c}function w(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}function M(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){u(e.options.enable,[e])&&i.handler(t)},this.init()}function b(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,o=e&ot&&n-r==0,s=e&(st|at)&&n-r==0;i.isFirst=!!o,i.isFinal=!!s,o&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=S(e)),1<r&&!i.firstMultiple?i.firstMultiple=S(e):1===r&&(i.firstMultiple=!1);var o=i.firstInput,s=i.firstMultiple,a=s?s.center:o.center,l=e.center=I(n);e.timeStamp=J(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=L(a,l),e.distance=D(a,l),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==ot&&o.eventType!==st||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=E(e.deltaX,e.deltaY),e.scale=s?function(t,e){return D(e[0],e[1],_t)/D(t[0],t[1],_t)}(s.pointers,n):1,e.rotation=s?function(t,e){return L(e[1],e[0],_t)-L(t[1],t[0],_t)}(s.pointers,n):0,function(t,e){var i,n,r,o,s=t.lastInterval||e,a=e.timeStamp-s.timeStamp;if(e.eventType!=at&&(rt<a||s.velocity===c)){var l=s.deltaX-e.deltaX,h=s.deltaY-e.deltaY,u=function(t,e,i){return{x:e/t||0,y:i/t||0}}(a,l,h);n=u.x,r=u.y,i=$(u.x)>$(u.y)?u.x:u.y,o=E(l,h),t.lastInterval=e}else i=s.velocity,n=s.velocityX,r=s.velocityY,o=s.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=o}(i,e);var h=t.element;f(e.srcEvent.target,h)&&(h=e.srcEvent.target),e.target=h}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function S(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:Q(t.pointers[i].clientX),clientY:Q(t.pointers[i].clientY)},i++;return{timeStamp:J(),pointers:e,center:I(e),deltaX:t.deltaX,deltaY:t.deltaY}}function I(t){var e=t.length;if(1===e)return{x:Q(t[0].clientX),y:Q(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:Q(i/e),y:Q(n/e)}}function E(t,e){return t===e?lt:$(t)>=$(e)?0<t?ht:ut:0<e?ct:pt}function D(t,e,i){var n=e[(i=i||vt)[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function L(t,e,i){var n=e[(i=i||vt)[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function T(){this.evEl=gt,wt?this.evDoc=xt:this.evWin=xt,this.allow=!0,this.pressed=!1,M.apply(this,arguments)}function F(){this.evEl=St,this.evWin=It,M.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function C(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,M.apply(this,arguments)}function z(){this.evTarget=Lt,this.targetIds={},M.apply(this,arguments)}function R(){M.apply(this,arguments);var t=h(this.handler,this);this.touch=new z(this.manager,t),this.mouse=new T(this.manager,t)}function A(t,e){this.manager=t,this.set(e)}function P(t){this.id=tt++,this.manager=null,this.options=s(t||{},this.defaults),this.options.enable=p(this.options.enable,!0),this.state=Pt,this.simultaneous={},this.requireFail=[]}function k(t){return t==pt?"down":t==ct?"up":t==ht?"left":t==ut?"right":""}function O(t,e){var i=e.manager;return i?i.get(t):t}function H(){P.apply(this,arguments)}function N(){H.apply(this,arguments),this.pX=null,this.pY=null}function Y(){H.apply(this,arguments)}function q(){P.apply(this,arguments),this._timer=null,this._input=null}function W(){H.apply(this,arguments)}function B(){H.apply(this,arguments)}function X(){P.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function j(t,e){return(e=e||{}).recognizers=p(e.recognizers,j.defaults.preset),new V(t,e)}function V(t,e){var i;e=e||{},this.options=s(e,j.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((i=this).options.inputClass||(it?F:nt?z:et?R:T))(i,b),this.touchAction=new A(this,this.options.touchAction),G(this,!0),r(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function G(t,i){var n=t.element;n.style&&r(t.options.cssProps,function(t,e){n.style[x(n.style,e)]=i?t:""})}var U=["","webkit","moz","MS","ms","o"],Z=a.createElement("div"),K="function",Q=Math.round,$=Math.abs,J=Date.now,tt=1,et="ontouchstart"in i,it=x(i,"PointerEvent")!==c,nt=et&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),rt=25,ot=1,st=4,at=8,lt=1,ht=2,ut=4,ct=8,pt=16,dt=ht|ut,ft=ct|pt,mt=dt|ft,vt=["x","y"],_t=["clientX","clientY"];M.prototype={handler:function(){},init:function(){this.evEl&&e(this.element,this.evEl,this.domHandler),this.evTarget&&e(this.target,this.evTarget,this.domHandler),this.evWin&&e(w(this.element),this.evWin,this.domHandler),this.evDoc&&e(a,this.evDoc,this.domHandler),this.evBody&&e(a.body,this.evBody,this.domHandler)},destroy:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(w(this.element),this.evWin,this.domHandler),this.evDoc&&d(a,this.evDoc,this.domHandler),this.evBody&&d(a.body,this.evBody,this.domHandler)}};var yt={mousedown:ot,mousemove:2,mouseup:st},gt="mousedown",xt="mousemove mouseup",wt=0<i.navigator.userAgent.indexOf("MSIE 8");t(T,M,{handler:function(t){var e=yt[t.type],i=0;wt&&(i=1),e&ot&&t.button===i&&(this.pressed=!0),2&e&&t.button!==i&&(e=st),this.pressed&&this.allow&&(e&st&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var Mt={pointerdown:ot,pointermove:2,pointerup:st,pointercancel:at,pointerout:at},bt={2:"touch",3:"pen",4:"mouse",5:"kinect"},St="pointerdown",It="pointermove pointerup pointercancel";i.MSPointerEvent&&(St="MSPointerDown",It="MSPointerMove MSPointerUp MSPointerCancel"),t(F,M,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Mt[n],o=bt[t.pointerType]||t.pointerType,s="touch"==o,a=_(e,t.pointerId,"pointerId");r&ot&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):r&(st|at)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),i&&e.splice(a,1))}});var Et={touchstart:ot,touchmove:2,touchend:st,touchcancel:at};t(C,M,{handler:function(t){var e=Et[t.type];if(e===ot&&(this.started=!0),this.started){var i=function(t,e){var i=y(t.touches),n=y(t.changedTouches);return e&(st|at)&&(i=g(i.concat(n),"identifier",!0)),[i,n]}.call(this,t,e);e&(st|at)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var Dt={touchstart:ot,touchmove:2,touchend:st,touchcancel:at},Lt="touchstart touchmove touchend touchcancel";t(z,M,{handler:function(t){var e=Dt[t.type],i=function(t,e){var i=y(t.touches),n=this.targetIds;if(e&(2|ot)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,o,s=y(t.changedTouches),a=[],l=this.target;if(o=i.filter(function(t){return f(t.target,l)}),e===ot)for(r=0;r<o.length;)n[o[r].identifier]=!0,r++;for(r=0;r<s.length;)n[s[r].identifier]&&a.push(s[r]),e&(st|at)&&delete n[s[r].identifier],r++;return a.length?[g(o.concat(a),"identifier",!0),a]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}),t(R,M,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(n)this.mouse.allow=!1;else if(r&&!this.mouse.allow)return;e&(st|at)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Tt=x(Z.style,"touchAction"),Ft=Tt!==c,Ct="manipulation",zt="none",Rt="pan-x",At="pan-y";A.prototype={set:function(t){"compute"==t&&(t=this.compute()),Ft&&this.manager.element.style&&(this.manager.element.style[Tt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return r(this.manager.recognizers,function(t){u(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(t){if(m(t,zt))return zt;var e=m(t,Rt),i=m(t,At);return e&&i?Rt+" "+At:e||i?e?Rt:At:m(t,Ct)?Ct:"auto"}(e.join(" "))},preventDefaults:function(t){if(!Ft){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=m(n,zt),o=m(n,At),s=m(n,Rt);return r||o&&i&dt||s&&i&ft?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Pt=1,kt=2,Ot=4,Ht=8,Nt=Ht,Yt=16;P.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(n(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=O(t,this)).id]||(e[t.id]=t).recognizeWith(this),this},dropRecognizeWith:function(t){return n(t,"dropRecognizeWith",this)||(t=O(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(n(t,"requireFailure",this))return this;var e=this.requireFail;return-1===_(e,t=O(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(n(t,"dropRequireFailure",this))return this;t=O(t,this);var e=_(this.requireFail,t);return-1<e&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(i){function t(t){var e;n.manager.emit(n.options.event+(t?(e=r)&Yt?"cancel":e&Ht?"end":e&Ot?"move":e&kt?"start":"":""),i)}var n=this,r=this.state;r<Ht&&t(!0),t(),Ht<=r&&t(!0)},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Pt)))return!1;t++}return!0},recognize:function(t){var e=o({},t);if(!u(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Nt|Yt|32)&&(this.state=Pt),this.state=this.process(e),this.state&(kt|Ot|Ht|Yt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},t(H,P,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(kt|Ot),r=this.attrTest(t);return n&&(i&at||!r)?e|Yt:n||r?i&st?e|Ht:e&kt?e|Ot:kt:32}}),t(N,H,{defaults:{event:"pan",threshold:10,pointers:1,direction:mt},getTouchAction:function(){var t=this.options.direction,e=[];return t&dt&&e.push(At),t&ft&&e.push(Rt),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(n=e.direction&dt?(r=0===o?lt:o<0?ht:ut,i=o!=this.pX,Math.abs(t.deltaX)):(r=0===s?lt:s<0?ct:pt,i=s!=this.pY,Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return H.prototype.attrTest.call(this,t)&&(this.state&kt||!(this.state&kt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=k(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),t(Y,H,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[zt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&kt)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),t(q,P,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(st|at)&&!r)this.reset();else if(t.eventType&ot)this.reset(),this._timer=l(function(){this.state=Nt,this.tryEmit()},e.time,this);else if(t.eventType&st)return Nt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Nt&&(t&&t.eventType&st?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=J(),this.manager.emit(this.options.event,this._input)))}}),t(W,H,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[zt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&kt)}}),t(B,H,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:dt|ft,pointers:1},getTouchAction:function(){return N.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(dt|ft)?e=t.velocity:i&dt?e=t.velocityX:i&ft&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&$(e)>this.options.velocity&&t.eventType&st},emit:function(t){var e=k(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),t(X,P,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Ct]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&ot&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=st)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||D(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=l(function(){this.state=Nt,this.tryEmit()},e.interval,this),kt):Nt}return 32},failTimeout:function(){return this._timer=l(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Nt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),j.VERSION="2.0.4",j.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[W,{enable:!1}],[Y,{enable:!1},["rotate"]],[B,{direction:dt}],[N,{direction:dt},["swipe"]],[X],[X,{event:"doubletap",taps:2},["tap"]],[q]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},V.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Nt)&&(r=e.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(kt|Ot|Ht)&&(r=e.curRecognizer=i),o++}},get:function(t){if(t instanceof P)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(n(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),(t.manager=this).touchAction.update(),t},remove:function(t){if(n(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(_(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return r(v(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return r(v(t),function(t){e?i[t].splice(_(i[t],e),1):delete i[t]}),this},emit:function(t,e){var i,n,r;this.options.domEvents&&(i=t,n=e,(r=a.createEvent("Event")).initEvent(i,!0,!0),(r.gesture=n).target.dispatchEvent(r));var o=this.handlers[t]&&this.handlers[t].slice();if(o&&o.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var s=0;s<o.length;)o[s](e),s++}},destroy:function(){this.element&&G(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(j,{INPUT_START:ot,INPUT_MOVE:2,INPUT_END:st,INPUT_CANCEL:at,STATE_POSSIBLE:Pt,STATE_BEGAN:kt,STATE_CHANGED:Ot,STATE_ENDED:Ht,STATE_RECOGNIZED:Nt,STATE_CANCELLED:Yt,STATE_FAILED:32,DIRECTION_NONE:lt,DIRECTION_LEFT:ht,DIRECTION_RIGHT:ut,DIRECTION_UP:ct,DIRECTION_DOWN:pt,DIRECTION_HORIZONTAL:dt,DIRECTION_VERTICAL:ft,DIRECTION_ALL:mt,Manager:V,Input:M,TouchAction:A,TouchInput:z,MouseInput:T,PointerEventInput:F,TouchMouseInput:R,SingleTouchInput:C,Recognizer:P,AttrRecognizer:H,Tap:X,Pan:N,Swipe:B,Pinch:Y,Rotate:W,Press:q,on:e,off:d,each:r,merge:s,extend:o,inherit:t,bindFn:h,prefixed:x}),typeof Wt==K&&Wt.amd?Wt(function(){return j}):void 0!==qt&&qt.exports?qt.exports=j:i.Hammer=j}(window,document)},{}],14:[function(t,e,i){"use strict";function n(){}n.prototype.addEventListener=function(t,e){var i=this.__events=this.__events||{};(i[t]=i[t]||[]).push(e)},n.prototype.removeEventListener=function(t,e){var i=(this.__events=this.__events||{})[t];if(i){var n=i.indexOf(e);0<=n&&i.splice(n,1)}},n.prototype.emit=function(){var t=(this.__events=this.__events||{})[arguments[0]];if(t)for(var e=0;e<t.length;e++){t[e].apply(this,arguments)}},e.exports=function(t){for(var e in n.prototype)n.prototype.hasOwnProperty(e)&&(t.prototype[e]=n.prototype[e])}},{}],15:[function(t,e,i){"use strict";function n(t,e){this._equals=t,this._hash=e,this._queue=[],this._visited=new r(t,e),this._neighborsFun=null,this._exploreFun=null}var r=t("./collections/Set");n.prototype.start=function(t,e,i){if(this._neighborsFun||this._exploreFun)throw new Error("GraphFinder: search already in progress");this.reset(),this._neighborsFun=e,this._exploreFun=i,this._queue.push(t)},n.prototype.reset=function(){this._neighborsFun=null,this._exploreFun=null,this._queue.length=0,this._visited.clear()},n.prototype.next=function(){var t=this._queue,e=this._visited,i=this._neighborsFun,n=this._exploreFun;if(!i||!n)throw new Error("GraphFinder: no search in progress");for(;0<t.length;){var r=this._queue.shift();if(!e.has(r)&&n(r)){e.add(r);for(var o=i(r),s=0;s<o.length;s++)t.push(o[s]);return r}}return this.reset(),null},e.exports=n},{"./collections/Set":34}],16:[function(t,e,i){"use strict";function n(t,e,i,n,r){if((r=r||{}).perspective=r.perspective||{},r.perspective.extraRotations=null!=r.perspective.extraRotations?r.perspective.extraRotations:"",r.perspective.radius&&!o())throw new Error("Hotspot cannot not be embedded in sphere for lack of browser support");this._domElement=t,this._parentDomElement=e,this._view=i,this._params={},this._perspective={},this.setPosition(n),this._parentDomElement.appendChild(this._domElement),this.setPerspective(r.perspective),this._visible=!0,this._position={x:0,y:0}}var r=t("minimal-event-emitter"),o=t("./support/Css"),s=t("./positionAbsolutely"),a=t("./util/dom").setTransform;r(n),n.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),this._domElement=null,this._parentDomElement=null,this._params=null,this._view=null,this._position=null,this._visible=!1},n.prototype.domElement=function(){return this._domElement},n.prototype.position=function(){return this._params},n.prototype.setPosition=function(t){for(var e in t)this._params[e]=t[e];this._update()},n.prototype.perspective=function(){return this._perspective},n.prototype.setPerspective=function(t){for(var e in t)this._perspective[e]=t[e];this._update()},n.prototype.show=function(){this._visible||(this._visible=!0,this._update())},n.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},n.prototype._update=function(){var t,e,i=this._domElement,n=this._params,r=this._position,o=!1;if(this._visible){var s=this._view;this._perspective.radius?(o=!0,this._setEmbeddedPosition(s,n)):(s.coordinatesToScreen(n,r),t=r.x,e=r.y,null!=t&&null!=e&&(o=!0,this._setPosition(t,e)))}o?(i.style.display="block",i.style.position="absolute"):(i.style.display="none",i.style.position="")},n.prototype._setEmbeddedPosition=function(t,e){var i=t.coordinatesToPerspectiveTransform(e,this._perspective.radius,this._perspective.extraRotations);a(this._domElement,i)},n.prototype._setPosition=function(t,e){s(this._domElement,t,e)},e.exports=n},{"./positionAbsolutely":59,"./support/Css":81,"./util/dom":98,"minimal-event-emitter":14}],17:[function(t,e,i){"use strict";function n(t,e,i,n,r){r=r||{},this._parentDomElement=t,this._stage=e,this._view=i,this._renderLoop=n,this._rect=r.rect,this._hotspotContainerWrapper=document.createElement("div"),h(this._hotspotContainerWrapper),f(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),h(this._hotspotContainer),f(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._hotspots=[],this._visible=!0,this._supported=!0,this._isVisible=!0,this._positionAndSize={},this._hasRect=null,this._newPositionAndSize={},this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}var r=t("minimal-event-emitter"),o=t("./Hotspot"),s=t("./calcRect"),a=t("./positionAbsolutely"),l=t("./support/cssPointerEvents"),h=t("./util/dom").setAbsolute,u=t("./util/dom").setOverflowHidden,c=t("./util/dom").setOverflowVisible,p=t("./util/dom").setNullSize,d=t("./util/dom").setPixelSize,f=t("./util/dom").setWithVendorPrefix("pointer-events");r(n),n.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),this._parentDomElement=null,this._stage=null,this._view=null,this._renderLoop=null,this._rect=null},n.prototype.domElement=function(){return this._hotspotContainer},n.prototype.setRect=function(t){this._rect=t},n.prototype.rect=function(){return this._rect},n.prototype.createHotspot=function(t,e,i){e=e||{};var n=new o(t,this._hotspotContainer,this._view,e,i);return this._hotspots.push(n),n._update(),this.emit("hotspotsChange"),n},n.prototype.hasHotspot=function(t){return 0<=this._hotspots.indexOf(t)},n.prototype.listHotspots=function(){return[].concat(this._hotspots)},n.prototype.destroyHotspot=function(t){var e=this._hotspots.indexOf(t);if(e<0)throw new Error("No such hotspot");this._hotspots.splice(e,1),t.destroy(),this.emit("hotspotsChange")},n.prototype.hide=function(){this._visible=!1,this._updateVisibility()},n.prototype.show=function(){this._visible=!0,this._updateVisibility()},n.prototype._updateVisibility=function(){var t=this._visible&&this._supported;t&&!this._isVisible?(this._hotspotContainerWrapper.style.display="block",this._isVisible=!0):!t&&this._isVisible&&(this._hotspotContainerWrapper.style.display="none",this._isVisible=!1)},n.prototype._update=function(){this._updatePositionAndSize();for(var t=0;t<this._hotspots.length;t++)this._hotspots[t]._update()},n.prototype._updatePositionAndSize=function(){this._rect?!l()&&0<this._hotspots.length?(console.warn("HotspotContainer: this browser does not support using effects.rect with hotspots. Hotspots will be hidden."),this._supported=!1):(s(this._stage.width(),this._stage.height(),this._rect,this._newPositionAndSize),this._setPositionAndSizeWithRect(this._newPositionAndSize),this._supported=!0):(this._setPositionAndSizeWithoutRect(),this._supported=!0),this._updateVisibility()},n.prototype._setPositionAndSizeWithRect=function(t){var e=this._hotspotContainerWrapper;!0!==this._hasRect&&u(e),!0===this._hasRect&&t.left===this._positionAndSize.left&&t.top===this._positionAndSize.top||a(e,t.left,t.top),!0===this._hasRect&&+t.width===this._positionAndSize.width&&t.height===this._positionAndSize.height||d(e,t.width,t.height),this._positionAndSize.left=t.left,this._positionAndSize.top=t.top,this._positionAndSize.width=t.width,this._positionAndSize.height=t.height,this._hasRect=!0},n.prototype._setPositionAndSizeWithoutRect=function(){!1!==this._hasRect&&(a(this._hotspotContainerWrapper,0,0),p(this._hotspotContainerWrapper),c(this._hotspotContainerWrapper),this._hasRect=!1)},e.exports=n},{"./Hotspot":16,"./calcRect":30,"./positionAbsolutely":59,"./support/cssPointerEvents":84,"./util/dom":98,"minimal-event-emitter":14}],18:[function(t,e,i){"use strict";function n(t,e,i,n,r,o){o=o||{};var s=this;this._stage=t,this._source=e,this._geometry=i,this._view=n,this._textureStore=r,this._effects=o.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){s.emit("viewChange",s.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){s.emit("textureStoreChange",s.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}var r=t("minimal-event-emitter"),o=t("./util/extend");r(n),n.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),this._stage=null,this._source=null,this._geometry=null,this._view=null,this._textureStore=null,this._fixedLevelIndex=null,this._effects=null,this._viewChangeHandler=null,this._textureStoreChangeHandler=null},n.prototype.stage=function(){return this._stage},n.prototype.source=function(){return this._source},n.prototype.geometry=function(){return this._geometry},n.prototype.view=function(){return this._view},n.prototype.textureStore=function(){return this._textureStore},n.prototype.effects=function(){return this._effects},n.prototype.setEffects=function(t){this._effects=t,this.emit("effectsChange",this._effects)},n.prototype.mergeEffects=function(t){o(this._effects,t),this.emit("effectsChange",this._effects)},n.prototype.fixedLevel=function(){return this._fixedLevelIndex},n.prototype.setFixedLevel=function(t){if(t!==this._fixedLevelIndex){if(null!=t&&(t>=this._geometry.levelList.length||t<0))throw new Error("Level index out of range: "+t);this._fixedLevelIndex=t,this.emit("fixedLevelChange",this._fixedLevelIndex)}},n.prototype._selectLevel=function(){return null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},n.prototype.visibleTiles=function(t){var e=this._selectLevel();return this._geometry.visibleTiles(this._view,e,t)},n.prototype.pinLevel=function(t){for(var e=this._geometry.levelList[t],i=this._geometry.levelTiles(e),n=0;n<i.length;n++)this._textureStore.pin(i[n])},n.prototype.unpinLevel=function(t){for(var e=this._geometry.levelList[t],i=this._geometry.levelTiles(e),n=0;n<i.length;n++)this._textureStore.unpin(i[n])},n.prototype.pinFirstLevel=function(){return this.pinLevel(0)},n.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)},e.exports=n},{"./util/extend":99,"minimal-event-emitter":14}],19:[function(t,e,i){"use strict";function n(){this.constructor.super_.apply(this,arguments)}t("./util/inherits")(n,Error),e.exports=n},{"./util/inherits":101}],20:[function(t,e,i){"use strict";function n(t){var e=this;this._stage=t,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){e._rendering||e.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}t("minimal-event-emitter")(n),n.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),this._stage=null,this._running=null,this._rendering=null,this._requestHandle=null,this._boundLoop=null},n.prototype.stage=function(){return this._stage},n.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},n.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},n.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},n.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")},e.exports=n},{"minimal-event-emitter":14}],21:[function(t,e,i){"use strict";function n(t,e){this._viewer=t,this._view=e,this._layers=[],this._hotspotContainer=new r(t._controlContainer,t.stage(),this._view,t.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}var h=t("./Layer"),u=t("./TextureStore"),r=t("./HotspotContainer"),o=t("minimal-event-emitter"),s=t("./util/clock"),a=t("./util/noop"),c=t("./util/type"),p=t("./util/defaults");o(n),n.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),this._movement=null,this._viewer=null,this._layers=null,this._view=null,this._hotspotContainer=null},n.prototype.hotspotContainer=function(){return this._hotspotContainer},n.prototype.layer=function(){return this._layers[0]},n.prototype.listLayers=function(){return[].concat(this._layers)},n.prototype.view=function(){return this._view},n.prototype.viewer=function(){return this._viewer},n.prototype.visible=function(){return this._viewer.scene()===this},n.prototype.createLayer=function(t){var e=(t=t||{}).textureStoreOpts||{},i=t.layerOpts||{},n=t.source,r=t.geometry,o=this._view,s=this._viewer.stage(),a=new u(r,n,s,e),l=new h(s,n,r,o,a,i);return this._layers.push(l),t.pinFirstLevel&&l.pinFirstLevel(),this.emit("layerChange"),l},n.prototype.destroyLayer=function(t){var e=this._layers.indexOf(t);if(e<0)throw new Error("No such layer in scene");this._layers.splice(e,1),this.emit("layerChange"),t.textureStore().destroy(),t.destroy()},n.prototype.destroyAllLayers=function(){for(;0<this._layers.length;)this.destroyLayer(this._layers[0])},n.prototype.switchTo=function(t,e){return this._viewer.switchScene(this,t,e)},n.prototype.lookTo=function(t,e,i){if(e=e||{},i=i||a,"object"!==c(t))throw new Error("Target view parameters must be an object");var l=null!=e.transitionDuration?e.transitionDuration:1e3,n=null==e.shortest||e.shortest,r=this._view,h=r.parameters(),u={};p(u,t),p(u,h),n&&r.normalizeToClosest&&r.normalizeToClosest(u,u);var o=this._viewer.controls().enabled();this._viewer.controls().disable(),this.startMovement(function(){var a=!1;return function(t,e){if(l<=e&&a)return null;var i,n=Math.min(e/l,1);for(var r in t){var o=h[r],s=u[r];t[r]=o+(i=n,((i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1))*(s-o))}return a=l<=e,t}},function(){o&&this._viewer.controls().enable(),i()})},n.prototype.startMovement=function(t,e){var i=this._viewer.renderLoop();this._movement&&this.stopMovement();var n=t();if("function"!=typeof n)throw new Error("Bad movement");this._movement=t,this._movementStep=n,this._movementStartTime=s(),this._movementParams={},this._movementCallback=e,i.addEventListener("beforeRender",this._updateMovementHandler),i.renderOnNextFrame()},n.prototype.stopMovement=function(){var t=this._viewer.renderLoop();this._movementCallback&&this._movementCallback(),t.removeEventListener("beforeRender",this._updateMovementHandler),this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null},n.prototype.movement=function(){return this._movement},n.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var t=this._viewer.renderLoop(),e=this._view,i=s()-this._movementStartTime,n=this._movementStep,r=this._movementParams;null==(r=n(r=e.parameters(r),i))?this.stopMovement():(e.setParameters(r),t.renderOnNextFrame())},n.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()},e.exports=n},{"./HotspotContainer":17,"./Layer":18,"./TextureStore":22,"./util/clock":89,"./util/defaults":94,"./util/noop":104,"./util/type":112,"minimal-event-emitter":14}],22:[function(t,e,i){"use strict";function l(){}function n(t,e){var r=this;r._id=_++,r._store=t,r._tile=e,r._asset=null,r._texture=null,r._changeHandler=function(){t.emit("textureInvalid",e)};var i=t.source(),n=t.stage(),o=i.loadAsset.bind(i),s=n.createTexture.bind(n),a=p(c(o),s);f&&console.log("loading",r._id,r._tile),r._cancel=a(n,e,function(t,e,i,n){if(r._cancel=null,t)return i&&i.destroy(),n&&n.destroy(),void(t instanceof l?(r._store.emit("textureCancel",r._tile),f&&console.log("cancel",r._id,r._tile)):(r._store.emit("textureError",r._tile,t),f&&console.log("error",r._id,r._tile)));r._texture=n,i.dynamic?(r._asset=i).addEventListener("change",r._changeHandler):i.destroy(),r._store.emit("textureLoad",r._tile),f&&console.log("load",r._id,r._tile)})}function r(t,e,i,n){n=u(n||{},v),this._source=e,this._stage=i;var r=t.TileClass;this._clientPhase=m,this._clientCounter=0,this._itemMap=new o(r.equals,r.hash),this._visible=new s(r.equals,r.hash),this._previouslyVisible=new a(r.equals,r.hash,n.previouslyVisibleCacheSize),this._pinMap=new o(r.equals,r.hash),this._newVisible=new s(r.equals,r.hash),this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}var o=t("./collections/Map"),s=t("./collections/Set"),a=t("./collections/LruSet"),h=t("minimal-event-emitter"),u=t("./util/defaults"),c=t("./util/retry"),p=t("./util/chain"),d=t("./util/inherits"),f="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.textureStore,m="idle",v={previouslyVisibleCacheSize:32},_=0;d(l,Error),n.prototype.asset=function(){return this._asset},n.prototype.texture=function(){return this._texture},n.prototype.destroy=function(){var t=this,e=t._id,i=t._store,n=t._tile,r=t._asset,o=t._texture,s=t._cancel;s?s(new l):(r&&(r.removeEventListener("change",t._changeHandler),r.destroy()),o&&o.destroy(),i.emit("textureUnload",n),f&&console.log("unload",e,n),t._changeHandler=null,t._asset=null,t._texture=null,t._tile=null,t._store=null,t._id=null)},h(n),h(r),r.prototype.destroy=function(){this.clear(),this._source=null,this._stage=null,this._itemMap=null,this._visible=null,this._previouslyVisible=null,this._pinMap=null,this._newVisible=null,this._noLongerVisible=null,this._visibleAgain=null,this._evicted=null},r.prototype.stage=function(){return this._stage},r.prototype.source=function(){return this._source},r.prototype.clear=function(){var e=this;e._evicted.length=0,e._itemMap.each(function(t){e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._itemMap.clear(),e._visible.clear(),e._previouslyVisible.clear(),e._pinMap.clear(),e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},r.prototype.clearNotPinned=function(){var e=this;e._evicted.length=0,e._itemMap.each(function(t){e._pinMap.has(t)||e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._visible.clear(),e._previouslyVisible.clear(),e._evicted.length=0},r.prototype.startFrame=function(){if(this._clientPhase!==m&&"start"!==this._clientPhase)throw new Error("TextureStore: startFrame called out of sequence");this._clientPhase="start",this._clientCounter++,this._newVisible.clear()},r.prototype.markTile=function(t){if("start"!==this._clientPhase)throw new Error("TextureStore: markTile called out of sequence");var e=this._itemMap.get(t),i=e&&e.texture(),n=e&&e.asset();i&&n&&i.refresh(t,n),this._newVisible.add(t)},r.prototype.endFrame=function(){if("start"!==this._clientPhase&&"end"!==this._clientPhase)throw new Error("TextureStore: endFrame called out of sequence");this._clientPhase="end",--this._clientCounter||(this._update(),this._clientPhase=m)},r.prototype._update=function(){var n=this;n._noLongerVisible.length=0,n._visible.each(function(t){n._newVisible.has(t)||n._noLongerVisible.push(t)}),n._visibleAgain.length=0,n._newVisible.each(function(t){n._previouslyVisible.has(t)&&n._visibleAgain.push(t)}),n._visibleAgain.forEach(function(t){n._previouslyVisible.remove(t)}),n._evicted.length=0,n._noLongerVisible.forEach(function(t){var e=n._itemMap.get(t);if(e&&e.texture()){var i=n._previouslyVisible.add(t);null!=i&&n._evicted.push(i)}else e&&n._unloadTile(t)}),n._evicted.forEach(function(t){n._pinMap.has(t)||n._unloadTile(t)}),n._newVisible.each(function(t){n._itemMap.get(t)||n._loadTile(t)});var t=n._visible;n._visible=n._newVisible,n._newVisible=t,n._noLongerVisible.length=0,n._visibleAgain.length=0,n._evicted.length=0},r.prototype._loadTile=function(t){if(this._itemMap.has(t))throw new Error("TextureStore: loading texture already in cache");var e=new n(this,t);this._itemMap.set(t,e)},r.prototype._unloadTile=function(t){var e=this._itemMap.del(t);if(!e)throw new Error("TextureStore: unloading texture not in cache");e.destroy()},r.prototype.asset=function(t){var e=this._itemMap.get(t);return e?e.asset():null},r.prototype.texture=function(t){var e=this._itemMap.get(t);return e?e.texture():null},r.prototype.pin=function(t){var e=(this._pinMap.get(t)||0)+1;return this._pinMap.set(t,e),this._itemMap.has(t)||this._loadTile(t),e},r.prototype.unpin=function(t){var e=this._pinMap.get(t);if(!e)throw new Error("TextureStore: unpin when not pinned");return 0<--e?this._pinMap.set(t,e):(this._pinMap.del(t),this._visible.has(t)||this._previouslyVisible.has(t)||this._unloadTile(t)),e},r.prototype.query=function(t){var e=this._itemMap.get(t),i=this._pinMap.get(t)||0;return{visible:this._visible.has(t),previouslyVisible:this._previouslyVisible.has(t),hasAsset:null!=e&&null!=e.asset(),hasTexture:null!=e&&null!=e.texture(),pinned:0!==i,pinCount:i}},e.exports=r},{"./collections/LruSet":32,"./collections/Map":33,"./collections/Set":34,"./util/chain":87,"./util/defaults":94,"./util/inherits":101,"./util/retry":109,"minimal-event-emitter":14}],23:[function(t,e,i){"use strict";function n(t){t=o(t||{},a),this._duration=t.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}var r=t("minimal-event-emitter"),o=t("./util/defaults"),s=t("./util/clock"),a={duration:1/0};r(n),n.prototype.start=function(){this._startTime=s(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},n.prototype.started=function(){return null!=this._startTime},n.prototype.stop=function(){(this._startTime=null)!=this._handle&&(clearTimeout(this._handle),this._handle=null)},n.prototype._setup=function(t){this._handle=setTimeout(this._check,t)},n.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},n.prototype._check=function(){var t=s()-this._startTime,e=this._duration-t;this._teardown(),e<=0?(this.emit("timeout"),this._startTime=null):e<1/0&&this._setup(e)},n.prototype.duration=function(){return this._duration},n.prototype.setDuration=function(t){this._duration=t,null!=this._startTime&&this._check()},e.exports=n},{"./util/clock":89,"./util/defaults":94,"minimal-event-emitter":14}],24:[function(t,e,i){"use strict";function n(t,e){var i;if(e=e||{},this._domElement=t,m(t),e.stageType){if(!(i=S[e.stageType]))throw new Error("Unknown stage type: "+e.stageType)}else{for(var n=0;n<I.length;n++)if(I[n].supported()){i=I[n];break}if(!i)throw new Error("None of the stage types are supported")}this._stage=new i(e.stage),f(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),v(this._controlContainer),_(this._controlContainer),b.ios&&this._controlContainer.addEventListener("touchstart",function(t){t.preventDefault()});var r=document.createElement("div");v(r),_(r),y(r),this._controlContainer.appendChild(r),t.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new o(this._stage),this._controls=new s,this._controlMethods=d(this._controls,this._controlContainer,e.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=M.get(this._controlContainer,"touch"),this._hammerManagerMouse=M.get(this._controlContainer,"mouse"),e.cursors=e.cursors||{},this._dragCursor=new w(this._controls,"mouseViewDrag",t,e.cursors.drag),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new l,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._enterIdleHandler=this._enterIdle.bind(this),this._idleTimer.addEventListener("timeout",this._enterIdleHandler),this._leaveIdleHandler=this._leaveIdle.bind(this),this._controls.addEventListener("active",this._leaveIdleHandler),this.addEventListener("sceneChange",this._leaveIdleHandler),this._idleMovement=null}function p(e,t,i){t.listLayers().forEach(function(t){t.mergeEffects({opacity:e})}),t._hotspotContainer.domElement().style.opacity=e}var r=t("minimal-event-emitter"),o=t("./RenderLoop"),s=t("./controls/Controls"),a=(t("./Layer"),t("./TextureStore"),t("./Scene")),l=t("./Timer"),h=t("./stages/WebGl"),u=t("./stages/Css"),c=t("./stages/Flash"),d=t("./controls/registerDefaultControls"),f=t("./renderers/registerDefaultRenderers"),m=t("./util/dom").setOverflowHidden,v=t("./util/dom").setAbsolute,_=t("./util/dom").setFullSize,y=t("./util/dom").setBlocking,g=t("./util/tween"),x=t("./util/noop"),w=(t("./util/type"),t("./controls/DragCursor")),M=t("./controls/HammerGestures"),b=t("bowser"),S={webgl:h,css:u,flash:c},I=[h,u,c];r(n),n.prototype.destroy=function(){for(var t in window.removeEventListener("resize",this._updateSizeListener),this._updateSizeListener=null,this._size=null,this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._currentScene=null,this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._replacedScene=null,this._layerChangeHandler=null,this._viewChangeHandler=null,this._controlMethods)this._controlMethods[t].destroy();for(this._controlMethods=null;this._scenes.length;)this.destroyScene(this._scenes[0]);this._scenes=null,this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._stage=null,this._renderLoop.destroy(),this._renderLoop=null,this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._domElement=null,this._controlContainer=null},n.prototype.updateSize=function(){var t=this._size;t.width=this._domElement.clientWidth,t.height=this._domElement.clientHeight,this._stage.setSize(t)},n.prototype.stage=function(){return this._stage},n.prototype.renderLoop=function(){return this._renderLoop},n.prototype.controls=function(){return this._controls},n.prototype.domElement=function(){return this._domElement},n.prototype.createScene=function(t){t=t||{};var e=this.createEmptyScene({view:t.view});return e.createLayer({source:t.source,geometry:t.geometry,pinFirstLevel:t.pinFirstLevel,textureStoreOpts:t.textureStoreOpts,layerOpts:t.layerOpts}),e},n.prototype.createEmptyScene=function(t){var e=new a(this,(t=t||{}).view);return this._scenes.push(e),e},n.prototype._updateSceneLayers=function(){var t=this._stage,e=this._currentScene,i=this._replacedScene,n=t.listLayers(),r=[];if(i&&(r=r.concat(i.listLayers())),e&&(r=r.concat(e.listLayers())),1!==Math.abs(n.length-r.length))throw new Error("Stage and scene out of sync");if(r.length<n.length)for(var o=0;o<n.length;o++){var s=n[o];if(r.indexOf(s)<0){this._removeLayerFromStage(s);break}}if(r.length>n.length)for(o=0;o<r.length;o++){s=r[o];n.indexOf(s)<0&&this._addLayerToStage(s,o)}},n.prototype._addLayerToStage=function(t,e){t.pinFirstLevel(),this._stage.addLayer(t,e)},n.prototype._removeLayerFromStage=function(t){this._stage.removeLayer(t),t.unpinFirstLevel(),t.textureStore().clearNotPinned()},n.prototype._addSceneEventListeners=function(t){t.addEventListener("layerChange",this._layerChangeHandler),t.addEventListener("viewChange",this._viewChangeHandler)},n.prototype._removeSceneEventListeners=function(t){t.removeEventListener("layerChange",this._layerChangeHandler),t.removeEventListener("viewChange",this._viewChangeHandler)},n.prototype.destroyScene=function(t){var e=this._scenes.indexOf(t);if(e<0)throw new Error("No such scene in viewer");if(this._currentScene===t){this._removeSceneEventListeners(t);for(var i=t.listLayers(),n=0;n<i.length;n++)this._removeLayerFromStage(i[n]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===t){this._removeSceneEventListeners(t);for(i=t.listLayers(),n=0;n<i.length;n++)this._removeLayerFromStage(i[n]);this._replacedScene=null}this._scenes.splice(e,1),t.destroy()},n.prototype.destroyAllScenes=function(){for(;0<this._scenes.length;)this.destroyScene(this._scenes[0])},n.prototype.hasScene=function(t){return 0<=this._scenes.indexOf(t)},n.prototype.listScenes=function(){return[].concat(this._scenes)},n.prototype.scene=function(){return this._currentScene},n.prototype.view=function(){var t=this._currentScene;return t?t.view():null},n.prototype.lookTo=function(t,e,i){var n=this._currentScene;n&&n.lookTo(t,e,i)},n.prototype.startMovement=function(t,e){var i=this._currentScene;i&&i.startMovement(t,e)},n.prototype.stopMovement=function(){var t=this._currentScene;t&&t.stopMovement()},n.prototype.setIdleMovement=function(t,e){this._idleTimer.setDuration(t),this._idleMovement=e},n.prototype.breakIdleMovement=function(){this._leaveIdle(),this._resetIdleTimer()},n.prototype._resetIdleTimer=function(){this._idleTimer.start()},n.prototype._enterIdle=function(){var t=this._currentScene,e=this._idleMovement;t&&e&&t.startMovement(e)},n.prototype._leaveIdle=function(){var t=this._currentScene;t&&t.movement()===this._idleMovement&&t.stopMovement()},n.prototype.switchScene=function(e,t,i){var n=this;t=t||{},i=i||x;var r=this._stage,o=this._currentScene;if(o!==e){if(this._scenes.indexOf(e)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var s=o?o.listLayers():[],a=e.listLayers(),l=r.listLayers();if(o&&(l.length!==s.length||1<l.length&&l[0]!=s[0]))throw new Error("Stage not in sync with viewer");for(var h=null!=t.transitionDuration?t.transitionDuration:1e3,u=null!=t.transitionUpdate?t.transitionUpdate:p,c=(a=e.listLayers(),0);c<a.length;c++)this._addLayerToStage(a[c]);this._cancelCurrentTween=g(h,function(t){u(t,e,o)},function(){if(n._replacedScene){n._removeSceneEventListeners(n._replacedScene),s=n._replacedScene.listLayers();for(var t=0;t<s.length;t++)n._removeLayerFromStage(s[t]);n._replacedScene=null}n._cancelCurrentTween=null,i()}),this._currentScene=e,this._replacedScene=o,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(e)}else i()},e.exports=n},{"./Layer":18,"./RenderLoop":20,"./Scene":21,"./TextureStore":22,"./Timer":23,"./controls/Controls":39,"./controls/DragCursor":41,"./controls/HammerGestures":44,"./controls/registerDefaultControls":51,"./renderers/registerDefaultRenderers":71,"./stages/Css":74,"./stages/Flash":75,"./stages/WebGl":78,"./util/dom":98,"./util/noop":104,"./util/tween":111,"./util/type":112,bowser:1,"minimal-event-emitter":14}],25:[function(t,e,i){"use strict";function n(t,e){e=e||{},this._opts=e,this._element=t,this._timestamp=1,this._lastUsedTime=null}t("minimal-event-emitter")(n),n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.width},n.prototype.height=function(){return this._element.height},n.prototype.dynamic=!0,n.prototype.timestamp=function(){return this._timestamp},n.prototype.changed=function(){this._timestamp++,this.emit("change")},n.prototype.destroy=function(){this._opts.unload&&this._opts.unload()},e.exports=n},{"minimal-event-emitter":14}],26:[function(t,e,i){"use strict";function n(t,e){this._flashElement=t,this._imageId=e}n.prototype.element=function(){return this._imageId},n.prototype.timestamp=function(){return 0},n.prototype.dynamic=!1,n.prototype.destroy=function(){var t=this._flashElement,e=this._imageId;t.unloadImage(e),this._flashElement=null,this._imageId=null},e.exports=n},{}],27:[function(t,e,i){"use strict";function n(t){this._element=t}var r=t("../util/noop");n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.width},n.prototype.height=function(){return this._element.height},n.prototype.timestamp=function(){return 0},n.prototype.dynamic=!1,n.prototype.destroy=r,e.exports=n},{"../util/noop":104}],28:[function(t,e,i){"use strict";function n(t){this._element=t}var r=t("../util/noop");n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.naturalWidth},n.prototype.height=function(){return this._element.naturalHeight},n.prototype.timestamp=function(){return 0},n.prototype.dynamic=!1,n.prototype.destroy=r,e.exports=n},{"../util/noop":104}],29:[function(t,e,i){"use strict";var n=t("./util/defaults"),r={yawSpeed:.1,pitchSpeed:.1,fovSpeed:.1,yawAccel:.01,pitchAccel:.01,fovAccel:.01,targetPitch:0,targetFov:null};e.exports=function(t){var m=(t=n(t||{},r)).yawSpeed,v=t.pitchSpeed,_=t.fovSpeed,y=t.yawAccel,g=t.pitchAccel,x=t.fovAccel,w=t.targetPitch,M=t.targetFov;return function(){var r,o,s,a,l=0,h=0,u=0,c=0,p=0,d=0,f=0;return function(t,e){if(r=(e-l)/1e3,p=Math.min(h+r*y,m),o=p*r,t.yaw=t.yaw+o,null!=w&&t.pitch!==w){var i=.5*u*u/g;d=Math.abs(w-t.pitch)>i?Math.min(u+r*g,v):Math.max(u-r*g,0),s=d*r,w<t.pitch&&(t.pitch=Math.max(w,t.pitch-s)),w>t.pitch&&(t.pitch=Math.min(w,t.pitch+s))}if(null!=M&&t.fov!==w){var n=.5*c*c/x;f=Math.abs(M-t.fov)>n?Math.min(c+r*x,_):Math.max(c-r*x,0),a=f*r,M<t.fov&&(t.fov=Math.max(M,t.fov-a)),M>t.fov&&(t.fov=Math.min(M,t.fov+a))}return l=e,h=p,u=d,c=f,t}}}},{"./util/defaults":94}],30:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){var r,o,s,a;return n=n||{},r=null!=i&&null!=i.absoluteWidth?i.absoluteWidth:null!=i&&null!=i.relativeWidth?i.relativeWidth*t:t,o=i&&null!=i.absoluteHeight?i.absoluteHeight:null!=i&&null!=i.relativeHeight?i.relativeHeight*e:e,s=null!=i&&null!=i.absoluteX?i.absoluteX:null!=i&&null!=i.relativeX?i.relativeX*t:0,a=null!=i&&null!=i.absoluteY?i.absoluteY:null!=i&&null!=i.relativeY?i.relativeY*e:0,n.height=o,n.width=r,n.left=s,n.top=a,n.right=s+r,n.bottom=a+o,n.totalWidth=t,n.totalHeight=e,n}},{}],31:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("LruMap: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("LruMap: bad hash function");if(this._hash=e,"number"!=typeof i||isNaN(i)||i<0)throw new Error("LruMap: bad maximum size");this._maxsize=i,this._keys=[],this._values=[],this._pivot=0}var h=t("../util/mod");n.prototype._modulus=function(){return this._maxsize>this._keys.length?this._keys.length+1:this._maxsize},n.prototype.get=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i))return this._values[e]}return null},n.prototype.set=function(t,e){var i=null,n=!1;if(0===this._maxsize)return t;for(var r=0;r<this._keys.length;r++){var o=this._keys[r];if(this._equals(t,o)){for(var s=r,a=this._modulus();s!==this._pivot;){var l=h(s+1,a);this._keys[s]=this._keys[l],this._values[s]=this._values[l],s=l}n=!0;break}}return n||(i=this._pivot<this._keys.length?this._keys[this._pivot]:null),this._keys[this._pivot]=t,this._values[this._pivot]=e,this._pivot=h(this._pivot+1,this._modulus()),i},n.prototype.del=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i)){for(var n=this._values[e],r=e;r<this._keys.length-1;r++)this._keys[r]=this._keys[r+1],this._values[r]=this._values[r+1];return this._keys.length=this._keys.length-1,this._values.length=this._values.length-1,e<this._pivot&&(this._pivot=h(this._pivot-1,this._modulus())),n}}return null},n.prototype.has=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i))return!0}return!1},n.prototype.size=function(){return this._keys.length},n.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._pivot=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._keys.length;i++)t(this._keys[i],this._values[i]),e+=1;return e},e.exports=n},{"../util/mod":103}],32:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("LruSet: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("LruSet: bad hash function");if(this._hash=e,"number"!=typeof i||isNaN(i)||i<0)throw new Error("LruSet: bad maximum size");this._maxsize=i,this._items=[],this._pivot=0}var l=t("../util/mod");n.prototype._modulus=function(){return this._maxsize>this._items.length?this._items.length+1:this._maxsize},n.prototype.add=function(t){var e=null,i=!1;if(0===this._maxsize)return t;for(var n=0;n<this._items.length;n++){var r=this._items[n];if(this._equals(t,r)){for(var o=n,s=this._modulus();o!==this._pivot;){var a=l(o+1,s);this._items[o]=this._items[a],o=a}i=!0;break}}return i||(e=this._pivot<this._items.length?this._items[this._pivot]:null),this._items[this._pivot]=t,this._pivot=l(this._pivot+1,this._modulus()),e},n.prototype.remove=function(t){for(var e=0;e<this._items.length;e++){var i=this._items[e];if(this._equals(t,i)){for(var n=e;n<this._items.length-1;n++)this._items[n]=this._items[n+1];return this._items.length=this._items.length-1,e<this._pivot&&(this._pivot=l(this._pivot-1,this._modulus())),i}}return null},n.prototype.has=function(t){for(var e=0;e<this._items.length;e++){var i=this._items[e];if(this._equals(t,i))return!0}return!1},n.prototype.size=function(){return this._items.length},n.prototype.clear=function(){this._items.length=0,this._pivot=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._items.length;i++)t(this._items[i]),e+=1;return e},e.exports=n},{"../util/mod":103}],33:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("Map: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("Map: bad hash function");if(this._hash=e,null!=i){if("number"!=typeof i||isNaN(i)||i<1)throw new Error("Map: bad number of buckets");this._nbuckets=i}else this._nbuckets=32;this._keyBuckets=[],this._valBuckets=[];for(var n=0;n<this._nbuckets;n++)this._keyBuckets.push([]),this._valBuckets.push([])}n.prototype._hashmod=function(t){return this._hash(t)%this._nbuckets},n.prototype.get=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return this._valBuckets[e][n]}return null},n.prototype.set=function(t,e){for(var i=this._hashmod(t),n=this._keyBuckets[i],r=this._valBuckets[i],o=0;o<n.length;o++){var s=n[o];if(this._equals(t,s)){var a=r[o];return n[o]=t,r[o]=e,a}}return n.push(t),r.push(e),null},n.prototype.del=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=this._valBuckets[e],r=0;r<i.length;r++){var o=i[r];if(this._equals(t,o)){for(var s=n[r],a=r;a<i.length-1;a++)i[a]=i[a+1],n[a]=n[a+1];return i.length=i.length-1,n.length=n.length-1,s}}return null},n.prototype.has=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return!0}return!1},n.prototype.size=function(){for(var t=0,e=0;e<this._nbuckets;e++)t+=this._keyBuckets[e].length;return t},n.prototype.clear=function(){for(var t=0;t<this._nbuckets;t++){var e=this._keyBuckets[t],i=this._valBuckets[t];e.length=0,i.length=0}},n.prototype.each=function(t){for(var e=0,i=0;i<this._nbuckets;i++)for(var n=this._keyBuckets[i],r=this._valBuckets[i],o=0;o<n.length;o++){t(n[o],r[o]),e+=1}return e},e.exports=n},{}],34:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("Set: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("Set: bad hash function");if(this._hash=e,null!=i){if("number"!=typeof i||isNaN(i)||i<1)throw new Error("Set: bad number of buckets");this._nbuckets=i}else this._nbuckets=32;this._buckets=[];for(var n=0;n<this._nbuckets;n++)this._buckets.push([])}n.prototype._hashmod=function(t){return this._hash(t)%this._nbuckets},n.prototype.add=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return i[n]=t,r}return i.push(t),null},n.prototype.remove=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r)){for(var o=n;o<i.length-1;o++)i[o]=i[o+1];return i.length=i.length-1,r}}return null},n.prototype.has=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return!0}return!1},n.prototype.size=function(){for(var t=0,e=0;e<this._nbuckets;e++)t+=this._buckets[e].length;return t},n.prototype.clear=function(){for(var t=0;t<this._nbuckets;t++)this._buckets[t].length=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._nbuckets;i++)for(var n=this._buckets[i],r=0;r<n.length;r++){t(n[r]),e+=1}return e},e.exports=n},{}],35:[function(t,e,i){"use strict";function n(t){this._concurrency=t&&t.concurrency||1,this._paused=t&&!!t.paused||!1,this._pool=[];for(var e=0;e<this._concurrency;e++)this._pool.push(new r(t));this._next=0}var r=t("./WorkQueue"),o=t("../util/mod");n.prototype.length=function(){for(var t=0,e=0;e<this._pool.length;e++)t+=this._pool[e].length();return t},n.prototype.push=function(t,e){var i=this._next,n=this._pool[i].push(t,e);return this._next=o(this._next+1,this._concurrency),n},n.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var t=0;t<this._concurrency;t++)this._pool[t].pause()}},n.prototype.resume=function(){if(this._paused){this._paused=!1;for(var t=0;t<this._concurrency;t++)this._pool[t].resume()}},e.exports=n},{"../util/mod":103,"./WorkQueue":36}],36:[function(t,e,i){"use strict";function r(t,e){this.fn=t,this.cb=e,this.cfn=null}function n(t){this._queue=[],this._delay=t&&t.delay||0,this._paused=t&&!!t.paused||!1,this._currentTask=null,this._lastFinished=null}var o=t("../util/clock");n.prototype.length=function(){return this._queue.length},n.prototype.push=function(t,e){var i=new r(t,e),n=this._cancel.bind(this,i);return this._queue.push(i),this._next(),n},n.prototype.pause=function(){this._paused||(this._paused=!0)},n.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},n.prototype._start=function(t){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=t;var e=this._finish.bind(this,t);if(t.cfn=t.fn(e),"function"!=typeof t.cfn)throw new Error("WorkQueue: function is not cancellable")},n.prototype._finish=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask!==t)throw new Error("WorkQueue: called finish on wrong task");t.cb.apply(null,e),this._currentTask=null,this._lastFinished=o(),this._next()},n.prototype._cancel=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask===t)t.cfn.apply(null,e);else{var i=this._queue.indexOf(t);0<=i&&(this._queue.splice(i,1),t.cb.apply(null,e))}},n.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var t=o()-this._lastFinished,e=this._delay-t;if(0<e)return void setTimeout(this._next.bind(this),e)}var i=this._queue.shift();this._start(i)}},e.exports=n},{"../util/clock":89}],37:[function(t,e,i){"use strict";function s(t,e,i){var n,r,o,s,a,l,h;n=i,r=t,o=e.colorMatrix,s=r[0],a=r[1],l=r[2],h=r[3],n[0]=o[0]*s+o[1]*a+o[2]*l+o[3]*h,n[1]=o[4]*s+o[5]*a+o[6]*l+o[7]*h,n[2]=o[8]*s+o[9]*a+o[10]*l+o[11]*h,n[3]=o[12]*s+o[13]*a+o[14]*l+o[15]*h,u.add(i,i,e.colorOffset)}var u=t("gl-matrix/src/gl-matrix/vec4"),n=t("gl-matrix/src/gl-matrix/mat4"),a=u.create();e.exports={identity:function(t){var e=t||{};return e.colorOffset=e.colorOffset||u.create(),e.colorMatrix=e.colorMatrix||n.create(),e},applyToPixel:s,applyToImageData:function(t,e){for(var i=t.width,n=t.height,r=t.data,o=0;o<i*n;o++)u.set(a,r[4*o+0]/255,r[4*o+1]/255,r[4*o+2]/255,r[4*o+3]/255),s(a,e,a),r[4*o+0]=255*a[0],r[4*o+1]=255*a[1],r[4*o+2]=255*a[2],r[4*o+3]=255*a[3]}}},{"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec4":11}],38:[function(t,e,i){"use strict";function n(t){t=t||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._clock=t.clock||s,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}var r=t("minimal-event-emitter"),o=t("./Dynamics"),s=t("../util/clock");r(n),n.prototype.add=function(t){if(!this.has(t)){var e={};this._parameters.forEach(function(t){e[t]={dynamics:new o,time:null}});var i=this._updateDynamics.bind(this,e),n={instance:t,dynamics:e,parameterDynamicsHandler:i};t.addEventListener("parameterDynamics",i),this._methods.push(n)}},n.prototype.remove=function(t){var e=this._indexOfInstance(t);if(0<=e){var i=this._methods.splice(e,1)[0];i.instance.removeEventListener("parameterDynamics",i.parameterDynamicsHandler)}},n.prototype.has=function(t){return 0<=this._indexOfInstance(t)},n.prototype._indexOfInstance=function(t){for(var e=0;e<this._methods.length;e++)if(this._methods[e].instance===t)return e;return-1},n.prototype.list=function(){for(var t=[],e=0;e<this._methods.length;e++)t.push(this._methods[e].instance);return t},n.prototype._updateDynamics=function(t,e,i,n){var r=t[i];if(!r)throw new Error("Unknown control parameter "+i);var o=this._clock();r.dynamics.update(n,(o-r.time)/1e3),r.time=o,this.emit("change")},n.prototype._resetComposedOffsets=function(){for(var t=0;t<this._parameters.length;t++)this._composedOffsets[this._parameters[t]]=0},n.prototype.offsets=function(){var t,e=!1,i=this._clock();this._resetComposedOffsets();for(var n=0;n<this._methods.length;n++)for(var r=this._methods[n].dynamics,o=0;o<this._parameters.length;o++){var s=r[t=this._parameters[o]],a=s.dynamics;null!=a.offset&&(this._composedOffsets[t]+=a.offset,a.offset=null);var l=(i-s.time)/1e3,h=a.offsetFromVelocity(l);h&&(this._composedOffsets[t]+=h);var u=a.velocityAfter(l);(a.velocity=u)&&(e=!0),s.time=i}return this._composeReturn.changing=e,this._composeReturn},n.prototype.destroy=function(){for(var t=this.list(),e=0;e<t.length;e++)this.remove(t[e]);this._methods=null},e.exports=n},{"../util/clock":89,"./Dynamics":42,"minimal-event-emitter":14}],39:[function(t,e,i){"use strict";function n(t){t=t||{},this._methods={},this._methodGroups={},this._composer=new r,this._enabled=!t||!t.enabled||!!t.enabled,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}var r=t("./Composer"),o=t("minimal-event-emitter"),s="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;o(n),n.prototype.methods=function(){var t={};for(var e in this._methods)t[e]=this._methods[e];return t},n.prototype.method=function(t){return this._methods[t]},n.prototype.registerMethod=function(t,e,i){if(this._methods[t])throw new Error("Control method already registered with id "+t);this._methods[t]={instance:e,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,t),inactiveHandler:this._handleInactive.bind(this,t)},i&&this.enableMethod(t,e)},n.prototype.unregisterMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&this.disableMethod(t),delete this._methods[t]},n.prototype.enableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled||(e.enabled=!0,e.active&&this._incrementActiveCount(),this._listen(t),this._updateComposer(),this.emit("methodEnabled",t))},n.prototype.disableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&(e.enabled=!1,e.active&&this._decrementActiveCount(),this._unlisten(t),this._updateComposer(),this.emit("methodDisabled",t))},n.prototype.addMethodGroup=function(t,e){this._methodGroups[t]=e},n.prototype.removeMethodGroup=function(t){delete this._methodGroups[t]},n.prototype.methodGroups=function(){var t={};for(var e in this._methodGroups)t[e]=this._methodGroups[e];return t},n.prototype.enableMethodGroup=function(t){var e=this;e._methodGroups[t].forEach(function(t){e.enableMethod(t)})},n.prototype.disableMethodGroup=function(t){var e=this;e._methodGroups[t].forEach(function(t){e.disableMethod(t)})},n.prototype.enabled=function(){return this._enabled},n.prototype.enable=function(){this._enabled=!0,0<this._activeCount&&this.emit("active"),this.emit("enabled"),this._updateComposer()},n.prototype.disable=function(){this._enabled=!1,0<this._activeCount&&this.emit("inactive"),this.emit("disabled"),this._updateComposer()},n.prototype.attach=function(t){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=t,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=t.renderOnNextFrame.bind(t),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},n.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},n.prototype.attached=function(){return null!=this._attachedRenderLoop},n.prototype._listen=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.addEventListener("active",e.activeHandler),e.instance.addEventListener("inactive",e.inactiveHandler)},n.prototype._unlisten=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.removeEventListener("active",e.activeHandler),e.instance.removeEventListener("inactive",e.inactiveHandler)},n.prototype._handleActive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active||(e.active=!0,this._incrementActiveCount())},n.prototype._handleInactive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active&&(e.active=!1,this._decrementActiveCount())},n.prototype._incrementActiveCount=function(){this._activeCount++,s&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},n.prototype._decrementActiveCount=function(){this._activeCount--,s&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},n.prototype._checkActiveCount=function(){var t=0;for(var e in this._methods){var i=this._methods[e];i.enabled&&i.active&&t++}if(t!=this._activeCount)throw new Error("Bad control state")},n.prototype._updateComposer=function(){var t=this._composer;for(var e in this._methods){var i=this._methods[e],n=this._enabled&&i.enabled;n&&!t.has(i.instance)&&t.add(i.instance),!n&&t.has(i.instance)&&t.remove(i.instance)}},n.prototype._updateViewsWithControls=function(){var t=this._composer.offsets();t.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var e=this._attachedRenderLoop.stage().listLayers(),i=0;i<e.length;i++){var n=e[i].view();this.updatedViews_.indexOf(n)<0&&(e[i].view().updateWithControlParameters(t.offsets),this.updatedViews_.push(n))}},n.prototype.destroy=function(){this.detach(),this._composer.destroy(),this._methods=null},e.exports=n},{"./Composer":38,"minimal-event-emitter":14}],40:[function(t,e,i){"use strict";function n(t,e,i){this._element=t,this._opts=s(i||{},h),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new r,y:new r},this._hammer=o.get(t,e),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleEnd.bind(this)),this._hammer.on("pancancel",this._handleEnd.bind(this))}var r=t("./Dynamics"),o=t("./HammerGestures"),s=t("../util/defaults"),a=t("minimal-event-emitter"),l=t("./util").maxFriction,h={friction:6,maxFrictionTime:.3},u="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;a(n),n.prototype.destroy=function(){this._hammer.release(),this._element=null,this._opts=null,this._startEvent=null,this._lastEvent=null,this._active=null,this._dynamics=null,this._hammer=null},n.prototype._handleHammerEvent=function(t){if(t.isFirst){if(u&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(t.isFinal){if(u&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},n.prototype._handleStart=function(t){t.preventDefault(),this._startEvent=t},n.prototype._handleMove=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsMove(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},n.prototype._handleEnd=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},n.prototype._updateDynamicsMove=function(t){var e=t.deltaX,i=t.deltaY,n=this._lastEvent||this._startEvent;n&&(e-=n.deltaX,i-=n.deltaY);var r=this._element.getBoundingClientRect();e/=r.right-r.left,i/=r.bottom-r.top,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-e,this._dynamics.y.offset=-i,this._lastEvent=t};var c=[null,null];n.prototype._updateDynamicsRelease=function(t){var e=this._element.getBoundingClientRect(),i=e.right-e.left,n=e.bottom-e.top,r=1e3*t.velocityX/i,o=1e3*t.velocityY/n;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=r,this._dynamics.y.velocity=o,l(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,c),this._dynamics.x.friction=c[0],this._dynamics.y.friction=c[1]},e.exports=n},{"../util/defaults":94,"./Dynamics":42,"./HammerGestures":44,"./util":52,"minimal-event-emitter":14}],41:[function(t,e,i){"use strict";function n(t,e,i,n){(n=n||{}).active=["move"],n.inactive=["default"],n.disabled=[null],this._controls=t,this._id=e,this._attached=!1,this._setActiveCursor=r.bind(null,i,n.active),this._setInactiveCursor=r.bind(null,i,n.inactive),this._setDisabledCursor=r.bind(null,i,n.disabled),t.method(e).enabled&&this._attachCursor(t.method(e)),this._enableChangeHandler=this._updateAttach.bind(this),t.addEventListener("methodEnabled",this._enableChangeHandler),t.addEventListener("methodDisabled",this._enableChangeHandler),t.addEventListener("enabled",this._enableChangeHandler),t.addEventListener("disabled",this._enableChangeHandler)}function r(e,t){t.forEach(function(t){e.style.cursor=t})}n.prototype.destroy=function(){this._detachCursor(this._controls.method(this._id)),this._controls.removeEventListener("methodEnabled",this._enableChangeHandler),this._controls.removeEventListener("methodDisabled",this._enableChangeHandler),this._controls.removeEventListener("enabled",this._enableChangeHandler),this._controls.removeEventListener("disabled",this._enableChangeHandler)},n.prototype._updateAttach=function(){var t=this._controls,e=this._id;t.enabled()&&t.method(e).enabled?this._attachCursor(t.method(e)):this._detachCursor(t.method(e))},n.prototype._attachCursor=function(t){this._attached||(t.instance.addEventListener("active",this._setActiveCursor),t.instance.addEventListener("inactive",this._setInactiveCursor),t.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},n.prototype._detachCursor=function(t){this._attached&&(t.instance.removeEventListener("active",this._setActiveCursor),t.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},e.exports=n},{}],42:[function(t,e,i){"use strict";function n(){this.velocity=null,this.friction=null,this.offset=null}n.equals=function(t,e){return t.velocity===e.velocity&&t.friction===e.friction&&t.offset===e.offset},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.update=function(t,e){t.offset&&(this.offset=this.offset||0,this.offset+=t.offset);var i=this.offsetFromVelocity(e);i&&(this.offset=this.offset||0,this.offset+=i),this.velocity=t.velocity,this.friction=t.friction},n.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},n.prototype.velocityAfter=function(t){return this.velocity?this.friction?(e=this.velocity,i=this.friction*t,e<0?Math.min(0,e+i):0<e?Math.max(0,e-i):0):this.velocity:null;var e,i},n.prototype.offsetFromVelocity=function(t){t=Math.min(t,this.nullVelocityTime());var e=this.velocityAfter(t);return(this.velocity+e)/2*t},n.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)},e.exports=n},{}],43:[function(t,e,i){"use strict";function n(t,e,i,n){if(!t)throw new Error("ElementPressControlMethod: element must be defined");if(!e)throw new Error("ElementPressControlMethod: parameter must be defined");if(!i)throw new Error("ElementPressControlMethod: velocity must be defined");if(!n)throw new Error("ElementPressControlMethod: friction must be defined");this._element=t,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),t.addEventListener("mousedown",this._pressHandler),t.addEventListener("mouseup",this._releaseHandler),t.addEventListener("mouseleave",this._releaseHandler),t.addEventListener("touchstart",this._pressHandler),t.addEventListener("touchmove",this._releaseHandler),t.addEventListener("touchend",this._releaseHandler),this._parameter=e,this._velocity=i,this._friction=n,this._dynamics=new r,this._pressing=!1}var r=t("./Dynamics");t("minimal-event-emitter")(n),n.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler)},n.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},n.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1},e.exports=n},{"./Dynamics":42,"minimal-event-emitter":14}],44:[function(t,e,i){"use strict";function n(){this._managers=new l(r,o)}function r(t,e){return t===e}function o(t){for(var e=t.id||t.toString();e.length<5;)e+="0";return h(e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4))}function s(t,e,i,n){this._manager=e,this._element=i,this._type=n,this._hammerGestures=t,this._eventHandlers=[]}var a=t("hammerjs"),l=t("../collections/Map"),h=t("../util/hash"),u=t("bowser");n.prototype.get=function(t,e){this._managers.has(t)||this._managers.set(t,{});var i=this._managers.get(t);i[e]||(i[e]=this._createManager(t,e));var n=i[e];return n.refs+=1,new s(this,n.manager,t,e)},n.prototype._createManager=function(t,e){var i=new a.Manager(t);return"mouse"===e?i.add(new a.Pan({direction:a.DIRECTION_ALL,threshold:0})):"touch"!==e&&"pen"!==e&&"kinect"!==e||(i.add(new a.Pan({direction:a.DIRECTION_ALL,threshold:20,pointers:1})),u.msie&&parseFloat(u.version)<10||i.add(new a.Pinch)),{manager:i,refs:0}},n.prototype._releaseHandle=function(t,e){var i=this._managers.get(t)[e];--i.refs,i.refs<=0&&(i.manager.destroy(),this._managers.get(t)[e]=null)},s.prototype.on=function(t,e){function i(t){n===t.pointerType&&e(t)}var n=this._type;this._eventHandlers.push({events:t,handler:i}),this._manager.on(t,i)},s.prototype.release=function(){for(var t=0;t<this._eventHandlers.length;t++){var e=this._eventHandlers[t];this._manager.off(e.events,e.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},s.prototype.manager=function(){return this._manager},e.exports=new n},{"../collections/Map":33,"../util/hash":100,bowser:1,hammerjs:13}],45:[function(t,e,i){"use strict";function n(t,e,i,n,r){if(!t)throw new Error("KeyControlMethod: keyCode must be defined");if(!e)throw new Error("KeyControlMethod: parameter must be defined");if(!i)throw new Error("KeyControlMethod: velocity must be defined");if(!n)throw new Error("KeyControlMethod: friction must be defined");r=r||document,this._keyCode=t,this._parameter=e,this._velocity=i,this._friction=n,this._element=r,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new o,this._pressing=!1}var o=t("./Dynamics");t("minimal-event-emitter")(n),n.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler)},n.prototype._handlePress=function(t){t.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},n.prototype._handleRelease=function(t){t.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},n.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1},e.exports=n},{"./Dynamics":42,"minimal-event-emitter":14}],46:[function(t,e,i){"use strict";function n(t,e,i){this._hammer=o.get(t,e),this._lastEvent=null,this._active=!1,this._dynamics=new r,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}var r=t("./Dynamics"),o=t("./HammerGestures");t("minimal-event-emitter")(n),n.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._lastEvent=null,this._active=null,this._dynamics=null},n.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},n.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},n.prototype._handleEvent=function(t){var e=t.scale;this._lastEvent&&(e/=this._lastEvent.scale),this._dynamics.offset=-1*(e-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=t},e.exports=n},{"./Dynamics":42,"./HammerGestures":44,"minimal-event-emitter":14}],47:[function(t,e,i){"use strict";function n(t,e,i){this._element=t,this._opts=s(i||{},h),this._active=!1,this._hammer=o.get(t,e),this._dynamics={x:new r,y:new r},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}var r=t("./Dynamics"),o=t("./HammerGestures"),s=t("../util/defaults"),a=t("minimal-event-emitter"),l=t("./util").maxFriction,h={speed:8,friction:6,maxFrictionTime:.3};a(n),n.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._element=null,this._opts=null,this._active=null,this._dynamics=null},n.prototype._handleStart=function(t){t.preventDefault(),this._active||(this._active=!0,this.emit("active"))},n.prototype._handleMove=function(t){t.preventDefault(),this._updateDynamics(t,!1)},n.prototype._handleRelease=function(t){t.preventDefault(),this._updateDynamics(t,!0),this._active&&(this._active=!1,this.emit("inactive"))};var u=[null,null];n.prototype._updateDynamics=function(t,e){var i=this._element.getBoundingClientRect(),n=i.right-i.left,r=i.bottom-i.top,o=Math.max(n,r),s=t.deltaX/o*this._opts.speed,a=t.deltaY/o*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=s,this._dynamics.y.velocity=a,e&&(l(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,u),this._dynamics.x.friction=u[0],this._dynamics.y.friction=u[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)},e.exports=n},{"../util/defaults":94,"./Dynamics":42,"./HammerGestures":44,"./util":52,"minimal-event-emitter":14}],48:[function(t,e,i){"use strict";function n(t,e){this._opts=a(e||{},l),this._dynamics=new o,this._eventList=[];var i=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=new s(t,i.bind(this))}function r(t){var e=1==t.deltaMode?20:1;return t.deltaY*e}var o=t("./Dynamics"),s=t("./WheelListener"),a=t("../util/defaults"),l={frictionTime:.2,zoomDelta:.001};t("minimal-event-emitter")(n),n.prototype.destroy=function(){this._wheelListener.remove(),this._opts=null,this._dynamics=null,this._eventList=null},n.prototype.withoutSmoothing=function(t){this._dynamics.offset=r(t)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},n.prototype.withSmoothing=function(t){var e=t.timeStamp;for(this._eventList.push(t);this._eventList[0].timeStamp<e-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var i=0,n=0;n<this._eventList.length;n++)i+=r(this._eventList[n])*this._opts.zoomDelta/this._opts.frictionTime;this._dynamics.velocity=i,this._dynamics.friction=Math.abs(i)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},e.exports=n},{"../util/defaults":94,"./Dynamics":42,"./WheelListener":50,"minimal-event-emitter":14}],49:[function(t,e,i){"use strict";function n(t){if(!t)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=t,this._dynamics=new r}var r=t("./Dynamics");t("../util/defaults"),t("minimal-event-emitter")(n),n.prototype.destroy=function(){},n.prototype.setVelocity=function(t){this._dynamics.velocity=t,this.emit("parameterDynamics",this._parameter,this._dynamics)},n.prototype.setFriction=function(t){this._dynamics.friction=t,this.emit("parameterDynamics",this._parameter,this._dynamics)},e.exports=n},{"../util/defaults":94,"./Dynamics":42,"minimal-event-emitter":14}],50:[function(t,e,i){"use strict";function o(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":null}function n(t,e,i){var n,r=o();if("wheel"===r)this._fun=e,this._elem=t,this._elem.addEventListener("wheel",this._fun,i);else{if("mousewheel"!==r)throw new Error("Browser does not support mouse wheel events");this._fun=(n=e,function(t){var e={originalEvent:t=t||window.event,target:t.target||t.srcElement,type:"wheel",deltaMode:1,deltaX:0,deltaZ:0,timeStamp:t.timeStamp||Date.now(),preventDefault:t.preventDefault.bind(t)};return e.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-.025*t.wheelDeltaX),n(e)}),this._elem=t,this._elem.addEventListener("mousewheel",this._fun,i)}}n.prototype.remove=function(){var t=o();"wheel"===t?this._elem.removeEventListener("wheel",this._fun):"mousewheel"===t&&this._elem.removeEventListener("mousewheel",this._fun)},e.exports=n},{}],51:[function(t,e,i){"use strict";var u=t("../util/defaults"),c=t("./Drag"),p=t("./Qtvr"),d=t("./ScrollZoom"),f=t("./PinchZoom"),m=t("./Key"),v={mouseViewMode:"drag"};e.exports=function(t,e,i){i=u(i||{},v);var n={mouseViewDrag:new c(e,"mouse"),mouseViewQtvr:new p(e,"mouse"),touchView:new c(e,"touch"),pinch:new f(e,"touch"),leftArrowKey:new m(37,"x",-.7,3),rightArrowKey:new m(39,"x",.7,3),upArrowKey:new m(38,"y",-.7,3),downArrowKey:new m(40,"y",.7,3),plusKey:new m(107,"zoom",-.7,3),minusKey:new m(109,"zoom",.7,3),wKey:new m(87,"y",-.7,3),aKey:new m(65,"x",-.7,3),sKey:new m(83,"y",.7,3),dKey:new m(68,"x",.7,3),qKey:new m(81,"roll",.7,3),eKey:new m(69,"roll",-.7,3)};!1!==i.scrollZoom&&(n.scrollZoom=new d(e));var r={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]},o=["scrollZoom","touchView","pinch"];switch(i.mouseViewMode){case"drag":o.push("mouseViewDrag");break;case"qtvr":o.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+i.mouseViewMode)}for(var s in n){var a=n[s];t.registerMethod(s,a),0<=o.indexOf(s)&&t.enableMethod(s)}for(var l in r){var h=r[l];t.addMethodGroup(l,h)}return n}},{"../util/defaults":94,"./Drag":40,"./Key":45,"./PinchZoom":46,"./Qtvr":47,"./ScrollZoom":48}],52:[function(t,e,i){"use strict";function s(t,e,i,n){var r=Math.atan(e/t);n[0]=i*Math.cos(r),n[1]=i*Math.sin(r)}e.exports={maxFriction:function(t,e,i,n,r){var o=Math.sqrt(Math.pow(e,2)+Math.pow(i,2));s(e,i,t=Math.max(t,o/n),r),r[0]=Math.abs(r[0]),r[1]=Math.abs(r[1])},changeVectorNorm:s}},{}],53:[function(t,e,i){"use strict";function x(t,e,i,n,r){this.face=t,this.x=e,this.y=i,this.z=n,this._geometry=r,this._level=r.levelList[n]}function n(t){if(this.constructor.super_.call(this,t),this._size=t.size,this._tileSize=t.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function r(t){if("array"!==d(t))throw new Error("Level list must be an array");this.levelList=u(t,n),this.selectableLevelList=c(this.levelList);for(var e=1;e<this.levelList.length;e++)this.levelList[e]._validateWithParentLevel(this.levelList[e-1]);this._graphFinder=new a(x.equals,x.hash),this._neighborsCache=new l(x.equals,x.hash,64),this._vec=b.create(),this._viewSize={},this._viewParams={},this._tileVertices=[b.create(),b.create(),b.create(),b.create()]}for(var o=t("../util/inherits"),s=t("../util/hash"),a=t("../GraphFinder"),l=t("../collections/LruMap"),h=t("./Level"),u=t("./common").makeLevelList,c=t("./common").makeSelectableLevelList,w=t("../util/rotateVector"),M=t("../util/clamp"),p=t("../util/cmp"),d=t("../util/type"),b=t("gl-matrix/src/gl-matrix/vec3"),f="fudlrb",S={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},v={},m=0;m<f.length;m++){var _=f[m],y=S[_],g=b.fromValues(0,0,-1);w(g,g,y.y,y.x,0),v[_]=g}var I={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},E=[[0,1],[1,0],[0,-1],[-1,0]];x.prototype.rotX=function(){return S[this.face].x},x.prototype.rotY=function(){return S[this.face].y},x.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},x.prototype.centerY=function(){return.5-(this.y+.5)/this._level.numVerticalTiles()},x.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},x.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},x.prototype.width=function(){return this._level.tileWidth()},x.prototype.height=function(){return this._level.tileHeight()},x.prototype.levelWidth=function(){return this._level.width()},x.prototype.levelHeight=function(){return this._level.height()},x.prototype.atTopLevel=function(){return 0===this.z},x.prototype.atBottomLevel=function(){return this.z===this._geometry.levelList.length-1},x.prototype.atTopEdge=function(){return 0===this.y},x.prototype.atBottomEdge=function(){return this.y===this._level.numVerticalTiles()-1},x.prototype.atLeftEdge=function(){return 0===this.x},x.prototype.atRightEdge=function(){return this.x===this._level.numHorizontalTiles()-1},x.prototype.padTop=function(){return this.atTopEdge()&&/[fu]/.test(this.face)},x.prototype.padBottom=function(){return!this.atBottomEdge()||/[fd]/.test(this.face)},x.prototype.padLeft=function(){return this.atLeftEdge()&&/[flud]/.test(this.face)},x.prototype.padRight=function(){return!this.atRightEdge()||/[frud]/.test(this.face)},x.prototype.vertices=function(t){function e(t,e,i){b.set(t,e,i,-.5),w(t,t,n.y,n.x,0)}var n=S[this.face],i=this.centerX()-this.scaleX()/2,r=this.centerX()+this.scaleX()/2,o=this.centerY()-this.scaleY()/2,s=this.centerY()+this.scaleY()/2;return e(t[0],i,s),e(t[1],r,s),e(t[2],r,o),e(t[3],i,o),t},x.prototype.parent=function(){if(this.atTopLevel())return null;var t=this.face,e=this.z,i=this.x,n=this.y,r=this._geometry,o=r.levelList[e],s=r.levelList[e-1];return new x(t,Math.floor(i/o.numHorizontalTiles()*s.numHorizontalTiles()),Math.floor(n/o.numVerticalTiles()*s.numVerticalTiles()),e-1,r)},x.prototype.children=function(t){if(this.atBottomLevel())return null;var e=this.face,i=this.z,n=this.x,r=this.y,o=this._geometry,s=o.levelList[i],a=o.levelList[i+1],l=a.numHorizontalTiles()/s.numHorizontalTiles(),h=a.numVerticalTiles()/s.numVerticalTiles();t=t||[];for(var u=0;u<l;u++)for(var c=0;c<h;c++){var p=l*n+u,d=h*r+c,f=i+1;t.push(new x(e,p,d,f,o))}return t},x.prototype.neighbors=function(){var t=this._geometry,e=t._neighborsCache,i=e.get(this);if(i)return i;for(var n=t._vec,r=this.face,o=this.x,s=this.y,a=this.z,l=this._level,h=l.numHorizontalTiles(),u=l.numVerticalTiles(),c=[],p=0;p<E.length;p++){var d=o+E[p][0],f=s+E[p][1],m=a,v=r;if(d<0||h<=d||f<0||u<=f){var _,y=this.centerX(),g=this.centerY();d<0?(b.set(n,-.5,g,-.5),v=I[r][0]):h<=d?(b.set(n,.5,g,-.5),v=I[r][1]):f<0?(b.set(n,y,.5,-.5),v=I[r][2]):u<=f&&(b.set(n,y,-.5,-.5),v=I[r][3]),w(n,n,(_=S[r]).y,_.x,0),w(n,n,-(_=S[v]).y,-_.x,0),d=M(Math.floor((.5+n[0])*h),0,h-1),f=M(Math.floor((.5-n[1])*u),0,u-1)}c.push(new x(v,d,f,m,t))}return e.set(this,c),c},x.prototype.hash=function(){return x.hash(this)},x.prototype.equals=function(t){return x.equals(this,t)},x.prototype.cmp=function(t){return x.cmp(this,t)},x.prototype.str=function(){return x.str(this)},x.hash=function(t){return null!=t?s(t.face.charCodeAt(0),t.z,t.x,t.y):0},x.equals=function(t,e){return null!=t&&null!=e&&t.face===e.face&&t.z===e.z&&t.x===e.x&&t.y===e.y},x.cmp=function(t,e){var i=f.indexOf(t.face),n=f.indexOf(e.face);return p(t.z,e.z)||p(i,n)||p(t.y,e.y)||p(t.x,e.x)},x.str=function(t){return"CubeTile("+t.face+", "+t.x+", "+t.y+", "+t.z+")"},o(n,h),n.prototype.width=function(){return this._size},n.prototype.height=function(){return this._size},n.prototype.tileWidth=function(){return this._tileSize},n.prototype.tileHeight=function(){return this._tileSize},n.prototype._validateWithParentLevel=function(t){var e=this.width(),i=this.height(),n=this.tileWidth(),r=this.tileHeight(),o=this.numHorizontalTiles(),s=this.numVerticalTiles(),a=t.width(),l=t.height(),h=t.tileWidth(),u=t.tileHeight(),c=t.numHorizontalTiles(),p=t.numVerticalTiles();if(e%a!=0)throw new Error("Level width must be multiple of parent level: "+e+" vs. "+a);if(i%l!=0)throw new Error("Level height must be multiple of parent level: "+i+" vs. "+l);if(o%c!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+o+" ("+e+"/"+n+") vs. "+c+" ("+a+"/"+h+")");if(s%p!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+s+" ("+i+"/"+r+") vs. "+p+" ("+l+"/"+u+")")},r.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},r.prototype.levelTiles=function(t,e){var i=this.levelList.indexOf(t),n=t.numHorizontalTiles()-1,r=t.numVerticalTiles()-1;e=e||[];for(var o=0;o<f.length;o++)for(var s=f[o],a=0;a<=n;a++)for(var l=0;l<=r;l++)e.push(new x(s,a,l,i,this));return e},r.prototype._closestTile=function(t,e){var i=this._vec,n=1/0,r=null;for(var o in b.set(i,0,0,-1),w(i,i,-t.yaw,-t.pitch,-t.roll),v){var s=v[o],a=1-b.dot(s,i);a<n&&(n=a,r=o)}for(var l=Math.max(Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2]))/.5,h=0;h<3;h++)i[h]=i[h]/l;var u=S[r];w(i,i,-u.y,-u.x,-u.z);var c=this.levelList.indexOf(e),p=e.numHorizontalTiles(),d=e.numVerticalTiles(),f=i[0],m=i[1];return new x(r,M(Math.floor((.5+f)*p),0,p-1),M(Math.floor((.5-m)*d),0,d-1),c,this)},r.prototype.visibleTiles=function(e,t,i){function n(t){return t.vertices(s),e.intersects(s)}var r=this._viewSize,o=this._viewParams,s=this._tileVertices,a=this._graphFinder;if(i=i||[],e.size(r),0===r.width||0===r.height)return i;var l,h=this._closestTile(e.parameters(o),t);if(!n(h))throw new Error("Starting tile is not visible");for(a.start(h,function(t){return t.neighbors()},n);null!=(l=a.next());)i.push(l);return i},r.TileClass=r.prototype.TileClass=x,r.type=r.prototype.type="cube",x.type=x.prototype.type="cube",e.exports=r},{"../GraphFinder":15,"../collections/LruMap":31,"../util/clamp":88,"../util/cmp":90,"../util/hash":100,"../util/inherits":101,"../util/rotateVector":110,"../util/type":112,"./Level":56,"./common":57,"gl-matrix/src/gl-matrix/vec3":10}],54:[function(t,e,i){"use strict";function r(t,e){this.z=t,this._geometry=e,this._level=e.levelList[t]}function n(t){this.constructor.super_.call(this,t),this._width=t.width}function o(t){if("array"!==c(t))throw new Error("Level list must be an array");this.levelList=h.makeLevelList(t,n),this.selectableLevelList=h.makeSelectableLevelList(this.levelList)}var s=t("../util/inherits"),a=t("../util/hash"),l=t("../util/cmp"),h=t("./common"),u=t("./Level"),c=t("../util/type");r.prototype.rotX=function(){return 0},r.prototype.rotY=function(){return 0},r.prototype.centerX=function(){return.5},r.prototype.centerY=function(){return.5},r.prototype.scaleX=function(){return 1},r.prototype.scaleY=function(){return 1},r.prototype.width=function(){return this._level.tileWidth()},r.prototype.height=function(){return this._level.tileHeight()},r.prototype.levelWidth=function(){return this._level.width()},r.prototype.levelHeight=function(){return this._level.height()},r.prototype.atTopLevel=function(){return 0===this.z},r.prototype.atBottomLevel=function(){return this.z===this._geometry.levelList.length-1},r.prototype.atTopEdge=function(){return!0},r.prototype.atBottomEdge=function(){return!0},r.prototype.atLeftEdge=function(){return!0},r.prototype.atRightEdge=function(){return!0},r.prototype.padTop=function(){return!1},r.prototype.padBottom=function(){return!1},r.prototype.padLeft=function(){return!1},r.prototype.padRight=function(){return!1},r.prototype.parent=function(){return this.atTopLevel()?null:new r(this.z-1,this._geometry)},r.prototype.children=function(t){return this.atBottomLevel()?null:((t=t||[]).push(new r(this.z+1,this._geometry)),t)},r.prototype.neighbors=function(){return[]},r.prototype.hash=function(){return r.hash(this)},r.prototype.equals=function(t){return r.equals(this,t)},r.prototype.cmp=function(t){return r.cmp(this,t)},r.prototype.str=function(){return r.str(this)},r.hash=function(t){return a(t.z)},r.equals=function(t,e){return t.z===e.z},r.cmp=function(t,e){return l(t.z,e.z)},r.str=function(t){return"EquirectTile("+t.z+")"},s(n,u),n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._width/2},n.prototype.tileWidth=function(){return this._width},n.prototype.tileHeight=function(){return this._width/2},o.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},o.prototype.levelTiles=function(t,e){var i=this.levelList.indexOf(t);return(e=e||[]).push(new r(i,this)),e},o.prototype.visibleTiles=function(t,e,i){var n=new r(this.levelList.indexOf(e),this);(i=i||[]).length=0,i.push(n)},o.TileClass=o.prototype.TileClass=r,o.type=o.prototype.type="equirect",r.type=r.prototype.type="equirect",e.exports=o},{"../util/cmp":90,"../util/hash":100,"../util/inherits":101,"../util/type":112,"./Level":56,"./common":57}],55:[function(t,e,i){"use strict";function f(t,e,i,n){this.x=t,this.y=e,this.z=i,this._geometry=n,this._level=n.levelList[i]}function n(t){this.constructor.super_.call(this,t),this._width=t.width,this._height=t.height,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight}function r(t){if("array"!==v(t))throw new Error("Level list must be an array");this.levelList=u(t,n),this.selectableLevelList=c(this.levelList);for(var e=1;e<this.levelList.length;e++)this.levelList[e]._validateWithParentLevel(this.levelList[e-1]);this._graphFinder=new a(f.equals,f.hash),this._neighborsCache=new l(f.equals,f.hash,64),this._viewSize={},this._viewParams={},this._tileVertices=[_.create(),_.create(),_.create(),_.create()]}var o=t("../util/inherits"),s=t("../util/hash"),a=t("../GraphFinder"),l=t("../collections/LruMap"),h=t("./Level"),u=t("./common").makeLevelList,c=t("./common").makeSelectableLevelList,p=t("../util/clamp"),d=t("../util/mod"),m=t("../util/cmp"),v=t("../util/type"),_=t("gl-matrix/src/gl-matrix/vec2"),y=[[0,1],[1,0],[0,-1],[-1,0]];f.prototype.rotX=function(){return 0},f.prototype.rotY=function(){return 0},f.prototype.centerX=function(){var t=this._level.width(),e=this._level.tileWidth();return(this.x*e+.5*this.width())/t-.5},f.prototype.centerY=function(){var t=this._level.height(),e=this._level.tileHeight();return.5-(this.y*e+.5*this.height())/t},f.prototype.scaleX=function(){var t=this._level.width();return this.width()/t},f.prototype.scaleY=function(){var t=this._level.height();return this.height()/t},f.prototype.width=function(){var t=this._level.width(),e=this._level.tileWidth();return this.atRightEdge()&&d(t,e)||e},f.prototype.height=function(){var t=this._level.height(),e=this._level.tileHeight();return this.atBottomEdge()&&d(t,e)||e},f.prototype.levelWidth=function(){return this._level.width()},f.prototype.levelHeight=function(){return this._level.height()},f.prototype.atTopLevel=function(){return 0===this.z},f.prototype.atBottomLevel=function(){return this.z===this._geometry.levelList.length-1},f.prototype.atTopEdge=function(){return 0===this.y},f.prototype.atBottomEdge=function(){return this.y===this._level.numVerticalTiles()-1},f.prototype.atLeftEdge=function(){return 0===this.x},f.prototype.atRightEdge=function(){return this.x===this._level.numHorizontalTiles()-1},f.prototype.padTop=function(){return!1},f.prototype.padBottom=function(){return!this.atBottomEdge()},f.prototype.padLeft=function(){return!1},f.prototype.padRight=function(){return!this.atRightEdge()},f.prototype.vertices=function(t){var e=this.centerX()-this.scaleX()/2,i=this.centerX()+this.scaleX()/2,n=this.centerY()-this.scaleY()/2,r=this.centerY()+this.scaleY()/2;return _.set(t[0],e,r),_.set(t[1],i,r),_.set(t[2],i,n),_.set(t[3],e,n),t},f.prototype.parent=function(){if(this.atTopLevel())return null;var t=this._geometry,e=this.z-1;return new f(Math.floor(this.x/2),Math.floor(this.y/2),e,t)},f.prototype.children=function(t){if(this.atBottomLevel())return null;var e=this._geometry,i=this.z+1;return(t=t||[]).push(new f(2*this.x,2*this.y,i,e)),t.push(new f(2*this.x,2*this.y+1,i,e)),t.push(new f(2*this.x+1,2*this.y,i,e)),t.push(new f(2*this.x+1,2*this.y+1,i,e)),t},f.prototype.neighbors=function(){var t=this._geometry,e=t._neighborsCache,i=e.get(this);if(i)return i;for(var n=this.x,r=this.y,o=this.z,s=this._level,a=s.numHorizontalTiles()-1,l=s.numVerticalTiles()-1,h=[],u=0;u<y.length;u++){var c=n+y[u][0],p=r+y[u][1],d=o;0<=c&&c<=a&&0<=p&&p<=l&&h.push(new f(c,p,d,t))}return e.set(this,h),h},f.prototype.hash=function(){return f.hash(this)},f.prototype.equals=function(t){return f.equals(this,t)},f.prototype.cmp=function(t){return f.cmp(this,t)},f.prototype.str=function(){return f.str(this)},f.hash=function(t){return null!=t?s(t.z,t.x,t.y):0},f.equals=function(t,e){return null!=t&&null!=e&&t.z===e.z&&t.x===e.x&&t.y===e.y},f.cmp=function(t,e){return m(t.z,e.z)||m(t.y,e.y)||m(t.x,e.x)},f.str=function(t){return"FlatTile("+t.x+", "+t.y+", "+t.z+")"},o(n,h),n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.tileWidth=function(){return this._tileWidth},n.prototype.tileHeight=function(){return this._tileHeight},n.prototype._validateWithParentLevel=function(t){var e=this.width(),i=this.height(),n=this.tileWidth(),r=this.tileHeight(),o=t.width(),s=t.height(),a=t.tileWidth(),l=t.tileHeight();return e%o!=0?new Error("Level width must be multiple of parent level: "+e+" vs. "+o):i%s!=0?new Error("Level height must be multiple of parent level: "+i+" vs. "+s):n%a!=0?new Error("Level tile width must be multiple of parent level: "+n+" vs. "+a):r%l!=0?new Error("Level tile height must be multiple of parent level: "+r+" vs. "+l):void 0},r.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},r.prototype.levelTiles=function(t,e){var i=this.levelList.indexOf(t),n=t.numHorizontalTiles()-1,r=t.numVerticalTiles()-1;e=e||[];for(var o=0;o<=n;o++)for(var s=0;s<=r;s++)e.push(new f(o,s,i,this));return e},r.prototype._closestTile=function(t,e){var i=t.x,n=t.y,r=this.levelList.indexOf(e),o=e.width(),s=e.height(),a=e.tileWidth(),l=e.tileHeight(),h=e.numHorizontalTiles(),u=e.numVerticalTiles();return new f(p(Math.floor(i*o/a),0,h-1),p(Math.floor(n*s/l),0,u-1),r,this)},r.prototype.visibleTiles=function(e,t,i){function n(t){return t.vertices(s),e.intersects(s)}var r=this._viewSize,o=this._viewParams,s=this._tileVertices,a=this._graphFinder;if(i=i||[],e.size(r),0===r.width||0===r.height)return i;var l,h=this._closestTile(e.parameters(o),t);if(!n(h))throw new Error("Starting tile is not visible");for(a.start(h,function(t){return t.neighbors()},n);null!=(l=a.next());)i.push(l);return i},r.TileClass=r.prototype.TileClass=f,r.type=r.prototype.type="flat",f.type=f.prototype.type="flat",e.exports=r},{"../GraphFinder":15,"../collections/LruMap":31,"../util/clamp":88,"../util/cmp":90,"../util/hash":100,"../util/inherits":101,"../util/mod":103,"../util/type":112,"./Level":56,"./common":57,"gl-matrix/src/gl-matrix/vec2":9}],56:[function(t,e,i){"use strict";function n(t){this._fallbackOnly=!!t.fallbackOnly}n.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},n.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},n.prototype.fallbackOnly=function(){return this._fallbackOnly},e.exports=n},{}],57:[function(t,e,i){"use strict";var r=t("../util/cmp");e.exports={makeLevelList:function(t,e){for(var i=[],n=0;n<t.length;n++)i.push(new e(t[n]));return i.sort(function(t,e){return r(t.width(),e.width())}),i},makeSelectableLevelList:function(t){for(var e=[],i=0;i<t.length;i++)t[i]._fallbackOnly||e.push(t[i]);if(!e.length)throw new Error("No selectable levels in list");return e}}},{"../util/cmp":90}],58:[function(t,e,i){e.exports={WebGlStage:t("./stages/WebGl"),CssStage:t("./stages/Css"),FlashStage:t("./stages/Flash"),WebGlCubeRenderer:t("./renderers/WebGlCube"),WebGlFlatRenderer:t("./renderers/WebGlFlat"),WebGlEquirectRenderer:t("./renderers/WebGlEquirect"),CssCubeRenderer:t("./renderers/CssCube"),CssFlatRenderer:t("./renderers/CssFlat"),FlashCubeRenderer:t("./renderers/FlashCube"),FlashFlatRenderer:t("./renderers/FlashFlat"),registerDefaultRenderers:t("./renderers/registerDefaultRenderers"),CubeGeometry:t("./geometries/Cube"),FlatGeometry:t("./geometries/Flat"),EquirectGeometry:t("./geometries/Equirect"),RectilinearView:t("./views/Rectilinear"),FlatView:t("./views/Flat"),ImageUrlSource:t("./sources/ImageUrl"),SingleAssetSource:t("./sources/SingleAsset"),DynamicCanvasAsset:t("./assets/DynamicCanvas"),StaticCanvasAsset:t("./assets/StaticCanvas"),TextureStore:t("./TextureStore"),Layer:t("./Layer"),RenderLoop:t("./RenderLoop"),KeyControlMethod:t("./controls/Key"),DragControlMethod:t("./controls/Drag"),QtvrControlMethod:t("./controls/Qtvr"),ScrollZoomControlMethod:t("./controls/ScrollZoom"),PinchZoomControlMethod:t("./controls/PinchZoom"),VelocityControlMethod:t("./controls/Velocity"),ElementPressControlMethod:t("./controls/ElementPress"),Controls:t("./controls/Controls"),Dynamics:t("./controls/Dynamics"),Viewer:t("./Viewer"),Scene:t("./Scene"),Hotspot:t("./Hotspot"),HotspotContainer:t("./HotspotContainer"),colorEffects:t("./colorEffects"),registerDefaultControls:t("./controls/registerDefaultControls"),autorotate:t("./autorotate"),util:{async:t("./util/async"),cancelize:t("./util/cancelize"),chain:t("./util/chain"),clamp:t("./util/clamp"),clock:t("./util/clock"),cmp:t("./util/cmp"),compose:t("./util/compose"),convertFov:t("./util/convertFov"),decimal:t("./util/decimal"),defaults:t("./util/defaults"),defer:t("./util/defer"),degToRad:t("./util/degToRad"),delay:t("./util/delay"),dom:t("./util/dom"),extend:t("./util/extend"),hash:t("./util/hash"),inherits:t("./util/inherits"),mod:t("./util/mod"),noop:t("./util/noop"),once:t("./util/once"),pixelRatio:t("./util/pixelRatio"),radToDeg:t("./util/radToDeg"),real:t("./util/real"),retry:t("./util/retry"),tween:t("./util/tween"),type:t("./util/type")},dependencies:{bowser:t("bowser"),glMatrix:t("gl-matrix"),eventEmitter:t("minimal-event-emitter"),hammerjs:t("hammerjs")}}},{"./Hotspot":16,"./HotspotContainer":17,"./Layer":18,"./RenderLoop":20,"./Scene":21,"./TextureStore":22,"./Viewer":24,"./assets/DynamicCanvas":25,"./assets/StaticCanvas":27,"./autorotate":29,"./colorEffects":37,"./controls/Controls":39,"./controls/Drag":40,"./controls/Dynamics":42,"./controls/ElementPress":43,"./controls/Key":45,"./controls/PinchZoom":46,"./controls/Qtvr":47,"./controls/ScrollZoom":48,"./controls/Velocity":49,"./controls/registerDefaultControls":51,"./geometries/Cube":53,"./geometries/Equirect":54,"./geometries/Flat":55,"./renderers/CssCube":61,"./renderers/CssFlat":62,"./renderers/FlashCube":64,"./renderers/FlashFlat":65,"./renderers/WebGlCube":68,"./renderers/WebGlEquirect":69,"./renderers/WebGlFlat":70,"./renderers/registerDefaultRenderers":71,"./sources/ImageUrl":72,"./sources/SingleAsset":73,"./stages/Css":74,"./stages/Flash":75,"./stages/WebGl":78,"./util/async":85,"./util/cancelize":86,"./util/chain":87,"./util/clamp":88,"./util/clock":89,"./util/cmp":90,"./util/compose":91,"./util/convertFov":92,"./util/decimal":93,"./util/defaults":94,"./util/defer":95,"./util/degToRad":96,"./util/delay":97,"./util/dom":98,"./util/extend":99,"./util/hash":100,"./util/inherits":101,"./util/mod":103,"./util/noop":104,"./util/once":105,"./util/pixelRatio":106,"./util/radToDeg":107,"./util/real":108,"./util/retry":109,"./util/tween":111,"./util/type":112,"./views/Flat":113,"./views/Rectilinear":114,bowser:1,"gl-matrix":2,hammerjs:13,"minimal-event-emitter":14}],59:[function(t,e,i){"use strict";var r=t("./support/Css"),o=t("./util/dom").setTransform,s=t("./util/dom").setPixelPosition,a=t("./util/decimal");e.exports=function(t,e,i){if(r()){var n="translateX("+a(e)+"px) translateY("+a(i)+"px) translateZ(0)";o(t,n)}else s(t,e,i)}},{"./support/Css":81,"./util/decimal":93,"./util/dom":98}],60:[function(t,e,i){"use strict";function m(t,e){return t.cmp(e)}function n(t,e,i){this._root=t,this._browserQuirks=e;var n=document.createElement("div");t.appendChild(n),n.style.position="absolute",o(n),s(n),this._browserQuirks.useNullTransform&&a(n),this.domElement=n,this._oldTileList=[],this._newTileList=[],this._textureMap=new r(i.equals,i.hash)}var r=t("../collections/Map"),o=t("../util/dom").setOverflowHidden,s=t("../util/dom").setNoPointerEvents,a=t("../util/dom").setNullTransform,v=t("../util/dom").setTransform,_="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.css;n.prototype.destroy=function(){this._root.removeChild(this.domElement),this._textureMap=null,this.domElement=null},n.prototype.startLayer=function(t,e){var i=this.domElement;i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.width=e.width+"px",i.style.height=e.height+"px";var n=1,r=t.effects();r&&null!=r.opacity&&(n=r.opacity),i.style.opacity=n,this._newTileList.length=0,this._textureMap.clear()},n.prototype.renderTile=function(t,e){this._newTileList.push(t),this._textureMap.set(t,e)},n.prototype.endLayer=function(t){var e,i,n,r,o,s,a,l,h=this.domElement,u=this._oldTileList,c=this._newTileList,p=this._textureMap,d=t.view();if(h.children.length!==u.length)throw new Error("DOM not in sync with tile list");for(c.sort(m),n=u[e=0],a=h.firstChild,i=0;i<c.length;i++){for(r=c[i];e<u.length&&!(0<=n.cmp(r));)l=a.nextSibling,h.removeChild(a),a=l,n=u[++e];if(!(s=(o=p.get(r))?o._canvas:null))throw new Error("Rendering tile with missing texture");if(n&&0===n.cmp(r)){if(s!=a)throw new Error("DOM not in sync with tile list");a=a.nextSibling,n=u[++e]}else h.insertBefore(s,a);v(s,this.calculateTransform(r,o,d)),_&&s.setAttribute("data-tile",r.str())}for(;a;)l=a.nextSibling,h.removeChild(a),a=l;if(h.children.length!==c.length)throw new Error("DOM not in sync with tile list");var f=this._oldTileList;this._oldTileList=this._newTileList,this._newTileList=f},e.exports=n},{"../collections/Map":33,"../util/dom":98}],61:[function(t,e,i){"use strict";function n(t,e){this.constructor.super_.call(this,t,e,r)}var r=t("../geometries/Cube").TileClass,o=t("./CssBase"),I=t("../util/decimal");t("../util/inherits")(n,o),n.prototype.calculateTransform=function(t,e,i){var n=this._browserQuirks.padSize,r=this._browserQuirks.reverseLevelDepth,o=this._browserQuirks.perspectiveNudge,s="",a=r?256-t.z:t.levelWidth(),l=i.size(),h=l.width,u=l.height;s+="translate3d("+I(h/2)+"px, "+I(u/2)+"px, 0px) ";var c=.5*u/Math.tan(i.fov()/2),p=c+o;s+="perspective("+I(c)+"px) translateZ("+I(p)+"px) ";var d=-i.roll(),f=-i.pitch(),m=i.yaw();s+="rotateZ("+I(d)+"rad) rotateX("+I(f)+"rad) rotateY("+I(m)+"rad) ";var v=-t.rotX(),_=t.rotY();s+="rotateX("+I(v)+"rad) rotateY("+I(_)+"rad) ";var y=t.centerX()-t.scaleX()/2,g=-(t.centerY()+t.scaleY()/2)*a,x=-a/2;if(s+="translate3d("+I(y*a)+"px, "+I(g)+"px, "+I(x)+"px) ",r){var w=a*t.scaleX()/t.width(),M=a*t.scaleY()/t.height();s+="scale("+I(w)+", "+I(M)+") "}var b=t.padLeft()?n:0,S=t.padTop()?n:0;return 0===b&&0===S||(s+="translate3d("+I(-b)+"px, "+I(-S)+"px, 0) "),s},e.exports=n},{"../geometries/Cube":53,"../util/decimal":93,"../util/inherits":101,"./CssBase":60}],62:[function(t,e,i){"use strict";function n(t,e){this.constructor.super_.call(this,t,e,r)}var r=t("../geometries/Flat").TileClass,o=t("./CssBase"),_=t("../util/decimal");t("../util/inherits")(n,o),n.prototype.calculateTransform=function(t,e,i){var n=this._browserQuirks.padSize,r="",o=i.width(),s=i.height();r+="translateX("+_(o/2)+"px) translateY("+_(s/2)+"px) ";var a=o/i._zoomX(),l=s/i._zoomY(),h=t.centerX()-t.scaleX()/2+.5,u=(.5-t.centerY()-t.scaleY()/2)*l;r+="translateX("+_(h*a)+"px) translateY("+_(u)+"px) ";var c=-i.x()*a,p=-i.y()*l;r+="translateX("+_(c)+"px) translateY("+_(p)+"px) ";var d=t.padLeft()?n:0,f=t.padTop()?n:0;0===d&&0===f||(r+="translateX("+_(-d)+"px) translateY("+_(-f)+"px) ");var m=a/t.levelWidth(),v=l/t.levelHeight();return r+("scale("+_(m)+", "+_(v))+") "},e.exports=n},{"../geometries/Flat":55,"../util/decimal":93,"../util/inherits":101,"./CssBase":60}],63:[function(t,e,i){"use strict";function n(t,e){return t.cmp(e)}function r(t,e,i,n){this._flashElement=t,this._layerId=e,this._quirks=i,this._tileList=[],this._textureMap=new o(n.equals,n.hash),this._layerCreated=!1}var o=t("../collections/Map");r.prototype.destroy=function(){this._flashElement.destroyLayer(this._layerId),this._flashElement=null,this._layerId=null,this._layerCreated=null,this._tileList=null,this._padSize=null},r.prototype.startLayer=function(t,e){this._flashElement.isReady&&this._flashElement.isReady()&&(this._layerCreated||(this._flashElement.createLayer(this._layerId),this._layerCreated=!0),this._tileList.length=0,this._textureMap.clear())},r.prototype.renderTile=function(t,e){this._tileList.push(t),this._textureMap.set(t,e)},r.prototype.endLayer=function(t,e){this._flashElement.isReady&&this._flashElement.isReady()&&(this._tileList.sort(n),this._renderOnFlash(t,e))},e.exports=r},{"../collections/Map":33}],64:[function(t,e,i){"use strict";function n(t,e,i){this.constructor.super_.call(this,t,e,i,o),this._flashTileList=[]}var r=t("./FlashBase"),o=t("../geometries/Cube").TileClass,s=t("../util/inherits"),M=t("../util/radToDeg");s(n,r),n.prototype._renderOnFlash=function(t,e){for(var i=this._flashElement,n=this._layerId,r=this._quirks.padSize,o=this._tileList,s=this._textureMap,a=this._flashTileList,l=a.length=0;l<o.length;l++){var h=o[l],u=s.get(h);if(!u)throw new Error("Rendering tile with missing texture");var c=h.padTop()?r:0,p=h.padBottom()?r:0,d=h.padLeft()?r:0,f=h.padRight()?r:0;a.push({textureId:u._textureId,face:h.face,width:h.width(),height:h.height(),centerX:h.centerX(),centerY:h.centerY(),rotX:M(h.rotX()),rotY:M(h.rotY()),levelSize:h.levelWidth(),padTop:c,padBottom:p,padLeft:d,padRight:f})}var m=1,v=t.effects();v&&null!=v.opacity&&(m=v.opacity);var _=t.view(),y=_.yaw(),g=_.pitch(),x=_.roll(),w=_.fov();i.drawCubeTiles(n,e.width,e.height,e.left,e.top,m,y,g,x,w,a)},e.exports=n},{"../geometries/Cube":53,"../util/inherits":101,"../util/radToDeg":107,"./FlashBase":63}],65:[function(t,e,i){"use strict";function n(t,e,i){this.constructor.super_.call(this,t,e,i,o),this._flashTileList=[]}var r=t("./FlashBase"),o=t("../geometries/Flat").TileClass;t("../util/inherits")(n,r),n.prototype._renderOnFlash=function(t,e){for(var i=this._flashElement,n=this._layerId,r=this._quirks.padSize,o=this._tileList,s=this._textureMap,a=this._flashTileList,l=a.length=0;l<o.length;l++){var h=o[l],u=s.get(h);if(!u)throw new Error("Rendering tile with missing texture");var c=h.padTop()?r:0,p=h.padBottom()?r:0,d=h.padLeft()?r:0,f=h.padRight()?r:0;a.push({textureId:u._textureId,width:h.width(),height:h.height(),centerX:h.centerX(),centerY:h.centerY(),scaleX:h.scaleX(),scaleY:h.scaleY(),levelWidth:h.levelWidth(),levelHeight:h.levelHeight(),padTop:c,padBottom:p,padLeft:d,padRight:f})}var m=1,v=t.effects();v&&null!=v.opacity&&(m=v.opacity);var _=t.view(),y=_.x(),g=_.y(),x=_._zoomX(),w=_._zoomY();i.drawFlatTiles(n,e.width,e.height,e.left,e.top,m,y,g,x,w,a)},e.exports=n},{"../geometries/Flat":55,"../util/inherits":101,"./FlashBase":63}],66:[function(t,e,i){"use strict";function n(t){this.gl=t,this.projMatrix=w.create(),this.viewportMatrix=w.create(),this.translateVector=M.create(),this.scaleVector=M.create(),this.constantBuffers=o(t,v,_,y),this.shaderProgram=a(t,f,m,g,x)}var r=t("./WebGlCommon"),o=r.createConstantBuffers,s=r.destroyConstantBuffers,a=r.createShaderProgram,l=r.destroyShaderProgram,h=r.setViewport,u=r.setupPixelEffectUniforms,c=r.setDepth,p=r.setTexture,d=t("glslify"),f=d(['#define GLSLIFY 1\n/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform float uDepth;\nuniform mat4 uViewportMatrix;\nuniform mat4 uProjMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);\n  gl_Position.z = uDepth * gl_Position.w;\n  vTextureCoord = aTextureCoord;\n}\n']),m=d(['/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform sampler2D uSampler;\nuniform float uOpacity;\nuniform vec4 uColorOffset;\nuniform mat4 uColorMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;\n  gl_FragColor = vec4(color.rgba * uOpacity);\n}\n']),v=[0,1,2,0,2,3],_=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],y=[0,0,1,0,1,1,0,1],g=["aVertexPosition","aTextureCoord"],x=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"],w=t("gl-matrix/src/gl-matrix/mat4"),M=t("gl-matrix/src/gl-matrix/vec3");n.prototype.destroy=function(){s(this.gl,this.constantBuffers),this.constantBuffers=null,l(this.gl,this.shaderProgram),this.shaderProgram=null,this.projMatrix=null,this.viewportMatrix=null,this.translateVector=null,this.scaleVector=null,this.gl=null},n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,o=this.viewportMatrix;i.useProgram(n),h(i,t,e,o),i.uniformMatrix4fv(n.uViewportMatrix,!1,o),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),u(i,t.effects(),{opacity:n.uOpacity,colorOffset:n.uColorOffset,colorMatrix:n.uColorMatrix})},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,o=this.shaderProgram,s=this.constantBuffers,a=this.projMatrix,l=this.translateVector,h=this.scaleVector;l[0]=t.centerX(),l[1]=t.centerY(),l[2]=-.5,h[0]=t.scaleX(),h[1]=t.scaleY(),h[2]=1,w.copy(a,i.view().projection()),w.rotateX(a,a,t.rotX()),w.rotateY(a,a,t.rotY()),w.translate(a,a,l),w.scale(a,a,h),r.uniformMatrix4fv(o.uProjMatrix,!1,a),c(r,o,n,t.z),p(r,o,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.vertexIndices),r.drawElements(r.TRIANGLES,v.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"./WebGlCommon":67,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec3":10,glslify:12}],67:[function(t,e,i){"use strict";function p(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.getShaderInfoLog(n);return n}function r(t,e,i,n){var r=t.createBuffer();return t.bindBuffer(e,r),t.bufferData(e,n,i),r}var o=t("../util/pixelRatio"),y=t("../util/clamp"),n=t("gl-matrix/src/gl-matrix/vec4"),s=t("gl-matrix/src/gl-matrix/vec3"),g=t("gl-matrix/src/gl-matrix/mat4"),a=n.create(),l=g.create();g.identity(l);var h={},x=s.create(),w=s.create();e.exports={createShaderProgram:function(t,e,i,n,r){var o=p(t,t.VERTEX_SHADER,e),s=p(t,t.FRAGMENT_SHADER,i),a=t.createProgram();if(t.attachShader(a,o),t.attachShader(a,s),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw t.getProgramInfoLog(a);for(var l=0;l<n.length;l++){var h=n[l];if(a[h]=t.getAttribLocation(a,h),-1===a[h])throw new Error("Shader program has no "+h+" attribute");t.enableVertexAttribArray(a[h])}for(var u=0;u<r.length;u++){var c=r[u];if(a[c]=t.getUniformLocation(a,c),-1===a[c])throw new Error("Shader program has no "+c+" uniform")}return a},destroyShaderProgram:function(t,e){for(var i=t.getAttachedShaders(e),n=0;n<i.length;n++){var r=i[n];t.detachShader(e,r),t.deleteShader(r)}t.deleteProgram(e)},createConstantBuffers:function(t,e,i,n){return{vertexIndices:r(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW,new Uint16Array(e)),vertexPositions:r(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(i)),textureCoords:r(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(n))}},destroyConstantBuffers:function(t,e){t.deleteBuffer(e.vertexIndices),t.deleteBuffer(e.vertexPositions),t.deleteBuffer(e.textureCoords)},setTexture:function(t,e,i){t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i._texture),t.uniform1i(e.uSampler,0)},setDepth:function(t,e,i,n){var r=(256*(i+1)-n)/65536;t.uniform1f(e.uDepth,r)},setViewport:function(t,e,i,n){var r=o();(function(t,e,i){var n=t.left,r=t.totalWidth,o=y(n,0,r),s=t.width-(o-n),a=y(s,0,r-o);e.offsetX=o,e.width=a;var l=t.totalHeight-t.bottom,h=t.totalHeight,u=y(l,0,h),c=t.height-(u-l),p=y(c,0,h-u);e.offsetY=u,e.height=p,w[0]=t.width/a,w[1]=t.height/p,w[2]=1;var d=o-n,f=n+t.width-(o+a),m=u-l,v=l+t.height-(u+p);x[0]=(f-d)/a,x[1]=(v-m)/p,x[2]=0;var _=i;g.identity(_),g.translate(_,_,x),g.scale(_,_,w)})(i,h,n),t.viewport(r*h.offsetX,r*h.offsetY,r*h.width,r*h.height)},setupPixelEffectUniforms:function(t,e,i){var n=1;e&&null!=e.opacity&&(n=e.opacity),t.uniform1f(i.opacity,n);var r=a;e&&e.colorOffset&&(r=e.colorOffset),t.uniform4fv(i.colorOffset,r);var o=l;e&&e.colorMatrix&&(o=e.colorMatrix),t.uniformMatrix4fv(i.colorMatrix,!1,o)}}},{"../util/clamp":88,"../util/pixelRatio":106,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec3":10,"gl-matrix/src/gl-matrix/vec4":11}],68:[function(t,e,i){"use strict";function n(){this.constructor.super_.apply(this,arguments)}var r=t("./WebGlBase");t("../util/inherits")(n,r),e.exports=n},{"../util/inherits":101,"./WebGlBase":66}],69:[function(t,e,i){"use strict";function n(t){this.gl=t,this.invProjMatrix=w.create(),this.viewportMatrix=w.create(),this.constantBuffers=o(t,v,_,y),this.shaderProgram=s(t,f,m,g,x)}var r=t("./WebGlCommon"),o=r.createConstantBuffers,s=r.createShaderProgram,p=r.setViewport,a=r.destroyConstantBuffers,l=r.destroyShaderProgram,d=r.setupPixelEffectUniforms,h=r.setDepth,u=r.setTexture,c=t("glslify"),f=c(['#define GLSLIFY 1\n/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nattribute vec3 aVertexPosition;\n\nuniform float uDepth;\nuniform mat4 uViewportMatrix;\nuniform mat4 uInvProjMatrix;\n\nvarying vec4 vRay;\n\nvoid main(void) {\n  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);\n  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);\n}\n']),m=c(['/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform sampler2D uSampler;\nuniform float uOpacity;\nuniform float uTextureX;\nuniform float uTextureY;\nuniform float uTextureWidth;\nuniform float uTextureHeight;\nuniform vec4 uColorOffset;\nuniform mat4 uColorMatrix;\n\nvarying vec4 vRay;\n\nconst float PI = 3.14159265358979323846264;\n\nvoid main(void) {\n  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);\n  float phi  = acos(vRay.y * r);\n  float theta = atan(vRay.x, -1.0*vRay.z);\n  float s = 0.5 + 0.5 * theta / PI;\n  float t = 1.0 - phi / PI;\n\n  s = s * uTextureWidth + uTextureX;\n  t = t * uTextureHeight + uTextureY;\n\n  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;\n  gl_FragColor = vec4(color.rgba * uOpacity);\n}\n']),v=[0,1,2,0,2,3],_=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],y=[0,0,1,0,1,1,0,1],g=["aVertexPosition"],x=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"],w=t("gl-matrix/src/gl-matrix/mat4");n.prototype.destroy=function(){a(this.gl,this.constantBuffers),this.constantBuffers=null,l(this.gl,this.shaderProgram),this.shaderProgram=null,this.invProjMatrix=null,this.viewportMatrix=null,this.gl=null},n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,o=this.invProjMatrix,s=this.viewportMatrix;i.useProgram(n),p(i,t,e,s),i.uniformMatrix4fv(n.uViewportMatrix,!1,s),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),w.copy(o,t.view().projection()),w.invert(o,o),i.uniformMatrix4fv(n.uInvProjMatrix,!1,o);var a=t.effects().textureCrop||{},l=null!=a.x?a.x:0,h=null!=a.y?a.y:0,u=null!=a.width?a.width:1,c=null!=a.height?a.height:1;i.uniform1f(n.uTextureX,l),i.uniform1f(n.uTextureY,h),i.uniform1f(n.uTextureWidth,u),i.uniform1f(n.uTextureHeight,c),d(i,t.effects(),{opacity:n.uOpacity,colorOffset:n.uColorOffset,colorMatrix:n.uColorMatrix})},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,o=this.shaderProgram,s=this.constantBuffers;h(r,o,n,t.z),u(r,o,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.vertexIndices),r.drawElements(r.TRIANGLES,v.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"./WebGlCommon":67,"gl-matrix/src/gl-matrix/mat4":7,glslify:12}],70:[function(t,e,i){"use strict";function n(){this.constructor.super_.apply(this,arguments)}var r=t("./WebGlBase");t("../util/inherits")(n,r),e.exports=n},{"../util/inherits":101,"./WebGlBase":66}],71:[function(t,e,i){"use strict";var n=t("./WebGlCube"),r=t("./WebGlFlat"),o=t("./WebGlEquirect"),s=t("./CssCube"),a=t("./CssFlat"),l=t("./FlashCube"),h=t("./FlashFlat");e.exports=function(t){switch(t.type){case"webgl":t.registerRenderer("flat","flat",r),t.registerRenderer("cube","rectilinear",n),t.registerRenderer("equirect","rectilinear",o);break;case"css":t.registerRenderer("flat","flat",a),t.registerRenderer("cube","rectilinear",s);break;case"flash":t.registerRenderer("flat","flat",h),t.registerRenderer("cube","rectilinear",l);break;default:throw new Error("Unknown stage type: "+t.type)}}},{"./CssCube":61,"./CssFlat":62,"./FlashCube":64,"./FlashFlat":65,"./WebGlCube":68,"./WebGlEquirect":69,"./WebGlFlat":70}],72:[function(t,e,i){"use strict";function a(t,e){e=e||{},this._loadPool=new n({concurrency:e.concurrency||4}),this._retryDelay=e.retryDelay||1e4,this._retryMap={},this._sourceFromTile=t}function l(t){return new RegExp("\\{("+t+")\\}","g")}var f=t("../NetworkError"),n=t("../collections/WorkPool"),m=t("../util/chain"),v=t("../util/delay"),_=t("../util/clock"),h={x:"x",y:"y",z:"z",f:"face"};a.prototype.loadAsset=function(t,n,e){var i,r=this,o=this._retryDelay,s=this._retryMap,a=this._sourceFromTile(n),l=a.url,h=a.rect,u=t.loadImage.bind(t,l,h),c=s[l];if(null!=c){var p=_()-c;p<o?i=o-p:(i=0,delete s[l])}var d=v.bind(null,i);return m(d,function(i){return r._loadPool.push(u,function(t,e){t?(t instanceof f&&(s[l]=_()),i(t,n)):(delete s[l],i(null,n,e))})})(e)},a.fromString=function(s,n){function r(t){var e=s;for(var i in h){var n=h[i],r=l(i),o=t.hasOwnProperty(n)?t[n]:"";e=e.replace(r,o)}return{url:e}}var o=(n=n||{})&&n.cubeMapPreviewFaceOrder||"bdflru";return new a(n.cubeMapPreviewUrl?function(t){return 0===t.z?(e=t,i=o.indexOf(e.face)/6,{url:n.cubeMapPreviewUrl,rect:{x:0,y:i,width:1,height:1/6}}):r(t);var e,i}:r)},a.stringHasFace=function(t){return a.stringHasProperty(t,"f")},a.stringHasX=function(t){return a.stringHasProperty(t,"x")},a.stringHasY=function(t){return a.stringHasProperty(t,"y")},a.stringHasLevel=function(t){return a.stringHasProperty(t,"z")},a.stringHasProperty=function(t,e){return!!t.match(l(e))},e.exports=a},{"../NetworkError":19,"../collections/WorkPool":35,"../util/chain":87,"../util/clock":89,"../util/delay":97}],73:[function(t,e,i){"use strict";function n(t){this._asset=t}n.prototype.asset=function(){return this._asset},n.prototype.loadAsset=function(t,e,i){var n=this,r=setTimeout(function(){i(null,e,n._asset)},0);return function(){clearTimeout(r),i.apply(null,arguments)}},e.exports=n},{}],74:[function(t,e,i){"use strict";function n(t){this.constructor.super_.call(this,t),this._domElement=document.createElement("div"),u(this._domElement),c(this._domElement)}function r(t,e,i){var n=document.createElement("canvas");u(n),p(n),this._canvas=n,this._timestamp=null,this.refresh(e,i)}var o=t("./Stage"),s=t("../support/Css"),a=t("bowser"),l=t("../util/inherits"),h=t("./loadImageHtml"),u=t("../util/dom").setAbsolute,c=t("../util/dom").setFullSize,p=t("../util/dom").setNullTransformOrigin,f={padSize:a.ios?0:3,reverseLevelDepth:a.ios,useNullTransform:a.ios,perspectiveNudge:a.webkit||a.gecko?.001:0};l(n,o),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null},n.supported=function(){return s()},n.prototype._setSize=function(){},n.prototype.loadImage=h,n.prototype._validateLayer=function(t){},n.prototype.createRenderer=function(t){return new t(this._domElement,f)},n.prototype.destroyRenderer=function(t){t.destroy()},n.prototype.startFrame=function(){},n.prototype.endFrame=function(){},n.prototype.takeSnapshot=function(){throw new Error("CssStage: takeSnapshot not implemented")},n.type=n.prototype.type="css",r.prototype.refresh=function(t,e){var i=e.timestamp();if(i!==this._timestamp){this._timestamp=i;var n,r=this._canvas,o=r.getContext("2d"),s=e.element(),a=t.width(),l=t.height(),h=f.padSize,u=t.padTop()?h:0,c=t.padBottom()?h:0,p=t.padLeft()?h:0,d=t.padRight()?h:0;for(r.width=p+a+d,r.height=u+l+c,o.drawImage(s,p,u,a,l),n=0;n<u;n++)o.drawImage(r,p,u,a,1,p,n,a,1);for(n=0;n<p;n++)o.drawImage(r,p,u,1,l,n,u,1,l);for(n=0;n<c;n++)o.drawImage(r,p,u+l-1,a,1,p,u+l+n,a,1);for(n=0;n<d;n++)o.drawImage(r,p+a-1,u,1,l,p+a+n,u,1,l)}},r.prototype.destroy=function(){this._canvas=null,this._timestamp=null},n.TextureClass=n.prototype.TextureClass=r,e.exports=n},{"../support/Css":81,"../util/dom":98,"../util/inherits":101,"./Stage":77,"./loadImageHtml":80,bowser:1}],75:[function(t,e,i){"use strict";function n(t){if(this.constructor.super_.call(this,t),this._wmode=t&&t.wmode||"transparent",this._swfPath=t&&t.swfPath||f,!f)throw new Error("Missing SWF path");this._flashStageId=window[m].__next++,this._callbacksObj=window[m][this._flashStageId]={},this._stageCallbacksObjVarName=m+"["+this._flashStageId+"]",this._callbackListeners={};for(var e=0;e<v.length;e++)this._callbacksObj[v[e]]=this._callListeners(v[e]);this._loadImageQueue=new a,this._loadImageQueue.pause(),this._flashReady=!1,this._nextLayerId=0;var i=function(t,e,i){var n=document.createElement("div");u(n),c(n);var r="marzipano-flash-stage-"+e,o='<object id="'+r+'" name="'+r+'" type="application/x-shockwave-flash" data="'+t+'">',s="";s+='<param name="movie" value="'+t+'" />',s+='<param name="allowscriptaccess" value="always" />',s+='<param name="flashvars" value="callbacksObjName='+i+'" />',o+=s+='<param name="wmode" value="transparent" />',o+="</object>";var a=document.createElement("div");a.innerHTML=o;var l=a.firstChild;u(l),c(l),n.appendChild(l);var h=document.createElement("div");return u(h),c(h),p(h),n.appendChild(h),{root:n,flash:l,blocking:h}}(this._swfPath,this._flashStageId,this._stageCallbacksObjVarName);this._domElement=i.root,this._blockingElement=i.blocking,this._flashElement=i.flash,this._checkReadyTimer=setInterval(this._checkReady.bind(this),50)}function r(t,e,i){var n=i.element(),r=e.width(),o=e.height(),s=_.padSize,a=e.padTop()?s:0,l=e.padBottom()?s:0,h=e.padLeft()?s:0,u=e.padRight()?s:0,c=t._flashElement.createTexture(n,r,o,a,l,h,u);this._stage=t,this._textureId=c}var o=t("./Stage"),s=t("../support/Flash"),a=t("../collections/WorkQueue"),l=t("../util/inherits"),h=t("../util/defer"),u=t("../util/dom").setAbsolute,c=t("../util/dom").setFullSize,p=t("../util/dom").setBlocking,d=t("./loadImageFlash"),f=function(){var t=document.currentScript;if(!t){var e=document.getElementsByTagName("script");t=e.length?e[e.length-1]:null}if(!t)return null;var i=t.src,n=i.lastIndexOf("/");return(i=0<=n?i.slice(0,n+1):"")+"marzipano.swf"}(),m="MarzipanoFlashCallbackMap";m in window||(window[m]={__next:0});var v=["imageLoaded"],_={padSize:3};l(n,o),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null,this._blockingElement=null,this._flashElement=null,window[m][this._flashStageId]=null,this._callbacksObj=null,this._loadImageQueue=null,clearInterval(this._checkReadyTimer)},n.supported=function(){return s()},n.prototype._setSize=function(){},n.prototype.loadImage=function(t,e,i){var n=d.bind(null,this,t,e);return this._loadImageQueue.push(n,i)},n.prototype._validateLayer=function(t){},n.prototype._onCallback=function(t,e){this._callbackListeners[t]=this._callbackListeners[t]||[],this._callbackListeners[t].push(e)},n.prototype._offCallback=function(t,e){var i=this._callbackListeners[t]||[],n=i.indexOf(e);0<=n&&i.splice(n,1)},n.prototype._callListeners=function(i){var n=this;return function(){for(var t=n._callbackListeners[i]||[],e=0;e<t.length;e++)h(t[e],arguments)}},n.prototype._checkReady=function(){return!!(this._flashElement&&this._flashElement.isReady&&this._flashElement.isReady())&&(this._flashReady=!0,clearTimeout(this._checkReadyTimer),this._loadImageQueue.resume(),this.emitRenderInvalid(),!0)},n.prototype.createRenderer=function(t){return new t(this._flashElement,++this._nextLayerId,_)},n.prototype.destroyRenderer=function(t){t.destroy()},n.prototype.startFrame=function(){},n.prototype.endFrame=function(){},n.prototype.takeSnapshot=function(t){"object"==typeof t&&null!=t||(t={});var e=t.quality;if(void 0===e&&(e=75),"number"!=typeof e||e<0||100<e)throw new Error("FlashStage: Snapshot quality needs to be a number between 0 and 100");return this._flashElement.takeSnapshot(e)},n.type=n.prototype.type="flash",r.prototype.refresh=function(t,e){},r.prototype.destroy=function(){var t=this._textureId;this._stage._flashElement.destroyTexture(t),this._stage=null,this._textureId=null},n.TextureClass=n.prototype.TextureClass=r,e.exports=n},{"../collections/WorkQueue":36,"../support/Flash":82,"../util/defer":95,"../util/dom":98,"../util/inherits":101,"./Stage":77,"./loadImageFlash":79}],76:[function(t,e,i){"use strict";function n(){this._renderers={}}n.prototype.set=function(t,e,i){this._renderers[t]||(this._renderers[t]={}),this._renderers[t][e]=i},n.prototype.get=function(t,e){return this._renderers[t]&&this._renderers[t][e]||null},e.exports=n},{}],77:[function(t,e,i){"use strict";function f(t,e){return-t.cmp(e)}function n(t){this._domElement=null,this._layers=[],this._renderers=[],this._visibleTiles=[],this._fallbackTiles={children:[],parents:[]},this._tmpTiles=[],this._width=null,this._height=null,this._rect={},this._createTextureWorkQueue=new o({delay:20}),this.emitRenderInvalid=this.emitRenderInvalid.bind(this),this._rendererRegistry=new l}var r=t("minimal-event-emitter"),o=t("../collections/WorkQueue"),m=t("../calcRect"),s=t("../util/async"),a=t("../util/cancelize"),l=t("./RendererRegistry");r(n),n.prototype.destroy=function(){this.removeAllLayers(),this._layers=null,this._renderers=null,this._visibleTiles=null,this._fallbackTiles=null,this._tmpTiles=null,this._width=null,this._height=null,this._createTextureWorkQueue=null,this.emitRenderInvalid=null,this._rendererRegistry=null},n.prototype.registerRenderer=function(t,e,i){return this._rendererRegistry.set(t,e,i)},n.prototype.domElement=function(){return this._domElement},n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},n.prototype.setSize=function(t){this._width=t.width,this._height=t.height,this._setSize(),this.emit("resize"),this.emitRenderInvalid()},n.prototype.emitRenderInvalid=function(){this.emit("renderInvalid")},n.prototype.listLayers=function(){return[].concat(this._layers)},n.prototype.hasLayer=function(t){return 0<=this._layers.indexOf(t)},n.prototype.addLayer=function(t,e){if(0<=this._layers.indexOf(t))throw new Error("Layer already in stage");if(null==e&&(e=this._layers.length),e<0||e>this._layers.length)throw new Error("Invalid layer position");this._validateLayer(t),this._layers.splice(e,0,t),this._renderers.splice(e,0,null),t.addEventListener("viewChange",this.emitRenderInvalid),t.addEventListener("effectsChange",this.emitRenderInvalid),t.addEventListener("fixedLevelChange",this.emitRenderInvalid),t.addEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},n.prototype.moveLayer=function(t,e){var i=this._layers.indexOf(t);if(i<0)throw new Error("No such layer in stage");if(e<0||e>=this._layers.length)throw new Error("Invalid layer position");t=this._layers.splice(i,1)[0];var n=this._renderers.splice(i,1)[0];this._layers.splice(e,0,t),this._renderers.splice(e,0,n),this.emitRenderInvalid()},n.prototype.removeLayer=function(t){var e=this._layers.indexOf(t);if(e<0)throw new Error("No such layer in stage");var i=this._layers.splice(e,1)[0],n=this._renderers.splice(e,1)[0];n&&this.destroyRenderer(n),i.removeEventListener("viewChange",this.emitRenderInvalid),i.removeEventListener("effectsChange",this.emitRenderInvalid),i.removeEventListener("fixedLevelChange",this.emitRenderInvalid),i.removeEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},n.prototype.removeAllLayers=function(){for(;0<this._layers.length;)this.removeLayer(this._layers[0])},n.prototype.render=function(){var t,e=this._visibleTiles,i=this._fallbackTiles,n=this._width,r=this._height,o=this._rect;if(!(n<=0||r<=0)){for(this.startFrame(),t=0;t<this._layers.length;t++)this._layers[t].textureStore().startFrame();for(t=0;t<this._layers.length;t++){var s=this._layers[t],a=s.effects(),l=s.view(),h=this._updateRenderer(t),u=this._layers.length-t,c=s.textureStore();if(m(n,r,a&&a.rect,o),!(o.width<=0||o.height<=0)){l.setSize(o),e.length=0,s.visibleTiles(e),h.startLayer(s,o);var p=i.parents,d=i.children;d.length=0,p.length=0,this._renderTiles(e,c,h,s,u,!0),this._renderTiles(d,c,h,s,u,!1),p.sort(f),this._renderTiles(p,c,h,s,u,!1),h.endLayer(s,o)}}for(t=0;t<this._layers.length;t++)this._layers[t].textureStore().endFrame();this.endFrame()}},n.prototype._updateRenderer=function(t){var e=this._layers[t],i=this.type,n=e.geometry().type,r=e.view().type,o=this._rendererRegistry.get(n,r);if(!o)throw new Error("No "+i+" renderer avaiable for "+n+" geometry and "+r+" view");var s=this._renderers[t];return s?s instanceof o||(this._renderers[t]=this.createRenderer(o),this.destroyRenderer(s)):this._renderers[t]=this.createRenderer(o),this._renderers[t]},n.prototype._renderTiles=function(t,e,i,n,r,o){for(var s=0;s<t.length;s++){var a=t[s];e.markTile(a);var l=e.texture(a);l?i.renderTile(a,l,n,r,s):o&&this._fallback(a,e)}},n.prototype._fallback=function(t,e){return this._childrenFallback(t,e)||this._parentFallback(t,e)},n.prototype._parentFallback=function(t,e){for(var i=this._fallbackTiles.parents;null!=(t=t.parent());)if(t&&e.texture(t)){for(var n=0;n<i.length;n++)if(t.equals(i[n]))return!0;return i.push(t),!0}return!1},n.prototype._childrenFallback=function(t,e){var i=this._fallbackTiles.children,n=this._tmpTiles;if(n.length=0,!t.children(n))return!1;if(1===n.length&&!e.texture(n[0]))return this._childrenFallback(n[0],e,i);for(var r=!1,o=0;o<n.length;o++)e.texture(n[o])?i.push(n[o]):r=!0;return!r},n.prototype.createTexture=function(i,n,r){var t=this,e=a(s(function(){return new t.TextureClass(t,i,n)}));return this._createTextureWorkQueue.push(e,function(t,e){r(t,i,n,e)})},e.exports=n},{"../calcRect":30,"../collections/WorkQueue":36,"../util/async":85,"../util/cancelize":86,"./RendererRegistry":76,"minimal-event-emitter":14}],78:[function(t,e,i){"use strict";function n(t){t=t||{};var e=this;this.constructor.super_.call(this,t),this._generateMipmaps=null!=t.generateMipmaps&&t.generateMipmaps,this._domElement=document.createElement("canvas"),f(this._domElement),m(this._domElement),this._gl=function(t,e){var i={alpha:!0,premultipliedAlpha:!0,antialias:e&&e.antialias,preserveDrawingBuffer:e&&e.preserveDrawingBuffer};v&&"undefined"!=typeof WebGLDebugUtils&&(console.log("Using WebGL lost context simulator"),t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t));var n=t.getContext&&(t.getContext("webgl",i)||t.getContext("experimental-webgl",i));if(!n)throw new Error("Could not get WebGL context");return v&&"undefined"!=typeof WebGLDebugUtils&&(n=WebGLDebugUtils.makeDebugContext(n),console.log("Using WebGL debug context")),n}(this._domElement,t),this._handleContextLoss=function(){e.emit("webglcontextlost"),e._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=new l(function(t,e){return t===e},function(t){return p(t.toString())})}function r(t,e,i){this._stage=t,this._gl=t._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(e,i)}var o=t("./Stage"),s=t("../support/WebGl"),a=t("bowser"),l=t("../collections/Map"),h=t("./loadImageHtml"),u=t("../util/inherits"),c=(t("../util/defer"),t("../util/pixelRatio")),p=t("../util/hash"),d=t("../util/ispot"),f=t("../util/dom").setAbsolute,m=(t("../util/dom").setPixelSize,t("../util/dom").setFullSize),v="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.webGl,_=a.chrome;u(n,o),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this.removeEventListener("webglcontextlost",this._handleContextLoss),this._domElement=null,this._rendererInstances=null,this._gl=null},n.supported=function(){return s()},n.prototype.webGlContext=function(){return this._gl},n.prototype._setSize=function(){var t=c();this._domElement.width=t*this._width,this._domElement.height=t*this._height},n.prototype.loadImage=h,n.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},n.prototype._validateLayer=function(t){var e=t.geometry().maxTileSize(),i=this.maxTextureSize();if(i<e)throw new Error("Layer has level with tile size larger than maximum texture size ("+e+" vs. "+i+")")},n.prototype.createRenderer=function(t){if(this._rendererInstances.has(t))return this._rendererInstances.get(t);var e=new t(this._gl);return this._rendererInstances.set(t,e),e},n.prototype.destroyRenderer=function(t){this._renderers.indexOf(t)<0&&(t.destroy(),this._rendererInstances.del(t.constructor))},n.prototype.startFrame=function(){var t=this._gl;if(!t)throw new Error("Bad WebGL context - maybe context was lost?");var e=this._width,i=this._height,n=c();t.viewport(0,0,n*e,n*i),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},n.prototype.endFrame=function(){},n.prototype.takeSnapshot=function(t){"object"==typeof t&&null!=t||(t={});var e=t.quality;if(void 0===e&&(e=75),"number"!=typeof e||e<0||100<e)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",e/100)},n.type=n.prototype.type="webgl",r.prototype.refresh=function(t,e){var i,n=this._gl,r=this._stage,o=e.timestamp();if(o!==this._timestamp){var s=e.element(),a=e.width(),l=e.height();if(a!==this._width||l!==this._height){var h=r.maxTextureSize();if(h<a)throw new Error("Texture width larger than max size ("+a+" vs. "+h+")");if(h<l)throw new Error("Texture height larger than max size ("+l+" vs. "+h+")");this._texture&&n.deleteTexture(i),i=this._texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,s)}else i=this._texture,n.bindTexture(n.TEXTURE_2D,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s instanceof HTMLVideoElement&&_?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,s):n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,s);r._generateMipmaps&&d(a)&&d(l)?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.generateMipmap(n.TEXTURE_2D)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),this._timestamp=o,this._width=a,this._height=l}},r.prototype.destroy=function(){var t=this._texture,e=this._gl;t&&e.deleteTexture(t),this._stage=null,this._gl=null,this._texture=null,this._timestamp=null,this._width=this._height=null},n.TextureClass=n.prototype.TextureClass=r,e.exports=n},{"../collections/Map":33,"../support/WebGl":83,"../util/defer":95,"../util/dom":98,"../util/hash":100,"../util/inherits":101,"../util/ispot":102,"../util/pixelRatio":106,"./Stage":77,"./loadImageHtml":80,bowser:1}],79:[function(t,e,i){"use strict";var c=t("../NetworkError"),p=t("../util/once"),d=t("../assets/FlashImage");e.exports=function(i,n,t,r){function o(t,e){e===u&&(i._offCallback("imageLoaded",o),t?r(new c("Network error: "+n)):r(null,new d(s,u)))}var s=i._flashElement,e=t&&t.x||0,a=t&&t.y||0,l=t&&t.width||1,h=t&&t.height||1,u=s.loadImage(n,l,h,e,a);return r=p(r),i._onCallback("imageLoaded",o),function(){s.cancelImage(u),i._offCallback("imageLoaded",o),r.apply(null,arguments)}}},{"../NetworkError":19,"../assets/FlashImage":26,"../util/once":105}],80:[function(t,e,i){"use strict";var l=t("../NetworkError"),h=t("../util/once"),u=t("../assets/StaticImage"),c=t("../assets/StaticCanvas");e.exports=function(t,e,i){var n=new Image;n.crossOrigin="anonymous";var r=e&&e.x||0,o=e&&e.y||0,s=e&&e.width||1,a=e&&e.height||1;return i=h(i),n.onload=function(){if(0===r&&0===o&&1===s&&1===a)i(null,new u(n));else{r*=n.naturalWidth,o*=n.naturalHeight,s*=n.naturalWidth,a*=n.naturalHeight;var t=document.createElement("canvas");t.width=s,t.height=a,t.getContext("2d").drawImage(n,r,o,s,a,0,0,s,a),i(null,new c(t))}},n.onerror=function(){i(new l("Network error: "+t))},n.src=t,function(){n.onload=n.onerror=null,n.src="",i.apply(null,arguments)}}},{"../NetworkError":19,"../assets/StaticCanvas":27,"../assets/StaticImage":28,"../util/once":105}],81:[function(t,e,i){"use strict";var n,o=t("../util/dom").prefixProperty;e.exports=function(){return void 0!==n?n:n=function(){var t=o("perspective"),e=document.createElement("div"),i=void 0!==e.style[t];if(i&&"WebkitPerspective"===t){var n="__marzipano_test_css3d_support__",r=document.createElement("style");r.textContent="@media(-webkit-transform-3d){#"+n+"{height: 3px;})",document.getElementsByTagName("head")[0].appendChild(r),e.id=n,document.body.appendChild(e),i=0<e.offsetHeight,r.parentNode.removeChild(r),e.parentNode.removeChild(e)}return i}()}},{"../util/dom":98}],82:[function(t,e,i){"use strict";function n(){var t=function(){var t=null,e=navigator.plugins,i=navigator.mimeTypes,n=null;if(e&&e["Shockwave Flash"]&&i&&i["application/x-shockwave-flash"]&&i["application/x-shockwave-flash"].enabledPlugin)n=(n=e["Shockwave Flash"].description).replace(/^.*\s+(\S+\s+\S+$)/,"$1"),(t=[0,0,0])[0]=parseInt(n.replace(/^(.*)\..*$/,"$1"),10),t[1]=parseInt(n.replace(/^.*\.(.*)\s.*$/,"$1"),10),t[2]=/[a-zA-Z]/.test(n)?parseInt(n.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;else if(window.ActiveXObject)try{var r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");r&&(n=r.GetVariable("$version"))&&(n=n.split(" ")[1].split(","),t=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)])}catch(t){}return t}();return t&&(11<=t[0]||10===t[0]&&1<=t[1])}var r;e.exports=function(){return void 0!==r?r:r=n()}},{}],83:[function(t,e,i){"use strict";var n;e.exports=function(){return void 0!==n?n:(t=document.createElement("canvas"),n=!(!t.getContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl")));var t}},{}],84:[function(t,e,i){"use strict";var n,r=t("bowser");e.exports=function(){return void 0!==n?n:n=function(){var t=document.createElement("a").style;t.cssText="pointer-events:auto";var e="auto"===t.pointerEvents,i=r.msie&&parseFloat(r.version)<11;return e&&!i}()}},{bowser:1}],85:[function(t,e,i){"use strict";e.exports=function(n){return function(t){var e,i;try{i=n()}catch(t){e=t}finally{t(e||null,e?null:i)}}}},{}],86:[function(t,e,i){"use strict";var n=t("./once");e.exports=function(i){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var t=Array.prototype.slice.call(arguments,0),e=t[t.length-1]=n(t[t.length-1]);return i.apply(null,t),function(){e.apply(null,arguments)}}}},{"./once":105}],87:[function(t,e,i){"use strict";var n=t("./noop");e.exports=function(){var e=Array.prototype.slice.call(arguments,0);return function(){var r=e.slice(0),o=null,s=null,t=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],a=arguments.length?arguments[arguments.length-1]:n;return t.unshift(null),function t(){if(arguments[0])return o=s=null,void a.apply(null,arguments);if(!r.length)return o=s=null,void a.apply(null,arguments);var e=o=r.shift(),i=Array.prototype.slice.call(arguments,1);i.push(t);var n=o.apply(null,i);if(e===o){if("function"!=typeof n)throw new Error("chain: chaining on non-cancellable function");s=n}}.apply(null,t),function(){s&&s.apply(null,arguments)}}}},{"./noop":104}],88:[function(t,e,i){"use strict";e.exports=function(t,e,i){return Math.min(Math.max(t,e),i)}},{}],89:[function(t,e,i){"use strict";var n=(window.performance&&window.performance.now?function(){return window.performance.now()}:null)||function(){return Date.now()};e.exports=n},{}],90:[function(t,e,i){"use strict";e.exports=function(t,e){return t<e?-1:e<t?1:0}},{}],91:[function(t,e,i){"use strict";e.exports=function(){var n=arguments;return function(t){for(var e=t,i=0;i<n.length;i++)e=n[i].call(null,e);return e}}},{}],92:[function(t,e,i){"use strict";function n(t,e,i){return 2*Math.atan(i*Math.tan(t/2)/e)}e.exports={convert:n,htov:function(t,e,i){return n(t,e,i)},htod:function(t,e,i){return n(t,e,Math.sqrt(e*e+i*i))},vtoh:function(t,e,i){return n(t,i,e)},vtod:function(t,e,i){return n(t,i,Math.sqrt(e*e+i*i))},dtoh:function(t,e,i){return n(t,Math.sqrt(e*e+i*i),e)},dtov:function(t,e,i){return n(t,Math.sqrt(e*e+i*i),i)}}},{}],93:[function(t,e,i){"use strict";e.exports=function(t){return t.toPrecision(15)}},{}],94:[function(t,e,i){"use strict";e.exports=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t}},{}],95:[function(t,e,i){"use strict";e.exports=function(t,e){setTimeout(function(){e&&0<e.length?t.apply(null,e):t()},0)}},{}],96:[function(t,e,i){"use strict";e.exports=function(t){return t*Math.PI/180}},{}],97:[function(t,e,i){"use strict";e.exports=function(t,e){var i=null;return i=setTimeout(function(){null!=i&&e(i=null)},t),function(){null!=i&&(clearTimeout(i),i=null,e.apply(null,arguments))}}},{}],98:[function(t,e,i){"use strict";function n(t){for(var e=document.documentElement.style,i=["Moz","Webkit","Khtml","O","ms"],n=0;n<i.length;n++){var r=i[n]+(t[0].toUpperCase()+t.slice(1));if(r in e)return r}return t}function r(t){var i=n(t);return function(t,e){return t.style[i]=e}}var o=r("transform"),s=r("transformOrigin");e.exports={prefixProperty:n,getWithVendorPrefix:function(t){var e=n(t);return function(t){return t.style[e]}},setWithVendorPrefix:r,setTransform:o,setTransformOrigin:s,setNullTransform:function(t){o(t,"translateZ(0)")},setNullTransformOrigin:function(t){s(t,"0 0 0")},setAbsolute:function(t){t.style.position="absolute"},setPixelPosition:function(t,e,i){t.style.left=e+"px",t.style.top=i+"px"},setPixelSize:function(t,e,i){t.style.width=e+"px",t.style.height=i+"px"},setNullSize:function(t){t.style.width=t.style.height=0},setFullSize:function(t){t.style.width=t.style.height="100%"},setOverflowHidden:function(t){t.style.overflow="hidden"},setOverflowVisible:function(t){t.style.overflow="visible"},setNoPointerEvents:function(t){t.style.pointerEvents="none"},setBlocking:function(t){t.style.backgroundColor="#000",t.style.opacity="0",t.style.filter="alpha(opacity=0)"}}},{}],99:[function(t,e,i){"use strict";e.exports=function(t,e){for(var i in e)t[i]=e[i];return t}},{}],100:[function(t,e,i){"use strict";e.exports=function(){for(var t=0,e=0;e<arguments.length;e++){var i=arguments[e];t+=i,t+=i<<10,t^=i>>6}return t+=t<<3,t^=t>>11,0<=(t+=t<<15)?t:-t}},{}],101:[function(t,e,i){"use strict";e.exports=function(t,e){function i(){}t.super_=e,i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],102:[function(t,e,i){"use strict";e.exports=function(t){return 0==(t&t-1)}},{}],103:[function(t,e,i){"use strict";e.exports=function(t,e){return(+t%(e=+e)+e)%e}},{}],104:[function(t,e,i){"use strict";e.exports=function(){}},{}],105:[function(t,e,i){"use strict";e.exports=function(t){var e,i=!1;return function(){return i||(i=!0,e=t.apply(null,arguments)),e}}},{}],106:[function(t,e,i){"use strict";e.exports=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t&&t.deviceXDPI&&t.logicalXDPI)return t.deviceXDPI/t.logicalXDPI;if(t&&t.systemXDPI&&t.logicalXDPI)return t.systemXDPI/t.logicalXDPI}return 1}},{}],107:[function(t,e,i){"use strict";e.exports=function(t){return 180*t/Math.PI}},{}],108:[function(t,e,i){"use strict";e.exports=function(t){return"number"==typeof t&&isFinite(t)}},{}],109:[function(t,e,i){"use strict";var s=t("./noop");e.exports=function(o){return function(){function t(){!arguments[0]||r?i.apply(null,arguments):n=o.apply(null,e)}var e=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],i=arguments.length?arguments[arguments.length-1]:s,n=null,r=!1;return e.push(t),t(!0),function(){r=!0,n.apply(null,arguments)}}}},{"./noop":104}],110:[function(t,e,i){"use strict";var o=t("gl-matrix/src/gl-matrix/vec3"),s=t("gl-matrix/src/gl-matrix/mat4"),a=s.identity(s.create()),l=s.create();e.exports=function(t,e,i,n,r){return s.copy(l,a),i&&s.rotateY(l,l,i),n&&s.rotateX(l,l,n),r&&s.rotateZ(l,l,r),o.transformMat4(t,e,l),t}},{"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec3":10}],111:[function(t,e,i){"use strict";var a=t("./clock");e.exports=function(i,n,r){var o=!1,s=a();return n(0),requestAnimationFrame(function t(){if(!o){var e=(a()-s)/i;e<1?(n(e),requestAnimationFrame(t)):(n(1),r())}}),function(){o=!0,r.apply(null,arguments)}}},{"./clock":89}],112:[function(t,e,i){"use strict";e.exports=function(t){var e=typeof t;if("object"==e){if(null===t)return"null";if("[object Array]"===Object.prototype.toString.call(t))return"array";if("[object RegExp]"===Object.prototype.toString.call(t))return"regexp"}return e}},{}],113:[function(t,e,i){"use strict";function n(t,e){if(!t||null==t.mediaAspectRatio)throw new Error("mediaAspectRatio must be defined");this._x=t&&null!=t.x?t.x:.5,this._y=t&&null!=t.y?t.y:.5,this._zoom=t&&null!=t.zoom?t.zoom:1,this._mediaAspectRatio=t.mediaAspectRatio,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._limiter=e||null,this._viewFrustum=[0,0,0,0],this._projectionMatrix=u.create(),this._projectionChanged=!0,this._params={},this._vertex=l.create(),this._invProj=u.create(),this._update()}var r=t("minimal-event-emitter"),o=t("../util/pixelRatio"),d=t("../util/real"),f=t("../util/clamp"),u=t("gl-matrix/src/gl-matrix/mat4"),l=t("gl-matrix/src/gl-matrix/vec4"),h=[1,0,1,0],c=[-1,-1,1,1];r(n),n.prototype.destroy=function(){this._x=null,this._y=null,this._zoom=null,this._mediaAspectRatio=null,this._width=null,this._height=null,this._limiter=null,this._viewFrustum=null,this._projectionMatrix=null,this._projectionChanged=null,this._params=null,this._vertex=null,this._invProj=null},n.prototype.x=function(){return this._x},n.prototype.y=function(){return this._y},n.prototype.zoom=function(){return this._zoom},n.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},n.prototype.parameters=function(t){return(t=t||{}).x=this._x,t.y=this._y,t.zoom=this._zoom,t.mediaAspectRatio=this._mediaAspectRatio,t},n.prototype.limiter=function(){return this._limiter},n.prototype.setX=function(t){this._resetParams(),this._params.x=t,this._update(this._params)},n.prototype.setY=function(t){this._resetParams(),this._params.y=t,this._update(this._params)},n.prototype.setZoom=function(t){this._resetParams(),this._params.zoom=t,this._update(this._params)},n.prototype.offsetX=function(t){this.setX(this._x+t)},n.prototype.offsetY=function(t){this.setY(this._y+t)},n.prototype.offsetZoom=function(t){this.setZoom(this._zoom+t)},n.prototype.setMediaAspectRatio=function(t){this._resetParams(),this._params.mediaAspectRatio=t,this._update(this._params)},n.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},n.prototype.setParameters=function(t){this._resetParams();var e=this._params;e.x=t.x,e.y=t.y,e.zoom=t.zoom,e.mediaAspectRatio=t.mediaAspectRatio,this._update(e)},n.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},n.prototype._resetParams=function(){var t=this._params;t.x=null,t.y=null,t.zoom=null,t.mediaAspectRatio=null,t.width=null,t.height=null},n.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._x,i=this._y,n=this._zoom,r=this._mediaAspectRatio,o=this._width,s=this._height;if(t.x=null!=t.x?t.x:e,t.y=null!=t.y?t.y:i,t.zoom=null!=t.zoom?t.zoom:n,t.mediaAspectRatio=null!=t.mediaAspectRatio?t.mediaAspectRatio:r,t.width=null!=t.width?t.width:o,t.height=null!=t.height?t.height:s,this._limiter&&!(t=this._limiter(t)))throw new Error("Bad view limiter");var a=t.x,l=t.y,h=t.zoom,u=t.mediaAspectRatio,c=t.width,p=t.height;if(!(d(a)&&d(l)&&d(h)&&d(u)&&d(c)&&d(p)))throw new Error("Bad view - suspect a broken limiter");h=f(h,1e-9,1/0),this._x=a,this._y=l,this._zoom=h,this._mediaAspectRatio=u,this._width=c,this._height=p,a===e&&l===i&&h===n&&u===r&&c===o&&p===s||(this._projectionChanged=!0,this.emit("change")),c===o&&p===s||this.emit("resize")},n.prototype._zoomX=function(){return this._zoom},n.prototype._zoomY=function(){var t=this._mediaAspectRatio,e=this._width/this._height,i=this._zoom,n=i*t/e;return isNaN(n)&&(n=i),n},n.prototype.updateWithControlParameters=function(t){var e=this.zoom(),i=this._zoomX(),n=this._zoomY();this.offsetX(t.axisScaledX*i+t.x*e),this.offsetY(t.axisScaledY*n+t.y*e),this.offsetZoom(t.zoom*e)},n.prototype.projection=function(){var t=this._projectionMatrix;if(this._projectionChanged){var e=this._x,i=this._y,n=this._zoomX(),r=this._zoomY(),o=this._viewFrustum,s=o[0]=.5-i+.5*r,a=o[1]=e-.5+.5*n,l=o[2]=.5-i-.5*r,h=o[3]=e-.5-.5*n;u.ortho(t,h,a,l,s,-1,1),this._projectionChanged=!1}return t},n.prototype.intersects=function(t){var e=this._viewFrustum;this.projection();for(var i=0;i<e.length;i++){for(var n=e[i],r=h[i],o=c[i],s=!1,a=0;a<t.length;a++){var l=t[a];if(o<0&&l[r]<n||0<o&&l[r]>n){s=!0;break}}if(!s)return!1}return!0},n.prototype.selectLevel=function(t){for(var e=o()*this.width(),i=this._zoom,n=0;n<t.length;n++){var r=t[n];if(i*r.width()>=e)return r}return t[t.length-1]},n.prototype.coordinatesToScreen=function(t,e){var i=this._vertex;e=e||{};var n=this._width,r=this._height;if(n<=0||r<=0)return e.x=null,e.y=null;var o=t&&null!=t.x?t.x:.5,s=t&&null!=t.y?t.y:.5;l.set(i,o-.5,.5-s,-1,1),l.transformMat4(i,i,this.projection());for(var a=0;a<3;a++)i[a]/=i[3];return e.x=n*(i[0]+1)/2,e.y=r*(1-i[1])/2,e},n.prototype.screenToCoordinates=function(t,e){var i=this._vertex,n=this._invProj;e=e||{};var r=this._width,o=this._height;u.invert(n,this.projection());var s=2*t.x/r-1,a=1-2*t.y/o;return l.set(i,s,a,1,1),l.transformMat4(i,i,n),e.x=.5+i[0],e.y=.5-i[1],e},n.limit={x:function(e,i){return function(t){return t.x=f(t.x,e,i),t}},y:function(e,i){return function(t){return t.y=f(t.y,e,i),t}},zoom:function(e,i){return function(t){return t.zoom=f(t.zoom,e,i),t}},resolution:function(n){return function(t){if(t.width<=0||t.height<=0)return t;var e=t.width,i=o()*e/n;return t.zoom=f(t.zoom,i,1/0),t}},visibleX:function(r,o){return function(t){var e=o-r;t.zoom>e&&(t.zoom=e);var i=r+.5*t.zoom,n=o-.5*t.zoom;return t.x=f(t.x,i,n),t}},visibleY:function(o,s){return function(t){if(t.width<=0||t.height<=0)return t;var e=t.width/t.height/t.mediaAspectRatio,i=(s-o)*e;t.zoom>i&&(t.zoom=i);var n=o+.5*t.zoom/e,r=s-.5*t.zoom/e;return t.y=f(t.y,n,r),t}},letterbox:function(){return function(t){if(t.width<=0||t.height<=0)return t;var e,i,n,r,o=t.width/t.height,s=o/t.mediaAspectRatio;return t.mediaAspectRatio>=o&&(t.zoom=Math.min(t.zoom,1)),t.mediaAspectRatio<=o&&(t.zoom=Math.min(t.zoom,s)),1<t.zoom?e=i=.5:(e=0+.5*t.zoom,i=1-.5*t.zoom),t.zoom>s?n=r=.5:(n=0+.5*t.zoom/s,r=1-.5*t.zoom/s),t.x=f(t.x,e,i),t.y=f(t.y,n,r),t}}},n.type=n.prototype.type="flat",e.exports=n},{"../util/clamp":88,"../util/pixelRatio":106,"../util/real":108,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec4":11,"minimal-event-emitter":14}],114:[function(t,e,i){"use strict";function n(t,e){this._yaw=t&&null!=t.yaw?t.yaw:0,this._pitch=t&&null!=t.pitch?t.pitch:0,this._roll=t&&null!=t.roll?t.roll:0,this._fov=t&&null!=t.fov?t.fov:c,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._projectionCenterX=t&&null!=t.projectionCenterX?t.projectionCenterX:0,this._projectionCenterY=t&&null!=t.projectionCenterY?t.projectionCenterY:0,this._limiter=e||null,this._projectionMatrix=d.create(),this._projectionChanged=!0,this._viewFrustum=[f.create(),f.create(),f.create(),f.create(),f.create()],this._params={},this._fovs={},this._vertex=f.create(),this._invProj=d.create(),this._update()}var r=t("minimal-event-emitter"),o=t("../util/pixelRatio"),p=t("../util/convertFov"),l=t("../util/rotateVector"),s=t("../util/mod"),_=t("../util/real"),a=t("../util/clamp"),h=t("../util/decimal"),u=t("../util/compose"),d=t("gl-matrix/src/gl-matrix/mat4"),f=t("gl-matrix/src/gl-matrix/vec4"),c=Math.PI/4;r(n),n.prototype.destroy=function(){this._yaw=null,this._pitch=null,this._roll=null,this._fov=null,this._width=null,this._height=null,this._limiter=null,this._projectionChanged=null,this._projectionMatrix=null,this._viewFrustum=null,this._params=null,this._vertex=null,this._invProj=null},n.prototype.yaw=function(){return this._yaw},n.prototype.pitch=function(){return this._pitch},n.prototype.roll=function(){return this._roll},n.prototype.projectionCenterX=function(){return this._projectionCenterX},n.prototype.projectionCenterY=function(){return this._projectionCenterY},n.prototype.fov=function(){return this._fov},n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},n.prototype.parameters=function(t){return(t=t||{}).yaw=this._yaw,t.pitch=this._pitch,t.roll=this._roll,t.fov=this._fov,t},n.prototype.limiter=function(){return this._limiter},n.prototype.setYaw=function(t){this._resetParams(),this._params.yaw=t,this._update(this._params)},n.prototype.setPitch=function(t){this._resetParams(),this._params.pitch=t,this._update(this._params)},n.prototype.setRoll=function(t){this._resetParams(),this._params.roll=t,this._update(this._params)},n.prototype.setFov=function(t){this._resetParams(),this._params.fov=t,this._update(this._params)},n.prototype.setProjectionCenterX=function(t){this._resetParams(),this._params.projectionCenterX=t,this._update(this._params)},n.prototype.setProjectionCenterY=function(t){this._resetParams(),this._params.projectionCenterY=t,this._update(this._params)},n.prototype.offsetYaw=function(t){this.setYaw(this._yaw+t)},n.prototype.offsetPitch=function(t){this.setPitch(this._pitch+t)},n.prototype.offsetRoll=function(t){this.setRoll(this._roll+t)},n.prototype.offsetFov=function(t){this.setFov(this._fov+t)},n.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},n.prototype.setParameters=function(t){this._resetParams();var e=this._params;e.yaw=t.yaw,e.pitch=t.pitch,e.roll=t.roll,e.fov=t.fov,e.projectionCenterX=t.projectionCenterX,e.projectionCenterY=t.projectionCenterY,this._update(e)},n.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},n.prototype._resetParams=function(){var t=this._params;t.yaw=null,t.pitch=null,t.roll=null,t.fov=null,t.width=null,t.height=null},n.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._yaw,i=this._pitch,n=this._roll,r=this._fov,o=this._projectionCenterX,s=this._projectionCenterY,a=this._width,l=this._height;if(t.yaw=null!=t.yaw?t.yaw:e,t.pitch=null!=t.pitch?t.pitch:i,t.roll=null!=t.roll?t.roll:n,t.fov=null!=t.fov?t.fov:r,t.width=null!=t.width?t.width:a,t.height=null!=t.height?t.height:l,t.projectionCenterX=null!=t.projectionCenterX?t.projectionCenterX:o,t.projectionCenterY=null!=t.projectionCenterY?t.projectionCenterY:s,this._limiter&&!(t=this._limiter(t)))throw new Error("Bad view limiter");var h=(t=this._normalize(t)).yaw,u=t.pitch,c=t.roll,p=t.fov,d=t.width,f=t.height,m=t.projectionCenterX,v=t.projectionCenterY;if(!(_(h)&&_(u)&&_(c)&&_(p)&&_(d)&&_(f)&&_(m)&&_(v)))throw new Error("Bad view - suspect a broken limiter");this._yaw=h,this._pitch=u,this._roll=c,this._fov=p,this._width=d,this._height=f,this._projectionCenterX=m,this._projectionCenterY=v,h===e&&u===i&&c===n&&p===r&&d===a&&f===l&&m===o&&v===s||(this._projectionChanged=!0,this.emit("change")),d===a&&f===l||this.emit("resize")},n.prototype._normalize=function(t){this._normalizeCoordinates(t);var e=p.htov(Math.PI,t.width,t.height),i=isNaN(e)?Math.PI:Math.min(Math.PI,e);return t.fov=a(t.fov,1e-9,i-1e-9),t},n.prototype._normalizeCoordinates=function(t){return"yaw"in t&&(t.yaw=s(t.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in t&&(t.pitch=s(t.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in t&&(t.roll=s(t.roll-Math.PI,-2*Math.PI)+Math.PI),t},n.prototype.normalizeToClosest=function(t,e){var i=this._yaw,n=this._pitch,r=t.yaw,o=t.pitch,s=r-2*Math.PI,a=r+2*Math.PI;Math.abs(s-i)<Math.abs(r-i)?r=s:Math.abs(a-i)<Math.abs(r-i)&&(r=a);var l=o-2*Math.PI,h=o+2*Math.PI;return Math.abs(l-n)<Math.abs(o-n)?o=l:Math.abs(l-n)<Math.abs(o-n)&&(o=h),(e=e||{}).yaw=r,e.pitch=o,e},n.prototype.updateWithControlParameters=function(t){var e=this._fov,i=p.vtoh(e,this._width,this._height);isNaN(i)&&(i=e),this.offsetYaw(t.axisScaledX*i+2*t.x*i+t.yaw),this.offsetPitch(t.axisScaledY*e+2*t.y*i+t.pitch),this.offsetRoll(-t.roll),this.offsetFov(t.zoom*e)},n.prototype.projection=function(){var t=this._projectionMatrix,e=this._viewFrustum;if(this._projectionChanged){var i=this._width,n=this._height,r=this._fov,o=p.vtoh(r,i,n),s=i/n,a=this._projectionCenterX,l=this._projectionCenterY;if(0!==a||0!==l){var h=Math.atan(2*a*Math.tan(o/2)),u=Math.atan(2*l*Math.tan(r/2)),c=this._fovs;c.leftDegrees=180*(o/2+h)/Math.PI,c.rightDegrees=180*(o/2-h)/Math.PI,c.upDegrees=180*(r/2+u)/Math.PI,c.downDegrees=180*(r/2-u)/Math.PI,d.perspectiveFromFieldOfView(t,c,-1,1)}else d.perspective(t,r,s,-1,1);d.rotateZ(t,t,this._roll),d.rotateX(t,t,this._pitch),d.rotateY(t,t,this._yaw),f.set(e[0],t[3]+t[0],t[7]+t[4],t[11]+t[8],0),f.set(e[1],t[3]-t[0],t[7]-t[4],t[11]-t[8],0),f.set(e[2],t[3]+t[1],t[7]+t[5],t[11]+t[9],0),f.set(e[3],t[3]-t[1],t[7]-t[5],t[11]-t[9],0),f.set(e[4],t[3]+t[2],t[7]+t[6],t[11]+t[10],0),this._projectionChanged=!1}return t},n.prototype.intersects=function(t){var e=this._viewFrustum,i=this._vertex;this.projection();for(var n=0;n<e.length;n++){for(var r=e[n],o=!1,s=0;s<t.length;s++){var a=t[s];f.set(i,a[0],a[1],a[2],0),0<=f.dot(r,i)&&(o=!0)}if(!o)return!1}return!0},n.prototype.selectLevel=function(t){for(var e=o()*this._height,i=Math.tan(.5*this._fov),n=0;n<t.length;n++){var r=t[n];if(i*r.height()>=e)return r}return t[t.length-1]},n.prototype.coordinatesToScreen=function(t,e){var i=this._vertex;e=e||{};var n=this._width,r=this._height;if(n<=0||r<=0)return e.x=null,e.y=null;var o=t&&null!=t.yaw?t.yaw:0,s=t&&null!=t.pitch?t.pitch:0,a=t&&null!=t.roll?t.roll:0;return f.set(i,0,0,-1,1),l(i,i,-o,-s,-a),f.transformMat4(i,i,this.projection()),0<=i[3]?(e.x=n*(i[0]/i[3]+1)/2,e.y=r*(1-i[1]/i[3])/2,e):(e.x=null,e.y=null)},n.prototype.screenToCoordinates=function(t,e){var i=this._vertex,n=this._invProj;e=e||{};var r=this._width,o=this._height;d.invert(n,this.projection());var s=2*t.x/r-1,a=1-2*t.y/o;f.set(i,s,a,1,1),f.transformMat4(i,i,n);var l=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);return e.yaw=Math.atan2(i[0],-i[2]),e.pitch=Math.acos(i[1]/l)-Math.PI/2,this._normalizeCoordinates(e),e},n.prototype.coordinatesToPerspectiveTransform=function(t,e,i){i=i||"";var n=this._height,r=this._width,o=this._fov,s=.5*n/Math.tan(o/2),a="";return a+="translateX("+h(r/2)+"px) translateY("+h(n/2)+"px) ",a+="translateX(-50%) translateY(-50%) ",a+="perspective("+h(s)+"px) ",a+="translateZ("+h(s)+"px) ",a+="rotateZ("+h(-this._roll)+"rad) ",a+="rotateX("+h(-this._pitch)+"rad) ",a+="rotateY("+h(this._yaw)+"rad) ",a+="rotateY("+h(-t.yaw)+"rad) ",a+="rotateX("+h(t.pitch)+"rad) ",(a+="translateZ("+h(-e)+"px) ")+(i+" ")},n.limit={yaw:function(e,i){return function(t){return t.yaw=a(t.yaw,e,i),t}},pitch:function(e,i){return function(t){return t.pitch=a(t.pitch,e,i),t}},roll:function(e,i){return function(t){return t.roll=a(t.roll,e,i),t}},hfov:function(o,s){return function(t){var e=t.width,i=t.height;if(0<e&&0<i){var n=p.htov(o,e,i),r=p.htov(s,e,i);t.fov=a(t.fov,n,r)}return t}},vfov:function(e,i){return function(t){return t.fov=a(t.fov,e,i),t}},resolution:function(r){return function(t){var e=t.height;if(e){var i=o()*e,n=2*Math.atan(i/r);t.fov=a(t.fov,n,1/0)}return t}},traditional:function(t,e,i){return i=null!=i?i:e,u(n.limit.resolution(t),n.limit.vfov(0,e),n.limit.hfov(0,i),n.limit.pitch(-Math.PI/2,Math.PI/2))}},n.type=n.prototype.type="rectilinear",e.exports=n},{"../util/clamp":88,"../util/compose":91,"../util/convertFov":92,"../util/decimal":93,"../util/mod":103,"../util/pixelRatio":106,"../util/real":108,"../util/rotateVector":110,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec4":11,"minimal-event-emitter":14}]},{},[58])(58)});