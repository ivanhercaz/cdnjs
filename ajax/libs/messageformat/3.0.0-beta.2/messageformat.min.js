"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var safeIdentifier=require("safe-identifier"),Compiler=_interopDefault(require("./compiler")),Cardinals=require("make-plural/cardinals"),PluralCategories=require("make-plural/pluralCategories"),Plurals=require("make-plural/plurals");function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);r&&(l=l.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,l)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function normalize(e){if("string"!=typeof e||e.length<2)throw new RangeError(`Invalid language tag: ${e}`);if(e.startsWith("pt-PT"))return"pt-PT";const r=e.match(/.+?(?=[-_])/);return r?r[0]:e}function getPlural(e){if("function"==typeof e){const r=normalize(e.name);return{isDefault:!1,id:safeIdentifier.identifier(r),lc:r,locale:e.name,getPlural:e,cardinals:e.cardinals||[],ordinals:e.ordinals||[]}}const r=normalize(e);return r in Plurals?{isDefault:!0,id:safeIdentifier.identifier(r),lc:r,locale:e,getCardinal:Cardinals[r],getPlural:Plurals[r],cardinals:PluralCategories[r].cardinal,ordinals:PluralCategories[r].ordinal}:null}function getAllPlurals(e){const r=Object.keys(Plurals).filter(r=>r!==e);return r.unshift(e),r.map(getPlural)}function hasPlural(e){return normalize(e)in Plurals}class MessageFormat{static escape(e,r){const t=r?/[#{}]/g:/[{}]/g;return String(e).replace(t,"'$&'")}static supportedLocalesOf(e){return(Array.isArray(e)?e:[e]).filter(hasPlural)}constructor(e,r){if(this.options=Object.assign({biDiSupport:!1,currency:"USD",customFormatters:{},returnType:"string",strictNumberSign:!1},r),"*"===e)this.plurals=getAllPlurals(MessageFormat.defaultLocale);else if(Array.isArray(e))this.plurals=e.map(getPlural).filter(Boolean);else if(e){const r=getPlural(e);r&&(this.plurals=[r])}if(!this.plurals||0===this.plurals.length){const e=getPlural(MessageFormat.defaultLocale);this.plurals=[e]}}resolvedOptions(){return _objectSpread2({},this.options,{locale:this.plurals[0].locale,plurals:this.plurals})}compile(e){const r=new Compiler(this.options),t="return "+r.compile(e,this.plurals[0]),l=[],a=[];for(const[e,t]of Object.entries(r.runtime))l.push(e),a.push(t);return new Function(...l,t).apply(null,a)}}MessageFormat.defaultLocale="en",module.exports=MessageFormat;