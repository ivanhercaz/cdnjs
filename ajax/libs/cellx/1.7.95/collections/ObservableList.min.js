"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var is_1=require("@riim/is"),symbol_polyfill_1=require("@riim/symbol-polyfill"),EventEmitter_1=require("../EventEmitter"),push=Array.prototype.push,splice=Array.prototype.splice,defaultComparator=function(t,e){return t<e?-1:e<t?1:0},ObservableList=function(o){function h(t,e){var i=o.call(this)||this;if(i._items=[],e&&(e.sorted||e.comparator&&!1!==e.sorted)?(i._comparator=e.comparator||defaultComparator,i._sorted=!0):(i._comparator=null,i._sorted=!1),t)if(i._sorted){t instanceof h&&(t=t._items);for(var r=0,n=t.length;r<n;r++)i._insertSortedValue(t[r])}else push.apply(i._items,t instanceof h?t._items:t);return i}return __extends(h,o),Object.defineProperty(h.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),h.prototype._validateIndex=function(t,e){if(void 0===t)return t;if(t<0){if((t+=this._items.length)<0)throw new RangeError("Index out of valid range")}else if(t>this._items.length-(e?0:1))throw new RangeError("Index out of valid range");return t},h.prototype.contains=function(t){return-1!=this._items.indexOf(t)},h.prototype.indexOf=function(t,e){return this._items.indexOf(t,this._validateIndex(e,!0))},h.prototype.lastIndexOf=function(t,e){return this._items.lastIndexOf(t,void 0===e?-1:this._validateIndex(e,!0))},h.prototype.get=function(t){return this._items[this._validateIndex(t,!0)]},h.prototype.getRange=function(t,e){if(t=this._validateIndex(t,!0),void 0===e)return this._items.slice(t);if(t+e>this._items.length)throw new RangeError('Sum of "index" and "count" out of valid range');return this._items.slice(t,t+e)},h.prototype.set=function(t,e){if(this._sorted)throw new TypeError("Cannot set to sorted list");return t=this._validateIndex(t,!0),is_1.is(e,this._items[t])||(this._items[t]=e,this.emit("change")),this},h.prototype.setRange=function(t,e){if(this._sorted)throw new TypeError("Cannot set to sorted list");t=this._validateIndex(t,!0),e instanceof h&&(e=e._items);var i=e.length;if(!i)return this;if(t+i>this._items.length)throw new RangeError('Sum of "index" and "values.length" out of valid range');for(var r=this._items,n=!1,o=t+i;t<o;){var s=e[--o-t];is_1.is(s,r[o])||(r[o]=s,n=!0)}return n&&this.emit("change"),this},h.prototype.add=function(t,e){return e&&-1!=this._items.indexOf(t)||(this._sorted?this._insertSortedValue(t):this._items.push(t),this.emit("change")),this},h.prototype.addRange=function(t,e){if(t instanceof h&&(t=t._items),t.length)if(e){for(var i=this._items,r=this._sorted,n=!1,o=0,s=t.length;o<s;o++){var a=t[o];-1==i.indexOf(a)&&(r?this._insertSortedValue(a):i.push(a),n=!0)}n&&this.emit("change")}else{if(this._sorted)for(o=0,s=t.length;o<s;o++)this._insertSortedValue(t[o]);else push.apply(this._items,t);this.emit("change")}return this},h.prototype.insert=function(t,e){if(this._sorted)throw new TypeError("Cannot insert to sorted list");return this._items.splice(this._validateIndex(t,!0),0,e),this.emit("change"),this},h.prototype.insertRange=function(t,e){if(this._sorted)throw new TypeError("Cannot insert to sorted list");return t=this._validateIndex(t,!0),e instanceof h&&(e=e._items),e.length&&(splice.apply(this._items,[t,0].concat(e)),this.emit("change")),this},h.prototype.remove=function(t,e){var i=this._items.indexOf(t,this._validateIndex(e,!0));return-1!=i&&(this._items.splice(i,1),this.emit("change"),!0)},h.prototype.removeAll=function(t,e){for(var i=this._validateIndex(e,!0),r=this._items,n=!1;-1!=(i=r.indexOf(t,i));)r.splice(i,1),n=!0;return n&&this.emit("change"),n},h.prototype.removeEach=function(t,e){e=this._validateIndex(e,!0),t instanceof h&&(t=t._items.slice());for(var i=this._items,r=!1,n=0,o=t.length;n<o;n++){var s=i.indexOf(t[n],e);-1!=s&&(i.splice(s,1),r=!0)}return r&&this.emit("change"),r},h.prototype.removeAt=function(t){var e=this._items.splice(this._validateIndex(t),1)[0];return this.emit("change"),e},h.prototype.removeRange=function(t,e){if(t=this._validateIndex(t,!0),void 0===e){if(!(e=this._items.length-t))return[]}else{if(!e)return[];if(t+e>this._items.length)throw new RangeError('Sum of "index" and "count" out of valid range')}var i=this._items.splice(t,e);return this.emit("change"),i},h.prototype.clear=function(){return this._items.length&&(this._items.length=0,this.emit("change",{subtype:"clear"})),this},h.prototype.join=function(t){return this._items.join(t)},h.prototype.find=function(t,e){for(var i=this._items,r=0,n=i.length;r<n;r++){var o=i[r];if(t.call(e,o,r,this))return o}},h.prototype.findIndex=function(t,e){for(var i=this._items,r=0,n=i.length;r<n;r++)if(t.call(e,i[r],r,this))return r;return-1},h.prototype.clone=function(t){return new this.constructor(t?this._items.map(function(t){return t&&t.clone?t.clone(!0):t}):this,{comparator:this._comparator||void 0,sorted:this._sorted})},h.prototype.toArray=function(){return this._items.slice()},h.prototype.toString=function(){return this._items.join()},h.prototype._insertSortedValue=function(t){for(var e=this._items,i=this._comparator,r=0,n=e.length;r!=n;){var o=r+n>>1;i(t,e[o])<0?n=o:r=1+o}e.splice(r,0,t)},h}(EventEmitter_1.EventEmitter);exports.ObservableList=ObservableList,["forEach","map","filter","every","some"].forEach(function(t){ObservableList.prototype[t]=function(i,r){return this._items[t](function(t,e){return i.call(r,t,e,this)},this)}}),["reduce","reduceRight"].forEach(function(i){ObservableList.prototype[i]=function(r,t){var n=this;function e(t,e,i){return r(t,e,i,n)}return 2<=arguments.length?this._items[i](e,t):this._items[i](e)}}),[["keys",function(t){return t}],["values",function(t,e){return e}],["entries",function(t,e){return[t,e]}]].forEach(function(t){var r=t[1];ObservableList.prototype[t[0]]=function(){var t=this._items,e=0,i=!1;return{next:function(){if(!i){if(e<t.length)return{value:r(e,t[e++]),done:!1};i=!0}return{value:void 0,done:!0}}}}}),ObservableList.prototype[symbol_polyfill_1.Symbol.iterator]=ObservableList.prototype.values;