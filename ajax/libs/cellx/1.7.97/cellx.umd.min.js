!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cellx=t():e.cellx=t()}(window,function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(2),n=i(3),l=i(9),o=i(10);var h=i(7);t.EventEmitter=h.EventEmitter;var a=i(10);t.ObservableMap=a.ObservableMap;var u=i(9);t.ObservableList=u.ObservableList;var _=i(3);t.Cell=_.Cell;var c=i(8);t.WaitError=c.WaitError;const f=Object.prototype.hasOwnProperty,d=Array.prototype.slice,p=Function("return this;")();function g(e,t,i){let s=t+"Cell";return Object.defineProperty(e,s,{configurable:!0,enumerable:!1,writable:!0,value:i instanceof n.Cell?i:new n.Cell(i,{context:e})}),Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){return this[s].get()},set(e){this[s].set(e)}}),e}function v(e,t){return Object.keys(t).forEach(i=>{g(e,i,t[i])}),e}t.map=function(e){return new o.ObservableMap(e)},t.list=function(e,t){return new l.ObservableList(e,t)},t.KEY_CELL_MAP=r.Symbol("cellx[cellMap]"),t.cellx=function e(i,r){r||(r={});let l=i,o=function(i){let h=this;h&&h!=p||(h=o),f.call(h,t.KEY_CELL_MAP)||(h[t.KEY_CELL_MAP]=new s.Map);let a=h[t.KEY_CELL_MAP].get(o);if(!a){if("dispose"===i&&arguments.length>=2)return;a=new n.Cell(l,{__proto__:r,context:h}),h[t.KEY_CELL_MAP].set(o,a)}switch(arguments.length){case 0:return a.get();case 1:return a.set(i),i}let u=i;switch(u){case"cell":return a;case"bind":return(o=o.bind(h)).constructor=e,o}let _=n.Cell.prototype[u].apply(a,d.call(arguments,1));return _===a?o:_};return o.constructor=e,(r.onChange||r.onError)&&o.call(r.context||p),o},t.defineObservableProperty=g,t.defineObservableProperties=v,t.define=function(e,t,i){return"string"==typeof t?g(e,t,i):v(e,t),e}},function(e,t,i){var s=Function("return this;")(),r=i(2).Symbol,n=s.Map;if(!n||-1==n.toString().indexOf("[native code]")||!new n([[1,1]]).size){var l=Object.prototype.hasOwnProperty,o=r("mapId"),h=0,a={value:void 0};(n=function(e){if(this._entries=Object.create(null),this._objectStamps={},this._first=null,this._last=null,this.size=0,e)for(var t=0,i=e.length;t<i;t++)this.set(e[t][0],e[t][1])}).prototype={constructor:n,has:function(e){return!!this._entries[this._getValueStamp(e)]},get:function(e){return(this._entries[this._getValueStamp(e)]||a).value},set:function(e,t){var i=this._entries,s=this._getValueStamp(e);if(i[s])i[s].value=t;else{var r=i[s]={key:e,keyStamp:s,value:t,prev:this._last,next:null};this.size++?this._last.next=r:this._first=r,this._last=r}return this},delete:function(e){var t=this._getValueStamp(e),i=this._entries[t];if(!i)return!1;if(--this.size){var s=i.prev,r=i.next;s?s.next=r:this._first=r,r?r.prev=s:this._last=s}else this._first=null,this._last=null;return delete this._entries[t],delete this._objectStamps[t],!0},clear:function(){var e=this._entries;for(var t in e)delete e[t];this._objectStamps={},this._first=null,this._last=null,this.size=0},forEach:function(e,t){for(var i=this._first;i;){e.call(t,i.value,i.key,this);do{i=i.next}while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"},_getValueStamp:function(e){switch(typeof e){case"undefined":return"undefined";case"object":if(null===e)return"null";break;case"boolean":return"?"+e;case"number":return"+"+e;case"string":return","+e}return this._getObjectStamp(e)},_getObjectStamp:function(e){if(!l.call(e,o)){if(!Object.isExtensible(e)){var t,i=this._objectStamps;for(t in i)if(l.call(i,t)&&i[t]==e)return t;return i[t=String(++h)]=e,t}Object.defineProperty(e,o,{value:String(++h)})}return e[o]}},[["keys",function(e){return e.key}],["values",function(e){return e.value}],["entries",function(e){return[e.key,e.value]}]].forEach(function(e){var t=e[1];n.prototype[e[0]]=function(){var e,i=this._entries,s=!1,r=this;return{next:function(){if(!s){if(e)do{e=e.next}while(e&&!i[e.keyStamp]);else e=r._first;if(e)return{value:t(e),done:!1};s=!0}return{value:void 0,done:!0}}}}})}n.prototype[r.iterator]||(n.prototype[r.iterator]=n.prototype.entries);var u=s.Set;u&&-1!=u.toString().indexOf("[native code]")&&new u([1]).size||((u=function(e){this._values=new n(e?e.map(function(e){return[e,e]}):[]),this.size=0}).prototype={constructor:u,has:function(e){return this._values.has(e)},add:function(e){return this._values.set(e,e),this.size=this._values.size,this},delete:function(e){return!!this._values.delete(e)&&(this.size--,!0)},clear:function(){this._values.clear(),this.size=0},forEach:function(e,t){this._values.forEach(function(i){e.call(t,i,i,this)},this)},keys:n.prototype.keys,values:n.prototype.values,entries:n.prototype.entries}),u.prototype[r.iterator]||(u.prototype[r.iterator]=u.prototype.values),t.Map=n,t.Set=u},function(e,t,i){var s=Function("return this;")().Symbol;if(!s){var r=0;(s=function(e){return"__"+e+"_"+Math.floor(1e9*Math.random())+"_"+ ++r+"__"}).iterator=s("Symbol.iterator")}t.Symbol=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),r=i(5),n=i(1),l=i(6),o=i(2),h=i(7),a=i(8),u=Number.MAX_SAFE_INTEGER||9007199254740991,_=o.Symbol("cellx[wrappers]"),c=new n.Map;let f=u,d=-1,p=!1,g=0;const v=new n.Set;let y,m=1,E=null;const b={error:null};let x=0,w=0;const S=1,O=2,C=4,j=8,P=16,I=32,R=64,M=128;function k(e){if(!p&&!e)return;p=!1,g++;let t=c.get(f);for(;;){let e,i=t&&t.shift();if(!i){if(f==d)break;t=c.get(++f);continue}let s=i._level,n=i._changeEvent;if(n)e=f;else{if(s>f||-1==i._levelInRelease){if(!t.length){if(f==d)break;t=c.get(++f)}continue}if(e=f,i.pull(),v.has(i)?L.debug&&r.warn("Multiple cell pull in release",i):v.add(i),f<e){t.unshift(i),t=c.get(f);continue}if((s=i._level)>f){t.length||(t=c.get(++f));continue}n=i._changeEvent}if(i._levelInRelease=-1,n){i._fixedValue=i._value,i._changeEvent=null;let r=i._pushingIndex,l=i._reactions;for(let e=0,t=l.length;e<t;e++){let t=l[e];t._level<=s&&(t._level=s+1),r>t._pushingIndex&&(t._pushingIndex=r,t._prevChangeEvent=t._changeEvent,t._changeEvent=null,t._addToRelease())}if(i.handleEvent(n),f==u)break;if(f!=e){t=c.get(f);continue}}if(!t.length){if(f==d)break;t=c.get(++f)}}if(!--g&&(f=u,d=-1,v.clear(),m++,y)){let e=y;y=null;for(let t=0,i=e.length;t<i;t++){let i=e[t];"function"==typeof i?i():i[0]._push(i[1],!0,!1)}}}function A(e,t){e.push(t)}class L extends h.EventEmitter{constructor(e,t){super(),this._error=null,this._pushingIndex=0,this._errorIndex=0,this._version=0,this._dependencies=void 0,this._reactions=[],this._level=0,this._levelInRelease=-1,this._selfPendingStatusCell=null,this._pendingStatusCell=null,this._selfErrorCell=null,this._errorCell=null,this._state=M,this._prevChangeEvent=null,this._changeEvent=null,this._lastErrorEvent=null,this.debugKey=t&&t.debugKey,this.context=t&&void 0!==t.context?t.context:this,this._pull="function"==typeof e?e:null,this._get=t&&t.get||null,this._validate=t&&t.validate||null,this._merge=t&&t.merge||null,this._put=t&&t.put||A,this._onFulfilled=this._onRejected=null,this._reap=t&&t.reap||null,this.meta=t&&t.meta||null,this._pull?this._fixedValue=this._value=void 0:(this._validate&&this._validate(e,void 0),this._merge&&(e=this._merge(e,void 0)),this._fixedValue=this._value=e,e instanceof h.EventEmitter&&e.on("change",this._onValueChange,this)),t&&(t.onChange&&this.on("change",t.onChange),t.onError&&this.on("error",t.onError))}static get currentlyPulling(){return!!E}static autorun(e,t){let i;return new L(function(){i||(i=(()=>{this.dispose()})),e.call(t,i)},{onChange(){}}),i}static forceRelease(){(p||g)&&k(!0)}static afterRelease(e){(y||(y=[])).push(e)}on(e,t,i){return(p||g)&&k(!0),this._activate(),"object"==typeof e?super.on(e,void 0!==t?t:this.context):super.on(e,t,void 0!==i?i:this.context),this._state|=C,this}off(e,t,i){return(p||g)&&k(!0),e?"object"==typeof e?super.off(e,void 0!==t?t:this.context):super.off(e,t,void 0!==i?i:this.context):super.off(),!this._reactions.length&&!this._events.has("change")&&!this._events.has("error")&&this._state&C&&(this._state^=C,this._deactivate(),this._reap&&this._reap.call(this.context)),this}addChangeListener(e,t){return this.on("change",e,void 0!==t?t:this.context)}removeChangeListener(e,t){return this.off("change",e,void 0!==t?t:this.context)}addErrorListener(e,t){return this.on("error",e,void 0!==t?t:this.context)}removeErrorListener(e,t){return this.off("error",e,void 0!==t?t:this.context)}subscribe(e,t){let i=e[_]||(e[_]=new n.Map);if(i.has(this))return this;function s(t){return e.call(this,t.data.error||null,t)}return i.set(this,s),void 0===t&&(t=this.context),this.on("change",s,t).on("error",s,t)}unsubscribe(e,t){let i=e[_],s=i&&i.get(this);return s?(i.delete(this),void 0===t&&(t=this.context),this.off("change",s,t).off("error",s,t)):this}_addReaction(e){this._activate(),this._reactions.push(e),this._state|=C}_deleteReaction(e){this._reactions.splice(this._reactions.indexOf(e),1),this._reactions.length||this._events.has("change")||this._events.has("error")||(this._state^=C,this._deactivate(),this._reap&&this._reap.call(this.context))}_activate(){if(!this._pull||this._state&O)return;let e=this._dependencies;if(null!==e){if(this._version<m){let t=this._pull$();!e&&!this._dependencies&&this._state&S||(t===b?this._fail(b.error,!1,!1):this._push(t,!1,!1)),e=this._dependencies}if(e){let t=e.length;do{e[--t]._addReaction(this)}while(t);this._state|=O}}}_deactivate(){if(!(this._state&O))return;let e=this._dependencies,t=e.length;do{e[--t]._deleteReaction(this)}while(t);-1!=this._levelInRelease&&(this._levelInRelease=-1,this._changeEvent=null),this._state^=O}_onValueChange(e){if(this._pushingIndex=++x,this._state&C){let t=(e.data||(e.data={})).prevEvent=this._changeEvent;this._changeEvent=e,t?this._value===this._fixedValue&&(this._state&=~M):(this._state&=~M,this._addToRelease())}else this._version=++m+ +(0!=g)}get(){if(this._pull)if(this._state&O)(p||g&&!E)&&k(!0);else if(this._version<m+ +p+ +(0!=g)){let e=this._dependencies;if(null!==e){let t=this._pull$(),i=this._dependencies;if(e||i||!(this._state&S)){if(i&&this._state&C){let e=i.length;do{i[--e]._addReaction(this)}while(e);this._state|=O}t===b?this._fail(b.error,!1,!1):this._push(t,!1,!1)}}}if(E){let e=E._dependencies,t=this._level;e?-1==e.indexOf(this)&&(e.push(this),E._level<=t&&(E._level=t+1)):(E._dependencies=[this],E._level=t+1)}if(E&&this._error&&this._error instanceof a.WaitError)throw this._error;return this._get?this._get(this._value):this._value}pull(){if(!this._pull)return!1;let e,t,i;if(p&&k(),this._state&C){e=this._dependencies,t=this._level,i=this._pull$();let s=this._dependencies,r=0;if(s){let t=s.length;do{let i=s[--t];e&&-1!=e.indexOf(i)||(i._addReaction(this),r++)}while(t)}if(e&&(s?s.length-r:0)<e.length)for(let t=e.length;t;){let i=e[--t];s&&-1!=s.indexOf(i)||i._deleteReaction(this)}if(s?this._state|=O:this._state&=~O,g&&this._level>t)return this._addToRelease(),!1}else i=this._pull$();return i===b?(this._fail(b.error,!1,!0),!0):this._push(i,!1,!0)}_pull$(){if(this._state&j)throw new TypeError("Circular pulling detected");let e=this._pull;e.length&&(this._selfPendingStatusCell&&this._selfPendingStatusCell.set(!0),this._state|=P,this._state&=~(I|R));let t=E;E=this,this._dependencies=null,this._level=0,this._state|=j;try{return e.length?e.call(this.context,this,this._value):e.call(this.context)}catch(e){return b.error=e,b}finally{E=t,this._version=m+ +(0!=g);let e=this._pendingStatusCell;e&&e._state&O&&e.pull();let i=this._errorCell;i&&i._state&O&&i.pull(),this._state^=j}}getError(){let e=this._errorCell;if(!e){let t=this.debugKey;this._selfErrorCell=new L(this._error,t?{debugKey:t+"._selfErrorCell"}:void 0),e=this._errorCell=new L(function(){this.get();let e,t=this._selfErrorCell.get();if(t&&(e=this._errorIndex)==w)return t;let i=this._dependencies;if(i){let s=i.length;do{let r=i[--s],n=r.getError();if(n){let i=r._errorIndex;if(i==w)return n;(!t||e<i)&&(t=n,e=i)}}while(s)}return t},t?{debugKey:t+"._errorCell",context:this}:{context:this})}return e.get()}isPending(){let e=this._pendingStatusCell;if(!e){let t=this.debugKey;this._selfPendingStatusCell=new L(!!(this._state&P),t?{debugKey:t+"._selfPendingStatusCell"}:void 0),e=this._pendingStatusCell=new L(function(){if(this._selfPendingStatusCell.get())return!0;try{this.get()}catch(e){}let e=this._dependencies;if(e){let t=e.length;do{if(e[--t].isPending())return!0}while(t)}return!1},t?{debugKey:t+"._pendingStatusCell",context:this}:{context:this})}return e.get()}set(e){return this._validate&&this._validate(e,this._value),this._merge&&(e=this._merge(e,this._value)),this._selfPendingStatusCell&&this._selfPendingStatusCell.set(!0),this._state|=P,this._state&=~(I|R),this._put.length>=3?this._put.call(this.context,this,e,this._value):this._put.call(this.context,this,e),this}push(e){return this._push(e,!0,!1),this}_push(e,t,i){(t||!g&&i)&&(this._pushingIndex=++x),this._state|=S,this._error&&this._setError(null,!1);let r=this._value;if(s.is(e,r))return(t||g&&i)&&this._fulfill(e),!1;if(this._value=e,r instanceof h.EventEmitter&&r.off("change",this._onValueChange,this),e instanceof h.EventEmitter&&e.on("change",this._onValueChange,this),this._state&C){let t=this._changeEvent||this._prevChangeEvent;t?(s.is(e,this._fixedValue)&&this._state&M?(this._levelInRelease=-1,this._changeEvent=null):this._changeEvent={target:this,type:"change",data:{prevEvent:t,prevValue:r,value:e}},this._prevChangeEvent=null):(this._state|=M,this._changeEvent={target:this,type:"change",data:{prevEvent:null,prevValue:r,value:e}},this._addToRelease())}else(t||!g&&i)&&m++,this._fixedValue=e,this._version=m+ +(0!=g);return(t||g&&i)&&this._fulfill(e),!0}_fulfill(e){this._resolvePending(),this._state&I||(this._state|=I,this._onFulfilled&&this._onFulfilled(e))}fail(e){return this._fail(e,!0,!1),this}_fail(e,t,i){e instanceof a.WaitError||(this.debugKey?r.error("["+this.debugKey+"]",e):r.error(e),e instanceof Error||(e=new Error(String(e)))),this._setError(e,t||0!=g&&i)}_setError(e,t){this._error=e,this._selfErrorCell&&this._selfErrorCell.set(e),e&&(this._errorIndex=++w,this._handleErrorEvent({target:this,type:"error",data:{error:e}},t?e:null))}_handleErrorEvent(e,t){if(this._lastErrorEvent===e)return;this._lastErrorEvent=e,this.handleEvent(e),t&&this._reject(t);let i=this._reactions;for(let s=i.length;s;)i[--s]._handleErrorEvent(e,t)}_reject(e){this._resolvePending(),e instanceof a.WaitError||this._state&R||(this._state|=R,this._onRejected&&this._onRejected(e))}wait(){throw new a.WaitError}_addToRelease(){let e,t=this._level;t<=this._levelInRelease||((c.get(t)||(c.set(t,e=[]),e)).push(this),f>t&&(f=t),d<t&&(d=t),this._levelInRelease=t,p||g||(p=!0,l.nextTick(k)))}_resolvePending(){this._state&P&&(this._selfPendingStatusCell&&this._selfPendingStatusCell.set(!1),this._state^=P)}then(e,t){let i=()=>{};if(this.on("change",i),!this._pull||this._state&I)return this.off("change",i),Promise.resolve(this._get?this._get(this._value):this._value).then(e);if(this._state&R)return this.off("change",i),Promise.reject(this._error).catch(t);let s=this;return new Promise((e,t)=>{s._onFulfilled=(t=>{s._onFulfilled=s._onRejected=null,this.off("change",i),e(s._get?s._get(t):t)}),s._onRejected=(e=>{s._onFulfilled=s._onRejected=null,this.off("change",i),t(e)})}).then(e,t)}catch(e){return this.then(null,e)}reap(){this.off();let e=this._reactions;for(let t=e.length;t;)e[--t].reap();return this}dispose(){return this.reap()}}L.debug=!1,t.Cell=L},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.is=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];(console[e]||function(){}).apply(console,"error"==e?t.map(function(e){return e&&"object"==typeof e&&e.stack||e}):t)},r=function(){function e(e){this.handler=e||s}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handler.apply(this,["log"].concat(e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handler.apply(this,["warn"].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handler.apply(this,["error"].concat(e))},e}();t.Logger=r,t.logger=r.$instance=new r,t.log=t.logger.log.bind(t.logger),t.warn=t.logger.warn.bind(t.logger),t.error=t.logger.error.bind(t.logger)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5);t.nextTick=(()=>{const e=Function("return this;")();if(e.process&&"[object process]"==e.process.toString()&&e.process.nextTick)return e.process.nextTick;if(e.setImmediate&&-1!=e.setImmediate.toString().indexOf("[native code]")){const t=e.setImmediate;return e=>{t(e)}}if(e.Promise&&-1!=Promise.toString().indexOf("[native code]")){const e=Promise.resolve();return t=>{e.then(()=>{t()})}}let t;return e.addEventListener("message",()=>{if(t){let e=t;t=null;for(let t=0,i=e.length;t<i;t++)try{e[t]()}catch(e){s.error(e)}}}),e=>{t?t.push(e):(t=[e],postMessage("__tic__","*"))}})()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5),r=i(1),n=Object.prototype.hasOwnProperty;let l=!1,o=0,h=[];t.EventEmitter=class{static get currentlySubscribing(){return l}static set currentlySubscribing(e){l=e}static transact(e){o++;try{e()}catch(e){s.error(e)}if(--o)return;let t=h;h=[];for(let e of t)e.target.handleEvent(e)}constructor(){this._events=new r.Map}getEvents(e){let t;return e?(t=this._events.get(e))?Array.isArray(t)?t:[t]:[]:(t={__proto__:null},this._events.forEach((e,i)=>{t[i]=Array.isArray(e)?e:[e]}),t)}on(e,t,i){if("object"==typeof e){i=void 0!==t?t:this;let s=e;for(e in s)n.call(s,e)&&this._on(e,s[e],i)}else this._on(e,t,void 0!==i?i:this);return this}off(e,t,i){if(e)if("object"==typeof e){i=void 0!==t?t:this;let s=e;for(e in s)n.call(s,e)&&this._off(e,s[e],i)}else this._off(e,t,void 0!==i?i:this);else this._events.clear();return this}_on(e,t,i){let s=e.indexOf(":");if(-1!=s){let r=e.slice(s+1);l=!0,(this[r+"Cell"]||(this[r],this[r+"Cell"])).on(e.slice(0,s),t,i),l=!1}else{let s=this._events.get(e),r={listener:t,context:i};s?Array.isArray(s)?s.push(r):this._events.set(e,[s,r]):this._events.set(e,r)}}_off(e,t,i){let s=e.indexOf(":");if(-1!=s){let r=e.slice(s+1);(this[r+"Cell"]||(this[r],this[r+"Cell"])).off(e.slice(0,s),t,i)}else{let s,r=this._events.get(e);if(!r)return;if(Array.isArray(r)){if(1!=r.length){for(let e=r.length;e;)if((s=r[--e]).listener==t&&s.context===i){r.splice(e,1);break}return}s=r[0]}else s=r;s.listener==t&&s.context===i&&this._events.delete(e)}}once(e,t,i){function s(r){return this._off(e,s,i),t.call(this,r)}return void 0===i&&(i=this),this._on(e,s,i),s}emit(e,t){if("string"==typeof e)e={target:this,type:e};else if(e.target){if(e.target!=this)throw new TypeError("Event cannot be emitted on this object")}else e.target=this;if(t&&(e.data=t),o)for(let t=h.length;;){if(!t){(e.data||(e.data={})).prevEvent=null,h.push(e);break}let i=h[--t];if(i.target==this&&i.type==e.type){(e.data||(e.data={})).prevEvent=i,h[t]=e;break}}else this.handleEvent(e);return e}handleEvent(e){let t=this._events.get(e.type);if(t)if(Array.isArray(t)){let i=t.length;if(1==i)!1===this._tryEventListener(t[0],e)&&(e.propagationStopped=!0);else{t=t.slice();for(let s=0;s<i;s++)!1===this._tryEventListener(t[s],e)&&(e.propagationStopped=!0)}}else!1===this._tryEventListener(t,e)&&(e.propagationStopped=!0)}_tryEventListener(e,t){try{return e.listener.call(e.context,t)}catch(e){s.error(e)}}}},function(e,t,i){"use strict";function s(){}Object.defineProperty(t,"__esModule",{value:!0}),t.WaitError=s,s.prototype={__proto__:Error.prototype,constructor:s}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),r=i(2),n=i(7),l=Array.prototype.push,o=Array.prototype.splice,h=(e,t)=>e<t?-1:e>t?1:0;class a extends n.EventEmitter{constructor(e,t){if(super(),this._items=[],t&&(t.sorted||t.comparator&&!1!==t.sorted)?(this._comparator=t.comparator||h,this._sorted=!0):(this._comparator=null,this._sorted=!1),e)if(this._sorted){e instanceof a&&(e=e._items);for(let t=0,i=e.length;t<i;t++)this._insertSortedValue(e[t])}else l.apply(this._items,e instanceof a?e._items:e)}get length(){return this._items.length}_validateIndex(e,t){if(void 0===e)return e;if(e<0){if((e+=this._items.length)<0)throw new RangeError("Index out of valid range")}else if(e>this._items.length-(t?0:1))throw new RangeError("Index out of valid range");return e}contains(e){return-1!=this._items.indexOf(e)}indexOf(e,t){return this._items.indexOf(e,this._validateIndex(t,!0))}lastIndexOf(e,t){return this._items.lastIndexOf(e,void 0===t?-1:this._validateIndex(t,!0))}get(e){return this._items[this._validateIndex(e,!0)]}getRange(e,t){if(e=this._validateIndex(e,!0),void 0===t)return this._items.slice(e);if(e+t>this._items.length)throw new RangeError('Sum of "index" and "count" out of valid range');return this._items.slice(e,e+t)}set(e,t){if(this._sorted)throw new TypeError("Cannot set to sorted list");return e=this._validateIndex(e,!0),s.is(t,this._items[e])||(this._items[e]=t,this.emit("change")),this}setRange(e,t){if(this._sorted)throw new TypeError("Cannot set to sorted list");e=this._validateIndex(e,!0),t instanceof a&&(t=t._items);let i=t.length;if(!i)return this;if(e+i>this._items.length)throw new RangeError('Sum of "index" and "values.length" out of valid range');let r=this._items,n=!1;for(let l=e+i;l>e;){let i=t[--l-e];s.is(i,r[l])||(r[l]=i,n=!0)}return n&&this.emit("change"),this}add(e,t){return t&&-1!=this._items.indexOf(e)?this:(this._sorted?this._insertSortedValue(e):this._items.push(e),this.emit("change"),this)}addRange(e,t){if(e instanceof a&&(e=e._items),e.length)if(t){let t=this._items,i=this._sorted,s=!1;for(let r=0,n=e.length;r<n;r++){let n=e[r];-1==t.indexOf(n)&&(i?this._insertSortedValue(n):t.push(n),s=!0)}s&&this.emit("change")}else{if(this._sorted)for(let t=0,i=e.length;t<i;t++)this._insertSortedValue(e[t]);else l.apply(this._items,e);this.emit("change")}return this}insert(e,t){if(this._sorted)throw new TypeError("Cannot insert to sorted list");return this._items.splice(this._validateIndex(e,!0),0,t),this.emit("change"),this}insertRange(e,t){if(this._sorted)throw new TypeError("Cannot insert to sorted list");return e=this._validateIndex(e,!0),t instanceof a&&(t=t._items),t.length&&(o.apply(this._items,[e,0].concat(t)),this.emit("change")),this}remove(e,t){let i=this._items.indexOf(e,this._validateIndex(t,!0));return-1!=i&&(this._items.splice(i,1),this.emit("change"),!0)}removeAll(e,t){let i=this._validateIndex(t,!0),s=this._items,r=!1;for(;-1!=(i=s.indexOf(e,i));)s.splice(i,1),r=!0;return r&&this.emit("change"),r}removeEach(e,t){t=this._validateIndex(t,!0),e instanceof a&&(e=e._items.slice());let i=this._items,s=!1;for(let r=0,n=e.length;r<n;r++){let n=i.indexOf(e[r],t);-1!=n&&(i.splice(n,1),s=!0)}return s&&this.emit("change"),s}removeAt(e){let t=this._items.splice(this._validateIndex(e),1)[0];return this.emit("change"),t}removeRange(e,t){if(e=this._validateIndex(e,!0),void 0===t){if(!(t=this._items.length-e))return[]}else{if(!t)return[];if(e+t>this._items.length)throw new RangeError('Sum of "index" and "count" out of valid range')}let i=this._items.splice(e,t);return this.emit("change"),i}clear(){return this._items.length&&(this._items.length=0,this.emit("change",{subtype:"clear"})),this}join(e){return this._items.join(e)}find(e,t){let i=this._items;for(let s=0,r=i.length;s<r;s++){let r=i[s];if(e.call(t,r,s,this))return r}}findIndex(e,t){let i=this._items;for(let s=0,r=i.length;s<r;s++)if(e.call(t,i[s],s,this))return s;return-1}clone(e){return new this.constructor(e?this._items.map(e=>e&&e.clone?e.clone(!0):e):this,{comparator:this._comparator||void 0,sorted:this._sorted})}toArray(){return this._items.slice()}toString(){return this._items.join()}_insertSortedValue(e){let t=this._items,i=this._comparator,s=0,r=t.length;for(;s!=r;){let n=s+r>>1;i(e,t[n])<0?r=n:s=n+1}t.splice(s,0,e)}}t.ObservableList=a,["forEach","map","filter","every","some"].forEach(e=>{a.prototype[e]=function(t,i){return this._items[e](function(e,s){return t.call(i,e,s,this)},this)}}),["reduce","reduceRight"].forEach(e=>{a.prototype[e]=function(t,i){let s=this;function r(e,i,r){return t(e,i,r,s)}return arguments.length>=2?this._items[e](r,i):this._items[e](r)}}),[["keys",e=>e],["values",(e,t)=>t],["entries",(e,t)=>[e,t]]].forEach(e=>{let t=e[1];a.prototype[e[0]]=function(){let e=this._items,i=0,s=!1;return{next(){if(!s){if(i<e.length)return{value:t(i,e[i++]),done:!1};s=!0}return{value:void 0,done:!0}}}}}),a.prototype[r.Symbol.iterator]=a.prototype.values},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),r=i(1),n=i(2),l=i(7),o=Object.prototype.hasOwnProperty;class h extends l.EventEmitter{constructor(e){if(super(),this._entries=new r.Map,e){let t=this._entries;if(e instanceof r.Map||e instanceof h)(e instanceof r.Map?e:e._entries).forEach((e,i)=>{t.set(i,e)});else if(Array.isArray(e))for(let i=0,s=e.length;i<s;i++)t.set(e[i][0],e[i][1]);else for(let i in e)o.call(e,i)&&t.set(i,e[i])}}get size(){return this._entries.size}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}set(e,t){let i,r=this._entries,n=r.has(e);return n&&(i=r.get(e),s.is(t,i))?this:(r.set(e,t),this.emit("change",{subtype:n?"update":"add",key:e,prevValue:i,value:t}),this)}delete(e){let t=this._entries;if(t.has(e)){let i=t.get(e);return t.delete(e),this.emit("change",{subtype:"delete",key:e,value:i}),!0}return!1}clear(){return this._entries.size&&(this._entries.clear(),this.emit("change",{subtype:"clear"})),this}forEach(e,t){this._entries.forEach(function(i,s){e.call(t,i,s,this)},this)}keys(){return this._entries.keys()}values(){return this._entries.values()}entries(){return this._entries.entries()}clone(e){let t;return e&&(t=[],this._entries.forEach((e,i)=>{t.push([i,e&&e.clone?e.clone(!0):e])})),new this.constructor(t||this)}}t.ObservableMap=h,h.prototype[n.Symbol.iterator]=h.prototype.entries}])});