"use strict";var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var is_1=require("@riim/is"),map_set_polyfill_1=require("@riim/map-set-polyfill"),mixin_1=require("@riim/mixin"),symbol_polyfill_1=require("@riim/symbol-polyfill"),EventEmitter_1=require("../EventEmitter"),FreezableCollection_1=require("./FreezableCollection"),ObservableMap=function(s){function l(e){var t=s.call(this)||this;if(t._entries=new map_set_polyfill_1.Map,FreezableCollection_1.FreezableCollection.call(t),e){var r=t._entries;if(e instanceof map_set_polyfill_1.Map||e instanceof l)(e instanceof map_set_polyfill_1.Map?e:e._entries).forEach(function(e,t){r.set(t,e)});else if(Array.isArray(e))for(var i=0,n=e.length;i<n;i++)r.set(e[i][0],e[i][1]);else for(var o in e)r.set(o,e[o])}return t}return __extends(l,s),Object.defineProperty(l.prototype,"size",{get:function(){return this._entries.size},enumerable:!0,configurable:!0}),l.prototype.has=function(e){return this._entries.has(e)},l.prototype.get=function(e){return this._entries.get(e)},l.prototype.set=function(e,t){var r,i=this._entries,n=i.has(e);if(n){if(r=i.get(e),is_1.is(t,r))return this;this._throwIfFrozen()}else this._throwIfFrozen();return i.set(e,t),this.emit("change",{subtype:n?"update":"add",key:e,prevValue:r,value:t}),this},l.prototype.delete=function(e){var t=this._entries;if(t.has(e)){this._throwIfFrozen();var r=t.get(e);return t.delete(e),this.emit("change",{subtype:"delete",key:e,value:r}),!0}return!1},l.prototype.clear=function(){return this._entries.size&&(this._throwIfFrozen(),this._entries.clear(),this.emit("change",{subtype:"clear"})),this},l.prototype.forEach=function(r,i){this._entries.forEach(function(e,t){r.call(i,e,t,this)},this)},l.prototype.keys=function(){return this._entries.keys()},l.prototype.values=function(){return this._entries.values()},l.prototype.entries=function(){return this._entries.entries()},l.prototype.clone=function(e){var r;return e&&(r=[],this._entries.forEach(function(e,t){r.push([t,e&&e.clone?e.clone(!0):e])})),new this.constructor(r||this)},l}(EventEmitter_1.EventEmitter);exports.ObservableMap=ObservableMap,mixin_1.mixin(ObservableMap.prototype,FreezableCollection_1.FreezableCollection.prototype,["constructor"]),ObservableMap.prototype[symbol_polyfill_1.Symbol.iterator]=ObservableMap.prototype.entries;