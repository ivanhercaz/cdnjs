!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cellx=e():t.cellx=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(6),n=i(7);var o=i(4);e.EventEmitter=o.EventEmitter;var l=i(7);e.ObservableMap=l.ObservableMap;var h=i(6);e.ObservableList=h.ObservableList;var a=i(1);e.Cell=a.Cell;var c=i(5);e.WaitError=c.WaitError;const u=Object.prototype.hasOwnProperty,_=Array.prototype.slice,d=Function("return this;")();function f(t,e,i){let s=e+"Cell";return Object.defineProperty(t,s,{configurable:!0,enumerable:!1,writable:!0,value:i instanceof r.Cell?i:new r.Cell(i,{context:t})}),Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){return this[s].get()},set(t){this[s].set(t)}}),t}function p(t,e){return Object.keys(e).forEach(i=>{f(t,i,e[i])}),t}e.map=function(t){return new n.ObservableMap(t)},e.list=function(t,e){return new s.ObservableList(t,e)},e.KEY_CELL_MAP=Symbol("cellx[cellMap]"),e.cellx=function t(i,s){s||(s={});let n=i,o=function(i){let l=this;l&&l!=d||(l=o),u.call(l,e.KEY_CELL_MAP)||(l[e.KEY_CELL_MAP]=new Map);let h=l[e.KEY_CELL_MAP].get(o);if(!h){if("dispose"===i&&arguments.length>=2)return;h=new r.Cell(n,{__proto__:s,context:l}),l[e.KEY_CELL_MAP].set(o,h)}switch(arguments.length){case 0:return h.get();case 1:return h.set(i),i}let a=i;switch(a){case"cell":return h;case"bind":return(o=o.bind(l)).constructor=t,o}let c=r.Cell.prototype[a].apply(h,_.call(arguments,1));return c===h?o:c};return o.constructor=t,(s.onChange||s.onError)&&o.call(s.context||d),o},e.defineObservableProperty=f,e.defineObservableProperties=p,e.define=function(t,e,i){return"string"==typeof e?f(t,e,i):p(t,e),t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(3),n=i(4),o=i(5);function l(t,e){t.push(e)}const h=[];let a,c=0,u=null;const _={error:null};let d=0;function f(){for(;c<h.length;c++)h[c]._active&&h[c].actualize();if(h.length=0,c=0,a){let t=a;a=null;for(let e of t)e()}}class p extends n.EventEmitter{constructor(t,e){super(),this._reactions=[],this._error=null,this._lastErrorEvent=null,this._hasSubscribers=!1,this._active=!1,this._currentlyPulling=!1,this._updationId=-1,this.debugKey=e&&e.debugKey,this.context=e&&void 0!==e.context?e.context:this,this._pull="function"==typeof t?t:null,this._get=e&&e.get||null,this._validate=e&&e.validate||null,this._merge=e&&e.merge||null,this._put=e&&e.put||l,this._reap=e&&e.reap||null,this.meta=e&&e.meta||null,this._pull?(this._dependencies=void 0,this._value=void 0,this._state="dirty",this._inited=!1):(this._dependencies=null,this._validate&&this._validate(t,void 0),this._merge&&(t=this._merge(t,void 0)),this._value=t,this._state="actual",this._inited=!0,t instanceof n.EventEmitter&&t.on("change",this._onValueChange,this)),e&&(e.onChange&&this.on("change",e.onChange),e.onError&&this.on("error",e.onError))}static get currentlyPulling(){return!!u}static autorun(t,e){let i;return new p(function(){i||(i=(()=>{this.dispose()})),t.call(e,i)},{onChange(){}}),i}static release(){f()}static afterRelease(t){(a||(a=[])).push(t)}on(t,e,i){return null!==this._dependencies&&this.actualize(),"object"==typeof t?super.on(t,void 0!==e?e:this.context):super.on(t,e,void 0!==i?i:this.context),this._hasSubscribers=!0,this._activate(!0),this}off(t,e,i){return null!==this._dependencies&&this.actualize(),t?"object"==typeof t?super.off(t,void 0!==e?e:this.context):super.off(t,e,void 0!==i?i:this.context):super.off(),!this._hasSubscribers||this._reactions.length||this._events.has("change")||this._events.has("error")||(this._hasSubscribers=!1,this._deactivate(),this._reap&&this._reap.call(this.context)),this}_addReaction(t,e){this._reactions.push(t),this._hasSubscribers=!0,this._activate(e)}_deleteReaction(t){this._reactions.splice(this._reactions.indexOf(t),1),!this._hasSubscribers||this._reactions.length||this._events.has("change")||this._events.has("error")||(this._hasSubscribers=!1,this._deactivate(),this._reap&&this._reap.call(this.context))}_activate(t){if(this._active||!this._pull)return;let e=this._dependencies;if(e){let i=e.length;do{e[--i]._addReaction(this,t)}while(i);t&&(this._state="actual"),this._active=!0}}_deactivate(){if(!this._active)return;let t=this._dependencies,e=t.length;do{t[--e]._deleteReaction(this)}while(e);this._state="dirty",this._active=!1}_onValueChange(t){this._inited=!0,this._updationId=++d;let e=this._reactions;for(let t=0;t<e.length;t++)e[t]._addToRelease(!0);this.handleEvent(t)}_addToRelease(t){this._state=t?"dirty":"check";let e=this._reactions,i=e.length;if(i)do{"actual"==e[--i]._state&&e[i]._addToRelease(!1)}while(i);else 1==h.push(this)&&s.nextTick(f)}actualize(){if("dirty"==this._state)this.pull();else if("check"==this._state){let t=this._dependencies;for(let e=0;;){if(t[e].actualize(),"dirty"==this._state){this.pull();break}if(++e==t.length){this._state="actual";break}}}}get(){if("actual"!=this._state&&this._updationId!=d&&this.actualize(),u&&(u._dependencies?-1==u._dependencies.indexOf(this)&&u._dependencies.push(this):u._dependencies=[this],this._error&&this._error instanceof o.WaitError))throw this._error;return this._get?this._get(this._value):this._value}pull(){if(!this._pull)return!1;if(this._currentlyPulling)throw new TypeError("Circular pulling detected");this._currentlyPulling=!0;let t=this._dependencies;this._dependencies=null;let e,i=u;u=this;try{e=this._pull.length?this._pull.call(this.context,this,this._value):this._pull.call(this.context)}catch(t){_.error=t,e=_}if(u=i,this._currentlyPulling=!1,this._hasSubscribers){let e=this._dependencies,i=0;if(e){let r=e.length;do{let s=e[--r];t&&-1!=t.indexOf(s)||(s._addReaction(this,!1),i++)}while(r)}if(t&&(!e||e.length-i<t.length))for(let i=t.length;i;)i--,e&&-1!=e.indexOf(t[i])||t[i]._deleteReaction(this);e?this._active=!0:(this._state="actual",this._active=!1)}else this._state=this._dependencies?"dirty":"actual";return e===_?this.fail(_.error):this.push(e)}set(t){return this._inited||this.pull(),this._validate&&this._validate(t,this._value),this._merge&&(t=this._merge(t,this._value)),this._put.length>=3?this._put.call(this.context,this,t,this._value):this._put.call(this.context,this,t),this}push(t){this._inited=!0,this._error&&this._setError(null);let e=this._value,i=!Object.is(t,e);if(i&&(this._value=t,e instanceof n.EventEmitter&&e.off("change",this._onValueChange,this),t instanceof n.EventEmitter&&t.on("change",this._onValueChange,this)),this._active&&(this._state="actual"),this._updationId=++d,i){let i=this._reactions;for(let t=0;t<i.length;t++)i[t]._addToRelease(!0);this.emit("change",{prevValue:e,value:t})}return i}fail(t){this._inited=!0;let e=t instanceof o.WaitError;return e||(this.debugKey?r.error("["+this.debugKey+"]",t):r.error(t),t instanceof Error||(t=new Error(String(t)))),this._setError(t),this._active&&(this._state="actual"),e}_setError(t){this._error=t,this._updationId=++d,t&&this._handleErrorEvent({target:this,type:"error",data:{error:t}})}_handleErrorEvent(t){if(this._lastErrorEvent===t)return;this._lastErrorEvent=t,this.handleEvent(t);let e=this._reactions;for(let i=0;i<e.length;i++)e[i]._handleErrorEvent(t)}wait(){throw new o.WaitError}reap(){this.off();let t=this._reactions;for(let e=0;e<t.length;e++)t[e].reap();return this}dispose(){return this.reap()}}e.Cell=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];(console[t]||function(){}).apply(console,"error"==t?e.map(function(t){return t&&"object"==typeof t&&t.stack||t}):e)},s=function(){function t(t){this.handler=t||r}return t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handler.apply(this,["log"].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handler.apply(this,["warn"].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handler.apply(this,["error"].concat(t))},t}();e.Logger=s,e.logger=s.$instance=new s,e.log=e.logger.log.bind(e.logger),e.warn=e.logger.warn.bind(e.logger),e.error=e.logger.error.bind(e.logger)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2);e.nextTick=(()=>{const t=Function("return this;")();if(t.process&&"[object process]"==t.process.toString()&&t.process.nextTick)return t.process.nextTick;if(t.setImmediate&&-1!=t.setImmediate.toString().indexOf("[native code]")){const e=t.setImmediate;return t=>{e(t)}}if(t.Promise&&-1!=Promise.toString().indexOf("[native code]")){const t=Promise.resolve();return e=>{t.then(()=>{e()})}}let e;return t.addEventListener("message",()=>{if(e){let t=e;e=null;for(let e=0,i=t.length;e<i;e++)try{t[e]()}catch(t){r.error(t)}}}),t=>{e?e.push(t):(e=[t],postMessage("__tic__","*"))}})()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=Object.prototype.hasOwnProperty;let n=!1,o=0,l=[];e.EventEmitter=class{static get currentlySubscribing(){return n}static set currentlySubscribing(t){n=t}static transact(t){o++;try{t()}catch(t){r.error(t)}if(--o)return;let e=l;l=[];for(let t of e)t.target.handleEvent(t)}constructor(){this._events=new Map}getEvents(t){if(t){let e=this._events.get(t);return e?Array.isArray(e)?e:[e]:[]}let e={__proto__:null};return this._events.forEach((t,i)=>{e[i]=Array.isArray(t)?t:[t]}),e}on(t,e,i){if("object"==typeof t){i=void 0!==e?e:this;let r=t;for(t in r)s.call(r,t)&&this._on(t,r[t],i)}else this._on(t,e,void 0!==i?i:this);return this}off(t,e,i){if(t)if("object"==typeof t){i=void 0!==e?e:this;let r=t;for(t in r)s.call(r,t)&&this._off(t,r[t],i)}else this._off(t,e,void 0!==i?i:this);else this._events.clear();return this}_on(t,e,i){let r=t.indexOf(":");if(-1!=r){let s=t.slice(r+1);n=!0,(this[s+"Cell"]||(this[s],this[s+"Cell"])).on(t.slice(0,r),e,i),n=!1}else{let r=this._events.get(t),s={listener:e,context:i};r?Array.isArray(r)?r.push(s):this._events.set(t,[r,s]):this._events.set(t,s)}}_off(t,e,i){let r=t.indexOf(":");if(-1!=r){let s=t.slice(r+1);(this[s+"Cell"]||(this[s],this[s+"Cell"])).off(t.slice(0,r),e,i)}else{let r,s=this._events.get(t);if(!s)return;if(Array.isArray(s)){if(1!=s.length){for(let t=s.length;t;)if((r=s[--t]).listener==e&&r.context===i){s.splice(t,1);break}return}r=s[0]}else r=s;r.listener==e&&r.context===i&&this._events.delete(t)}}once(t,e,i){function r(s){return this._off(t,r,i),e.call(this,s)}return void 0===i&&(i=this),this._on(t,r,i),r}emit(t,e){if("string"==typeof t)t={target:this,type:t};else if(t.target){if(t.target!=this)throw new TypeError("Event cannot be emitted on this object")}else t.target=this;if(e&&(t.data=e),o)for(let e=l.length;;){if(!e){(t.data||(t.data={})).prevEvent=null,l.push(t);break}let i=l[--e];if(i.target==this&&i.type==t.type){(t.data||(t.data={})).prevEvent=i,l[e]=t;break}}else this.handleEvent(t);return t}handleEvent(t){let e=this._events.get(t.type);if(e)if(Array.isArray(e))if(1==e.length)!1===this._tryEventListener(e[0],t)&&(t.propagationStopped=!0);else{e=e.slice();for(let i=0;i<e.length;i++)!1===this._tryEventListener(e[i],t)&&(t.propagationStopped=!0)}else!1===this._tryEventListener(e,t)&&(t.propagationStopped=!0)}_tryEventListener(t,e){try{return t.listener.call(t.context,e)}catch(t){r.error(t)}}}},function(t,e,i){"use strict";function r(){}Object.defineProperty(e,"__esModule",{value:!0}),e.WaitError=r,r.prototype={__proto__:Error.prototype,constructor:r}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(4),s=Array.prototype.push,n=Array.prototype.splice,o=(t,e)=>t<e?-1:t>e?1:0;class l extends r.EventEmitter{constructor(t,e){if(super(),this._items=[],e&&(e.sorted||e.comparator&&!1!==e.sorted)?(this._comparator=e.comparator||o,this._sorted=!0):(this._comparator=null,this._sorted=!1),t)if(this._sorted){t instanceof l&&(t=t._items);for(let e=0,i=t.length;e<i;e++)this._insertSortedValue(t[e])}else s.apply(this._items,t instanceof l?t._items:t)}get length(){return this._items.length}_validateIndex(t,e){if(void 0===t)return t;if(t<0){if((t+=this._items.length)<0)throw new RangeError("Index out of valid range")}else if(t>this._items.length-(e?0:1))throw new RangeError("Index out of valid range");return t}contains(t){return-1!=this._items.indexOf(t)}indexOf(t,e){return this._items.indexOf(t,this._validateIndex(e,!0))}lastIndexOf(t,e){return this._items.lastIndexOf(t,void 0===e?-1:this._validateIndex(e,!0))}get(t){return this._items[this._validateIndex(t,!0)]}getRange(t,e){if(t=this._validateIndex(t,!0),void 0===e)return this._items.slice(t);if(t+e>this._items.length)throw new RangeError('Sum of "index" and "count" out of valid range');return this._items.slice(t,t+e)}set(t,e){if(this._sorted)throw new TypeError("Cannot set to sorted list");return t=this._validateIndex(t,!0),Object.is(e,this._items[t])||(this._items[t]=e,this.emit("change")),this}setRange(t,e){if(this._sorted)throw new TypeError("Cannot set to sorted list");t=this._validateIndex(t,!0),e instanceof l&&(e=e._items);let i=e.length;if(!i)return this;if(t+i>this._items.length)throw new RangeError('Sum of "index" and "values.length" out of valid range');let r=this._items,s=!1;for(let n=t+i;n>t;){let i=e[--n-t];Object.is(i,r[n])||(r[n]=i,s=!0)}return s&&this.emit("change"),this}add(t,e){return e&&-1!=this._items.indexOf(t)?this:(this._sorted?this._insertSortedValue(t):this._items.push(t),this.emit("change"),this)}addRange(t,e){if(t instanceof l&&(t=t._items),t.length)if(e){let e=this._items,i=this._sorted,r=!1;for(let s=0,n=t.length;s<n;s++){let n=t[s];-1==e.indexOf(n)&&(i?this._insertSortedValue(n):e.push(n),r=!0)}r&&this.emit("change")}else{if(this._sorted)for(let e=0,i=t.length;e<i;e++)this._insertSortedValue(t[e]);else s.apply(this._items,t);this.emit("change")}return this}insert(t,e){if(this._sorted)throw new TypeError("Cannot insert to sorted list");return this._items.splice(this._validateIndex(t,!0),0,e),this.emit("change"),this}insertRange(t,e){if(this._sorted)throw new TypeError("Cannot insert to sorted list");return t=this._validateIndex(t,!0),e instanceof l&&(e=e._items),e.length&&(n.apply(this._items,[t,0].concat(e)),this.emit("change")),this}remove(t,e){let i=this._items.indexOf(t,this._validateIndex(e,!0));return-1!=i&&(this._items.splice(i,1),this.emit("change"),!0)}removeAll(t,e){let i=this._validateIndex(e,!0),r=this._items,s=!1;for(;-1!=(i=r.indexOf(t,i));)r.splice(i,1),s=!0;return s&&this.emit("change"),s}removeEach(t,e){e=this._validateIndex(e,!0),t instanceof l&&(t=t._items.slice());let i=this._items,r=!1;for(let s=0,n=t.length;s<n;s++){let n=i.indexOf(t[s],e);-1!=n&&(i.splice(n,1),r=!0)}return r&&this.emit("change"),r}removeAt(t){let e=this._items.splice(this._validateIndex(t),1)[0];return this.emit("change"),e}removeRange(t,e){if(t=this._validateIndex(t,!0),void 0===e){if(!(e=this._items.length-t))return[]}else{if(!e)return[];if(t+e>this._items.length)throw new RangeError('Sum of "index" and "count" out of valid range')}let i=this._items.splice(t,e);return this.emit("change"),i}clear(){return this._items.length&&(this._items.length=0,this.emit("change",{subtype:"clear"})),this}join(t){return this._items.join(t)}find(t,e){let i=this._items;for(let r=0,s=i.length;r<s;r++){let s=i[r];if(t.call(e,s,r,this))return s}}findIndex(t,e){let i=this._items;for(let r=0,s=i.length;r<s;r++)if(t.call(e,i[r],r,this))return r;return-1}clone(t){return new this.constructor(t?this._items.map(t=>t&&t.clone?t.clone(!0):t):this,{comparator:this._comparator||void 0,sorted:this._sorted})}toArray(){return this._items.slice()}toString(){return this._items.join()}_insertSortedValue(t){let e=this._items,i=this._comparator,r=0,s=e.length;for(;r!=s;){let n=r+s>>1;i(t,e[n])<0?s=n:r=n+1}e.splice(r,0,t)}}e.ObservableList=l,["forEach","map","filter","every","some"].forEach(t=>{l.prototype[t]=function(e,i){return this._items[t](function(t,r){return e.call(i,t,r,this)},this)}}),["reduce","reduceRight"].forEach(t=>{l.prototype[t]=function(e,i){let r=this;function s(t,i,s){return e(t,i,s,r)}return arguments.length>=2?this._items[t](s,i):this._items[t](s)}}),[["keys",t=>t],["values",(t,e)=>e],["entries",(t,e)=>[t,e]]].forEach(t=>{let e=t[1];l.prototype[t[0]]=function(){let t=this._items,i=0,r=!1;return{next(){if(!r){if(i<t.length)return{value:e(i,t[i++]),done:!1};r=!0}return{value:void 0,done:!0}}}}}),l.prototype[Symbol.iterator]=l.prototype.values},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(4),s=Object.prototype.hasOwnProperty;class n extends r.EventEmitter{constructor(t){if(super(),this._entries=new Map,t){let e=this._entries;if(t instanceof Map||t instanceof n)(t instanceof Map?t:t._entries).forEach((t,i)=>{e.set(i,t)});else if(Array.isArray(t))for(let i=0,r=t.length;i<r;i++)e.set(t[i][0],t[i][1]);else for(let i in t)s.call(t,i)&&e.set(i,t[i])}}get size(){return this._entries.size}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}set(t,e){let i,r=this._entries,s=r.has(t);return s&&(i=r.get(t),Object.is(e,i))?this:(r.set(t,e),this.emit("change",{subtype:s?"update":"add",key:t,prevValue:i,value:e}),this)}delete(t){let e=this._entries;if(e.has(t)){let i=e.get(t);return e.delete(t),this.emit("change",{subtype:"delete",key:t,value:i}),!0}return!1}clear(){return this._entries.size&&(this._entries.clear(),this.emit("change",{subtype:"clear"})),this}forEach(t,e){this._entries.forEach(function(i,r){t.call(e,i,r,this)},this)}keys(){return this._entries.keys()}values(){return this._entries.values()}entries(){return this._entries.entries()}clone(t){let e;return t&&(e=[],this._entries.forEach((t,i)=>{e.push([i,t&&t.clone?t.clone(!0):t])})),new this.constructor(e||this)}}e.ObservableMap=n,n.prototype[Symbol.iterator]=n.prototype.entries}])});