!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).cellx={})}(this,function(e){"use strict";const t=(()=>{const e=Function("return this;")();if(e.process&&"[object process]"==e.process.toString()&&e.process.nextTick)return e.process.nextTick;if(e.setImmediate&&-1!=e.setImmediate.toString().indexOf("[native code]")){const t=e.setImmediate;return e=>{t(e)}}const t=Promise.resolve();return e=>{t.then(e)}})();let i;if("undefined"!=typeof navigator&&navigator.userAgent.includes("Edge")){const e=Object.prototype.hasOwnProperty,t=Symbol("mapId");let r=0;const s={value:void 0};(i=function(e){if(this._entries={__proto__:null},this._objectStamps=null,this._first=null,this._last=null,this.size=0,e)for(let t=0,i=e.length;t<i;t++)this.set(e[t][0],e[t][1])}).prototype={constructor:i,has(e){return!!this._entries[this._getValueStamp(e)]},get(e){return(this._entries[this._getValueStamp(e)]||s).value},set(e,t){let i=this._entries,r=this._getValueStamp(e);if(i[r])i[r].value=t;else{let s=i[r]={key:e,keyStamp:r,value:t,prev:this._last,next:null};this.size++?this._last.next=s:this._first=s,this._last=s}return this},delete(e){let t=this._getValueStamp(e),i=this._entries[t];if(!i)return!1;if(--this.size){let e=i.prev,t=i.next;e?e.next=t:this._first=t,t?t.prev=e:this._last=e}else this._first=null,this._last=null;return delete this._entries[t],this._objectStamps&&delete this._objectStamps[t],!0},clear(){let e=this._entries;for(let t in e)delete e[t];this._objectStamps=null,this._first=null,this._last=null,this.size=0},_getValueStamp(e){switch(typeof e){case"undefined":return"undefined";case"object":if(null===e)return"null";break;case"boolean":return"?"+e;case"number":return"+"+e;case"string":return","+e}return this._getObjectStamp(e)},_getObjectStamp(i){if(!e.call(i,t)){if(!Object.isExtensible(i)){let e,t=this._objectStamps;for(e in t)if(t[e]==i)return e;return e=String(++r),(t||(this._objectStamps={__proto__:null}))[e]=i,e}Object.defineProperty(i,t,{value:String(++r)})}return i[t]}},[["entries",e=>[e.key,e.value]]].forEach(e=>{let t=e[1];i.prototype[e[0]]=function(){let e,i=this._entries,r=!1,s=this;return{next(){if(!r){if(e)do{e=e.next}while(e&&!i[e.keyStamp]);else e=s._first;if(e)return{value:t(e),done:!1};r=!0}return{value:void 0,done:!0}}}}}),i.prototype[Symbol.iterator]=i.prototype.entries}else i=Map;const r={logError:(...e)=>{console.error(...e)}};function s(...e){r.logError(...e)}const n=Object.prototype.hasOwnProperty;let l=!1,o=0,a=[],h=0;class u{constructor(){Object.defineProperty(this,"_events",{enumerable:!0,configurable:!0,writable:!0,value:new i})}static get currentlySubscribing(){return l}static transact(e){o++;try{e()}catch(e){s(e)}if(--o)return;let t=a;a=[];for(let e of t)e.target.handleEvent(e)}static silently(e){h++;try{e()}catch(e){s(e)}h--}getEvents(e){if(e){let t=this._events.get(e);return t?Array.isArray(t)?t:[t]:[]}let t=new i;for(let[e,i]of this._events)t.set(e,Array.isArray(i)?i:[i]);return t}on(e,t,i){if("object"==typeof e){i=void 0!==t?t:this;let r=e;for(e in r)n.call(r,e)&&this._on(e,r[e],i);for(let e of Object.getOwnPropertySymbols(r))this._on(e,r[e],i)}else this._on(e,t,void 0!==i?i:this);return this}off(e,t,i){if(e)if("object"==typeof e){i=void 0!==t?t:this;let r=e;for(e in r)n.call(r,e)&&this._off(e,r[e],i);for(let e of Object.getOwnPropertySymbols(r))this._off(e,r[e],i)}else this._off(e,t,void 0!==i?i:this);else this._events.clear();return this}_on(e,t,i){let r;if("string"==typeof e&&-1!=(r=e.indexOf(":"))){let s=e.slice(r+1);l=!0,(this[s+"Cell"]||(this[s],this[s+"Cell"])).on(e.slice(0,r),t,i),l=!1}else{let r=this._events.get(e),s={listener:t,context:i};r?Array.isArray(r)?r.push(s):this._events.set(e,[r,s]):this._events.set(e,s)}}_off(e,t,i){let r;if("string"==typeof e&&-1!=(r=e.indexOf(":"))){let s=e.slice(r+1);(this[s+"Cell"]||(this[s],this[s+"Cell"])).off(e.slice(0,r),t,i)}else{let r,s=this._events.get(e);if(!s)return;if(Array.isArray(s)){if(1!=s.length){for(let e=s.length;e;)if((r=s[--e]).listener==t&&r.context===i){s.splice(e,1);break}return}r=s[0]}else r=s;r.listener==t&&r.context===i&&this._events.delete(e)}}once(e,t,i){function r(s){return this._off(e,r,i),t.call(this,s)}return void 0===i&&(i=this),this._on(e,r,i),r}emit(e,t){if("object"==typeof e)if(e.target){if(e.target!=this)throw TypeError("Event cannot be emitted on this target")}else e.target=this;else e={target:this,type:e};if(t&&(e.data=t),!h)if(o)for(let t=a.length;;){if(!t){(e.data||(e.data={})).prevEvent=null,a.push(e);break}let i=a[--t];if(i.target==this&&i.type===e.type){(e.data||(e.data={})).prevEvent=i,a[t]=e;break}}else this.handleEvent(e);return e}handleEvent(e){let t=this._events.get(e.type);if(t)if(Array.isArray(t))if(1==t.length)!1===this._tryEventListener(t[0],e)&&(e.propagationStopped=!0);else{t=t.slice();for(let i=0;i<t.length;i++)!1===this._tryEventListener(t[i],e)&&(e.propagationStopped=!0)}else!1===this._tryEventListener(t,e)&&(e.propagationStopped=!0)}_tryEventListener(e,t){try{return e.listener.call(e.context,t)}catch(e){s(e)}}}class c extends Error{}const f=Symbol("listenerWrappers");function _(e,t){e.push(t)}const d=[];let p,b=0,g=null;const v={error:null};let E=0;function m(){for(;b<d.length;){let e=d[b++];e._active&&e.actualize()}if(d.length=0,b=0,p){let e=p;p=null;for(let t of e)t()}}class y extends u{constructor(e,t){super(),Object.defineProperty(this,"debugKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pull",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_get",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_validate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_merge",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_put",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_reap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_dependencies",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_reactions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_error",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_lastErrorEvent",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_inited",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_hasSubscribers",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_active",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_currentlyPulling",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_updationId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),this.debugKey=t&&t.debugKey,this.context=t&&void 0!==t.context?t.context:this,this._pull=t&&t.pull||("function"==typeof e?e:null),this._get=t&&t.get||null,this._validate=t&&t.validate||null,this._merge=t&&t.merge||null,this._put=t&&t.put||_,this._reap=t&&t.reap||null,this.meta=t&&t.meta||null,this._pull?(this._dependencies=void 0,this._value=void 0,this._state="dirty",this._inited=!1):(this._dependencies=null,t&&void 0!==t.value&&(e=t.value),this._validate&&this._validate(e,void 0),this._merge&&(e=this._merge(e,void 0)),this._value=e,this._state="actual",this._inited=!0,e instanceof u&&e.on("change",this._onValueChange,this)),t&&(t.onChange&&this.on("change",t.onChange),t.onError&&this.on(y.EVENT_ERROR,t.onError))}static get currentlyPulling(){return!!g}static autorun(e,t){let i;return new y(function(){i||(i=(()=>{this.dispose()})),e.call(t,i)},{onChange(){}}),i}static release(){m()}static afterRelease(e){(p||(p=[])).push(e)}on(e,t,i){return null!==this._dependencies&&this.actualize(),"object"==typeof e?super.on(e,void 0!==t?t:this.context):super.on(e,t,void 0!==i?i:this.context),this._hasSubscribers=!0,this._activate(!0),this}off(e,t,i){return null!==this._dependencies&&this.actualize(),e?"object"==typeof e?super.off(e,void 0!==t?t:this.context):super.off(e,t,void 0!==i?i:this.context):super.off(),!this._hasSubscribers||this._reactions.length||this._events.has(y.EVENT_CHANGE)||this._events.has(y.EVENT_ERROR)||(this._hasSubscribers=!1,this._deactivate(),this._reap&&this._reap.call(this.context)),this}onChange(e,t){return this.on(y.EVENT_CHANGE,e,void 0!==t?t:this.context)}offChange(e,t){return this.off(y.EVENT_CHANGE,e,void 0!==t?t:this.context)}onError(e,t){return this.on(y.EVENT_ERROR,e,void 0!==t?t:this.context)}offError(e,t){return this.off(y.EVENT_ERROR,e,void 0!==t?t:this.context)}subscribe(e,t){let i=e[f]||(e[f]=new Map);if(i.has(this))return this;function r(t){return e.call(this,t.data.error||null,t)}return i.set(this,r),void 0===t&&(t=this.context),this.on(y.EVENT_CHANGE,r,t).on(y.EVENT_ERROR,r,t)}unsubscribe(e,t){let i=e[f],r=i&&i.get(this);return r?(i.delete(this),void 0===t&&(t=this.context),this.off(y.EVENT_CHANGE,r,t).off(y.EVENT_ERROR,r,t)):this}_addReaction(e,t){this._reactions.push(e),this._hasSubscribers=!0,this._activate(t)}_deleteReaction(e){this._reactions.splice(this._reactions.indexOf(e),1),!this._hasSubscribers||this._reactions.length||this._events.has(y.EVENT_CHANGE)||this._events.has(y.EVENT_ERROR)||(this._hasSubscribers=!1,this._deactivate(),this._reap&&this._reap.call(this.context))}_activate(e){if(this._active||!this._pull)return;let t=this._dependencies;if(t){let i=t.length;do{t[--i]._addReaction(this,e)}while(i);e&&(this._state="actual"),this._active=!0}}_deactivate(){if(!this._active)return;let e=this._dependencies,t=e.length;do{e[--t]._deleteReaction(this)}while(t);this._state="dirty",this._active=!1}_onValueChange(e){this._inited=!0,this._updationId=++E;let t=this._reactions;for(let e=0;e<t.length;e++)t[e]._addToRelease(!0);this.handleEvent(e)}_addToRelease(e){this._state=e?"dirty":"check";let i=this._reactions,r=i.length;if(r)do{"actual"==i[--r]._state&&i[r]._addToRelease(!1)}while(r);else 1==d.push(this)&&t(m)}actualize(){if("dirty"==this._state)this.pull();else if("check"==this._state){let e=this._dependencies;for(let t=0;;){if(e[t].actualize(),"dirty"==this._state){this.pull();break}if(++t==e.length){this._state="actual";break}}}}get value(){return this.get()}set value(e){this.set(e)}get(){if("actual"!=this._state&&this._updationId!=E&&this.actualize(),g&&(g._dependencies?-1==g._dependencies.indexOf(this)&&g._dependencies.push(this):g._dependencies=[this],this._error&&this._error instanceof c))throw this._error;return this._get?this._get(this._value):this._value}pull(){if(!this._pull)return!1;if(this._currentlyPulling)throw TypeError("Circular pulling detected");this._currentlyPulling=!0;let e=this._dependencies;this._dependencies=null;let t,i=g;g=this;try{t=this._pull.length?this._pull.call(this.context,this,this._value):this._pull.call(this.context)}catch(e){v.error=e,t=v}if(g=i,this._currentlyPulling=!1,this._hasSubscribers){let t=this._dependencies,i=0;if(t){let r=t.length;do{let s=t[--r];e&&-1!=e.indexOf(s)||(s._addReaction(this,!1),i++)}while(r)}if(e&&(!t||t.length-i<e.length))for(let i=e.length;i;)i--,t&&-1!=t.indexOf(e[i])||e[i]._deleteReaction(this);t?this._active=!0:(this._state="actual",this._active=!1)}else this._state=this._dependencies?"dirty":"actual";return t===v?this.fail(v.error):this.push(t)}set(e){return this._inited||this.pull(),this._validate&&this._validate(e,this._value),this._merge&&(e=this._merge(e,this._value)),this._put.length>=3?this._put.call(this.context,this,e,this._value):this._put.call(this.context,this,e),this}push(e){this._inited=!0,this._error&&this._setError(null);let t=this._value,i=!Object.is(e,t);if(i&&(this._value=e,t instanceof u&&t.off("change",this._onValueChange,this),e instanceof u&&e.on("change",this._onValueChange,this)),this._active&&(this._state="actual"),this._updationId=++E,i){let i=this._reactions;for(let e=0;e<i.length;e++)i[e]._addToRelease(!0);this.emit(y.EVENT_CHANGE,{prevValue:t,value:e})}return i}fail(e){this._inited=!0;let t=e instanceof c;return t||(this.debugKey?s("["+this.debugKey+"]",e):s(e),e instanceof Error||(e=new Error(String(e)))),this._setError(e),this._active&&(this._state="actual"),t}_setError(e){this._error=e,this._updationId=++E,e&&this._handleErrorEvent({target:this,type:y.EVENT_ERROR,data:{error:e}})}_handleErrorEvent(e){if(this._lastErrorEvent===e)return;this._lastErrorEvent=e,this.handleEvent(e);let t=this._reactions;for(let i=0;i<t.length;i++)t[i]._handleErrorEvent(e)}wait(){throw new c}reap(){this.off();let e=this._reactions;for(let t=0;t<e.length;t++)e[t].reap();return this}dispose(){return this.reap()}}Object.defineProperty(y,"EVENT_CHANGE",{enumerable:!0,configurable:!0,writable:!0,value:"change"}),Object.defineProperty(y,"EVENT_ERROR",{enumerable:!0,configurable:!0,writable:!0,value:"error"});const O=Object.prototype.hasOwnProperty;class x extends u{constructor(e){if(super(),Object.defineProperty(this,"_entries",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),e){let t=this._entries;if(e instanceof Map||e instanceof x)for(let[i,r]of e instanceof Map?e:e._entries)t.set(i,r);else if(Array.isArray(e))for(let i=0,r=e.length;i<r;i++)t.set(e[i][0],e[i][1]);else for(let i in e)O.call(e,i)&&t.set(i,e[i])}}get size(){return this._entries.size}onChange(e,t){return this.on(x.EVENT_CHANGE,e,t)}offChange(e,t){return this.off(x.EVENT_CHANGE,e,t)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}set(e,t){let i,r=this._entries,s=r.has(e);return s&&(i=r.get(e),Object.is(t,i))?this:(r.set(e,t),this.emit(x.EVENT_CHANGE,{subtype:s?"update":"add",key:e,prevValue:i,value:t}),this)}delete(e){let t=this._entries;if(t.has(e)){let i=t.get(e);return t.delete(e),this.emit(x.EVENT_CHANGE,{subtype:"delete",key:e,value:i}),!0}return!1}clear(){return this._entries.size&&(this._entries.clear(),this.emit(x.EVENT_CHANGE,{subtype:"clear"})),this}equals(e){if(!(e instanceof x))return!1;if(this.size!=e.size)return!1;for(let t of this)if(t[1]!==e.get(t[0]))return!1;return!0}forEach(e,t){for(let[i,r]of this._entries)e.call(t,r,i,this)}keys(){return this._entries.keys()}values(){return this._entries.values()}entries(){return this._entries.entries()}clone(e){let t;if(e){t=[];for(let[e,i]of this._entries)t.push([e,i&&"object"==typeof i&&i.clone?i.clone.length?i.clone(!0):i.clone():i])}return new this.constructor(t||this)}absorbFrom(e){if(!(e instanceof x))throw TypeError('"that" must be instance of ObservableMap');let t=this._entries,i=!1;for(let[r,s]of t)if(e.has(r)){let n=e.get(r);s!==n&&(s&&n&&"object"==typeof s&&"object"==typeof n&&s.absorbFrom&&s.absorbFrom===n.absorbFrom?s.absorbFrom(n)&&(i=!0):(t.set(r,n),i=!0))}else t.delete(r),i=!0;for(let[r,s]of e)t.has(r)||(t.set(r,s),i=!0);return i&&this.emit(x.EVENT_CHANGE,{subtype:"absorbFrom"}),i}toData(){let e={};for(let[t,i]of this._entries)e[t]=i&&"object"==typeof i&&i.toData?i.toData():i;return e}}Object.defineProperty(x,"EVENT_CHANGE",{enumerable:!0,configurable:!0,writable:!0,value:"change"}),x.prototype[Symbol.iterator]=x.prototype.entries;const N=Array.prototype.push,j=Array.prototype.splice,w=(e,t)=>e<t?-1:e>t?1:0;class C extends u{constructor(e,t){if(super(),Object.defineProperty(this,"_items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_comparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_sorted",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t&&(t.sorted||t.comparator&&!1!==t.sorted)?(this._comparator=t.comparator||w,this._sorted=!0):(this._comparator=null,this._sorted=!1),e)if(this._sorted){e instanceof C&&(e=e._items);for(let t=0,i=e.length;t<i;t++)this._insertSortedValue(e[t])}else N.apply(this._items,e instanceof C?e._items:e)}get length(){return this._items.length}set length(e){if(this._items.length!=e){if(e>this._items.length)throw RangeError("Length out of valid range");this.emit(C.EVENT_CHANGE),this._items.length=e}}onChange(e,t){return this.on(C.EVENT_CHANGE,e,t)}offChange(e,t){return this.off(C.EVENT_CHANGE,e,t)}_validateIndex(e,t){if(void 0===e)return e;if(e<0){if((e+=this._items.length)<0)throw RangeError("Index out of valid range")}else if(e>this._items.length-(t?0:1))throw RangeError("Index out of valid range");return e}contains(e){return-1!=this._items.indexOf(e)}indexOf(e,t){return this._items.indexOf(e,this._validateIndex(t,!0))}lastIndexOf(e,t){return this._items.lastIndexOf(e,void 0===t?-1:this._validateIndex(t,!0))}get(e){return this._items[this._validateIndex(e,!0)]}getRange(e,t){if(e=this._validateIndex(e,!0),void 0===t)return this._items.slice(e);if(e+t>this._items.length)throw RangeError('Sum of "index" and "count" out of valid range');return this._items.slice(e,e+t)}set(e,t){if(this._sorted)throw TypeError("Cannot set to sorted list");return e=this._validateIndex(e,!0),Object.is(t,this._items[e])||(this._items[e]=t,this.emit(C.EVENT_CHANGE)),this}setRange(e,t){if(this._sorted)throw TypeError("Cannot set to sorted list");e=this._validateIndex(e,!0),t instanceof C&&(t=t._items);let i=t.length;if(!i)return this;let r=this._items;if(e+i>r.length)throw RangeError('Sum of "index" and "values.length" out of valid range');let s=!1;for(let n=e+i;n>e;){let i=t[--n-e];Object.is(i,r[n])||(r[n]=i,s=!0)}return s&&this.emit(C.EVENT_CHANGE),this}add(e,t){return t&&-1!=this._items.indexOf(e)?this:(this._sorted?this._insertSortedValue(e):this._items.push(e),this.emit(C.EVENT_CHANGE),this)}addRange(e,t){if(e instanceof C&&(e=e._items),e.length)if(t){let t=this._items,i=this._sorted,r=!1;for(let s of e)-1==t.indexOf(s)&&(i?this._insertSortedValue(s):t.push(s),r=!0);r&&this.emit(C.EVENT_CHANGE)}else{if(this._sorted)for(let t=0,i=e.length;t<i;t++)this._insertSortedValue(e[t]);else N.apply(this._items,e);this.emit(C.EVENT_CHANGE)}return this}insert(e,t){if(this._sorted)throw TypeError("Cannot insert to sorted list");return this._items.splice(this._validateIndex(e,!0),0,t),this.emit(C.EVENT_CHANGE),this}insertRange(e,t){if(this._sorted)throw TypeError("Cannot insert to sorted list");return e=this._validateIndex(e,!0),t instanceof C&&(t=t._items),t.length&&(j.apply(this._items,[e,0].concat(t)),this.emit(C.EVENT_CHANGE)),this}remove(e,t){let i=this._items.indexOf(e,this._validateIndex(t,!0));return-1!=i&&(this._items.splice(i,1),this.emit(C.EVENT_CHANGE),!0)}removeAll(e,t){let i=this._validateIndex(t,!0),r=this._items,s=!1;for(;-1!=(i=r.indexOf(e,i));)r.splice(i,1),s=!0;return s&&this.emit(C.EVENT_CHANGE),s}removeEach(e,t){t=this._validateIndex(t,!0),e instanceof C&&(e=e._items.slice());let i=this._items,r=!1;for(let s=0,n=e.length;s<n;s++){let n=i.indexOf(e[s],t);-1!=n&&(i.splice(n,1),r=!0)}return r&&this.emit(C.EVENT_CHANGE),r}removeAt(e){let t=this._items.splice(this._validateIndex(e),1)[0];return this.emit(C.EVENT_CHANGE),t}removeRange(e,t){if(e=this._validateIndex(e,!0),void 0===t){if(!(t=this._items.length-e))return[]}else{if(!t)return[];if(e+t>this._items.length)throw RangeError('Sum of "index" and "count" out of valid range')}let i=this._items.splice(e,t);return this.emit(C.EVENT_CHANGE),i}replace(e,t){if(this._sorted)throw TypeError("Cannot replace in sorted list");let i=this._items.indexOf(e);return-1!=i&&(this._items[i]=t,this.emit(C.EVENT_CHANGE),!0)}clear(){return this._items.length&&(this._items.length=0,this.emit(C.EVENT_CHANGE)),this}equals(e){if(!(e instanceof C))return!1;let t=this._items,i=e._items;if(t.length!=i.length)return!1;for(let e=t.length;e;)if(t[--e]!==i[e])return!1;return!0}join(e){return this._items.join(e)}find(e,t){let i=this._items;for(let r=0,s=i.length;r<s;r++){let s=i[r];if(e.call(t,s,r,this))return s}}findIndex(e,t){let i=this._items;for(let r=0,s=i.length;r<s;r++)if(e.call(t,i[r],r,this))return r;return-1}clone(e){return new this.constructor(e?this._items.map(e=>e&&"object"==typeof e&&e.clone?e.clone.length?e.clone(!0):e.clone():e):this,{comparator:this._comparator||void 0,sorted:this._sorted})}absorbFrom(e){if(!(e instanceof C))throw TypeError('"that" must be instance of ObservableList');let t=this._items,i=e._items,r=!1;t.length!=e.length&&(t.length=e.length,r=!0);for(let e=t.length;e;){let s=t[--e],n=i[e];s!==n&&(s&&n&&"object"==typeof s&&"object"==typeof n&&s.absorbFrom&&s.absorbFrom===n.absorbFrom?s.absorbFrom(n)&&(r=!0):(t[e]=n,r=!0))}return r&&this.emit(C.EVENT_CHANGE),r}toArray(){return this._items.slice()}toString(){return this._items.join()}toData(){return this._items.map(e=>e&&"object"==typeof e&&e.toData?e.toData():e)}_insertSortedValue(e){let t=this._items,i=this._comparator,r=0,s=t.length;for(;r!=s;){let n=r+s>>1;i(e,t[n])<0?s=n:r=n+1}t.splice(r,0,e)}}Object.defineProperty(C,"EVENT_CHANGE",{enumerable:!0,configurable:!0,writable:!0,value:"change"}),["forEach","map","filter","every","some"].forEach(e=>{C.prototype[e]=function(t,i){return this._items[e](function(e,r){return t.call(i,e,r,this)},this)}}),["reduce","reduceRight"].forEach(e=>{C.prototype[e]=function(t,i){let r=this;function s(e,i,s){return t(e,i,s,r)}return arguments.length>=2?this._items[e](s,i):this._items[e](s)}}),[["keys",e=>e],["values",(e,t)=>t],["entries",(e,t)=>[e,t]]].forEach(e=>{let t=e[1];C.prototype[e[0]]=function(){let e=this._items,i=0,r=!1;return{next(){if(!r){if(i<e.length)return{value:t(i,e[i++]),done:!1};r=!0}return{value:void 0,done:!0}}}}}),C.prototype[Symbol.iterator]=C.prototype.values;const V={__proto__:Function.prototype,cell:null,on(e,t,i){return this.cell.on(e,t,i)},off(e,t,i){return this.cell.off(e,t,i)},onChange(e,t){return this.cell.onChange(e,t)},offChange(e,t){return this.cell.offChange(e,t)},onError(e,t){return this.cell.onError(e,t)},offError(e,t){return this.cell.offError(e,t)},subscribe(e,t){return this.cell.subscribe(e,t)},unsubscribe(e,t){return this.cell.unsubscribe(e,t)},get value(){return this.cell.value},set value(e){this.cell.value=e},reap(){return this.cell.reap()},dispose(){return this.cell.dispose()}};function T(e,t,i){let r=t+"Cell";return Object.defineProperty(e,r,{configurable:!0,enumerable:!1,writable:!0,value:i instanceof y?i:new y(i,{context:e})}),Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){return this[r].get()},set(e){this[r].set(e)}}),e}function A(e,t){return Object.keys(t).forEach(i=>{T(e,i,t[i])}),e}e.Cell=y,e.EventEmitter=u,e.ObservableList=C,e.ObservableMap=x,e.WaitError=c,e.cellx=function e(t,i){let r=function(e){return arguments.length?(r.cell.set(e),e):r.cell.get()};return Object.setPrototypeOf(r,V),r.constructor=e,r.cell=new y(t,i),r},e.configure=function(e){return Object.assign(r,e),r},e.define=function(e,t,i){return"string"==typeof t?T(e,t,i):A(e,t),e},e.defineObservableProperties=A,e.defineObservableProperty=T,Object.defineProperty(e,"__esModule",{value:!0})});