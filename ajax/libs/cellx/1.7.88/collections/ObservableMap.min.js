"use strict";var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var is_1=require("@riim/is"),map_set_polyfill_1=require("@riim/map-set-polyfill"),mixin_1=require("@riim/mixin"),symbol_polyfill_1=require("@riim/symbol-polyfill"),EventEmitter_1=require("../EventEmitter"),FreezableCollection_1=require("./FreezableCollection"),ObservableCollection_1=require("./ObservableCollection"),ObservableMap=function(l){function a(e,t){var r=l.call(this)||this;if(r._entries=new map_set_polyfill_1.Map,FreezableCollection_1.FreezableCollection.call(r),ObservableCollection_1.ObservableCollection.call(r),"boolean"==typeof t&&(t={adoptsValueChanges:t}),r._adoptsValueChanges=!(!t||!t.adoptsValueChanges),e){var i=r._entries;if(e instanceof map_set_polyfill_1.Map||e instanceof a)(e instanceof map_set_polyfill_1.Map?e:e._entries).forEach(function(e,t){i.set(t,this._registerValue(e))},r);else if(Array.isArray(e))for(var o=0,n=e.length;o<n;o++)i.set(e[o][0],r._registerValue(e[o][1]));else for(var s in e)i.set(s,r._registerValue(e[s]));r._size=i.size}else r._size=0;return r}return __extends(a,l),Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),a.prototype.has=function(e){return this._entries.has(e)},a.prototype.contains=function(e){return this._valueCounts.has(e)},a.prototype.get=function(e){return this._entries.get(e)},a.prototype.set=function(e,t){var r,i=this._entries,o=i.has(e);if(o){if(r=i.get(e),is_1.is(t,r))return this;this._throwIfFrozen(),this._unregisterValue(r)}else this._throwIfFrozen();return i.set(e,this._registerValue(t)),o||this._size++,this.emit("change",{subtype:o?"update":"add",key:e,prevValue:r,value:t}),this},a.prototype.delete=function(e){var t=this._entries;if(!t.has(e))return!1;this._throwIfFrozen();var r=t.get(e);return this._unregisterValue(r),t.delete(e),this._size--,this.emit("change",{subtype:"delete",key:e,value:r}),!0},a.prototype.clear=function(){return this._size&&(this._throwIfFrozen(),this._adoptsValueChanges&&this._valueCounts.forEach(function(e,t){t instanceof EventEmitter_1.EventEmitter&&t.off("change",this._onItemChange,this)},this),this._entries.clear(),this._valueCounts.clear(),this._size=0,this.emit("change",{subtype:"clear"})),this},a.prototype.forEach=function(r,i){this._entries.forEach(function(e,t){r.call(i,e,t,this)},this)},a.prototype.keys=function(){return this._entries.keys()},a.prototype.values=function(){return this._entries.values()},a.prototype.entries=function(){return this._entries.entries()},a.prototype.clone=function(e){var r;return e&&(r=[],this._entries.forEach(function(e,t){r.push([t,e.clone?e.clone():e])})),new this.constructor(r||this,this._adoptsValueChanges)},Object.defineProperty(a.prototype,"frozen",{get:function(){return!1},enumerable:!0,configurable:!0}),a.prototype.freeze=function(){return this},a.prototype.unfreeze=function(){return this},a.prototype._throwIfFrozen=function(e){},Object.defineProperty(a.prototype,"adoptsValueChanges",{get:function(){return!1},enumerable:!0,configurable:!0}),a.prototype._onItemChange=function(e){},a.prototype._registerValue=function(e){},a.prototype._unregisterValue=function(e){},a}(EventEmitter_1.EventEmitter);exports.ObservableMap=ObservableMap,mixin_1.mixin(ObservableMap.prototype,FreezableCollection_1.FreezableCollection.prototype,["constructor"]),mixin_1.mixin(ObservableMap.prototype,ObservableCollection_1.ObservableCollection.prototype,["constructor"]),ObservableMap.prototype[symbol_polyfill_1.Symbol.iterator]=ObservableMap.prototype.entries;