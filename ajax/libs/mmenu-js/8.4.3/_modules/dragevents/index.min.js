import*as support from"./_support";import*as options from"./_defaults";import*as settings from"./_settings";import{percentage2number}from"./_helpers";import{extend}from"../helpers";var DragEvents=function(){function t(t,s,e){this.surface=t,this.area=extend(s,options.area),this.treshold=extend(e,options.treshold),this.surface.mmHasDragEvents||(this.surface.addEventListener(support.touch?"touchstart":"mousedown",this.start.bind(this)),this.surface.addEventListener(support.touch?"touchend":"mouseup",this.stop.bind(this)),this.surface.addEventListener(support.touch?"touchleave":"mouseleave",this.stop.bind(this)),this.surface.addEventListener(support.touch?"touchmove":"mousemove",this.move.bind(this))),this.surface.mmHasDragEvents=!0}return t.prototype.start=function(t){var s=this.surface.clientWidth,e=this.surface.clientHeight,i=percentage2number(this.area.top,e);if(!("number"==typeof i&&t.pageY<i)){var a=percentage2number(this.area.right,s);if(!("number"==typeof a&&(a=s-a,t.pageX>a))){var n=percentage2number(this.area.bottom,e);if(!("number"==typeof n&&(n=e-n,t.pageY>n))){var r=percentage2number(this.area.left,s);"number"==typeof r&&t.pageX<r||(this.startPosition={x:t.pageX,y:t.pageY},this.state=settings.state.watching)}}}},t.prototype.stop=function(t){if(this.state==settings.state.dragging){var s=this._dragDirection(),e=this._eventDetail(s);if(this._dispatchEvents("drag*End",e),Math.abs(this.movement[this.axis])>this.treshold.swipe){var i=this._swipeDirection();e.direction=i,this._dispatchEvents("swipe*",e)}}this.state=settings.state.inactive},t.prototype.move=function(t){switch(this.state){case settings.state.watching:case settings.state.dragging:this.movement={x:t.movementX,y:t.movementY},this.distance={x:t.pageX-this.startPosition.x,y:t.pageY-this.startPosition.y},this.axis=Math.abs(this.distance.x)>Math.abs(this.distance.y)?"x":"y";var s=this._dragDirection(),e=this._eventDetail(s);this.state==settings.state.watching&&Math.abs(this.distance[this.axis])>this.treshold.start&&(this._dispatchEvents("drag*Start",e),this.state=settings.state.dragging),this.state==settings.state.dragging&&this._dispatchEvents("drag*Move",e)}},t.prototype._eventDetail=function(t){var s=this.distance.x,e=this.distance.y;return"x"==this.axis&&(s-=s>0?this.treshold.start:0-this.treshold.start),"y"==this.axis&&(e-=e>0?this.treshold.start:0-this.treshold.start),{axis:this.axis,direction:t,movementX:this.movement.x,movementY:this.movement.y,distanceX:s,distanceY:e}},t.prototype._dispatchEvents=function(t,s){var e=new CustomEvent(t.replace("*",""),{detail:s});this.surface.dispatchEvent(e);var i=new CustomEvent(t.replace("*",this.axis.toUpperCase()),{detail:s});this.surface.dispatchEvent(i);var a=new CustomEvent(t.replace("*",s.direction),{detail:s});this.surface.dispatchEvent(a)},t.prototype._dragDirection=function(){return settings.directionNames[this.axis][this.distance[this.axis]>0?0:1]},t.prototype._swipeDirection=function(){return settings.directionNames[this.axis][this.movement[this.axis]>0?0:1]},t}();export default DragEvents;