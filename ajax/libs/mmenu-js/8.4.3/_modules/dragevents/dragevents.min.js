import*as support from"./_support";import*as options from"./_defaults";import*as settings from"./_settings";import{percentage2number}from"./_helpers";import{extend}from"../helpers";var DragEvents=function(){function t(t,e,s){this.surface=t,this.area=extend(e,options.area),this.treshold=extend(s,options.treshold),this.surface.addEventListener(support.touch?"touchstart":"mousedown",this.start.bind(this)),this.surface.addEventListener(support.touch?"touchend":"mouseup",this.stop.bind(this)),this.surface.addEventListener(support.touch?"touchleave":"mouseleave",this.stop.bind(this)),this.surface.addEventListener(support.touch?"touchmove":"mousemove",this.move.bind(this))}return t.prototype.start=function(t){var e=this.surface.clientWidth,s=this.surface.clientHeight,i=percentage2number(this.area.top,s);if(!("number"==typeof i&&t.pageY<i)){var a=percentage2number(this.area.right,e);if(!("number"==typeof a&&(a=e-a,t.pageX>a))){var n=percentage2number(this.area.bottom,s);if(!("number"==typeof n&&(n=s-n,t.pageY>n))){var r=percentage2number(this.area.left,e);"number"==typeof r&&t.pageX<r||(this.startPosition={x:t.pageX,y:t.pageY},this.state=settings.state.watching)}}}},t.prototype.stop=function(t){if(this.state==settings.state.dragging){var e=this._eventDetail(),s=this._dragDirection();if(this._dispatchEvents("drag*End",e,s),Math.abs(this.movement[this.axis])>this.treshold.swipe){var i=this._swipeDirection();this._dispatchEvents("swipe*",e,i)}}this.state=settings.state.inactive},t.prototype.move=function(t){switch(this.state){case settings.state.watching:case settings.state.dragging:this.movement={x:t.movementX,y:t.movementY},this.distance={x:t.pageX-this.startPosition.x,y:t.pageY-this.startPosition.y},this.axis=Math.abs(this.distance.x)>Math.abs(this.distance.y)?"x":"y";var e=this._eventDetail(),s=this._dragDirection();this.state==settings.state.watching&&Math.abs(this.distance[this.axis])>this.treshold.start&&(this._dispatchEvents("drag*Start",e,s),this.state=settings.state.dragging),this.state==settings.state.dragging&&this._dispatchEvents("drag*Move",e,s)}},t.prototype._eventDetail=function(){return{movementX:this.movement.x,movementY:this.movement.y,distanceX:this.distance.x-("x"==this.axis?this.treshold.start:0),distanceY:this.distance.y-("y"==this.axis?this.treshold.start:0)}},t.prototype._dispatchEvents=function(t,e,s){var i=new CustomEvent(t.replace("*",""),{detail:e});this.surface.dispatchEvent(i);var a=new CustomEvent(t.replace("*",this.axis.toUpperCase()),{detail:e});this.surface.dispatchEvent(a);var n=new CustomEvent(t.replace("*",s),{detail:e});this.surface.dispatchEvent(n)},t.prototype._dragDirection=function(){return settings.directionNames[this.axis][this.distance[this.axis]>0?0:1]},t.prototype._swipeDirection=function(){return settings.directionNames[this.axis][this.movement[this.axis]>0?0:1]},t}();export default DragEvents;