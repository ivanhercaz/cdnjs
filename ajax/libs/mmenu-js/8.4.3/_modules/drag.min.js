import{touch}from"./support";var DragEngine=function(){function t(t,e){this.surface=t,this.area=e,this.surface.addEventListener(touch?"touchstart":"mousedown",this.start.bind(this)),this.surface.addEventListener(touch?"touchend":"mouseup",this.stop.bind(this)),this.surface.addEventListener(touch?"touchleave":"mouseleave",this.stop.bind(this)),this.surface.addEventListener(touch?"touchmove":"mousemove",this.move.bind(this))}return t.prototype.start=function(e){var s=0,i=this.surface.clientWidth,a=this.surface.clientHeight,h=this._getArea(this.area.top,a);"number"==typeof h&&e.pageY>=h&&s++;var n=this._getArea(this.area.right,i);"number"==typeof n&&(n=i-n,e.pageX<=n&&s++);var r=this._getArea(this.area.bottom,a);"number"==typeof r&&(r=a-r,e.pageY<=r&&s++);var o=this._getArea(this.area.left,i);"number"==typeof o&&e.pageX>=o&&s++,4==s&&(this.startPosition={x:e.pageX,y:e.pageY},this.state=t.state.watching)},t.prototype.stop=function(e){if(this.state==t.state.dragging){var s=this._eventDetail(),i=t.directionNames[this.axis][this.distance[this.axis]>0?0:1];if(this._dispatchEvents("drag*End",s,i),Math.abs(this.movement[this.axis])>t.treshold.swipe){var a=t.directionNames[this.axis][this.movement[this.axis]>0?0:1];this._dispatchEvents("swipe*",s,a)}}this.state=t.state.inactive},t.prototype.move=function(e){switch(this.state){case t.state.watching:case t.state.dragging:this.movement={x:e.movementX,y:e.movementY},this.distance={x:e.pageX-this.startPosition.x,y:e.pageY-this.startPosition.y},this.axis=Math.abs(this.distance.x)>Math.abs(this.distance.y)?"x":"y";var s=this._eventDetail(),i=t.directionNames[this.axis][this.movement[this.axis]>0?0:1];this.state==t.state.watching&&Math.abs(this.distance[this.axis])>t.treshold.start&&(this._dispatchEvents("drag*Start",s,i),this.state=t.state.dragging),this.state==t.state.dragging&&this._dispatchEvents("drag*",s,i)}},t.prototype._eventDetail=function(){return{movementX:this.movement.x,movementY:this.movement.y,distanceX:this.distance.x-("x"==this.axis?t.treshold.start:0),distanceY:this.distance.y-("y"==this.axis?t.treshold.start:0)}},t.prototype._dispatchEvents=function(t,e,s){var i=new CustomEvent(t.replace("*",""),{detail:e});this.surface.dispatchEvent(i);var a=new CustomEvent(t.replace("*",this.axis.toUpperCase()),{detail:e});this.surface.dispatchEvent(a);var h=new CustomEvent(t.replace("*",s),{detail:e});this.surface.dispatchEvent(h)},t.prototype._getArea=function(t,e){return"string"==typeof t&&"%"==t.slice(-1)&&(t=e*((t=parseInt(t.slice(0,-1),10))/100)),t},t.directionNames={x:["Right","Left"],y:["Down","Up"]},t.treshold={start:25,swipe:15},t.state={inactive:0,watching:1,dragging:2},t}();export default DragEngine;