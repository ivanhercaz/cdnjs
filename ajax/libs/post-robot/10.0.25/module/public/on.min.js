"use strict";exports.__esModule=!0,exports.on=on,exports.once=once;var _src=require("zalgo-promise/src"),_drivers=require("../drivers"),_conf=require("../conf");function on(e,r,n){if(!e)throw new Error("Expected name");if("function"==typeof r&&(n=r,r={}),!n)throw new Error("Expected handler");(r=r||{}).name=e,r.handler=n||r.handler;const o=r.window,c=r.domain,a={handler:r.handler,handleError:r.errorHandler||(e=>{throw e}),window:o,domain:c||_conf.WILDCARD,name:e},t=(0,_drivers.addRequestListener)({name:e,win:o,domain:c},a);return{cancel(){t.cancel()}}}function once(e,r,n){"function"==typeof(r=r||{})&&(n=r,r={});const o=new _src.ZalgoPromise;let c;return r.errorHandler=(e=>{c.cancel(),o.reject(e)}),c=on(e,r,e=>{if(c.cancel(),o.resolve(e),n)return n(e)}),o.cancel=c.cancel,o}