{"version":3,"sources":["webpack://postRobot/webpack/universalModuleDefinition","webpack://postRobot/webpack/bootstrap","webpack://postRobot/./node_modules/cross-domain-utils/src/util.js","webpack://postRobot/./node_modules/cross-domain-utils/src/constants.js","webpack://postRobot/./node_modules/cross-domain-utils/src/utils.js","webpack://postRobot/./node_modules/cross-domain-utils/src/types.js","webpack://postRobot/./node_modules/cross-domain-utils/src/index.js","webpack://postRobot/./node_modules/zalgo-promise/src/utils.js","webpack://postRobot/./node_modules/zalgo-promise/src/exceptions.js","webpack://postRobot/./node_modules/zalgo-promise/src/flush.js","webpack://postRobot/./node_modules/zalgo-promise/src/promise.js","webpack://postRobot/./node_modules/belter/src/device.js","webpack://postRobot/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://postRobot/./node_modules/cross-domain-safe-weakmap/src/native.js","webpack://postRobot/./node_modules/cross-domain-safe-weakmap/src/util.js","webpack://postRobot/./node_modules/cross-domain-safe-weakmap/src/weakmap.js","webpack://postRobot/./node_modules/belter/src/util.js","webpack://postRobot/./node_modules/belter/src/constants.js","webpack://postRobot/./node_modules/belter/src/dom.js","webpack://postRobot/./node_modules/belter/src/storage.js","webpack://postRobot/./node_modules/belter/src/experiment.js","webpack://postRobot/./node_modules/belter/src/global.js","webpack://postRobot/./node_modules/belter/src/http.js","webpack://postRobot/./node_modules/belter/src/types.js","webpack://postRobot/./node_modules/belter/src/decorators.js","webpack://postRobot/./node_modules/belter/src/css.js","webpack://postRobot/./node_modules/belter/src/test.js","webpack://postRobot/./node_modules/belter/src/index.js","webpack://postRobot/./src/conf/config.js","webpack://postRobot/./src/conf/constants.js","webpack://postRobot/./src/conf/index.js","webpack://postRobot/./src/global.js","webpack://postRobot/./src/lib/hello.js","webpack://postRobot/./src/lib/compat.js","webpack://postRobot/./src/lib/windows.js","webpack://postRobot/./src/lib/index.js","webpack://postRobot/./node_modules/universal-serialize/src/constants.js","webpack://postRobot/./node_modules/universal-serialize/src/common.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/array.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/boolean.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/date.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/error.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/function.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/number.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/object.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/promise.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/regex.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/string.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/null.js","webpack://postRobot/./node_modules/universal-serialize/src/serializers/index.js","webpack://postRobot/./node_modules/universal-serialize/src/serialize.js","webpack://postRobot/./node_modules/universal-serialize/src/deserialize.js","webpack://postRobot/./node_modules/universal-serialize/src/types.js","webpack://postRobot/./node_modules/universal-serialize/src/index.js","webpack://postRobot/./src/bridge/bridge.js","webpack://postRobot/./src/bridge/common.js","webpack://postRobot/./src/bridge/child.js","webpack://postRobot/./src/bridge/parent.js","webpack://postRobot/./src/bridge/setup.js","webpack://postRobot/./src/bridge/index.js","webpack://postRobot/./src/serialize/window.js","webpack://postRobot/./src/serialize/function.js","webpack://postRobot/./src/serialize/promise.js","webpack://postRobot/./src/serialize/serialize.js","webpack://postRobot/./src/serialize/index.js","webpack://postRobot/./src/drivers/send/strategies.js","webpack://postRobot/./src/drivers/send/index.js","webpack://postRobot/./src/drivers/listeners.js","webpack://postRobot/./src/drivers/receive/types.js","webpack://postRobot/./src/drivers/receive/index.js","webpack://postRobot/./src/drivers/index.js","webpack://postRobot/./src/public/on.js","webpack://postRobot/./src/public/send.js","webpack://postRobot/./src/public/index.js","webpack://postRobot/./src/setup.js","webpack://postRobot/./src/types.js","webpack://postRobot/./src/clean.js","webpack://postRobot/./src/index.js"],"names":["isRegex","item","Object","prototype","toString","call","noop","PROTOCOL","MOCK","FILE","ABOUT","WILDCARD","WINDOW_TYPE","IFRAME","POPUP","IE_WIN_ACCESS_ERROR","isFileProtocol","win","window","location","protocol","isAboutProtocol","getParent","parent","err","getOpener","opener","canReadFromWindow","href","getActualDomain","Error","host","getDomain","domain","mockDomain","indexOf","isBlankDomain","isActuallySameDomain","desc","getOwnPropertyDescriptor","enumerable","isSameDomain","assertSameDomain","getParents","result","push","isAncestorParent","child","childParent","getFrames","frames","len","length","i","frame","getAllChildFrames","childFrame","getTop","top","getNextOpener","getUltimateTop","getAllFramesInWindow","getAllWindows","isTop","isFrameWindowClosed","contentWindow","parentNode","doc","ownerDocument","documentElement","contains","safeIndexOf","collection","iframeWindows","iframeFrames","isWindowClosed","allowMock","closed","message","mockclosed","iframeIndex","cleanIframes","splice","linkFrameWindow","getUserAgent","navigator","mockUserAgent","userAgent","getFrameByName","name","winFrames","findChildFrameByName","namedFrame","findFrameByName","isParent","frameParent","isOpener","getAncestor","getAncestors","results","ancestor","isAncestor","actualParent","isPopup","Boolean","isIframe","isFullpage","anyMatch","collection1","collection2","item1","item2","getDistanceFromTop","distance","getNthParent","n","getNthParentFromTop","isSameTopWindow","win1","win2","top1","top2","allFrames1","allFrames2","opener1","opener2","matchDomain","pattern","origin","Array","isArray","match","JSON","stringify","some","subpattern","stringifyDomainPattern","join","getDomainFromUrl","url","split","slice","onCloseWindow","callback","delay","maxtime","Infinity","timeout","check","clearTimeout","setTimeout","cancel","isWindow","obj","Window","self","__cross_domain_utils_window_check__","isBrowser","isCurrentDomain","isMockDomain","normalizeMockUrl","replace","closeWindow","close","getFrameForWindow","frameElement","document","querySelectorAll","TYPES","isPromise","Promise","constructor","then","dispatchedErrors","possiblyUnhandledPromiseHandlers","dispatchPossiblyUnhandledError","promise","__DEBUG__","j","onPossiblyUnhandledException","handler","activeCount","flushPromise","flushActive","resolve","startActive","endActive","awaitActive","Zalgo","ZalgoPromise","resolved","rejected","errorHandled","value","error","handlers","dispatching","stack","isAsync","res","reject","dispatch","asyncReject","chain","firstPromise","secondPromise","onSuccess","onError","catch","undefined","finally","onFinally","try","time","toPromise","TypeError","all","promises","count","prom","hash","keys","map","key","items","method","context","args","apply","flush","isDevice","isWebView","test","isStandAlone","standalone","matchMedia","matches","isFacebookWebView","ua","isFirefoxIOS","isEdgeIOS","isOperaMini","isAndroid","isIos","isGoogleSearchApp","isQQBrowser","isIosWebview","isAndroidWebview","isIE","documentMode","isIECompHeader","mHttp","querySelector","mContent","isElectron","process","versions","electron","isIEIntranet","status","isMacOsCna","supportsPopups","_extends","assign","target","arguments","source","hasOwnProperty","hasNativeWeakMap","WeakMap","freeze","testWeakMap","testKey","testValue","set","get","CrossDomainSafeWeakMap","weakmap","values","Math","random","_cleanupClosedWindows","delete","isSafeToReadWrite","entry","defineProperty","writable","index","has","getOrSet","getter","getFunctionName","fn","__name__","displayName","setFunctionName","base64encode","str","btoa","encodeURIComponent","m","p1","String","fromCharCode","parseInt","Buffer","from","base64decode","atob","decodeURIComponent","c","charCodeAt","uniqueID","chars","randomID","charAt","floor","timeID","Date","toISOString","toLowerCase","getGlobal","global","__GLOBAL__","objectIDs","getObjectID","uid","serializeArgs","subkey","val","memoize","options","cacheMap","memoizedFunction","cache","thisNamespace","cacheTime","now","reset","promiseIdentity","memoizePromise","memoizedPromiseFunction","promisify","promisifiedFunction","inlineMemoize","logic","__inline_memoize_cache__","once","called","onceFunction","hashStr","pow","sqrt","strHashStr","total","abs","regmatch","awaitKey","configurable","stringifyError","level","newErr","stringifyErrorMessage","defaultMessage","domainMatches","hostname","patchMethod","original","patchedMethod","callOriginal","extend","perc","pixels","percentage","round","min","max","regexMap","regexp","regexMapMatcher","svgToBase64","svg","objFilter","filter","identity","regexTokenize","text","token","promiseDebounce","promiseDebounced","localPromise","safeInterval","loop","isInteger","isFloat","serializePrimitive","deserializePrimitive","parseFloat","dotify","prefix","newobj","every","undotify","keyResult","parts","part","isLast","isIndex","eventEmitter","triggered","on","eventName","handlerList","cancelled","listener","trigger","triggerOnce","camelToDasherize","string","g","dasherizeToCamel","toUpperCase","capitalizeFirstLetter","path","def","pathParts","safeTimeout","interval","defineLazyProp","arrayFrom","isObject","isObjectObject","isPlainObject","replaceObject","replacer","fullKey","itemKey","el","copyProp","descriptor","regex","start","RegExp","groups","end","regexAll","isDefined","cycle","debounce","debounceWrapper","weakMapMemoize","weakmapMemoized","arg","weakMapMemoizePromise","weakmapMemoizedPromise","cleanup","tasks","cleaned","register","task","pop","tryCatch","removeFromArray","arr","assertExists","thing","unique","KEY_CODES","ENTER","isDocumentReady","body","readyState","urlEncode","waitForWindowReady","addEventListener","waitForDocumentReady","setInterval","clearInterval","waitForDocumentBody","parseQuery","queryString","params","pair","getQueryParam","search","urlWillRedirectPage","formatQuery","extendQuery","originalQuery","props","extendUrl","query","originalUrl","originalHash","hashString","redirect","hasMetaViewPort","meta","screen","width","isElementVisible","offsetWidth","offsetHeight","getClientRects","enablePerformance","performance","timing","connectEnd","navigationStart","getPageRenderTime","domInteractive","htmlEncode","html","selector","onClick","element","event","keyCode","getScript","scripts","getElementsByTagName","script","src","isLocalStorageEnabled","localStorage","setItem","getItem","removeItem","getBrowserLocales","nav","locales","languages","language","userLanguage","locale","lang","country","appendChild","container","isElement","Element","nodeType","style","getElementSafe","id","getElement","elementReady","PopupOpenError","create","popup","height","left","outerWidth","screenX","outerHeight","screenY","toolbar","menubar","resizable","scrollbars","open","writeToWindow","write","err2","writeElementToWindow","tag","tagName","children","removeChild","setStyle","styleText","styleSheet","cssText","createTextNode","awaitFrameLoadPromises","awaitFrameLoad","awaitFrameWindow","loadedFrame","createElement","class","className","setAttribute","attributes","innerHTML","iframe","allowTransparency","backgroundColor","border","hasAttribute","removeEventListener","bindEvents","eventNames","VENDOR_PREFIXES","setVendorCSS","capitalizedName","ANIMATION_START_EVENTS","ANIMATION_END_EVENTS","animate","clean","hasStarted","startTimeout","endTimeout","startEvent","endEvent","cleanUp","animationName","stopPropagation","STYLE","DISPLAY","NONE","BLOCK","VISIBILITY","VISIBLE","HIDDEN","IMPORTANT","makeElementVisible","setProperty","makeElementInvisible","showElement","hideElement","destroyElement","showAndAnimate","animation","animateAndHide","addClass","classList","add","removeClass","remove","isElementClosed","watchElementForClose","fixScripts","newScript","textContent","replaceChild","onResize","currentWidth","currentHeight","newWidth","newHeight","observer","ResizeObserver","observe","MutationObserver","childList","subtree","characterData","disconnect","getResourceLoadTime","getEntries","entries","duration","DEFAULT_SESSION_STORAGE","getStorage","lifetime","STORAGE_KEY","accessedStorage","getState","localStorageEnabled","storage","rawStorage","parse","getID","getSession","session","__session__","created","guid","getSessionState","state","getSessionID","getBelterExperimentStorage","isEventUnique","loggedBeacons","getThrottlePercentile","throttlePercentiles","THROTTLE_GROUP","TEST","CONTROL","THROTTLE","experiment","sample","logTreatment","logCheckpoint","throttle","group","treatment","started","forced","isEnabled","isDisabled","getTreatment","log","checkpoint","payload","logStart","logComplete","getGlobalNameSpace","version","globalKey","namespace","defValue","HEADERS","CONTENT_TYPE","ACCEPT","headerBuilders","parseHeaders","rawHeaders","trim","line","request","headers","json","data","normalizedHeaders","headerBuilder","builtHeaders","xhr","XMLHttpRequest","xhrLoad","responseHeaders","getAllResponseHeaders","contentType","isJSON","responseBody","responseText","evt","setRequestHeader","ontimeout","xhrTimeout","send","addHeaderBuilder","memoized","isPerc","isPx","toNum","toPx","toCSS","percOf","num","normalizeDimension","dim","wrapPromise","expected","timer","expect","expectWrapper","avoid","avoidWrapper","expectError","expectErrorWrapper","drain","BRIDGE_TIMEOUT","CHILD_WINDOW_TIMEOUT","ACK_TIMEOUT","ACK_TIMEOUT_KNOWN","RES_TIMEOUT","__TEST__","RESPONSE_CYCLE_TIME","MESSAGE_TYPE","REQUEST","RESPONSE","ACK","MESSAGE_ACK","SUCCESS","ERROR","MESSAGE_NAME","METHOD","HELLO","OPEN_TUNNEL","SEND_STRATEGY","POST_MESSAGE","BRIDGE","GLOBAL","BRIDGE_NAME_PREFIX","POSTROBOT_PROXY","SERIALIZATION_TYPE","CROSS_DOMAIN_ZALGO_PROMISE","CROSS_DOMAIN_FUNCTION","CROSS_DOMAIN_WINDOW","__POST_ROBOT__","deleteGlobal","getObj","globalStore","defStore","store","storeKey","defVal","del","WildCard","getWildcard","WINDOW_WILDCARD","windowStore","winStore","getStore","getInstanceID","getHelloPromise","helloPromises","resolveHelloPromise","existingPromise","newPromise","listenForHello","instanceID","sayHello","getWindowInstanceID","initHello","awaitWindowHello","needsGlobalMessagingForBrowser","markWindowKnown","knownWindows","isWindowKnown","TYPE","FUNCTION","PROMISE","REGEX","DATE","ARRAY","OBJECT","STRING","NUMBER","BOOLEAN","NULL","UNDEFINED","isSerializedType","__type__","determineType","serializeType","type","__val__","serializeArray","deserializeArray","serializeBoolean","deserializeBoolean","serializeDate","toJSON","deserializeDate","serializeError","code","deserializeError","serializeFunction","deserializeFunction","serializeNumber","deserializeNumber","serializeObject","deserializeObject","serializePromise","deserializePromise","serializeRegex","deserializeRegex","serializeString","deserializeString","serializeNull","deserializeNull","SERIALIZER","defaultSerializers","serialize","serializers","serializer","DESERIALIZER","defaultDeserializers","deserialize","deserializers","deserializer","cleanTunnelWindows","tunnelWindows","tunnelWindow","addTunnelWindow","canary","sendMessage","setupOpenTunnelToParent","openTunnelToParent","parentWindow","needsBridgeForBrowser","needsBridgeForWin","needsBridgeForDomain","needsBridge","getBridgeName","sanitizedDomain","isBridge","documentBodyReady","registerRemoteWindow","remoteWindowPromises","findRemoteWindow","remoteWinPromise","registerRemoteSendMessage","sendMessageWrapper","remoteWin","remoteDomain","fireAndForget","rejectRemoteSendMessage","sendBridgeMessage","messagingChild","messagingParent","awaitRemoteBridgeForWindow","openTunnelToOpener","receiveMessage","bridge","listenForOpenTunnel","popupWindowsByName","bridgePromise","winDetails","openBridgeFrame","hasBridge","bridges","openBridge","bridgeFrames","linkWindow","popupWindowsByWin","winName","details","linkUrl","listenForWindowOpen","windowOpen","windowOpenWrapper","last","destroyBridges","setupBridge","cleanupProxyWindows","idToProxyWindow","shouldClean","getSerializedWindow","winPromise","windowName","getType","getName","focus","isClosed","setLocation","setName","sameDomain","ProxyWindow","serializedWindow","isProxyWindow","actualWindow","actualWindowPromise","setWindow","isPopupPromise","getNamePromise","reopenPromise","focusPromise","getWindow","awaitWindow","matchWindow","proxyInstanceID","knownWindowInstanceID","unwrap","toProxyWindow","serializeWindow","destination","deserializeWindow","addMethod","methodStore","proxyWindowMethods","methods","lookupMethod","listenForFunctionCalls","meth","methodSource","__id__","getDeserializedFunction","opts","crossDomainFunctionWrapper","originalStack","__origin__","__source__","serializeMessage","deserializeMessage","serializedPromise","serializedFunction","SEND_MESSAGE_STRATEGIES","serializedMessage","domains","dom","forEach","postMessage","foreignGlobal","strategies","errors","strategyName","resetListeners","responseListeners","erroredResponseListeners","__DOMAIN_REGEX__","addResponseListener","getResponseListener","deleteResponseListener","cancelResponseListeners","markResponseListenerErrored","isResponseListenerErrored","getRequestListener","requestListeners","winQualifier","nameListeners","domainListeners","addRequestListener","listenersCollection","cancelListener","existingListener","strDomain","regexListeners","regexListener","RECEIVE_MESSAGE_TYPES","logName","sendResponse","ack","response","pathname","handleError","parseMessage","parsedMessage","receivedMessages","setupGlobalReceiveMessage","messageListener","sourceElement","originalEvent","listenForMessages","stopListenForMessages","listenerOptions","errorHandler","requestListener","validateOptions","normalizeDomain","targetDomain","actualDomain","normalizedDomain","responseTimeout","childTimeout","responseListener","reqPromises","totalAckTimeout","totalResTimeout","ackTimeout","resTimeout","internalSerializeMessage","internalDeserializeMessage","createProxyWindow","setup","initialized","destroy","cleanUpWindow","requestPromises"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;AChFO,SAASA,OAAT,CAAiBC,IAAjB,EAAyC;AAC5C,SAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,IAA/B,MAAyC,iBAAhD;AACH,C,CAED;;AACO,SAASK,IAAT,GAAsC,CACzC;AACH,C;;ACPM,IAAMC,QAAQ,GAAG;AACpBC,MAAI,EAAI,OADY;AAEpBC,MAAI,EAAI,OAFY;AAGpBC,OAAK,EAAG;AAHY,CAAjB;AAMA,IAAMC,QAAQ,GAAG,GAAjB;AAEA,IAAMC,WAAW,GAAG;AACvBC,QAAM,EAAG,QADc;AAEvBC,OAAK,EAAI;AAFc,CAApB,C;;ACTP;AAEA;AAEA;AAEA,IAAIC,mBAAmB,GAAG,kCAA1B;AAEO,SAASC,cAAT,CAAwBC,GAAxB,EAAuE;AAAA,MAA/CA,GAA+C;AAA/CA,OAA+C,GAAlBC,MAAkB;AAAA;;AAC1E,SAAOD,GAAG,CAACE,QAAJ,CAAaC,QAAb,KAA0Bb,QAAQ,CAACE,IAA1C;AACH;AAEM,SAASY,eAAT,CAAyBJ,GAAzB,EAAwE;AAAA,MAA/CA,GAA+C;AAA/CA,OAA+C,GAAlBC,MAAkB;AAAA;;AAC3E,SAAOD,GAAG,CAACE,QAAJ,CAAaC,QAAb,KAA0Bb,QAAQ,CAACG,KAA1C;AACH;AAEM,SAASY,SAAT,CAAmBL,GAAnB,EAAmF;AAAA,MAAhEA,GAAgE;AAAhEA,OAAgE,GAAjCC,MAAiC;AAAA;;AAEtF,MAAI,CAACD,GAAL,EAAU;AACN;AACH;;AAED,MAAI;AACA,QAAIA,GAAG,CAACM,MAAJ,IAAcN,GAAG,CAACM,MAAJ,KAAeN,GAAjC,EAAsC;AAClC,aAAOA,GAAG,CAACM,MAAX;AACH;AACJ,GAJD,CAIE,OAAOC,GAAP,EAAY,CACV;AACH;AACJ;AAEM,SAASC,SAAT,CAAmBR,GAAnB,EAAmF;AAAA,MAAhEA,GAAgE;AAAhEA,OAAgE,GAAjCC,MAAiC;AAAA;;AAEtF,MAAI,CAACD,GAAL,EAAU;AACN;AACH,GAJqF,CAMtF;;;AACA,MAAIK,SAAS,CAACL,GAAD,CAAb,EAAoB;AAChB;AACH;;AAED,MAAI;AACA,WAAOA,GAAG,CAACS,MAAX;AACH,GAFD,CAEE,OAAOF,GAAP,EAAY,CACV;AACH;AACJ;AAEM,SAASG,iBAAT,CAA2BV,GAA3B,EAAyF;AAC5F,MAAI;AACA;AACAX,QAAI,CAACW,GAAG,IAAIA,GAAG,CAACE,QAAX,IAAuBF,GAAG,CAACE,QAAJ,CAAaS,IAArC,CAAJ;AACA,WAAO,IAAP;AACH,GAJD,CAIE,OAAOJ,GAAP,EAAY,CACV;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASK,eAAT,CAAyBZ,GAAzB,EAAwE;AAAA,MAA/CA,GAA+C;AAA/CA,OAA+C,GAAjBC,MAAiB;AAAA;;AAE3E,MAAIC,QAAQ,GAAGF,GAAG,CAACE,QAAnB;;AAEA,MAAI,CAACA,QAAL,EAAe;AACX,UAAM,IAAIW,KAAJ,gCAAN;AACH;;AAED,MAAIV,QAAQ,GAAGD,QAAQ,CAACC,QAAxB;;AAEA,MAAI,CAACA,QAAL,EAAe;AACX,UAAM,IAAIU,KAAJ,gCAAN;AACH;;AAED,MAAIV,QAAQ,KAAKb,QAAQ,CAACE,IAA1B,EAAgC;AAC5B,WAAWF,QAAQ,CAACE,IAApB;AACH;;AAED,MAAIW,QAAQ,KAAKb,QAAQ,CAACG,KAA1B,EAAiC;AAE7B,QAAIa,MAAM,GAAGD,SAAS,CAACL,GAAD,CAAtB;;AACA,QAAIM,MAAM,IAAII,iBAAiB,CAACJ,MAAD,CAA/B,EAAyC;AACrC;AACA,aAAOM,eAAe,CAACN,MAAD,CAAtB;AACH;;AAED,WAAWhB,QAAQ,CAACG,KAApB;AACH;;AAED,MAAIqB,IAAI,GAAGZ,QAAQ,CAACY,IAApB;;AAEA,MAAI,CAACA,IAAL,EAAW;AACP,UAAM,IAAID,KAAJ,4BAAN;AACH;;AAED,SAAWV,QAAX,UAA0BW,IAA1B;AACH;AAEM,SAASC,SAAT,CAAmBf,GAAnB,EAAkE;AAAA,MAA/CA,GAA+C;AAA/CA,OAA+C,GAAjBC,MAAiB;AAAA;;AAErE,MAAIe,MAAM,GAAGJ,eAAe,CAACZ,GAAD,CAA5B;;AAEA,MAAIgB,MAAM,IAAIhB,GAAG,CAACiB,UAAd,IAA4BjB,GAAG,CAACiB,UAAJ,CAAeC,OAAf,CAAuB5B,QAAQ,CAACC,IAAhC,MAA0C,CAA1E,EAA6E;AACzE,WAAOS,GAAG,CAACiB,UAAX;AACH;;AAED,SAAOD,MAAP;AACH;AAEM,SAASG,aAAT,CAAuBnB,GAAvB,EAA8D;AACjE,MAAI;AACA;AACA,QAAI,CAACA,GAAG,CAACE,QAAJ,CAAaS,IAAlB,EAAwB;AACpB,aAAO,IAAP;AACH;;AAED,QAAIX,GAAG,CAACE,QAAJ,CAAaS,IAAb,KAAsB,aAA1B,EAAyC;AACrC,aAAO,IAAP;AACH;AACJ,GATD,CASE,OAAOJ,GAAP,EAAY,CACV;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASa,oBAAT,CAA8BpB,GAA9B,EAAqE;AAExE,MAAI;AACA,QAAIA,GAAG,KAAKC,MAAZ,EAAoB;AAChB,aAAO,IAAP;AACH;AAEJ,GALD,CAKE,OAAOM,GAAP,EAAY,CACV;AACH;;AAED,MAAI;AACA,QAAIc,IAAI,GAAGpC,MAAM,CAACqC,wBAAP,CAAgCtB,GAAhC,EAAqC,UAArC,CAAX;;AAEA,QAAIqB,IAAI,IAAIA,IAAI,CAACE,UAAL,KAAoB,KAAhC,EAAuC;AACnC,aAAO,KAAP;AACH;AAEJ,GAPD,CAOE,OAAOhB,GAAP,EAAY,CACV;AACH;;AAED,MAAI;AACA;AACA,QAAIH,eAAe,CAACJ,GAAD,CAAf,IAAwBU,iBAAiB,CAACV,GAAD,CAA7C,EAAoD;AAChD,aAAO,IAAP;AACH;AACJ,GALD,CAKE,OAAOO,GAAP,EAAY,CACV;AACH;;AAED,MAAI;AACA;AACA,QAAIK,eAAe,CAACZ,GAAD,CAAf,KAAyBY,eAAe,CAACX,MAAD,CAA5C,EAAsD;AAClD,aAAO,IAAP;AACH;AAEJ,GAND,CAME,OAAOM,GAAP,EAAY,CACV;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASiB,YAAT,CAAsBxB,GAAtB,EAAoF;AAEvF,MAAI,CAACoB,oBAAoB,CAACpB,GAAD,CAAzB,EAAgC;AAC5B,WAAO,KAAP;AACH;;AAED,MAAI;AAEA,QAAIA,GAAG,KAAKC,MAAZ,EAAoB;AAChB,aAAO,IAAP;AACH,KAJD,CAMA;;;AACA,QAAIG,eAAe,CAACJ,GAAD,CAAf,IAAwBU,iBAAiB,CAACV,GAAD,CAA7C,EAAoD;AAChD,aAAO,IAAP;AACH,KATD,CAWA;;;AACA,QAAIe,SAAS,CAACd,MAAD,CAAT,KAAsBc,SAAS,CAACf,GAAD,CAAnC,EAA0C;AACtC,aAAO,IAAP;AACH;AAEJ,GAhBD,CAgBE,OAAOO,GAAP,EAAY,CACV;AACH;;AAED,SAAO,KAAP;AACH;AAGM,SAASkB,gBAAT,CAA0BzB,GAA1B,EAAqG;AACxG,MAAI,CAACwB,YAAY,CAACxB,GAAD,CAAjB,EAAwB;AACpB,UAAM,IAAIa,KAAJ,qCAAN;AACH,GAHuG,CAKxG;;;AACA,SAAOb,GAAP;AACH;AAEM,SAAS0B,UAAT,CAAoB1B,GAApB,EAAgF;AAEnF,MAAI2B,MAAM,GAAG,EAAb;;AAEA,MAAI;AAEA,WAAO3B,GAAG,CAACM,MAAJ,KAAeN,GAAtB,EAA2B;AACvB2B,YAAM,CAACC,IAAP,CAAY5B,GAAG,CAACM,MAAhB;AACAN,SAAG,GAAGA,GAAG,CAACM,MAAV;AACH;AAEJ,GAPD,CAOE,OAAOC,GAAP,EAAY,CACV;AACH;;AAED,SAAOoB,MAAP;AACH;AAEM,SAASE,gBAAT,CAA0BvB,MAA1B,EAA0DwB,KAA1D,EAAmG;AAEtG,MAAI,CAACxB,MAAD,IAAW,CAACwB,KAAhB,EAAuB;AACnB,WAAO,KAAP;AACH;;AAED,MAAIC,WAAW,GAAG1B,SAAS,CAACyB,KAAD,CAA3B;;AAEA,MAAIC,WAAJ,EAAiB;AACb,WAAOA,WAAW,KAAKzB,MAAvB;AACH;;AAED,MAAIoB,UAAU,CAACI,KAAD,CAAV,CAAkBZ,OAAlB,CAA0BZ,MAA1B,MAAsC,CAAC,CAA3C,EAA8C;AAC1C,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAAS0B,SAAT,CAAmBhC,GAAnB,EAA+E;AAElF,MAAI2B,MAAM,GAAG,EAAb;AAEA,MAAIM,MAAJ;;AAEA,MAAI;AACAA,UAAM,GAAGjC,GAAG,CAACiC,MAAb;AACH,GAFD,CAEE,OAAO1B,GAAP,EAAY;AACV0B,UAAM,GAAGjC,GAAT;AACH;;AAED,MAAIkC,GAAJ;;AAEA,MAAI;AACAA,OAAG,GAAGD,MAAM,CAACE,MAAb;AACH,GAFD,CAEE,OAAO5B,GAAP,EAAY,CACV;AACH;;AAED,MAAI2B,GAAG,KAAK,CAAZ,EAAe;AACX,WAAOP,MAAP;AACH;;AAED,MAAIO,GAAJ,EAAS;AACL,SAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,GAApB,EAAyBE,CAAC,EAA1B,EAA8B;AAE1B,UAAIC,KAAK,SAAT;;AAEA,UAAI;AACAA,aAAK,GAAGJ,MAAM,CAACG,CAAD,CAAd;AACH,OAFD,CAEE,OAAO7B,GAAP,EAAY;AACV;AACH;;AAEDoB,YAAM,CAACC,IAAP,CAAYS,KAAZ;AACH;;AAED,WAAOV,MAAP;AACH;;AAED,OAAK,IAAIS,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,GAApB,EAAyBA,EAAC,EAA1B,EAA8B;AAC1B,QAAIC,MAAK,SAAT;;AAEA,QAAI;AACAA,YAAK,GAAGJ,MAAM,CAACG,EAAD,CAAd;AACH,KAFD,CAEE,OAAO7B,GAAP,EAAY;AACV,aAAOoB,MAAP;AACH;;AAED,QAAI,CAACU,MAAL,EAAY;AACR,aAAOV,MAAP;AACH;;AAEDA,UAAM,CAACC,IAAP,CAAYS,MAAZ;AACH;;AAED,SAAOV,MAAP;AACH;AAGM,SAASW,iBAAT,CAA2BtC,GAA3B,EAAuF;AAE1F,MAAI2B,MAAM,GAAG,EAAb;;AAF0F,kCAIxEK,SAAS,CAAChC,GAAD,CAJ+D,mCAIxD;AAA7B,QAAIqC,KAAK,mBAAT;AACDV,UAAM,CAACC,IAAP,CAAYS,KAAZ;;AAD8B,4CAGPC,iBAAiB,CAACD,KAAD,CAHV,2CAGmB;AAA5C,UAAIE,UAAU,2BAAd;AACDZ,YAAM,CAACC,IAAP,CAAYW,UAAZ;AACH;AACJ;;AAED,SAAOZ,MAAP;AACH;AAEM,SAASa,MAAT,CAAgBxC,GAAhB,EAAgF;AAAA,MAAhEA,GAAgE;AAAhEA,OAAgE,GAAjCC,MAAiC;AAAA;;AAEnF,MAAI;AACA,QAAID,GAAG,CAACyC,GAAR,EAAa;AACT,aAAOzC,GAAG,CAACyC,GAAX;AACH;AACJ,GAJD,CAIE,OAAOlC,GAAP,EAAY,CACV;AACH;;AAED,MAAIF,SAAS,CAACL,GAAD,CAAT,KAAmBA,GAAvB,EAA4B;AACxB,WAAOA,GAAP;AACH;;AAED,MAAI;AACA,QAAI6B,gBAAgB,CAAC5B,MAAD,EAASD,GAAT,CAAhB,IAAiCC,MAAM,CAACwC,GAA5C,EAAiD;AAC7C,aAAOxC,MAAM,CAACwC,GAAd;AACH;AACJ,GAJD,CAIE,OAAOlC,GAAP,EAAY,CACV;AACH;;AAED,MAAI;AACA,QAAIsB,gBAAgB,CAAC7B,GAAD,EAAMC,MAAN,CAAhB,IAAiCA,MAAM,CAACwC,GAA5C,EAAiD;AAC7C,aAAOxC,MAAM,CAACwC,GAAd;AACH;AACJ,GAJD,CAIE,OAAOlC,GAAP,EAAY,CACV;AACH;;AA5BkF,0CA8BjE+B,iBAAiB,CAACtC,GAAD,CA9BgD,2CA8BzC;AAArC,QAAIqC,KAAK,2BAAT;;AACD,QAAI;AACA,UAAIA,KAAK,CAACI,GAAV,EAAe;AACX,eAAOJ,KAAK,CAACI,GAAb;AACH;AACJ,KAJD,CAIE,OAAOlC,GAAP,EAAY,CACV;AACH;;AAED,QAAIF,SAAS,CAACgC,KAAD,CAAT,KAAqBA,KAAzB,EAAgC;AAC5B,aAAOA,KAAP;AACH;AACJ;AACJ;AAEM,SAASK,aAAT,CAAuB1C,GAAvB,EAAuF;AAAA,MAAhEA,GAAgE;AAAhEA,OAAgE,GAAjCC,MAAiC;AAAA;;AAC1F,SAAOO,SAAS,CAACgC,MAAM,CAACxC,GAAD,CAAN,IAAeA,GAAhB,CAAhB;AACH;AAEM,SAAS2C,cAAT,CAAwB3C,GAAxB,EAAuF;AAAA,MAA/DA,GAA+D;AAA/DA,OAA+D,GAAhCC,MAAgC;AAAA;;AAC1F,MAAIQ,MAAM,GAAGiC,aAAa,CAAC1C,GAAD,CAA1B;;AAEA,MAAIS,MAAJ,EAAY;AACR,WAAOkC,cAAc,CAAClC,MAAD,CAArB;AACH;;AAED,SAAOgC,GAAP;AACH;AAEM,SAASG,oBAAT,CAA8B5C,GAA9B,EAA0F;AAC7F,MAAIyC,GAAG,GAAGD,MAAM,CAACxC,GAAD,CAAhB;;AAEA,MAAI,CAACyC,GAAL,EAAU;AACN,UAAM,IAAI5B,KAAJ,gCAAN;AACH;;AAED,mBAAYyB,iBAAiB,CAACG,GAAD,CAA7B,GAAoCA,GAApC;AACH;AAEM,SAASI,aAAT,CAAuB7C,GAAvB,EAAsG;AAAA,MAA/EA,GAA+E;AAA/EA,OAA+E,GAAhDC,MAAgD;AAAA;;AACzG,MAAIgC,MAAM,GAAGW,oBAAoB,CAAC5C,GAAD,CAAjC;AACA,MAAIS,MAAM,GAAGiC,aAAa,CAAC1C,GAAD,CAA1B;;AAEA,MAAIS,MAAJ,EAAY;AACR,qBAAYoC,aAAa,CAACpC,MAAD,CAAzB,EAAsCwB,MAAtC;AACH,GAFD,MAEO;AACH,WAAOA,MAAP;AACH;AACJ;AAEM,SAASa,KAAT,CAAe9C,GAAf,EAAsD;AACzD,SAAOA,GAAG,KAAKwC,MAAM,CAACxC,GAAD,CAArB;AACH;AAEM,SAAS+C,mBAAT,CAA6BV,KAA7B,EAAkE;AAErE,MAAI,CAACA,KAAK,CAACW,aAAX,EAA0B;AACtB,WAAO,IAAP;AACH;;AAED,MAAI,CAACX,KAAK,CAACY,UAAX,EAAuB;AACnB,WAAO,IAAP;AACH;;AAED,MAAIC,GAAG,GAAGb,KAAK,CAACc,aAAhB;;AAEA,MAAID,GAAG,IAAIA,GAAG,CAACE,eAAX,IAA8B,CAACF,GAAG,CAACE,eAAJ,CAAoBC,QAApB,CAA6BhB,KAA7B,CAAnC,EAAwE;AACpE,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;;AAED,SAASiB,WAAT,CAAwBC,UAAxB,EAA+CvE,IAA/C,EAAkE;AAC9D,OAAK,IAAIoD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmB,UAAU,CAACpB,MAA/B,EAAuCC,CAAC,EAAxC,EAA4C;AAExC,QAAI;AACA,UAAImB,UAAU,CAACnB,CAAD,CAAV,KAAkBpD,IAAtB,EAA4B;AACxB,eAAOoD,CAAP;AACH;AACJ,KAJD,CAIE,OAAO7B,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAO,CAAC,CAAR;AACH;;AAED,IAAIiD,aAAa,GAAG,EAApB;AACA,IAAIC,YAAY,GAAG,EAAnB;AAEO,SAASC,cAAT,CAAwB1D,GAAxB,EAAqD2D,SAArD,EAA2F;AAAA,MAAtCA,SAAsC;AAAtCA,aAAsC,GAAhB,IAAgB;AAAA;;AAE9F,MAAI;AACA,QAAI3D,GAAG,KAAKC,MAAZ,EAAoB;AAChB,aAAO,KAAP;AACH;AACJ,GAJD,CAIE,OAAOM,GAAP,EAAY;AACV,WAAO,IAAP;AACH;;AAED,MAAI;AACA,QAAI,CAACP,GAAL,EAAU;AACN,aAAO,IAAP;AACH;AAEJ,GALD,CAKE,OAAOO,GAAP,EAAY;AACV,WAAO,IAAP;AACH;;AAED,MAAI;AACA,QAAIP,GAAG,CAAC4D,MAAR,EAAgB;AACZ,aAAO,IAAP;AACH;AAEJ,GALD,CAKE,OAAOrD,GAAP,EAAY;AAEV;AAEA,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,KAAP;AACH;;AAED,WAAO,IAAP;AACH;;AAGD,MAAI6D,SAAS,IAAInC,YAAY,CAACxB,GAAD,CAA7B,EAAoC;AAChC,QAAI;AACA;AACA,UAAIA,GAAG,CAAC8D,UAAR,EAAoB;AAChB,eAAO,IAAP;AACH;AACJ,KALD,CAKE,OAAOvD,GAAP,EAAY,CACV;AACH;AACJ,GA7C6F,CA+C9F;;;AAEA,MAAI;AACA,QAAI,CAACP,GAAG,CAACM,MAAL,IAAe,CAACN,GAAG,CAACyC,GAAxB,EAA6B;AACzB,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOlC,GAAP,EAAY,CAEb,CAFC,CACE;AAGJ;AACA;;;AAEA,MAAI;AACAlB,QAAI,CAACW,GAAG,KAAKA,GAAT,CAAJ,CADA,CACmB;AACtB,GAFD,CAEE,OAAOO,GAAP,EAAY;AACV,WAAO,IAAP;AACH,GAhE6F,CAkE9F;;;AAEA,MAAIwD,WAAW,GAAGT,WAAW,CAACE,aAAD,EAAgBxD,GAAhB,CAA7B;;AAEA,MAAI+D,WAAW,KAAK,CAAC,CAArB,EAAwB;AACpB,QAAI1B,KAAK,GAAGoB,YAAY,CAACM,WAAD,CAAxB;;AAEA,QAAI1B,KAAK,IAAIU,mBAAmB,CAACV,KAAD,CAAhC,EAAyC;AACrC,aAAO,IAAP;AACH;AACJ;;AAED,SAAO,KAAP;AACH;;AAED,SAAS2B,YAAT,GAAwB;AACpB,OAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoB,aAAa,CAACrB,MAAlC,EAA0CC,CAAC,EAA3C,EAA+C;AAC3C,QAAIwB,MAAM,GAAG,KAAb;;AAEA,QAAI;AACAA,YAAM,GAAGJ,aAAa,CAACpB,CAAD,CAAb,CAAiBwB,MAA1B;AACH,KAFD,CAEE,OAAOrD,GAAP,EAAY,CACV;AACH;;AAED,QAAIqD,MAAJ,EAAY;AACRH,kBAAY,CAACQ,MAAb,CAAoB7B,CAApB,EAAuB,CAAvB;AACAoB,mBAAa,CAACS,MAAd,CAAqB7B,CAArB,EAAwB,CAAxB;AACH;AACJ;AACJ;;AAEM,SAAS8B,eAAT,CAAyB7B,KAAzB,EAAoD;AAEvD2B,cAAY;;AAEZ,MAAI3B,KAAK,IAAIA,KAAK,CAACW,aAAnB,EAAkC;AAC9B,QAAI;AACAQ,mBAAa,CAAC5B,IAAd,CAAmBS,KAAK,CAACW,aAAzB;AACAS,kBAAY,CAAC7B,IAAb,CAAkBS,KAAlB;AACH,KAHD,CAGE,OAAO9B,GAAP,EAAY,CACV;AACH;AACJ;AACJ;AAEM,SAAS4D,YAAT,CAAsBnE,GAAtB,EAA4D;AAC/DA,KAAG,GAAGA,GAAG,IAAIC,MAAb;AACA,SAAOD,GAAG,CAACoE,SAAJ,CAAcC,aAAd,IAA+BrE,GAAG,CAACoE,SAAJ,CAAcE,SAApD;AACH;AAGM,SAASC,cAAT,CAAwBvE,GAAxB,EAAqDwE,IAArD,EAA6F;AAEhG,MAAIC,SAAS,GAAGzC,SAAS,CAAChC,GAAD,CAAzB;;AAFgG,0BAIzEyE,SAJyE,gBAI9D;AAA7B,QAAIlC,UAAU,GAAIkC,SAAJ,KAAd;;AACD,QAAI;AACA;AACA,UAAIjD,YAAY,CAACe,UAAD,CAAZ,IAA4BA,UAAU,CAACiC,IAAX,KAAoBA,IAAhD,IAAwDC,SAAS,CAACvD,OAAV,CAAkBqB,UAAlB,MAAkC,CAAC,CAA/F,EAAkG;AAC9F,eAAOA,UAAP;AACH;AACJ,KALD,CAKE,OAAOhC,GAAP,EAAY,CACV;AACH;AACJ;;AAED,MAAI;AACA;AACA,QAAIkE,SAAS,CAACvD,OAAV,CAAkBlB,GAAG,CAACiC,MAAJ,CAAWuC,IAAX,CAAlB,MAAwC,CAAC,CAA7C,EAAgD;AAC5C;AACA,aAAOxE,GAAG,CAACiC,MAAJ,CAAWuC,IAAX,CAAP;AACH;AACJ,GAND,CAME,OAAOjE,GAAP,EAAY,CACV;AACH;;AAED,MAAI;AACA,QAAIkE,SAAS,CAACvD,OAAV,CAAkBlB,GAAG,CAACwE,IAAD,CAArB,MAAiC,CAAC,CAAtC,EAAyC;AACrC,aAAOxE,GAAG,CAACwE,IAAD,CAAV;AACH;AACJ,GAJD,CAIE,OAAOjE,GAAP,EAAY,CACV;AACH;AACJ;AAEM,SAASmE,oBAAT,CAA8B1E,GAA9B,EAA2DwE,IAA3D,EAAmG;AAEtG,MAAInC,KAAK,GAAGkC,cAAc,CAACvE,GAAD,EAAMwE,IAAN,CAA1B;;AAEA,MAAInC,KAAJ,EAAW;AACP,WAAOA,KAAP;AACH;;AANqG,mCAQ/EL,SAAS,CAAChC,GAAD,CARsE,qCAQ/D;AAAlC,QAAIuC,UAAU,oBAAd;AACD,QAAIoC,UAAU,GAAGD,oBAAoB,CAACnC,UAAD,EAAaiC,IAAb,CAArC;;AAEA,QAAIG,UAAJ,EAAgB;AACZ,aAAOA,UAAP;AACH;AACJ;AACJ;AAEM,SAASC,eAAT,CAAyB5E,GAAzB,EAAsDwE,IAAtD,EAA8F;AAEjG,MAAInC,KAAJ;AAEAA,OAAK,GAAGkC,cAAc,CAACvE,GAAD,EAAMwE,IAAN,CAAtB;;AAEA,MAAInC,KAAJ,EAAW;AACP,WAAOA,KAAP;AACH;;AAED,MAAII,GAAG,GAAGD,MAAM,CAACxC,GAAD,CAAN,IAAeA,GAAzB;AAEA,SAAO0E,oBAAoB,CAACjC,GAAD,EAAM+B,IAAN,CAA3B;AACH;AAEM,SAASK,QAAT,CAAkB7E,GAAlB,EAA+CqC,KAA/C,EAAwF;AAE3F,MAAIyC,WAAW,GAAGzE,SAAS,CAACgC,KAAD,CAA3B;;AAEA,MAAIyC,WAAJ,EAAiB;AACb,WAAOA,WAAW,KAAK9E,GAAvB;AACH;;AAN0F,mCAQpEgC,SAAS,CAAChC,GAAD,CAR2D,qCAQpD;AAAlC,QAAIuC,UAAU,oBAAd;;AACD,QAAIA,UAAU,KAAKF,KAAnB,EAA0B;AACtB,aAAO,IAAP;AACH;AACJ;;AAED,SAAO,KAAP;AACH;AAEM,SAAS0C,QAAT,CAAkBzE,MAAlB,EAAkDwB,KAAlD,EAA2F;AAE9F,SAAOxB,MAAM,KAAKE,SAAS,CAACsB,KAAD,CAA3B;AACH;AAEM,SAASkD,WAAT,CAAqBhF,GAArB,EAAqF;AAAA,MAAhEA,GAAgE;AAAhEA,OAAgE,GAAjCC,MAAiC;AAAA;;AACxFD,KAAG,GAAGA,GAAG,IAAIC,MAAb;AAEA,MAAIQ,MAAM,GAAGD,SAAS,CAACR,GAAD,CAAtB;;AAEA,MAAIS,MAAJ,EAAY;AACR,WAAOA,MAAP;AACH;;AAED,MAAIH,MAAM,GAAGD,SAAS,CAACL,GAAD,CAAtB;;AAEA,MAAIM,MAAJ,EAAY;AACR,WAAOA,MAAP;AACH;AACJ;AAEM,SAAS2E,YAAT,CAAsBjF,GAAtB,EAAkF;AAErF,MAAIkF,OAAO,GAAG,EAAd;AAEA,MAAIC,QAAQ,GAAGnF,GAAf;;AAEA,SAAOmF,QAAP,EAAiB;AACbA,YAAQ,GAAGH,WAAW,CAACG,QAAD,CAAtB;;AACA,QAAIA,QAAJ,EAAc;AACVD,aAAO,CAACtD,IAAR,CAAauD,QAAb;AACH;AACJ;;AAED,SAAOD,OAAP;AACH;AAGM,SAASE,UAAT,CAAoB9E,MAApB,EAAoDwB,KAApD,EAA6F;AAEhG,MAAIuD,YAAY,GAAGL,WAAW,CAAClD,KAAD,CAA9B;;AAEA,MAAIuD,YAAJ,EAAkB;AACd,QAAIA,YAAY,KAAK/E,MAArB,EAA6B;AACzB,aAAO,IAAP;AACH;;AAED,WAAO,KAAP;AACH;;AAED,MAAIwB,KAAK,KAAKxB,MAAd,EAAsB;AAClB,WAAO,KAAP;AACH;;AAED,MAAIkC,MAAM,CAACV,KAAD,CAAN,KAAkBA,KAAtB,EAA6B;AACzB,WAAO,KAAP;AACH;;AAlB+F,mCAoB9EE,SAAS,CAAC1B,MAAD,CApBqE,qCAoB3D;AAAhC,QAAI+B,KAAK,oBAAT;;AACD,QAAIA,KAAK,KAAKP,KAAd,EAAqB;AACjB,aAAO,IAAP;AACH;AACJ;;AAED,SAAO,KAAP;AACH;AAEM,SAASwD,aAAT,CAAiBtF,GAAjB,EAAkE;AAAA,MAAjDA,GAAiD;AAAjDA,OAAiD,GAAlBC,MAAkB;AAAA;;AACrE,SAAOsF,OAAO,CAAC/E,SAAS,CAACR,GAAD,CAAV,CAAd;AACH;AAEM,SAASwF,QAAT,CAAkBxF,GAAlB,EAAmE;AAAA,MAAjDA,GAAiD;AAAjDA,OAAiD,GAAlBC,MAAkB;AAAA;;AACtE,SAAOsF,OAAO,CAAClF,SAAS,CAACL,GAAD,CAAV,CAAd;AACH;AAEM,SAASyF,UAAT,CAAoBzF,GAApB,EAAqE;AAAA,MAAjDA,GAAiD;AAAjDA,OAAiD,GAAlBC,MAAkB;AAAA;;AACxE,SAAOsF,OAAO,CAAC,CAACC,QAAQ,CAACxF,GAAD,CAAT,IAAkB,CAACsF,aAAO,CAACtF,GAAD,CAA3B,CAAd;AACH;;AAED,SAAS0F,QAAT,CAAkBC,WAAlB,EAA+BC,WAA/B,EAAsD;AAAA,4BAEhCD,WAFgC,iBAEnB;AAA1B,QAAIE,KAAK,GAAIF,WAAJ,MAAT;;AAA0B,8BACTC,WADS,iBACI;AAA1B,UAAIE,KAAK,GAAIF,WAAJ,MAAT;;AACD,UAAIC,KAAK,KAAKC,KAAd,EAAqB;AACjB,eAAO,IAAP;AACH;AACJ;AACJ;;AAED,SAAO,KAAP;AACH;;AAEM,SAASC,kBAAT,CAA4B/F,GAA5B,EAA2E;AAAA,MAA/CA,GAA+C;AAA/CA,OAA+C,GAAjBC,MAAiB;AAAA;;AAC9E,MAAI+F,QAAQ,GAAG,CAAf;AACA,MAAI1F,MAAM,GAAGN,GAAb;;AAEA,SAAOM,MAAP,EAAe;AACXA,UAAM,GAAGD,SAAS,CAACC,MAAD,CAAlB;;AACA,QAAIA,MAAJ,EAAY;AACR0F,cAAQ,IAAI,CAAZ;AACH;AACJ;;AAED,SAAOA,QAAP;AACH;AAEM,SAASC,YAAT,CAAsBjG,GAAtB,EAAmDkG,CAAnD,EAA4F;AAAA,MAAzCA,CAAyC;AAAzCA,KAAyC,GAA5B,CAA4B;AAAA;;AAC/F,MAAI5F,MAAM,GAAGN,GAAb;;AAEA,OAAK,IAAIoC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8D,CAApB,EAAuB9D,CAAC,EAAxB,EAA4B;AACxB,QAAI,CAAC9B,MAAL,EAAa;AACT;AACH;;AAEDA,UAAM,GAAGD,SAAS,CAACC,MAAD,CAAlB;AACH;;AAED,SAAOA,MAAP;AACH;AAEM,SAAS6F,mBAAT,CAA6BnG,GAA7B,EAA0DkG,CAA1D,EAAmG;AAAA,MAAzCA,CAAyC;AAAzCA,KAAyC,GAA5B,CAA4B;AAAA;;AACtG,SAAOD,YAAY,CAACjG,GAAD,EAAM+F,kBAAkB,CAAC/F,GAAD,CAAlB,GAA0BkG,CAAhC,CAAnB;AACH;AAEM,SAASE,eAAT,CAAyBC,IAAzB,EAAuDC,IAAvD,EAA+F;AAElG,MAAIC,IAAI,GAAG/D,MAAM,CAAC6D,IAAD,CAAN,IAAgBA,IAA3B;AACA,MAAIG,IAAI,GAAGhE,MAAM,CAAC8D,IAAD,CAAN,IAAgBA,IAA3B;;AAEA,MAAI;AACA,QAAIC,IAAI,IAAIC,IAAZ,EAAkB;AACd,UAAID,IAAI,KAAKC,IAAb,EAAmB;AACf,eAAO,IAAP;AACH;;AAED,aAAO,KAAP;AACH;AACJ,GARD,CAQE,OAAOjG,GAAP,EAAY,CACV;AACH;;AAED,MAAIkG,UAAU,GAAG7D,oBAAoB,CAACyD,IAAD,CAArC;AACA,MAAIK,UAAU,GAAG9D,oBAAoB,CAAC0D,IAAD,CAArC;;AAEA,MAAIZ,QAAQ,CAACe,UAAD,EAAaC,UAAb,CAAZ,EAAsC;AAClC,WAAO,IAAP;AACH;;AAED,MAAIC,OAAO,GAAGnG,SAAS,CAAC+F,IAAD,CAAvB;AACA,MAAIK,OAAO,GAAGpG,SAAS,CAACgG,IAAD,CAAvB;;AAEA,MAAIG,OAAO,IAAIjB,QAAQ,CAAC9C,oBAAoB,CAAC+D,OAAD,CAArB,EAAgCD,UAAhC,CAAvB,EAAoE;AAChE,WAAO,KAAP;AACH;;AAED,MAAIE,OAAO,IAAIlB,QAAQ,CAAC9C,oBAAoB,CAACgE,OAAD,CAArB,EAAgCH,UAAhC,CAAvB,EAAoE;AAChE,WAAO,KAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASI,WAAT,CAAqBC,OAArB,EAA8CC,MAA9C,EAAgF;AAEnF,MAAI,OAAOD,OAAP,KAAmB,QAAvB,EAAiC;AAE7B,QAAI,OAAOC,MAAP,KAAkB,QAAtB,EAAgC;AAC5B,aAAOD,OAAO,KAAKpH,QAAZ,IAAwBqH,MAAM,KAAKD,OAA1C;AACH;;AAED,QAAI/H,OAAO,CAACgI,MAAD,CAAX,EAAqB;AACjB,aAAO,KAAP;AACH;;AAED,QAAIC,KAAK,CAACC,OAAN,CAAcF,MAAd,CAAJ,EAA2B;AACvB,aAAO,KAAP;AACH;AACJ;;AAED,MAAIhI,OAAO,CAAC+H,OAAD,CAAX,EAAsB;AAElB,QAAI/H,OAAO,CAACgI,MAAD,CAAX,EAAqB;AACjB,aAAOD,OAAO,CAAC3H,QAAR,OAAuB4H,MAAM,CAAC5H,QAAP,EAA9B;AACH;;AAED,QAAI6H,KAAK,CAACC,OAAN,CAAcF,MAAd,CAAJ,EAA2B;AACvB,aAAO,KAAP;AACH,KARiB,CAUlB;;;AACA,WAAOxB,OAAO,CAACwB,MAAM,CAACG,KAAP,CAAaJ,OAAb,CAAD,CAAd;AACH;;AAED,MAAIE,KAAK,CAACC,OAAN,CAAcH,OAAd,CAAJ,EAA4B;AAExB,QAAIE,KAAK,CAACC,OAAN,CAAcF,MAAd,CAAJ,EAA2B;AACvB,aAAOI,IAAI,CAACC,SAAL,CAAeN,OAAf,MAA4BK,IAAI,CAACC,SAAL,CAAeL,MAAf,CAAnC;AACH;;AAED,QAAIhI,OAAO,CAACgI,MAAD,CAAX,EAAqB;AACjB,aAAO,KAAP;AACH;;AAED,WAAOD,OAAO,CAACO,IAAR,CAAa,UAAAC,UAAU;AAAA,aAAIT,WAAW,CAACS,UAAD,EAAaP,MAAb,CAAf;AAAA,KAAvB,CAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASQ,sBAAT,CAAgCT,OAAhC,EAAkE;AACrE,MAAIE,KAAK,CAACC,OAAN,CAAcH,OAAd,CAAJ,EAA4B;AACxB,iBAAYA,OAAO,CAACU,IAAR,CAAa,KAAb,CAAZ;AACH,GAFD,MAEO,IAAIzI,OAAO,CAAC+H,OAAD,CAAX,EAAsB;AACzB,uBAAkBA,OAAO,CAAC3H,QAAR,EAAlB;AACH,GAFM,MAEA;AACH,WAAO2H,OAAO,CAAC3H,QAAR,EAAP;AACH;AACJ;AAEM,SAASsI,gBAAT,CAA0BC,GAA1B,EAAiD;AAEpD,MAAI1G,MAAJ;;AAEA,MAAI0G,GAAG,CAACR,KAAJ,CAAU,0BAAV,CAAJ,EAA2C;AACvClG,UAAM,GAAG0G,GAAT;AACH,GAFD,MAEO;AACH,WAAO3G,SAAS,EAAhB;AACH;;AAEDC,QAAM,GAAGA,MAAM,CAAC2G,KAAP,CAAa,GAAb,EAAkBC,KAAlB,CAAwB,CAAxB,EAA2B,CAA3B,EAA8BJ,IAA9B,CAAmC,GAAnC,CAAT;AAEA,SAAOxG,MAAP;AACH;AAEM,SAAS6G,aAAT,CAAuB7H,GAAvB,EAAoD8H,QAApD,EAAyEC,KAAzE,EAAgGC,OAAhG,EAAuJ;AAAA,MAA9ED,KAA8E;AAA9EA,SAA8E,GAA7D,IAA6D;AAAA;;AAAA,MAAvDC,OAAuD;AAAvDA,WAAuD,GAApCC,QAAoC;AAAA;;AAE1J,MAAIC,OAAJ;;AAEA,MAAIC,KAAK,GAAG,SAARA,KAAQ,GAAM;AAEd,QAAIzE,cAAc,CAAC1D,GAAD,CAAlB,EAAyB;AAErB,UAAIkI,OAAJ,EAAa;AACTE,oBAAY,CAACF,OAAD,CAAZ;AACH;;AAED,aAAOJ,QAAQ,EAAf;AACH;;AAED,QAAIE,OAAO,IAAI,CAAf,EAAkB;AACdI,kBAAY,CAACF,OAAD,CAAZ;AACH,KAFD,MAEO;AACHF,aAAO,IAAID,KAAX;AACAG,aAAO,GAAGG,UAAU,CAACF,KAAD,EAAQJ,KAAR,CAApB;AACH;AACJ,GAjBD;;AAmBAI,OAAK;AAEL,SAAO;AACHG,UADG,oBACM;AACL,UAAIJ,OAAJ,EAAa;AACTE,oBAAY,CAACF,OAAD,CAAZ;AACH;AACJ;AALE,GAAP;AAOH,C,CAED;;AACO,SAASK,QAAT,CAAkBC,GAAlB,EAA0C;AAE7C,MAAI;AACA,QAAIA,GAAG,KAAKvI,MAAZ,EAAoB;AAChB,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOM,GAAP,EAAY;AACV,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,IAAP;AACH;AACJ;;AAED,MAAI;AACA,QAAIb,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BoJ,GAA/B,MAAwC,iBAA5C,EAA+D;AAC3D,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOjI,GAAP,EAAY;AACV,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,IAAP;AACH;AACJ;;AAED,MAAI;AACA,QAAIG,MAAM,CAACwI,MAAP,IAAiBD,GAAG,YAAYvI,MAAM,CAACwI,MAA3C,EAAmD;AAC/C,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOlI,GAAP,EAAY;AACV,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,IAAP;AACH;AACJ;;AAED,MAAI;AACA,QAAI0I,GAAG,IAAIA,GAAG,CAACE,IAAJ,KAAaF,GAAxB,EAA6B;AACzB,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOjI,GAAP,EAAY;AACV,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,IAAP;AACH;AACJ;;AAED,MAAI;AACA,QAAI0I,GAAG,IAAIA,GAAG,CAAClI,MAAJ,KAAekI,GAA1B,EAA+B;AAC3B,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOjI,GAAP,EAAY;AACV,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,IAAP;AACH;AACJ;;AAED,MAAI;AACA,QAAI0I,GAAG,IAAIA,GAAG,CAAC/F,GAAJ,KAAY+F,GAAvB,EAA4B;AACxB,aAAO,IAAP;AACH;AACJ,GAJD,CAIE,OAAOjI,GAAP,EAAY;AACV,QAAIA,GAAG,IAAIA,GAAG,CAACsD,OAAJ,KAAgB/D,mBAA3B,EAAgD;AAC5C,aAAO,IAAP;AACH;AACJ;;AAED,MAAI;AACA,QAAIT,IAAI,CAACmJ,GAAG,KAAKA,GAAT,CAAJ,KAAsB,oBAA1B,EAAgD;AAAE;AAC9C,aAAO,KAAP;AACH;AAEJ,GALD,CAKE,OAAOjI,GAAP,EAAY;AACV,WAAO,IAAP;AACH;;AAED,MAAI;AACA,QAAIiI,GAAG,IAAIA,GAAG,CAACG,mCAAJ,KAA4C,oBAAvD,EAA6E;AACzE,aAAO,KAAP;AACH;AAEJ,GALD,CAKE,OAAOpI,GAAP,EAAY;AACV,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASqI,SAAT,GAA+B;AAClC,SAAQ,OAAO3I,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACC,QAAd,KAA2B,WAApE;AACH;AAEM,SAAS2I,eAAT,CAAyB7H,MAAzB,EAAoD;AACvD,MAAI,CAAC4H,SAAS,EAAd,EAAkB;AACd,WAAO,KAAP;AACH;;AAED,SAAQ7H,SAAS,OAAOC,MAAxB;AACH;AAEM,SAAS8H,YAAT,CAAsB9H,MAAtB,EAAiD;AACpD,SAAOA,MAAM,CAACE,OAAP,CAAe5B,QAAQ,CAACC,IAAxB,MAAkC,CAAzC;AACH;AAEM,SAASwJ,gBAAT,CAA0BrB,GAA1B,EAAiD;AACpD,MAAI,CAACoB,YAAY,CAACrB,gBAAgB,CAACC,GAAD,CAAjB,CAAjB,EAA0C;AACtC,WAAOA,GAAP;AACH;;AAED,MAAI,IAAJ,EAAe;AACX,UAAM,IAAI7G,KAAJ,4CAAN;AACH;;AAED,SAAO6G,GAAG,CAACsB,OAAJ,CAAY,iBAAZ,EAA+BpI,eAAe,CAACX,MAAD,CAA9C,CAAP;AACH;AAEM,SAASgJ,WAAT,CAAqBjJ,GAArB,EAAkD;AACrD,MAAI;AACAA,OAAG,CAACkJ,KAAJ;AACH,GAFD,CAEE,OAAO3I,GAAP,EAAY,CACV;AACH;AACJ;AAEM,SAAS4I,iBAAT,CAA2BnJ,GAA3B,EAAuE;AAC1E,MAAIwB,YAAY,CAACxB,GAAD,CAAhB,EAAuB;AACnB,WAAOyB,gBAAgB,CAACzB,GAAD,CAAhB,CAAsBoJ,YAA7B;AACH;;AAHyE,8CAKtDC,QAAQ,CAACC,gBAAT,CAA0B,QAA1B,CALsD,gDAKjB;AAApD,QAAMjH,KAAK,+BAAX;;AACD,QAAIA,KAAK,IAAIA,KAAK,CAACW,aAAf,IAAgCX,KAAK,CAACW,aAAN,KAAwBhD,GAA5D,EAAiE;AAC7D,aAAOqC,KAAP;AACH;AACJ;AACJ,C;;AClhCD;AACO,IAAMkH,KAAK,GAAG,IAAd,C;;ACDP;AACA;;;ACDO,SAASC,eAAT,CAAmBxK,IAAnB,EAA2C;AAC9C,MAAI;AACA,QAAI,CAACA,IAAL,EAAW;AACP,aAAO,KAAP;AACH;;AAED,QAAI,OAAOyK,OAAP,KAAmB,WAAnB,IAAkCzK,IAAI,YAAYyK,OAAtD,EAA+D;AAC3D,aAAO,IAAP;AACH;;AAED,QAAI,OAAOxJ,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACwI,MAAd,KAAyB,UAA1D,IAAwEzJ,IAAI,YAAYiB,MAAM,CAACwI,MAAnG,EAA2G;AACvG,aAAO,KAAP;AACH;;AAED,QAAI,OAAOxI,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACyJ,WAAd,KAA8B,UAA/D,IAA6E1K,IAAI,YAAYiB,MAAM,CAACyJ,WAAxG,EAAqH;AACjH,aAAO,KAAP;AACH;;AAED,QAAIvK,SAAQ,GAAI,EAAD,CAAKA,QAApB;;AAEA,QAAIA,SAAJ,EAAc;AACV,UAAIqF,IAAI,GAAGrF,SAAQ,CAACC,IAAT,CAAcJ,IAAd,CAAX;;AAEA,UAAIwF,IAAI,KAAK,iBAAT,IAA8BA,IAAI,KAAK,iBAAvC,IAA4DA,IAAI,KAAK,oBAAzE,EAA+F;AAC3F,eAAO,KAAP;AACH;AACJ;;AAED,QAAI,OAAOxF,IAAI,CAAC2K,IAAZ,KAAqB,UAAzB,EAAqC;AACjC,aAAO,IAAP;AACH;AACJ,GA9BD,CA8BE,OAAOpJ,GAAP,EAAY;AACV,WAAO,KAAP;AACH;;AAED,SAAO,KAAP;AACH,C;;AClCD,IAAMqJ,gBAAgB,GAAG,EAAzB;AACA,IAAMC,gCAAyF,GAAG,EAAlG;AAEO,SAASC,8BAAT,CAA2CvJ,GAA3C,EAAwDwJ,OAAxD,EAAmF;AAEtF,MAAIH,gBAAgB,CAAC1I,OAAjB,CAAyBX,GAAzB,MAAkC,CAAC,CAAvC,EAA0C;AACtC;AACH;;AAEDqJ,kBAAgB,CAAChI,IAAjB,CAAsBrB,GAAtB;AAEA8H,YAAU,CAAC,YAAM;AACb,QAAI2B,KAAJ,EAAe,EAGd;;AAED,UAAMzJ,GAAN;AACH,GAPS,EAOP,CAPO,CAAV;;AASA,OAAK,IAAI0J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,gCAAgC,CAAC1H,MAArD,EAA6D8H,CAAC,EAA9D,EAAkE;AAC9D;AACAJ,oCAAgC,CAACI,CAAD,CAAhC,CAAoC1J,GAApC,EAAyCwJ,OAAzC;AACH;AACJ;AAEM,SAASG,uCAAT,CAAsCC,OAAtC,EAA2H;AAC9HN,kCAAgC,CAACjI,IAAjC,CAAsCuI,OAAtC;AAEA,SAAO;AACH7B,UADG,oBACM;AACLuB,sCAAgC,CAAC5F,MAAjC,CAAwC4F,gCAAgC,CAAC3I,OAAjC,CAAyCiJ,OAAzC,CAAxC,EAA2F,CAA3F;AACH;AAHE,GAAP;AAKH,C;;AClCD,IAAIC,WAAW,GAAG,CAAlB;AACA,IAAIC,YAAJ;;AAEA,SAASC,WAAT,GAAuB;AACnB,MAAI,CAACF,WAAD,IAAgBC,YAApB,EAAkC;AAC9B,QAAMN,OAAO,GAAGM,YAAhB;AACAA,gBAAY,GAAG,IAAf;AACAN,WAAO,CAACQ,OAAR;AACH;AACJ;;AAEM,SAASC,WAAT,GAAuB;AAC1BJ,aAAW,IAAI,CAAf;AACH;AAEM,SAASK,SAAT,GAAqB;AACxBL,aAAW,IAAI,CAAf;AACAE,aAAW;AACd;AAEM,SAASI,WAAT,CAAqBC,KAArB,EAA0E;AAAE;AAC/E,MAAIZ,OAAO,GAAGM,YAAY,GAAGA,YAAY,IAAI,IAAIM,KAAJ,EAA7C;AACAL,aAAW;AACX,SAAOP,OAAP;AACH,C;;AC1BD;AACA;AACA;AAEO,IAAMa,oBAAb;AAAA;AAAA;AAeI,wBAAYT,OAAZ,EAAmG;AAAA;;AAAA,SAbnGU,QAamG;AAAA,SAZnGC,QAYmG;AAAA,SAXnGC,YAWmG;AAAA,SAVnGC,KAUmG;AAAA,SATnGC,KASmG;AAAA,SARnGC,QAQmG;AAAA,SAHnGC,WAGmG;AAAA,SAFnGC,KAEmG;AAE/F,SAAKP,QAAL,GAAgB,KAAhB;AACA,SAAKC,QAAL,GAAgB,KAAhB;AACA,SAAKC,YAAL,GAAoB,KAApB;AAEA,SAAKG,QAAL,GAAgB,EAAhB;;AAEA,QAAIf,OAAJ,EAAa;AAET,UAAIxI,OAAJ;;AACA,UAAIsJ,MAAJ;;AACA,UAAIJ,QAAQ,GAAG,KAAf;AACA,UAAIC,QAAQ,GAAG,KAAf;AACA,UAAIO,OAAO,GAAG,KAAd;AAEAb,iBAAW;;AAEX,UAAI;AACAL,eAAO,CAAC,UAAAmB,GAAG,EAAI;AACX,cAAID,OAAJ,EAAa;AACT,iBAAI,CAACd,OAAL,CAAae,GAAb;AACH,WAFD,MAEO;AACHT,oBAAQ,GAAG,IAAX;AACAlJ,mBAAM,GAAG2J,GAAT;AACH;AAEJ,SARM,EAQJ,UAAA/K,GAAG,EAAI;AACN,cAAI8K,OAAJ,EAAa;AACT,iBAAI,CAACE,MAAL,CAAYhL,GAAZ;AACH,WAFD,MAEO;AACHuK,oBAAQ,GAAG,IAAX;AACAG,kBAAK,GAAG1K,GAAR;AACH;AACJ,SAfM,CAAP;AAiBH,OAlBD,CAkBE,OAAOA,GAAP,EAAY;AACVkK,iBAAS;AACT,aAAKc,MAAL,CAAYhL,GAAZ;AACA;AACH;;AAEDkK,eAAS;AAETY,aAAO,GAAG,IAAV;;AAEA,UAAIR,QAAJ,EAAc;AACV;AACA,aAAKN,OAAL,CAAa5I,OAAb;AACH,OAHD,MAGO,IAAImJ,QAAJ,EAAc;AACjB,aAAKS,MAAL,CAAYN,MAAZ;AACH;AACJ;;AAED,QAAIjB,KAAJ,EAAe,EAMd;AACJ;;AA5EL;;AAAA,SA8EIO,OA9EJ,GA8EI,iBAAQ5I,MAAR,EAAsC;AAClC,QAAI,KAAKkJ,QAAL,IAAiB,KAAKC,QAA1B,EAAoC;AAChC,aAAO,IAAP;AACH;;AAED,QAAItB,eAAS,CAAC7H,MAAD,CAAb,EAAuB;AACnB,YAAM,IAAId,KAAJ,CAAU,8CAAV,CAAN;AACH;;AAED,SAAKgK,QAAL,GAAgB,IAAhB;AACA,SAAKG,KAAL,GAAarJ,MAAb;AACA,SAAK6J,QAAL;AAEA,WAAO,IAAP;AACH,GA5FL;;AAAA,SA8FID,MA9FJ,GA8FI,gBAAON,KAAP,EAAwC;AAAA;;AACpC,QAAI,KAAKJ,QAAL,IAAiB,KAAKC,QAA1B,EAAoC;AAChC,aAAO,IAAP;AACH;;AAED,QAAItB,eAAS,CAACyB,KAAD,CAAb,EAAsB;AAClB,YAAM,IAAIpK,KAAJ,CAAU,6CAAV,CAAN;AACH;;AAED,QAAI,CAACoK,KAAL,EAAY;AACR;AACA,UAAI1K,IAAG,GAAI0K,KAAK,IAAI,OAAOA,KAAK,CAAC9L,QAAb,KAA0B,UAAnC,GAAgD8L,KAAK,CAAC9L,QAAN,EAAhD,GAAmEF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+B6L,KAA/B,CAA9E;;AACAA,WAAK,GAAG,IAAIpK,KAAJ,mDAA2DN,IAA3D,CAAR;AACH;;AAED,SAAKuK,QAAL,GAAgB,IAAhB;AACA,SAAKG,KAAL,GAAaA,KAAb;;AAEA,QAAI,CAAC,KAAKF,YAAV,EAAwB;AACpB1C,gBAAU,CAAC,YAAM;AACb,YAAI,CAAC,MAAI,CAAC0C,YAAV,EAAwB;AACpBjB,wCAA8B,CAACmB,KAAD,EAAQ,MAAR,CAA9B;AACH;AACJ,OAJS,EAIP,CAJO,CAAV;AAKH;;AAED,SAAKO,QAAL;AAEA,WAAO,IAAP;AACH,GA3HL;;AAAA,SA6HIC,WA7HJ,GA6HI,qBAAYR,KAAZ,EAA6C;AACzC,SAAKF,YAAL,GAAoB,IAApB;AACA,SAAKQ,MAAL,CAAYN,KAAZ;AACA,WAAO,IAAP;AACH,GAjIL;;AAAA,SAmIIO,QAnIJ,GAmII,oBAAW;AAAA,QAEDL,WAFC,GAE6C,IAF7C,CAEDA,WAFC;AAAA,QAEYN,QAFZ,GAE6C,IAF7C,CAEYA,QAFZ;AAAA,QAEsBC,QAFtB,GAE6C,IAF7C,CAEsBA,QAFtB;AAAA,QAEgCI,QAFhC,GAE6C,IAF7C,CAEgCA,QAFhC;;AAIP,QAAIC,WAAJ,EAAiB;AACb;AACH;;AAED,QAAI,CAACN,QAAD,IAAa,CAACC,QAAlB,EAA4B;AACxB;AACH;;AAED,SAAKK,WAAL,GAAmB,IAAnB;AACAX,eAAW;;AAEX,QAAMkB,KAAK,GAAG,SAARA,KAAQ,CAAIC,YAAJ,EAAoCC,aAApC,EAAwE;AAClF,aAAOD,YAAY,CAAChC,IAAb,CAAkB,UAAA2B,GAAG,EAAI;AAC5BM,qBAAa,CAACrB,OAAd,CAAsBe,GAAtB;AACH,OAFM,EAEJ,UAAA/K,GAAG,EAAI;AACNqL,qBAAa,CAACL,MAAd,CAAqBhL,GAArB;AACH,OAJM,CAAP;AAKH,KAND;;AAQA,SAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8I,QAAQ,CAAC/I,MAA7B,EAAqCC,CAAC,EAAtC,EAA0C;AAAA,wBAEA8I,QAAQ,CAAC9I,CAAD,CAFR;AAAA,UAEhCyJ,SAFgC,eAEhCA,SAFgC;AAAA,UAErBC,OAFqB,eAErBA,OAFqB;AAAA,UAEZ/B,OAFY,eAEZA,OAFY;;AAItC,UAAIpI,QAAM,SAAV;;AAEA,UAAIkJ,QAAJ,EAAc;AAEV,YAAI;AACAlJ,kBAAM,GAAGkK,SAAS,GAAGA,SAAS,CAAC,KAAKb,KAAN,CAAZ,GAA2B,KAAKA,KAAlD;AACH,SAFD,CAEE,OAAOzK,GAAP,EAAY;AACVwJ,iBAAO,CAACwB,MAAR,CAAehL,GAAf;AACA;AACH;AAEJ,OATD,MASO,IAAIuK,QAAJ,EAAc;AAEjB,YAAI,CAACgB,OAAL,EAAc;AACV/B,iBAAO,CAACwB,MAAR,CAAe,KAAKN,KAApB;AACA;AACH;;AAED,YAAI;AACAtJ,kBAAM,GAAGmK,OAAO,CAAC,KAAKb,KAAN,CAAhB;AACH,SAFD,CAEE,OAAO1K,GAAP,EAAY;AACVwJ,iBAAO,CAACwB,MAAR,CAAehL,GAAf;AACA;AACH;AACJ;;AAED,UAAIoB,QAAM,YAAYiJ,YAAlB,KAAmCjJ,QAAM,CAACkJ,QAAP,IAAmBlJ,QAAM,CAACmJ,QAA7D,CAAJ,EAA4E;AAExE,YAAInJ,QAAM,CAACkJ,QAAX,EAAqB;AACjBd,iBAAO,CAACQ,OAAR,CAAgB5I,QAAM,CAACqJ,KAAvB;AACH,SAFD,MAEO;AACHjB,iBAAO,CAACwB,MAAR,CAAe5J,QAAM,CAACsJ,KAAtB;AACH;;AAEDtJ,gBAAM,CAACoJ,YAAP,GAAsB,IAAtB;AAEH,OAVD,MAUO,IAAIvB,eAAS,CAAC7H,QAAD,CAAb,EAAuB;AAE1B,YAAIA,QAAM,YAAYiJ,YAAlB,KAAmCjJ,QAAM,CAACkJ,QAAP,IAAmBlJ,QAAM,CAACmJ,QAA7D,CAAJ,EAA4E;AACxE,cAAInJ,QAAM,CAACkJ,QAAX,EAAqB;AACjBd,mBAAO,CAACQ,OAAR,CAAgB5I,QAAM,CAACqJ,KAAvB;AACH,WAFD,MAEO;AACHjB,mBAAO,CAACwB,MAAR,CAAe5J,QAAM,CAACsJ,KAAtB;AACH;AAEJ,SAPD,MAOO;AACH;AACAS,eAAK,CAAC/J,QAAD,EAASoI,OAAT,CAAL;AACH;AAEJ,OAdM,MAcA;AAEHA,eAAO,CAACQ,OAAR,CAAgB5I,QAAhB;AACH;AACJ;;AAEDuJ,YAAQ,CAAC/I,MAAT,GAAkB,CAAlB;AACA,SAAKgJ,WAAL,GAAmB,KAAnB;AACAV,aAAS;AACZ,GAzNL;;AAAA,SA2NId,IA3NJ,GA2NI,cAA2BkC,SAA3B,EAAqFC,OAArF,EAAsK;AAElK,QAAID,SAAS,IAAI,OAAOA,SAAP,KAAqB,UAAlC,IAAgD,CAACA,SAAS,CAACzM,IAA/D,EAAqE;AACjE,YAAM,IAAIyB,KAAJ,CAAU,sDAAV,CAAN;AACH;;AAED,QAAIiL,OAAO,IAAI,OAAOA,OAAP,KAAmB,UAA9B,IAA4C,CAACA,OAAO,CAAC1M,IAAzD,EAA+D;AAC3D,YAAM,IAAIyB,KAAJ,CAAU,oDAAV,CAAN;AACH;;AAED,QAAIkJ,OAA6B,GAAG,IAAIa,YAAJ,EAApC;AAEA,SAAKM,QAAL,CAActJ,IAAd,CAAmB;AACfmI,aAAO,EAAPA,OADe;AAEf8B,eAAS,EAATA,SAFe;AAGfC,aAAO,EAAPA;AAHe,KAAnB;AAMA,SAAKf,YAAL,GAAoB,IAApB;AAEA,SAAKS,QAAL;AAEA,WAAOzB,OAAP;AACH,GAlPL;;AAAA,SAoPIgC,KApPJ,GAoPI,gBAA4BD,OAA5B,EAAoG;AAChG,WAAO,KAAKnC,IAAL,CAAUqC,SAAV,EAAqBF,OAArB,CAAP;AACH,GAtPL;;AAAA,SAwPIG,OAxPJ,GAwPI,kBAAQC,SAAR,EAAmD;AAE/C,QAAIA,SAAS,IAAI,OAAOA,SAAP,KAAqB,UAAlC,IAAgD,CAACA,SAAS,CAAC9M,IAA/D,EAAqE;AACjE,YAAM,IAAIyB,KAAJ,CAAU,qCAAV,CAAN;AACH;;AAED,WAAO,KAAK8I,IAAL,CAAU,UAAChI,MAAD,EAAY;AACzB,aAAOiJ,YAAY,CAACuB,GAAb,CAAiBD,SAAjB,EACFvC,IADE,CACG,YAAM;AACR,eAAOhI,MAAP;AACH,OAHE,CAAP;AAIH,KALM,EAKJ,UAACpB,GAAD,EAAS;AACR,aAAOqK,YAAY,CAACuB,GAAb,CAAiBD,SAAjB,EACFvC,IADE,CACG,YAAM;AACR,cAAMpJ,GAAN;AACH,OAHE,CAAP;AAIH,KAVM,CAAP;AAWH,GAzQL;;AAAA,SA2QI2H,OA3QJ,GA2QI,iBAAQkE,IAAR,EAAuB7L,GAAvB,EAAuD;AAAA;;AAEnD,QAAI,KAAKsK,QAAL,IAAiB,KAAKC,QAA1B,EAAoC;AAChC,aAAO,IAAP;AACH;;AAED,QAAI5C,OAAO,GAAGG,UAAU,CAAC,YAAM;AAE3B,UAAI,MAAI,CAACwC,QAAL,IAAiB,MAAI,CAACC,QAA1B,EAAoC;AAChC;AACH;;AAED,YAAI,CAACS,MAAL,CAAYhL,GAAG,IAAI,IAAIM,KAAJ,8BAAsCuL,IAAtC,QAAnB;AAEH,KARuB,EAQrBA,IARqB,CAAxB;AAUA,WAAO,KAAKzC,IAAL,CAAU,UAAAhI,MAAM,EAAI;AACvByG,kBAAY,CAACF,OAAD,CAAZ;AACA,aAAOvG,MAAP;AACH,KAHM,CAAP;AAIH,GA/RL,CAiSI;AAjSJ;;AAAA,SAkSI0K,SAlSJ,GAkSI,qBAAyB;AACrB;AACA,QAAI,OAAO5C,OAAP,KAAmB,WAAvB,EAAoC;AAChC,YAAM,IAAI6C,SAAJ,0BAAN;AACH,KAJoB,CAKrB;;;AACA,WAAO7C,OAAO,CAACc,OAAR,CAAgB,IAAhB,CAAP,CANqB,CAMS;AACjC,GAzSL;;AAAA,eA2SWA,OA3SX,GA2SI,iBAA0BS,KAA1B,EAAyE;AAErE,QAAIA,KAAK,YAAYJ,YAArB,EAAmC;AAC/B,aAAOI,KAAP;AACH;;AAED,QAAIxB,eAAS,CAACwB,KAAD,CAAb,EAAsB;AAClB;AACA,aAAO,IAAIJ,YAAJ,CAAiB,UAACL,OAAD,EAAUgB,MAAV;AAAA,eAAqBP,KAAK,CAACrB,IAAN,CAAWY,OAAX,EAAoBgB,MAApB,CAArB;AAAA,OAAjB,CAAP;AACH;;AAED,WAAO,IAAIX,YAAJ,GAAmBL,OAAnB,CAA2BS,KAA3B,CAAP;AACH,GAvTL;;AAAA,eAyTWO,MAzTX,GAyTI,gBAAcN,KAAd,EAA+C;AAC3C,WAAO,IAAIL,YAAJ,GAAmBW,MAAnB,CAA0BN,KAA1B,CAAP;AACH,GA3TL;;AAAA,eA6TWQ,WA7TX,GA6TI,qBAAmBR,KAAnB,EAAoD;AAChD,WAAO,IAAIL,YAAJ,GAAmBa,WAAnB,CAA+BR,KAA/B,CAAP;AACH,GA/TL;;AAAA,eAiUWsB,GAjUX,GAiUI,aAA6BC,QAA7B,EAAuG;AAAE;AAErG,QAAIzC,OAAO,GAAG,IAAIa,YAAJ,EAAd;AACA,QAAI6B,KAAK,GAAGD,QAAQ,CAACrK,MAArB;AACA,QAAI+C,OAAO,GAAG,EAAd;;AAEA,QAAI,CAACuH,KAAL,EAAY;AACR1C,aAAO,CAACQ,OAAR,CAAgBrF,OAAhB;AACA,aAAO6E,OAAP;AACH;;AAED,QAAM2B,KAAK,GAAG,SAARA,KAAQ,CAAItJ,CAAJ,EAAgBuJ,YAAhB,EAAgDC,aAAhD,EAAoF;AAC9F,aAAOD,YAAY,CAAChC,IAAb,CAAkB,UAAA2B,GAAG,EAAI;AAC5BpG,eAAO,CAAC9C,CAAD,CAAP,GAAakJ,GAAb;AACAmB,aAAK,IAAI,CAAT;;AACA,YAAIA,KAAK,KAAK,CAAd,EAAiB;AACb1C,iBAAO,CAACQ,OAAR,CAAgBrF,OAAhB;AACH;AACJ,OANM,EAMJ,UAAA3E,GAAG,EAAI;AACNqL,qBAAa,CAACL,MAAd,CAAqBhL,GAArB;AACH,OARM,CAAP;AASH,KAVD;;AAYA,SAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoK,QAAQ,CAACrK,MAA7B,EAAqCC,CAAC,EAAtC,EAA0C;AACtC,UAAIsK,IAAI,GAAGF,QAAQ,CAACpK,CAAD,CAAnB;;AAEA,UAAIsK,IAAI,YAAY9B,YAApB,EAAkC;AAC9B,YAAI8B,IAAI,CAAC7B,QAAT,EAAmB;AACf3F,iBAAO,CAAC9C,CAAD,CAAP,GAAasK,IAAI,CAAC1B,KAAlB;AACAyB,eAAK,IAAI,CAAT;AACA;AACH;AACJ,OAND,MAMO,IAAI,CAACjD,eAAS,CAACkD,IAAD,CAAd,EAAsB;AACzBxH,eAAO,CAAC9C,CAAD,CAAP,GAAasK,IAAb;AACAD,aAAK,IAAI,CAAT;AACA;AACH;;AAEDf,WAAK,CAACtJ,CAAD,EAAIwI,YAAY,CAACL,OAAb,CAAqBmC,IAArB,CAAJ,EAAgC3C,OAAhC,CAAL;AACH;;AAED,QAAI0C,KAAK,KAAK,CAAd,EAAiB;AACb1C,aAAO,CAACQ,OAAR,CAAgBrF,OAAhB;AACH;;AAED,WAAO6E,OAAP;AACH,GA/WL;;AAAA,eAiXW4C,IAjXX,GAiXI,cAAwBH,QAAxB,EAAgG;AAAE;AAC9F,QAAI7K,MAAM,GAAG,EAAb;AAEA,WAAOiJ,YAAY,CAAC2B,GAAb,CAAiBtN,MAAM,CAAC2N,IAAP,CAAYJ,QAAZ,EAAsBK,GAAtB,CAA0B,UAAAC,GAAG,EAAI;AACrD,aAAOlC,YAAY,CAACL,OAAb,CAAqBiC,QAAQ,CAACM,GAAD,CAA7B,EAAoCnD,IAApC,CAAyC,UAAAqB,KAAK,EAAI;AACrDrJ,cAAM,CAACmL,GAAD,CAAN,GAAc9B,KAAd;AACH,OAFM,CAAP;AAGH,KAJuB,CAAjB,EAIHrB,IAJG,CAIE,YAAM;AACX,aAAOhI,MAAP;AACH,KANM,CAAP;AAOH,GA3XL;;AAAA,eA6XWkL,GA7XX,GA6XI,aAAiBE,KAAjB,EAAmCC,MAAnC,EAAmG;AAC/F;AACA,WAAOpC,YAAY,CAAC2B,GAAb,CAAiBQ,KAAK,CAACF,GAAN,CAAUG,MAAV,CAAjB,CAAP;AACH,GAhYL;;AAAA,eAkYW9C,4BAlYX,GAkYI,sCAAoCC,OAApC,EAA+F;AAC3F,WAAOD,uCAA4B,CAACC,OAAD,CAAnC;AACH,GApYL;;AAAA,eAsYWgC,GAtYX,GAsYI,cAA8Da,MAA9D,EAA+GC,OAA/G,EAA6HC,IAA7H,EAA8J;AAE1J,QAAIF,MAAM,IAAI,OAAOA,MAAP,KAAkB,UAA5B,IAA0C,CAACA,MAAM,CAAC5N,IAAtD,EAA4D;AACxD,YAAM,IAAIyB,KAAJ,CAAU,iCAAV,CAAN;AACH;;AAED,QAAIc,MAAJ;AAEA6I,eAAW;;AAEX,QAAI;AACA;AACA7I,YAAM,GAAGqL,MAAM,CAACG,KAAP,CAAaF,OAAb,EAAsBC,IAAI,IAAI,EAA9B,CAAT;AACH,KAHD,CAGE,OAAO3M,GAAP,EAAY;AACVkK,eAAS;AACT,aAAOG,YAAY,CAACW,MAAb,CAAoBhL,GAApB,CAAP;AACH;;AAEDkK,aAAS;AAET,WAAOG,YAAY,CAACL,OAAb,CAAqB5I,MAArB,CAAP;AACH,GA3ZL;;AAAA,eA6ZWoG,KA7ZX,GA6ZI,eAAaA,MAAb,EAAkD;AAC9C,WAAO,IAAI6C,YAAJ,CAAiB,UAAAL,OAAO,EAAI;AAC/BlC,gBAAU,CAACkC,OAAD,EAAUxC,MAAV,CAAV;AACH,KAFM,CAAP;AAGH,GAjaL;;AAAA,eAmaWyB,SAnaX,GAmaI,mBAAiBwB,KAAjB,EAA0C;AAEtC,QAAIA,KAAK,IAAIA,KAAK,YAAYJ,YAA9B,EAA4C;AACxC,aAAO,IAAP;AACH;;AAED,WAAOpB,eAAS,CAACwB,KAAD,CAAhB;AACH,GA1aL;;AAAA,eA4aWoC,KA5aX,GA4aI,iBAAoC;AAChC,WAAO1C,WAAW,CAACE,YAAD,CAAlB;AACH,GA9aL;;AAAA;AAAA,I;;;;ACJO,SAASzG,mBAAT,GAAiC;AACpC,SAAOlE,MAAM,CAACmE,SAAP,CAAiBC,aAAjB,IAAkCpE,MAAM,CAACmE,SAAP,CAAiBE,SAA1D;AACH;AAEM,SAAS+I,QAAT,CAAkB/I,SAAlB,EAAkE;AAAA,MAAhDA,SAAgD;AAAhDA,aAAgD,GAA1BH,mBAAY,EAAc;AAAA;;AACrE,MAAIG,SAAS,CAAC4C,KAAV,CAAgB,sGAAhB,CAAJ,EAA6H;AACzH,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASoG,SAAT,GAA+B;AAClC,MAAIhJ,SAAS,GAAGH,mBAAY,EAA5B;AACA,SAAQ,wDAAD,CAA2DoJ,IAA3D,CAAgEjJ,SAAhE,KACF,QAAD,CAAWiJ,IAAX,CAAgBjJ,SAAhB,CADG,IAEN,+BAAD,CAAkCiJ,IAAlC,CAAuCjJ,SAAvC,CAFA;AAGH;AAEM,SAASkJ,YAAT,GAAkC;AACrC,SAAQvN,MAAM,CAACmE,SAAP,CAAiBqJ,UAAjB,KAAgC,IAAhC,IAAwCxN,MAAM,CAACyN,UAAP,CAAkB,4BAAlB,EAAgDC,OAAhG;AACH;AAEM,SAASC,iBAAT,CAA2BC,EAA3B,EAAoE;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AACvE,SAAQ0J,EAAE,CAAC3M,OAAH,CAAW,MAAX,MAAuB,CAAC,CAAzB,IAAgC2M,EAAE,CAAC3M,OAAH,CAAW,MAAX,MAAuB,CAAC,CAA/D;AACH;AAEM,SAAS4M,YAAT,CAAsBD,EAAtB,EAA+D;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AAClE,SAAQ,QAAD,CAAWoJ,IAAX,CAAgBM,EAAhB,CAAP;AACH;AAEM,SAASE,SAAT,CAAmBF,EAAnB,EAA4D;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AAC/D,SAAQ,SAAD,CAAYoJ,IAAZ,CAAiBM,EAAjB,CAAP;AACH;AAEM,SAASG,WAAT,CAAqBH,EAArB,EAA8D;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AACjE,SAAO0J,EAAE,CAAC3M,OAAH,CAAW,YAAX,IAA2B,CAAC,CAAnC;AACH;AAEM,SAAS+M,SAAT,CAAmBJ,EAAnB,EAA4D;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AAC/D,SAAQ,SAAD,CAAYoJ,IAAZ,CAAiBM,EAAjB,CAAP;AACH;AAEM,SAASK,KAAT,CAAeL,EAAf,EAAwD;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AAC3D,SAAQ,kBAAD,CAAqBoJ,IAArB,CAA0BM,EAA1B,CAAP;AACH;AAEM,SAASM,iBAAT,CAA2BN,EAA3B,EAAoE;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AACvE,SAAQ,SAAD,CAAYoJ,IAAZ,CAAiBM,EAAjB,CAAP;AACH;AAEM,SAASO,WAAT,CAAqBP,EAArB,EAA8D;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AACjE,SAAQ,WAAD,CAAcoJ,IAAd,CAAmBM,EAAnB,CAAP;AACH;AAEM,SAASQ,YAAT,CAAsBR,EAAtB,EAA+D;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AAClE,MAAI+J,KAAK,CAACL,EAAD,CAAT,EAAe;AACX,QAAIM,iBAAiB,CAACN,EAAD,CAArB,EAA2B;AACvB,aAAO,IAAP;AACH;;AACD,WAAQ,2BAAD,CAA8BN,IAA9B,CAAmCM,EAAnC,CAAP;AACH;;AACD,SAAO,KAAP;AACH;AAEM,SAASS,gBAAT,CAA0BT,EAA1B,EAAmE;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AACtE,MAAI8J,SAAS,CAACJ,EAAD,CAAb,EAAmB;AACf,WAAQ,iBAAD,CAAoBN,IAApB,CAAyBM,EAAzB,KAAgC,CAACG,WAAW,CAACH,EAAD,CAAnD;AACH;;AACD,SAAO,KAAP;AACH;AAEM,SAASU,WAAT,GAA0B;AAE7B,MAAItO,MAAM,CAACoJ,QAAP,CAAgBmF,YAApB,EAAkC;AAC9B,WAAO,IAAP;AACH;;AAED,SAAOjJ,OAAO,CACVtF,MAAM,CAACmE,SAAP,IACAnE,MAAM,CAACmE,SAAP,CAAiBE,SADjB,IAEC,kBAAD,CAAqBiJ,IAArB,CAA0BtN,MAAM,CAACmE,SAAP,CAAiBE,SAA3C,CAHU,CAAd;AAKH;AAEM,SAASmK,cAAT,GAAoC;AACvC,MAAIC,KAAK,GAAGzO,MAAM,CAACoJ,QAAP,CAAgBsF,aAAhB,CAA8B,oCAA9B,CAAZ;AACA,MAAIC,QAAQ,GAAG3O,MAAM,CAACoJ,QAAP,CAAgBsF,aAAhB,CAA8B,yBAA9B,CAAf;;AACA,MAAID,KAAK,IAAIE,QAAb,EAAuB;AACnB,WAAO,IAAP;AACH;;AACD,SAAO,KAAP;AACH;AAEM,SAASC,UAAT,GAAgC;AACnC,MAAI,OAAOC,OAAP,KAAmB,WAAnB,IAAkCA,OAAO,CAACC,QAA1C,IAAsDD,OAAO,CAACC,QAAR,CAAiBC,QAA3E,EAAqF;AACjF,WAAO,IAAP;AACH;;AACD,SAAO,KAAP;AACH;AAEM,SAASC,YAAT,GAAkC;AAErC;AAEA,MAAIhP,MAAM,CAACoJ,QAAP,CAAgBmF,YAApB,EAAkC;AAC9B,QAAI;AACA,UAAIU,MAAM,GAAGjP,MAAM,CAACiP,MAApB;AAEAjP,YAAM,CAACiP,MAAP,GAAgB,kBAAhB;;AAEA,UAAIjP,MAAM,CAACiP,MAAP,KAAkB,kBAAtB,EAA0C;AACtCjP,cAAM,CAACiP,MAAP,GAAgBA,MAAhB;AAEA,eAAO,IAAP;AACH;;AAED,aAAO,KAAP;AAEH,KAbD,CAaE,OAAO3O,GAAP,EAAY;AAEV,aAAO,KAAP;AACH;AACJ;;AAED,SAAO,KAAP;AACH;AAEM,SAAS4O,UAAT,GAAgC;AACnC,MAAI7K,SAAS,GAAGH,mBAAY,EAA5B;AACA,SAAQ,qCAAD,CAAwCoJ,IAAxC,CAA6CjJ,SAA7C,CAAP;AACH;AAEM,SAAS8K,cAAT,CAAwBvB,EAAxB,EAAiE;AAAA,MAAzCA,EAAyC;AAAzCA,MAAyC,GAA1B1J,mBAAY,EAAc;AAAA;;AACpE,SAAO,EAAEkK,YAAY,CAACR,EAAD,CAAZ,IAAoBS,gBAAgB,CAACT,EAAD,CAApC,IAA4CG,WAAW,CAACH,EAAD,CAAvD,IACLC,YAAY,CAACD,EAAD,CADP,IACeE,SAAS,CAACF,EAAD,CADxB,IACgCD,iBAAiB,CAACC,EAAD,CADjD,IACyDO,WAAW,CAACP,EAAD,CADpE,IAC4EgB,UAAU,EADtF,IAC4FM,UAAU,EADtG,IAC4G3B,YAAY,EAD1H,CAAP;AAEH,C;;AC1Ic,SAAS6B,QAAT,GAAoB;AACjCA,UAAQ,GAAGpQ,MAAM,CAACqQ,MAAP,IAAiB,UAAUC,MAAV,EAAkB;AAC5C,SAAK,IAAInN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoN,SAAS,CAACrN,MAA9B,EAAsCC,CAAC,EAAvC,EAA2C;AACzC,UAAIqN,MAAM,GAAGD,SAAS,CAACpN,CAAD,CAAtB;;AAEA,WAAK,IAAI0K,GAAT,IAAgB2C,MAAhB,EAAwB;AACtB,YAAIxQ,MAAM,CAACC,SAAP,CAAiBwQ,cAAjB,CAAgCtQ,IAAhC,CAAqCqQ,MAArC,EAA6C3C,GAA7C,CAAJ,EAAuD;AACrDyC,gBAAM,CAACzC,GAAD,CAAN,GAAc2C,MAAM,CAAC3C,GAAD,CAApB;AACD;AACF;AACF;;AAED,WAAOyC,MAAP;AACD,GAZD;;AAcA,SAAOF,QAAQ,CAAClC,KAAT,CAAe,IAAf,EAAqBqC,SAArB,CAAP;AACD,C;;ACdM,SAASG,gBAAT,GAAsC;AAEzC,MAAI,OAAOC,OAAP,KAAmB,WAAvB,EAAoC;AAChC,WAAO,KAAP;AACH;;AAED,MAAI,OAAO3Q,MAAM,CAAC4Q,MAAd,KAAyB,WAA7B,EAA0C;AACtC,WAAO,KAAP;AACH;;AAED,MAAI;AAEA,QAAIC,WAAW,GAAG,IAAIF,OAAJ,EAAlB;AACA,QAAIG,OAAO,GAAG,EAAd;AACA,QAAIC,SAAS,GAAG,eAAhB;AAEA/Q,UAAM,CAAC4Q,MAAP,CAAcE,OAAd;AAEAD,eAAW,CAACG,GAAZ,CAAgBF,OAAhB,EAAyBC,SAAzB;;AAEA,QAAIF,WAAW,CAACI,GAAZ,CAAgBH,OAAhB,MAA6BC,SAAjC,EAA4C;AACxC,aAAO,IAAP;AACH;;AAED,WAAO,KAAP;AAEH,GAhBD,CAgBE,OAAOzP,GAAP,EAAY;AAEV,WAAO,KAAP;AACH;AACJ,C;;AC9BM,SAAS+C,gBAAT,CAAwBC,UAAxB,EAA+CvE,IAA/C,EAAkE;AACrE,OAAK,IAAIoD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmB,UAAU,CAACpB,MAA/B,EAAuCC,CAAC,EAAxC,EAA4C;AAExC,QAAI;AACA,UAAImB,UAAU,CAACnB,CAAD,CAAV,KAAkBpD,IAAtB,EAA4B;AACxB,eAAOoD,CAAP;AACH;AACJ,KAJD,CAIE,OAAO7B,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAO,CAAC,CAAR;AACH,C,CAED;;AACO,SAASlB,SAAT,GAAsC,CACzC;AACH,C;;AClBD;AAEA;AACA;AAEO,IAAM8Q,8BAAb;AAAA;AAAA;AAOI,oCAAc;AAAA,SALd3L,IAKc;AAAA,SAJd4L,OAIc;AAAA,SAHdxD,IAGc;AAAA,SAFdyD,MAEc;AACV;AACA,SAAK7L,IAAL,mBAA0B8L,IAAI,CAACC,MAAL,KAAgB,GAAhB,KAAwB,CAAlD;;AAEA,QAAIZ,gBAAgB,EAApB,EAAwB;AACpB,UAAI;AACA,aAAKS,OAAL,GAAe,IAAIR,OAAJ,EAAf;AACH,OAFD,CAEE,OAAOrP,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAKqM,IAAL,GAAa,EAAb;AACA,SAAKyD,MAAL,GAAc,EAAd;AACH;;AArBL;;AAAA,SAuBIG,qBAvBJ,GAuBI,iCAAwB;AAEpB,QAAIJ,OAAO,GAAG,KAAKA,OAAnB;AACA,QAAIxD,IAAI,GAAG,KAAKA,IAAhB;;AAEA,SAAK,IAAIxK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwK,IAAI,CAACzK,MAAzB,EAAiCC,CAAC,EAAlC,EAAsC;AAClC,UAAI4I,KAAK,GAAG4B,IAAI,CAACxK,CAAD,CAAhB;;AAEA,UAAImG,QAAQ,CAACyC,KAAD,CAAR,IAAmBtH,cAAc,CAACsH,KAAD,CAArC,EAA8C;AAE1C,YAAIoF,OAAJ,EAAa;AACT,cAAI;AACAA,mBAAO,CAACK,MAAR,CAAezF,KAAf;AACH,WAFD,CAEE,OAAOzK,GAAP,EAAY,CACV;AACH;AACJ;;AAEDqM,YAAI,CAAC3I,MAAL,CAAY7B,CAAZ,EAAe,CAAf;AACA,aAAKiO,MAAL,CAAYpM,MAAZ,CAAmB7B,CAAnB,EAAsB,CAAtB;AAEAA,SAAC,IAAI,CAAL;AACH;AACJ;AACJ,GA/CL;;AAAA,SAiDIsO,iBAjDJ,GAiDI,2BAAkB5D,GAAlB,EAAqC;AAEjC,QAAIvE,QAAQ,CAACuE,GAAD,CAAZ,EAAmB;AACf,aAAO,KAAP;AACH;;AAED,QAAI;AACAzN,eAAI,CAACyN,GAAG,IAAIA,GAAG,CAACpE,IAAZ,CAAJ;AACArJ,eAAI,CAACyN,GAAG,IAAIA,GAAG,CAAC,KAAKtI,IAAN,CAAX,CAAJ;AACH,KAHD,CAGE,OAAOjE,GAAP,EAAY;AACV,aAAO,KAAP;AACH;;AAED,WAAO,IAAP;AACH,GA/DL;;AAAA,SAiEI0P,GAjEJ,GAiEI,aAAInD,GAAJ,EAAa9B,KAAb,EAAwB;AAEpB,QAAI,CAAC8B,GAAL,EAAU;AACN,YAAM,IAAIjM,KAAJ,wBAAN;AACH;;AAED,QAAIuP,OAAO,GAAG,KAAKA,OAAnB;;AAEA,QAAIA,OAAJ,EAAa;AACT,UAAI;AACAA,eAAO,CAACH,GAAR,CAAYnD,GAAZ,EAAiB9B,KAAjB;AACH,OAFD,CAEE,OAAOzK,GAAP,EAAY;AACV,eAAO,KAAK6P,OAAZ;AACH;AACJ;;AAED,QAAI,KAAKM,iBAAL,CAAuB5D,GAAvB,CAAJ,EAAiC;AAC7B,UAAI;AACA,YAAItI,IAAI,GAAG,KAAKA,IAAhB;AACA,YAAImM,KAAK,GAAG7D,GAAG,CAACtI,IAAD,CAAf;;AAEA,YAAImM,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa7D,GAA1B,EAA+B;AAC3B6D,eAAK,CAAC,CAAD,CAAL,GAAW3F,KAAX;AACH,SAFD,MAEO;AACH/L,gBAAM,CAAC2R,cAAP,CAAsB9D,GAAtB,EAA2BtI,IAA3B,EAAiC;AAC7BwG,iBAAK,EAAK,CAAE8B,GAAF,EAAO9B,KAAP,CADmB;AAE7B6F,oBAAQ,EAAE;AAFmB,WAAjC;AAIH;;AAED;AAEH,OAfD,CAeE,OAAOtQ,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAKiQ,qBAAL;;AAEA,QAAI5D,IAAI,GAAG,KAAKA,IAAhB;AACA,QAAIyD,MAAM,GAAG,KAAKA,MAAlB;AACA,QAAIS,KAAK,GAAGxN,gBAAW,CAACsJ,IAAD,EAAOE,GAAP,CAAvB;;AAEA,QAAIgE,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdlE,UAAI,CAAChL,IAAL,CAAUkL,GAAV;AACAuD,YAAM,CAACzO,IAAP,CAAYoJ,KAAZ;AACH,KAHD,MAGO;AACHqF,YAAM,CAACS,KAAD,CAAN,GAAgB9F,KAAhB;AACH;AACJ,GAlHL;;AAAA,SAoHIkF,GApHJ,GAoHI,aAAIpD,GAAJ,EAAwB;AAEpB,QAAI,CAACA,GAAL,EAAU;AACN,YAAM,IAAIjM,KAAJ,wBAAN;AACH;;AAED,QAAIuP,OAAO,GAAG,KAAKA,OAAnB;;AAEA,QAAIA,OAAJ,EAAa;AACT,UAAI;AACA,YAAIA,OAAO,CAACW,GAAR,CAAYjE,GAAZ,CAAJ,EAAsB;AAClB,iBAAOsD,OAAO,CAACF,GAAR,CAAYpD,GAAZ,CAAP;AACH;AAEJ,OALD,CAKE,OAAOvM,GAAP,EAAY;AACV,eAAO,KAAK6P,OAAZ;AACH;AACJ;;AAED,QAAI,KAAKM,iBAAL,CAAuB5D,GAAvB,CAAJ,EAAiC;AAC7B,UAAI;AACA,YAAI6D,KAAK,GAAG7D,GAAG,CAAC,KAAKtI,IAAN,CAAf;;AAEA,YAAImM,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa7D,GAA1B,EAA+B;AAC3B,iBAAO6D,KAAK,CAAC,CAAD,CAAZ;AACH;;AAED;AACH,OARD,CAQE,OAAOpQ,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAKiQ,qBAAL;;AAEA,QAAI5D,IAAI,GAAG,KAAKA,IAAhB;AACA,QAAIkE,KAAK,GAAGxN,gBAAW,CAACsJ,IAAD,EAAOE,GAAP,CAAvB;;AAEA,QAAIgE,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd;AACH;;AAED,WAAO,KAAKT,MAAL,CAAYS,KAAZ,CAAP;AACH,GA/JL;;AAAA,SAiKIL,MAjKJ,GAiKI,iBAAO3D,GAAP,EAAgB;AAEZ,QAAI,CAACA,GAAL,EAAU;AACN,YAAM,IAAIjM,KAAJ,wBAAN;AACH;;AAED,QAAIuP,OAAO,GAAG,KAAKA,OAAnB;;AAEA,QAAIA,OAAJ,EAAa;AACT,UAAI;AACAA,eAAO,CAACK,MAAR,CAAe3D,GAAf;AACH,OAFD,CAEE,OAAOvM,GAAP,EAAY;AACV,eAAO,KAAK6P,OAAZ;AACH;AACJ;;AAED,QAAI,KAAKM,iBAAL,CAAuB5D,GAAvB,CAAJ,EAAiC;AAC7B,UAAI;AACA,YAAI6D,KAAK,GAAG7D,GAAG,CAAC,KAAKtI,IAAN,CAAf;;AAEA,YAAImM,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa7D,GAA1B,EAA+B;AAC3B6D,eAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAL,GAAW3E,SAAtB;AACH;AACJ,OAND,CAME,OAAOzL,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAKiQ,qBAAL;;AAEA,QAAI5D,IAAI,GAAG,KAAKA,IAAhB;AACA,QAAIkE,KAAK,GAAGxN,gBAAW,CAACsJ,IAAD,EAAOE,GAAP,CAAvB;;AAEA,QAAIgE,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdlE,UAAI,CAAC3I,MAAL,CAAY6M,KAAZ,EAAmB,CAAnB;AACA,WAAKT,MAAL,CAAYpM,MAAZ,CAAmB6M,KAAnB,EAA0B,CAA1B;AACH;AACJ,GAtML;;AAAA,SAwMIC,GAxMJ,GAwMI,aAAIjE,GAAJ,EAAuB;AAEnB,QAAI,CAACA,GAAL,EAAU;AACN,YAAM,IAAIjM,KAAJ,wBAAN;AACH;;AAED,QAAIuP,OAAO,GAAG,KAAKA,OAAnB;;AAEA,QAAIA,OAAJ,EAAa;AACT,UAAI;AACA,YAAIA,OAAO,CAACW,GAAR,CAAYjE,GAAZ,CAAJ,EAAsB;AAClB,iBAAO,IAAP;AACH;AACJ,OAJD,CAIE,OAAOvM,GAAP,EAAY;AACV,eAAO,KAAK6P,OAAZ;AACH;AACJ;;AAED,QAAI,KAAKM,iBAAL,CAAuB5D,GAAvB,CAAJ,EAAiC;AAC7B,UAAI;AACA,YAAI6D,KAAK,GAAG7D,GAAG,CAAC,KAAKtI,IAAN,CAAf;;AAEA,YAAImM,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa7D,GAA1B,EAA+B;AAC3B,iBAAO,IAAP;AACH;;AAED,eAAO,KAAP;AACH,OARD,CAQE,OAAOvM,GAAP,EAAY,CACV;AACH;AACJ;;AAED,SAAKiQ,qBAAL;;AAEA,QAAIM,KAAK,GAAGxN,gBAAW,CAAC,KAAKsJ,IAAN,EAAYE,GAAZ,CAAvB;AACA,WAAOgE,KAAK,KAAK,CAAC,CAAlB;AACH,GA5OL;;AAAA,SA8OIE,QA9OJ,GA8OI,kBAASlE,GAAT,EAAkBmE,MAAlB,EAAwC;AACpC,QAAI,KAAKF,GAAL,CAASjE,GAAT,CAAJ,EAAmB;AACf;AACA,aAAO,KAAKoD,GAAL,CAASpD,GAAT,CAAP;AACH;;AAED,QAAI9B,KAAK,GAAGiG,MAAM,EAAlB;AACA,SAAKhB,GAAL,CAASnD,GAAT,EAAc9B,KAAd;AACA,WAAOA,KAAP;AACH,GAvPL;;AAAA;AAAA,I;;;;ACNA;AAEA;AACA;AAIO,SAASkG,eAAT,CAAwCC,EAAxC,EAAyD;AAC5D,SAAOA,EAAE,CAAC3M,IAAH,IAAW2M,EAAE,CAACC,QAAd,IAA0BD,EAAE,CAACE,WAA7B,IAA4C,WAAnD;AACH;AAEM,SAASC,eAAT,CAAwCH,EAAxC,EAAgD3M,IAAhD,EAAmE;AACtE,MAAI;AACA,WAAO2M,EAAE,CAAC3M,IAAV;AACA2M,MAAE,CAAC3M,IAAH,GAAUA,IAAV;AACH,GAHD,CAGE,OAAOjE,GAAP,EAAY,CACV;AACH;;AAED4Q,IAAE,CAACC,QAAH,GAAcD,EAAE,CAACE,WAAH,GAAiB7M,IAA/B;AACA,SAAO2M,EAAP;AACH;AAEM,SAASI,YAAT,CAAsBC,GAAtB,EAA6C;AAChD,MAAI,OAAOC,IAAP,KAAgB,UAApB,EAAgC;AAC5B,WAAOA,IAAI,CAACC,kBAAkB,CAACF,GAAD,CAAlB,CAAwBxI,OAAxB,CAAgC,iBAAhC,EAAmD,UAAC2I,CAAD,EAAIC,EAAJ,EAAW;AACtE,aAAOC,MAAM,CAACC,YAAP,CAAoBC,QAAQ,CAACH,EAAD,EAAK,EAAL,CAA5B,CAAP;AACH,KAFW,CAAD,CAAX;AAGH;;AAED,MAAI,OAAOI,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAOA,MAAM,CAACC,IAAP,CAAYT,GAAZ,EAAiB,MAAjB,EAAyBrS,QAAzB,CAAkC,QAAlC,CAAP;AACH;;AAED,QAAM,IAAI0B,KAAJ,sCAAN;AACH;AAEM,SAASqR,YAAT,CAAsBV,GAAtB,EAA6C;AAChD,MAAI,OAAOW,IAAP,KAAgB,UAApB,EAAgC;AAC5B,WAAOC,kBAAkB,CAACpL,KAAK,CAAC9H,SAAN,CAAgB2N,GAAhB,CAAoBzN,IAApB,CAAyB+S,IAAI,CAACX,GAAD,CAA7B,EAAoC,UAAAa,CAAC,EAAI;AAC/D;AACA,aAAO,MAAM,CAAC,OAAOA,CAAC,CAACC,UAAF,CAAa,CAAb,EAAgBnT,QAAhB,CAAyB,EAAzB,CAAR,EAAsCyI,KAAtC,CAA4C,CAAC,CAA7C,CAAb;AACH,KAHyB,EAGvBJ,IAHuB,CAGlB,EAHkB,CAAD,CAAzB;AAIH;;AAED,MAAI,OAAOwK,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAOA,MAAM,CAACC,IAAP,CAAYT,GAAZ,EAAiB,QAAjB,EAA2BrS,QAA3B,CAAoC,MAApC,CAAP;AACH;;AAED,QAAM,IAAI0B,KAAJ,sCAAN;AACH;AAEM,SAAS0R,QAAT,GAA6B;AAEhC,MAAIC,KAAK,GAAG,kBAAZ;AAEA,MAAIC,QAAQ,GAAG,aAAazJ,OAAb,CAAqB,IAArB,EAA2B,YAAM;AAC5C,WAAOwJ,KAAK,CAACE,MAAN,CAAapC,IAAI,CAACqC,KAAL,CAAWrC,IAAI,CAACC,MAAL,KAAgBiC,KAAK,CAACrQ,MAAjC,CAAb,CAAP;AACH,GAFc,CAAf;AAIA,MAAIyQ,MAAM,GAAGrB,YAAY,CACrB,IAAIsB,IAAJ,GAAWC,WAAX,GAAyBlL,KAAzB,CAA+B,EAA/B,EAAmC,EAAnC,EAAuCoB,OAAvC,CAA+C,GAA/C,EAAoD,GAApD,CADqB,CAAZ,CAEXA,OAFW,CAEH,eAFG,EAEc,EAFd,EAEkB+J,WAFlB,EAAb;AAIA,SAAWN,QAAX,SAAyBG,MAAzB;AACH;AAEM,SAASI,SAAT,GAA8B;AACjC,MAAI,OAAO/S,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAOA,MAAP;AACH;;AACD,MAAI,OAAOgT,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAOA,MAAP;AACH;;AACD,MAAI,OAAOC,MAAP,KAAsB,WAA1B,EAAuC;AACnC,WAAOA,MAAP;AACH;;AACD,QAAM,IAAIrS,KAAJ,mBAAN;AACH;AAED,IAAIsS,SAAJ;AAEO,SAASC,WAAT,CAAqB5K,GAArB,EAA4C;AAE/C2K,WAAS,GAAGA,SAAS,IAAI,IAAIvD,8BAAJ,EAAzB;;AAEA,MAAIpH,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAKwD,SAAxB,IAAsC,OAAOxD,GAAP,KAAe,QAAf,IAA2B,OAAOA,GAAP,KAAe,UAApF,EAAiG;AAC7F,UAAM,IAAI3H,KAAJ,kBAAN;AACH;;AAED,MAAIwS,GAAG,GAAGF,SAAS,CAACjD,GAAV,CAAc1H,GAAd,CAAV;;AAEA,MAAI,CAAC6K,GAAL,EAAU;AACNA,OAAG,GAAO,OAAO7K,GAAd,SAAuB+J,QAAQ,EAAlC;AACAY,aAAS,CAAClD,GAAV,CAAczH,GAAd,EAAmB6K,GAAnB;AACH;;AAED,SAAOA,GAAP;AACH;;AAED,SAASC,aAAT,CAA0BpG,IAA1B,EAAoD;AAChD,MAAI;AACA,WAAO/F,IAAI,CAACC,SAAL,CAAeJ,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBxI,IAAtB,CAA2B8N,IAA3B,CAAf,EAAiD,UAACqG,MAAD,EAASC,GAAT,EAAiB;AACrE,UAAI,OAAOA,GAAP,KAAe,UAAnB,EAA+B;AAC3B,4BAAmBJ,WAAW,CAACI,GAAD,CAA9B;AACH;;AACD,aAAOA,GAAP;AACH,KALM,CAAP;AAMH,GAPD,CAOE,OAAOjT,GAAP,EAAY;AACV,UAAM,IAAIM,KAAJ,4DAAN;AACH;AACJ;;AACM,SAAS4S,OAAT,CAAkIzG,MAAlI,EAA8I0G,OAA9I,EAA+M;AAAA;;AAAA,MAAjEA,OAAiE;AAAjEA,WAAiE,GAAR,EAAQ;AAAA;;AAClN,MAAIC,QAAQ,GAAG,IAAI/D,8BAAJ,EAAf,CADkN,CAGlN;;AACA,MAAIgE,gBAAoB,GAAG,SAASA,gBAAT,GAAkD;AAAA,sCAArB1G,IAAqB;AAArBA,UAAqB;AAAA;;AACzE,QAAI2G,KAAK,GAAGF,QAAQ,CAAC3C,QAAT,CAAkB0C,OAAO,CAACI,aAAR,GAAwB,IAAxB,GAA+B9G,MAAjD,EAAyD;AAAA,aAAO,EAAP;AAAA,KAAzD,CAAZ;AAEA,QAAIF,GAAY,GAAGwG,aAAa,CAACpG,IAAD,CAAhC;AAEA,QAAI6G,SAAS,GAAGL,OAAO,CAACtH,IAAxB;;AACA,QAAIyH,KAAK,CAAC/G,GAAD,CAAL,IAAciH,SAAd,IAA4BlB,IAAI,CAACmB,GAAL,KAAaH,KAAK,CAAC/G,GAAD,CAAL,CAAWV,IAAzB,GAAiC2H,SAAhE,EAA2E;AACvE,aAAOF,KAAK,CAAC/G,GAAD,CAAZ;AACH;;AAED,QAAI+G,KAAK,CAAC/G,GAAD,CAAT,EAAgB;AACZ,aAAO+G,KAAK,CAAC/G,GAAD,CAAL,CAAW9B,KAAlB;AACH;;AAED,QAAIoB,IAAI,GAAIyG,IAAI,CAACmB,GAAL,EAAZ;AACA,QAAIhJ,KAAK,GAAGgC,MAAM,CAACG,KAAP,CAAa,IAAb,EAAmBqC,SAAnB,CAAZ;AAEAqE,SAAK,CAAC/G,GAAD,CAAL,GAAa;AAAEV,UAAI,EAAJA,IAAF;AAAQpB,WAAK,EAALA;AAAR,KAAb;AAEA,WAAO6I,KAAK,CAAC/G,GAAD,CAAL,CAAW9B,KAAlB;AACH,GApBD;;AAsBA4I,kBAAgB,CAACK,KAAjB,GAAyB,YAAM;AAC3BN,YAAQ,CAAClD,MAAT,CAAgBiD,OAAO,CAACI,aAAR,GAAwB,KAAxB,GAA+B9G,MAA/C;AACH,GAFD;;AAIA,SAAOsE,eAAe,CAACsC,gBAAD,EAAuB1C,eAAe,CAAClE,MAAD,CAAtC,gBAAtB;AACH;AAEM,SAASkH,eAAT,CAAoClV,IAApC,EAAkF;AACrF;AACA,SAAO4L,oBAAY,CAACL,OAAb,CAAqBvL,IAArB,CAAP;AACH,C,CAED;;AACO,SAASmV,cAAT,CAA2BnH,MAA3B,EAA6H;AAChI,MAAI6G,KAAK,GAAG,EAAZ,CADgI,CAGhI;;AACA,WAASO,uBAAT,GAAyE;AAAA;AAAA;;AAAA,uCAArClH,IAAqC;AAArCA,UAAqC;AAAA;;AACrE,QAAIJ,GAAY,GAAGwG,aAAa,CAACpG,IAAD,CAAhC;;AAEA,QAAI2G,KAAK,CAACnE,cAAN,CAAqB5C,GAArB,CAAJ,EAA+B;AAC3B,aAAO+G,KAAK,CAAC/G,GAAD,CAAZ;AACH;;AAED+G,SAAK,CAAC/G,GAAD,CAAL,GAAalC,oBAAY,CAACuB,GAAb,CAAiB;AAAA,aAAMa,MAAM,CAACG,KAAP,CAAa,MAAb,EAAmBqC,UAAnB,CAAN;AAAA,KAAjB,EACRvD,OADQ,CACA,YAAM;AACX,aAAO4H,KAAK,CAAC/G,GAAD,CAAZ;AACH,KAHQ,CAAb;AAKA,WAAO+G,KAAK,CAAC/G,GAAD,CAAZ;AACH;;AAEDsH,yBAAuB,CAACH,KAAxB,GAAgC,YAAM;AAClCJ,SAAK,GAAG,EAAR;AACH,GAFD;;AAIA,SAAOvC,eAAe,CAAC8C,uBAAD,EAA8BlD,eAAe,CAAClE,MAAD,CAA7C,uBAAtB;AACH,C,CAED;;AACO,SAASqH,SAAT,CAAsBrH,MAAtB,EAA4D0G,OAA5D,EAA6I;AAAA,MAAjFA,OAAiF;AAAjFA,WAAiF,GAAlD,EAAkD;AAAA;;AAChJ,WAASY,mBAAT,GAAiD;AAC7C,WAAO1J,oBAAY,CAACuB,GAAb,CAAiBa,MAAjB,EAAyB,IAAzB,EAA+BwC,SAA/B,CAAP;AACH;;AAED,MAAIkE,OAAO,CAAClP,IAAZ,EAAkB;AACd8P,uBAAmB,CAACjD,WAApB,GAAsCqC,OAAO,CAAClP,IAA9C;AACH;;AAED,SAAO8M,eAAe,CAACgD,mBAAD,EAA0BpD,eAAe,CAAClE,MAAD,CAAzC,mBAAtB;AACH,C,CAED;;AACO,SAASuH,aAAT,CAA0BvH,MAA1B,EAAgEwH,KAAhE,EAAqGtH,IAArG,EAAiI;AAAA,MAA5BA,IAA4B;AAA5BA,QAA4B,GAAR,EAAQ;AAAA;;AACpI;AACA,MAAI2G,KAAK,GAAG7G,MAAM,CAACyH,wBAAP,GAAkCzH,MAAM,CAACyH,wBAAP,IAAmC,EAAjF;AACA,MAAI3H,GAAG,GAAGwG,aAAa,CAACpG,IAAD,CAAvB;;AAEA,MAAI2G,KAAK,CAACnE,cAAN,CAAqB5C,GAArB,CAAJ,EAA+B;AAC3B,WAAO+G,KAAK,CAAC/G,GAAD,CAAZ;AACH;;AAED,MAAInL,MAAM,GAAGkS,KAAK,CAAC/G,GAAD,CAAL,GAAa0H,KAAK,MAAL,SAAStH,IAAT,CAA1B;AAEA,SAAOvL,MAAP;AACH,C,CAED;;AACO,SAAStC,aAAT,GAAsC,CACzC;AACH;AAEM,SAASqV,IAAT,CAAc1H,MAAd,EAA4C;AAC/C,MAAI2H,MAAM,GAAG,KAAb;;AAEA,MAAMC,YAAY,GAAG,SAAfA,YAAe,GAAmB;AACpC,QAAI,CAACD,MAAL,EAAa;AACTA,YAAM,GAAG,IAAT;AACA,aAAO3H,MAAM,CAACG,KAAP,CAAa,IAAb,EAAmBqC,SAAnB,CAAP;AACH;AACJ,GALD;;AAOA,SAAO8B,eAAe,CAACsD,YAAD,EAAmB1D,eAAe,CAAClE,MAAD,CAAlC,YAAtB;AACH;AAEM,SAAS6H,OAAT,CAAiBrD,GAAjB,EAAwC;AAC3C,MAAI7E,IAAI,GAAG,CAAX;;AACA,OAAK,IAAIvK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoP,GAAG,CAACrP,MAAxB,EAAgCC,CAAC,EAAjC,EAAqC;AACjCuK,QAAI,IAAI6E,GAAG,CAACpP,CAAD,CAAH,CAAOkQ,UAAP,CAAkB,CAAlB,IAAuBhC,IAAI,CAACwE,GAAL,CAAU1S,CAAC,GAAG,EAAL,GAAW,CAApB,EAAuB,CAAvB,CAA/B;AACH;;AACD,SAAOkO,IAAI,CAACqC,KAAL,CAAWrC,IAAI,CAACwE,GAAL,CAASxE,IAAI,CAACyE,IAAL,CAAUpI,IAAV,CAAT,EAA0B,CAA1B,CAAX,CAAP;AACH;AAEM,SAASqI,UAAT,CAAoBxD,GAApB,EAA2C;AAC9C,MAAI7E,IAAI,GAAG,EAAX;;AAEA,OAAK,IAAIvK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoP,GAAG,CAACrP,MAAxB,EAAgCC,CAAC,EAAjC,EAAqC;AACjC,QAAI6S,KAAK,GAAIzD,GAAG,CAACpP,CAAD,CAAH,CAAOkQ,UAAP,CAAkB,CAAlB,IAAuBlQ,CAApC;;AAEA,QAAIoP,GAAG,CAACpP,CAAC,GAAG,CAAL,CAAP,EAAgB;AACZ6S,WAAK,IAAKzD,GAAG,CAACpP,CAAC,GAAG,CAAL,CAAH,CAAWkQ,UAAX,CAAsB,CAAtB,KAA4BlQ,CAAC,GAAG,CAAhC,CAAV;AACH;;AAEDuK,QAAI,IAAIkF,MAAM,CAACC,YAAP,CAAoB,KAAMxB,IAAI,CAAC4E,GAAL,CAASD,KAAT,IAAkB,EAA5C,CAAR;AACH;;AAED,SAAOtI,IAAP;AACH;AAEM,SAASzF,UAAT,CAAesK,GAAf,EAA6B1K,OAA7B,EAAyD;AAC5D,MAAIqO,QAAQ,GAAG3D,GAAG,CAACtK,KAAJ,CAAUJ,OAAV,CAAf;;AACA,MAAIqO,QAAJ,EAAc;AACV,WAAOA,QAAQ,CAAC,CAAD,CAAf;AACH;AACJ;AAEM,SAASC,QAAT,CAA4B5M,GAA5B,EAA0CsE,GAA1C,EAA0E;AAC7E,SAAO,IAAIlC,oBAAJ,CAAiB,UAAAL,OAAO,EAAI;AAE/B,QAAIS,KAAK,GAAGxC,GAAG,CAACsE,GAAD,CAAf;;AAEA,QAAI9B,KAAJ,EAAW;AACP,aAAOT,OAAO,CAACS,KAAD,CAAd;AACH;;AAED,WAAOxC,GAAG,CAACsE,GAAD,CAAV;AAEA7N,UAAM,CAAC2R,cAAP,CAAsBpI,GAAtB,EAA2BsE,GAA3B,EAAgC;AAE5BuI,kBAAY,EAAE,IAFc;AAI5BpF,SAJ4B,eAIxBjR,IAJwB,EAIlB;AACNgM,aAAK,GAAGhM,IAAR;;AAEA,YAAIgM,KAAJ,EAAW;AACPT,iBAAO,CAACS,KAAD,CAAP;AACH;AACJ,OAV2B;AAY5BkF,SAZ4B,iBAYd;AACV,eAAOlF,KAAP;AACH;AAd2B,KAAhC;AAgBH,GA1BM,CAAP;AA2BH;AAEM,SAASsK,cAAT,CAAwB/U,GAAxB,EAAqCgV,KAArC,EAAkE;AAAA,MAA7BA,KAA6B;AAA7BA,SAA6B,GAAZ,CAAY;AAAA;;AAErE,MAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,WAAO,+BAAP;AACH;;AAED,MAAI;AACA,QAAI,CAAChV,GAAL,EAAU;AACN,kCAA2BtB,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BmB,GAA/B,CAA3B;AACH;;AAED,QAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AACzB,aAAOA,GAAP;AACH;;AAED,QAAIA,GAAG,YAAYM,KAAnB,EAA0B;AACtB,UAAIuK,KAAK,GAAG7K,GAAG,IAAIA,GAAG,CAAC6K,KAAvB;AACA,UAAIvH,OAAO,GAAGtD,GAAG,IAAIA,GAAG,CAACsD,OAAzB;;AAEA,UAAIuH,KAAK,IAAIvH,OAAb,EAAsB;AAClB,YAAIuH,KAAK,CAAClK,OAAN,CAAc2C,OAAd,MAA2B,CAAC,CAAhC,EAAmC;AAC/B,iBAAOuH,KAAP;AACH,SAFD,MAEO;AACH,iBAAWvH,OAAX,UAAyBuH,KAAzB;AACH;AACJ,OAND,MAMO,IAAIA,KAAJ,EAAW;AACd,eAAOA,KAAP;AACH,OAFM,MAEA,IAAIvH,OAAJ,EAAa;AAChB,eAAOA,OAAP;AACH;AACJ;;AAED,QAAItD,GAAG,IAAIA,GAAG,CAACpB,QAAX,IAAuB,OAAOoB,GAAG,CAACpB,QAAX,KAAwB,UAAnD,EAA+D;AAC3D;AACA,aAAOoB,GAAG,CAACpB,QAAJ,EAAP;AACH;;AAED,WAAOF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BmB,GAA/B,CAAP;AAEH,GAjCD,CAiCE,OAAOiV,MAAP,EAAe;AAAE;AACf,gDAA2CF,cAAc,CAACE,MAAD,EAASD,KAAK,GAAG,CAAjB,CAAzD;AACH;AACJ;AAEM,SAASE,qBAAT,CAA+BlV,GAA/B,EAAqD;AAExD,MAAImV,cAAc,wBAAuBzW,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BmB,GAA/B,CAAvB,MAAlB;;AAEA,MAAI,CAACA,GAAL,EAAU;AACN,WAAOmV,cAAP;AACH;;AAED,MAAInV,GAAG,YAAYM,KAAnB,EAA0B;AACtB,WAAON,GAAG,CAACsD,OAAJ,IAAe6R,cAAtB;AACH;;AAED,MAAI,OAAOnV,GAAG,CAACsD,OAAX,KAAuB,QAA3B,EAAqC;AACjC,WAAOtD,GAAG,CAACsD,OAAJ,IAAe6R,cAAtB;AACH;;AAED,SAAOA,cAAP;AACH;AAEM,SAAStO,SAAT,CAAmBpI,IAAnB,EAA0C;AAC7C,MAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC1B,WAAOA,IAAP;AACH;;AAED,MAAIA,IAAI,IAAIA,IAAI,CAACG,QAAb,IAAyB,OAAOH,IAAI,CAACG,QAAZ,KAAyB,UAAtD,EAAkE;AAC9D;AACA,WAAOH,IAAI,CAACG,QAAL,EAAP;AACH;;AAED,SAAOF,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,IAA/B,CAAP;AACH;AAEM,SAAS2W,aAAT,CAAuBC,QAAvB,EAA0C5U,MAA1C,EAAqE;AACxE4U,UAAQ,GAAGA,QAAQ,CAACjO,KAAT,CAAe,KAAf,EAAsB,CAAtB,CAAX;AACA,MAAImJ,KAAK,GAAG8E,QAAQ,CAAC1U,OAAT,CAAiBF,MAAjB,CAAZ;AACA,SAAQ8P,KAAK,KAAK,CAAC,CAAX,IAAgB8E,QAAQ,CAAChO,KAAT,CAAekJ,KAAf,MAA0B9P,MAAlD;AACH;AAEM,SAAS6U,WAAT,CAAqBrN,GAArB,EAAmChE,IAAnC,EAAkD2F,OAAlD,EAAsE;AACzE,MAAI2L,QAAQ,GAAGtN,GAAG,CAAChE,IAAD,CAAlB;;AAEAgE,KAAG,CAAChE,IAAD,CAAH,GAAY,SAASuR,aAAT,GAAiC;AAAA;AAAA;;AACzC,WAAO5L,OAAO,CAAC;AACX8C,aAAO,EAAO,IADH;AAEXC,UAAI,EAAUlG,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBxI,IAAtB,CAA2BoQ,SAA3B,CAFH;AAGXsG,cAAQ,EAARA,QAHW;AAIXE,kBAAY,EAAE;AAAA,eAAMF,QAAQ,CAAC3I,KAAT,CAAe,MAAf,EAAqBqC,WAArB,CAAN;AAAA;AAJH,KAAD,CAAd;AAMH,GAPD;AAQH;AAEM,SAASyG,MAAT,CAAuCzN,GAAvC,EAAgDiH,MAAhD,EAAqE;AACxE,MAAI,CAACA,MAAL,EAAa;AACT,WAAOjH,GAAP;AACH;;AAED,MAAIvJ,MAAM,CAACqQ,MAAX,EAAmB;AACf,WAAOrQ,MAAM,CAACqQ,MAAP,CAAc9G,GAAd,EAAmBiH,MAAnB,CAAP;AACH;;AAED,OAAK,IAAI3C,GAAT,IAAgB2C,MAAhB,EAAwB;AACpB,QAAIA,MAAM,CAACC,cAAP,CAAsB5C,GAAtB,CAAJ,EAAgC;AAC5BtE,SAAG,CAACsE,GAAD,CAAH,GAAW2C,MAAM,CAAC3C,GAAD,CAAjB;AACH;AACJ;;AAED,SAAOtE,GAAP;AACH;AAEM,SAAS6H,WAAT,CAAmB7H,GAAnB,EAAsD;AACzD,MAAI7G,MAAM,GAAG,EAAb;;AACA,OAAK,IAAImL,GAAT,IAAgBtE,GAAhB,EAAqB;AACjB,QAAIA,GAAG,CAACkH,cAAJ,CAAmB5C,GAAnB,CAAJ,EAA6B;AACzBnL,YAAM,CAACC,IAAP,CAAY4G,GAAG,CAACsE,GAAD,CAAf;AACH;AACJ;;AACD,SAAOnL,MAAP;AACH;AAEM,SAASuU,IAAT,CAAcC,MAAd,EAA+BC,UAA/B,EAA6D;AAChE,SAAO9F,IAAI,CAAC+F,KAAL,CAAYF,MAAM,GAAGC,UAAV,GAAwB,GAAnC,CAAP;AACH;AAEM,SAASE,GAAT,GAA+C;AAClD,SAAOhG,IAAI,CAACgG,GAAL,OAAAhG,IAAI,YAAX;AACH;AAEM,SAASiG,GAAT,GAA+C;AAClD,SAAOjG,IAAI,CAACiG,GAAL,OAAAjG,IAAI,YAAX;AACH;AAEM,SAASkG,QAAT,CAAqBhF,GAArB,EAAmCiF,MAAnC,EAAoDtM,OAApD,EAAkF;AACrF,MAAIjF,OAAO,GAAG,EAAd,CADqF,CAGrF;;AACAsM,KAAG,CAACxI,OAAJ,CAAYyN,MAAZ,EAAoB,SAASC,eAAT,CAAyB1X,IAAzB,EAA+B;AAC/CkG,WAAO,CAACtD,IAAR,CAAauI,OAAO,GAAGA,OAAO,CAACgD,KAAR,CAAc,IAAd,EAAoBqC,SAApB,CAAH,GAAoCxQ,IAAxD;AACH,GAFD,EAJqF,CAQrF;;AACA,SAAOkG,OAAP;AACH;AAEM,SAASyR,WAAT,CAAqBC,GAArB,EAA4C;AAC/C,wCAAqCrF,YAAY,CAACqF,GAAD,CAAjD;AACH;AAEM,SAASC,SAAT,CAAyBrO,GAAzB,EAAiDsO,MAAjD,EAA+G;AAAA,MAA9DA,MAA8D;AAA9DA,UAA8D,GAA5BvR,OAA4B;AAAA;;AAClH,MAAI5D,MAAM,GAAG,EAAb;;AAEA,OAAK,IAAImL,GAAT,IAAgBtE,GAAhB,EAAqB;AACjB,QAAI,CAACA,GAAG,CAACkH,cAAJ,CAAmB5C,GAAnB,CAAD,IAA4B,CAACgK,MAAM,CAACtO,GAAG,CAACsE,GAAD,CAAJ,EAAWA,GAAX,CAAvC,EAAwD;AACpD;AACH;;AAEDnL,UAAM,CAACmL,GAAD,CAAN,GAActE,GAAG,CAACsE,GAAD,CAAjB;AACH;;AAED,SAAOnL,MAAP;AACH;AAEM,SAASoV,QAAT,CAAsB/X,IAAtB,EAAoC;AACvC,SAAOA,IAAP;AACH;AAEM,SAASgY,aAAT,CAAuBC,IAAvB,EAAsCR,MAAtC,EAAuE;AAC1E,MAAI9U,MAAM,GAAG,EAAb;AACAsV,MAAI,CAACjO,OAAL,CAAayN,MAAb,EAAqB,UAAAS,KAAK,EAAI;AAC1BvV,UAAM,CAACC,IAAP,CAAYsV,KAAZ;AACA,WAAO,EAAP;AACH,GAHD;AAIA,SAAOvV,MAAP;AACH;AAEM,SAASwV,eAAT,CAA4BnK,MAA5B,EAAgEjF,KAAhE,EAA6G;AAAA,MAA7CA,KAA6C;AAA7CA,SAA6C,GAA5B,EAA4B;AAAA;;AAEhH,MAAIgC,OAAJ;AACA,MAAI7B,OAAJ;;AAEA,MAAMkP,gBAAgB,GAAG,SAAnBA,gBAAmB,GAA6B;AAClD,QAAIlP,OAAJ,EAAa;AACTE,kBAAY,CAACF,OAAD,CAAZ;AACH;;AAED,QAAImP,YAAY,GAAGtN,OAAO,GAAGA,OAAO,IAAI,IAAIa,oBAAJ,EAAxC;AAEA1C,WAAO,GAAGG,UAAU,CAAC,YAAM;AACvB0B,aAAO,GAAG,IAAV;AACA7B,aAAO,GAAG,IAAV;AAEA0C,0BAAY,CAACuB,GAAb,CAAiBa,MAAjB,EAAyBrD,IAAzB,CACI,UAAAhI,MAAM,EAAI;AAAE0V,oBAAY,CAAC9M,OAAb,CAAqB5I,MAArB;AAA+B,OAD/C,EAEI,UAAApB,GAAG,EAAI;AAAE8W,oBAAY,CAAC9L,MAAb,CAAoBhL,GAApB;AAA2B,OAFxC;AAIH,KARmB,EAQjBwH,KARiB,CAApB;AAUA,WAAOsP,YAAP;AACH,GAlBD;;AAoBA,SAAO/F,eAAe,CAAC8F,gBAAD,EAAuBlG,eAAe,CAAClE,MAAD,CAAtC,wBAAtB;AACH;AAEM,SAASsK,YAAT,CAAsBtK,MAAtB,EAAyCZ,IAAzC,EAAkF;AAErF,MAAIlE,OAAJ;;AAEA,WAASqP,IAAT,GAAgB;AACZrP,WAAO,GAAGG,UAAU,CAAC,YAAM;AACvB2E,YAAM;AACNuK,UAAI;AACP,KAHmB,EAGjBnL,IAHiB,CAApB;AAIH;;AAEDmL,MAAI;AAEJ,SAAO;AACHjP,UADG,oBACM;AACLF,kBAAY,CAACF,OAAD,CAAZ;AACH;AAHE,GAAP;AAKH;AAEM,SAASsP,SAAT,CAAmBhG,GAAnB,EAA2C;AAC9C,SAAOjM,OAAO,CAACiM,GAAG,CAACtK,KAAJ,CAAU,UAAV,CAAD,CAAd;AACH;AAEM,SAASuQ,OAAT,CAAiBjG,GAAjB,EAAyC;AAC5C,SAAOjM,OAAO,CAACiM,GAAG,CAACtK,KAAJ,CAAU,kBAAV,CAAD,CAAd;AACH;AAEM,SAASwQ,kBAAT,CAA4B1M,KAA5B,EAAwE;AAC3E,SAAOA,KAAK,CAAC7L,QAAN,EAAP;AACH;AAEM,SAASwY,oBAAT,CAA8B3M,KAA9B,EAA0E;AAC7E,MAAIA,KAAK,KAAK,MAAd,EAAsB;AAClB,WAAO,IAAP;AACH,GAFD,MAEO,IAAIA,KAAK,KAAK,OAAd,EAAuB;AAC1B,WAAO,KAAP;AACH,GAFM,MAEA,IAAIwM,SAAS,CAACxM,KAAD,CAAb,EAAsB;AACzB,WAAO+G,QAAQ,CAAC/G,KAAD,EAAQ,EAAR,CAAf;AACH,GAFM,MAEA,IAAIyM,OAAO,CAACzM,KAAD,CAAX,EAAoB;AACvB,WAAO4M,UAAU,CAAC5M,KAAD,CAAjB;AACH,GAFM,MAEA;AACH,WAAOA,KAAP;AACH;AACJ;AAEM,SAAS6M,MAAT,CAAgBrP,GAAhB,EAA8BsP,MAA9B,EAAoDC,MAApD,EAAkG;AAAA,MAApED,MAAoE;AAApEA,UAAoE,GAAlD,EAAkD;AAAA;;AAAA,MAA9CC,MAA8C;AAA9CA,UAA8C,GAA5B,EAA4B;AAAA;;AACrGD,QAAM,GAAGA,MAAM,GAAOA,MAAP,SAAoBA,MAAnC;;AACA,OAAK,IAAIhL,GAAT,IAAgBtE,GAAhB,EAAqB;AACjB,QAAI,CAACA,GAAG,CAACkH,cAAJ,CAAmB5C,GAAnB,CAAD,IAA4BtE,GAAG,CAACsE,GAAD,CAAH,KAAad,SAAzC,IAAsDxD,GAAG,CAACsE,GAAD,CAAH,KAAa,IAAnE,IAA2E,OAAOtE,GAAG,CAACsE,GAAD,CAAV,KAAoB,UAAnG,EAA+G;AAC3G;AACH,KAFD,MAEO,IAAItE,GAAG,CAACsE,GAAD,CAAH,IAAY9F,KAAK,CAACC,OAAN,CAAcuB,GAAG,CAACsE,GAAD,CAAjB,CAAZ,IAAuCtE,GAAG,CAACsE,GAAD,CAAH,CAAS3K,MAAhD,IAA0DqG,GAAG,CAACsE,GAAD,CAAH,CAASkL,KAAT,CAAe,UAAAxE,GAAG;AAAA,aAAI,OAAOA,GAAP,KAAe,QAAnB;AAAA,KAAlB,CAA9D,EAA8G;AACjHuE,YAAM,MAAKD,MAAL,GAAgBhL,GAAhB,QAAN,GAAkCtE,GAAG,CAACsE,GAAD,CAAH,CAAStF,IAAT,CAAc,GAAd,CAAlC;AACH,KAFM,MAEA,IAAIgB,GAAG,CAACsE,GAAD,CAAH,IAAY,OAAOtE,GAAG,CAACsE,GAAD,CAAV,KAAoB,QAApC,EAA8C;AACjDiL,YAAM,GAAGF,MAAM,CAACrP,GAAG,CAACsE,GAAD,CAAJ,OAAegL,MAAf,GAA0BhL,GAA1B,EAAkCiL,MAAlC,CAAf;AACH,KAFM,MAEA;AACHA,YAAM,MAAKD,MAAL,GAAgBhL,GAAhB,CAAN,GAAgC4K,kBAAkB,CAAClP,GAAG,CAACsE,GAAD,CAAJ,CAAlD;AACH;AACJ;;AACD,SAAOiL,MAAP;AACH;AAEM,SAASE,QAAT,CAAkBzP,GAAlB,EAAwD;AAE3D,MAAI7G,MAAM,GAAG,EAAb;;AAEA,OAAK,IAAImL,GAAT,IAAgBtE,GAAhB,EAAqB;AACjB,QAAI,CAACA,GAAG,CAACkH,cAAJ,CAAmB5C,GAAnB,CAAD,IAA4B,OAAOtE,GAAG,CAACsE,GAAD,CAAV,KAAoB,QAApD,EAA8D;AAC1D;AACH;;AAED,QAAI9B,KAAK,GAAGxC,GAAG,CAACsE,GAAD,CAAf;;AAEA,QAAIA,GAAG,CAAC5F,KAAJ,CAAU,UAAV,CAAJ,EAA2B;AACvB4F,SAAG,GAAGA,GAAG,CAAClF,KAAJ,CAAU,CAAV,EAAakF,GAAG,CAAC3K,MAAJ,GAAa,CAA1B,CAAN;AACA6I,WAAK,GAAGA,KAAK,CAACrD,KAAN,CAAY,GAAZ,EAAiBkF,GAAjB,CAAqB8K,oBAArB,CAAR;AACH,KAHD,MAGO;AACH3M,WAAK,GAAG2M,oBAAoB,CAAC3M,KAAD,CAA5B;AACH;;AAED,QAAIkN,SAAS,GAAGvW,MAAhB;AACA,QAAIwW,KAAK,GAAGrL,GAAG,CAACnF,KAAJ,CAAU,GAAV,CAAZ;;AACA,SAAK,IAAIvF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+V,KAAK,CAAChW,MAA1B,EAAkCC,CAAC,EAAnC,EAAuC;AACnC,UAAIgW,IAAI,GAAGD,KAAK,CAAC/V,CAAD,CAAhB;AACA,UAAIiW,MAAM,GAAIjW,CAAC,GAAG,CAAJ,KAAU+V,KAAK,CAAChW,MAA9B;AACA,UAAImW,OAAO,GAAG,CAACD,MAAD,IAAWb,SAAS,CAACW,KAAK,CAAC/V,CAAC,GAAG,CAAL,CAAN,CAAlC;;AAEA,UAAIgW,IAAI,KAAK,aAAT,IAA0BA,IAAI,KAAK,WAAnC,IAAkDA,IAAI,KAAK,WAA/D,EAA4E;AACxE,cAAM,IAAIvX,KAAJ,sBAA8BuX,IAA9B,CAAN;AACH;;AAED,UAAIC,MAAJ,EAAY;AACR;AACAH,iBAAS,CAACE,IAAD,CAAT,GAAkBpN,KAAlB;AACH,OAHD,MAGO;AACH;AACAkN,iBAAS,GAAGA,SAAS,CAACE,IAAD,CAAT,GAAkBF,SAAS,CAACE,IAAD,CAAT,KAAoBE,OAAO,GAAG,EAAH,GAAQ,EAAnC,CAA9B;AACH;AACJ;AACJ;;AAED,SAAO3W,MAAP;AACH;AASM,SAAS4W,YAAT,GAA2C;AAC9C,MAAIC,SAAS,GAAG,EAAhB;AACA,MAAItN,QAAQ,GAAG,EAAf;AAEA,SAAO;AAEHuN,MAFG,cAEAC,SAFA,EAEoBvO,OAFpB,EAEyD;AACxD,UAAIwO,WAAW,GAAGzN,QAAQ,CAACwN,SAAD,CAAR,GAAsBxN,QAAQ,CAACwN,SAAD,CAAR,IAAuB,EAA/D;AAEAC,iBAAW,CAAC/W,IAAZ,CAAiBuI,OAAjB;AAEA,UAAIyO,SAAS,GAAG,KAAhB;AAEA,aAAO;AACHtQ,cADG,oBACM;AACL,cAAI,CAACsQ,SAAL,EAAgB;AACZA,qBAAS,GAAG,IAAZ;AACAD,uBAAW,CAAC1U,MAAZ,CAAmB0U,WAAW,CAACzX,OAAZ,CAAoBiJ,OAApB,CAAnB,EAAiD,CAAjD;AACH;AAEJ;AAPE,OAAP;AASH,KAlBE;AAoBHuK,QApBG,gBAoBEgE,SApBF,EAoBsBvO,OApBtB,EAoB2D;AAE1D,UAAI0O,QAAQ,GAAG,KAAKJ,EAAL,CAAQC,SAAR,EAAmB,YAAM;AACpCG,gBAAQ,CAACvQ,MAAT;AACA6B,eAAO;AACV,OAHc,CAAf;AAKA,aAAO0O,QAAP;AACH,KA5BE;AA8BHC,WA9BG,mBA8BKJ,SA9BL,EA8B+E;AAAA,yCAAnDxL,IAAmD;AAAnDA,YAAmD;AAAA;;AAE9E,UAAIyL,WAAW,GAAGzN,QAAQ,CAACwN,SAAD,CAA1B;AACA,UAAIlM,QAAQ,GAAG,EAAf;;AAEA,UAAImM,WAAJ,EAAiB;AAAA;AACR,cAAIxO,OAAO,GAAIwO,WAAJ,KAAX;AACDnM,kBAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACuB,GAAb,CAAiB;AAAA,mBAAMhC,OAAO,MAAP,SAAW+C,IAAX,CAAN;AAAA,WAAjB,CAAd;AAFS;;AAAA,gCACOyL,WADP,gBACoB;AAAA;AAEhC;AACJ;;AAED,aAAO/N,oBAAY,CAAC2B,GAAb,CAAiBC,QAAjB,EAA2B7C,IAA3B,CAAgCtK,aAAhC,CAAP;AACH,KA1CE;AA4CH0Z,eA5CG,uBA4CSL,SA5CT,EA4CmF;AAElF,UAAIF,SAAS,CAACE,SAAD,CAAb,EAA0B;AACtB,eAAO9N,oBAAY,CAACL,OAAb,EAAP;AACH;;AAEDiO,eAAS,CAACE,SAAD,CAAT,GAAuB,IAAvB;;AANkF,yCAAnDxL,IAAmD;AAAnDA,YAAmD;AAAA;;AAOlF,aAAO,KAAK4L,OAAL,cAAaJ,SAAb,SAA2BxL,IAA3B,EAAP;AACH;AApDE,GAAP;AAsDH;AAEM,SAAS8L,gBAAT,CAA0BC,MAA1B,EAAoD;AACvD,SAAOA,MAAM,CAACjQ,OAAP,CAAe,UAAf,EAA2B,UAACkQ,CAAD,EAAO;AACrC,iBAAYA,CAAC,CAACnG,WAAF,EAAZ;AACH,GAFM,CAAP;AAGH;AAEM,SAASoG,gBAAT,CAA0BF,MAA1B,EAAoD;AACvD,SAAOA,MAAM,CAACjQ,OAAP,CAAe,WAAf,EAA4B,UAACkQ,CAAD,EAAO;AACtC,WAAOA,CAAC,CAAC,CAAD,CAAD,CAAKE,WAAL,EAAP;AACH,GAFM,CAAP;AAGH;AAEM,SAASC,qBAAT,CAA+BJ,MAA/B,EAAyD;AAC5D,SAAOA,MAAM,CAACvG,MAAP,CAAc,CAAd,EAAiB0G,WAAjB,KAAiCH,MAAM,CAACrR,KAAP,CAAa,CAAb,EAAgBmL,WAAhB,EAAxC;AACH;AAEM,SAAS7C,QAAT,CAAalR,IAAb,EAA4Bsa,IAA5B,EAA2CC,GAA3C,EAAgE;AAEnE,MAAI,CAACD,IAAL,EAAW;AACP,WAAOC,GAAP;AACH;;AAED,MAAIC,SAAS,GAAGF,IAAI,CAAC3R,KAAL,CAAW,GAAX,CAAhB,CANmE,CAQnE;;AAEA,OAAK,IAAIvF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoX,SAAS,CAACrX,MAA9B,EAAsCC,CAAC,EAAvC,EAA2C;AAEvC;AACA,QAAI,OAAOpD,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAAzC,EAA+C;AAC3CA,UAAI,GAAGA,IAAI,CAACwa,SAAS,CAACpX,CAAD,CAAV,CAAX,CAD2C,CAG/C;AACC,KAJD,MAIO;AACH,aAAOmX,GAAP;AACH;AACJ,GApBkE,CAsBnE;;;AAEA,SAAOva,IAAI,KAAKgN,SAAT,GAAqBuN,GAArB,GAA2Bva,IAAlC;AACH;AAEM,SAASya,WAAT,CAAqBzM,MAArB,EAAwCZ,IAAxC,EAAuD;AAE1D,MAAIsN,QAAQ,GAAGpC,YAAY,CAAC,YAAM;AAC9BlL,QAAI,IAAI,GAAR;;AACA,QAAIA,IAAI,IAAI,CAAZ,EAAe;AACXsN,cAAQ,CAACpR,MAAT;AACA0E,YAAM;AACT;AACJ,GAN0B,EAMxB,GANwB,CAA3B;AAOH;AAEM,SAAS2M,cAAT,CAA2BnR,GAA3B,EAAwDsE,GAAxD,EAA+EmE,MAA/E,EAAiG;AACpG,MAAIjK,KAAK,CAACC,OAAN,CAAcuB,GAAd,CAAJ,EAAwB;AACpB,QAAI,OAAOsE,GAAP,KAAe,QAAnB,EAA6B;AACzB,YAAM,IAAIR,SAAJ,4BAAN;AACH;AACJ,GAJD,MAIO,IAAI,OAAO9D,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,IAAvC,EAA6C;AAChD,QAAI,OAAOsE,GAAP,KAAe,QAAnB,EAA6B;AACzB,YAAM,IAAIR,SAAJ,6BAAN;AACH;AACJ;;AAEDrN,QAAM,CAAC2R,cAAP,CAAsBpI,GAAtB,EAA2BsE,GAA3B,EAAgC;AAC5BuI,gBAAY,EAAE,IADc;AAE5B9T,cAAU,EAAI,IAFc;AAG5B2O,OAAG,EAAW,eAAM;AAChB;AACA,aAAO1H,GAAG,CAACsE,GAAD,CAAV;AACA,UAAI9B,KAAK,GAAGiG,MAAM,EAAlB,CAHgB,CAIhB;;AACAzI,SAAG,CAACsE,GAAD,CAAH,GAAW9B,KAAX;AACA,aAAOA,KAAP;AACH,KAV2B;AAW5BiF,OAAG,EAAE,aAACjF,KAAD,EAAe;AAChB;AACA,aAAOxC,GAAG,CAACsE,GAAD,CAAV,CAFgB,CAGhB;;AACAtE,SAAG,CAACsE,GAAD,CAAH,GAAW9B,KAAX;AACH;AAhB2B,GAAhC;AAkBH;AAEM,SAAS4O,SAAT,CAAsB5a,IAAtB,EAAqD;AAAE;AAC1D,SAAOgI,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBxI,IAAtB,CAA2BJ,IAA3B,CAAP;AACH;AAEM,SAAS6a,QAAT,CAAkB7a,IAAlB,EAA0C;AAC7C,SAAQ,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAA7C;AACH;AAEM,SAAS8a,cAAT,CAAwBtR,GAAxB,EAA+C;AAClD,SAAOqR,QAAQ,CAACrR,GAAD,CAAR,IAAiBvJ,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BoJ,GAA/B,MAAwC,iBAAhE;AACH;AAEM,SAASuR,aAAT,CAAuBvR,GAAvB,EAA8C;AACjD,MAAI,CAACsR,cAAc,CAACtR,GAAD,CAAnB,EAA0B;AACtB,WAAO,KAAP;AACH,GAHgD,CAKjD;;;AACA,MAAIkB,WAAW,GAAGlB,GAAG,CAACkB,WAAtB;;AAEA,MAAI,OAAOA,WAAP,KAAuB,UAA3B,EAAuC;AACnC,WAAO,KAAP;AACH;;AAED,MAAIxK,SAAS,GAAGwK,WAAW,CAACxK,SAA5B;;AAEA,MAAI,CAAC4a,cAAc,CAAC5a,SAAD,CAAnB,EAAgC;AAC5B,WAAO,KAAP;AACH;;AAED,MAAI,CAACA,SAAS,CAACwQ,cAAV,CAAyB,eAAzB,CAAL,EAAgD;AAC5C,WAAO,KAAP;AACH;;AAED,SAAO,IAAP;AACH;AAEM,SAASsK,aAAT,CAAmDhb,IAAnD,EAA6Dib,QAA7D,EAAmHC,OAAnH,EAA8I;AAAA,MAA3BA,OAA2B;AAA3BA,WAA2B,GAAR,EAAQ;AAAA;;AAEjJ,MAAIlT,KAAK,CAACC,OAAN,CAAcjI,IAAd,CAAJ,EAAyB;AACrB,QAAImD,MAAM,GAAGnD,IAAI,CAACmD,MAAlB;AACA,QAAIR,MAAqB,GAAG,EAA5B;;AAFqB,iCAIZS,CAJY;AAOjBuX,oBAAc,CAAChY,MAAD,EAASS,CAAT,EAAY,YAAM;AAC5B,YAAI+X,OAAO,GAAGD,OAAO,GAAOA,OAAP,SAAoB9X,CAApB,QAA+BA,CAApD;AACA,YAAIgY,EAAE,GAAGpb,IAAI,CAACoD,CAAD,CAAb;AAEA,YAAIN,KAAK,GAAGmY,QAAQ,CAACG,EAAD,EAAKhY,CAAL,EAAQ+X,OAAR,CAApB;;AAEA,YAAIJ,aAAa,CAACjY,KAAD,CAAb,IAAwBkF,KAAK,CAACC,OAAN,CAAcnF,KAAd,CAA5B,EAAkD;AAC9C;AACAA,eAAK,GAAGkY,aAAa,CAAClY,KAAD,EAAQmY,QAAR,EAAkBE,OAAlB,CAArB;AACH;;AAED,eAAOrY,KAAP;AACH,OAZa,CAAd;AAPiB;;AAIrB,SAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAApB,EAA4BC,CAAC,EAA7B,EAAiC;AAAA,aAAxBA,CAAwB;AAgBhC,KApBoB,CAsBrB;;;AACA,WAAOT,MAAP;AACH,GAxBD,MAwBO,IAAIoY,aAAa,CAAC/a,IAAD,CAAjB,EAAyB;AAC5B,QAAI2C,OAAM,GAAG,EAAb;;AAD4B,iCAGnBmL,GAHmB;AAIxB,UAAI,CAAC9N,IAAI,CAAC0Q,cAAL,CAAoB5C,GAApB,CAAL,EAA+B;AAC3B;AACH;;AAED6M,oBAAc,CAAChY,OAAD,EAASmL,GAAT,EAAc,YAAM;AAC9B,YAAIqN,OAAO,GAAGD,OAAO,GAAOA,OAAP,SAAoBpN,GAApB,QAAiCA,GAAtD,CAD8B,CAE9B;;AACA,YAAIsN,EAAE,GAAGpb,IAAI,CAAC8N,GAAD,CAAb;AAEA,YAAIhL,KAAK,GAAGmY,QAAQ,CAACG,EAAD,EAAKtN,GAAL,EAAUqN,OAAV,CAApB;;AAEA,YAAIJ,aAAa,CAACjY,KAAD,CAAb,IAAwBkF,KAAK,CAACC,OAAN,CAAcnF,KAAd,CAA5B,EAAkD;AAC9C;AACAA,eAAK,GAAGkY,aAAa,CAAClY,KAAD,EAAQmY,QAAR,EAAkBE,OAAlB,CAArB;AACH;;AAED,eAAOrY,KAAP;AACH,OAba,CAAd;AARwB;;AAG5B,SAAK,IAAIgL,GAAT,IAAgB9N,IAAhB,EAAsB;AAAA,wBAAb8N,GAAa;;AAAA,+BAEd;AAiBP,KAtB2B,CAwB5B;;;AACA,WAAOnL,OAAP;AACH,GA1BM,MA0BA;AACH,UAAM,IAAId,KAAJ,2BAAN;AACH;AACJ;AAGM,SAASwZ,QAAT,CAAkB5K,MAAlB,EAAmCF,MAAnC,EAAoD/K,IAApD,EAAmE+U,GAAnE,EAAgF;AACnF,MAAI9J,MAAM,CAACC,cAAP,CAAsBlL,IAAtB,CAAJ,EAAiC;AAC7B,QAAI8V,UAAU,GAAGrb,MAAM,CAACqC,wBAAP,CAAgCmO,MAAhC,EAAwCjL,IAAxC,CAAjB,CAD6B,CAE7B;;AACAvF,UAAM,CAAC2R,cAAP,CAAsBrB,MAAtB,EAA8B/K,IAA9B,EAAoC8V,UAApC;AAEH,GALD,MAKO;AACH/K,UAAM,CAAC/K,IAAD,CAAN,GAAe+U,GAAf;AACH;AACJ;AAWM,SAASgB,UAAT,CAAezT,OAAf,EAA0CmS,MAA1C,EAA2DuB,KAA3D,EAAkG;AAAA,MAAvCA,KAAuC;AAAvCA,SAAuC,GAAtB,CAAsB;AAAA;;AAErG,MAAI,OAAO1T,OAAP,KAAmB,QAAvB,EAAiC;AAC7B;AACAA,WAAO,GAAG,IAAI2T,MAAJ,CAAW3T,OAAX,CAAV;AACH;;AAED,MAAInF,MAAM,GAAGsX,MAAM,CAACrR,KAAP,CAAa4S,KAAb,EAAoBtT,KAApB,CAA0BJ,OAA1B,CAAb;;AAEA,MAAI,CAACnF,MAAL,EAAa;AACT;AACH,GAXoG,CAarG;;;AACA,MAAImP,KAAc,GAAGnP,MAAM,CAACmP,KAA5B;AACA,MAAIqE,QAAQ,GAAGxT,MAAM,CAAC,CAAD,CAArB;AAEA,SAAO;AACHsV,QAAI,EAAI9B,QADL;AAEHuF,UAAM,EAAE/Y,MAAM,CAACiG,KAAP,CAAa,CAAb,CAFL;AAGH4S,SAAK,EAAGA,KAAK,GAAG1J,KAHb;AAIH6J,OAAG,EAAKH,KAAK,GAAG1J,KAAR,GAAgBqE,QAAQ,CAAChT,MAJ9B;AAKHA,UAAM,EAAEgT,QAAQ,CAAChT,MALd;AAOH6G,WAPG,mBAOKiO,IAPL,EAO6B;AAE5B,UAAI,CAAC9B,QAAL,EAAe;AACX,eAAO,EAAP;AACH;;AAED,kBAAWA,QAAQ,CAACvN,KAAT,CAAe,CAAf,EAAkB4S,KAAK,GAAG1J,KAA1B,CAAX,GAAgDmG,IAAhD,GAAyD9B,QAAQ,CAACvN,KAAT,CAAekJ,KAAK,GAAGqE,QAAQ,CAAChT,MAAhC,CAAzD;AACH;AAdE,GAAP;AAgBH;AAEM,SAASyY,QAAT,CAAkB9T,OAAlB,EAA6CmS,MAA7C,EAAuF;AAE1F,MAAItL,OAAO,GAAG,EAAd;AACA,MAAI6M,KAAK,GAAG,CAAZ,CAH0F,CAK1F;;AACA,SAAO,IAAP,EAAa;AACT,QAAIrF,QAAQ,GAAGoF,UAAK,CAACzT,OAAD,EAAUmS,MAAV,EAAkBuB,KAAlB,CAApB;;AAEA,QAAI,CAACrF,QAAL,EAAe;AACX;AACH;;AAEDxH,WAAO,CAAC/L,IAAR,CAAauT,QAAb;AACAqF,SAAK,GAAGtT,UAAK,CAACyT,GAAd;AACH;;AAED,SAAOhN,OAAP;AACH;AAEM,SAASkN,SAAT,CAAmB7P,KAAnB,EAA6C;AAChD,SAAOA,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAKgB,SAAnC;AACH;AAEM,SAAS8O,KAAT,CAAe9N,MAAf,EAAuD;AAC1D,SAAOpC,oBAAY,CAACuB,GAAb,CAAiBa,MAAjB,EAAyBrD,IAAzB,CAA8B;AAAA,WAAMmR,KAAK,CAAC9N,MAAD,CAAX;AAAA,GAA9B,CAAP;AACH;AAEM,SAAS+N,QAAT,CAAqB/N,MAArB,EAA6DZ,IAA7D,EAAqH;AAAA,MAAxDA,IAAwD;AAAxDA,QAAwD,GAAxC,GAAwC;AAAA;;AAExH,MAAIlE,OAAJ;;AAEA,MAAM8S,eAAe,GAAG,SAAlBA,eAAkB,GAAW;AAAA;AAAA;;AAC/B5S,gBAAY,CAACF,OAAD,CAAZ;AAEAA,WAAO,GAAGG,UAAU,CAAC,YAAM;AACvB,aAAO2E,MAAM,CAACG,KAAP,CAAa,MAAb,EAAmBqC,WAAnB,CAAP;AACH,KAFmB,EAEjBpD,IAFiB,CAApB;AAGH,GAND;;AAQA,SAAOkF,eAAe,CAAC0J,eAAD,EAAsB9J,eAAe,CAAClE,MAAD,CAArC,iBAAtB;AACH;AAEM,SAASjO,YAAT,CAAiBC,IAAjB,EAAyC;AAC5C,SAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,IAA/B,MAAyC,iBAAhD;AACH;AAID;AACO,IAAIic,mBAAiC,GAAG,SAApCA,cAAoC,CAAYjO,MAAZ,EAA0E;AAErH,MAAIoD,OAAO,GAAG,IAAIR,8BAAJ,EAAd,CAFqH,CAIrH;;AACA,SAAO,SAASsL,eAAT,CAAyBC,GAAzB,EAAwC;AAAA;;AAC3C,WAAO/K,OAAO,CAACY,QAAR,CAAiBmK,GAAjB,EAAsB;AAAA,aAAMnO,MAAM,CAAC5N,IAAP,CAAY,MAAZ,EAAkB+b,GAAlB,CAAN;AAAA,KAAtB,CAAP;AACH,GAFD;AAGH,CARM;AAYP;AACO,IAAIC,0BAAkD,GAAG,SAArDA,qBAAqD,CAAYpO,MAAZ,EAAsG;AAElK,MAAIoD,OAAO,GAAG,IAAIR,8BAAJ,EAAd,CAFkK,CAIlK;;AACA,SAAO,SAASyL,sBAAT,CAAgCF,GAAhC,EAA6D;AAAA;;AAChE,WAAO/K,OAAO,CAACY,QAAR,CAAiBmK,GAAjB,EAAsB;AAAA,aACzBnO,MAAM,CAAC5N,IAAP,CAAY,MAAZ,EAAkB+b,GAAlB,EAAuBlP,OAAvB,CAA+B,YAAM;AACjCmE,eAAO,CAACK,MAAR,CAAe0K,GAAf;AACH,OAFD,CADyB;AAAA,KAAtB,CAAP;AAKH,GAND;AAOH,CAZM;AAcA,SAASnK,aAAT,CAAyCxI,GAAzC,EAAkDsE,GAAlD,EAAgEmE,MAAhE,EAAsF;AACzF,MAAIzI,GAAG,CAACkH,cAAJ,CAAmB5C,GAAnB,CAAJ,EAA6B;AACzB,WAAOtE,GAAG,CAACsE,GAAD,CAAV;AACH;;AAED,MAAM0G,GAAG,GAAGvC,MAAM,EAAlB;AACAzI,KAAG,CAACsE,GAAD,CAAH,GAAW0G,GAAX;AACA,SAAOA,GAAP;AACH;AAQM,SAAS8H,OAAT,CAAiB9S,GAAjB,EAA6C;AAEhD,MAAM+S,KAAK,GAAG,EAAd;AACA,MAAIC,OAAO,GAAG,KAAd;AAEA,SAAO;AACHvL,OADG,eACYzL,IADZ,EAC2BxF,IAD3B,EACyC;AACxC,UAAI,CAACwc,OAAL,EAAc;AACVhT,WAAG,CAAChE,IAAD,CAAH,GAAYxF,IAAZ;AACA,aAAKyc,QAAL,CAAc,YAAM;AAChB,iBAAOjT,GAAG,CAAChE,IAAD,CAAV;AACH,SAFD;AAGH;;AACD,aAAOxF,IAAP;AACH,KATE;AAWHyc,YAXG,oBAWMzO,MAXN,EAWyB;AACxB,UAAIwO,OAAJ,EAAa;AACTxO,cAAM;AACT,OAFD,MAEO;AACHuO,aAAK,CAAC3Z,IAAN,CAAW8S,IAAI,CAAC1H,MAAD,CAAf;AACH;AACJ,KAjBE;AAmBHT,OAnBG,iBAmBwB;AACvB,UAAMrH,OAAO,GAAG,EAAhB;AACAsW,aAAO,GAAG,IAAV;;AAEA,aAAOD,KAAK,CAACpZ,MAAb,EAAqB;AACjB,YAAMuZ,IAAI,GAAGH,KAAK,CAACI,GAAN,EAAb;AACAzW,eAAO,CAACtD,IAAR,CAAa8Z,IAAI,EAAjB;AACH;;AAED,aAAO9Q,oBAAY,CAAC2B,GAAb,CAAiBrH,OAAjB,EAA0ByE,IAA1B,CAA+BtK,aAA/B,CAAP;AACH;AA7BE,GAAP;AA+BH;AAEM,SAASuc,QAAT,CAAqBzK,EAArB,EAAyG;AAC5G,MAAIxP,MAAJ;AACA,MAAIsJ,KAAJ;;AAEA,MAAI;AACAtJ,UAAM,GAAGwP,EAAE,EAAX;AACH,GAFD,CAEE,OAAO5Q,GAAP,EAAY;AACV0K,SAAK,GAAG1K,GAAR;AACH,GAR2G,CAU5G;;;AACA,SAAO;AAAEoB,UAAM,EAANA,MAAF;AAAUsJ,SAAK,EAALA;AAAV,GAAP;AACH;AAEM,SAAS4Q,eAAT,CAA0CC,GAA1C,EAAmD9c,IAAnD,EAA6D;AAChE,MAAM8R,KAAK,GAAGgL,GAAG,CAAC5a,OAAJ,CAAYlC,IAAZ,CAAd;;AACA,MAAI8R,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdgL,OAAG,CAAC7X,MAAJ,CAAW6M,KAAX,EAAkB,CAAlB;AACH;AACJ;AAEM,SAASiL,YAAT,CAAyBvX,IAAzB,EAAwCwX,KAAxC,EAAqE;AACxE,MAAIA,KAAK,KAAK,IAAV,IAAkB,OAAOA,KAAP,KAAiB,WAAvC,EAAoD;AAChD,UAAM,IAAInb,KAAJ,eAAuB2D,IAAvB,oBAAN;AACH;;AAED,SAAOwX,KAAP;AACH;AAEM,SAASC,MAAT,CAAgBH,GAAhB,EAAuE;AAC1E,MAAMna,MAAM,GAAG,EAAf;;AAD0E,0BAEvDma,GAFuD,gBAElD;AAAnB,QAAM9c,IAAI,GAAI8c,GAAJ,KAAV;AACD;AACAna,UAAM,CAAC3C,IAAD,CAAN,GAAe,IAAf;AACH;;AACD,SAAOC,MAAM,CAAC2N,IAAP,CAAYjL,MAAZ,CAAP;AACH,C;;ACtiCM,IAAMua,SAAS,GAAG;AACrBC,OAAK,EAAE;AADc,CAAlB,C;;;;ACDP;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AAKO,SAASC,eAAT,GAAqC;AACxC,SAAO7W,OAAO,CAAC8D,QAAQ,CAACgT,IAAV,CAAP,IAA0BhT,QAAQ,CAACiT,UAAT,KAAwB,UAAzD;AACH;AAEM,SAASC,SAAT,CAAmB/K,GAAnB,EAA0C;AAC7C,SAAOA,GAAG,CAACxI,OAAJ,CAAY,KAAZ,EAAmB,KAAnB,EAA0BA,OAA1B,CAAkC,IAAlC,EAAwC,KAAxC,EAA+CA,OAA/C,CAAuD,IAAvD,EAA6D,KAA7D,EAAoEA,OAApE,CAA4E,KAA5E,EAAmF,KAAnF,CAAP;AACH;AAEM,SAASwT,kBAAT,GAAmD;AACtD,SAAOjI,aAAa,CAACiI,kBAAD,EAAqB,YAA2B;AAChE,WAAO,IAAI5R,oBAAJ,CAAiB,UAAAL,OAAO,EAAI;AAC/B,UAAI6R,eAAe,EAAnB,EAAuB;AACnB7R,eAAO;AACV;;AAEDtK,YAAM,CAACwc,gBAAP,CAAwB,MAAxB,EAAgC;AAAA,eAAMlS,OAAO,EAAb;AAAA,OAAhC;AACH,KANM,CAAP;AAOH,GARmB,CAApB;AASH;AAEM,SAASmS,oBAAT,GAAqD;AACxD,SAAOnI,aAAa,CAACmI,oBAAD,EAAuB,YAA2B;AAClE,WAAO,IAAI9R,oBAAJ,CAAiB,UAAAL,OAAO,EAAI;AAE/B,UAAI6R,eAAe,EAAnB,EAAuB;AACnB,eAAO7R,OAAO,EAAd;AACH;;AAED,UAAImP,QAAQ,GAAGiD,WAAW,CAAC,YAAM;AAC7B,YAAIP,eAAe,EAAnB,EAAuB;AACnBQ,uBAAa,CAAClD,QAAD,CAAb;AACA,iBAAOnP,OAAO,EAAd;AACH;AACJ,OALyB,EAKvB,EALuB,CAA1B;AAMH,KAZM,CAAP;AAaH,GAdmB,CAApB;AAeH;AAEM,SAASsS,mBAAT,GAA+D;AAClE,SAAOH,oBAAoB,GAAG/S,IAAvB,CAA4B,YAAM;AACrC,QAAIN,QAAQ,CAACgT,IAAb,EAAmB;AACf,aAAOhT,QAAQ,CAACgT,IAAhB;AACH;;AAED,UAAM,IAAIxb,KAAJ,CAAU,8CAAV,CAAN;AACH,GANM,CAAP;AAOH;AAEM,SAASic,UAAT,CAAoBC,WAApB,EAAmD;AACtD,SAAOxI,aAAa,CAACuI,UAAD,EAAa,YAAe;AAC5C,QAAIE,MAAM,GAAG,EAAb;;AAEA,QAAI,CAACD,WAAL,EAAkB;AACd,aAAOC,MAAP;AACH;;AAED,QAAID,WAAW,CAAC7b,OAAZ,CAAoB,GAApB,MAA6B,CAAC,CAAlC,EAAqC;AACjC,aAAO8b,MAAP;AACH;;AAT2C,4CAW3BD,WAAW,CAACpV,KAAZ,CAAkB,GAAlB,CAX2B,2CAWH;AAApC,UAAIsV,IAAI,2BAAR;AACDA,UAAI,GAAGA,IAAI,CAACtV,KAAL,CAAW,GAAX,CAAP;;AAEA,UAAIsV,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAnB,EAAwB;AACpBD,cAAM,CAAC5K,kBAAkB,CAAC6K,IAAI,CAAC,CAAD,CAAL,CAAnB,CAAN,GAAsC7K,kBAAkB,CAAC6K,IAAI,CAAC,CAAD,CAAL,CAAxD;AACH;AACJ;;AAED,WAAOD,MAAP;AACH,GApBmB,EAoBjB,CAAED,WAAF,CApBiB,CAApB;AAqBH;AAGM,SAASG,aAAT,CAAuB1Y,IAAvB,EAA+C;AAClD,SAAOsY,UAAU,CAAC7c,MAAM,CAACC,QAAP,CAAgBid,MAAhB,CAAuBvV,KAAvB,CAA6B,CAA7B,CAAD,CAAV,CAA4CpD,IAA5C,CAAP;AACH;AAEM,SAAS4Y,mBAAT,CAA6B1V,GAA7B,EAAqD;AAExD,MAAIA,GAAG,CAACxG,OAAJ,CAAY,GAAZ,MAAqB,CAAC,CAA1B,EAA6B;AACzB,WAAO,IAAP;AACH;;AAED,MAAIwG,GAAG,CAACxG,OAAJ,CAAY,GAAZ,MAAqB,CAAzB,EAA4B;AACxB,WAAO,KAAP;AACH;;AAED,MAAIwG,GAAG,CAACC,KAAJ,CAAU,GAAV,EAAe,CAAf,MAAsB1H,MAAM,CAACC,QAAP,CAAgBS,IAAhB,CAAqBgH,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAA1B,EAA8D;AAC1D,WAAO,KAAP;AACH;;AAED,SAAO,IAAP;AACH;AAEM,SAAS0V,WAAT,CAAqB7U,GAArB,EAAkE;AAAA,MAA7CA,GAA6C;AAA7CA,OAA6C,GAAb,EAAa;AAAA;;AAErE,SAAOvJ,MAAM,CAAC2N,IAAP,CAAYpE,GAAZ,EAAiBsO,MAAjB,CAAwB,UAAAhK,GAAG,EAAI;AAClC,WAAO,OAAOtE,GAAG,CAACsE,GAAD,CAAV,KAAoB,QAA3B;AACH,GAFM,EAEJD,GAFI,CAEA,UAAAC,GAAG,EAAI;AACV,WAAWyP,SAAS,CAACzP,GAAD,CAApB,SAA+ByP,SAAS,CAAC/T,GAAG,CAACsE,GAAD,CAAJ,CAAxC;AACH,GAJM,EAIJtF,IAJI,CAIC,GAJD,CAAP;AAKH;AAEM,SAAS8V,WAAT,CAAqBC,aAArB,EAA6CC,KAA7C,EAA4F;AAAA,MAA/CA,KAA+C;AAA/CA,SAA+C,GAAb,EAAa;AAAA;;AAE/F,MAAI,CAACA,KAAD,IAAU,CAACve,MAAM,CAAC2N,IAAP,CAAY4Q,KAAZ,EAAmBrb,MAAlC,EAA0C;AACtC,WAAOob,aAAP;AACH;;AAED,SAAOF,WAAW,CAAC,aACZP,UAAU,CAACS,aAAD,CADC,MAEXC,KAFW,EAAlB;AAIH;AAEM,SAASC,SAAT,CAAmB/V,GAAnB,EAAiCgM,OAAjC,EAA4H;AAAA,MAA3FA,OAA2F;AAA3FA,WAA2F,GAAb,EAAa;AAAA;;AAE/H,MAAIgK,KAAK,GAAGhK,OAAO,CAACgK,KAAR,IAAiB,EAA7B;AACA,MAAI/Q,IAAI,GAAG+G,OAAO,CAAC/G,IAAR,IAAgB,EAA3B;AAEA,MAAIgR,WAAJ;AACA,MAAIJ,aAAJ;AACA,MAAIK,YAAJ;;AAP+H,mBAS/FlW,GAAG,CAACC,KAAJ,CAAU,GAAV,CAT+F;;AAS7HgW,aAT6H;AAShHC,cATgH;;AAAA,2BAU9FD,WAAW,CAAChW,KAAZ,CAAkB,GAAlB,CAV8F;;AAU7HgW,aAV6H;AAUhHJ,eAVgH;AAY/H,MAAIR,WAAW,GAAGO,WAAW,CAACC,aAAD,EAAgBG,KAAhB,CAA7B;AACA,MAAIG,UAAU,GAAGP,WAAW,CAACM,YAAD,EAAejR,IAAf,CAA5B;;AAEA,MAAIoQ,WAAJ,EAAiB;AACbY,eAAW,GAAOA,WAAP,SAAwBZ,WAAnC;AACH;;AAED,MAAIc,UAAJ,EAAgB;AACZF,eAAW,GAAOA,WAAP,SAAwBE,UAAnC;AACH;;AAED,SAAOF,WAAP;AACH;AAEM,SAASG,QAAT,CAAkBpW,GAAlB,EAAgC1H,GAAhC,EAA2F;AAAA,MAA3DA,GAA2D;AAA3DA,OAA2D,GAA7BC,MAA6B;AAAA;;AAC9F,SAAO,IAAI2K,oBAAJ,CAAiB,UAAAL,OAAO,EAAI;AAC/BvK,OAAG,CAACE,QAAJ,GAAewH,GAAf;;AACA,QAAI,CAAC0V,mBAAmB,CAAC1V,GAAD,CAAxB,EAA+B;AAC3B6C,aAAO;AACV;AACJ,GALM,CAAP;AAMH;AAEM,SAASwT,eAAT,GAAqC;AACxC,MAAIC,IAAI,GAAG3U,QAAQ,CAACsF,aAAT,CAAuB,qBAAvB,CAAX;;AAEA,MAAItB,QAAQ,MAAMpN,MAAM,CAACge,MAAP,CAAcC,KAAd,GAAsB,GAApC,IAA2C,CAACF,IAAhD,EAAsD;AAClD,WAAO,KAAP;AACH;;AAED,SAAO,IAAP;AACH;AAEM,SAASG,gBAAT,CAA0B/D,EAA1B,EAAsD;AACzD,SAAO7U,OAAO,CAAC6U,EAAE,CAACgE,WAAH,IAAkBhE,EAAE,CAACiE,YAArB,IAAqCjE,EAAE,CAACkE,cAAH,GAAoBnc,MAA1D,CAAd;AACH;AAEM,SAASoc,iBAAT,GAAuC;AAC1C,SAAOhK,aAAa,CAACgK,iBAAD,EAAoB,YAAgB;AACpD;AACA,WAAOhZ,OAAO,CACVtF,MAAM,CAACue,WAAP,IACAA,WAAW,CAACxK,GADZ,IAEAwK,WAAW,CAACC,MAFZ,IAGAD,WAAW,CAACC,MAAZ,CAAmBC,UAHnB,IAIAF,WAAW,CAACC,MAAZ,CAAmBE,eAJnB,IAKCrO,IAAI,CAAC4E,GAAL,CAASsJ,WAAW,CAACxK,GAAZ,KAAoBnB,IAAI,CAACmB,GAAL,EAA7B,IAA2C,IAL5C,IAMCwK,WAAW,CAACxK,GAAZ,MAAqBwK,WAAW,CAACC,MAAZ,CAAmBC,UAAnB,GAAgCF,WAAW,CAACC,MAAZ,CAAmBE,eAAxE,CAAD,GAA6F,CAPnF,CAAd;AASA;AACH,GAZmB,CAApB;AAaH;AAEM,SAASC,iBAAT,GAAqD;AACxD,SAAOlC,oBAAoB,GAAG/S,IAAvB,CAA4B,YAAM;AAErC,QAAI,CAAC4U,iBAAiB,EAAtB,EAA0B;AACtB;AACH;;AAED,QAAIE,MAAM,GAAGxe,MAAM,CAACue,WAAP,CAAmBC,MAAhC;;AAEA,QAAIA,MAAM,CAACC,UAAP,IAAqBD,MAAM,CAACI,cAAhC,EAAgD;AAC5C,aAAOJ,MAAM,CAACI,cAAP,GAAwBJ,MAAM,CAACC,UAAtC;AACH;AACJ,GAXM,CAAP;AAYH;AAEM,SAASI,UAAT,CAAoBC,IAApB,EAAiD;AAAA,MAA7BA,IAA6B;AAA7BA,QAA6B,GAAb,EAAa;AAAA;;AACpD,SAAOA,IAAI,CAAC5f,QAAL,GACF6J,OADE,CACM,IADN,EACY,OADZ,EAEFA,OAFE,CAEM,IAFN,EAEY,MAFZ,EAGFA,OAHE,CAGM,IAHN,EAGY,MAHZ,EAIFA,OAJE,CAIM,IAJN,EAIY,QAJZ,EAKFA,OALE,CAKM,IALN,EAKY,OALZ,EAMFA,OANE,CAMM,KANN,EAMa,QANb,CAAP;AAOH;AAEM,SAASJ,aAAT,GAA+B;AAClC,SAAQ,OAAO3I,MAAP,KAAkB,WAA1B;AACH;AAEM,SAASqJ,gBAAT,CAA0B0V,QAA1B,EAA6C9b,GAA7C,EAAuG;AAAA,MAA1DA,GAA0D;AAA1DA,OAA0D,GAAtCjD,MAAM,CAACoJ,QAA+B;AAAA;;AAC1G,SAAOrC,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBxI,IAAtB,CAA2B8D,GAAG,CAACoG,gBAAJ,CAAqB0V,QAArB,CAA3B,CAAP;AACH;AAEM,SAASC,OAAT,CAAiBC,OAAjB,EAAwC/U,OAAxC,EAAmE;AACtE+U,SAAO,CAACzC,gBAAR,CAAyB,YAAzB,EAAuCpd,aAAvC;AACA6f,SAAO,CAACzC,gBAAR,CAAyB,OAAzB,EAAkCtS,OAAlC;AACA+U,SAAO,CAACzC,gBAAR,CAAyB,UAAzB,EAAqC,UAAC0C,KAAD,EAAmB;AACpD;AACA,QAAIA,KAAK,CAACC,OAAN,KAAkBlD,SAAS,CAACC,KAAhC,EAAuC;AACnC,aAAOhS,OAAO,CAACgV,KAAD,CAAd;AACH;AACJ,GALD;AAMH;AAEM,SAASE,SAAT,OAAmH;AAAA,uBAA9Fve,IAA8F;AAAA,MAA9FA,IAA8F,0BAAvFb,MAAM,CAACC,QAAP,CAAgBY,IAAuE;AAAA,MAAjEwY,IAAiE,QAAjEA,IAAiE;AACtH,SAAO/E,aAAa,CAAC8K,SAAD,EAAY,YAA2B;AAEvD,QAAI3X,GAAG,QAAO5G,IAAP,GAAgBwY,IAAvB;AACA,QAAIgG,OAAO,GAAGtY,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBxI,IAAtB,CAA2BiK,QAAQ,CAACkW,oBAAT,CAA8B,QAA9B,CAA3B,CAAd;;AAHuD,4BAKpCD,OALoC,gBAK3B;AAAvB,UAAIE,MAAM,GAAIF,OAAJ,KAAV;;AACD,UAAI,CAACE,MAAM,CAACC,GAAZ,EAAiB;AACb;AACH;;AAED,UAAIA,GAAG,GAAGD,MAAM,CAACC,GAAP,CAAWzW,OAAX,CAAmB,cAAnB,EAAmC,EAAnC,EAAuCrB,KAAvC,CAA6C,GAA7C,EAAkD,CAAlD,CAAV;;AAEA,UAAI8X,GAAG,KAAK/X,GAAZ,EAAiB;AACb,eAAO8X,MAAP;AACH;AACJ;AACJ,GAhBmB,EAgBjB,CAAElG,IAAF,CAhBiB,CAApB;AAiBH;AAEM,SAASoG,qBAAT,GAA2C;AAC9C,SAAOnL,aAAa,CAACmL,qBAAD,EAAwB,YAAM;AAC9C,QAAI;AACA,UAAI,OAAOzf,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,eAAO,KAAP;AACH;;AAED,UAAIA,MAAM,CAAC0f,YAAX,EAAyB;AACrB,YAAI3U,KAAK,GAAGsF,IAAI,CAACC,MAAL,GAAcpR,QAAd,EAAZ;AACAc,cAAM,CAAC0f,YAAP,CAAoBC,OAApB,CAA4B,wBAA5B,EAAsD5U,KAAtD;AACA,YAAIrJ,MAAM,GAAG1B,MAAM,CAAC0f,YAAP,CAAoBE,OAApB,CAA4B,wBAA5B,CAAb;AACA5f,cAAM,CAAC0f,YAAP,CAAoBG,UAApB,CAA+B,wBAA/B;;AACA,YAAI9U,KAAK,KAAKrJ,MAAd,EAAsB;AAClB,iBAAO,IAAP;AACH;AACJ;AACJ,KAdD,CAcE,OAAOpB,GAAP,EAAY,CACV;AACH;;AACD,WAAO,KAAP;AACH,GAnBmB,CAApB;AAoBH;AAEM,SAASwf,iBAAT,GAA2E;AAC9E,MAAIC,GAAG,GAAG/f,MAAM,CAACmE,SAAjB;AAEA,MAAI6b,OAAO,GAAGD,GAAG,CAACE,SAAJ,GACRlZ,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBuF,KAAtB,CAA4B6S,GAAG,CAACE,SAAhC,CADQ,GAER,EAFN;;AAIA,MAAIF,GAAG,CAACG,QAAR,EAAkB;AACdF,WAAO,CAACre,IAAR,CAAaoe,GAAG,CAACG,QAAjB;AACH;;AAED,MAAIH,GAAG,CAACI,YAAR,EAAsB;AAClBH,WAAO,CAACre,IAAR,CAAaoe,GAAG,CAACI,YAAjB;AACH;;AAED,SAAOH,OAAO,CAACpT,GAAR,CAAY,UAAAwT,MAAM,EAAI;AAEzB,QAAIA,MAAM,IAAIA,MAAM,CAACnZ,KAAP,CAAa,wBAAb,CAAd,EAAsD;AAAA,0BAC1BmZ,MAAM,CAAC1Y,KAAP,CAAa,MAAb,CAD0B;AAAA,UAC5C2Y,IAD4C;AAAA,UACtCC,OADsC;;AAElD,aAAO;AAAEA,eAAO,EAAPA,OAAF;AAAWD,YAAI,EAAJA;AAAX,OAAP;AACH;;AAED,QAAID,MAAM,IAAIA,MAAM,CAACnZ,KAAP,CAAa,YAAb,CAAd,EAA0C;AACtC,aAAO;AAAEoZ,YAAI,EAAED;AAAR,OAAP;AACH;;AAED,WAAO,IAAP;AAEH,GAbM,EAaJvJ,MAbI,CAaGvR,OAbH,CAAP;AAcH;AAGM,SAASib,WAAT,CAAqBC,SAArB,EAA8C3e,KAA9C,EAA0E;AAC7E2e,WAAS,CAACD,WAAV,CAAsB1e,KAAtB;AACH;AAEM,SAAS4e,SAAT,CAAmBxB,OAAnB,EAA8C;AAEjD,MAAIA,OAAO,YAAYjf,MAAM,CAAC0gB,OAA9B,EAAuC;AACnC,WAAO,IAAP;AACH;;AAED,MAAIzB,OAAO,KAAK,IAAZ,IAAoB,OAAOA,OAAP,KAAmB,QAAvC,IAAmDA,OAAO,CAAC0B,QAAR,KAAqB,CAAxE,IAA6E,OAAO1B,OAAO,CAAC2B,KAAf,KAAyB,QAAtG,IAAkH,OAAO3B,OAAO,CAAC/b,aAAf,KAAiC,QAAvJ,EAAiK;AAC7J,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAAS2d,cAAT,CAAwBC,EAAxB,EAA6C7d,GAA7C,EAAqG;AAAA,MAAxDA,GAAwD;AAAxDA,OAAwD,GAAzBmG,QAAyB;AAAA;;AAExG,MAAIqX,SAAS,CAACK,EAAD,CAAb,EAAmB;AACf;AACA,WAAOA,EAAP;AACH;;AAED,MAAI,OAAOA,EAAP,KAAc,QAAlB,EAA4B;AACxB,WAAO7d,GAAG,CAACyL,aAAJ,CAAkBoS,EAAlB,CAAP;AACH;AACJ;AAEM,SAASC,UAAT,CAAoBD,EAApB,EAAyC7d,GAAzC,EAAgG;AAAA,MAAvDA,GAAuD;AAAvDA,OAAuD,GAAxBmG,QAAwB;AAAA;;AAEnG,MAAI6V,OAAO,GAAG4B,cAAc,CAACC,EAAD,EAAK7d,GAAL,CAA5B;;AAEA,MAAIgc,OAAJ,EAAa;AACT,WAAOA,OAAP;AACH;;AAED,QAAM,IAAIre,KAAJ,4BAAoCuG,SAAS,CAAC2Z,EAAD,CAA7C,CAAN;AACH;AAEM,SAASE,YAAT,CAAsBF,EAAtB,EAA8E;AACjF,SAAO,IAAInW,oBAAJ,CAAiB,UAACL,OAAD,EAAUgB,MAAV,EAAqB;AAEzC,QAAI/G,IAAI,GAAG4C,SAAS,CAAC2Z,EAAD,CAApB;AACA,QAAI3G,EAAE,GAAG0G,cAAc,CAACC,EAAD,CAAvB;;AAEA,QAAI3G,EAAJ,EAAQ;AACJ,aAAO7P,OAAO,CAAC6P,EAAD,CAAd;AACH;;AAED,QAAIgC,eAAe,EAAnB,EAAuB;AACnB,aAAO7Q,MAAM,CAAC,IAAI1K,KAAJ,oCAA4C2D,IAA5C,qBAAD,CAAb;AACH;;AAED,QAAIkV,QAAQ,GAAGiD,WAAW,CAAC,YAAM;AAE7BvC,QAAE,GAAG0G,cAAc,CAACC,EAAD,CAAnB;;AAEA,UAAI3G,EAAJ,EAAQ;AACJwC,qBAAa,CAAClD,QAAD,CAAb;AACA,eAAOnP,OAAO,CAAC6P,EAAD,CAAd;AACH;;AAED,UAAIgC,eAAe,EAAnB,EAAuB;AACnBQ,qBAAa,CAAClD,QAAD,CAAb;AACA,eAAOnO,MAAM,CAAC,IAAI1K,KAAJ,oCAA4C2D,IAA5C,qBAAD,CAAb;AACH;AACJ,KAbyB,EAavB,EAbuB,CAA1B;AAcH,GA3BM,CAAP;AA4BH;AAEM,SAAS0c,cAAT,CAAwBrd,OAAxB,EAA0C;AAC7C,OAAKA,OAAL,GAAeA,OAAf;AACH;AAEDqd,cAAc,CAAChiB,SAAf,GAA2BD,MAAM,CAACkiB,MAAP,CAActgB,KAAK,CAAC3B,SAApB,CAA3B;AAeO,SAASkiB,KAAT,CAAe1Z,GAAf,EAA6BgM,OAA7B,EAA8E;AAEjF;AACAA,SAAO,GAAGA,OAAO,IAAI,EAArB;AAHiF,iBAKzDA,OALyD;AAAA,MAK3EwK,KAL2E,YAK3EA,KAL2E;AAAA,MAKpEmD,MALoE,YAKpEA,MALoE;AAOjF,MAAI5e,GAAG,GAAG,CAAV;AACA,MAAI6e,IAAI,GAAG,CAAX;;AAEA,MAAIpD,KAAJ,EAAW;AACP,QAAIje,MAAM,CAACshB,UAAX,EAAuB;AACnBD,UAAI,GAAGhR,IAAI,CAAC+F,KAAL,CAAW,CAACpW,MAAM,CAACshB,UAAP,GAAoBrD,KAArB,IAA8B,CAAzC,IAA8Cje,MAAM,CAACuhB,OAA5D;AACH,KAFD,MAEO,IAAIvhB,MAAM,CAACge,MAAP,CAAcC,KAAlB,EAAyB;AAC5BoD,UAAI,GAAGhR,IAAI,CAAC+F,KAAL,CAAW,CAACpW,MAAM,CAACge,MAAP,CAAcC,KAAd,GAAsBA,KAAvB,IAAgC,CAA3C,CAAP;AACH;AACJ;;AAED,MAAImD,MAAJ,EAAY;AACR,QAAIphB,MAAM,CAACwhB,WAAX,EAAwB;AACpBhf,SAAG,GAAG6N,IAAI,CAAC+F,KAAL,CAAW,CAACpW,MAAM,CAACwhB,WAAP,GAAqBJ,MAAtB,IAAgC,CAA3C,IAAgDphB,MAAM,CAACyhB,OAA7D;AACH,KAFD,MAEO,IAAIzhB,MAAM,CAACge,MAAP,CAAcoD,MAAlB,EAA0B;AAC7B5e,SAAG,GAAG6N,IAAI,CAAC+F,KAAL,CAAW,CAACpW,MAAM,CAACge,MAAP,CAAcoD,MAAd,GAAuBA,MAAxB,IAAkC,CAA7C,CAAN;AACH;AACJ;;AAED,MAAInD,KAAK,IAAImD,MAAb,EAAqB;AACjB3N,WAAO,GAAG;AACNjR,SAAG,EAAHA,GADG;AAEH6e,UAAI,EAAJA,IAFG;AAGHpD,WAAK,EAALA,KAHG;AAIHmD,YAAM,EAANA,MAJG;AAKHnS,YAAM,EAAM,CALT;AAMHyS,aAAO,EAAK,CANT;AAOHC,aAAO,EAAK,CAPT;AAQHC,eAAS,EAAG,CART;AASHC,gBAAU,EAAE;AATT,OAUApO,OAVA,CAAP;AAYH;;AAED,MAAIlP,IAAI,GAAGkP,OAAO,CAAClP,IAAR,IAAgB,EAA3B;AACA,SAAOkP,OAAO,CAAClP,IAAf,CA1CiF,CA4CjF;;AACA,MAAIwY,MAAM,GAAG/d,MAAM,CAAC2N,IAAP,CAAY8G,OAAZ,EAAqB7G,GAArB,CAAyB,UAAAC,GAAG,EAAI;AACzC;AACA,QAAI4G,OAAO,CAAC5G,GAAD,CAAP,KAAiB,IAAjB,IAAyB4G,OAAO,CAAC5G,GAAD,CAAP,KAAiBd,SAA9C,EAAyD;AACrD,aAAWc,GAAX,SAAoB1F,SAAS,CAACsM,OAAO,CAAC5G,GAAD,CAAR,CAA7B;AACH;AACJ,GALY,EAKVgK,MALU,CAKHvR,OALG,EAKMiC,IALN,CAKW,GALX,CAAb;AAOA,MAAIxH,GAAJ;;AAEA,MAAI;AACAA,OAAG,GAAGC,MAAM,CAAC8hB,IAAP,CAAYra,GAAZ,EAAiBlD,IAAjB,EAAuBwY,MAAvB,EAA+B,IAA/B,CAAN;AACH,GAFD,CAEE,OAAOzc,GAAP,EAAY;AACV,UAAM,IAAI2gB,cAAJ,mCAAmD3gB,GAAG,CAAC6K,KAAJ,IAAa7K,GAAG,CAACsD,OAApE,EAAN;AACH;;AAED,MAAIH,cAAc,CAAC1D,GAAD,CAAlB,EAAyB;AACrB,QAAIO,GAAG,GAAG,IAAI2gB,cAAJ,uCAAV;AACA,UAAM3gB,GAAN;AACH;;AAEDN,QAAM,CAACwc,gBAAP,CAAwB,QAAxB,EAAkC;AAAA,WAAMzc,GAAG,CAACkJ,KAAJ,EAAN;AAAA,GAAlC;AAEA,SAAOlJ,GAAP;AACH;AAGM,SAASgiB,aAAT,CAAuBhiB,GAAvB,EAAmD+e,IAAnD,EAAkE;AACrE,MAAI;AACA/e,OAAG,CAACqJ,QAAJ,CAAa0Y,IAAb;AACA/hB,OAAG,CAACqJ,QAAJ,CAAa4Y,KAAb,CAAmBlD,IAAnB;AACA/e,OAAG,CAACqJ,QAAJ,CAAaH,KAAb;AACH,GAJD,CAIE,OAAO3I,GAAP,EAAY;AACV,QAAI;AACAP,SAAG,CAACE,QAAJ,oDAA+DiH,IAAI,CAACC,SAAL,CAAe2X,IAAf,CAA/D;AACH,KAFD,CAEE,OAAOmD,IAAP,EAAa,CACX;AACH;AACJ;AACJ;AAEM,SAASC,oBAAT,CAA8BniB,GAA9B,EAA0Doa,EAA1D,EAA4E;AAE/E,MAAIgI,GAAG,GAAGhI,EAAE,CAACiI,OAAH,CAAWtP,WAAX,EAAV;;AAEA,MAAIqP,GAAG,KAAK,MAAZ,EAAoB;AAChB,UAAM,IAAIvhB,KAAJ,uCAA+CuhB,GAA/C,CAAN;AACH;;AAED,MAAIhf,eAAe,GAAGpD,GAAG,CAACqJ,QAAJ,CAAajG,eAAnC;;AAR+E,kCAU3DwW,SAAS,CAACxW,eAAe,CAACkf,QAAjB,CAVkD,mCAUtB;AAApD,QAAMxgB,KAAK,mBAAX;AACDsB,mBAAe,CAACmf,WAAhB,CAA4BzgB,KAA5B;AACH;;AAZ8E,kCAc3D8X,SAAS,CAACQ,EAAE,CAACkI,QAAJ,CAdkD,mCAcnC;AAAvC,QAAMxgB,MAAK,mBAAX;AACDsB,mBAAe,CAACod,WAAhB,CAA4B1e,MAA5B;AACH;AACJ;AAEM,SAAS0gB,QAAT,CAAkBpI,EAAlB,EAAoCqI,SAApC,EAAwDvf,GAAxD,EAA0F;AAAA,MAAlCA,GAAkC;AAAlCA,OAAkC,GAAjBjD,MAAM,CAACoJ,QAAU;AAAA;;AAC7F;AACA,MAAI+Q,EAAE,CAACsI,UAAP,EAAmB;AACf;AACAtI,MAAE,CAACsI,UAAH,CAAcC,OAAd,GAAwBF,SAAxB;AACH,GAHD,MAGO;AACHrI,MAAE,CAACoG,WAAH,CAAetd,GAAG,CAAC0f,cAAJ,CAAmBH,SAAnB,CAAf;AACH;AACJ;AAWD,IAAII,sBAAJ;AAEO,SAASC,cAAT,CAAwBzgB,KAAxB,EAAqF;AACxFwgB,wBAAsB,GAAGA,sBAAsB,IAAI,IAAIjT,8BAAJ,EAAnD;;AAEA,MAAIiT,sBAAsB,CAAC9R,GAAvB,CAA2B1O,KAA3B,CAAJ,EAAuC;AACnC,QAAI0H,QAAO,GAAG8Y,sBAAsB,CAAC3S,GAAvB,CAA2B7N,KAA3B,CAAd;;AACA,QAAI0H,QAAJ,EAAa;AACT,aAAOA,QAAP;AACH;AACJ;;AAED,MAAIA,OAAO,GAAG,IAAIa,oBAAJ,CAAiB,UAACL,OAAD,EAAUgB,MAAV,EAAqB;AAChDlJ,SAAK,CAACoa,gBAAN,CAAuB,MAAvB,EAA+B,YAAM;AACjCvY,qBAAe,CAAC7B,KAAD,CAAf;AACAkI,aAAO,CAAClI,KAAD,CAAP;AACH,KAHD;AAKAA,SAAK,CAACoa,gBAAN,CAAuB,OAAvB,EAAgC,UAAClc,GAAD,EAAiB;AAC7C,UAAI8B,KAAK,CAACW,aAAV,EAAyB;AACrBuH,eAAO,CAAClI,KAAD,CAAP;AACH,OAFD,MAEO;AACHkJ,cAAM,CAAChL,GAAD,CAAN;AACH;AACJ,KAND;AAOH,GAba,CAAd;AAeAsiB,wBAAsB,CAAC5S,GAAvB,CAA2B5N,KAA3B,EAAkC0H,OAAlC;AAEA,SAAOA,OAAP;AACH;AAEM,SAASgZ,gBAAT,CAA0B1gB,KAA1B,EAA2F;AAC9F,SAAOygB,cAAc,CAACzgB,KAAD,CAAd,CAAsBsH,IAAtB,CAA2B,UAAAqZ,WAAW,EAAI;AAE7C,QAAI,CAACA,WAAW,CAAChgB,aAAjB,EAAgC;AAC5B,YAAM,IAAInC,KAAJ,mCAAN;AACH;;AAED,WAAOmiB,WAAW,CAAChgB,aAAnB;AACH,GAPM,CAAP;AAQH;AAEM,SAASigB,aAAT,CAAuBb,GAAvB,EAA6C1O,OAA7C,EAAgF+M,SAAhF,EAAwH;AAAA,MAAjG2B,GAAiG;AAAjGA,OAAiG,GAAlF,KAAkF;AAAA;;AAAA,MAA3E1O,OAA2E;AAA3EA,WAA2E,GAA5C,EAA4C;AAAA;;AAE3H0O,KAAG,GAAGA,GAAG,CAACrP,WAAJ,EAAN;AACA,MAAImM,OAAO,GAAG7V,QAAQ,CAAC4Z,aAAT,CAAuBb,GAAvB,CAAd;;AAEA,MAAI1O,OAAO,CAACmN,KAAZ,EAAmB;AACf5K,UAAM,CAACiJ,OAAO,CAAC2B,KAAT,EAAgBnN,OAAO,CAACmN,KAAxB,CAAN;AACH;;AAED,MAAInN,OAAO,CAACwP,KAAZ,EAAmB;AACfhE,WAAO,CAACiE,SAAR,GAAoBzP,OAAO,CAACwP,KAAR,CAAc1b,IAAd,CAAmB,GAAnB,CAApB;AACH;;AAED,MAAIkM,OAAO,CAACqN,EAAZ,EAAgB;AACZ7B,WAAO,CAACkE,YAAR,CAAqB,IAArB,EAA2B1P,OAAO,CAACqN,EAAnC;AACH;;AAED,MAAIrN,OAAO,CAAC2P,UAAZ,EAAwB;AAAA,uCACJpkB,MAAM,CAAC2N,IAAP,CAAY8G,OAAO,CAAC2P,UAApB,CADI,uCAC6B;AAA5C,UAAIvW,GAAG,sBAAP;AACDoS,aAAO,CAACkE,YAAR,CAAqBtW,GAArB,EAA0B4G,OAAO,CAAC2P,UAAR,CAAmBvW,GAAnB,CAA1B;AACH;AACJ;;AAED,MAAI4G,OAAO,CAACgP,UAAZ,EAAwB;AACpBF,YAAQ,CAACtD,OAAD,EAAUxL,OAAO,CAACgP,UAAlB,CAAR;AACH;;AAED,MAAIjC,SAAJ,EAAe;AACXD,eAAW,CAACC,SAAD,EAAYvB,OAAZ,CAAX;AACH;;AAED,MAAIxL,OAAO,CAACqL,IAAZ,EAAkB;AACd,QAAIqD,GAAG,KAAK,QAAZ,EAAsB;AAClB;AACA,UAAI,CAAC3B,SAAD,IAAc,CAACvB,OAAO,CAAClc,aAA3B,EAA0C;AACtC,cAAM,IAAInC,KAAJ,8EAAN;AACH,OAJiB,CAMlB;;;AACAmhB,mBAAa,CAAC9C,OAAO,CAAClc,aAAT,EAAwB0Q,OAAO,CAACqL,IAAhC,CAAb;AAEH,KATD,MASO;AACHG,aAAO,CAACoE,SAAR,GAAoB5P,OAAO,CAACqL,IAA5B;AACH;AACJ;;AAED,SAAOG,OAAP;AACH;AAYM,SAASqE,UAAT,CAAgB7P,OAAhB,EAAyD+M,SAAzD,EAAuG;AAAA,MAAvF/M,OAAuF;AAAvFA,WAAuF,GAAlD,EAAkD;AAAA;;AAE1G,MAAI2P,UAAU,GAAG3P,OAAO,CAAC2P,UAAR,IAAsB,EAAvC;AACA,MAAIxC,KAAK,GAAGnN,OAAO,CAACmN,KAAR,IAAiB,EAA7B;AAEA,MAAIxe,KAAK,GAAG4gB,aAAa,CAAC,QAAD,EAAW;AAChCI,cAAU,EAAE;AACRG,uBAAiB,EAAE;AADb,OAEHH,UAFG,CADsB;AAKhCxC,SAAK,EAAE;AACH4C,qBAAe,EAAE,aADhB;AAEDC,YAAM,EAAW;AAFhB,OAGE7C,KAHF,CAL2B;AAUhC9B,QAAI,EAAGrL,OAAO,CAACqL,IAViB;AAWhCmE,SAAK,EAAExP,OAAO,CAACwP;AAXiB,GAAX,CAAzB;AAcA,MAAM3U,IAAI,GAAGtO,MAAM,CAACmE,SAAP,CAAiBE,SAAjB,CAA2B4C,KAA3B,CAAiC,YAAjC,CAAb;;AAEA,MAAI,CAAC7E,KAAK,CAACshB,YAAN,CAAmB,IAAnB,CAAL,EAA+B;AAC3BthB,SAAK,CAAC+gB,YAAN,CAAmB,IAAnB,EAAyB7Q,QAAQ,EAAjC;AACH,GAvByG,CAyB1G;;;AACAuQ,gBAAc,CAACzgB,KAAD,CAAd;;AAEA,MAAIoe,SAAJ,EAAe;AACX,QAAIrG,EAAE,GAAG4G,UAAU,CAACP,SAAD,CAAnB;AACArG,MAAE,CAACoG,WAAH,CAAene,KAAf;AACH;;AAED,MAAIqR,OAAO,CAAChM,GAAR,IAAe6G,IAAnB,EAAyB;AACrBlM,SAAK,CAAC+gB,YAAN,CAAmB,KAAnB,EAA0B1P,OAAO,CAAChM,GAAR,IAAe,aAAzC;AACH,GAnCyG,CAqC1G;;;AACA,SAAOrF,KAAP;AACH;AAEM,SAASoa,gBAAT,CAA0BjU,GAA1B,EAA6C2W,KAA7C,EAA6DhV,OAA7D,EAAiH;AACpH3B,KAAG,CAACiU,gBAAJ,CAAqB0C,KAArB,EAA4BhV,OAA5B;AACA,SAAO;AACH7B,UADG,oBACM;AACLE,SAAG,CAACob,mBAAJ,CAAwBzE,KAAxB,EAA+BhV,OAA/B;AACH;AAHE,GAAP;AAKH;AAEM,SAAS0Z,UAAT,CAAoB3E,OAApB,EAA2C4E,UAA3C,EAAuE3Z,OAAvE,EAA2H;AAE9HA,SAAO,GAAGuK,IAAI,CAACvK,OAAD,CAAd;;AAF8H,4BAIxG2Z,UAJwG,iBAI5F;AAA7B,QAAIpL,SAAS,GAAIoL,UAAJ,MAAb;AACD5E,WAAO,CAACzC,gBAAR,CAAyB/D,SAAzB,EAAoCvO,OAApC;AACH;;AAED,SAAO;AACH7B,UAAM,EAAEoM,IAAI,CAAC,YAAM;AAAA,gCACOoP,UADP,iBACmB;AAA7B,YAAIpL,UAAS,GAAIoL,UAAJ,MAAb;AACD5E,eAAO,CAAC0E,mBAAR,CAA4BlL,UAA5B,EAAuCvO,OAAvC;AACH;AACJ,KAJW;AADT,GAAP;AAOH;AAED,IAAM4Z,eAAe,GAAG,CAAE,QAAF,EAAY,KAAZ,EAAmB,IAAnB,EAAyB,GAAzB,CAAxB;AAEO,SAASC,YAAT,CAAsB9E,OAAtB,EAA6C1a,IAA7C,EAA4DwG,KAA5D,EAA4E;AAE/E;AACAkU,SAAO,CAAC2B,KAAR,CAAcrc,IAAd,IAAsBwG,KAAtB;AAEA,MAAIiZ,eAAe,GAAG5K,qBAAqB,CAAC7U,IAAD,CAA3C;;AAL+E,4BAO5Duf,eAP4D,iBAO3C;AAA/B,QAAIjM,MAAM,GAAIiM,eAAJ,MAAV;AACD;AACA7E,WAAO,CAAC2B,KAAR,MAAkB/I,MAAlB,GAA6BmM,eAA7B,IAAmDjZ,KAAnD;AACH;AACJ;AAED,IAAMkZ,sBAAsB,GAAG,CAAE,gBAAF,EAAoB,sBAApB,EAA4C,iBAA5C,EAA+D,kBAA/D,CAA/B;AACA,IAAMC,oBAAoB,GAAK,CAAE,cAAF,EAAkB,oBAAlB,EAAwC,eAAxC,EAAyD,gBAAzD,CAA/B;AAEO,SAASC,OAAT,CAAiBlF,OAAjB,EAA2C1a,IAA3C,EAA0D6f,KAA1D,EAAsFnc,OAAtF,EAAoI;AAAA,MAA9CA,OAA8C;AAA9CA,WAA8C,GAA3B,IAA2B;AAAA;;AACvI,SAAO,IAAI0C,oBAAJ,CAAiB,UAACL,OAAD,EAAUgB,MAAV,EAAqB;AAEzC,QAAI6O,EAAE,GAAG4G,UAAU,CAAC9B,OAAD,CAAnB;;AAEA,QAAI,CAAC9E,EAAL,EAAS;AACL,aAAO7P,OAAO,EAAd;AACH;;AAED,QAAI+Z,UAAU,GAAG,KAAjB;AAEA,QAAIC,YAAJ;AACA,QAAIC,UAAJ;AACA,QAAIC,UAAJ;AACA,QAAIC,QAAJ;;AAEA,aAASC,OAAT,GAAmB;AACfvc,kBAAY,CAACmc,YAAD,CAAZ;AACAnc,kBAAY,CAACoc,UAAD,CAAZ;AACAC,gBAAU,CAACnc,MAAX;AACAoc,cAAQ,CAACpc,MAAT;AACH;;AAEDmc,cAAU,GAAGZ,UAAU,CAACzJ,EAAD,EAAK8J,sBAAL,EAA6B,UAAA/E,KAAK,EAAI;AAEzD;AACA,UAAIA,KAAK,CAAC5P,MAAN,KAAiB6K,EAAjB,IAAuB+E,KAAK,CAACyF,aAAN,KAAwBpgB,IAAnD,EAAyD;AACrD;AACH;;AAED4D,kBAAY,CAACmc,YAAD,CAAZ;AAEApF,WAAK,CAAC0F,eAAN;AAEAJ,gBAAU,CAACnc,MAAX;AACAgc,gBAAU,GAAG,IAAb;AAEAE,gBAAU,GAAGnc,UAAU,CAAC,YAAM;AAC1Bsc,eAAO;AACPpa,eAAO;AACV,OAHsB,EAGpBrC,OAHoB,CAAvB;AAIH,KAlBsB,CAAvB;AAoBAwc,YAAQ,GAAGb,UAAU,CAACzJ,EAAD,EAAK+J,oBAAL,EAA2B,UAAAhF,KAAK,EAAI;AAErD;AACA,UAAIA,KAAK,CAAC5P,MAAN,KAAiB6K,EAAjB,IAAuB+E,KAAK,CAACyF,aAAN,KAAwBpgB,IAAnD,EAAyD;AACrD;AACH;;AAEDmgB,aAAO,GAP8C,CASrD;;AACA,UAAI,OAAOxF,KAAK,CAACyF,aAAb,KAA+B,QAA/B,IAA2CzF,KAAK,CAACyF,aAAN,KAAwBpgB,IAAvE,EAA6E;AACzE,eAAO+G,MAAM,oCAAmC/G,IAAnC,gBAAoD2a,KAAK,CAACyF,aAA1D,CAAb;AACH;;AAED,aAAOra,OAAO,EAAd;AACH,KAfoB,CAArB;AAiBAyZ,gBAAY,CAAC5J,EAAD,EAAK,eAAL,EAAsB5V,IAAtB,CAAZ;AAEA+f,gBAAY,GAAGlc,UAAU,CAAC,YAAM;AAC5B,UAAI,CAACic,UAAL,EAAiB;AACbK,eAAO;AACP,eAAOpa,OAAO,EAAd;AACH;AACJ,KALwB,EAKtB,GALsB,CAAzB;;AAOA,QAAI8Z,KAAJ,EAAW;AACPA,WAAK,CAACM,OAAD,CAAL;AACH;AACJ,GAvEM,CAAP;AAwEH;AAED,IAAMG,KAAK,GAAG;AAEVC,SAAO,EAAE;AACLC,QAAI,EAAG,MADF;AAELC,SAAK,EAAE;AAFF,GAFC;AAOVC,YAAU,EAAE;AACRC,WAAO,EAAE,SADD;AAERC,UAAM,EAAG;AAFD,GAPF;AAYVC,WAAS,EAAE;AAZD,CAAd;AAeO,SAASC,kBAAT,CAA4BpG,OAA5B,EAAmD;AACtDA,SAAO,CAAC2B,KAAR,CAAc0E,WAAd,CAA0B,YAA1B,EAAwC,EAAxC;AACH;AAEM,SAASC,oBAAT,CAA8BtG,OAA9B,EAAqD;AACxDA,SAAO,CAAC2B,KAAR,CAAc0E,WAAd,CAA0B,YAA1B,EAAwCT,KAAK,CAACI,UAAN,CAAiBE,MAAzD,EAAiEN,KAAK,CAACO,SAAvE;AACH;AAGM,SAASI,WAAT,CAAqBvG,OAArB,EAA4C;AAC/CA,SAAO,CAAC2B,KAAR,CAAc0E,WAAd,CAA0B,SAA1B,EAAqC,EAArC;AACH;AAEM,SAASG,WAAT,CAAqBxG,OAArB,EAA4C;AAC/CA,SAAO,CAAC2B,KAAR,CAAc0E,WAAd,CAA0B,SAA1B,EAAqCT,KAAK,CAACC,OAAN,CAAcC,IAAnD,EAAyDF,KAAK,CAACO,SAA/D;AACH;AAEM,SAASM,cAAT,CAAwBzG,OAAxB,EAA+C;AAClD,MAAIA,OAAO,IAAIA,OAAO,CAACjc,UAAvB,EAAmC;AAC/Bic,WAAO,CAACjc,UAAR,CAAmBsf,WAAnB,CAA+BrD,OAA/B;AACH;AACJ;AAEM,SAAS0G,cAAT,CAAwB1G,OAAxB,EAA+C1a,IAA/C,EAA8D6f,KAA9D,EAA+G;AAClH,MAAIwB,SAAS,GAAGzB,OAAO,CAAClF,OAAD,EAAU1a,IAAV,EAAgB6f,KAAhB,CAAvB;AACAoB,aAAW,CAACvG,OAAD,CAAX;AACA,SAAO2G,SAAP;AACH;AAEM,SAASC,cAAT,CAAwB5G,OAAxB,EAA+C1a,IAA/C,EAA8D6f,KAA9D,EAA+G;AAClH,SAAOD,OAAO,CAAClF,OAAD,EAAU1a,IAAV,EAAgB6f,KAAhB,CAAP,CAA8B1a,IAA9B,CAAmC,YAAM;AAC5C+b,eAAW,CAACxG,OAAD,CAAX;AACH,GAFM,CAAP;AAGH;AAEM,SAAS6G,QAAT,CAAkB7G,OAAlB,EAAyC1a,IAAzC,EAAwD;AAC3D0a,SAAO,CAAC8G,SAAR,CAAkBC,GAAlB,CAAsBzhB,IAAtB;AACH;AAEM,SAAS0hB,WAAT,CAAqBhH,OAArB,EAA4C1a,IAA5C,EAA2D;AAC9D0a,SAAO,CAAC8G,SAAR,CAAkBG,MAAlB,CAAyB3hB,IAAzB;AACH;AAEM,SAAS4hB,eAAT,CAAyBhM,EAAzB,EAAqD;AACxD,MAAI,CAACA,EAAD,IAAO,CAACA,EAAE,CAACnX,UAAf,EAA2B;AACvB,WAAO,IAAP;AACH;;AACD,SAAO,KAAP;AACH;AAEM,SAASojB,oBAAT,CAA8BnH,OAA9B,EAAqD/U,OAArD,EAA6F;AAChGA,SAAO,GAAGuK,IAAI,CAACvK,OAAD,CAAd;AAEA,MAAIuP,QAAJ;;AAEA,MAAI0M,eAAe,CAAClH,OAAD,CAAnB,EAA8B;AAC1B/U,WAAO;AACV,GAFD,MAEO;AACHuP,YAAQ,GAAGpC,YAAY,CAAC,YAAM;AAC1B,UAAI8O,eAAe,CAAClH,OAAD,CAAnB,EAA8B;AAC1BxF,gBAAQ,CAACpR,MAAT;AACA6B,eAAO;AACV;AACJ,KALsB,EAKpB,EALoB,CAAvB;AAMH;;AAED,SAAO;AACH7B,UADG,oBACM;AACL,UAAIoR,QAAJ,EAAc;AACVA,gBAAQ,CAACpR,MAAT;AACH;AACJ;AALE,GAAP;AAOH;AAEM,SAASge,UAAT,CAAoBlM,EAApB,EAAsClX,GAAtC,EAAwE;AAAA,MAAlCA,GAAkC;AAAlCA,OAAkC,GAAjBjD,MAAM,CAACoJ,QAAU;AAAA;;AAAA,0CACxDC,gBAAgB,CAAC,QAAD,EAAW8Q,EAAX,CADwC,4CACxB;AAA9C,QAAIoF,MAAM,2BAAV;AACD,QAAIvc,UAAU,GAAGuc,MAAM,CAACvc,UAAxB;;AAEA,QAAI,CAACA,UAAL,EAAiB;AACb;AACH;;AAED,QAAIsjB,SAAS,GAAGrjB,GAAG,CAAC+f,aAAJ,CAAkB,QAAlB,CAAhB;AACAsD,aAAS,CAACtP,IAAV,GAAiBuI,MAAM,CAACgH,WAAxB;AACAvjB,cAAU,CAACwjB,YAAX,CAAwBF,SAAxB,EAAmC/G,MAAnC;AACH;AACJ;AASM,SAASkH,QAAT,CAAkBtM,EAAlB,EAAoCjQ,OAApC,SAAwL;AAAA,iCAAT,EAAS;AAAA,0BAAzF+T,KAAyF;AAAA,MAAzFA,KAAyF,4BAAjF,IAAiF;AAAA,2BAA3EmD,MAA2E;AAAA,MAA3EA,MAA2E,6BAAlE,IAAkE;AAAA,6BAA5D3H,QAA4D;AAAA,MAA5DA,QAA4D,+BAAjD,GAAiD;AAAA,wBAA5C1Z,GAA4C;AAAA,MAA5CA,GAA4C,0BAAtCC,MAAsC;;AAC3L,MAAI0mB,YAAY,GAAGvM,EAAE,CAACgE,WAAtB;AACA,MAAIwI,aAAa,GAAGxM,EAAE,CAACiE,YAAvB;AAEAlU,SAAO,CAAC;AAAE+T,SAAK,EAAEyI,YAAT;AAAuBtF,UAAM,EAAEuF;AAA/B,GAAD,CAAP;;AAEA,MAAIze,KAAK,GAAG,SAARA,KAAQ,GAAM;AACd,QAAI0e,QAAQ,GAAGzM,EAAE,CAACgE,WAAlB;AACA,QAAI0I,SAAS,GAAG1M,EAAE,CAACiE,YAAnB;;AAEA,QAAKH,KAAK,IAAI2I,QAAQ,KAAKF,YAAvB,IAAyCtF,MAAM,IAAIyF,SAAS,KAAKF,aAArE,EAAqF;AACjFzc,aAAO,CAAC;AAAE+T,aAAK,EAAE2I,QAAT;AAAmBxF,cAAM,EAAEyF;AAA3B,OAAD,CAAP;AACH;;AAEDH,gBAAY,GAAGE,QAAf;AACAD,iBAAa,GAAGE,SAAhB;AACH,GAVD;;AAYA,MAAIC,QAAJ;AACA,MAAI7e,OAAJ;;AAEA,MAAI,OAAOlI,GAAG,CAACgnB,cAAX,KAA8B,WAAlC,EAA+C;AAC3CD,YAAQ,GAAG,IAAI/mB,GAAG,CAACgnB,cAAR,CAAuB7e,KAAvB,CAAX;AACA4e,YAAQ,CAACE,OAAT,CAAiB7M,EAAjB;AAEH,GAJD,MAIO,IAAI,OAAOpa,GAAG,CAACknB,gBAAX,KAAgC,WAApC,EAAiD;AACpDH,YAAQ,GAAG,IAAI/mB,GAAG,CAACknB,gBAAR,CAAyB/e,KAAzB,CAAX;AACA4e,YAAQ,CAACE,OAAT,CAAiB7M,EAAjB,EAAqB;AACjBiJ,gBAAU,EAAK,IADE;AAEjB8D,eAAS,EAAM,IAFE;AAGjBC,aAAO,EAAQ,IAHE;AAIjBC,mBAAa,EAAE;AAJE,KAArB;AAMArnB,OAAG,CAACyc,gBAAJ,CAAqB,QAArB,EAA+BtU,KAA/B;AACH,GATM,MASA;AACH,QAAIoP,IAAI,GAAG,SAAPA,IAAO,GAAM;AACbpP,WAAK;AACLD,aAAO,GAAGG,UAAU,CAACkP,IAAD,EAAOmC,QAAP,CAApB;AACH,KAHD;;AAIAnC,QAAI;AACP;;AAED,SAAO;AACHjP,UAAM,EAAE,kBAAM;AACVye,cAAQ,CAACO,UAAT;AACArnB,YAAM,CAAC2jB,mBAAP,CAA2B,QAA3B,EAAqCzb,KAArC;AACAC,kBAAY,CAACF,OAAD,CAAZ;AACH;AALE,GAAP;AAOH;AAEM,SAASqf,mBAAT,CAA6B7f,GAA7B,EAAqD;AAExD,MAAI,CAAC6W,iBAAiB,EAAtB,EAA0B;AACtB;AACH;;AAED,MAAI,CAACte,MAAM,CAACue,WAAR,IAAuB,OAAOve,MAAM,CAACue,WAAP,CAAmBgJ,UAA1B,KAAyC,UAApE,EAAgF;AAC5E;AACH;;AAED,MAAMC,OAAO,GAAGxnB,MAAM,CAACue,WAAP,CAAmBgJ,UAAnB,EAAhB;;AAEA,OAAK,IAAIplB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqlB,OAAO,CAACtlB,MAA5B,EAAoCC,CAAC,EAArC,EAAyC;AACrC,QAAMuO,KAAK,GAAG8W,OAAO,CAACrlB,CAAD,CAArB;;AAEA,QAAIuO,KAAK,IAAIA,KAAK,CAACnM,IAAf,IAAuBmM,KAAK,CAACnM,IAAN,CAAWtD,OAAX,CAAmBwG,GAAnB,MAA4B,CAAnD,IAAwD,OAAOiJ,KAAK,CAAC+W,QAAb,KAA0B,QAAtF,EAAgG;AAC5F,aAAOpX,IAAI,CAACqC,KAAL,CAAWhC,KAAK,CAAC+W,QAAjB,CAAP;AACH;AACJ;AACJ,C;;ACz8BD;AACA;AAWA,IAAMC,uBAAuB,GAAG,KAAK,EAAL,GAAU,IAA1C;AAEO,SAASC,UAAT,OAAoH;AAAA,MAA9FpjB,IAA8F,QAA9FA,IAA8F;AAAA,2BAAxFqjB,QAAwF;AAAA,MAAxFA,QAAwF,8BAA7EF,uBAA6E;AACvH,SAAOpT,aAAa,CAACqT,UAAD,EAAa,YAAM;AACnC,QAAME,WAAW,UAAStjB,IAAT,eAAjB;AAEA,QAAIujB,eAAJ;;AAEA,aAASC,QAAT,CAAqB7d,OAArB,EAA4D;AAExD,UAAI8d,mBAAmB,GAAGvI,qBAAqB,EAA/C;AACA,UAAIwI,OAAJ;;AAEA,UAAIH,eAAJ,EAAqB;AACjBG,eAAO,GAAGH,eAAV;AACH;;AAED,UAAI,CAACG,OAAD,IAAYD,mBAAhB,EAAqC;AACjC,YAAIE,UAAU,GAAGloB,MAAM,CAAC0f,YAAP,CAAoBE,OAApB,CAA4BiI,WAA5B,CAAjB;;AAEA,YAAIK,UAAJ,EAAgB;AACZD,iBAAO,GAAG/gB,IAAI,CAACihB,KAAL,CAAWD,UAAX,CAAV;AACH;AACJ;;AAED,UAAI,CAACD,OAAL,EAAc;AACVA,eAAO,GAAGlV,SAAS,GAAG8U,WAAH,CAAnB;AACH;;AAED,UAAI,CAACI,OAAL,EAAc;AACVA,eAAO,GAAG;AACNnH,YAAE,EAAExO,QAAQ;AADN,SAAV;AAGH;;AAED,UAAI,CAAC2V,OAAO,CAACnH,EAAb,EAAiB;AACbmH,eAAO,CAACnH,EAAR,GAAaxO,QAAQ,EAArB;AACH;;AAEDwV,qBAAe,GAAGG,OAAlB;AAEA,UAAIvmB,MAAM,GAAGwI,OAAO,CAAC+d,OAAD,CAApB;;AAEA,UAAID,mBAAJ,EAAyB;AACrBhoB,cAAM,CAAC0f,YAAP,CAAoBC,OAApB,CAA4BkI,WAA5B,EAAyC3gB,IAAI,CAACC,SAAL,CAAe8gB,OAAf,CAAzC;AACH,OAFD,MAEO;AACHlV,iBAAS,GAAG8U,WAAH,CAAT,GAA2BI,OAA3B;AACH;;AAEDH,qBAAe,GAAG,IAAlB;AAEA,aAAOpmB,MAAP;AACH;;AAED,aAAS0mB,KAAT,GAA0B;AACtB,aAAOL,QAAQ,CAAC,UAAAE,OAAO;AAAA,eAAIA,OAAO,CAACnH,EAAZ;AAAA,OAAR,CAAf;AACH;;AAED,aAASuH,UAAT,CAAuBne,OAAvB,EAA4D;AACxD,aAAO6d,QAAQ,CAAC,UAAAE,OAAO,EAAI;AAEvB,YAAIK,OAAO,GAAGL,OAAO,CAACM,WAAtB;AACA,YAAIxU,GAAG,GAAGnB,IAAI,CAACmB,GAAL,EAAV;;AAEA,YAAIuU,OAAO,IAAMvU,GAAG,GAAGuU,OAAO,CAACE,OAAf,GAA0BZ,QAA1C,EAAqD;AACjDU,iBAAO,GAAG,IAAV;AACH;;AAED,YAAI,CAACA,OAAL,EAAc;AACVA,iBAAO,GAAG;AACNG,gBAAI,EAAKnW,QAAQ,EADX;AAENkW,mBAAO,EAAEzU;AAFH,WAAV;AAIH;;AAEDkU,eAAO,CAACM,WAAR,GAAsBD,OAAtB;AAEA,eAAOpe,OAAO,CAACoe,OAAD,CAAd;AACH,OAnBc,CAAf;AAoBH;;AAED,aAASI,eAAT,CAA4Bxe,OAA5B,EAAiE;AAC7D,aAAOme,UAAU,CAAC,UAAAC,OAAO,EAAI;AACzBA,eAAO,CAACK,KAAR,GAAgBL,OAAO,CAACK,KAAR,IAAiB,EAAjC;AACA,eAAOze,OAAO,CAACoe,OAAO,CAACK,KAAT,CAAd;AACH,OAHgB,CAAjB;AAIH;;AAED,aAASC,YAAT,GAAiC;AAC7B,aAAOP,UAAU,CAAC,UAAAC,OAAO;AAAA,eAAIA,OAAO,CAACG,IAAZ;AAAA,OAAR,CAAjB;AACH;;AAED,WAAO;AACHV,cAAQ,EAARA,QADG;AAEHK,WAAK,EAALA,KAFG;AAGHM,qBAAe,EAAfA,eAHG;AAIHE,kBAAY,EAAZA;AAJG,KAAP;AAMH,GA/FmB,EA+FjB,CAAE;AAAErkB,QAAI,EAAJA,IAAF;AAAQqjB,YAAQ,EAARA;AAAR,GAAF,CA/FiB,CAApB;AAgGH,C;;AC/GD;AACA;;AAEA,SAASiB,0BAAT,GAA+C;AAC3C,SAAOlB,UAAU,CAAC;AAAEpjB,QAAI,EAAE;AAAR,GAAD,CAAjB;AACH;;AAED,SAASukB,aAAT,CAAuBvkB,IAAvB,EAAgD;AAC5C,SAAOskB,0BAA0B,GAAGH,eAA7B,CAA6C,UAAAC,KAAK,EAAI;AACzDA,SAAK,CAACI,aAAN,GAAsBJ,KAAK,CAACI,aAAN,IAAuB,EAA7C;;AAEA,QAAIJ,KAAK,CAACI,aAAN,CAAoB9nB,OAApB,CAA4BsD,IAA5B,MAAsC,CAAC,CAA3C,EAA8C;AAC1CokB,WAAK,CAACI,aAAN,CAAoBpnB,IAApB,CAAyB4C,IAAzB;AACA,aAAO,IAAP;AACH;;AAED,WAAO,KAAP;AACH,GATM,CAAP;AAUH;;AAWD,SAASykB,qBAAT,CAA+BzkB,IAA/B,EAAuD;AACnD,SAAOskB,0BAA0B,GAAGd,QAA7B,CAAsC,UAAAY,KAAK,EAAI;AAClDA,SAAK,CAACM,mBAAN,GAA4BN,KAAK,CAACM,mBAAN,IAA6B,EAAzD;AACAN,SAAK,CAACM,mBAAN,CAA0B1kB,IAA1B,IAAkCokB,KAAK,CAACM,mBAAN,CAA0B1kB,IAA1B,KAAmC8L,IAAI,CAACqC,KAAL,CAAWrC,IAAI,CAACC,MAAL,KAAgB,GAA3B,CAArE;AACA,WAAOqY,KAAK,CAACM,mBAAN,CAA0B1kB,IAA1B,CAAP;AACH,GAJM,CAAP;AAKH;;AAED,IAAM2kB,cAAc,GAAG;AACnBC,MAAI,EAAM,MADS;AAEnBC,SAAO,EAAG,SAFS;AAGnBC,UAAQ,EAAE;AAHS,CAAvB;AAaO,SAASC,UAAT,OAAuH;AAAA,MAAjG/kB,IAAiG,QAAjGA,IAAiG;AAAA,yBAA3FglB,MAA2F;AAAA,MAA3FA,MAA2F,4BAAlF,EAAkF;AAAA,+BAA9EC,YAA8E;AAAA,MAA9EA,YAA8E,kCAA/DpqB,aAA+D;AAAA,gCAAzDqqB,aAAyD;AAAA,MAAzDA,aAAyD,mCAAzCrqB,aAAyC;AAE1H,MAAIsqB,QAAQ,GAAGV,qBAAqB,CAACzkB,IAAD,CAApC;AAEA,MAAIolB,KAAJ;;AAEA,MAAID,QAAQ,GAAGH,MAAf,EAAuB;AACnBI,SAAK,GAAGT,cAAc,CAACC,IAAvB;AACH,GAFD,MAEO,IAAKI,MAAM,IAAI,EAAX,IAAoBA,MAAM,IAAIG,QAAX,IAAyBA,QAAQ,GAAIH,MAAM,GAAG,CAArE,EAA2E;AAC9EI,SAAK,GAAGT,cAAc,CAACE,OAAvB;AACH,GAFM,MAEA;AACHO,SAAK,GAAGT,cAAc,CAACG,QAAvB;AACH;;AAED,MAAIO,SAAS,GAAOrlB,IAAP,SAAiBolB,KAA9B;AAEA,MAAIE,OAAO,GAAG,KAAd;AACA,MAAIC,MAAM,GAAG,KAAb;;AAEA,MAAI;AACA,QAAI9pB,MAAM,CAAC0f,YAAP,IAAuB1f,MAAM,CAAC0f,YAAP,CAAoBE,OAApB,CAA4Brb,IAA5B,CAA3B,EAA8D;AAC1DulB,YAAM,GAAG,IAAT;AACH;AACJ,GAJD,CAIE,OAAOxpB,GAAP,EAAY,CACV;AACH;;AAED,SAAO;AAEHypB,aAFG,uBAEmB;AAClB,aAAQJ,KAAK,KAAKT,cAAc,CAACC,IAA1B,IAAmCW,MAA1C;AACH,KAJE;AAMHE,cANG,wBAMoB;AACnB,aAAQL,KAAK,KAAKT,cAAc,CAACC,IAA1B,IAAmC,CAACW,MAA3C;AACH,KARE;AAUHG,gBAVG,0BAUqB;AACpB,aAAOL,SAAP;AACH,KAZE;AAcHM,OAdG,eAcCC,UAdD,EAcsBC,OAdtB,EAc2E;AAAA,UAArDA,OAAqD;AAArDA,eAAqD,GAAjB,EAAiB;AAAA;;AAC1E,UAAI,CAACP,OAAL,EAAc;AACV,eAAO,IAAP;AACH;;AAED,UAAIf,aAAa,CAAKvkB,IAAL,SAAeqlB,SAAf,SAA8B1iB,IAAI,CAACC,SAAL,CAAeijB,OAAf,CAA9B,CAAjB,EAA4E;AACxEZ,oBAAY,CAAC;AAAEjlB,cAAI,EAAJA,IAAF;AAAQqlB,mBAAS,EAATA,SAAR;AAAmBQ,iBAAO,EAAPA;AAAnB,SAAD,CAAZ;AACH;;AAED,UAAItB,aAAa,CAAKvkB,IAAL,SAAeqlB,SAAf,SAA8BO,UAA9B,SAA8CjjB,IAAI,CAACC,SAAL,CAAeijB,OAAf,CAA9C,CAAjB,EAA4F;AACxFX,qBAAa,CAAC;AAAEllB,cAAI,EAAJA,IAAF;AAAQqlB,mBAAS,EAATA,SAAR;AAAmBO,oBAAU,EAAVA,UAAnB;AAA+BC,iBAAO,EAAPA;AAA/B,SAAD,CAAb;AACH;;AAED,aAAO,IAAP;AACH,KA5BE;AA8BHC,YA9BG,oBA8BMD,OA9BN,EA8B2D;AAAA,UAArDA,OAAqD;AAArDA,eAAqD,GAAjB,EAAiB;AAAA;;AAC1DP,aAAO,GAAG,IAAV;AACA,aAAO,KAAKK,GAAL,UAAkBE,OAAlB,CAAP;AACH,KAjCE;AAmCHE,eAnCG,uBAmCSF,OAnCT,EAmC8D;AAAA,UAArDA,OAAqD;AAArDA,eAAqD,GAAjB,EAAiB;AAAA;;AAC7D,aAAO,KAAKF,GAAL,aAAqBE,OAArB,CAAP;AACH;AArCE,GAAP;AAuCH,C;;ACpHD;AAEO,SAASG,kBAAT,OAAsJ;AAAA,MAA5GhmB,IAA4G,QAA5GA,IAA4G;AAAA,0BAAtGimB,OAAsG;AAAA,MAAtGA,OAAsG,6BAA5F,QAA4F;AAEzJ,MAAIxX,MAAM,GAAGD,SAAS,EAAtB;AACA,MAAI0X,SAAS,UAASlmB,IAAT,UAAoBimB,OAApB,cAAb;AAEA,MAAIE,SAAS,GAAG1X,MAAM,CAACyX,SAAD,CAAN,GAAoBzX,MAAM,CAACyX,SAAD,CAAN,IAAqB,EAAzD;AAEA,SAAO;AACHxa,OAAG,EAAE,aAACpD,GAAD,EAAe8d,QAAf,EAAqC;AACtC;AACAA,cAAQ,GAAGA,QAAQ,IAAI,EAAvB;AACA,UAAI5rB,IAAI,GAAG2rB,SAAS,CAAC7d,GAAD,CAAT,GAAiB6d,SAAS,CAAC7d,GAAD,CAAT,IAAkB8d,QAA9C;AACA,aAAO5rB,IAAP;AACH;AANE,GAAP;AAQH,C;;ACjBD;AAoBA,IAAM6rB,OAAO,GAAG;AACZC,cAAY,EAAE,cADF;AAEZC,QAAM,EAAQ;AAFF,CAAhB;AAKA,IAAIC,cAAc,GAAG,EAArB;;AAEA,SAASC,YAAT,CAAsBC,UAAtB,EAAwE;AAAA,MAAlDA,UAAkD;AAAlDA,cAAkD,GAA5B,EAA4B;AAAA;;AACpE,MAAIvpB,MAAM,GAAG,EAAb;;AADoE,6CAEnDupB,UAAU,CAACC,IAAX,GAAkBxjB,KAAlB,CAAwB,IAAxB,CAFmD,8CAEpB;AAA3C,QAAIyjB,IAAI,8BAAR;;AAA2C,sBACnBA,IAAI,CAACzjB,KAAL,CAAW,GAAX,CADmB;AAAA,QACtCmF,IADsC;AAAA,QAC9BuD,MAD8B;;AAE5C1O,UAAM,CAACmL,IAAG,CAACiG,WAAJ,EAAD,CAAN,GAA4B1C,MAAM,CAAC7I,IAAP,CAAY,GAAZ,EAAiB2jB,IAAjB,EAA5B;AACH;;AACD,SAAOxpB,MAAP;AACH;;AAEM,SAAS0pB,OAAT,OAAuJ;AAAA,MAApI3jB,GAAoI,QAApIA,GAAoI;AAAA,yBAA/HsF,MAA+H;AAAA,MAA/HA,MAA+H,4BAAtH,KAAsH;AAAA,0BAA/Gse,OAA+G;AAAA,MAA/GA,OAA+G,6BAArG,EAAqG;AAAA,MAAjGC,IAAiG,QAAjGA,IAAiG;AAAA,MAA3FC,IAA2F,QAA3FA,IAA2F;AAAA,MAArFnP,IAAqF,QAArFA,IAAqF;AAAA,sBAA/Erc,GAA+E;AAAA,MAA/EA,GAA+E,yBAAzEC,MAAyE;AAAA,0BAAjEiI,OAAiE;AAAA,MAAjEA,OAAiE,6BAAvD,CAAuD;AAC1J,SAAO,IAAI0C,oBAAJ,CAAiB,UAACL,OAAD,EAAUgB,MAAV,EAAqB;AAEzC,QAAKggB,IAAI,IAAIC,IAAT,IAAmBD,IAAI,IAAIlP,IAA3B,IAAqCmP,IAAI,IAAID,IAAjD,EAAwD;AACpD,YAAM,IAAI1qB,KAAJ,sEAAN;AACH;;AAED,QAAI4qB,iBAAiB,GAAG,EAAxB;;AANyC,sCAQzBxsB,MAAM,CAAC2N,IAAP,CAAY0e,OAAZ,CARyB,qCAQH;AAAjC,UAAIxe,KAAG,qBAAP;AACD2e,uBAAiB,CAAC3e,KAAG,CAACiG,WAAJ,EAAD,CAAjB,GAAuCuY,OAAO,CAACxe,KAAD,CAA9C;AACH;;AAED,QAAIye,IAAJ,EAAU;AACNE,uBAAiB,CAACZ,OAAO,CAACC,YAAT,CAAjB,GAA0CW,iBAAiB,CAACZ,OAAO,CAACC,YAAT,CAAjB,IAA2C,kBAArF;AACH,KAFD,MAEO,IAAIU,IAAI,IAAInP,IAAZ,EAAkB;AACrBoP,uBAAiB,CAACZ,OAAO,CAACC,YAAT,CAAjB,GAA0CW,iBAAiB,CAACZ,OAAO,CAACC,YAAT,CAAjB,IAA2C,kDAArF;AACH;;AAEDW,qBAAiB,CAACZ,OAAO,CAACE,MAAT,CAAjB,GAAoCU,iBAAiB,CAACZ,OAAO,CAACE,MAAT,CAAjB,IAAqC,kBAAzE;;AAlByC,4BAoBfC,cApBe,gBAoBC;AAArC,UAAIU,aAAa,GAAIV,cAAJ,KAAjB;AACD,UAAIW,YAAY,GAAGD,aAAa,EAAhC;;AADsC,wCAGtBzsB,MAAM,CAAC2N,IAAP,CAAY+e,YAAZ,CAHsB,qCAGK;AAAtC,YAAI7e,KAAG,qBAAP;AACD2e,yBAAiB,CAAC3e,KAAG,CAACiG,WAAJ,EAAD,CAAjB,GAAuC4Y,YAAY,CAAC7e,KAAD,CAAnD;AACH;AACJ;;AAED,QAAI8e,GAAG,GAAG,IAAI5rB,GAAG,CAAC6rB,cAAR,EAAV;AAEAD,OAAG,CAACnP,gBAAJ,CAAqB,MAArB,EAA6B,SAASqP,OAAT,GAA0B;AAEnD,UAAIC,eAAe,GAAGd,YAAY,CAAC,KAAKe,qBAAL,EAAD,CAAlC;;AAEA,UAAI,CAAC,KAAK9c,MAAV,EAAkB;AACd,eAAO3D,MAAM,CAAC,IAAI1K,KAAJ,iBAAyBmM,MAAM,CAAC+F,WAAP,EAAzB,SAAmDrL,GAAnD,uCAAD,CAAb;AACH;;AAED,UAAIukB,WAAW,GAAGF,eAAe,CAAC,cAAD,CAAjC;AACA,UAAIG,MAAM,GAAGD,WAAW,KAAKA,WAAW,CAAC/qB,OAAZ,CAAoB,kBAApB,MAA4C,CAA5C,IAAiD+qB,WAAW,CAAC/qB,OAAZ,CAAoB,WAApB,MAAqC,CAA3F,CAAxB;AACA,UAAIirB,YAAY,GAAG,KAAKC,YAAxB;;AAEA,UAAI;AACAD,oBAAY,GAAGhlB,IAAI,CAACihB,KAAL,CAAW+D,YAAX,CAAf;AACH,OAFD,CAEE,OAAO5rB,GAAP,EAAY;AACV,YAAI2rB,MAAJ,EAAY;AACR,iBAAO3gB,MAAM,CAAC,IAAI1K,KAAJ,oBAA4B,KAAKurB,YAAjC,OAAD,CAAb;AACH;AACJ;;AAED,UAAI9gB,GAAG,GAAG;AACN4D,cAAM,EAAG,KAAKA,MADR;AAENoc,eAAO,EAAES,eAFH;AAGN1P,YAAI,EAAK8P;AAHH,OAAV;AAMA,aAAO5hB,OAAO,CAACe,GAAD,CAAd;AAEH,KA5BD,EA4BG,KA5BH;AA8BAsgB,OAAG,CAACnP,gBAAJ,CAAqB,OAArB,EAA8B,UAAC4P,GAAD,EAAS;AACnC9gB,YAAM,CAAC,IAAI1K,KAAJ,iBAAyBmM,MAAM,CAAC+F,WAAP,EAAzB,SAAmDrL,GAAnD,iBAAoE2kB,GAAG,CAACltB,QAAJ,EAApE,OAAD,CAAN;AACH,KAFD,EAEG,KAFH;AAIAysB,OAAG,CAAC7J,IAAJ,CAAS/U,MAAT,EAAiBtF,GAAjB,EAAsB,IAAtB;;AAEA,SAAK,IAAIoF,KAAT,IAAgB2e,iBAAhB,EAAmC;AAC/B,UAAIA,iBAAiB,CAAC/b,cAAlB,CAAiC5C,KAAjC,CAAJ,EAA2C;AACvC8e,WAAG,CAACU,gBAAJ,CAAqBxf,KAArB,EAA0B2e,iBAAiB,CAAC3e,KAAD,CAA3C;AACH;AACJ;;AAED,QAAIye,IAAJ,EAAU;AACNlP,UAAI,GAAGlV,IAAI,CAACC,SAAL,CAAemkB,IAAf,CAAP;AACH,KAFD,MAEO,IAAIC,IAAJ,EAAU;AACbnP,UAAI,GAAGpd,MAAM,CAAC2N,IAAP,CAAY4e,IAAZ,EAAkB3e,GAAlB,CAAsB,UAAAC,GAAG,EAAI;AAChC,eAAW4E,kBAAkB,CAAC5E,GAAD,CAA7B,UAAwC0e,IAAI,GAAG9Z,kBAAkB,CAAC8Z,IAAI,CAAC1e,GAAD,CAAL,CAArB,GAAmC,EAA/E;AACH,OAFM,EAEJtF,IAFI,CAEC,GAFD,CAAP;AAGH;;AAEDokB,OAAG,CAAC1jB,OAAJ,GAAcA,OAAd;;AACA0jB,OAAG,CAACW,SAAJ,GAAgB,SAASC,UAAT,GAAsB;AAClCjhB,YAAM,CAAC,IAAI1K,KAAJ,iBAAyBmM,MAAM,CAAC+F,WAAP,EAAzB,SAAmDrL,GAAnD,oBAAD,CAAN;AACH,KAFD;;AAIAkkB,OAAG,CAACa,IAAJ,CAASpQ,IAAT;AACH,GAtFM,CAAP;AAuFH;AAEM,SAASqQ,gBAAT,CAA0B1f,MAA1B,EAAgE;AACnEge,gBAAc,CAACppB,IAAf,CAAoBoL,MAApB;AACH,C;;AChID;AACO,IAAMzD,WAAK,GAAG,IAAd,C;;ACDP;AAEO,SAASojB,QAAT,CAAkBpd,MAAlB,EAAmC/K,IAAnC,EAAkD8V,UAAlD,EAAuE;AAC1EA,YAAU,CAACtP,KAAX,GAAmByI,OAAO,CAAC6G,UAAU,CAACtP,KAAZ,EAAmB;AAAExG,QAAI,EAAJA,IAAF;AAAQsP,iBAAa,EAAE;AAAvB,GAAnB,CAA1B;AACH;AAEM,SAAS/J,kBAAT,CAAiBwF,MAAjB,EAAkC/K,IAAlC,EAAiD8V,UAAjD,EAAsE;AACzEA,YAAU,CAACtP,KAAX,GAAmBqJ,SAAS,CAACiG,UAAU,CAACtP,KAAZ,EAAmB;AAAExG,QAAI,EAAJA;AAAF,GAAnB,CAA5B;AACH,C;;ACRM,SAASooB,MAAT,CAAgBpb,GAAhB,EAAwC;AAC3C,SAAO,OAAOA,GAAP,KAAe,QAAf,IAA4B,WAAD,CAAcjE,IAAd,CAAmBiE,GAAnB,CAAlC;AACH;AAEM,SAASqb,IAAT,CAAcrb,GAAd,EAAsC;AACzC,SAAO,OAAOA,GAAP,KAAe,QAAf,IAA4B,YAAD,CAAejE,IAAf,CAAoBiE,GAApB,CAAlC;AACH;AAEM,SAASsb,KAAT,CAAetZ,GAAf,EAA+C;AAElD,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AACzB,WAAOA,GAAP;AACH;;AAED,MAAItM,KAAK,GAAGsM,GAAG,CAACtM,KAAJ,CAAU,kBAAV,CAAZ;;AAEA,MAAI,CAACA,KAAL,EAAY;AACR,UAAM,IAAIrG,KAAJ,qCAA6C2S,GAA7C,CAAN;AACH;;AAED,SAAOzB,QAAQ,CAAC7K,KAAK,CAAC,CAAD,CAAN,EAAW,EAAX,CAAf;AACH;AAEM,SAAS6lB,IAAT,CAAcvZ,GAAd,EAA8C;AACjD,SAAWsZ,KAAK,CAACtZ,GAAD,CAAhB;AACH;AAEM,SAASwZ,KAAT,CAAexZ,GAAf,EAA+C;AAElD,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AACzB,WAAOuZ,IAAI,CAACvZ,GAAD,CAAX;AACH;;AAED,SAAOoZ,MAAM,CAACpZ,GAAD,CAAN,GAAcA,GAAd,GAAoBuZ,IAAI,CAACvZ,GAAD,CAA/B;AACH;AAEM,SAASyZ,MAAT,CAAgBC,GAAhB,EAA8BhX,IAA9B,EAAsD;AACzD,SAAOnE,QAAQ,CAACmb,GAAG,GAAGJ,KAAK,CAAC5W,IAAD,CAAX,GAAqB,GAAtB,EAA2B,EAA3B,CAAf;AACH;AAEM,SAASiX,kBAAT,CAA4BC,GAA5B,EAAmD7W,GAAnD,EAA0E;AAC7E,MAAI,OAAO6W,GAAP,KAAe,QAAnB,EAA6B;AACzB,WAAOA,GAAP;AACH,GAFD,MAEO,IAAIR,MAAM,CAACQ,GAAD,CAAV,EAAiB;AACpB,WAAOH,MAAM,CAAC1W,GAAD,EAAM6W,GAAN,CAAb;AACH,GAFM,MAEA,IAAIP,IAAI,CAACO,GAAD,CAAR,EAAe;AAClB,WAAON,KAAK,CAACM,GAAD,CAAZ;AACH,GAFM,MAEA;AACH,UAAM,IAAIvsB,KAAJ,mCAA2CusB,GAA3C,CAAN;AACH;AACJ,C;;AClDD;AAEA;AAOO,SAASC,WAAT,CAAwBrgB,MAAxB,SAAmH;AAAA,gCAAzB,EAAyB;AAAA,0BAApE9E,OAAoE;AAAA,MAApEA,OAAoE,6BAA1D,IAA0D;;AACtH,MAAIolB,QAAwB,GAAG,EAA/B;AACA,MAAI9gB,QAAiC,GAAG,EAAxC;AAEA,MAAI+gB,KAAK,GAAGllB,UAAU,CAAC,YAAM;AACzB,QAAIilB,QAAQ,CAACnrB,MAAb,EAAqB;AACjBqK,cAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACa,WAAb,CAAyB,IAAI5K,KAAJ,eAAuBysB,QAAQ,CAAC,CAAD,CAA/B,mBAAzB,CAAd;AACH;AACJ,GAJqB,EAInBplB,OAJmB,CAAtB;;AAMA,MAAIslB,MAAgB,GAAG,SAAnBA,MAAmB,CAAChpB,IAAD,EAAO2M,EAAP,EAAqB;AAAA,QAAdA,EAAc;AAAdA,QAAc,GAAT9R,aAAS;AAAA;;AACxCiuB,YAAQ,CAAC1rB,IAAT,CAAc4C,IAAd,EADwC,CAGxC;;AACA,WAAO,SAASipB,aAAT,GAAoC;AAAA;;AAAA,wCAAVvgB,IAAU;AAAVA,YAAU;AAAA;;AACvC2O,qBAAe,CAACyR,QAAD,EAAW9oB,IAAX,CAAf,CADuC,CAGvC;;AAHuC,sBAIfoX,QAAQ,CAAC;AAAA;;AAAA,eAAM,OAAAzK,EAAE,EAAC/R,IAAH,aAAQ,KAAR,SAAiB8N,IAAjB,EAAN;AAAA,OAAD,CAJO;AAAA,UAIjCvL,MAJiC,aAIjCA,MAJiC;AAAA,UAIzBsJ,KAJyB,aAIzBA,KAJyB;;AAMvC,UAAIA,KAAJ,EAAW;AACPuB,gBAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACa,WAAb,CAAyBR,KAAzB,CAAd;AACA,cAAMA,KAAN;AACH;;AAEDuB,cAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACL,OAAb,CAAqB5I,MAArB,CAAd;AACA,aAAOA,MAAP;AACH,KAbD;AAcH,GAlBD;;AAoBA,MAAI+rB,KAAe,GAAG,SAAlBA,KAAkB,CAAClpB,IAAD,EAAgB2M,EAAhB,EAA8B;AAAA,QAAdA,EAAc;AAAdA,QAAc,GAAT9R,aAAS;AAAA;;AAEhD;AACA,WAAO,SAASsuB,YAAT,GAAmC;AAAA;;AACtCnhB,cAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACa,WAAb,CAAyB,IAAI5K,KAAJ,eAAuB2D,IAAvB,uBAAzB,CAAd,EADsC,CAEtC;;AAFsC,yCAAV0I,IAAU;AAAVA,YAAU;AAAA;;AAGtC,aAAO,QAAAiE,EAAE,EAAC/R,IAAH,cAAQ,IAAR,SAAiB8N,IAAjB,EAAP;AACH,KAJD;AAKH,GARD;;AAUA,MAAI0gB,WAAqB,GAAG,SAAxBA,WAAwB,CAACppB,IAAD,EAAO2M,EAAP,EAAqB;AAAA,QAAdA,EAAc;AAAdA,QAAc,GAAT9R,aAAS;AAAA;;AAC7CiuB,YAAQ,CAAC1rB,IAAT,CAAc4C,IAAd,EAD6C,CAG7C;;AACA,WAAO,SAASqpB,kBAAT,GAAyC;AAAA;;AAAA,yCAAV3gB,IAAU;AAAVA,YAAU;AAAA;;AAC5C2O,qBAAe,CAACyR,QAAD,EAAW9oB,IAAX,CAAf,CAD4C,CAG5C;;AAH4C,uBAIpBoX,QAAQ,CAAC;AAAA;;AAAA,eAAM,QAAAzK,EAAE,EAAC/R,IAAH,cAAQ,MAAR,SAAiB8N,IAAjB,EAAN;AAAA,OAAD,CAJY;AAAA,UAItCvL,MAJsC,cAItCA,MAJsC;AAAA,UAI9BsJ,KAJ8B,cAI9BA,KAJ8B;;AAM5C,UAAIA,KAAJ,EAAW;AACP,cAAMA,KAAN;AACH;;AAEDuB,cAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACL,OAAb,CAAqB5I,MAArB,EAA6BgI,IAA7B,CAAkC,YAAM;AAClD,cAAM,IAAI9I,KAAJ,eAAuB2D,IAAvB,wBAAN;AACH,OAFa,EAEXnF,aAFW,CAAd;AAGA,aAAOsC,MAAP;AACH,KAdD;AAeH,GAnBD;;AAqBA6K,UAAQ,CAAC5K,IAAT,CAAcgJ,oBAAY,CAACuB,GAAb,CAAiB;AAAA,WAAMa,MAAM,CAAC;AAAEwgB,YAAM,EAANA,MAAF;AAAUE,WAAK,EAALA,KAAV;AAAiBE,iBAAW,EAAXA,WAAjB;AAA8B3iB,WAAK,EAAEyiB;AAArC,KAAD,CAAZ;AAAA,GAAjB,CAAd;;AAEA,MAAII,KAAK,GAAG,SAARA,KAAQ,GAAM;AACd,WAAOljB,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,UAAIK,QAAQ,CAACrK,MAAb,EAAqB;AACjB,eAAOqK,QAAQ,CAACmP,GAAT,EAAP;AACH;AACJ,KAJM,EAIJhS,IAJI,CAIC,YAAM;AACV,UAAI6C,QAAQ,CAACrK,MAAb,EAAqB;AACjB,eAAO2rB,KAAK,EAAZ;AACH;;AACD,UAAIR,QAAQ,CAACnrB,MAAb,EAAqB;AACjB,eAAOyI,oBAAY,CAAC7C,KAAb,CAAmB,EAAnB,EAAuB4B,IAAvB,CAA4BmkB,KAA5B,CAAP;AACH;AACJ,KAXM,CAAP;AAYH,GAbD;;AAeA,SAAOA,KAAK,GAAGnkB,IAAR,CAAa,YAAM;AACtBvB,gBAAY,CAACmlB,KAAD,CAAZ;AACH,GAFM,CAAP;AAGH,C;;AC1FD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACTO,IAAMQ,cAAc,GAAG,IAAvB;AACA,IAAMC,oBAAoB,GAAG,IAA7B;AAEA,IAAMC,WAAW,GAAG,IAApB;AACA,IAAMC,iBAAiB,GAAG,KAA1B;AACA,IAAMC,WAAW,GAAGC,MAAQ,GAAG,SAAH,GAAU,CAAC,CAAvC;AACA,IAAMC,mBAAmB,GAAG,GAA5B,C;;ACNA,IAAMC,YAAY,GAAG;AACxBC,SAAO,EAAI,2BADa;AAExBC,UAAQ,EAAG,4BAFa;AAGxBC,KAAG,EAAQ;AAHa,CAArB;AAMA,IAAMC,WAAW,GAAG;AACvBC,SAAO,EAAG,SADa;AAEvBC,OAAK,EAAK;AAFa,CAApB;AAKA,IAAMC,YAAY,GAAG;AACxBC,QAAM,EAAQ,kBADU;AAExBC,OAAK,EAAS,iBAFU;AAGxBC,aAAW,EAAG;AAHU,CAArB;AAMA,IAAMC,aAAa,GAAG;AACzBC,cAAY,EAAG,wBADU;AAEzBC,QAAM,EAAS,kBAFU;AAGzBC,QAAM,EAAS;AAHU,CAAtB;AAMA,IAAMC,kBAAkB,GAAG,sBAA3B;AACA,IAAMC,eAAe,GAAM,qBAA3B;AAEA,IAAM5vB,kBAAQ,GAAG,GAAjB;AAEA,IAAM6vB,kBAAkB,GAAG;AAC9BC,4BAA0B,EAAG,4BADC;AAE9BC,uBAAqB,EAAQ,uBAFC;AAG9BC,qBAAmB,EAAU;AAHC,CAA3B,C;;AC5BP;;;ACCA;AACA;AAEO,SAAS1c,gBAAT,CAAmBhT,GAAnB,EAAiE;AAAA,MAA9CA,GAA8C;AAA9CA,OAA8C,GAAjBC,MAAiB;AAAA;;AACpE,MAAID,GAAG,KAAKC,MAAZ,EAAoB;AAChB,WAAOD,GAAG,CAAC2vB,wBAAD,CAAV;AACH;;AACD,MAAM1c,MAAe,GAAGjT,GAAG,CAAC2vB,wBAAD,CAAH,GAAqC3vB,GAAG,CAAC2vB,wBAAD,CAAH,IAAsC,EAAnG;AACA,SAAO1c,MAAP;AACH;AAEM,SAAS2c,YAAT,GAAwB;AAC3B,SAAO3vB,MAAM,CAAC0vB,wBAAD,CAAb;AACH;;AAGD,IAAME,MAAqB,GAAG,SAAxBA,MAAwB;AAAA,SAAO,EAAP;AAAA,CAA9B;;AAcO,SAASC,WAAT,CAAgChjB,GAAhC,EAAyDijB,QAAzD,EAA6G;AAAA,MAA7EjjB,GAA6E;AAA7EA,OAA6E,GAA7D,OAA6D;AAAA;;AAAA,MAApDijB,QAAoD;AAApDA,YAAoD,GAAzBF,MAAyB;AAAA;;AAChH,SAAO7e,aAAQ,CAACgC,gBAAS,EAAV,EAAclG,GAAd,EAAmB,YAAM;AACpC,QAAIkjB,KAAK,GAAGD,QAAQ,EAApB;AAEA,WAAO;AACHhf,SAAG,EAAE,aAACkf,QAAD,EAAc;AACf,eAAOD,KAAK,CAACtgB,cAAN,CAAqBugB,QAArB,CAAP;AACH,OAHE;AAIH/f,SAAG,EAAE,aAAC+f,QAAD,EAAWC,MAAX,EAAsB;AACvB;AACA,eAAOF,KAAK,CAACtgB,cAAN,CAAqBugB,QAArB,IAAiCD,KAAK,CAACC,QAAD,CAAtC,GAAmDC,MAA1D;AACH,OAPE;AAQHjgB,SAAG,EAAE,aAACggB,QAAD,EAAWzc,GAAX,EAAmB;AACpBwc,aAAK,CAACC,QAAD,CAAL,GAAkBzc,GAAlB;AACA,eAAOA,GAAP;AACH,OAXE;AAYH2c,SAAG,EAAE,aAACF,QAAD,EAAc;AACf,eAAOD,KAAK,CAACC,QAAD,CAAZ;AACH,OAdE;AAeHjf,cAAQ,EAAE,kBAACif,QAAD,EAAWhf,MAAX,EAAsB;AAC5B;AACA,eAAOD,aAAQ,CAACgf,KAAD,EAAQC,QAAR,EAAkBhf,MAAlB,CAAf;AACH,OAlBE;AAmBHgD,WAAK,EAAE,iBAAM;AACT+b,aAAK,GAAGD,QAAQ,EAAhB;AACH,OArBE;AAsBHnjB,UAAI,EAAE,gBAAM;AACR,eAAO3N,MAAM,CAAC2N,IAAP,CAAYojB,KAAZ,CAAP;AACH;AAxBE,KAAP;AA0BH,GA7Bc,CAAf;AA8BH;AAEM,IAAMI,QAAb;AAEO,SAASC,WAAT,GAAkC;AACrC,MAAMpd,MAAM,GAAGD,gBAAS,EAAxB;AACAC,QAAM,CAACqd,eAAP,GAAyBrd,MAAM,CAACqd,eAAP,IAA0B,IAAIF,QAAJ,EAAnD;AACA,SAAOnd,MAAM,CAACqd,eAAd;AACH;AAUM,SAASC,WAAT,CAAwBzjB,GAAxB,EAAiDijB,QAAjD,EAAqG;AAAA,MAA7EjjB,GAA6E;AAA7EA,OAA6E,GAA7D,OAA6D;AAAA;;AAAA,MAApDijB,QAAoD;AAApDA,YAAoD,GAAzBF,MAAyB;AAAA;;AACxG,SAAOC,WAAW,CAAC,aAAD,CAAX,CAA2B9e,QAA3B,CAAoClE,GAApC,EAAyC,YAAM;AAClD,QAAM0jB,QAAQ,GAAG,IAAI5gB,8BAAJ,EAAjB;;AAEA,QAAM6gB,QAAQ,GAAG,SAAXA,QAAW,CAACzwB,GAAD,EAA2D;AACxE,aAAOwwB,QAAQ,CAACxf,QAAT,CAAkBhR,GAAlB,EAAuB+vB,QAAvB,CAAP;AACH,KAFD;;AAIA,WAAO;AACHhf,SAAG,EAAE,aAAC/Q,GAAD,EAAS;AACV,YAAMgwB,KAAK,GAAGS,QAAQ,CAACzwB,GAAD,CAAtB;AACA,eAAOgwB,KAAK,CAACtgB,cAAN,CAAqB5C,GAArB,CAAP;AACH,OAJE;AAKHoD,SAAG,EAAE,aAAClQ,GAAD,EAAMkwB,MAAN,EAAiB;AAClB,YAAMF,KAAK,GAAGS,QAAQ,CAACzwB,GAAD,CAAtB,CADkB,CAElB;;AACA,eAAOgwB,KAAK,CAACtgB,cAAN,CAAqB5C,GAArB,IAA4BkjB,KAAK,CAACljB,GAAD,CAAjC,GAAyCojB,MAAhD;AACH,OATE;AAUHjgB,SAAG,EAAE,aAACjQ,GAAD,EAAMwT,GAAN,EAAc;AACf,YAAMwc,KAAK,GAAGS,QAAQ,CAACzwB,GAAD,CAAtB;AACAgwB,aAAK,CAACljB,GAAD,CAAL,GAAa0G,GAAb;AACA,eAAOA,GAAP;AACH,OAdE;AAeH2c,SAAG,EAAE,aAACnwB,GAAD,EAAS;AACV,YAAMgwB,KAAK,GAAGS,QAAQ,CAACzwB,GAAD,CAAtB;AACA,eAAOgwB,KAAK,CAACljB,GAAD,CAAZ;AACH,OAlBE;AAmBHkE,cAAQ,EAAE,kBAAChR,GAAD,EAAMiR,MAAN,EAAiB;AACvB,YAAM+e,KAAK,GAAGS,QAAQ,CAACzwB,GAAD,CAAtB;AACA,eAAOgR,aAAQ,CAACgf,KAAD,EAAQljB,GAAR,EAAamE,MAAb,CAAf;AACH;AAtBE,KAAP;AAwBH,GA/BM,CAAP;AAgCH,C;;ACjHD;AACA;AACA;AAEA;AACA;;AAGA,SAASyf,aAAT,GAAkC;AAC9B,SAAOZ,WAAW,CAAC,UAAD,CAAX,CAAwB9e,QAAxB,CAAiC,YAAjC,EAA+CuB,QAA/C,CAAP;AACH;;AAED,SAASoe,eAAT,CAAyB3wB,GAAzB,EAA0F;AACtF,MAAM4wB,aAAa,GAAGL,WAAW,CAAC,eAAD,CAAjC;AACA,SAAOK,aAAa,CAAC5f,QAAd,CAAuBhR,GAAvB,EAA4B;AAAA,WAAM,IAAI4K,oBAAJ,EAAN;AAAA,GAA5B,CAAP;AACH;;AAED,SAASimB,mBAAT,CAA6B7wB,GAA7B,QAA0G;AAAA,MAA9CgB,MAA8C,QAA9CA,MAA8C;AACtG,MAAM4vB,aAAa,GAAGL,WAAW,CAAC,eAAD,CAAjC;AACA,MAAMO,eAAe,GAAGF,aAAa,CAAC1gB,GAAd,CAAkBlQ,GAAlB,CAAxB;;AACA,MAAI8wB,eAAJ,EAAqB;AACjBA,mBAAe,CAACvmB,OAAhB,CAAwB;AAAEvJ,YAAM,EAANA;AAAF,KAAxB;AACH;;AACD,MAAM+vB,UAAU,GAAGnmB,oBAAY,CAACL,OAAb,CAAqB;AAAEvJ,UAAM,EAANA;AAAF,GAArB,CAAnB;AACA4vB,eAAa,CAAC3gB,GAAd,CAAkBjQ,GAAlB,EAAuB+wB,UAAvB;AACA,SAAOA,UAAP;AACH;;AAED,SAASC,cAAT,QAAmE;AAAA,MAAzCvY,EAAyC,SAAzCA,EAAyC;AAC/D,SAAOA,EAAE,CAACoW,YAAY,CAACE,KAAd,EAAqB;AAAE/tB,UAAM,EAAEtB,kBAAQA;AAAlB,GAArB,EAA2C,iBAAwB;AAAA,QAArB+P,MAAqB,SAArBA,MAAqB;AAAA,QAAb1I,MAAa,SAAbA,MAAa;AACxE8pB,uBAAmB,CAACphB,MAAD,EAAS;AAAEzO,YAAM,EAAE+F;AAAV,KAAT,CAAnB;AACA,WAAO;AAAEkqB,gBAAU,EAAEP,aAAa;AAA3B,KAAP;AACH,GAHQ,CAAT;AAIH;;AAEM,SAASQ,QAAT,CAAkBlxB,GAAlB,SAAqK;AAAA,MAApHysB,IAAoH,SAApHA,IAAoH;AACxK,SAAOA,IAAI,CAACzsB,GAAD,EAAM6uB,YAAY,CAACE,KAAnB,EAA0B;AAAEkC,cAAU,EAAEP,aAAa;AAA3B,GAA1B,EAA2D;AAAE1vB,UAAM,EAAEtB,kBAAV;AAAoBwI,WAAO,EAAE,CAAC;AAA9B,GAA3D,CAAJ,CACFyB,IADE,CACG,iBAAsC;AAAA,QAAnC5C,MAAmC,SAAnCA,MAAmC;AAAA,QAAnBkqB,UAAmB,SAA3BzF,IAA2B,CAAnByF,UAAmB;AACxCJ,uBAAmB,CAAC7wB,GAAD,EAAM;AAAEgB,YAAM,EAAE+F;AAAV,KAAN,CAAnB;AACA,WAAO;AAAE/G,SAAG,EAAHA,GAAF;AAAOgB,YAAM,EAAE+F,MAAf;AAAuBkqB,gBAAU,EAAVA;AAAvB,KAAP;AACH,GAJE,CAAP;AAKH;AAEM,SAASE,mBAAT,CAA6BnxB,GAA7B,SAAiH;AAAA,MAArDysB,IAAqD,SAArDA,IAAqD;AACpH,SAAO8D,WAAW,CAAC,0BAAD,CAAX,CAAwCvf,QAAxC,CAAiDhR,GAAjD,EAAsD,YAAM;AAC/D,WAAOkxB,QAAQ,CAAClxB,GAAD,EAAM;AAAEysB,UAAI,EAAJA;AAAF,KAAN,CAAR,CAAwB9iB,IAAxB,CAA6B;AAAA,UAAGsnB,UAAH,SAAGA,UAAH;AAAA,aAAoBA,UAApB;AAAA,KAA7B,CAAP;AACH,GAFM,CAAP;AAGH;AAEM,SAASG,SAAT,QAAqF;AAAA,MAAhE3Y,EAAgE,SAAhEA,EAAgE;AAAA,MAA5DgU,IAA4D,SAA5DA,IAA4D;AACxF,SAAOqD,WAAW,CAAC,kBAAD,CAAX,CAAgC9e,QAAhC,CAAyC,eAAzC,EAA0D,YAAM;AACnE,QAAM6H,QAAQ,GAAGmY,cAAc,CAAC;AAAEvY,QAAE,EAAFA;AAAF,KAAD,CAA/B;AAEA,QAAMnY,MAAM,GAAG0E,WAAW,EAA1B;;AACA,QAAI1E,MAAJ,EAAY;AACR4wB,cAAQ,CAAC5wB,MAAD,EAAS;AAAEmsB,YAAI,EAAJA;AAAF,OAAT,CAAR,CAA2B1gB,KAA3B,CAAiC1M,aAAjC;AACH;;AAED,WAAOwZ,QAAP;AACH,GATM,CAAP;AAUH;AAEM,SAASwY,gBAAT,CAA0BrxB,GAA1B,EAAuDkI,OAAvD,EAAgF1D,IAAhF,EAA8I;AAAA,MAAvF0D,OAAuF;AAAvFA,WAAuF,GAApE,IAAoE;AAAA;;AAAA,MAA9D1D,IAA8D;AAA9DA,QAA8D,GAA9C,QAA8C;AAAA;;AACjJ,MAAIuF,OAAO,GAAG4mB,eAAe,CAAC3wB,GAAD,CAA7B;;AAEA,MAAIkI,OAAO,KAAK,CAAC,CAAjB,EAAoB;AAChB6B,WAAO,GAAGA,OAAO,CAAC7B,OAAR,CAAgBA,OAAhB,EAAyB,IAAIrH,KAAJ,CAAc2D,IAAd,4BAA2C0D,OAA3C,QAAzB,CAAV;AACH;;AAED,SAAO6B,OAAP;AACH,C;;ACtED;AAEO,SAASunB,8BAAT,GAAoD;AAEvD,MAAIntB,YAAY,CAAClE,MAAD,CAAZ,CAAqBiH,KAArB,CAA2B,uCAA3B,CAAJ,EAAyE;AACrE,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH,C;;ACPD;AAEO,SAASqqB,eAAT,CAAyBvxB,GAAzB,EAAsD;AACzD,MAAMwxB,YAAY,GAAGjB,WAAW,CAAC,cAAD,CAAhC;AACAiB,cAAY,CAACvhB,GAAb,CAAiBjQ,GAAjB,EAAsB,IAAtB;AACH;AAEM,SAASyxB,aAAT,CAAuBzxB,GAAvB,EAA8D;AACjE,MAAMwxB,YAAY,GAAGjB,WAAW,CAAC,cAAD,CAAhC;AACA,SAAOiB,YAAY,CAACthB,GAAb,CAAiBlQ,GAAjB,EAAsB,KAAtB,CAAP;AACH,C;;ACZD;AACA;;;ACDO,IAAM0xB,IAAI,GAAG;AAChBC,UAAQ,EAAI,UADI;AAEhB/C,OAAK,EAAO,OAFI;AAGhBgD,SAAO,EAAK,SAHI;AAIhBC,OAAK,EAAO,OAJI;AAKhBC,MAAI,EAAQ,MALI;AAMhBC,OAAK,EAAO,OANI;AAOhBC,QAAM,EAAM,QAPI;AAQhBC,QAAM,EAAM,QARI;AAShBC,QAAM,EAAM,QATI;AAUhBC,SAAO,EAAK,SAVI;AAWhBC,MAAI,EAAQ,MAXI;AAYhBC,WAAS,EAAG;AAZI,CAAb,C;;ACAP;AAGO,SAASC,gBAAT,CAA0BtzB,IAA1B,EAAkD;AACrD,SAAQ,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAArC,IAA6C,OAAOA,IAAI,CAACuzB,QAAZ,KAAyB,QAA9E;AACH;AAEM,SAASC,aAAT,CAAuBhf,GAAvB,EAAkE;AACrE,MAAI,OAAOA,GAAP,KAAe,WAAnB,EAAgC;AAC5B,WAAOke,IAAI,CAACW,SAAZ;AACH;;AAED,MAAI7e,GAAG,KAAK,IAAZ,EAAkB;AACd,WAAOke,IAAI,CAACU,IAAZ;AACH;;AAED,MAAIprB,KAAK,CAACC,OAAN,CAAcuM,GAAd,CAAJ,EAAwB;AACpB,WAAOke,IAAI,CAACK,KAAZ;AACH;;AAED,MAAI,OAAOve,GAAP,KAAe,UAAnB,EAA+B;AAC3B,WAAOke,IAAI,CAACC,QAAZ;AACH;;AAED,MAAI,OAAOne,GAAP,KAAe,QAAnB,EAA6B;AAEzB,QAAIA,GAAG,YAAY3S,KAAnB,EAA0B;AACtB,aAAO6wB,IAAI,CAAC9C,KAAZ;AACH;;AAED,QAAI,OAAOpb,GAAG,CAAC7J,IAAX,KAAoB,UAAxB,EAAoC;AAChC,aAAO+nB,IAAI,CAACE,OAAZ;AACH;;AAED,QAAI3yB,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BoU,GAA/B,MAAwC,iBAA5C,EAA+D;AAC3D,aAAOke,IAAI,CAACG,KAAZ;AACH;;AAED,QAAI5yB,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BoU,GAA/B,MAAwC,eAA5C,EAA6D;AACzD,aAAOke,IAAI,CAACI,IAAZ;AACH;;AAED,WAAOJ,IAAI,CAACM,MAAZ;AACH;;AAED,MAAI,OAAOxe,GAAP,KAAe,QAAnB,EAA6B;AACzB,WAAOke,IAAI,CAACO,MAAZ;AACH;;AAED,MAAI,OAAOze,GAAP,KAAe,QAAnB,EAA6B;AACzB,WAAOke,IAAI,CAACQ,MAAZ;AACH;;AAED,MAAI,OAAO1e,GAAP,KAAe,SAAnB,EAA8B;AAC1B,WAAOke,IAAI,CAACS,OAAZ;AACH;AACJ;AAEM,SAASM,aAAT,CAA8CC,IAA9C,EAAwDlf,GAAxD,EAA8F;AACjG,SAAO;AACH+e,YAAQ,EAAEG,IADP;AAEHC,WAAO,EAAGnf;AAFP,GAAP;AAIH,C;;AC7DM,SAASof,cAAT,CAAmCpf,GAAnC,EAAiF;AACpF,SAAOA,GAAP;AACH;AAEM,SAASqf,gBAAT,CAAqCrf,GAArC,EAAmF;AACtF,SAAOA,GAAP;AACH,C;;ACNM,SAASsf,gBAAT,CAA0Btf,GAA1B,EAA6D;AAChE,SAAOA,GAAP;AACH;AAEM,SAASuf,kBAAT,CAA4Bvf,GAA5B,EAA+D;AAClE,SAAOA,GAAP;AACH,C;;ACRD;AACA;AAKO,SAASwf,aAAT,CAAuBxf,GAAvB,EAA4F;AAC/F,SAAOif,aAAa,CAACf,IAAI,CAACI,IAAN,EAAYte,GAAG,CAACyf,MAAJ,EAAZ,CAApB;AACH;AAEM,SAASC,eAAT,CAAyB1f,GAAzB,EAA8C;AACjD,SAAO,IAAIX,IAAJ,CAASW,GAAT,CAAP;AACH,C;;ACZD;AACA;AASA;AACO,SAAS2f,cAAT,OAAqH;AAAA,MAA3FtvB,OAA2F,QAA3FA,OAA2F;AAAA,MAAlFuH,KAAkF,QAAlFA,KAAkF;AAAA,MAA3EgoB,IAA2E,QAA3EA,IAA2E;AACxH,SAAOX,aAAa,CAACf,IAAI,CAAC9C,KAAN,EAAa;AAAE/qB,WAAO,EAAPA,OAAF;AAAWuH,SAAK,EAALA,KAAX;AAAkBgoB,QAAI,EAAJA;AAAlB,GAAb,CAApB;AACH;AAEM,SAASC,gBAAT,QAA8E;AAAA,MAAlDxvB,OAAkD,SAAlDA,OAAkD;AAAA,MAAzCuH,KAAyC,SAAzCA,KAAyC;AAAA,MAAlCgoB,IAAkC,SAAlCA,IAAkC;AACjF,MAAMnoB,KAAK,GAAG,IAAIpK,KAAJ,CAAUgD,OAAV,CAAd,CADiF,CAEjF;;AACAoH,OAAK,CAACmoB,IAAN,GAAaA,IAAb;AACAnoB,OAAK,CAACG,KAAN,GAAkBA,KAAlB,YAAgCH,KAAK,CAACG,KAAtC;AACA,SAAOH,KAAP;AACH,C;;ACnBM,SAASqoB,iBAAT,GAAkD,CACrD;AACH;AAEM,SAASC,mBAAT,GAA+B;AAClC,QAAM,IAAI1yB,KAAJ,qEAAN;AACH,C;;ACNM,SAAS2yB,eAAT,CAAyBhgB,GAAzB,EAA0D;AAC7D,SAAOA,GAAP;AACH;AAEM,SAASigB,iBAAT,CAA2BjgB,GAA3B,EAA4D;AAC/D,SAAOA,GAAP;AACH,C;;ACNM,SAASkgB,eAAT,CAAyBlgB,GAAzB,EAA0D;AAC7D,SAAOA,GAAP;AACH;AAEM,SAASmgB,iBAAT,CAA2BngB,GAA3B,EAA4D;AAC/D,SAAOA,GAAP;AACH,C;;ACNM,SAASogB,gBAAT,GAAgD,CACnD;AACH;AAEM,SAASC,kBAAT,GAA8B;AACjC,QAAM,IAAIhzB,KAAJ,oEAAN;AACH,C;;ACRD;AACA;AAKO,SAASizB,cAAT,CAAwBtgB,GAAxB,EAAiG;AACpG,SAAOif,aAAa,CAACf,IAAI,CAACG,KAAN,EAAare,GAAG,CAAC/D,MAAjB,CAApB;AACH;AAEM,SAASskB,gBAAT,CAA0BvgB,GAA1B,EAAiD;AACpD;AACA,SAAO,IAAIiH,MAAJ,CAAWjH,GAAX,CAAP;AACH,C;;ACXM,SAASwgB,eAAT,CAAyBxgB,GAAzB,EAA0D;AAC7D,SAAOA,GAAP;AACH;AAEM,SAASygB,iBAAT,CAA2BzgB,GAA3B,EAA4D;AAC/D,SAAOA,GAAP;AACH,C;;ACNM,SAAS0gB,aAAT,CAAuB1gB,GAAvB,EAAoD;AACvD,SAAOA,GAAP;AACH;AAEM,SAAS2gB,eAAT,CAAyB3gB,GAAzB,EAAsD;AACzD,SAAOA,GAAP;AACH,C;;ACRD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACTA;AAEA;AACA;AAkCA,IAAM4gB,UAAwB,kCACxB1C,IAAI,CAACC,QADmB,IACN2B,iBADM,cAExB5B,IAAI,CAAC9C,KAFmB,IAENuE,cAFM,cAGxBzB,IAAI,CAACE,OAHmB,IAGNgC,gBAHM,cAIxBlC,IAAI,CAACG,KAJmB,IAINiC,cAJM,cAKxBpC,IAAI,CAACI,IALmB,IAKNkB,aALM,cAMxBtB,IAAI,CAACK,KANmB,IAMNa,cANM,cAOxBlB,IAAI,CAACM,MAPmB,IAON0B,eAPM,cAQxBhC,IAAI,CAACO,MARmB,IAQN+B,eARM,cASxBtC,IAAI,CAACQ,MATmB,IASNsB,eATM,cAUxB9B,IAAI,CAACS,OAVmB,IAUNW,gBAVM,cAWxBpB,IAAI,CAACU,IAXmB,IAWN8B,aAXM,cAA9B,C,CAcA;;AACA,IAAMG,kBAAgC,GAAG,EAAzC;AAEO,SAASC,SAAT,CAA8B9rB,GAA9B,EAAuC+rB,WAAvC,EAAgG;AAAA,MAAzDA,WAAyD;AAAzDA,eAAyD,GAA7BF,kBAA6B;AAAA;;AAEnG,WAASpa,QAAT,CAAkBnN,GAAlB,EAAgC;AAC5B,QAAM0G,GAAG,GAAG,KAAK1G,GAAL,CAAZ;;AAEA,QAAIwlB,gBAAgB,CAAC,IAAD,CAApB,EAA4B;AACxB,aAAO9e,GAAP;AACH;;AAED,QAAMkf,IAAI,GAAGF,aAAa,CAAChf,GAAD,CAA1B;;AAEA,QAAI,CAACkf,IAAL,EAAW;AACP,aAAOlf,GAAP;AACH,KAX2B,CAa5B;;;AACA,QAAMghB,UAAU,GAAGD,WAAW,CAAC7B,IAAD,CAAX,IAAqB0B,UAAU,CAAC1B,IAAD,CAAlD;;AAEA,QAAI,CAAC8B,UAAL,EAAiB;AACb,aAAOhhB,GAAP;AACH;;AAED,WAAOghB,UAAU,CAAChhB,GAAD,EAAM1G,GAAN,CAAjB;AACH;;AAED,MAAMnL,MAAM,GAAGwF,IAAI,CAACC,SAAL,CAAeoB,GAAf,EAAoByR,QAApB,CAAf;;AAEA,MAAI,OAAOtY,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,WAAO+vB,IAAI,CAACW,SAAZ;AACH;;AAED,SAAO1wB,MAAP;AACH,C;;;;ACrFD;AACA;AACA;AAgCA;AACA,IAAM8yB,YAA4B,sCAC5B/C,IAAI,CAACC,QADuB,IACV4B,mBADU,gBAE5B7B,IAAI,CAAC9C,KAFuB,IAEVyE,gBAFU,gBAG5B3B,IAAI,CAACE,OAHuB,IAGViC,kBAHU,gBAI5BnC,IAAI,CAACG,KAJuB,IAIVkC,gBAJU,gBAK5BrC,IAAI,CAACI,IALuB,IAKVoB,eALU,gBAM5BxB,IAAI,CAACK,KANuB,IAMVc,gBANU,gBAO5BnB,IAAI,CAACM,MAPuB,IAOV2B,iBAPU,gBAQ5BjC,IAAI,CAACO,MARuB,IAQVgC,iBARU,gBAS5BvC,IAAI,CAACQ,MATuB,IASVuB,iBATU,gBAU5B/B,IAAI,CAACS,OAVuB,IAUVY,kBAVU,gBAW5BrB,IAAI,CAACU,IAXuB,IAWV+B,eAXU,gBAAlC,C,CAcA;;AACA,IAAMO,oBAAoC,GAAG,EAA7C;AAEO,SAASC,uBAAT,CAA8CnjB,GAA9C,EAA4DojB,aAA5D,EAAsH;AAAA,MAA1DA,aAA0D;AAA1DA,iBAA0D,GAA1BF,oBAA0B;AAAA;;AACzH,MAAIljB,GAAG,KAAKkgB,IAAI,CAACW,SAAjB,EAA4B;AACxB;AACA;AACH;;AAED,WAASpY,QAAT,CAAkBnN,GAAlB,EAAuB0G,GAAvB,EAAqC;AACjC,QAAI8e,gBAAgB,CAAC,IAAD,CAApB,EAA4B;AACxB,aAAO9e,GAAP;AACH;;AAED,QAAIkf,IAAJ;AACA,QAAI1nB,KAAJ;;AAEA,QAAIsnB,gBAAgB,CAAC9e,GAAD,CAApB,EAA2B;AACvBkf,UAAI,GAAGlf,GAAG,CAAC+e,QAAX;AACAvnB,WAAK,GAAGwI,GAAG,CAACmf,OAAZ;AACH,KAHD,MAGO;AACHD,UAAI,GAAGF,aAAa,CAAChf,GAAD,CAApB;AACAxI,WAAK,GAAGwI,GAAR;AACH;;AAED,QAAI,CAACkf,IAAL,EAAW;AACP,aAAO1nB,KAAP;AACH,KAlBgC,CAoBjC;;;AACA,QAAM6pB,YAAY,GAAGD,aAAa,CAAClC,IAAD,CAAb,IAAuB+B,YAAY,CAAC/B,IAAD,CAAxD;;AAEA,QAAI,CAACmC,YAAL,EAAmB;AACf,aAAO7pB,KAAP;AACH;;AAED,WAAO6pB,YAAY,CAAC7pB,KAAD,EAAQ8B,GAAR,CAAnB;AACH;;AAED,SAAO3F,IAAI,CAACihB,KAAL,CAAW5W,GAAX,EAAgByI,QAAhB,CAAP;AACH,C;;CCxFD;;AACO,IAAM1Q,eAAK,GAAG,IAAd,C,CAEP,uD;;ACLA;AACA;AACA;AACA;AACA;;;ACHA;AACA;AAEA;AACA;;AAGA,SAASurB,kBAAT,GAA8B;AAC1B,MAAMC,aAAa,GAAGjF,WAAW,CAAC,eAAD,CAAjC;;AAD0B,2CAGRiF,aAAa,CAACnoB,IAAd,EAHQ,4CAGc;AAAnC,QAAME,GAAG,4BAAT;AACD,QAAMkoB,YAAY,GAAGD,aAAa,CAACjoB,GAAD,CAAlC;;AAEA,QAAI;AACAzN,mBAAI,CAAC21B,YAAY,CAACvlB,MAAd,CAAJ;AACH,KAFD,CAEE,OAAOlP,GAAP,EAAY;AACVw0B,mBAAa,CAAC5E,GAAd,CAAkBrjB,GAAlB;AACA;AACH;;AAED,QAAIpJ,cAAc,CAACsxB,YAAY,CAACvlB,MAAd,CAAlB,EAAyC;AACrCslB,mBAAa,CAAC5E,GAAd,CAAkBrjB,GAAlB;AACH;AACJ;AACJ;;AASD,SAASmoB,eAAT,OAAgG;AAAA,MAArEzwB,IAAqE,QAArEA,IAAqE;AAAA,MAA/DiL,MAA+D,QAA/DA,MAA+D;AAAA,MAAvDylB,MAAuD,QAAvDA,MAAuD;AAAA,MAA/CC,WAA+C,QAA/CA,WAA+C;AAC5FL,oBAAkB;AAClB,MAAM/T,EAAE,GAAGxO,QAAQ,EAAnB;AACA,MAAMwiB,aAAa,GAAGjF,WAAW,CAAC,eAAD,CAAjC;AACAiF,eAAa,CAAC9kB,GAAd,CAAkB8Q,EAAlB,EAAsB;AAAEvc,QAAI,EAAJA,IAAF;AAAQiL,UAAM,EAANA,MAAR;AAAgBylB,UAAM,EAANA,MAAhB;AAAwBC,eAAW,EAAXA;AAAxB,GAAtB;AACA,SAAOpU,EAAP;AACH;;AAEM,SAASqU,uBAAT,QAAiE;AAAA,MAA9B3I,IAA8B,SAA9BA,IAA8B;;AACpEzZ,kBAAS,CAAC/S,MAAD,CAAT,CAAkBo1B,kBAAlB,GAAuC,SAASA,kBAAT,QAA+H;AAAA,QAAjG7wB,IAAiG,SAAjGA,IAAiG;AAAA,QAA3FiL,MAA2F,SAA3FA,MAA2F;AAAA,QAAnFylB,MAAmF,SAAnFA,MAAmF;AAAA,QAA3EC,WAA2E,SAA3EA,WAA2E;AAElK,QAAMJ,aAAa,GAAGjF,WAAW,CAAC,eAAD,CAAjC;AACA,QAAMwF,YAAY,GAAGj1B,SAAS,CAACJ,MAAD,CAA9B;;AAEA,QAAI,CAACq1B,YAAL,EAAmB;AACf,YAAM,IAAIz0B,KAAJ,4CAAN;AACH;;AAED,QAAMkgB,EAAE,GAAGkU,eAAe,CAAC;AAAEzwB,UAAI,EAAJA,IAAF;AAAQiL,YAAM,EAANA,MAAR;AAAgBylB,YAAM,EAANA,MAAhB;AAAwBC,iBAAW,EAAXA;AAAxB,KAAD,CAA1B;AAEA,WAAO1I,IAAI,CAAC6I,YAAD,EAAezG,YAAY,CAACG,WAA5B,EAAyC;AAEhDxqB,UAAI,EAAJA,IAFgD;AAIhD2wB,iBAJgD,yBAIlC;AAEV,YAAMH,YAAY,GAAGD,aAAa,CAAC7kB,GAAd,CAAkB6Q,EAAlB,CAArB;;AAEA,YAAI;AACA;AACA1hB,uBAAI,CAAC21B,YAAY,IAAIA,YAAY,CAACvlB,MAA9B,CAAJ;AACH,SAHD,CAGE,OAAOlP,GAAP,EAAY;AACVw0B,uBAAa,CAAC5E,GAAd,CAAkBpP,EAAlB;AACA;AACH;;AAED,YAAI,CAACiU,YAAD,IAAiB,CAACA,YAAY,CAACvlB,MAA/B,IAAyC/L,cAAc,CAACsxB,YAAY,CAACvlB,MAAd,CAA3D,EAAkF;AAC9E;AACH;;AAED,YAAI;AACAulB,sBAAY,CAACE,MAAb;AACH,SAFD,CAEE,OAAO30B,GAAP,EAAY;AACV;AACH;;AAEDy0B,oBAAY,CAACG,WAAb,CAAyBhoB,KAAzB,CAA+B,IAA/B,EAAqCqC,SAArC;AACH;AA3B+C,KAAzC,EA6BR;AAAExO,YAAM,EAAEtB,kBAAQA;AAAlB,KA7BQ,CAAX;AA8BH,GAzCD;AA0CH,C;;ACrFD;AACA;AACA;AAEA;AACA;AAEO,SAAS61B,qBAAT,GAA2C;AAE9C,MAAIpxB,YAAY,CAAClE,MAAD,CAAZ,CAAqBiH,KAArB,CAA2B,iCAA3B,CAAJ,EAAmE;AAC/D,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASsuB,iBAAT,CAA2Bx1B,GAA3B,EAAkE;AAErE,MAAI,CAACoG,eAAe,CAACnG,MAAD,EAASD,GAAT,CAApB,EAAmC;AAC/B,WAAO,IAAP;AACH;;AAED,SAAO,KAAP;AACH;AAEM,SAASy1B,oBAAT,CAA8Bz0B,MAA9B,EAAgDhB,GAAhD,EAAwF;AAE3F,MAAIgB,MAAJ,EAAY;AACR,QAAID,SAAS,OAAO0G,gBAAgB,CAACzG,MAAD,CAApC,EAA8C;AAC1C,aAAO,IAAP;AACH;AACJ,GAJD,MAIO,IAAIhB,GAAJ,EAAS;AACZ,QAAI,CAACwB,YAAY,CAACxB,GAAD,CAAjB,EAAyB;AACrB,aAAO,IAAP;AACH;AACJ;;AAED,SAAO,KAAP;AACH;AAEM,SAAS01B,WAAT,OAAqG;AAAA,MAA9E11B,GAA8E,QAA9EA,GAA8E;AAAA,MAAzEgB,MAAyE,QAAzEA,MAAyE;;AAExG,MAAI,CAACu0B,qBAAqB,EAA1B,EAA8B;AAC1B,WAAO,KAAP;AACH;;AAED,MAAIv0B,MAAM,IAAI,CAACy0B,oBAAoB,CAACz0B,MAAD,EAAShB,GAAT,CAAnC,EAAkD;AAC9C,WAAO,KAAP;AACH;;AAED,MAAIA,GAAG,IAAI,CAACw1B,iBAAiB,CAACx1B,GAAD,CAA7B,EAAoC;AAChC,WAAO,KAAP;AACH;;AAED,SAAO,IAAP;AACH;AAEM,SAAS21B,aAAT,CAAuB30B,MAAvB,EAAiD;AAEpDA,QAAM,GAAGA,MAAM,IAAIyG,gBAAgB,CAACzG,MAAD,CAAnC;AAEA,MAAM40B,eAAe,GAAG50B,MAAM,CAACgI,OAAP,CAAe,gBAAf,EAAiC,GAAjC,CAAxB;AAEA,MAAM+X,EAAE,GAAOsO,kBAAP,SAA+BuG,eAAvC;AAEA,SAAO7U,EAAP;AACH;AAEM,SAAS8U,QAAT,GAA8B;AACjC,SAAOtwB,OAAO,CAACtF,MAAM,CAACuE,IAAP,IAAevE,MAAM,CAACuE,IAAP,KAAgBmxB,aAAa,CAAC50B,SAAS,EAAV,CAA7C,CAAd;AACH;AAEM,IAAM+0B,iBAAiB,GAAG,IAAIlrB,oBAAJ,CAAiB,UAAAL,OAAO,EAAI;AAEzD,MAAItK,MAAM,CAACoJ,QAAP,IAAmBpJ,MAAM,CAACoJ,QAAP,CAAgBgT,IAAvC,EAA6C;AACzC,WAAO9R,OAAO,CAACtK,MAAM,CAACoJ,QAAP,CAAgBgT,IAAjB,CAAd;AACH;;AAED,MAAM3C,QAAQ,GAAGiD,WAAW,CAAC,YAAM;AAC/B,QAAI1c,MAAM,CAACoJ,QAAP,IAAmBpJ,MAAM,CAACoJ,QAAP,CAAgBgT,IAAvC,EAA6C;AACzCO,mBAAa,CAAClD,QAAD,CAAb;AACA,aAAOnP,OAAO,CAACtK,MAAM,CAACoJ,QAAP,CAAgBgT,IAAjB,CAAd;AACH;AACJ,GAL2B,EAKzB,EALyB,CAA5B;AAMH,CAZgC,CAA1B;AAcA,SAAS0Z,oBAAT,CAA8B/1B,GAA9B,EAA2D;AAC9D,MAAMg2B,oBAAoB,GAAGzF,WAAW,CAAC,sBAAD,CAAxC;AACAyF,sBAAoB,CAAChlB,QAArB,CAA8BhR,GAA9B,EAAmC;AAAA,WAAM,IAAI4K,oBAAJ,EAAN;AAAA,GAAnC;AACH;AAEM,SAASqrB,gBAAT,CAA0Bj2B,GAA1B,EAA4J;AAC/J,MAAMg2B,oBAAoB,GAAGzF,WAAW,CAAC,sBAAD,CAAxC;AACA,MAAM2F,gBAAgB,GAAGF,oBAAoB,CAAC9lB,GAArB,CAAyBlQ,GAAzB,CAAzB;;AAEA,MAAI,CAACk2B,gBAAL,EAAuB;AACnB,UAAM,IAAIr1B,KAAJ,mCAAN;AACH;;AAED,SAAOq1B,gBAAP;AACH;AAOM,SAASC,yBAAT,CAAmCn2B,GAAnC,EAAgEgB,MAAhE,EAAiFm0B,WAAjF,EAAgH;AACnH,MAAMiB,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,SAAD,EAAoCC,YAApC,EAA2DzyB,OAA3D,EAAgF;AACvG,QAAIwyB,SAAS,KAAKr2B,GAAlB,EAAuB;AACnB,YAAM,IAAIa,KAAJ,uCAAN;AACH;;AAED,QAAI,CAACgG,WAAW,CAACyvB,YAAD,EAAet1B,MAAf,CAAhB,EAAwC;AACpC,YAAM,IAAIH,KAAJ,oBAA4By1B,YAA5B,+BAAoEt1B,MAApE,CAAN;AACH;;AAEDm0B,eAAW,CAACoB,aAAZ,CAA0B1yB,OAA1B;AACH,GAVD;;AAYAoyB,kBAAgB,CAACj2B,GAAD,CAAhB,CAAsBuK,OAAtB,CAA8B6rB,kBAA9B;AACH;AAEM,SAASI,uBAAT,CAAiCx2B,GAAjC,EAA8DO,GAA9D,EAA2E;AAC9E01B,kBAAgB,CAACj2B,GAAD,CAAhB,CAAsBuL,MAAtB,CAA6BhL,GAA7B,EAAkCwL,KAAlC,CAAwC1M,aAAxC;AACH;AAEM,SAASo3B,iBAAT,CAA2Bz2B,GAA3B,EAAwDgB,MAAxD,EAAyE6C,OAAzE,EAAgH;AAEnH,MAAM6yB,cAAc,GAAI3xB,QAAQ,CAAC9E,MAAD,EAASD,GAAT,CAAhC;AACA,MAAM22B,eAAe,GAAG5xB,QAAQ,CAAC/E,GAAD,EAAMC,MAAN,CAAhC;;AAEA,MAAI,CAACy2B,cAAD,IAAmB,CAACC,eAAxB,EAAyC;AACrC,UAAM,IAAI91B,KAAJ,+DAAN;AACH;;AAED,SAAOo1B,gBAAgB,CAACj2B,GAAD,CAAhB,CAAsB2J,IAAtB,CAA2B,UAAAwrB,WAAW,EAAI;AAC7C,WAAOA,WAAW,CAACn1B,GAAD,EAAMgB,MAAN,EAAc6C,OAAd,CAAlB;AACH,GAFM,CAAP;AAGH,C;;AC3ID;AACA;AACA;AAEA;AAGA;;AAEA,SAAS+yB,0BAAT,CAAqC52B,GAArC,EAAyG;AACrG,SAAOuwB,WAAW,CAAC,sBAAD,CAAX,CAAoCvf,QAApC,CAA6ChR,GAA7C,EAAkD,YAAM;AAC3D,WAAO4K,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,UAAM9J,KAAK,GAAGkC,cAAc,CAACvE,GAAD,EAAM21B,aAAa,CAAC50B,SAAS,EAAV,CAAnB,CAA5B;;AAEA,UAAI,CAACsB,KAAL,EAAY;AACR;AACH;;AAED,UAAIb,YAAY,CAACa,KAAD,CAAZ,IAAuB2Q,gBAAS,CAACvR,gBAAgB,CAACY,KAAD,CAAjB,CAApC,EAA+D;AAC3D,eAAOA,KAAP;AACH;;AAED,aAAO,IAAIuI,oBAAJ,CAAiB,UAAAL,OAAO,EAAI;AAE/B,YAAImP,QAAJ;AACA,YAAIxR,OAAJ,CAH+B,CAGlB;;AAEbwR,gBAAQ,GAAGiD,WAAW,CAAC,YAAM;AAAE;AAC3B,cAAIta,KAAK,IAAIb,YAAY,CAACa,KAAD,CAArB,IAAgC2Q,gBAAS,CAACvR,gBAAgB,CAACY,KAAD,CAAjB,CAA7C,EAAwE;AACpEua,yBAAa,CAAClD,QAAD,CAAb;AACAtR,wBAAY,CAACF,OAAD,CAAZ;AACA,mBAAOqC,OAAO,CAAClI,KAAD,CAAd;AACH;AACJ,SANqB,EAMnB,GANmB,CAAtB;AAQA6F,eAAO,GAAGG,UAAU,CAAC,YAAM;AACvBuU,uBAAa,CAAClD,QAAD,CAAb;AACA,iBAAOnP,OAAO,EAAd;AACH,SAHmB,EAGjB,IAHiB,CAApB;AAIH,OAjBM,CAAP;AAkBH,KA7BM,CAAP;AA8BH,GA/BM,CAAP;AAgCH;;AAEM,SAASssB,kBAAT,OAAuJ;AAAA,MAAzHpe,EAAyH,QAAzHA,EAAyH;AAAA,MAArHgU,IAAqH,QAArHA,IAAqH;AAAA,MAA/GqK,cAA+G,QAA/GA,cAA+G;AAC1J,SAAOlsB,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,QAAM1L,MAAM,GAAGD,SAAS,CAACP,MAAD,CAAxB;;AAEA,QAAI,CAACQ,MAAD,IAAW,CAACi1B,WAAW,CAAC;AAAE11B,SAAG,EAAES;AAAP,KAAD,CAA3B,EAA8C;AAC1C;AACH;;AAEDs1B,wBAAoB,CAACt1B,MAAD,CAApB;AAEA,WAAOm2B,0BAA0B,CAACn2B,MAAD,CAA1B,CAAmCkJ,IAAnC,CAAwC,UAAAotB,MAAM,EAAI;AAErD,UAAI,CAACA,MAAL,EAAa;AACT,eAAOP,uBAAuB,CAAC/1B,MAAD,EAAS,IAAII,KAAJ,2DAAT,CAA9B;AACH;;AAED,UAAI,CAACZ,MAAM,CAACuE,IAAZ,EAAkB;AACd,eAAOgyB,uBAAuB,CAAC/1B,MAAD,EAAS,IAAII,KAAJ,6DAAT,CAA9B;AACH;;AAED,aAAOmS,gBAAS,CAACvR,gBAAgB,CAACs1B,MAAD,CAAjB,CAAT,CAAoC1B,kBAApC,CAAuD;AAE1D7wB,YAAI,EAAEvE,MAAM,CAACuE,IAF6C;AAI1DiL,cAAM,EAAExP,MAJkD;AAM1Di1B,cAN0D,oBAMjD,CACL;AACH,SARyD;AAU1DC,mBAV0D,uBAU9CtxB,OAV8C,EAUrC;AAEjB,cAAI;AACAxE,yBAAI,CAACY,MAAD,CAAJ;AACH,WAFD,CAEE,OAAOM,GAAP,EAAY;AACV;AACH;;AAED,cAAI,CAACN,MAAD,IAAWA,MAAM,CAAC2D,MAAtB,EAA8B;AAC1B;AACH;;AAED,cAAI;AACAkzB,0BAAc,CAAC;AACXtL,kBAAI,EAAI3nB,OADG;AAEXkD,oBAAM,EAAE,KAAKA,MAFF;AAGX0I,oBAAM,EAAE,KAAKA;AAHF,aAAD,EAIX;AAAEgJ,gBAAE,EAAFA,EAAF;AAAMgU,kBAAI,EAAJA;AAAN,aAJW,CAAd;AAKH,WAND,CAME,OAAOlsB,GAAP,EAAY;AACVqK,gCAAY,CAACW,MAAb,CAAoBhL,GAApB;AACH;AACJ;AA/ByD,OAAvD,EAiCJoJ,IAjCI,CAiCC,iBAA8B;AAAA,YAA3B8F,MAA2B,SAA3BA,MAA2B;AAAA,YAAnB1I,MAAmB,SAAnBA,MAAmB;AAAA,YAAXykB,IAAW,SAAXA,IAAW;;AAElC,YAAI/b,MAAM,KAAKhP,MAAf,EAAuB;AACnB,gBAAM,IAAII,KAAJ,gCAAN;AACH;;AAEDs1B,iCAAyB,CAAC1mB,MAAD,EAAS1I,MAAT,EAAiBykB,IAAI,CAAC2J,WAAtB,CAAzB;AAEH,OAzCM,EAyCJppB,KAzCI,CAyCE,UAAAxL,GAAG,EAAI;AAEZi2B,+BAAuB,CAAC/1B,MAAD,EAASF,GAAT,CAAvB;AACA,cAAMA,GAAN;AACH,OA7CM,CAAP;AA8CH,KAxDM,CAAP;AAyDH,GAlEM,CAAP;AAmEH,C;;AChHD;AACA;AAEA;AACA;AACA;AAGA;AAEO,SAASy2B,mBAAT,OAAmI;AAAA,MAApGve,EAAoG,QAApGA,EAAoG;AAAA,MAAhGgU,IAAgG,QAAhGA,IAAgG;AAAA,MAA1FqK,cAA0F,QAA1FA,cAA0F;AACtI,MAAMG,kBAAkB,GAAGnH,WAAW,CAAC,oBAAD,CAAtC;AAEArX,IAAE,CAACoW,YAAY,CAACG,WAAd,EAA2B,iBAA8B;AAAA,QAA3Bvf,MAA2B,SAA3BA,MAA2B;AAAA,QAAnB1I,MAAmB,SAAnBA,MAAmB;AAAA,QAAXykB,IAAW,SAAXA,IAAW;AACvD,QAAM0L,aAAa,GAAGpH,WAAW,CAAC,SAAD,CAAX,CAAuB5f,GAAvB,CAA2BnJ,MAA3B,CAAtB;;AAEA,QAAI,CAACmwB,aAAL,EAAoB;AAChB,YAAM,IAAIr2B,KAAJ,6CAAqDkG,MAArD,CAAN;AACH;;AAED,WAAOmwB,aAAa,CAACvtB,IAAd,CAAmB,UAAAotB,MAAM,EAAI;AAChC,UAAItnB,MAAM,KAAKsnB,MAAf,EAAuB;AACnB,cAAM,IAAIl2B,KAAJ,mEAA2EkG,MAA3E,CAAN;AACH;;AAED,UAAI,CAACykB,IAAI,CAAChnB,IAAV,EAAgB;AACZ,cAAM,IAAI3D,KAAJ,qDAAN;AACH;;AAED,UAAI,CAAC2qB,IAAI,CAAC2J,WAAV,EAAuB;AACnB,cAAM,IAAIt0B,KAAJ,4DAAN;AACH;;AAED,UAAI,CAACo2B,kBAAkB,CAAClmB,GAAnB,CAAuBya,IAAI,CAAChnB,IAA5B,CAAL,EAAwC;AACpC,cAAM,IAAI3D,KAAJ,uBAA+B2qB,IAAI,CAAChnB,IAApC,uDAAN;AACH;;AAED,UAAI,CAACyyB,kBAAkB,CAAC/mB,GAAnB,CAAuBsb,IAAI,CAAChnB,IAA5B,EAAkCxD,MAAvC,EAA+C;AAC3C,cAAM,IAAIH,KAAJ,oDAA4D2qB,IAAI,CAAChnB,IAAjE,CAAN;AACH;;AAED,UAAIyyB,kBAAkB,CAAC/mB,GAAnB,CAAuBsb,IAAI,CAAChnB,IAA5B,EAAkCxD,MAAlC,KAA6C+F,MAAjD,EAAyD;AACrD,cAAM,IAAIlG,KAAJ,qBAA6BkG,MAA7B,mDAAmFkwB,kBAAkB,CAAC/mB,GAAnB,CAAuBsb,IAAI,CAAChnB,IAA5B,EAAkCxD,MAArH,CAAN;AACH;;AAEDm1B,+BAAyB,CAACc,kBAAkB,CAAC/mB,GAAnB,CAAuBsb,IAAI,CAAChnB,IAA5B,EAAkCxE,GAAnC,EAAwC+G,MAAxC,EAAgDykB,IAAI,CAAC2J,WAArD,CAAzB;AAEA,aAAO;AACHA,mBADG,uBACStxB,OADT,EACkB;AAEjB,cAAI,CAAC5D,MAAD,IAAWA,MAAM,CAAC2D,MAAtB,EAA8B;AAC1B;AACH;;AAED,cAAMuzB,UAAU,GAAGF,kBAAkB,CAAC/mB,GAAnB,CAAuBsb,IAAI,CAAChnB,IAA5B,CAAnB;;AAEA,cAAI,CAAC2yB,UAAL,EAAiB;AACb;AACH;;AAED,cAAI;AACAL,0BAAc,CAAC;AACXtL,kBAAI,EAAI3nB,OADG;AAEXkD,oBAAM,EAAEowB,UAAU,CAACn2B,MAFR;AAGXyO,oBAAM,EAAE0nB,UAAU,CAACn3B;AAHR,aAAD,EAIX;AAAEyY,gBAAE,EAAFA,EAAF;AAAMgU,kBAAI,EAAJA;AAAN,aAJW,CAAd;AAKH,WAND,CAME,OAAOlsB,GAAP,EAAY;AACVqK,gCAAY,CAACW,MAAb,CAAoBhL,GAApB;AACH;AACJ;AAtBE,OAAP;AAwBH,KAnDM,CAAP;AAoDH,GA3DC,CAAF;AA4DH;;AAED,SAAS62B,eAAT,CAAyB5yB,IAAzB,EAAwCkD,GAAxC,EAA0E;AAEtE,MAAM6b,MAAM,GAAGla,QAAQ,CAAC4Z,aAAT,UAAf;AAEAM,QAAM,CAACH,YAAP,SAA4B5e,IAA5B;AACA+e,QAAM,CAACH,YAAP,OAA4B5e,IAA5B;AAEA+e,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AAEAG,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AACAG,QAAM,CAACH,YAAP;AAEAG,QAAM,CAAC9D,GAAP,GAAa/X,GAAb;AAEA,SAAO6b,MAAP;AACH;;AAEM,SAAS8T,SAAT,CAAmB3vB,GAAnB,EAAiC1G,MAAjC,EAA4D;AAC/D,MAAMs2B,OAAO,GAAGxH,WAAW,CAAC,SAAD,CAA3B;AACA,SAAOwH,OAAO,CAACvmB,GAAR,CAAY/P,MAAM,IAAIyG,gBAAgB,CAACC,GAAD,CAAtC,CAAP;AACH;AAEM,SAAS6vB,UAAT,CAAoB7vB,GAApB,EAAkC1G,MAAlC,EAAyF;AAC5F,MAAMs2B,OAAO,GAAGxH,WAAW,CAAC,SAAD,CAA3B;AACA,MAAM0H,YAAY,GAAG1H,WAAW,CAAC,cAAD,CAAhC;AAEA9uB,QAAM,GAAGA,MAAM,IAAIyG,gBAAgB,CAACC,GAAD,CAAnC;AAEA,SAAO4vB,OAAO,CAACtmB,QAAR,CAAiBhQ,MAAjB,EAAyB;AAAA,WAAM4J,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAEzD,UAAIpL,SAAS,OAAOC,MAApB,EAA4B;AACxB,cAAM,IAAIH,KAAJ,gEAAwEG,MAAxE,CAAN;AACH;;AAED,UAAMwD,IAAI,GAAImxB,aAAa,CAAC30B,MAAD,CAA3B;AACA,UAAMqB,KAAK,GAAGkC,cAAc,CAACtE,MAAD,EAASuE,IAAT,CAA5B;;AAEA,UAAInC,KAAJ,EAAW;AACP,cAAM,IAAIxB,KAAJ,sBAA8B2D,IAA9B,6BAAN;AACH;;AAED,UAAM+e,MAAM,GAAG6T,eAAe,CAAC5yB,IAAD,EAAOkD,GAAP,CAA9B;AACA8vB,kBAAY,CAACvnB,GAAb,CAAiBjP,MAAjB,EAAyBuiB,MAAzB;AAEA,aAAOuS,iBAAiB,CAACnsB,IAAlB,CAAuB,UAAA0S,IAAI,EAAI;AAElCA,YAAI,CAACmE,WAAL,CAAiB+C,MAAjB;AACA,YAAMwT,MAAM,GAAGxT,MAAM,CAACvgB,aAAtB;AAEA,eAAO,IAAI4H,oBAAJ,CAAiB,UAACL,OAAD,EAAUgB,MAAV,EAAqB;AAEzCgY,gBAAM,CAAC9G,gBAAP,CAAwB,MAAxB,EAAgClS,OAAhC;AACAgZ,gBAAM,CAAC9G,gBAAP,CAAwB,OAAxB,EAAiClR,MAAjC;AAEH,SALM,EAKJ5B,IALI,CAKC,YAAM;AAEV,iBAAO0nB,gBAAgB,CAAC0F,MAAD,EAAShJ,cAAT,cAAoCrmB,GAApC,CAAvB;AAEH,SATM,EASJiC,IATI,CASC,YAAM;AAEV,iBAAOotB,MAAP;AACH,SAZM,CAAP;AAaH,OAlBM,CAAP;AAmBH,KAnCqC,CAAN;AAAA,GAAzB,CAAP;AAoCH;AAQM,SAASU,UAAT,QAAqE;AAAA,MAA/Cz3B,GAA+C,SAA/CA,GAA+C;AAAA,MAA1CwE,IAA0C,SAA1CA,IAA0C;AAAA,MAApCxD,MAAoC,SAApCA,MAAoC;AACxE,MAAMi2B,kBAAkB,GAAGnH,WAAW,CAAC,oBAAD,CAAtC;AACA,MAAM4H,iBAAiB,GAAGnH,WAAW,CAAC,mBAAD,CAArC;;AAFwE,6CAIlD0G,kBAAkB,CAACrqB,IAAnB,EAJkD,8CAIvB;AAA5C,QAAM+qB,OAAO,8BAAb;;AACD;AACA,QAAMC,QAAO,GAAGX,kBAAkB,CAAC/mB,GAAnB,CAAuBynB,OAAvB,CAAhB;;AACA,QAAI,CAACC,QAAD,IAAYl0B,cAAc,CAACk0B,QAAO,CAAC53B,GAAT,CAA9B,EAA6C;AACzCi3B,wBAAkB,CAAC9G,GAAnB,CAAuBwH,OAAvB;AACH;AACJ;;AAED,MAAMC,OAAO,GAAGF,iBAAiB,CAAC1mB,QAAlB,CAA2BhR,GAA3B,EAAgC,YAAmB;AAC/D,QAAI,CAACwE,IAAL,EAAW;AACP,aAAO;AAAExE,WAAG,EAAHA;AAAF,OAAP;AACH;;AAED,WAAOi3B,kBAAkB,CAACjmB,QAAnB,CAA4BxM,IAA5B,EAAkC,YAAmB;AACxD,aAAO;AAAExE,WAAG,EAAHA,GAAF;AAAOwE,YAAI,EAAJA;AAAP,OAAP;AACH,KAFM,CAAP;AAGH,GARe,CAAhB;;AAUA,MAAIozB,OAAO,CAAC53B,GAAR,IAAe43B,OAAO,CAAC53B,GAAR,KAAgBA,GAAnC,EAAwC;AACpC,UAAM,IAAIa,KAAJ,mDAA0D2D,IAAI,IAAI,WAAlE,EAAN;AACH;;AAED,MAAIA,IAAJ,EAAU;AACNozB,WAAO,CAACpzB,IAAR,GAAeA,IAAf;AACAyyB,sBAAkB,CAAChnB,GAAnB,CAAuBzL,IAAvB,EAA6BozB,OAA7B;AACH;;AAED,MAAI52B,MAAJ,EAAY;AACR42B,WAAO,CAAC52B,MAAR,GAAiBA,MAAjB;AACA+0B,wBAAoB,CAAC/1B,GAAD,CAApB;AACH;;AAED03B,mBAAiB,CAACznB,GAAlB,CAAsBjQ,GAAtB,EAA2B43B,OAA3B;AAEA,SAAOA,OAAP;AACH;AAEM,SAASC,OAAT,CAAiB73B,GAAjB,EAA8C0H,GAA9C,EAA4D;AAC/D+vB,YAAU,CAAC;AAAEz3B,OAAG,EAAHA,GAAF;AAAOgB,UAAM,EAAEyG,gBAAgB,CAACC,GAAD;AAA/B,GAAD,CAAV;AACH;AAEM,SAASowB,mBAAT,GAA+B;AAClC,MAAMC,UAAU,GAAG93B,MAAM,CAAC8hB,IAA1B;;AAEA9hB,QAAM,CAAC8hB,IAAP,GAAc,SAASiW,iBAAT,CAA2BtwB,GAA3B,EAAyClD,IAAzC,EAAwDkP,OAAxD,EAA0EukB,IAA1E,EAAgG;AAC1G,QAAMj4B,GAAG,GAAG+3B,UAAU,CAAC34B,IAAX,CAAgB,IAAhB,EAAsB2J,gBAAgB,CAACrB,GAAD,CAAtC,EAA6ClD,IAA7C,EAAmDkP,OAAnD,EAA4DukB,IAA5D,CAAZ;;AAEA,QAAI,CAACj4B,GAAL,EAAU;AACN,aAAOA,GAAP;AACH;;AAEDy3B,cAAU,CAAC;AAAEz3B,SAAG,EAAHA,GAAF;AAAOwE,UAAI,EAAJA,IAAP;AAAaxD,YAAM,EAAE0G,GAAG,GAAGD,gBAAgB,CAACC,GAAD,CAAnB,GAA2B;AAAnD,KAAD,CAAV;AAEA,WAAO1H,GAAP;AACH,GAVD;AAWH;AAEM,SAASk4B,cAAT,GAA0B;AAC7B,MAAMZ,OAAO,GAAGxH,WAAW,CAAC,SAAD,CAA3B;AACA,MAAM0H,YAAY,GAAG1H,WAAW,CAAC,cAAD,CAAhC;;AAF6B,0CAIR0H,YAAY,CAAC5qB,IAAb,EAJQ,2CAIa;AAArC,QAAM5L,MAAM,2BAAZ;AACD,QAAMqB,KAAK,GAAGm1B,YAAY,CAACtnB,GAAb,CAAiBlP,MAAjB,CAAd;;AACA,QAAIqB,KAAK,IAAIA,KAAK,CAACY,UAAnB,EAA+B;AAC3BZ,WAAK,CAACY,UAAN,CAAiBsf,WAAjB,CAA6BlgB,KAA7B;AACH;AACJ;;AACDm1B,cAAY,CAACvjB,KAAb;AACAqjB,SAAO,CAACrjB,KAAR;AACH,C;;AChOD;AACA;AACA;AAEO,SAASkkB,WAAT,OAA2H;AAAA,MAApG1f,EAAoG,QAApGA,EAAoG;AAAA,MAAhGgU,IAAgG,QAAhGA,IAAgG;AAAA,MAA1FqK,cAA0F,QAA1FA,cAA0F;AAC9HgB,qBAAmB;AACnBd,qBAAmB,CAAC;AAAEve,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA,IAAN;AAAYqK,kBAAc,EAAdA;AAAZ,GAAD,CAAnB;AACA1B,yBAAuB,CAAC;AAAE3c,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA;AAAN,GAAD,CAAvB;AACAoK,oBAAkB,CAAC;AAAEpe,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA,IAAN;AAAYqK,kBAAc,EAAdA;AAAZ,GAAD,CAAlB;AACH,C;;ACVD;AACA;AACA;AACA;;;ACJA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAGA,SAASsB,mBAAT,GAA+B;AAC3B,MAAMC,eAAe,GAAGvI,WAAW,CAAC,iBAAD,CAAnC;;AAD2B,6CAEVuI,eAAe,CAACzrB,IAAhB,EAFU,8CAEc;AAApC,QAAMmU,EAAE,8BAAR;;AACD;AACA,QAAIsX,eAAe,CAACnoB,GAAhB,CAAoB6Q,EAApB,EAAwBuX,WAAxB,EAAJ,EAA2C;AACvCD,qBAAe,CAAClI,GAAhB,CAAoBpP,EAApB;AACH;AACJ;AACJ;;AAcD,SAASwX,mBAAT,CAA6BC,UAA7B,QAAqK;AAAA,MAApF/L,IAAoF,QAApFA,IAAoF;AAAA,qBAA9E1L,EAA8E;AAAA,MAA9EA,EAA8E,wBAAzExO,QAAQ,EAAiE;AACjK,MAAIkmB,UAAJ;AAEA,SAAO;AACH1X,MAAE,EAAFA,EADG;AAEH2X,WAAO,EAAE;AAAA,aAAMF,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG,EAAI;AAClC,eAAOQ,SAAS,CAACR,GAAD,CAAT,GAAiBL,WAAW,CAACE,KAA7B,GAAqCF,WAAW,CAACC,MAAxD;AACH,OAFc,CAAN;AAAA,KAFN;AAKH8wB,iBAAa,EAAEvc,cAAc,CAAC;AAAA,aAAMqkB,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG;AAAA,eAAImxB,mBAAmB,CAACnxB,GAAD,EAAM;AAAEysB,cAAI,EAAJA;AAAF,SAAN,CAAvB;AAAA,OAAnB,CAAN;AAAA,KAAD,CAL1B;AAMHvjB,SAAK,EAAU;AAAA,aAAMsvB,UAAU,CAAC7uB,IAAX,CAAgBV,WAAhB,CAAN;AAAA,KANZ;AAOH0vB,WAAO,EAAQ;AAAA,aAAMH,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG,EAAI;AACxC,YAAI0D,cAAc,CAAC1D,GAAD,CAAlB,EAAyB;AACrB;AACH;;AAED,eAAOy4B,UAAP;AACH,OANoB,CAAN;AAAA,KAPZ;AAcHG,SAAK,EAAI;AAAA,aAAMJ,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG,EAAI;AAClCA,WAAG,CAAC44B,KAAJ;AACH,OAFc,CAAN;AAAA,KAdN;AAiBHC,YAAQ,EAAE;AAAA,aAAML,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG,EAAI;AACnC,eAAO0D,cAAc,CAAC1D,GAAD,CAArB;AACH,OAFe,CAAN;AAAA,KAjBP;AAoBH84B,eAAW,EAAE,qBAACn4B,IAAD;AAAA,aAAU63B,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG,EAAI;AAC1C,YAAIwB,YAAY,CAACxB,GAAD,CAAhB,EAAuB;AACnB,cAAI;AACA,gBAAIA,GAAG,CAACE,QAAJ,IAAgB,OAAOF,GAAG,CAACE,QAAJ,CAAa8I,OAApB,KAAgC,UAApD,EAAgE;AAC5D;AACAhJ,iBAAG,CAACE,QAAJ,CAAa8I,OAAb,CAAqBrI,IAArB;AACA;AACH;AACJ,WAND,CAME,OAAOJ,GAAP,EAAY,CACV;AACH;AACJ;;AAEDP,WAAG,CAACE,QAAJ,GAAeS,IAAf;AACH,OAdsB,CAAV;AAAA,KApBV;AAmCHo4B,WAAO,EAAE,iBAACv0B,IAAD;AAAA,aAAUg0B,UAAU,CAAC7uB,IAAX,CAAgB,UAAA3J,GAAG,EAAI;AACtC,YAAI2vB,IAAJ,EAAyC;AACrC8H,oBAAU,CAAC;AAAEz3B,eAAG,EAAHA,GAAF;AAAOwE,gBAAI,EAAJA;AAAP,WAAD,CAAV;AACH;;AAED,YAAMw0B,UAAU,GAAGx3B,YAAY,CAACxB,GAAD,CAA/B;AACA,YAAMqC,KAAK,GAAG8G,iBAAiB,CAACnJ,GAAD,CAA/B;;AAEA,YAAI,CAACg5B,UAAL,EAAiB;AACb,gBAAM,IAAIn4B,KAAJ,gDAAwD2D,IAAxD,CAAN;AACH;;AAED/C,wBAAgB,CAACzB,GAAD,CAAhB,CAAsBwE,IAAtB,GAA6BA,IAA7B;;AACA,YAAInC,KAAJ,EAAW;AACPA,eAAK,CAAC+gB,YAAN,CAAmB,MAAnB,EAA2B5e,IAA3B;AACH;;AAEDi0B,kBAAU,GAAGj0B,IAAb;AACH,OAlBkB,CAAV;AAAA;AAnCN,GAAP;AAuDH;;AAEM,IAAMy0B,kBAAb;AAAA;AAAA;AAUI,8BAA2I;AAAA,QAA7HxM,IAA6H,SAA7HA,IAA6H;AAAA,QAAvHzsB,GAAuH,SAAvHA,GAAuH;AAAA,QAAlHk5B,gBAAkH,SAAlHA,gBAAkH;AAAA,SAR3InY,EAQ2I;AAAA,SAP3IoY,aAO2I,GAPpH,IAOoH;AAAA,SAN3ID,gBAM2I;AAAA,SAL3IE,YAK2I;AAAA,SAJ3IC,mBAI2I;AAAA,SAH3I5M,IAG2I;AAAA,SAF3IjoB,IAE2I;AACvI,SAAK60B,mBAAL,GAA2B,IAAIzuB,oBAAJ,EAA3B;AACA,SAAKsuB,gBAAL,GAAwBA,gBAAgB,IAAIX,mBAAmB,CAAC,KAAKc,mBAAN,EAA2B;AAAE5M,UAAI,EAAJA;AAAF,KAA3B,CAA/D;AACAqD,eAAW,CAAC,iBAAD,CAAX,CAA+B7f,GAA/B,CAAmC,KAAKoY,KAAL,EAAnC,EAAiD,IAAjD;;AACA,QAAIroB,GAAJ,EAAS;AACL,WAAKs5B,SAAL,CAAet5B,GAAf,EAAoB;AAAEysB,YAAI,EAAJA;AAAF,OAApB;AACH;AACJ;;AAjBL;;AAAA,SAmBIpE,KAnBJ,GAmBI,iBAAiB;AACb,WAAO,KAAK6Q,gBAAL,CAAsBnY,EAA7B;AACH,GArBL;;AAAA,SAuBI2X,OAvBJ,GAuBI,mBAAsD;AAClD,WAAO,KAAKQ,gBAAL,CAAsBR,OAAtB,EAAP;AACH,GAzBL;;AAAA,SA2BIpzB,OA3BJ,GA2BI,mBAAkC;AAC9B,WAAO,KAAKozB,OAAL,GAAe/uB,IAAf,CAAoB,UAAA+oB,IAAI,EAAI;AAC/B,aAAOA,IAAI,KAAK/yB,WAAW,CAACE,KAA5B;AACH,KAFM,CAAP;AAGH,GA/BL;;AAAA,SAiCIi5B,WAjCJ,GAiCI,qBAAYn4B,IAAZ,EAAuD;AAAA;;AACnD,WAAO,KAAKu4B,gBAAL,CAAsBJ,WAAtB,CAAkCn4B,IAAlC,EAAwCgJ,IAAxC,CAA6C;AAAA,aAAM,KAAN;AAAA,KAA7C,CAAP;AACH,GAnCL;;AAAA,SAqCIgvB,OArCJ,GAqCI,mBAAkC;AAC9B,WAAO,KAAKO,gBAAL,CAAsBP,OAAtB,EAAP;AACH,GAvCL;;AAAA,SAyCII,OAzCJ,GAyCI,iBAAQv0B,IAAR,EAAmD;AAAA;;AAC/C,WAAO,KAAK00B,gBAAL,CAAsBH,OAAtB,CAA8Bv0B,IAA9B,EAAoCmF,IAApC,CAAyC;AAAA,aAAM,MAAN;AAAA,KAAzC,CAAP;AACH,GA3CL;;AAAA,SA6CIT,KA7CJ,GA6CI,iBAAoC;AAAA;;AAChC,WAAO,KAAKgwB,gBAAL,CAAsBhwB,KAAtB,GAA8BS,IAA9B,CAAmC;AAAA,aAAM,MAAN;AAAA,KAAnC,CAAP;AACH,GA/CL;;AAAA,SAiDIivB,KAjDJ,GAiDI,iBAAoC;AAAA;;AAChC,QAAMW,cAAc,GAAG,KAAKj0B,OAAL,EAAvB;AACA,QAAMk0B,cAAc,GAAG,KAAKb,OAAL,EAAvB;AAEA,QAAMc,aAAa,GAAG7uB,oBAAY,CAAC+B,IAAb,CAAkB;AAAErH,aAAO,EAAEi0B,cAAX;AAA2B/0B,UAAI,EAAEg1B;AAAjC,KAAlB,EAAqE7vB,IAArE,CAA0E,iBAAuB;AAAA,UAApBrE,OAAoB,SAApBA,OAAoB;AAAA,UAAXd,IAAW,SAAXA,IAAW;;AACnH,UAAIc,OAAO,IAAId,IAAf,EAAqB;AACjBvE,cAAM,CAAC8hB,IAAP,CAAY,EAAZ,EAAgBvd,IAAhB;AACH;AACJ,KAJqB,CAAtB;AAKA,QAAMk1B,YAAY,GAAG,KAAKR,gBAAL,CAAsBN,KAAtB,EAArB;AAEA,WAAOhuB,oBAAY,CAAC2B,GAAb,CAAiB,CACpBktB,aADoB,EAEpBC,YAFoB,CAAjB,EAGJ/vB,IAHI,CAGC;AAAA,aAAM,MAAN;AAAA,KAHD,CAAP;AAIH,GAhEL;;AAAA,SAkEIkvB,QAlEJ,GAkEI,oBAAmC;AAC/B,WAAO,KAAKK,gBAAL,CAAsBL,QAAtB,EAAP;AACH,GApEL;;AAAA,SAsEIc,SAtEJ,GAsEI,qBAAqC;AACjC,WAAO,KAAKP,YAAZ;AACH,GAxEL;;AAAA,SA0EIE,SA1EJ,GA0EI,mBAAUt5B,GAAV,SAAuE;AAAA,QAA9BysB,IAA8B,SAA9BA,IAA8B;AACnE,SAAK2M,YAAL,GAAoBp5B,GAApB;AACA,SAAKq5B,mBAAL,CAAyB9uB,OAAzB,CAAiC,KAAK6uB,YAAtC;AACA,SAAKF,gBAAL,GAAwBX,mBAAmB,CAAC,KAAKc,mBAAN,EAA2B;AAAE5M,UAAI,EAAJA,IAAF;AAAQ1L,QAAE,EAAE,KAAKsH,KAAL;AAAZ,KAA3B,CAA3C;AACAkI,eAAW,CAAC,kBAAD,CAAX,CAAgCtgB,GAAhC,CAAoCjQ,GAApC,EAAyC,IAAzC;AACH,GA/EL;;AAAA,SAiFI45B,WAjFJ,GAiFI,uBAAoD;AAChD,WAAO,KAAKP,mBAAZ;AACH,GAnFL;;AAAA,SAqFIQ,WArFJ,GAqFI,qBAAY75B,GAAZ,SAAiG;AAAA;;AAAA,QAAtDysB,IAAsD,SAAtDA,IAAsD;AAC7F,WAAO7hB,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,UAAI,MAAI,CAACitB,YAAT,EAAuB;AACnB,eAAOp5B,GAAG,KAAK,MAAI,CAACo5B,YAApB;AACH;;AAED,aAAOxuB,oBAAY,CAAC+B,IAAb,CAAkB;AACrBmtB,uBAAe,EAAQ,MAAI,CAACpJ,aAAL,EADF;AAErBqJ,6BAAqB,EAAE5I,mBAAmB,CAACnxB,GAAD,EAAM;AAAEysB,cAAI,EAAJA;AAAF,SAAN;AAFrB,OAAlB,EAGJ9iB,IAHI,CAGC,iBAAgD;AAAA,YAA7CmwB,eAA6C,SAA7CA,eAA6C;AAAA,YAA5BC,qBAA4B,SAA5BA,qBAA4B;AACpD,YAAM7yB,KAAK,GAAG4yB,eAAe,KAAKC,qBAAlC;;AAEA,YAAI7yB,KAAJ,EAAW;AACP,gBAAI,CAACoyB,SAAL,CAAet5B,GAAf,EAAoB;AAAEysB,gBAAI,EAAJA;AAAF,WAApB;AACH;;AAED,eAAOvlB,KAAP;AACH,OAXM,CAAP;AAYH,KAjBM,CAAP;AAkBH,GAxGL;;AAAA,SA0GI8yB,MA1GJ,GA0GI,kBAA+C;AAC3C,WAAO,KAAKZ,YAAL,IAAqB,IAA5B;AACH,GA5GL;;AAAA,SA8GI1I,aA9GJ,GA8GI,yBAAuC;AACnC,WAAO,KAAKwI,gBAAL,CAAsBxI,aAAtB,EAAP;AACH,GAhHL;;AAAA,SAkHI4H,WAlHJ,GAkHI,uBAAwB;AACpB,WAAO/yB,OAAO,CAAC,KAAK6zB,YAAL,IAAqB11B,cAAc,CAAC,KAAK01B,YAAN,CAApC,CAAd;AACH,GApHL;;AAAA,SAsHI9E,SAtHJ,GAsHI,qBAAmC;AAC/B,WAAO,KAAK4E,gBAAZ;AACH,GAxHL;;AAAA,cA0HWc,MA1HX,GA0HI,gBAAch6B,GAAd,EAA+F;AAC3F,WAAOi5B,WAAW,CAACE,aAAZ,CAA0Bn5B,GAA1B,EACH;AADG,MAEDA,GAAG,CAACg6B,MAAJ,EAFC,GAGDh6B,GAHN;AAIH,GA/HL;;AAAA,cAiIWs0B,SAjIX,GAiII,mBAAiBt0B,GAAjB,SAAmH;AAAA,QAArDysB,IAAqD,SAArDA,IAAqD;AAC/G2L,uBAAmB;AACnB,WAAOa,WAAW,CAACgB,aAAZ,CAA0Bj6B,GAA1B,EAA+B;AAAEysB,UAAI,EAAJA;AAAF,KAA/B,EAAyC6H,SAAzC,EAAP;AACH,GApIL;;AAAA,cAsIWK,WAtIX,GAsII,qBAAmBuE,gBAAnB,SAA0G;AAAA,QAA5CzM,IAA4C,SAA5CA,IAA4C;AACtG2L,uBAAmB;AACnB,WAAOtI,WAAW,CAAC,iBAAD,CAAX,CAA+B5f,GAA/B,CAAmCgpB,gBAAgB,CAACnY,EAApD,KAA2D,IAAIkY,WAAJ,CAAgB;AAAEC,sBAAgB,EAAhBA,gBAAF;AAAoBzM,UAAI,EAAJA;AAApB,KAAhB,CAAlE;AACH,GAzIL;;AAAA,cA2IW0M,aA3IX,GA2II,uBAAqB3wB,GAArB,EAA0E;AACtE;AACA,WAAOjD,OAAO,CAACiD,GAAG,IAAI,CAACD,QAAQ,CAACC,GAAD,CAAhB,IAAyBA,GAAG,CAAC2wB,aAA9B,CAAd;AACH,GA9IL;;AAAA,cAgJWc,aAhJX,GAgJI,uBAAqBj6B,GAArB,SAA8G;AAAA,QAA5CysB,IAA4C,SAA5CA,IAA4C;AAC1G2L,uBAAmB;;AAEnB,QAAIa,WAAW,CAACE,aAAZ,CAA0Bn5B,GAA1B,CAAJ,EAAoC;AAChC;AACA,aAAOA,GAAP;AACH,KANyG,CAQ1G;;;AACA,QAAMo5B,YAAoC,GAAGp5B,GAA7C;AAEA,WAAOuwB,WAAW,CAAC,kBAAD,CAAX,CAAgCrgB,GAAhC,CAAoCkpB,YAApC,KAAqD,IAAIH,WAAJ,CAAgB;AAAEj5B,SAAG,EAAEo5B,YAAP;AAAqB3M,UAAI,EAAJA;AAArB,KAAhB,CAA5D;AACH,GA5JL;;AAAA;AAAA;AAiKO,SAASyN,eAAT,CAAyBC,WAAzB,EAA4En5B,MAA5E,EAAoGhB,GAApG,UAAoL;AAAA,MAAjDysB,IAAiD,UAAjDA,IAAiD;AACvL,SAAOgG,aAAa,CAAClD,kBAAkB,CAACG,mBAApB,EAAyCuJ,kBAAW,CAAC3E,SAAZ,CAAsBt0B,GAAtB,EAA2B;AAAEysB,QAAI,EAAJA;AAAF,GAA3B,CAAzC,CAApB;AACH;AAEM,SAAS2N,iBAAT,CAA2B3qB,MAA3B,EAAyE1I,MAAzE,EAA0F/G,GAA1F,UAAoK;AAAA,MAA5CysB,IAA4C,UAA5CA,IAA4C;AACvK,SAAOwM,kBAAW,CAACtE,WAAZ,CAAwB30B,GAAxB,EAA6B;AAAEysB,QAAI,EAAJA;AAAF,GAA7B,CAAP;AACH,C;;ACrQD;AACA;AACA;AACA;AAEA;AACA;AAGA;;AASA,SAAS4N,SAAT,CAAmBtZ,EAAnB,EAAgCvN,GAAhC,EAAgDhP,IAAhD,EAA+DiL,MAA/D,EAA6GzO,MAA7G,EAAqI;AACjI,MAAMs5B,WAAW,GAAG/J,WAAW,CAAC,aAAD,CAA/B;AACA,MAAMgK,kBAAkB,GAAGzK,WAAW,CAAC,oBAAD,CAAtC;;AAEA,MAAImJ,kBAAW,CAACE,aAAZ,CAA0B1pB,MAA1B,CAAJ,EAAuC;AACnC8qB,sBAAkB,CAACtqB,GAAnB,CAAuB8Q,EAAvB,EAA2B;AAAEvN,SAAG,EAAHA,GAAF;AAAOhP,UAAI,EAAJA,IAAP;AAAaxD,YAAM,EAANA,MAAb;AAAqByO,YAAM,EAANA;AAArB,KAA3B;AACH,GAFD,MAEO;AACH8qB,sBAAkB,CAACpK,GAAnB,CAAuBpP,EAAvB,EADG,CAEH;;AACA,QAAMyZ,OAAO,GAAGF,WAAW,CAACtpB,QAAZ,CAAqBvB,MAArB,EAA6B;AAAA,aAAO,EAAP;AAAA,KAA7B,CAAhB;AACA+qB,WAAO,CAACzZ,EAAD,CAAP,GAAc;AAAE/f,YAAM,EAANA,MAAF;AAAUwD,UAAI,EAAJA,IAAV;AAAgBgP,SAAG,EAAHA,GAAhB;AAAqB/D,YAAM,EAANA;AAArB,KAAd;AACH;AACJ;;AAED,SAASgrB,YAAT,CAAsBhrB,MAAtB,EAAsDsR,EAAtD,EAAmF;AAC/E,MAAMuZ,WAAW,GAAG/J,WAAW,CAAC,aAAD,CAA/B;AACA,MAAMgK,kBAAkB,GAAGzK,WAAW,CAAC,oBAAD,CAAtC;AACA,MAAM0K,OAAO,GAAGF,WAAW,CAACtpB,QAAZ,CAAqBvB,MAArB,EAA6B;AAAA,WAAO,EAAP;AAAA,GAA7B,CAAhB;AACA,SAAO+qB,OAAO,CAACzZ,EAAD,CAAP,IAAewZ,kBAAkB,CAACrqB,GAAnB,CAAuB6Q,EAAvB,CAAtB;AACH;;AAED,SAAS2Z,sBAAT,OAAkG;AAAA,MAAhEjiB,EAAgE,QAAhEA,EAAgE;AAAA,MAA5DgU,IAA4D,QAA5DA,IAA4D;AAC9F,SAAOqD,WAAW,CAAC,kBAAD,CAAX,CAAgC9e,QAAhC,CAAyC,eAAzC,EAA0D,YAAM;AACnE,WAAOyH,EAAE,CAACoW,YAAY,CAACC,MAAd,EAAsB;AAAE9tB,YAAM,EAAEtB,kBAAQA;AAAlB,KAAtB,EAA4C,iBAAmG;AAAA,UAAhG+P,MAAgG,SAAhGA,MAAgG;AAAA,UAAxF1I,MAAwF,SAAxFA,MAAwF;AAAA,UAAhFykB,IAAgF,SAAhFA,IAAgF;AAAA,UAC5IzK,EAD4I,GAC/HyK,IAD+H,CAC5IzK,EAD4I;AAAA,UACxIvc,IADwI,GAC/HgnB,IAD+H,CACxIhnB,IADwI;AAGpJ,UAAMm2B,IAAI,GAAGF,YAAY,CAAChrB,MAAD,EAASsR,EAAT,CAAzB;;AAEA,UAAI,CAAC4Z,IAAL,EAAW;AACP,cAAM,IAAI95B,KAAJ,6BAAqC2D,IAArC,mBAAyDgnB,IAAI,CAACzK,EAA9D,YAAyEhgB,SAAS,CAACd,MAAD,CAAlF,CAAN;AACH;;AAPmJ,UASpI26B,YAToI,GAStGD,IATsG,CAS5IlrB,MAT4I;AAAA,UAStHzO,MATsH,GAStG25B,IATsG,CAStH35B,MATsH;AAAA,UAS9GwS,GAT8G,GAStGmnB,IATsG,CAS9GnnB,GAT8G;AAWpJ,aAAO5I,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,YAAI,CAACtF,WAAW,CAAC7F,MAAD,EAAS+F,MAAT,CAAhB,EAAkC;AAC9B;AACA,gBAAM,IAAIlG,KAAJ,cAAsB2qB,IAAI,CAAChnB,IAA3B,iBAA6C2C,IAAI,CAACC,SAAL,CAAerI,YAAO,CAAC47B,IAAI,CAAC35B,MAAN,CAAP,GAAuB25B,IAAI,CAAC35B,MAAL,CAAYyO,MAAnC,GAA4CkrB,IAAI,CAAC35B,MAAhE,CAA7C,+BAAgJ+F,MAAhJ,YAA+JhG,SAAS,CAACd,MAAD,CAAxK,CAAN;AACH;;AAED,YAAIg5B,kBAAW,CAACE,aAAZ,CAA0ByB,YAA1B,CAAJ,EAA6C;AACzC;AACA,iBAAOA,YAAY,CAACf,WAAb,CAAyBpqB,MAAzB,EAAiC;AAAEgd,gBAAI,EAAJA;AAAF,WAAjC,EAA2C9iB,IAA3C,CAAgD,UAAAzC,KAAK,EAAI;AAC5D,gBAAI,CAACA,KAAL,EAAY;AACR,oBAAM,IAAIrG,KAAJ,mBAA2B2qB,IAAI,CAAChnB,IAAhC,yDAA0FzD,SAAS,CAACd,MAAD,CAAnG,CAAN;AACH;AACJ,WAJM,CAAP;AAKH;AACJ,OAdM,EAcJ0J,IAdI,CAcC,YAAM;AACV,eAAO6J,GAAG,CAACrG,KAAJ,CAAU;AAAEsC,gBAAM,EAANA,MAAF;AAAU1I,gBAAM,EAANA;AAAV,SAAV,EAA8BykB,IAAI,CAACte,IAAnC,CAAP;AACH,OAhBM,EAgBJ,UAAA3M,GAAG,EAAI;AACN,eAAOqK,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,cAAIqH,GAAG,CAAC1H,OAAR,EAAiB;AACb,mBAAO0H,GAAG,CAAC1H,OAAJ,CAAYvL,GAAZ,CAAP;AACH;AACJ,SAJM,EAIJoJ,IAJI,CAIC,YAAM;AACV;AACA,cAAIpJ,GAAG,CAAC6K,KAAR,EAAe;AACX;AACA7K,eAAG,CAAC6K,KAAJ,uBAA+B5G,IAA/B,cAA8CjE,GAAG,CAAC6K,KAAlD;AACH;;AAED,gBAAM7K,GAAN;AACH,SAZM,CAAP;AAaH,OA9BM,EA8BJoJ,IA9BI,CA8BC,UAAAhI,MAAM,EAAI;AACd,eAAO;AAAEA,gBAAM,EAANA,MAAF;AAAUof,YAAE,EAAFA,EAAV;AAAcvc,cAAI,EAAJA;AAAd,SAAP;AACH,OAhCM,CAAP;AAiCH,KA5CQ,CAAT;AA6CH,GA9CM,CAAP;AA+CH;;AAcM,SAAS8uB,0BAAT,CAA8B6G,WAA9B,EAAiFn5B,MAAjF,EAAyGwS,GAAzG,EAAwI1G,GAAxI,SAA4N;AAAA,MAApE2L,EAAoE,SAApEA,EAAoE;AAAA,MAAhEgU,IAAgE,SAAhEA,IAAgE;AAC/NiO,wBAAsB,CAAC;AAAEjiB,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA;AAAN,GAAD,CAAtB;AAEA,MAAM1L,EAAE,GAAGvN,GAAG,CAACqnB,MAAJ,IAActoB,QAAQ,EAAjC;AACA4nB,aAAW,GAAGlB,kBAAW,CAACe,MAAZ,CAAmBG,WAAnB,CAAd;AACA,MAAI31B,IAAI,GAAGgP,GAAG,CAACpC,QAAJ,IAAgBoC,GAAG,CAAChP,IAApB,IAA4BsI,GAAvC;;AAEA,MAAI,OAAOtI,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,IAAI,CAACtD,OAAZ,KAAwB,UAApD,IAAkEsD,IAAI,CAACtD,OAAL,CAAa,aAAb,MAAgC,CAAtG,EAAyG;AACrGsD,QAAI,GAAGA,IAAI,CAACwE,OAAL,CAAa,aAAb,EAAgC8D,GAAhC,QAAP;AACH;;AAED,MAAImsB,kBAAW,CAACE,aAAZ,CAA0BgB,WAA1B,CAAJ,EAA4C;AACxCE,aAAS,CAACtZ,EAAD,EAAKvN,GAAL,EAAUhP,IAAV,EAAgB21B,WAAhB,EAA6Bn5B,MAA7B,CAAT,CADwC,CAGxC;;AACAm5B,eAAW,CAACP,WAAZ,GAA0BjwB,IAA1B,CAA+B,UAAA3J,GAAG,EAAI;AAClCq6B,eAAS,CAACtZ,EAAD,EAAKvN,GAAL,EAAUhP,IAAV,EAAgBxE,GAAhB,EAAqBgB,MAArB,CAAT;AACH,KAFD;AAGH,GAPD,MAOO;AACHq5B,aAAS,CAACtZ,EAAD,EAAKvN,GAAL,EAAUhP,IAAV,EAAgB21B,WAAhB,EAA6Bn5B,MAA7B,CAAT;AACH;;AAED,SAAOyxB,aAAa,CAAClD,kBAAkB,CAACE,qBAApB,EAA2C;AAAE1O,MAAE,EAAFA,EAAF;AAAMvc,QAAI,EAAJA;AAAN,GAA3C,CAApB;AACH;AAEM,SAAS+uB,4BAAT,CAAgC9jB,MAAhC,EAA8E1I,MAA9E,gBAAqO;AAAA,MAApIga,EAAoI,SAApIA,EAAoI;AAAA,MAAhIvc,IAAgI,SAAhIA,IAAgI;AAAA,MAArFioB,IAAqF,SAArFA,IAAqF;;AACxO,MAAMqO,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACC,IAAD,EAAyB;AAAA,QAAxBA,IAAwB;AAAxBA,UAAwB,GAAP,EAAO;AAAA;;AACrD,aAASC,0BAAT,GAAmE;AAAA;AAC/D,UAAIC,aAAJ;;AAEA,UAAIjxB,KAAJ,EAAe,EAEd;;AAED,aAAOivB,kBAAW,CAACgB,aAAZ,CAA0BxqB,MAA1B,EAAkC;AAAEgd,YAAI,EAAJA;AAAF,OAAlC,EAA4CmN,WAA5C,GAA0DjwB,IAA1D,CAA+D,UAAA3J,GAAG,EAAI;AACzE,YAAM26B,IAAI,GAAGF,YAAY,CAACz6B,GAAD,EAAM+gB,EAAN,CAAzB;;AAEA,YAAI4Z,IAAI,IAAIA,IAAI,CAACnnB,GAAL,KAAawnB,0BAAzB,EAAqD;AACjD,iBAAOL,IAAI,CAACnnB,GAAL,CAASrG,KAAT,CAAe;AAAEsC,kBAAM,EAAExP,MAAV;AAAkB8G,kBAAM,EAAEhG,SAAS;AAAnC,WAAf,EAAwDyO,UAAxD,CAAP;AACH,SAFD,MAEO;AACH;AACA,cAAMkE,OAAO,GAAG;AAAE1S,kBAAM,EAAE+F,MAAV;AAAkBwvB,yBAAa,EAAEwE,IAAI,CAACxE;AAAtC,WAAhB;;AACA,cAAMrpB,KAAI,GAAGlG,KAAK,CAAC9H,SAAN,CAAgB0I,KAAhB,CAAsBxI,IAAtB,CAA2BoQ,UAA3B,CAAb;;AAEA,iBAAOid,IAAI,CAACzsB,GAAD,EAAM6uB,YAAY,CAACC,MAAnB,EAA2B;AAAE/N,cAAE,EAAFA,EAAF;AAAMvc,gBAAI,EAAJA,IAAN;AAAY0I,gBAAI,EAAJA;AAAZ,WAA3B,EAA+CwG,OAA/C,CAAJ,CACF/J,IADE,CACG,UAAA2B,GAAG,EAAI;AACT,gBAAI,CAACyvB,IAAI,CAACxE,aAAV,EAAyB;AACrB,qBAAOjrB,GAAG,CAACkgB,IAAJ,CAAS7pB,MAAhB;AACH;AACJ,WALE,CAAP;AAMH;AAEJ,OAlBM,EAkBJoK,KAlBI,CAkBE,UAAAxL,GAAG,EAAI;AACZ;AACA,YAAIyJ,KAAJ,EAA6C,EAG5C;;AACD,cAAMzJ,GAAN;AACH,OAzBM,CAAP;AA0BH;;AAEDy6B,8BAA0B,CAAC5pB,QAA3B,GAAsC5M,IAAtC;AACAw2B,8BAA0B,CAACE,UAA3B,GAAwCn0B,MAAxC;AACAi0B,8BAA0B,CAACG,UAA3B,GAAwC1rB,MAAxC;AACAurB,8BAA0B,CAACH,MAA3B,GAAoC9Z,EAApC;AAEAia,8BAA0B,CAACj0B,MAA3B,GAAoCA,MAApC;AAEA,WAAOi0B,0BAAP;AACH,GA5CD;;AA8CA,MAAMA,0BAA0B,GAAGF,uBAAuB,EAA1D;AACAE,4BAA0B,CAACzE,aAA3B,GAA2CuE,uBAAuB,CAAC;AAAEvE,iBAAa,EAAE;AAAjB,GAAD,CAAlE;AAEA,SAAOyE,0BAAP;AACH,C;;AChLD;AACA;AAEA;AAGA;AACA;AAMO,SAASpH,wBAAT,CAA0BuG,WAA1B,EAA6En5B,MAA7E,EAAqGwS,GAArG,EAAqH1G,GAArH,QAAwM;AAAA,MAAnE2L,EAAmE,QAAnEA,EAAmE;AAAA,MAA/DgU,IAA+D,QAA/DA,IAA+D;AAC3M,SAAOgG,aAAa,CAAClD,kBAAkB,CAACC,0BAApB,EAAgD;AAChE7lB,QAAI,EAAE2pB,0BAAiB,CAAC6G,WAAD,EAAcn5B,MAAd,EAAsB,UAACuJ,OAAD,EAAUgB,MAAV;AAAA,aAAqBiI,GAAG,CAAC7J,IAAJ,CAASY,OAAT,EAAkBgB,MAAlB,CAArB;AAAA,KAAtB,EAAsEuB,GAAtE,EAA2E;AAAE2L,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAA3E;AADyC,GAAhD,CAApB;AAGH;AAEM,SAASoH,0BAAT,CAA+BpkB,MAA/B,EAA6E1I,MAA7E,SAAgJ;AAAA,MAAhD4C,IAAgD,SAAhDA,IAAgD;AACnJ,SAAO,IAAIiB,oBAAJ,CAAiBjB,IAAjB,CAAP;AACH,C;;ACtBD;AACA;AAEA;AAGA;AACA;AACA;AAEO,SAASyxB,gBAAT,CAAqCjB,WAArC,EAAwFn5B,MAAxF,EAAgHwH,GAAhH,QAAmL;AAAA;;AAAA,MAAxDiQ,EAAwD,QAAxDA,EAAwD;AAAA,MAApDgU,IAAoD,QAApDA,IAAoD;AACtL,SAAO6H,SAAS,CAAC9rB,GAAD,+BACVkpB,IAAI,CAACE,OADK,IACO,UAACpe,GAAD,EAAiB1G,GAAjB;AAAA,WAAsD8mB,wBAAgB,CAACuG,WAAD,EAAcn5B,MAAd,EAAsBwS,GAAtB,EAA2B1G,GAA3B,EAAgC;AAAE2L,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAAhC,CAAtE;AAAA,GADP,aAEViF,IAAI,CAACC,QAFK,IAEO,UAACne,GAAD,EAAiB1G,GAAjB;AAAA,WAAuDwmB,0BAAiB,CAAC6G,WAAD,EAAcn5B,MAAd,EAAsBwS,GAAtB,EAA2B1G,GAA3B,EAAgC;AAAE2L,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAAhC,CAAxE;AAAA,GAFP,aAGViF,IAAI,CAACM,MAHK,IAGO,UAACxe,GAAD,EAA6D;AAC5E,WAAQjL,QAAQ,CAACiL,GAAD,CAAR,IAAiBylB,kBAAW,CAACE,aAAZ,CAA0B3lB,GAA1B,CAAlB,GAAoD0mB,eAAe,CAACC,WAAD,EAAcn5B,MAAd,EAAsBwS,GAAtB,EAA2B;AAAEiF,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAA3B,CAAnE,GAA8GjZ,GAArH;AACH,GALW,cAAhB;AAOH;AAEM,SAAS6nB,kBAAT,CAAuC5rB,MAAvC,EAAqF1I,MAArF,EAAsGlD,OAAtG,SAA6K;AAAA;;AAAA,MAAnD4U,EAAmD,SAAnDA,EAAmD;AAAA,MAA/CgU,IAA+C,SAA/CA,IAA+C;AAChL,SAAOkI,uBAAW,CAAC9wB,OAAD,mCACZ0rB,kBAAkB,CAACC,0BADP,IACqC,UAAC8L,iBAAD;AAAA,WAAwBzH,0BAAkB,CAACpkB,MAAD,EAAS1I,MAAT,EAAiBu0B,iBAAjB,CAA1C;AAAA,GADrC,eAEZ/L,kBAAkB,CAACE,qBAFP,IAEqC,UAAC8L,kBAAD;AAAA,WAAwBhI,4BAAmB,CAAC9jB,MAAD,EAAS1I,MAAT,EAAiBw0B,kBAAjB,EAAqC;AAAE9iB,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAArC,CAA3C;AAAA,GAFrC,eAGZ8C,kBAAkB,CAACG,mBAHP,IAGqC,UAACwJ,gBAAD;AAAA,WAAwBkB,iBAAiB,CAAC3qB,MAAD,EAAS1I,MAAT,EAAiBmyB,gBAAjB,EAAmC;AAAEzM,UAAI,EAAJA;AAAF,KAAnC,CAAzC;AAAA,GAHrC,gBAAlB;AAKH,C;;AC1BD;AACA;AACA;;;ACFA;AAGA;AACA;AACA;AACA;AAEO,IAAM+O,uBAAuB,GAAG,EAAhC;;AAEPA,uBAAuB,CAACvM,aAAa,CAACC,YAAf,CAAvB,GAAsD,UAAClvB,GAAD,EAA8By7B,iBAA9B,EAA0Dz6B,MAA1D,EAAqF;AAEvI,MAAIotB,KAAJ,EAAc,EAIb;;AAED,MAAIsN,OAAJ;;AAEA,MAAI10B,KAAK,CAACC,OAAN,CAAcjG,MAAd,CAAJ,EAA2B;AACvB06B,WAAO,GAAG16B,MAAV;AACH,GAFD,MAEO,IAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AACnC06B,WAAO,GAAG,CAAE16B,MAAF,CAAV;AACH,GAFM,MAEA;AACH06B,WAAO,GAAG,CAAEh8B,kBAAF,CAAV;AACH;;AAEDg8B,SAAO,GAAGA,OAAO,CAAC7uB,GAAR,CAAY,UAAA8uB,GAAG,EAAI;AAEzB,QAAIvN,KAAJ,EAAc,qBAqBb;;AAED,QAAIuN,GAAG,CAACz6B,OAAJ,CAAY5B,QAAQ,CAACE,IAArB,MAA+B,CAAnC,EAAsC;AAClC,aAAOE,kBAAP;AACH;;AAED,WAAOi8B,GAAP;AACH,GA9BS,CAAV;AAgCAD,SAAO,CAACE,OAAR,CAAgB,UAAAD,GAAG,EAAI;AACnB37B,OAAG,CAAC67B,WAAJ,CAAgBJ,iBAAhB,EAAmCE,GAAnC;AACH,GAFD;AAGH,CArDD;;AAuDA,IAAIhM,IAAJ,EAAyC;AAErC6L,yBAAuB,CAACvM,aAAa,CAACE,MAAf,CAAvB,GAAgD,UAACnvB,GAAD,EAA8By7B,iBAA9B,EAA0Dz6B,MAA1D,EAA8E;AAE1H,QAAI,CAACu0B,qBAAqB,EAAtB,IAA4B,CAACM,QAAQ,EAAzC,EAA6C;AACzC,YAAM,IAAIh1B,KAAJ,iCAAN;AACH;;AAED,QAAIW,YAAY,CAACxB,GAAD,CAAhB,EAAuB;AACnB,YAAM,IAAIa,KAAJ,oEAAN;AACH;;AAED,QAAIuF,eAAe,CAACnG,MAAD,EAASD,GAAT,CAAf,KAAiC,KAArC,EAA4C;AACxC,YAAM,IAAIa,KAAJ,wFAAN;AACH;;AAED41B,qBAAiB,CAACz2B,GAAD,EAAMgB,MAAN,EAAcy6B,iBAAd,CAAjB;AACH,GAfD;AAgBH;;AAED,IAAI9L,IAAJ,EAAsF;AAElF6L,yBAAuB,CAACvM,aAAa,CAACG,MAAf,CAAvB,GAAgD,UAACpvB,GAAD,EAA8By7B,iBAA9B,EAA6D;AAEzG,QAAI,CAACnK,8BAA8B,EAAnC,EAAuC;AACnC,YAAM,IAAIzwB,KAAJ,2CAAN;AACH;;AAED,QAAI,CAACW,YAAY,CAACxB,GAAD,CAAjB,EAAwB;AACpB,YAAM,IAAIa,KAAJ,yEAAN;AACH;;AAED,QAAIuF,eAAe,CAACnG,MAAD,EAASD,GAAT,CAAf,KAAiC,KAArC,EAA4C;AACxC,YAAM,IAAIa,KAAJ,wFAAN;AACH,KAZwG,CAczG;;;AACA,QAAMi7B,aAAa,GAAG9oB,gBAAS,CAAChT,GAAD,CAA/B;;AAEA,QAAI,CAAC87B,aAAL,EAAoB;AAChB,YAAM,IAAIj7B,KAAJ,mDAAN;AACH;;AAEDi7B,iBAAa,CAAChF,cAAd,CAA6B;AACzBrnB,YAAM,EAAExP,MADiB;AAEzB8G,YAAM,EAAEhG,SAAS,EAFQ;AAGzByqB,UAAI,EAAIiQ;AAHiB,KAA7B;AAKH,GA1BD;AA2BH,C;;;AClHD;AACA;AAEA;AAIA;AAEO,SAAStG,gBAAT,CAAqBn1B,GAArB,EAAkDgB,MAAlD,EAA0E6C,OAA1E,QAA8I;AAAA;;AAAA,MAA/C4U,EAA+C,QAA/CA,EAA+C;AAAA,MAA3CgU,IAA2C,QAA3CA,IAA2C;;AACjJ,MAAI/oB,cAAc,CAAC1D,GAAD,CAAlB,EAAyB;AACrB,UAAM,IAAIa,KAAJ,CAAU,kBAAV,CAAN;AACH;;AAED,MAAM46B,iBAAiB,GAAGL,gBAAgB,CAACp7B,GAAD,EAAMgB,MAAN,6CACpC2uB,wBADoC;AAElC5O,MAAE,EAAMxO,QAAQ,EAFkB;AAGlCxL,UAAM,EAAEhG,SAAS,CAACd,MAAD;AAHiB,KAI/B4D,OAJ+B,uBAMvC;AAAE4U,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA;AAAN,GANuC,CAA1C;AAQA,MAAMsP,UAAU,GAAG98B,MAAM,CAAC2N,IAAP,CAAY4uB,uBAAZ,CAAnB;AACA,MAAMQ,MAAM,GAAG,EAAf;;AAdiJ,0BAgBtHD,UAhBsH,gBAgB1G;AAAlC,QAAME,YAAY,GAAIF,UAAJ,KAAlB;;AACD,QAAI;AACAP,6BAAuB,CAACS,YAAD,CAAvB,CAAsCj8B,GAAtC,EAA2Cy7B,iBAA3C,EAA8Dz6B,MAA9D;AACH,KAFD,CAEE,OAAOT,GAAP,EAAY;AACVy7B,YAAM,CAACp6B,IAAP,CAAYrB,GAAZ;AACH;AACJ;;AAED,MAAIy7B,MAAM,CAAC75B,MAAP,KAAkB45B,UAAU,CAAC55B,MAAjC,EAAyC;AACrC,UAAM,IAAItB,KAAJ,qDAA6Dm7B,MAAM,CAACnvB,GAAP,CAAW,UAACtM,GAAD,EAAM6B,CAAN;AAAA,aAAgBA,CAAhB,UAAwBkT,cAAc,CAAC/U,GAAD,CAAtC;AAAA,KAAX,EAA2DiH,IAA3D,CAAgE,MAAhE,CAA7D,CAAN;AACH;AACJ,C;;ACnCD;AACA;AAEA;AACA;AAEO,SAAS00B,cAAT,GAA0B;AAC7B,MAAMC,iBAAiB,GAAGrM,WAAW,CAAC,mBAAD,CAArC;AACA,MAAMsM,wBAAwB,GAAGtM,WAAW,CAAC,0BAAD,CAA5C;AACAqM,mBAAiB,CAACloB,KAAlB;AACAmoB,0BAAwB,CAACnoB,KAAzB;AACH;AAED,IAAMooB,gBAAgB,GAAG,kBAAzB;AAmBO,SAASC,mBAAT,CAA6B3vB,IAA7B,EAA4CkM,QAA5C,EAA6E;AAChF,MAAMsjB,iBAAiB,GAAGrM,WAAW,CAAC,mBAAD,CAArC;AACAqM,mBAAiB,CAAClsB,GAAlB,CAAsBtD,IAAtB,EAA4BkM,QAA5B;AACH;AAEM,SAAS0jB,mBAAT,CAA6B5vB,IAA7B,EAAoE;AACvE,MAAMwvB,iBAAiB,GAAGrM,WAAW,CAAC,mBAAD,CAArC;AACA,SAAOqM,iBAAiB,CAACjsB,GAAlB,CAAsBvD,IAAtB,CAAP;AACH;AAEM,SAAS6vB,sBAAT,CAAgC7vB,IAAhC,EAA+C;AAClD,MAAMwvB,iBAAiB,GAAGrM,WAAW,CAAC,mBAAD,CAArC;AACAqM,mBAAiB,CAAChM,GAAlB,CAAsBxjB,IAAtB;AACH;AAEM,SAAS8vB,uBAAT,GAAmC;AACtC,MAAMN,iBAAiB,GAAGrM,WAAW,CAAC,mBAAD,CAArC;;AADsC,6CAEnBqM,iBAAiB,CAACvvB,IAAlB,EAFmB,8CAEO;AAAxC,QAAMD,IAAI,8BAAV;AACD,QAAMkM,QAAQ,GAAGsjB,iBAAiB,CAACjsB,GAAlB,CAAsBvD,IAAtB,CAAjB;;AACA,QAAIkM,QAAJ,EAAc;AACVA,cAAQ,CAACD,SAAT,GAAqB,IAArB;AACH;;AACDujB,qBAAiB,CAAChM,GAAlB,CAAsBxjB,IAAtB;AACH;AACJ;AAEM,SAAS+vB,2BAAT,CAAqC/vB,IAArC,EAAoD;AACvD,MAAMyvB,wBAAwB,GAAGtM,WAAW,CAAC,0BAAD,CAA5C;AACAsM,0BAAwB,CAACnsB,GAAzB,CAA6BtD,IAA7B,EAAmC,IAAnC;AACH;AAEM,SAASgwB,yBAAT,CAAmChwB,IAAnC,EAA4D;AAC/D,MAAMyvB,wBAAwB,GAAGtM,WAAW,CAAC,0BAAD,CAA5C;AACA,SAAOsM,wBAAwB,CAACrrB,GAAzB,CAA6BpE,IAA7B,CAAP;AACH;AAEM,SAASiwB,kBAAT,OAAsK;AAAA,MAAxIp4B,IAAwI,QAAxIA,IAAwI;AAAA,MAAlIxE,GAAkI,QAAlIA,GAAkI;AAAA,MAA7HgB,MAA6H,QAA7HA,MAA6H;AACzK,MAAM67B,gBAAgB,GAAGtM,WAAW,CAAC,kBAAD,CAApC;;AAEA,MAAIvwB,GAAG,KAAKN,kBAAZ,EAAsB;AAClBM,OAAG,GAAG,IAAN;AACH;;AAED,MAAIgB,MAAM,KAAKtB,kBAAf,EAAyB;AACrBsB,UAAM,GAAG,IAAT;AACH;;AAED,MAAI,CAACwD,IAAL,EAAW;AACP,UAAM,IAAI3D,KAAJ,yCAAN;AACH;;AAbwK,4BAe9I,CAAEb,GAAF,EAAOqwB,WAAW,EAAlB,CAf8I,6BAetH;AAA9C,QAAMyM,YAAY,aAAlB;;AACD,QAAI,CAACA,YAAL,EAAmB;AACf;AACH;;AAED,QAAMC,aAAa,GAAGF,gBAAgB,CAAC3sB,GAAjB,CAAqB4sB,YAArB,CAAtB;;AAEA,QAAI,CAACC,aAAL,EAAoB;AAChB;AACH;;AAED,QAAMC,eAAe,GAAGD,aAAa,CAACv4B,IAAD,CAArC;;AAEA,QAAI,CAACw4B,eAAL,EAAsB;AAClB;AACH;;AAED,QAAIh8B,MAAM,IAAI,OAAOA,MAAP,KAAkB,QAAhC,EAA0C;AACtC,UAAIg8B,eAAe,CAACh8B,MAAD,CAAnB,EAA6B;AACzB,eAAOg8B,eAAe,CAACh8B,MAAD,CAAtB;AACH;;AAED,UAAIg8B,eAAe,CAACX,gBAAD,CAAnB,EAAuC;AAAA,mDACDW,eAAe,CAACX,gBAAD,CADd,8CACkC;AAAA;AAAA,cAAxD9hB,KAAwD,0BAAxDA,KAAwD;AAAA,cAAjD1B,QAAiD,0BAAjDA,QAAiD;;AACjE,cAAIhS,WAAW,CAAC0T,KAAD,EAAQvZ,MAAR,CAAf,EAAgC;AAC5B,mBAAO6X,QAAP;AACH;AACJ;AACJ;AACJ;;AAED,QAAImkB,eAAe,CAACt9B,kBAAD,CAAnB,EAA+B;AAC3B,aAAOs9B,eAAe,CAACt9B,kBAAD,CAAtB;AACH;AACJ;AACJ;AAEM,SAASu9B,kBAAT,QAA2IpkB,QAA3I,EAAqM;AAAA,MAAvKrU,IAAuK,SAAvKA,IAAuK;AAAA,MAAjKxE,GAAiK,SAAjKA,GAAiK;AAAA,MAA5JgB,MAA4J,SAA5JA,MAA4J;AACxM,MAAM67B,gBAAgB,GAAGtM,WAAW,CAAC,kBAAD,CAApC;;AAEA,MAAI,CAAC/rB,IAAD,IAAS,OAAOA,IAAP,KAAgB,QAA7B,EAAuC;AACnC,UAAM,IAAI3D,KAAJ,yCAAN;AACH;;AAED,MAAImG,KAAK,CAACC,OAAN,CAAcjH,GAAd,CAAJ,EAAwB;AACpB,QAAMk9B,mBAAmB,GAAG,EAA5B;;AADoB,8BAGDl9B,GAHC,6BAGI;AAAnB,UAAMhB,IAAI,aAAV;AACDk+B,yBAAmB,CAACt7B,IAApB,CAAyBq7B,kBAAkB,CAAC;AAAEz4B,YAAI,EAAJA,IAAF;AAAQxD,cAAM,EAANA,MAAR;AAAgBhB,WAAG,EAAEhB;AAArB,OAAD,EAA8B6Z,QAA9B,CAA3C;AACH;;AAED,WAAO;AACHvQ,YADG,oBACM;AAAA,kCACwB40B,mBADxB,iBAC6C;AAA7C,cAAMC,cAAc,GAAID,mBAAJ,MAApB;AACDC,wBAAc,CAAC70B,MAAf;AACH;AACJ;AALE,KAAP;AAOH;;AAED,MAAItB,KAAK,CAACC,OAAN,CAAcjG,MAAd,CAAJ,EAA2B;AACvB,QAAMk8B,oBAAmB,GAAG,EAA5B;;AADuB,kCAGJl8B,MAHI,kCAGI;AAAtB,UAAMhC,KAAI,iBAAV;;AACDk+B,0BAAmB,CAACt7B,IAApB,CAAyBq7B,kBAAkB,CAAC;AAAEz4B,YAAI,EAAJA,IAAF;AAAQxE,WAAG,EAAHA,GAAR;AAAagB,cAAM,EAAEhC;AAArB,OAAD,EAA8B6Z,QAA9B,CAA3C;AACH;;AAED,WAAO;AACHvQ,YADG,oBACM;AAAA,kCACwB40B,oBADxB,iBAC6C;AAA7C,cAAMC,cAAc,GAAID,oBAAJ,MAApB;AACDC,wBAAc,CAAC70B,MAAf;AACH;AACJ;AALE,KAAP;AAOH;;AAED,MAAM80B,gBAAgB,GAAGR,kBAAkB,CAAC;AAAEp4B,QAAI,EAAJA,IAAF;AAAQxE,OAAG,EAAHA,GAAR;AAAagB,UAAM,EAANA;AAAb,GAAD,CAA3C;;AAEA,MAAI,CAAChB,GAAD,IAAQA,GAAG,KAAKN,kBAApB,EAA8B;AAC1BM,OAAG,GAAGqwB,WAAW,EAAjB;AACH;;AAEDrvB,QAAM,GAAGA,MAAM,IAAItB,kBAAnB;;AAEA,MAAI09B,gBAAJ,EAAsB;AAClB,QAAIp9B,GAAG,IAAIgB,MAAX,EAAmB;AACf,YAAM,IAAIH,KAAJ,0CAAkD2D,IAAlD,mBAAsExD,MAAM,CAAC7B,QAAP,EAAtE,cAAiGa,GAAG,KAAKqwB,WAAW,EAAnB,GAAwB,UAAxB,GAAqC,WAAtI,cAAN;AACH,KAFD,MAEO,IAAIrwB,GAAJ,EAAS;AACZ,YAAM,IAAIa,KAAJ,0CAAkD2D,IAAlD,cAAgExE,GAAG,KAAKqwB,WAAW,EAAnB,GAAwB,UAAxB,GAAqC,WAArG,cAAN;AACH,KAFM,MAEA,IAAIrvB,MAAJ,EAAY;AACf,YAAM,IAAIH,KAAJ,0CAAkD2D,IAAlD,mBAAsExD,MAAM,CAAC7B,QAAP,EAAtE,CAAN;AACH,KAFM,MAEA;AACH,YAAM,IAAI0B,KAAJ,0CAAkD2D,IAAlD,CAAN;AACH;AACJ;;AAED,MAAMu4B,aAAa,GAAGF,gBAAgB,CAAC7rB,QAAjB,CAA0BhR,GAA1B,EAA+B;AAAA,WAAO,EAAP;AAAA,GAA/B,CAAtB;AACA,MAAMg9B,eAAe,GAAGhsB,aAAQ,CAAC+rB,aAAD,EAAgBv4B,IAAhB,EAAsB;AAAA,WAAO,EAAP;AAAA,GAAtB,CAAhC;AAEA,MAAM64B,SAAS,GAAGr8B,MAAM,CAAC7B,QAAP,EAAlB;AAEA,MAAIm+B,cAAJ;AACA,MAAIC,aAAJ;;AAEA,MAAIx+B,YAAO,CAACiC,MAAD,CAAX,EAAqB;AACjBs8B,kBAAc,GAAGtsB,aAAQ,CAACgsB,eAAD,EAAkBX,gBAAlB,EAAoC;AAAA,aAAM,EAAN;AAAA,KAApC,CAAzB;AACAkB,iBAAa,GAAG;AAAEhjB,WAAK,EAAEvZ,MAAT;AAAiB6X,cAAQ,EAARA;AAAjB,KAAhB;AACAykB,kBAAc,CAAC17B,IAAf,CAAoB27B,aAApB;AACH,GAJD,MAIO;AACHP,mBAAe,CAACK,SAAD,CAAf,GAA6BxkB,QAA7B;AACH;;AAED,SAAO;AACHvQ,UADG,oBACM;AACL,aAAO00B,eAAe,CAACK,SAAD,CAAtB;;AAEA,UAAIE,aAAJ,EAAmB;AACfD,sBAAc,CAACr5B,MAAf,CAAsBq5B,cAAc,CAACp8B,OAAf,CAAuBq8B,aAAvB,EAAsC,CAAtC,CAAtB;;AAEA,YAAI,CAACD,cAAc,CAACn7B,MAApB,EAA4B;AACxB,iBAAO66B,eAAe,CAACX,gBAAD,CAAtB;AACH;AACJ;;AAED,UAAI,CAACp9B,MAAM,CAAC2N,IAAP,CAAYowB,eAAZ,EAA6B76B,MAAlC,EAA0C;AACtC,eAAO46B,aAAa,CAACv4B,IAAD,CAApB;AACH;;AAED,UAAIxE,GAAG,IAAI,CAACf,MAAM,CAAC2N,IAAP,CAAYmwB,aAAZ,EAA2B56B,MAAvC,EAA+C;AAC3C06B,wBAAgB,CAAC1M,GAAjB,CAAqBnwB,GAArB;AACH;AACJ;AAnBE,GAAP;AAqBH,C;;;;;;ACzND;AACA;AACA;AAEA;AACA;AACA;AAIO,IAAMw9B,qBAAqB,sDAE5BlP,YAAY,CAACC,OAFe,cAEL9e,MAFK,EAE2B1I,MAF3B,EAE4ClD,OAF5C,QAE4I;AAAA,MAApE4U,EAAoE,QAApEA,EAAoE;AAAA,MAAhEgU,IAAgE,QAAhEA,IAAgE;AAEtK,MAAM/Y,OAAO,GAAGkpB,kBAAkB,CAAC;AAAEp4B,QAAI,EAAEX,OAAO,CAACW,IAAhB;AAAsBxE,OAAG,EAAEyP,MAA3B;AAAmCzO,UAAM,EAAE+F;AAA3C,GAAD,CAAlC;AAEA,MAAM02B,OAAO,GAAI55B,OAAO,CAACW,IAAR,KAAiBqqB,YAAY,CAACC,MAA9B,IAAwCjrB,OAAO,CAAC2nB,IAAhD,IAAwD,OAAO3nB,OAAO,CAAC2nB,IAAR,CAAahnB,IAApB,KAA6B,QAAtF,GAAsGX,OAAO,CAAC2nB,IAAR,CAAahnB,IAAnH,UAA+HX,OAAO,CAACW,IAAvJ;;AAEA,MAAIwF,KAAJ,EAAe,EAGd;;AAED,WAAS0zB,YAAT,CAAsBhL,IAAtB,EAA2DiL,GAA3D,EAA+FC,QAA/F,EAA8G;AAAA,QAAfA,QAAe;AAAfA,cAAe,GAAJ,EAAI;AAAA;;AAE1G,QAAI/5B,OAAO,CAAC0yB,aAAR,IAAyB7yB,cAAc,CAAC+L,MAAD,CAA3C,EAAqD;AACjD;AACH;;AAED,QAAIzF,KAAJ,EAA4C,EAQ3C;;AAED,QAAI;AACA;AACAmrB,sBAAW,CAAC1lB,MAAD,EAAS1I,MAAT;AACP2rB,YAAI,EAAJA,IADO;AAEPiL,WAAG,EAAHA,GAFO;AAGPhxB,YAAI,EAAI9I,OAAO,CAAC8I,IAHT;AAIPnI,YAAI,EAAIX,OAAO,CAACW;AAJT,SAKJo5B,QALI,GAMR;AAAEnlB,UAAE,EAAFA,EAAF;AAAMgU,YAAI,EAAJA;AAAN,OANQ,CAAX;AAOH,KATD,CASE,OAAOlsB,GAAP,EAAY;AACV,YAAM,IAAIM,KAAJ,uCAA+C48B,OAA/C,YAA+D18B,SAAS,EAAxE,YAAmFuU,cAAc,CAAC/U,GAAD,CAAjG,CAAN;AACH;AACJ;;AAED,SAAOqK,oBAAY,CAAC2B,GAAb,CAAiB,CAEpBmxB,YAAY,CAACpP,YAAY,CAACG,GAAd,CAFQ,EAIpB7jB,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAEnB,QAAI,CAACuH,OAAL,EAAc;AACV,YAAM,IAAI7S,KAAJ,yCAAiDgD,OAAO,CAACW,IAAzD,cAAwEuC,MAAxE,YAAuF9G,MAAM,CAACC,QAAP,CAAgBC,QAAvG,UAAsHF,MAAM,CAACC,QAAP,CAAgBY,IAAtI,GAA+Ib,MAAM,CAACC,QAAP,CAAgB29B,QAA/J,CAAN;AACH;;AAED,QAAI,CAACh3B,WAAW,CAAC6M,OAAO,CAAC1S,MAAT,EAAiB+F,MAAjB,CAAhB,EAA0C;AACtC,YAAM,IAAIlG,KAAJ,qBAA6BkG,MAA7B,+BAA+D2M,OAAO,CAAC1S,MAAR,CAAe7B,QAAf,EAA/D,CAAN;AACH;;AAED,QAAMqsB,IAAI,GAAG3nB,OAAO,CAAC2nB,IAArB;AAEA,WAAO9X,OAAO,CAACvJ,OAAR,CAAgB;AAAEsF,YAAM,EAANA,MAAF;AAAU1I,YAAM,EAANA,MAAV;AAAkBykB,UAAI,EAAJA;AAAlB,KAAhB,CAAP;AAEH,GAdD,EAcG7hB,IAdH,CAcQ,UAAA6hB,IAAI,EAAI;AACZ,WAAOkS,YAAY,CAACpP,YAAY,CAACE,QAAd,EAAwBE,WAAW,CAACC,OAApC,EAA6C;AAAEnD,UAAI,EAAJA;AAAF,KAA7C,CAAnB;AAEH,GAjBD,EAiBG,UAAAvgB,KAAK,EAAI;AACR,WAAOyyB,YAAY,CAACpP,YAAY,CAACE,QAAd,EAAwBE,WAAW,CAACE,KAApC,EAA2C;AAAE3jB,WAAK,EAALA;AAAF,KAA3C,CAAnB;AACH,GAnBD,CAJoB,CAAjB,EAyBJtB,IAzBI,CAyBCtK,aAzBD,EAyBO0M,KAzBP,CAyBa,UAAAxL,GAAG,EAAI;AACvB,QAAImT,OAAO,IAAIA,OAAO,CAACoqB,WAAvB,EAAoC;AAChC,aAAOpqB,OAAO,CAACoqB,WAAR,CAAoBv9B,GAApB,CAAP;AACH,KAFD,MAEO;AACH,YAAMA,GAAN;AACH;AACJ,GA/BM,CAAP;AAgCH,CA3E6B,wBA6E5B+tB,YAAY,CAACG,GA7Ee,cA6EThf,MA7ES,EA6EuB1I,MA7EvB,EA6EwClD,OA7ExC,EA6EsE;AAEhG,MAAI84B,yBAAyB,CAAC94B,OAAO,CAAC8I,IAAT,CAA7B,EAA6C;AACzC;AACH;;AAED,MAAM+G,OAAO,GAAG6oB,mBAAmB,CAAC14B,OAAO,CAAC8I,IAAT,CAAnC;;AAEA,MAAI,CAAC+G,OAAL,EAAc;AACV,UAAM,IAAI7S,KAAJ,yDAAiEgD,OAAO,CAACW,IAAzE,cAAwFuC,MAAxF,YAAuG9G,MAAM,CAACC,QAAP,CAAgBC,QAAvH,UAAsIF,MAAM,CAACC,QAAP,CAAgBY,IAAtJ,GAA+Jb,MAAM,CAACC,QAAP,CAAgB29B,QAA/K,CAAN;AACH;;AAED,MAAI;AACA,QAAI,CAACh3B,WAAW,CAAC6M,OAAO,CAAC1S,MAAT,EAAiB+F,MAAjB,CAAhB,EAA0C;AACtC,YAAM,IAAIlG,KAAJ,iBAAyBkG,MAAzB,+BAA2D2M,OAAO,CAAC1S,MAAR,CAAe7B,QAAf,EAA3D,CAAN;AACH;;AAED,QAAIsQ,MAAM,KAAKiE,OAAO,CAAC1T,GAAvB,EAA4B;AACxB,YAAM,IAAIa,KAAJ,+CAAN;AACH;AACJ,GARD,CAQE,OAAON,GAAP,EAAY;AACVmT,WAAO,CAAC3J,OAAR,CAAgBwB,MAAhB,CAAuBhL,GAAvB;AACH;;AAEDmT,SAAO,CAACiqB,GAAR,GAAc,IAAd;AACH,CAtG6B,wBAwG5BrP,YAAY,CAACE,QAxGe,cAwGJ/e,MAxGI,EAwG4B1I,MAxG5B,EAwG6ClD,OAxG7C,EAwGkI;AAE5J,MAAI84B,yBAAyB,CAAC94B,OAAO,CAAC8I,IAAT,CAA7B,EAA6C;AACzC;AACH;;AAED,MAAM+G,OAAO,GAAG6oB,mBAAmB,CAAC14B,OAAO,CAAC8I,IAAT,CAAnC;;AAEA,MAAI,CAAC+G,OAAL,EAAc;AACV,UAAM,IAAI7S,KAAJ,8DAAsEgD,OAAO,CAACW,IAA9E,cAA6FuC,MAA7F,YAA4G9G,MAAM,CAACC,QAAP,CAAgBC,QAA5H,UAA2IF,MAAM,CAACC,QAAP,CAAgBY,IAA3J,GAAoKb,MAAM,CAACC,QAAP,CAAgB29B,QAApL,CAAN;AACH;;AAED,MAAI,CAACh3B,WAAW,CAAC6M,OAAO,CAAC1S,MAAT,EAAiB+F,MAAjB,CAAhB,EAA0C;AACtC,UAAM,IAAIlG,KAAJ,sBAA8BkG,MAA9B,+BAAgEQ,sBAAsB,CAACmM,OAAO,CAAC1S,MAAT,CAAtF,CAAN;AACH;;AAED,MAAIyO,MAAM,KAAKiE,OAAO,CAAC1T,GAAvB,EAA4B;AACxB,UAAM,IAAIa,KAAJ,oDAAN;AACH;;AAED27B,wBAAsB,CAAC34B,OAAO,CAAC8I,IAAT,CAAtB;AAEA,MAAM8wB,OAAO,GAAI55B,OAAO,CAACW,IAAR,KAAiBqqB,YAAY,CAACC,MAA9B,IAAwCjrB,OAAO,CAAC2nB,IAAhD,IAAwD,OAAO3nB,OAAO,CAAC2nB,IAAR,CAAahnB,IAApB,KAA6B,QAAtF,GAAsGX,OAAO,CAAC2nB,IAAR,CAAahnB,IAAnH,UAA+HX,OAAO,CAACW,IAAvJ;;AAEA,MAAIX,OAAO,CAAC85B,GAAR,KAAgBjP,WAAW,CAACE,KAAhC,EAAuC;AACnC,QAAI5kB,KAAJ,EAAe,EAEd;;AAED0J,WAAO,CAAC3J,OAAR,CAAgBwB,MAAhB,CAAuB1H,OAAO,CAACoH,KAA/B;AAEH,GAPD,MAOO,IAAIpH,OAAO,CAAC85B,GAAR,KAAgBjP,WAAW,CAACC,OAAhC,EAAyC;AAC5C,QAAI3kB,KAAJ,EAAe,EAEd;;AAED0J,WAAO,CAAC3J,OAAR,CAAgBQ,OAAhB,CAAwB;AAAEkF,YAAM,EAANA,MAAF;AAAU1I,YAAM,EAANA,MAAV;AAAkBykB,UAAI,EAAE3nB,OAAO,CAAC2nB;AAAhC,KAAxB;AACH;AACJ,CA9I6B,wBAA3B,C;;ACVP;AACA;AAEA;AACA;AACA;AAGA;;AAEA,SAASuS,YAAT,CAAsBl6B,OAAtB,EAAwC4L,MAAxC,EAAwE1I,MAAxE,QAAoJ;AAAA,MAAzD0R,EAAyD,QAAzDA,EAAyD;AAAA,MAArDgU,IAAqD,QAArDA,IAAqD;AAChJ,MAAIuR,aAAJ;;AAEA,MAAI;AACAA,iBAAa,GAAG3C,kBAAkB,CAAC5rB,MAAD,EAAS1I,MAAT,EAAiBlD,OAAjB,EAA0B;AAAE4U,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAA1B,CAAlC;AACH,GAFD,CAEE,OAAOlsB,GAAP,EAAY;AACV;AACH;;AAED,MAAI,CAACy9B,aAAL,EAAoB;AAChB;AACH;;AAED,MAAI,OAAOA,aAAP,KAAyB,QAAzB,IAAqCA,aAAa,KAAK,IAA3D,EAAiE;AAC7D;AACH;;AAEDA,eAAa,GAAGA,aAAa,CAACrO,wBAAD,CAA7B;;AAEA,MAAI,CAACqO,aAAD,IAAkB,OAAOA,aAAP,KAAyB,QAA3C,IAAuDA,aAAa,KAAK,IAA7E,EAAmF;AAC/E;AACH;;AAED,MAAI,CAACA,aAAa,CAACtL,IAAf,IAAuB,OAAOsL,aAAa,CAACtL,IAArB,KAA8B,QAAzD,EAAmE;AAC/D;AACH;;AAED,MAAI,CAAC8K,qBAAqB,CAACQ,aAAa,CAACtL,IAAf,CAA1B,EAAgD;AAC5C;AACH;;AAED,SAAOsL,aAAP;AACH;;AAEM,SAASlH,sBAAT,CAAwB3X,KAAxB,SAA+F;AAAA,MAA/C1G,EAA+C,SAA/CA,EAA+C;AAAA,MAA3CgU,IAA2C,SAA3CA,IAA2C;AAClG,MAAMwR,gBAAgB,GAAGnO,WAAW,CAAC,kBAAD,CAApC;;AAEA,MAAI,CAAC7vB,MAAD,IAAWA,MAAM,CAAC2D,MAAtB,EAA8B;AAC1B,UAAM,IAAI/C,KAAJ,qCAAN;AACH;;AAED,MAAI;AACA,QAAI,CAACse,KAAK,CAAC1P,MAAX,EAAmB;AACf;AACH;AACJ,GAJD,CAIE,OAAOlP,GAAP,EAAY;AACV;AACH;;AAbiG,MAe5FkP,MAf4F,GAenE0P,KAfmE,CAe5F1P,MAf4F;AAAA,MAepF1I,MAfoF,GAenEoY,KAfmE,CAepFpY,MAfoF;AAAA,MAe5EykB,IAf4E,GAenErM,KAfmE,CAe5EqM,IAf4E;;AAiBlG,MAAI4C,KAAJ,EAAc,EAGb;;AAED,MAAMvqB,OAAO,GAAGk6B,YAAY,CAACvS,IAAD,EAAO/b,MAAP,EAAe1I,MAAf,EAAuB;AAAE0R,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA;AAAN,GAAvB,CAA5B;;AAEA,MAAI,CAAC5oB,OAAL,EAAc;AACV;AACH;;AAED0tB,iBAAe,CAAC9hB,MAAD,CAAf;;AAEA,MAAIwuB,gBAAgB,CAACltB,GAAjB,CAAqBlN,OAAO,CAACkd,EAA7B,CAAJ,EAAsC;AAClC;AACH;;AAEDkd,kBAAgB,CAAChuB,GAAjB,CAAqBpM,OAAO,CAACkd,EAA7B,EAAiC,IAAjC;;AAEA,MAAIrd,cAAc,CAAC+L,MAAD,CAAd,IAA0B,CAAC5L,OAAO,CAAC0yB,aAAvC,EAAsD;AAClD;AACH;;AAED,MAAI1yB,OAAO,CAACkD,MAAR,CAAe7F,OAAf,CAAuB5B,QAAQ,CAACE,IAAhC,MAA0C,CAA9C,EAAiD;AAC7CuH,UAAM,GAAOzH,QAAQ,CAACE,IAAhB,OAAN;AACH;;AAEDg+B,uBAAqB,CAAC35B,OAAO,CAAC6uB,IAAT,CAArB,CAAoCjjB,MAApC,EAA4C1I,MAA5C,EAAoDlD,OAApD,EAA6D;AAAE4U,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA;AAAN,GAA7D;AACH;AAEM,SAASyR,yBAAT,QAAoF;AAAA,MAA/CzlB,EAA+C,SAA/CA,EAA+C;AAAA,MAA3CgU,IAA2C,SAA3CA,IAA2C;AACvF,MAAMxZ,MAAM,GAAGD,gBAAS,EAAxB;;AACAC,QAAM,CAAC6jB,cAAP,GAAwB7jB,MAAM,CAAC6jB,cAAP,IAA0B,UAAAjzB,OAAO;AAAA,WAAIizB,sBAAc,CAACjzB,OAAD,EAAU;AAAE4U,QAAE,EAAFA,EAAF;AAAMgU,UAAI,EAAJA;AAAN,KAAV,CAAlB;AAAA,GAAzD;AACH;AAUM,SAAS0R,eAAT,CAAyBhf,KAAzB,SAAiG;AAAA,MAA/C1G,EAA+C,SAA/CA,EAA+C;AAAA,MAA3CgU,IAA2C,SAA3CA,IAA2C;;AAEpG,MAAI;AACAptB,iBAAI,CAAC8f,KAAK,CAAC1P,MAAP,CAAJ;AACH,GAFD,CAEE,OAAOlP,GAAP,EAAY;AACV;AACH;;AAED,MAAMkP,MAAM,GAAG0P,KAAK,CAAC1P,MAAN,IAAgB0P,KAAK,CAACif,aAArC;AACA,MAAIr3B,MAAM,GAAGoY,KAAK,CAACpY,MAAN,IAAiBoY,KAAK,CAACkf,aAAN,IAAuBlf,KAAK,CAACkf,aAAN,CAAoBt3B,MAAzE;AACA,MAAMykB,IAAI,GAAGrM,KAAK,CAACqM,IAAnB;;AAEA,MAAIzkB,MAAM,KAAK,MAAf,EAAuB;AACnBA,UAAM,GAAOzH,QAAQ,CAACE,IAAhB,OAAN;AACH;;AAED,MAAI,CAACiQ,MAAL,EAAa;AACT;AACH;;AAED,MAAI,CAAC1I,MAAL,EAAa;AACT,UAAM,IAAIlG,KAAJ,2CAAN;AACH;;AAED,MAAIutB,KAAJ,EAAc,EAIb;;AAED0I,wBAAc,CAAC;AAAErnB,UAAM,EAANA,MAAF;AAAU1I,UAAM,EAANA,MAAV;AAAkBykB,QAAI,EAAJA;AAAlB,GAAD,EAA2B;AAAE/S,MAAE,EAAFA,EAAF;AAAMgU,QAAI,EAAJA;AAAN,GAA3B,CAAd;AACH;AAEM,SAAS6R,iBAAT,QAA6F;AAAA,MAAhE7lB,EAAgE,SAAhEA,EAAgE;AAAA,MAA5DgU,IAA4D,SAA5DA,IAA4D;AAChG,SAAOqD,WAAW,GAAG9e,QAAd,CAAuB,qBAAvB,EAA8C,YAAM;AACvD,WAAOyL,gBAAgB,CAACxc,MAAD,EAAS,SAAT,EAAoB,UAAAkf,KAAK,EAAI;AAChD;AACAgf,qBAAe,CAAChf,KAAD,EAAQ;AAAE1G,UAAE,EAAFA,EAAF;AAAMgU,YAAI,EAAJA;AAAN,OAAR,CAAf;AACH,KAHsB,CAAvB;AAIH,GALM,CAAP;AAMH;AAEM,SAAS8R,qBAAT,GAAiC;AACpC,MAAM1lB,QAAQ,GAAGiX,WAAW,GAAG5f,GAAd,CAAkB,qBAAlB,CAAjB;;AACA,MAAI2I,QAAJ,EAAc;AACVA,YAAQ,CAACvQ,MAAT;AACH;AACJ,C;;ACvJD;AACA;;;ACDA;AAEA;AACA;AAGO,SAASmQ,KAAT,CAAYjU,IAAZ,EAA2BkP,OAA3B,EAAsEvJ,OAAtE,EAA+G;AAElH,MAAI,CAAC3F,IAAL,EAAW;AACP,UAAM,IAAI3D,KAAJ,CAAU,eAAV,CAAN;AACH;;AAED,MAAI,OAAO6S,OAAP,KAAmB,UAAvB,EAAmC;AAC/BvJ,WAAO,GAAGuJ,OAAV,CAD+B,CAE/B;;AACAA,WAAO,GAAG,EAAV;AACH;;AAED,MAAI,CAACvJ,OAAL,EAAc;AACV,UAAM,IAAItJ,KAAJ,CAAU,kBAAV,CAAN;AACH;;AAED6S,SAAO,GAAGA,OAAO,IAAI,EAArB;AACAA,SAAO,CAAClP,IAAR,GAAeA,IAAf;AACAkP,SAAO,CAACvJ,OAAR,GAAkBA,OAAO,IAAIuJ,OAAO,CAACvJ,OAArC;AAEA,MAAMnK,GAAG,GAAG0T,OAAO,CAACzT,MAApB;AACA,MAAMe,MAAM,GAAG0S,OAAO,CAAC1S,MAAvB;AAEA,MAAMw9B,eAAqC,GAAG;AAC1Cr0B,WAAO,EAAMuJ,OAAO,CAACvJ,OADqB;AAE1C2zB,eAAW,EAAEpqB,OAAO,CAAC+qB,YAAR,IAAyB,UAAAl+B,GAAG,EAAI;AACzC,YAAMA,GAAN;AACH,KAJyC;AAK1CN,UAAM,EAAED,GALkC;AAM1CgB,UAAM,EAAEA,MAAM,IAAItB,kBANwB;AAO1C8E,QAAI,EAAJA;AAP0C,GAA9C;AAUA,MAAMk6B,eAAe,GAAGzB,kBAAkB,CAAC;AAAEz4B,QAAI,EAAJA,IAAF;AAAQxE,OAAG,EAAHA,GAAR;AAAagB,UAAM,EAANA;AAAb,GAAD,EAAwBw9B,eAAxB,CAA1C;AAEA,SAAO;AACHl2B,UADG,oBACM;AACLo2B,qBAAe,CAACp2B,MAAhB;AACH;AAHE,GAAP;AAKH;AAEM,SAASoM,OAAT,CAAclQ,IAAd,EAA6BkP,OAA7B,EAAyEvJ,OAAzE,EAAoK;AAEvK;AACAuJ,SAAO,GAAGA,OAAO,IAAI,EAArB;;AACA,MAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;AAC/BvJ,WAAO,GAAGuJ,OAAV,CAD+B,CAE/B;;AACAA,WAAO,GAAG,EAAV;AACH;;AAED,MAAM3J,OAAO,GAAG,IAAIa,oBAAJ,EAAhB;AACA,MAAIiO,QAAJ,CAXuK,CAWzJ;;AAEdnF,SAAO,CAAC+qB,YAAR,GAAuB,UAACl+B,GAAD,EAAS;AAC5BsY,YAAQ,CAACvQ,MAAT;AACAyB,WAAO,CAACwB,MAAR,CAAehL,GAAf;AACH,GAHD;;AAKAsY,UAAQ,GAAGJ,KAAE,CAACjU,IAAD,EAAOkP,OAAP,EAAgB,UAAAyL,KAAK,EAAI;AAClCtG,YAAQ,CAACvQ,MAAT;AACAyB,WAAO,CAACQ,OAAR,CAAgB4U,KAAhB;;AACA,QAAIhV,OAAJ,EAAa;AACT,aAAOA,OAAO,CAACgV,KAAD,CAAd;AACH;AACJ,GANY,CAAb;AAQApV,SAAO,CAACzB,MAAR,GAAiBuQ,QAAQ,CAACvQ,MAA1B;AACA,SAAOyB,OAAP;AACH,C;;AC5ED;AACA;AACA;AAGA;AACA;AACA;AACA;AAGA;;AAEA,SAAS40B,eAAT,CAAyBn6B,IAAzB,EAAwCxE,GAAxC,EAAqEgB,MAArE,EAA8F;AAC1F,MAAI,CAACwD,IAAL,EAAW;AACP,UAAM,IAAI3D,KAAJ,CAAU,eAAV,CAAN;AACH;;AAED,MAAIG,MAAJ,EAAY;AACR,QAAI,OAAOA,MAAP,KAAkB,QAAlB,IAA8B,CAACgG,KAAK,CAACC,OAAN,CAAcjG,MAAd,CAA/B,IAAwD,CAACjC,YAAO,CAACiC,MAAD,CAApE,EAA8E;AAC1E,YAAM,IAAIsL,SAAJ,mDAAN;AACH;AACJ;;AAED,MAAI5I,cAAc,CAAC1D,GAAD,CAAlB,EAAyB;AACrB,UAAM,IAAIa,KAAJ,CAAU,yBAAV,CAAN;AACH;AACJ;;AAED,SAAS+9B,eAAT,CAAyB5+B,GAAzB,EAAsD6+B,YAAtD,EAAoFC,YAApF,QAA4L;AAAA,MAA9ErS,IAA8E,QAA9EA,IAA8E;;AACxL,MAAI,OAAOoS,YAAP,KAAwB,QAA5B,EAAsC;AAClC,WAAOj0B,oBAAY,CAACL,OAAb,CAAqBs0B,YAArB,CAAP;AACH;;AAED,SAAOj0B,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1B,WAAO2yB,YAAY,IAAI5N,QAAQ,CAAClxB,GAAD,EAAM;AAAEysB,UAAI,EAAJA;AAAF,KAAN,CAAR,CAAwB9iB,IAAxB,CAA6B;AAAA,UAAG3I,MAAH,SAAGA,MAAH;AAAA,aAAgBA,MAAhB;AAAA,KAA7B,CAAvB;AAEH,GAHM,EAGJ2I,IAHI,CAGC,UAAAo1B,gBAAgB,EAAI;AACxB,QAAI,CAACl4B,WAAW,CAACg4B,YAAD,EAAeA,YAAf,CAAhB,EAA8C;AAC1C,YAAM,IAAIh+B,KAAJ,aAAqBuG,SAAS,CAACy3B,YAAD,CAA9B,wBAAiEz3B,SAAS,CAACy3B,YAAD,CAA1E,CAAN;AACH;;AAED,WAAOE,gBAAP;AACH,GATM,CAAP;AAUH;;AAEM,IAAMtS,SAAe,GAAG,SAAlBA,IAAkB,CAACzsB,GAAD,EAAMwE,IAAN,EAAYgnB,IAAZ,EAAkB9X,OAAlB,EAA8B;AACzDA,SAAO,GAAGA,OAAO,IAAI,EAArB;AACA,MAAI1S,MAAM,GAAG0S,OAAO,CAAC1S,MAAR,IAAkBtB,kBAA/B;AACA,MAAMs/B,eAAe,GAAGtrB,OAAO,CAACxL,OAAR,IAAmBimB,WAA3C;AACA,MAAM8Q,YAAY,GAAGvrB,OAAO,CAACxL,OAAR,IAAmB8lB,oBAAxC;AACA,MAAMuI,aAAa,GAAG7iB,OAAO,CAAC6iB,aAAR,IAAyB,KAA/C,CALyD,CAOzD;;AACA,SAAO3rB,oBAAY,CAACuB,GAAb,CAAiB,YAAM;AAC1BwyB,mBAAe,CAACn6B,IAAD,EAAOxE,GAAP,EAAYgB,MAAZ,CAAf;;AAEA,QAAIoE,UAAU,CAACnF,MAAD,EAASD,GAAT,CAAd,EAA6B;AACzB,aAAOqxB,gBAAgB,CAACrxB,GAAD,EAAMi/B,YAAN,CAAvB;AACH;AAEJ,GAPM,EAOJt1B,IAPI,CAOC,iBAAmC;AAAA,mCAAP,EAAO;AAAA,QAAxBm1B,YAAwB,SAAhC99B,MAAgC;;AAEvC,WAAO49B,eAAe,CAAC5+B,GAAD,EAAMgB,MAAN,EAAc89B,YAAd,EAA4B;AAAErS,UAAI,EAAJA;AAAF,KAA5B,CAAtB;AACH,GAVM,EAUJ9iB,IAVI,CAUC,UAAAk1B,YAAY,EAAI;AAEpB79B,UAAM,GAAG69B,YAAT;AAEA,QAAMpB,OAAO,GAAIj5B,IAAI,KAAKqqB,YAAY,CAACC,MAAtB,IAAgCtD,IAAhC,IAAwC,OAAOA,IAAI,CAAChnB,IAAZ,KAAqB,QAA9D,GAA8EgnB,IAAI,CAAChnB,IAAnF,UAA+FA,IAA/G;;AAEA,QAAIwF,KAAJ,EAAe,EAEd;;AAED,QAAMD,OAAO,GAAG,IAAIa,oBAAJ,EAAhB;AACA,QAAM+B,IAAI,GAAOnI,IAAP,SAAiB+N,QAAQ,EAAnC;;AAEA,QAAI,CAACgkB,aAAL,EAAoB;AAChB,UAAM2I,gBAAuC,GAAG;AAAE16B,YAAI,EAAJA,IAAF;AAAQxE,WAAG,EAAHA,GAAR;AAAagB,cAAM,EAANA,MAAb;AAAqB+I,eAAO,EAAPA;AAArB,OAAhD;AACAuyB,yBAAmB,CAAC3vB,IAAD,EAAOuyB,gBAAP,CAAnB;AAEA,UAAMC,WAAW,GAAG5O,WAAW,CAAC,iBAAD,CAAX,CAA+Bvf,QAA/B,CAAwChR,GAAxC,EAA6C;AAAA,eAAM,EAAN;AAAA,OAA7C,CAApB;AACAm/B,iBAAW,CAACv9B,IAAZ,CAAiBmI,OAAjB;AAEAA,aAAO,CAACgC,KAAR,CAAc,YAAM;AAChB2wB,mCAA2B,CAAC/vB,IAAD,CAA3B;AACA6vB,8BAAsB,CAAC7vB,IAAD,CAAtB;AACH,OAHD;AAKA,UAAMyyB,eAAe,GAAG3N,aAAa,CAACzxB,GAAD,CAAb,GAAqBkuB,iBAArB,GAAyCD,WAAjE;AACA,UAAMoR,eAAe,GAAGL,eAAxB;AAEA,UAAIM,UAAU,GAAGF,eAAjB;AACA,UAAIG,UAAU,GAAGF,eAAjB;AAEA,UAAM3lB,QAAQ,GAAGpC,YAAY,CAAC,YAAM;AAChC,YAAI5T,cAAc,CAAC1D,GAAD,CAAlB,EAAyB;AACrB,iBAAO+J,OAAO,CAACwB,MAAR,CAAe,IAAI1K,KAAJ,wBAAgC2D,IAAhC,iBAAiD06B,gBAAgB,CAACvB,GAAjB,GAAuB,UAAvB,GAAoC,KAArF,EAAf,CAAP;AACH;;AAED,YAAIuB,gBAAgB,CAACtmB,SAArB,EAAgC;AAC5B,iBAAO7O,OAAO,CAACwB,MAAR,CAAe,IAAI1K,KAAJ,0CAAkD2D,IAAlD,CAAf,CAAP;AACH;;AAED86B,kBAAU,GAAGhvB,IAAI,CAACiG,GAAL,CAAS+oB,UAAU,GAAGjR,mBAAtB,EAA2C,CAA3C,CAAb;;AACA,YAAIkR,UAAU,KAAK,CAAC,CAApB,EAAuB;AACnBA,oBAAU,GAAGjvB,IAAI,CAACiG,GAAL,CAASgpB,UAAU,GAAGlR,mBAAtB,EAA2C,CAA3C,CAAb;AACH;;AAED,YAAI,CAAC6Q,gBAAgB,CAACvB,GAAlB,IAAyB2B,UAAU,KAAK,CAA5C,EAA+C;AAC3C,iBAAOv1B,OAAO,CAACwB,MAAR,CAAe,IAAI1K,KAAJ,6BAAqC48B,OAArC,YAAqD18B,SAAS,EAA9D,YAAyEq+B,eAAzE,QAAf,CAAP;AAEH,SAHD,MAGO,IAAIG,UAAU,KAAK,CAAnB,EAAsB;AACzB,iBAAOx1B,OAAO,CAACwB,MAAR,CAAe,IAAI1K,KAAJ,kCAA0C48B,OAA1C,YAA0D18B,SAAS,EAAnE,YAA8Es+B,eAA9E,QAAf,CAAP;AACH;AACJ,OApB4B,EAoB1BhR,mBApB0B,CAA7B;AAsBAtkB,aAAO,CAACkC,OAAR,CAAgB,YAAM;AAClByN,gBAAQ,CAACpR,MAAT;AACA62B,mBAAW,CAACl7B,MAAZ,CAAmBk7B,WAAW,CAACj+B,OAAZ,CAAoB6I,OAApB,EAA6B,CAA7B,CAAnB;AACH,OAHD,EAGGgC,KAHH,CAGS1M,aAHT;AAIH;;AAED,QAAI;AACA81B,sBAAW,CAACn1B,GAAD,EAAMgB,MAAN,EAAc;AACrB0xB,YAAI,EAAEpE,YAAY,CAACC,OADE;AAErB5hB,YAAI,EAAJA,IAFqB;AAGrBnI,YAAI,EAAJA,IAHqB;AAIrBgnB,YAAI,EAAJA,IAJqB;AAKrB+K,qBAAa,EAAbA;AALqB,OAAd,EAMR;AAAE9d,UAAE,EAAFA,KAAF;AAAMgU,YAAI,EAAJA;AAAN,OANQ,CAAX;AAOH,KARD,CAQE,OAAOlsB,GAAP,EAAY;AACV,YAAM,IAAIM,KAAJ,sCAA8C48B,OAA9C,YAA8D18B,SAAS,EAAvE,YAAkFuU,cAAc,CAAC/U,GAAD,CAAhG,CAAN;AACH;;AAED,WAAOg2B,aAAa,GAAGxsB,OAAO,CAACQ,OAAR,EAAH,GAAuBR,OAA3C;AACH,GAlFM,CAAP;AAmFH,CA3FM,C;;AC9CP;;;ACEA;AACA;AACA;AACA;AACA;AACA;AAEO,SAASqxB,sBAAT,CAA6BjB,WAA7B,EAAgFn5B,MAAhF,EAAwGwH,GAAxG,EAA0H;AAC7H,SAAOg3B,gBAAwB,CAACrF,WAAD,EAAcn5B,MAAd,EAAsBwH,GAAtB,EAA2B;AAAEiQ,MAAE,EAAFA,KAAF;AAAMgU,QAAI,EAAJA,SAAIA;AAAV,GAA3B,CAA/B;AACH;AAEM,SAAS4O,wBAAT,CAAuC5rB,MAAvC,EAAqF1I,MAArF,EAAsGlD,OAAtG,EAA4H;AAC/H,SAAO47B,kBAA0B,CAAChwB,MAAD,EAAS1I,MAAT,EAAiBlD,OAAjB,EAA0B;AAAE4U,MAAE,EAAFA,KAAF;AAAMgU,QAAI,EAAJA,SAAIA;AAAV,GAA1B,CAAjC;AACH;AAEM,SAASiT,iBAAT,CAA2B1/B,GAA3B,EAAuE;AAC1E,SAAO,IAAIi5B,kBAAJ,CAAgB;AAAExM,QAAI,EAAJA,SAAF;AAAQzsB,OAAG,EAAHA;AAAR,GAAhB,CAAP;AACH;AAEM,SAASi6B,mBAAT,CAAuBj6B,GAAvB,EAAgF;AACnF,SAAOi5B,kBAAW,CAACgB,aAAZ,CAA0Bj6B,GAA1B,EAA+B;AAAEysB,QAAI,EAAJA,SAAIA;AAAN,GAA/B,CAAP;AACH;AAEM,SAASkT,KAAT,GAAiB;AACpB,MAAI,CAAC3sB,gBAAS,GAAG4sB,WAAjB,EAA8B;AAC1B5sB,oBAAS,GAAG4sB,WAAZ,GAA0B,IAA1B;AAEA1B,6BAAyB,CAAC;AAAEzlB,QAAE,EAAFA,KAAF;AAAMgU,UAAI,EAAJA,SAAIA;AAAV,KAAD,CAAzB;AACA6R,qBAAiB,CAAC;AAAE7lB,QAAE,EAAFA,KAAF;AAAMgU,UAAI,EAAJA,SAAIA;AAAV,KAAD,CAAjB;;AAEA,QAAIkD,IAAJ,EAAyC;AACrCwI,iBAAW,CAAC;AAAE1f,UAAE,EAAFA,KAAF;AAAMgU,YAAI,EAAJA,SAAN;AAAYqK,sBAAc,EAAdA,sBAAcA;AAA1B,OAAD,CAAX;AACH;;AAED1F,aAAS,CAAC;AAAE3Y,QAAE,EAAFA,KAAF;AAAMgU,UAAI,EAAJA,SAAIA;AAAV,KAAD,CAAT;AACH;AACJ;AAEM,SAASoT,OAAT,GAAmB;AACtBpD,yBAAuB;AACvB8B,uBAAqB;AACrB3O,cAAY;AACf,C;;ACzCD;AACO,IAAMrmB,iBAAK,GAAG,IAAd,C,CAEP,uD;;ACLA;AAEA;AAEO,SAASu2B,aAAT,CAAuB9/B,GAAvB,EAAoD;AACvD,MAAM+/B,eAAe,GAAGxP,WAAW,CAAC,iBAAD,CAAnC;;AADuD,4CAEjCwP,eAAe,CAAC7vB,GAAhB,CAAoBlQ,GAApB,EAAyB,EAAzB,CAFiC,6CAEH;AAA/C,QAAM+J,OAAO,6BAAb;AACDA,WAAO,CAACwB,MAAR,CAAe,IAAI1K,KAAJ,qCAAf,EAA+DkL,KAA/D,CAAqE1M,aAArE;AACH;AACJ,C;;ACVD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,IAAI03B,UAAJ;;AAEP,IAAIpH,IAAJ,EAAyC;AACrCoH,YAAM,GAAG;AAAEoB,eAAW,EAAXA,WAAF;AAAeZ,cAAU,EAAVA,UAAf;AAA2BE,cAAU,EAAVA,UAA3B;AAAuCI,WAAO,EAAPA,OAAvC;AAAgDhC,YAAQ,EAARA,QAAhD;AAA0DH,eAAW,EAAXA,WAA1D;AACLH,yBAAqB,EAArBA,qBADK;AACkB8B,aAAS,EAATA,SADlB;AAC6B7B,qBAAiB,EAAjBA,iBAD7B;AACgDC,wBAAoB,EAApBA,oBADhD;AACsEyC,kBAAc,EAAdA,cAAcA;AADpF,GAAT;AAEH;;AAED,IAAIvI,IAAJ,EAAmC;AAC/BgQ,OAAK;AACR,C","file":"post-robot.ie.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"postRobot\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postRobot\"] = factory();\n\telse\n\t\troot[\"postRobot\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* @flow */\n\nexport function isRegex(item : mixed) : boolean {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n","/* @flow */\n\nexport const PROTOCOL = {\n    MOCK:  ('mock:' : 'mock:'),\n    FILE:  ('file:' : 'file:'),\n    ABOUT: ('about:' : 'about:')\n};\n\nexport const WILDCARD = '*';\n\nexport const WINDOW_TYPE = {\n    IFRAME: ('iframe' : 'iframe'),\n    POPUP:  ('popup' : 'popup')\n};\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { isRegex, noop } from './util';\nimport type { CrossDomainWindowType, SameDomainWindowType, DomainMatcher } from './types';\nimport { PROTOCOL, WILDCARD } from './constants';\n\nlet IE_WIN_ACCESS_ERROR = 'Call was rejected by callee.\\r\\n';\n\nexport function isFileProtocol(win : SameDomainWindowType = window) : boolean {\n    return win.location.protocol === PROTOCOL.FILE;\n}\n\nexport function isAboutProtocol(win : SameDomainWindowType = window) : boolean {\n    return win.location.protocol === PROTOCOL.ABOUT;\n}\n\nexport function getParent(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.parent && win.parent !== win) {\n            return win.parent;\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function getOpener(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    if (!win) {\n        return;\n    }\n\n    // Make sure we're not actually an iframe which has had window.open() called on us\n    if (getParent(win)) {\n        return;\n    }\n\n    try {\n        return win.opener;\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function canReadFromWindow(win : CrossDomainWindowType | SameDomainWindowType) : boolean {\n    try {\n        // $FlowFixMe\n        noop(win && win.location && win.location.href);\n        return true;\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function getActualDomain(win? : SameDomainWindowType = window) : string {\n\n    let location = win.location;\n\n    if (!location) {\n        throw new Error(`Can not read window location`);\n    }\n\n    let protocol = location.protocol;\n\n    if (!protocol) {\n        throw new Error(`Can not read window protocol`);\n    }\n\n    if (protocol === PROTOCOL.FILE) {\n        return `${ PROTOCOL.FILE }//`;\n    }\n\n    if (protocol === PROTOCOL.ABOUT) {\n\n        let parent = getParent(win);\n        if (parent && canReadFromWindow(parent)) {\n            // $FlowFixMe\n            return getActualDomain(parent);\n        }\n\n        return `${ PROTOCOL.ABOUT }//`;\n    }\n\n    let host = location.host;\n\n    if (!host) {\n        throw new Error(`Can not read window host`);\n    }\n\n    return `${ protocol }//${ host }`;\n}\n\nexport function getDomain(win? : SameDomainWindowType = window) : string {\n\n    let domain = getActualDomain(win);\n\n    if (domain && win.mockDomain && win.mockDomain.indexOf(PROTOCOL.MOCK) === 0) {\n        return win.mockDomain;\n    }\n\n    return domain;\n}\n\nexport function isBlankDomain(win : CrossDomainWindowType) : boolean {\n    try {\n        // $FlowFixMe\n        if (!win.location.href) {\n            return true;\n        }\n\n        if (win.location.href === 'about:blank') {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function isActuallySameDomain(win : CrossDomainWindowType) : boolean {\n\n    try {\n        if (win === window) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        let desc = Object.getOwnPropertyDescriptor(win, 'location');\n\n        if (desc && desc.enumerable === false) {\n            return false;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        // $FlowFixMe\n        if (isAboutProtocol(win) && canReadFromWindow(win)) {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        // $FlowFixMe\n        if (getActualDomain(win) === getActualDomain(window)) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function isSameDomain(win : CrossDomainWindowType | SameDomainWindowType) : boolean {\n\n    if (!isActuallySameDomain(win)) {\n        return false;\n    }\n\n    try {\n\n        if (win === window) {\n            return true;\n        }\n\n        // $FlowFixMe\n        if (isAboutProtocol(win) && canReadFromWindow(win)) {\n            return true;\n        }\n\n        // $FlowFixMe\n        if (getDomain(window) === getDomain(win)) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\n\nexport function assertSameDomain(win : CrossDomainWindowType | SameDomainWindowType) : SameDomainWindowType {\n    if (!isSameDomain(win)) {\n        throw new Error(`Expected window to be same domain`);\n    }\n\n    // $FlowFixMe\n    return win;\n}\n\nexport function getParents(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    try {\n\n        while (win.parent !== win) {\n            result.push(win.parent);\n            win = win.parent;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return result;\n}\n\nexport function isAncestorParent(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    if (!parent || !child) {\n        return false;\n    }\n\n    let childParent = getParent(child);\n\n    if (childParent) {\n        return childParent === parent;\n    }\n\n    if (getParents(child).indexOf(parent) !== -1) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getFrames(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    let frames;\n\n    try {\n        frames = win.frames;\n    } catch (err) {\n        frames = win;\n    }\n\n    let len;\n\n    try {\n        len = frames.length;\n    } catch (err) {\n        // pass\n    }\n\n    if (len === 0) {\n        return result;\n    }\n\n    if (len) {\n        for (let i = 0; i < len; i++) {\n\n            let frame;\n\n            try {\n                frame = frames[i];\n            } catch (err) {\n                continue;\n            }\n\n            result.push(frame);\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < 100; i++) {\n        let frame;\n\n        try {\n            frame = frames[i];\n        } catch (err) {\n            return result;\n        }\n\n        if (!frame) {\n            return result;\n        }\n\n        result.push(frame);\n    }\n\n    return result;\n}\n\n\nexport function getAllChildFrames(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    for (let frame of getFrames(win)) {\n        result.push(frame);\n\n        for (let childFrame of getAllChildFrames(frame)) {\n            result.push(childFrame);\n        }\n    }\n\n    return result;\n}\n\nexport function getTop(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    try {\n        if (win.top) {\n            return win.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    if (getParent(win) === win) {\n        return win;\n    }\n\n    try {\n        if (isAncestorParent(window, win) && window.top) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (isAncestorParent(win, window) && window.top) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    for (let frame of getAllChildFrames(win)) {\n        try {\n            if (frame.top) {\n                return frame.top;\n            }\n        } catch (err) {\n            // pass\n        }\n\n        if (getParent(frame) === frame) {\n            return frame;\n        }\n    }\n}\n\nexport function getNextOpener(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n    return getOpener(getTop(win) || win);\n}\n\nexport function getUltimateTop(win? : CrossDomainWindowType = window) : CrossDomainWindowType {\n    let opener = getNextOpener(win);\n\n    if (opener) {\n        return getUltimateTop(opener);\n    }\n\n    return top;\n}\n\nexport function getAllFramesInWindow(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n    let top = getTop(win);\n\n    if (!top) {\n        throw new Error(`Can not determine top window`);\n    }\n\n    return [ ...getAllChildFrames(top), top ];\n}\n\nexport function getAllWindows(win? : CrossDomainWindowType = window) : $ReadOnlyArray<CrossDomainWindowType> {\n    let frames = getAllFramesInWindow(win);\n    let opener = getNextOpener(win);\n\n    if (opener) {\n        return [ ...getAllWindows(opener), ...frames ];\n    } else {\n        return frames;\n    }\n}\n\nexport function isTop(win : CrossDomainWindowType) : boolean {\n    return win === getTop(win);\n}\n\nexport function isFrameWindowClosed(frame : HTMLIFrameElement) : boolean {\n\n    if (!frame.contentWindow) {\n        return true;\n    }\n\n    if (!frame.parentNode) {\n        return true;\n    }\n\n    let doc = frame.ownerDocument;\n\n    if (doc && doc.documentElement && !doc.documentElement.contains(frame)) {\n        return true;\n    }\n\n    return false;\n}\n\nfunction safeIndexOf<T>(collection : Array<T>, item : T) : number {\n    for (let i = 0; i < collection.length; i++) {\n\n        try {\n            if (collection[i] === item) {\n                return i;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    return -1;\n}\n\nlet iframeWindows = [];\nlet iframeFrames = [];\n\nexport function isWindowClosed(win : CrossDomainWindowType, allowMock : boolean = true) : boolean {\n\n    try {\n        if (win === window) {\n            return false;\n        }\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (!win) {\n            return true;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (win.closed) {\n            return true;\n        }\n\n    } catch (err) {\n\n        // I love you so much IE\n\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return false;\n        }\n\n        return true;\n    }\n\n\n    if (allowMock && isSameDomain(win)) {\n        try {\n            // $FlowFixMe\n            if (win.mockclosed) {\n                return true;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    // Mobile safari\n\n    try {\n        if (!win.parent || !win.top) {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    // Yes, this actually happens in IE. win === win errors out when the window\n    // is from an iframe, and the iframe was removed from the page.\n\n    try {\n        noop(win === win); // eslint-disable-line no-self-compare\n    } catch (err) {\n        return true;\n    }\n\n    // IE orphaned frame\n\n    let iframeIndex = safeIndexOf(iframeWindows, win);\n\n    if (iframeIndex !== -1) {\n        let frame = iframeFrames[iframeIndex];\n\n        if (frame && isFrameWindowClosed(frame)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction cleanIframes() {\n    for (let i = 0; i < iframeWindows.length; i++) {\n        let closed = false;\n\n        try {\n            closed = iframeWindows[i].closed;\n        } catch (err) {\n            // pass\n        }\n\n        if (closed) {\n            iframeFrames.splice(i, 1);\n            iframeWindows.splice(i, 1);\n        }\n    }\n}\n\nexport function linkFrameWindow(frame : HTMLIFrameElement) {\n\n    cleanIframes();\n\n    if (frame && frame.contentWindow) {\n        try {\n            iframeWindows.push(frame.contentWindow);\n            iframeFrames.push(frame);\n        } catch (err) {\n            // pass\n        }\n    }\n}\n\nexport function getUserAgent(win : ?SameDomainWindowType) : string {\n    win = win || window;\n    return win.navigator.mockUserAgent || win.navigator.userAgent;\n}\n\n\nexport function getFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let winFrames = getFrames(win);\n\n    for (let childFrame of winFrames) {\n        try {\n            // $FlowFixMe\n            if (isSameDomain(childFrame) && childFrame.name === name && winFrames.indexOf(childFrame) !== -1) {\n                return childFrame;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    try {\n        // $FlowFixMe\n        if (winFrames.indexOf(win.frames[name]) !== -1) {\n            // $FlowFixMe\n            return win.frames[name];\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (winFrames.indexOf(win[name]) !== -1) {\n            return win[name];\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function findChildFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        let namedFrame = findChildFrameByName(childFrame, name);\n\n        if (namedFrame) {\n            return namedFrame;\n        }\n    }\n}\n\nexport function findFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let frame;\n\n    frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    let top = getTop(win) || win;\n\n    return findChildFrameByName(top, name);\n}\n\nexport function isParent(win : CrossDomainWindowType, frame : CrossDomainWindowType) : boolean {\n\n    let frameParent = getParent(frame);\n\n    if (frameParent) {\n        return frameParent === win;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        if (childFrame === frame) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isOpener(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    return parent === getOpener(child);\n}\n\nexport function getAncestor(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n    win = win || window;\n\n    let opener = getOpener(win);\n\n    if (opener) {\n        return opener;\n    }\n\n    let parent = getParent(win);\n\n    if (parent) {\n        return parent;\n    }\n}\n\nexport function getAncestors(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let results = [];\n\n    let ancestor = win;\n\n    while (ancestor) {\n        ancestor = getAncestor(ancestor);\n        if (ancestor) {\n            results.push(ancestor);\n        }\n    }\n\n    return results;\n}\n\n\nexport function isAncestor(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    let actualParent = getAncestor(child);\n\n    if (actualParent) {\n        if (actualParent === parent) {\n            return true;\n        }\n\n        return false;\n    }\n\n    if (child === parent) {\n        return false;\n    }\n\n    if (getTop(child) === child) {\n        return false;\n    }\n\n    for (let frame of getFrames(parent)) {\n        if (frame === child) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isPopup(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(getOpener(win));\n}\n\nexport function isIframe(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(getParent(win));\n}\n\nexport function isFullpage(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(!isIframe(win) && !isPopup(win));\n}\n\nfunction anyMatch(collection1, collection2) : boolean {\n\n    for (let item1 of collection1) {\n        for (let item2 of collection2) {\n            if (item1 === item2) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nexport function getDistanceFromTop(win : CrossDomainWindowType = window) : number {\n    let distance = 0;\n    let parent = win;\n\n    while (parent) {\n        parent = getParent(parent);\n        if (parent) {\n            distance += 1;\n        }\n    }\n\n    return distance;\n}\n\nexport function getNthParent(win : CrossDomainWindowType, n : number = 1) : ?CrossDomainWindowType {\n    let parent = win;\n\n    for (let i = 0; i < n; i++) {\n        if (!parent) {\n            return;\n        }\n\n        parent = getParent(parent);\n    }\n\n    return parent;\n}\n\nexport function getNthParentFromTop(win : CrossDomainWindowType, n : number = 1) : ?CrossDomainWindowType {\n    return getNthParent(win, getDistanceFromTop(win) - n);\n}\n\nexport function isSameTopWindow(win1 : CrossDomainWindowType, win2 : CrossDomainWindowType) : boolean {\n\n    let top1 = getTop(win1) || win1;\n    let top2 = getTop(win2) || win2;\n\n    try {\n        if (top1 && top2) {\n            if (top1 === top2) {\n                return true;\n            }\n\n            return false;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    let allFrames1 = getAllFramesInWindow(win1);\n    let allFrames2 = getAllFramesInWindow(win2);\n\n    if (anyMatch(allFrames1, allFrames2)) {\n        return true;\n    }\n\n    let opener1 = getOpener(top1);\n    let opener2 = getOpener(top2);\n\n    if (opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2)) {\n        return false;\n    }\n\n    if (opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1)) {\n        return false;\n    }\n\n    return false;\n}\n\nexport function matchDomain(pattern : DomainMatcher, origin : DomainMatcher) : boolean {\n\n    if (typeof pattern === 'string') {\n\n        if (typeof origin === 'string') {\n            return pattern === WILDCARD || origin === pattern;\n        }\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n    }\n\n    if (isRegex(pattern)) {\n\n        if (isRegex(origin)) {\n            return pattern.toString() === origin.toString();\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        // $FlowFixMe\n        return Boolean(origin.match(pattern));\n    }\n\n    if (Array.isArray(pattern)) {\n\n        if (Array.isArray(origin)) {\n            return JSON.stringify(pattern) === JSON.stringify(origin);\n        }\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        return pattern.some(subpattern => matchDomain(subpattern, origin));\n    }\n\n    return false;\n}\n\nexport function stringifyDomainPattern(pattern : DomainMatcher) : string {\n    if (Array.isArray(pattern)) {\n        return `(${ pattern.join(' | ') })`;\n    } else if (isRegex(pattern)) {\n        return `RegExp(${ pattern.toString() }`;\n    } else {\n        return pattern.toString();\n    }\n}\n\nexport function getDomainFromUrl(url : string) : string {\n\n    let domain;\n\n    if (url.match(/^(https?|mock|file):\\/\\//)) {\n        domain = url;\n    } else {\n        return getDomain();\n    }\n\n    domain = domain.split('/').slice(0, 3).join('/');\n\n    return domain;\n}\n\nexport function onCloseWindow(win : CrossDomainWindowType, callback : Function, delay : number = 1000, maxtime : number = Infinity) : { cancel : () => void } {\n\n    let timeout;\n\n    let check = () => {\n\n        if (isWindowClosed(win)) {\n\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n\n            return callback();\n        }\n\n        if (maxtime <= 0) {\n            clearTimeout(timeout);\n        } else {\n            maxtime -= delay;\n            timeout = setTimeout(check, delay);\n        }\n    };\n\n    check();\n\n    return {\n        cancel() {\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n        }\n    };\n}\n\n// eslint-disable-next-line complexity\nexport function isWindow(obj : Object) : boolean {\n\n    try {\n        if (obj === window) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (Object.prototype.toString.call(obj) === '[object Window]') {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (window.Window && obj instanceof window.Window) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.self === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.parent === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.top === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (noop(obj === obj) === '__unlikely_value__') { // eslint-disable-line no-self-compare\n            return false;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (obj && obj.__cross_domain_utils_window_check__ === '__unlikely_value__') {\n            return false;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function isBrowser() : boolean {\n    return (typeof window !== 'undefined' && typeof window.location !== 'undefined');\n}\n\nexport function isCurrentDomain(domain : string) : boolean {\n    if (!isBrowser()) {\n        return false;\n    }\n\n    return (getDomain() === domain);\n}\n\nexport function isMockDomain(domain : string) : boolean {\n    return domain.indexOf(PROTOCOL.MOCK) === 0;\n}\n\nexport function normalizeMockUrl(url : string) : string {\n    if (!isMockDomain(getDomainFromUrl(url))) {\n        return url;\n    }\n\n    if (!__TEST__) {\n        throw new Error(`Mock urls not supported out of test mode`);\n    }\n\n    return url.replace(/^mock:\\/\\/[^/]+/, getActualDomain(window));\n}\n\nexport function closeWindow(win : CrossDomainWindowType) {\n    try {\n        win.close();\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function getFrameForWindow(win : CrossDomainWindowType) : ?HTMLElement {\n    if (isSameDomain(win)) {\n        return assertSameDomain(win).frameElement;\n    }\n\n    for (const frame of document.querySelectorAll('iframe')) {\n        if (frame && frame.contentWindow && frame.contentWindow === win) {\n            return frame;\n        }\n    }\n}\n","/* @flow */\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\nexport type CrossDomainLocationType = {|\n\n|};\n\nexport type CrossDomainWindowType = {|\n    location : string | CrossDomainLocationType,\n    self : CrossDomainWindowType,\n    closed : boolean,\n    open : (string, string, string) => CrossDomainWindowType,\n    close : () => void,\n    focus : () => void,\n    top : CrossDomainWindowType,\n    frames : Array<CrossDomainWindowType>,\n    opener ? : CrossDomainWindowType,\n    parent : CrossDomainWindowType,\n    length : number,\n    postMessage : (string, string) => void\n|};\n\nexport type SameDomainWindowType = Object & {\n    location : string | Object,\n    self : CrossDomainWindowType,\n    closed : boolean,\n    open : (string, string, string) => CrossDomainWindowType,\n    close : () => void,\n    focus : () => void,\n    XMLHttpRequest : typeof XMLHttpRequest,\n    document : Document,\n    navigator : {\n        userAgent : string,\n        mockUserAgent? : string\n    }\n};\n\nexport type DomainMatcher = string | Array<string> | $ReadOnlyArray<string> | RegExp;\n","/* @flow */\n\nexport * from './utils';\nexport * from './types';\nexport * from './constants';\n","/* @flow */\n\nexport function isPromise(item : mixed) : boolean {\n    try {\n        if (!item) {\n            return false;\n        }\n\n        if (typeof Promise !== 'undefined' && item instanceof Promise) {\n            return true;\n        }\n\n        if (typeof window !== 'undefined' && typeof window.Window === 'function' && item instanceof window.Window) {\n            return false;\n        }\n\n        if (typeof window !== 'undefined' && typeof window.constructor === 'function' && item instanceof window.constructor) {\n            return false;\n        }\n\n        let toString = ({}).toString;\n\n        if (toString) {\n            let name = toString.call(item);\n\n            if (name === '[object Window]' || name === '[object global]' || name === '[object DOMWindow]') {\n                return false;\n            }\n        }\n\n        if (typeof item.then === 'function') {\n            return true;\n        }\n    } catch (err) {\n        return false;\n    }\n\n    return false;\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from './promise';\n\nconst dispatchedErrors = [];\nconst possiblyUnhandledPromiseHandlers : Array<(mixed, promise? : ZalgoPromise<mixed>) => void> = [];\n\nexport function dispatchPossiblyUnhandledError<T>(err : mixed, promise : ZalgoPromise<T>) {\n\n    if (dispatchedErrors.indexOf(err) !== -1) {\n        return;\n    }\n\n    dispatchedErrors.push(err);\n\n    setTimeout(() => {\n        if (__DEBUG__) {\n            // $FlowFixMe\n            throw new Error(`${ err.stack || err.toString() }\\n\\nFrom promise:\\n\\n${ promise.stack }`);\n        }\n\n        throw err;\n    }, 1);\n\n    for (let j = 0; j < possiblyUnhandledPromiseHandlers.length; j++) {\n        // $FlowFixMe\n        possiblyUnhandledPromiseHandlers[j](err, promise);\n    }\n}\n\nexport function onPossiblyUnhandledException(handler : (mixed, promise? : ZalgoPromise<mixed>) => void) : { cancel : () => void } {\n    possiblyUnhandledPromiseHandlers.push(handler);\n\n    return {\n        cancel() {\n            possiblyUnhandledPromiseHandlers.splice(possiblyUnhandledPromiseHandlers.indexOf(handler), 1);\n        }\n    };\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from './promise';\n\nlet activeCount = 0;\nlet flushPromise;\n\nfunction flushActive() {\n    if (!activeCount && flushPromise) {\n        const promise = flushPromise;\n        flushPromise = null;\n        promise.resolve();\n    }\n}\n\nexport function startActive() {\n    activeCount += 1;\n}\n\nexport function endActive() {\n    activeCount -= 1;\n    flushActive();\n}\n\nexport function awaitActive(Zalgo : Class<ZalgoPromise<*>>) : ZalgoPromise<void> { // eslint-disable-line no-undef\n    let promise = flushPromise = flushPromise || new Zalgo();\n    flushActive();\n    return promise;\n}\n","/* @flow */\n\nimport { isPromise } from './utils';\nimport { onPossiblyUnhandledException, dispatchPossiblyUnhandledError } from './exceptions';\nimport { startActive, endActive, awaitActive } from './flush';\n\nexport class ZalgoPromise<R : mixed> {\n\n    resolved : boolean\n    rejected : boolean\n    errorHandled : boolean\n    value : R\n    error : mixed\n    handlers : Array<{\n        promise : ZalgoPromise<*>,\n        onSuccess : void | (result : R) => mixed,\n        onError : void | (error : mixed) => mixed\n    }>\n    dispatching : boolean\n    stack : string\n\n    constructor(handler : ?(resolve : (result : R) => void, reject : (error : mixed) => void) => void) {\n\n        this.resolved = false;\n        this.rejected = false;\n        this.errorHandled = false;\n\n        this.handlers = [];\n\n        if (handler) {\n\n            let result;\n            let error;\n            let resolved = false;\n            let rejected = false;\n            let isAsync = false;\n\n            startActive();\n\n            try {\n                handler(res => {\n                    if (isAsync) {\n                        this.resolve(res);\n                    } else {\n                        resolved = true;\n                        result = res;\n                    }\n\n                }, err => {\n                    if (isAsync) {\n                        this.reject(err);\n                    } else {\n                        rejected = true;\n                        error = err;\n                    }\n                });\n\n            } catch (err) {\n                endActive();\n                this.reject(err);\n                return;\n            }\n\n            endActive();\n\n            isAsync = true;\n\n            if (resolved) {\n                // $FlowFixMe\n                this.resolve(result);\n            } else if (rejected) {\n                this.reject(error);\n            }\n        }\n\n        if (__DEBUG__) {\n            try {\n                throw new Error(`ZalgoPromise`);\n            } catch (err) {\n                this.stack = err.stack;\n            }\n        }\n    }\n\n    resolve(result : R) : ZalgoPromise<R> {\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        if (isPromise(result)) {\n            throw new Error('Can not resolve promise with another promise');\n        }\n\n        this.resolved = true;\n        this.value = result;\n        this.dispatch();\n\n        return this;\n    }\n\n    reject(error : mixed) : ZalgoPromise<R> {\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        if (isPromise(error)) {\n            throw new Error('Can not reject promise with another promise');\n        }\n\n        if (!error) {\n            // $FlowFixMe\n            let err = (error && typeof error.toString === 'function' ? error.toString() : Object.prototype.toString.call(error));\n            error = new Error(`Expected reject to be called with Error, got ${ err }`);\n        }\n\n        this.rejected = true;\n        this.error = error;\n\n        if (!this.errorHandled) {\n            setTimeout(() => {\n                if (!this.errorHandled) {\n                    dispatchPossiblyUnhandledError(error, this);\n                }\n            }, 1);\n        }\n\n        this.dispatch();\n\n        return this;\n    }\n\n    asyncReject(error : mixed) : ZalgoPromise<R> {\n        this.errorHandled = true;\n        this.reject(error);\n        return this;\n    }\n    \n    dispatch() {\n\n        let { dispatching, resolved, rejected, handlers } = this;\n\n        if (dispatching) {\n            return;\n        }\n\n        if (!resolved && !rejected) {\n            return;\n        }\n\n        this.dispatching = true;\n        startActive();\n\n        const chain = <T>(firstPromise : ZalgoPromise<T>, secondPromise : ZalgoPromise<T>) => {\n            return firstPromise.then(res => {\n                secondPromise.resolve(res);\n            }, err => {\n                secondPromise.reject(err);\n            });\n        };\n\n        for (let i = 0; i < handlers.length; i++) {\n\n            let { onSuccess, onError, promise } = handlers[i];\n\n            let result;\n\n            if (resolved) {\n\n                try {\n                    result = onSuccess ? onSuccess(this.value) : this.value;\n                } catch (err) {\n                    promise.reject(err);\n                    continue;\n                }\n\n            } else if (rejected) {\n\n                if (!onError) {\n                    promise.reject(this.error);\n                    continue;\n                }\n\n                try {\n                    result = onError(this.error);\n                } catch (err) {\n                    promise.reject(err);\n                    continue;\n                }\n            }\n\n            if (result instanceof ZalgoPromise && (result.resolved || result.rejected)) {\n\n                if (result.resolved) {\n                    promise.resolve(result.value);\n                } else {\n                    promise.reject(result.error);\n                }\n\n                result.errorHandled = true;\n\n            } else if (isPromise(result)) {\n\n                if (result instanceof ZalgoPromise && (result.resolved || result.rejected)) {\n                    if (result.resolved) {\n                        promise.resolve(result.value);\n                    } else {\n                        promise.reject(result.error);\n                    }\n\n                } else {\n                    // $FlowFixMe\n                    chain(result, promise);\n                }\n\n            } else {\n\n                promise.resolve(result);\n            }\n        }\n\n        handlers.length = 0;\n        this.dispatching = false;\n        endActive();\n    }\n\n    then<X : mixed, Y : mixed>(onSuccess : void | (result : R) => (ZalgoPromise<X> | Y), onError : void | (error : mixed) => (ZalgoPromise<X> | Y)) : ZalgoPromise<X | Y> {\n\n        if (onSuccess && typeof onSuccess !== 'function' && !onSuccess.call) {\n            throw new Error('Promise.then expected a function for success handler');\n        }\n\n        if (onError && typeof onError !== 'function' && !onError.call) {\n            throw new Error('Promise.then expected a function for error handler');\n        }\n\n        let promise : ZalgoPromise<X | Y> = new ZalgoPromise();\n\n        this.handlers.push({\n            promise,\n            onSuccess,\n            onError\n        });\n\n        this.errorHandled = true;\n\n        this.dispatch();\n\n        return promise;\n    }\n\n    catch<X : mixed, Y : mixed>(onError : (error : mixed) => ZalgoPromise<X> | Y) : ZalgoPromise<X | Y> {\n        return this.then(undefined, onError);\n    }\n\n    finally(onFinally : () => mixed) : ZalgoPromise<R> {\n\n        if (onFinally && typeof onFinally !== 'function' && !onFinally.call) {\n            throw new Error('Promise.finally expected a function');\n        }\n\n        return this.then((result) => {\n            return ZalgoPromise.try(onFinally)\n                .then(() => {\n                    return result;\n                });\n        }, (err) => {\n            return ZalgoPromise.try(onFinally)\n                .then(() => {\n                    throw err;\n                });\n        });\n    }\n\n    timeout(time : number, err : ?Error) : ZalgoPromise<R> {\n\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        let timeout = setTimeout(() => {\n\n            if (this.resolved || this.rejected) {\n                return;\n            }\n\n            this.reject(err || new Error(`Promise timed out after ${ time }ms`));\n\n        }, time);\n\n        return this.then(result => {\n            clearTimeout(timeout);\n            return result;\n        });\n    }\n\n    // $FlowFixMe\n    toPromise() : Promise<R> {\n        // $FlowFixMe\n        if (typeof Promise === 'undefined') {\n            throw new TypeError(`Could not find Promise`);\n        }\n        // $FlowFixMe\n        return Promise.resolve(this); // eslint-disable-line compat/compat\n    }\n\n    static resolve<X : mixed>(value : X | ZalgoPromise<X>) : ZalgoPromise<X> {\n\n        if (value instanceof ZalgoPromise) {\n            return value;\n        }\n\n        if (isPromise(value)) {\n            // $FlowFixMe\n            return new ZalgoPromise((resolve, reject) => value.then(resolve, reject));\n        }\n\n        return new ZalgoPromise().resolve(value);\n    }\n\n    static reject(error : mixed) : ZalgoPromise<R> {\n        return new ZalgoPromise().reject(error);\n    }\n\n    static asyncReject(error : mixed) : ZalgoPromise<R> {\n        return new ZalgoPromise().asyncReject(error);\n    }\n\n    static all<X : Array<mixed>>(promises : X) : ZalgoPromise<$TupleMap<X, <Y>(ZalgoPromise<Y> | Y) => Y>> { // eslint-disable-line no-undef\n\n        let promise = new ZalgoPromise();\n        let count = promises.length;\n        let results = [];\n\n        if (!count) {\n            promise.resolve(results);\n            return promise;\n        }\n\n        const chain = <T>(i : number, firstPromise : ZalgoPromise<T>, secondPromise : ZalgoPromise<T>) => {\n            return firstPromise.then(res => {\n                results[i] = res;\n                count -= 1;\n                if (count === 0) {\n                    promise.resolve(results);\n                }\n            }, err => {\n                secondPromise.reject(err);\n            });\n        };\n\n        for (let i = 0; i < promises.length; i++) {\n            let prom = promises[i];\n\n            if (prom instanceof ZalgoPromise) {\n                if (prom.resolved) {\n                    results[i] = prom.value;\n                    count -= 1;\n                    continue;\n                }\n            } else if (!isPromise(prom)) {\n                results[i] = prom;\n                count -= 1;\n                continue;\n            }\n\n            chain(i, ZalgoPromise.resolve(prom), promise);\n        }\n\n        if (count === 0) {\n            promise.resolve(results);\n        }\n\n        return promise;\n    }\n\n    static hash<O : Object>(promises : O) : ZalgoPromise<$ObjMap<O, <Y>(ZalgoPromise<Y> | Y) => Y>> { // eslint-disable-line no-undef\n        let result = {};\n        \n        return ZalgoPromise.all(Object.keys(promises).map(key => {\n            return ZalgoPromise.resolve(promises[key]).then(value => {\n                result[key] = value;\n            });\n        })).then(() => {\n            return result;\n        });\n    }\n\n    static map<T, X>(items : Array<T>, method : (T) => (ZalgoPromise<X> | X)) : ZalgoPromise<Array<X>> {\n        // $FlowFixMe\n        return ZalgoPromise.all(items.map(method));\n    }\n\n    static onPossiblyUnhandledException(handler : (err : mixed) => void) : { cancel : () => void } {\n        return onPossiblyUnhandledException(handler);\n    }\n\n    static try<X : mixed, Y : mixed, C : mixed, A : Array<mixed>>(method : (...args : A) => (ZalgoPromise<X> | Y), context : ?C, args : ?A) : ZalgoPromise<X | Y> {\n\n        if (method && typeof method !== 'function' && !method.call) {\n            throw new Error('Promise.try expected a function');\n        }\n\n        let result;\n\n        startActive();\n        \n        try {\n            // $FlowFixMe\n            result = method.apply(context, args || []);\n        } catch (err) {\n            endActive();\n            return ZalgoPromise.reject(err);\n        }\n\n        endActive();\n\n        return ZalgoPromise.resolve(result);\n    }\n\n    static delay(delay : number) : ZalgoPromise<void> {\n        return new ZalgoPromise(resolve => {\n            setTimeout(resolve, delay);\n        });\n    }\n\n    static isPromise(value : mixed) : boolean {\n\n        if (value && value instanceof ZalgoPromise) {\n            return true;\n        }\n\n        return isPromise(value);\n    }\n\n    static flush() : ZalgoPromise<void> {\n        return awaitActive(ZalgoPromise);\n    }\n}\n","/* @flow */\n\nexport function getUserAgent() : string {\n    return window.navigator.mockUserAgent || window.navigator.userAgent;\n}\n\nexport function isDevice(userAgent? : string = getUserAgent()) : boolean {\n    if (userAgent.match(/Android|webOS|iPhone|iPad|iPod|bada|Symbian|Palm|CriOS|BlackBerry|IEMobile|WindowsMobile|Opera Mini/i)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function isWebView() : boolean {\n    let userAgent = getUserAgent();\n    return (/(iPhone|iPod|iPad|Macintosh).*AppleWebKit(?!.*Safari)/i).test(userAgent) ||\n        (/\\bwv\\b/).test(userAgent) ||\n    (/Android.*Version\\/(\\d)\\.(\\d)/i).test(userAgent);\n}\n\nexport function isStandAlone() : boolean {\n    return (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches);\n}\n\nexport function isFacebookWebView(ua? : string = getUserAgent()) : boolean {\n    return (ua.indexOf('FBAN') !== -1) || (ua.indexOf('FBAV') !== -1);\n}\n\nexport function isFirefoxIOS(ua? : string = getUserAgent()) : boolean {\n    return (/FxiOS/i).test(ua);\n}\n\nexport function isEdgeIOS(ua? : string = getUserAgent()) : boolean {\n    return (/EdgiOS/i).test(ua);\n}\n\nexport function isOperaMini(ua? : string = getUserAgent()) : boolean {\n    return ua.indexOf('Opera Mini') > -1;\n}\n\nexport function isAndroid(ua? : string = getUserAgent()) : boolean {\n    return (/Android/).test(ua);\n}\n\nexport function isIos(ua? : string = getUserAgent()) : boolean {\n    return (/iPhone|iPod|iPad/).test(ua);\n}\n\nexport function isGoogleSearchApp(ua? : string = getUserAgent()) : boolean {\n    return (/\\bGSA\\b/).test(ua);\n}\n\nexport function isQQBrowser(ua? : string = getUserAgent()) : boolean {\n    return (/QQBrowser/).test(ua);\n}\n\nexport function isIosWebview(ua? : string = getUserAgent()) : boolean {\n    if (isIos(ua)) {\n        if (isGoogleSearchApp(ua)) {\n            return true;\n        }\n        return (/.+AppleWebKit(?!.*Safari)/).test(ua);\n    }\n    return false;\n}\n\nexport function isAndroidWebview(ua? : string = getUserAgent()) : boolean {\n    if (isAndroid(ua)) {\n        return (/Version\\/[\\d.]+/).test(ua) && !isOperaMini(ua);\n    }\n    return false;\n}\n\nexport function isIE() : boolean {\n\n    if (window.document.documentMode) {\n        return true;\n    }\n\n    return Boolean(\n        window.navigator &&\n        window.navigator.userAgent &&\n        (/Edge|MSIE|rv:11/i).test(window.navigator.userAgent)\n    );\n}\n\nexport function isIECompHeader() : boolean {\n    let mHttp = window.document.querySelector('meta[http-equiv=\"X-UA-Compatible\"]');\n    let mContent = window.document.querySelector('meta[content=\"IE=edge\"]');\n    if (mHttp && mContent) {\n        return true;\n    }\n    return false;\n}\n\nexport function isElectron() : boolean {\n    if (typeof process !== 'undefined' && process.versions && process.versions.electron) {\n        return true;\n    }\n    return false;\n}\n\nexport function isIEIntranet() : boolean {\n\n    // This status check only works for older versions of IE with document.documentMode set\n\n    if (window.document.documentMode) {\n        try {\n            let status = window.status;\n\n            window.status = 'testIntranetMode';\n\n            if (window.status === 'testIntranetMode') {\n                window.status = status;\n\n                return true;\n            }\n\n            return false;\n\n        } catch (err) {\n\n            return false;\n        }\n    }\n\n    return false;\n}\n\nexport function isMacOsCna() : boolean {\n    let userAgent = getUserAgent();\n    return (/Macintosh.*AppleWebKit(?!.*Safari)/i).test(userAgent);\n}\n\nexport function supportsPopups(ua? : string = getUserAgent()) : boolean {\n    return !(isIosWebview(ua) || isAndroidWebview(ua) || isOperaMini(ua) ||\n        isFirefoxIOS(ua) || isEdgeIOS(ua) || isFacebookWebView(ua) || isQQBrowser(ua) || isElectron() || isMacOsCna() || isStandAlone());\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","/* @flow */\n\nexport function hasNativeWeakMap() : boolean {\n\n    if (typeof WeakMap === 'undefined') {\n        return false;\n    }\n\n    if (typeof Object.freeze === 'undefined') {\n        return false;\n    }\n\n    try {\n\n        let testWeakMap = new WeakMap();\n        let testKey = {};\n        let testValue = '__testvalue__';\n\n        Object.freeze(testKey);\n\n        testWeakMap.set(testKey, testValue);\n\n        if (testWeakMap.get(testKey) === testValue) {\n            return true;\n        }\n\n        return false;\n\n    } catch (err) {\n\n        return false;\n    }\n}\n","/* @flow */\n\nexport function safeIndexOf<T>(collection : Array<T>, item : T) : number {\n    for (let i = 0; i < collection.length; i++) {\n\n        try {\n            if (collection[i] === item) {\n                return i;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    return -1;\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n","/* @flow */\n\nimport { isWindow, isWindowClosed } from 'cross-domain-utils/src';\n\nimport { hasNativeWeakMap } from './native';\nimport { noop, safeIndexOf } from './util';\n\nexport class CrossDomainSafeWeakMap<K : Object, V : mixed> {\n\n    name : string\n    weakmap : ?WeakMap<K, V>\n    keys : Array<K>\n    values : Array<V>\n\n    constructor() {\n        // eslint-disable-next-line no-bitwise\n        this.name = `__weakmap_${ Math.random() * 1e9 >>> 0 }__`;\n\n        if (hasNativeWeakMap()) {\n            try {\n                this.weakmap = new WeakMap();\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this.keys  = [];\n        this.values = [];\n    }\n\n    _cleanupClosedWindows() {\n\n        let weakmap = this.weakmap;\n        let keys = this.keys;\n\n        for (let i = 0; i < keys.length; i++) {\n            let value = keys[i];\n\n            if (isWindow(value) && isWindowClosed(value)) {\n\n                if (weakmap) {\n                    try {\n                        weakmap.delete(value);\n                    } catch (err) {\n                        // pass\n                    }\n                }\n\n                keys.splice(i, 1);\n                this.values.splice(i, 1);\n\n                i -= 1;\n            }\n        }\n    }\n\n    isSafeToReadWrite(key : K) : boolean {\n\n        if (isWindow(key)) {\n            return false;\n        }\n\n        try {\n            noop(key && key.self);\n            noop(key && key[this.name]);\n        } catch (err) {\n            return false;\n        }\n\n        return true;\n    }\n\n    set(key : K, value : V) {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                weakmap.set(key, value);\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let name = this.name;\n                let entry = key[name];\n\n                if (entry && entry[0] === key) {\n                    entry[1] = value;\n                } else {\n                    Object.defineProperty(key, name, {\n                        value:    [ key, value ],\n                        writable: true\n                    });\n                }\n\n                return;\n\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let values = this.values;\n        let index = safeIndexOf(keys, key);\n\n        if (index === -1) {\n            keys.push(key);\n            values.push(value);\n        } else {\n            values[index] = value;\n        }\n    }\n\n    get(key : K) : V | void {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                if (weakmap.has(key)) {\n                    return weakmap.get(key);\n                }\n                \n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    return entry[1];\n                }\n\n                return;\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let index = safeIndexOf(keys, key);\n\n        if (index === -1) {\n            return;\n        }\n\n        return this.values[index];\n    }\n\n    delete(key : K) {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                weakmap.delete(key);\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    entry[0] = entry[1] = undefined;\n                }\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let index = safeIndexOf(keys, key);\n\n        if (index !== -1) {\n            keys.splice(index, 1);\n            this.values.splice(index, 1);\n        }\n    }\n\n    has(key : K) : boolean {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                if (weakmap.has(key)) {\n                    return true;\n                }\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    return true;\n                }\n\n                return false;\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let index = safeIndexOf(this.keys, key);\n        return index !== -1;\n    }\n\n    getOrSet(key : K, getter : () => V) : V {\n        if (this.has(key)) {\n            // $FlowFixMe\n            return this.get(key);\n        }\n\n        let value = getter();\n        this.set(key, value);\n        return value;\n    }\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\n\nimport type { CancelableType } from './types';\n\nexport function getFunctionName <T : Function>(fn : T) : string {\n    return fn.name || fn.__name__ || fn.displayName || 'anonymous';\n}\n\nexport function setFunctionName <T : Function>(fn : T, name : string) : T {\n    try {\n        delete fn.name;\n        fn.name = name;\n    } catch (err) {\n        // pass\n    }\n\n    fn.__name__ = fn.displayName = name;\n    return fn;\n}\n\nexport function base64encode(str : string) : string {\n    if (typeof btoa === 'function') {\n        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (m, p1) => {\n            return String.fromCharCode(parseInt(p1, 16));\n        }));\n    }\n\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str, 'utf8').toString('base64');\n    }\n\n    throw new Error(`Can not find window.btoa or Buffer`);\n}\n\nexport function base64decode(str : string) : string {\n    if (typeof atob === 'function') {\n        return decodeURIComponent(Array.prototype.map.call(atob(str), c => {\n            // eslint-disable-next-line prefer-template\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n    }\n\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str, 'base64').toString('utf8');\n    }\n\n    throw new Error(`Can not find window.atob or Buffer`);\n}\n\nexport function uniqueID() : string {\n\n    let chars = '0123456789abcdef';\n\n    let randomID = 'xxxxxxxxxx'.replace(/./g, () => {\n        return chars.charAt(Math.floor(Math.random() * chars.length));\n    });\n\n    let timeID = base64encode(\n        new Date().toISOString().slice(11, 19).replace('T', '.')\n    ).replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n\n    return `${ randomID }_${ timeID }`;\n}\n\nexport function getGlobal() : Object {\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    if (typeof __GLOBAL__ !== 'undefined') {\n        return __GLOBAL__;\n    }\n    throw new Error(`No global found`);\n}\n\nlet objectIDs;\n\nexport function getObjectID(obj : Object) : string {\n\n    objectIDs = objectIDs || new WeakMap();\n\n    if (obj === null || obj === undefined || (typeof obj !== 'object' && typeof obj !== 'function')) {\n        throw new Error(`Invalid object`);\n    }\n\n    let uid = objectIDs.get(obj);\n\n    if (!uid) {\n        uid = `${ typeof obj }:${ uniqueID() }`;\n        objectIDs.set(obj, uid);\n    }\n\n    return uid;\n}\n\nfunction serializeArgs<T>(args : Array<T>) : string {\n    try {\n        return JSON.stringify(Array.prototype.slice.call(args), (subkey, val) => {\n            if (typeof val === 'function') {\n                return `memoize[${ getObjectID(val) }]`;\n            }\n            return val;\n        });\n    } catch (err) {\n        throw new Error(`Arguments not serializable -- can not be used to memoize`);\n    }\n}\nexport function memoize<A, R, F : (...args : Array<A>) => R, X : { (...args : Array<A>) : R, displayName : string, reset : () => void }>(method : F, options : { time? : number, thisNamespace? : boolean } = {}) : X {\n    let cacheMap = new WeakMap();\n\n    // $FlowFixMe\n    let memoizedFunction : X = function memoizedFunction(...args : Array<A>) : R {\n        let cache = cacheMap.getOrSet(options.thisNamespace ? this : method, () => ({}));\n\n        let key : string = serializeArgs(args);\n\n        let cacheTime = options.time;\n        if (cache[key] && cacheTime && (Date.now() - cache[key].time) < cacheTime) {\n            delete cache[key];\n        }\n\n        if (cache[key]) {\n            return cache[key].value;\n        }\n\n        let time  = Date.now();\n        let value = method.apply(this, arguments);\n\n        cache[key] = { time, value };\n\n        return cache[key].value;\n    };\n\n    memoizedFunction.reset = () => {\n        cacheMap.delete(options.thisNamespace ? this : method);\n    };\n\n    return setFunctionName(memoizedFunction, `${ getFunctionName(method) }::memoized`);\n}\n\nexport function promiseIdentity<T : mixed>(item : ZalgoPromise<T> | T) : ZalgoPromise<T> {\n    // $FlowFixMe\n    return ZalgoPromise.resolve(item);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function memoizePromise<R>(method : (...args : Array<any>) => ZalgoPromise<R>) : ((...args : Array<any>) => ZalgoPromise<R>) {\n    let cache = {};\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    function memoizedPromiseFunction(...args : Array<any>) : ZalgoPromise<R> {\n        let key : string = serializeArgs(args);\n\n        if (cache.hasOwnProperty(key)) {\n            return cache[key];\n        }\n\n        cache[key] = ZalgoPromise.try(() => method.apply(this, arguments))\n            .finally(() => {\n                delete cache[key];\n            });\n\n        return cache[key];\n    }\n\n    memoizedPromiseFunction.reset = () => {\n        cache = {};\n    };\n\n    return setFunctionName(memoizedPromiseFunction, `${ getFunctionName(method) }::promiseMemoized`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function promisify<R>(method : (...args : Array<any>) => R, options : { name? : string } = {}) : ((...args : Array<any>) => ZalgoPromise<R>) {\n    function promisifiedFunction() : ZalgoPromise<R> {\n        return ZalgoPromise.try(method, this, arguments);\n    }\n\n    if (options.name) {\n        promisifiedFunction.displayName = `${ options.name }:promisified`;\n    }\n\n    return setFunctionName(promisifiedFunction, `${ getFunctionName(method) }::promisified`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function inlineMemoize<R>(method : (...args : Array<any>) => R, logic : (...args : Array<any>) => R, args : Array<any> = []) : R {\n    // $FlowFixMe\n    let cache = method.__inline_memoize_cache__ = method.__inline_memoize_cache__ || {};\n    let key = serializeArgs(args);\n\n    if (cache.hasOwnProperty(key)) {\n        return cache[key];\n    }\n    \n    let result = cache[key] = logic(...args);\n\n    return result;\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n\nexport function once(method : Function) : Function {\n    let called = false;\n\n    const onceFunction = function() : mixed {\n        if (!called) {\n            called = true;\n            return method.apply(this, arguments);\n        }\n    };\n\n    return setFunctionName(onceFunction, `${ getFunctionName(method) }::once`);\n}\n\nexport function hashStr(str : string) : number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash += str[i].charCodeAt(0) * Math.pow((i % 10) + 1, 5);\n    }\n    return Math.floor(Math.pow(Math.sqrt(hash), 5));\n}\n\nexport function strHashStr(str : string) : string {\n    let hash = '';\n\n    for (let i = 0; i < str.length; i++) {\n        let total = (str[i].charCodeAt(0) * i);\n\n        if (str[i + 1]) {\n            total += (str[i + 1].charCodeAt(0) * (i - 1));\n        }\n\n        hash += String.fromCharCode(97 + (Math.abs(total) % 26));\n    }\n\n    return hash;\n}\n\nexport function match(str : string, pattern : RegExp) : ?string {\n    let regmatch = str.match(pattern);\n    if (regmatch) {\n        return regmatch[1];\n    }\n}\n\nexport function awaitKey<T: mixed>(obj : Object, key : string) : ZalgoPromise<T> {\n    return new ZalgoPromise(resolve => {\n\n        let value = obj[key];\n\n        if (value) {\n            return resolve(value);\n        }\n\n        delete obj[key];\n\n        Object.defineProperty(obj, key, {\n\n            configurable: true,\n\n            set(item) {\n                value = item;\n\n                if (value) {\n                    resolve(value);\n                }\n            },\n\n            get() : mixed {\n                return value;\n            }\n        });\n    });\n}\n\nexport function stringifyError(err : mixed, level : number = 1) : string {\n\n    if (level >= 3) {\n        return 'stringifyError stack overflow';\n    }\n\n    try {\n        if (!err) {\n            return `<unknown error: ${ Object.prototype.toString.call(err) }>`;\n        }\n\n        if (typeof err === 'string') {\n            return err;\n        }\n\n        if (err instanceof Error) {\n            let stack = err && err.stack;\n            let message = err && err.message;\n\n            if (stack && message) {\n                if (stack.indexOf(message) !== -1) {\n                    return stack;\n                } else {\n                    return `${ message }\\n${ stack }`;\n                }\n            } else if (stack) {\n                return stack;\n            } else if (message) {\n                return message;\n            }\n        }\n\n        if (err && err.toString && typeof err.toString === 'function') {\n            // $FlowFixMe\n            return err.toString();\n        }\n\n        return Object.prototype.toString.call(err);\n\n    } catch (newErr) { // eslint-disable-line unicorn/catch-error-name\n        return `Error while stringifying error: ${ stringifyError(newErr, level + 1) }`;\n    }\n}\n\nexport function stringifyErrorMessage(err : mixed) : string {\n\n    let defaultMessage = `<unknown error: ${ Object.prototype.toString.call(err) }>`;\n\n    if (!err) {\n        return defaultMessage;\n    }\n\n    if (err instanceof Error) {\n        return err.message || defaultMessage;\n    }\n\n    if (typeof err.message === 'string') {\n        return err.message || defaultMessage;\n    }\n\n    return defaultMessage;\n}\n\nexport function stringify(item : mixed) : string {\n    if (typeof item === 'string') {\n        return item;\n    }\n\n    if (item && item.toString && typeof item.toString === 'function') {\n        // $FlowFixMe\n        return item.toString();\n    }\n\n    return Object.prototype.toString.call(item);\n}\n\nexport function domainMatches(hostname : string, domain : string) : boolean {\n    hostname = hostname.split('://')[1];\n    let index = hostname.indexOf(domain);\n    return (index !== -1 && hostname.slice(index) === domain);\n}\n\nexport function patchMethod(obj : Object, name : string, handler : Function) {\n    let original = obj[name];\n\n    obj[name] = function patchedMethod() : mixed {\n        return handler({\n            context:      this,\n            args:         Array.prototype.slice.call(arguments),\n            original,\n            callOriginal: () => original.apply(this, arguments)\n        });\n    };\n}\n\nexport function extend<T : Object | Function>(obj : T, source : Object) : T {\n    if (!source) {\n        return obj;\n    }\n\n    if (Object.assign) {\n        return Object.assign(obj, source);\n    }\n\n    for (let key in source) {\n        if (source.hasOwnProperty(key)) {\n            obj[key] = source[key];\n        }\n    }\n\n    return obj;\n}\n\nexport function values<T>(obj : { [string] : T }) : Array<T> {\n    let result = [];\n    for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            result.push(obj[key]);\n        }\n    }\n    return result;\n}\n\nexport function perc(pixels : number, percentage : number) : number {\n    return Math.round((pixels * percentage) / 100);\n}\n\nexport function min(...args : Array<number>) : number {\n    return Math.min(...args);\n}\n\nexport function max(...args : Array<number>) : number {\n    return Math.max(...args);\n}\n\nexport function regexMap<T>(str : string, regexp : RegExp, handler : () => T) : Array<T> {\n    let results = [];\n\n    // $FlowFixMe\n    str.replace(regexp, function regexMapMatcher(item) {\n        results.push(handler ? handler.apply(null, arguments) : item);\n    });\n\n    // $FlowFixMe\n    return results;\n}\n\nexport function svgToBase64(svg : string) : string {\n    return `data:image/svg+xml;base64,${ base64encode(svg) }`;\n}\n\nexport function objFilter<T, R>(obj : { [string] : T }, filter? : (T, ?string) => mixed = Boolean) : { [string] : R } {\n    let result = {};\n\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || !filter(obj[key], key)) {\n            continue;\n        }\n\n        result[key] = obj[key];\n    }\n\n    return result;\n}\n\nexport function identity <T>(item : T) : T {\n    return item;\n}\n\nexport function regexTokenize(text : string, regexp : RegExp) : Array<string> {\n    let result = [];\n    text.replace(regexp, token => {\n        result.push(token);\n        return '';\n    });\n    return result;\n}\n\nexport function promiseDebounce<T>(method : () => ZalgoPromise<T> | T, delay : number = 50) : () => ZalgoPromise<T> {\n\n    let promise;\n    let timeout;\n\n    const promiseDebounced = function() : ZalgoPromise<T> {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n\n        let localPromise = promise = promise || new ZalgoPromise();\n\n        timeout = setTimeout(() => {\n            promise = null;\n            timeout = null;\n\n            ZalgoPromise.try(method).then(\n                result => { localPromise.resolve(result); },\n                err => { localPromise.reject(err); }\n            );\n        }, delay);\n\n        return localPromise;\n    };\n\n    return setFunctionName(promiseDebounced, `${ getFunctionName(method) }::promiseDebounced`);\n}\n\nexport function safeInterval(method : Function, time : number) : { cancel : () => void } {\n\n    let timeout;\n\n    function loop() {\n        timeout = setTimeout(() => {\n            method();\n            loop();\n        }, time);\n    }\n\n    loop();\n\n    return {\n        cancel() {\n            clearTimeout(timeout);\n        }\n    };\n}\n\nexport function isInteger(str : string) : boolean {\n    return Boolean(str.match(/^[0-9]+$/));\n}\n\nexport function isFloat(str : string) : boolean {\n    return Boolean(str.match(/^[0-9]+\\.[0-9]+$/));\n}\n\nexport function serializePrimitive(value : string | number | boolean) : string {\n    return value.toString();\n}\n\nexport function deserializePrimitive(value : string) : string | number | boolean {\n    if (value === 'true') {\n        return true;\n    } else if (value === 'false') {\n        return false;\n    } else if (isInteger(value)) {\n        return parseInt(value, 10);\n    } else if (isFloat(value)) {\n        return parseFloat(value);\n    } else {\n        return value;\n    }\n}\n\nexport function dotify(obj : Object, prefix : string = '', newobj : Object = {}) : { [string] : string } {\n    prefix = prefix ? `${ prefix }.` : prefix;\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || obj[key] === undefined || obj[key] === null || typeof obj[key] === 'function') {\n            continue;\n        } else if (obj[key] && Array.isArray(obj[key]) && obj[key].length && obj[key].every(val => typeof val !== 'object')) {\n            newobj[`${ prefix }${ key }[]`] = obj[key].join(',');\n        } else if (obj[key] && typeof obj[key] === 'object') {\n            newobj = dotify(obj[key], `${ prefix }${ key }`, newobj);\n        } else {\n            newobj[`${ prefix }${ key }`] = serializePrimitive(obj[key]);\n        }\n    }\n    return newobj;\n}\n\nexport function undotify(obj : { [string] : string }) : Object {\n    \n    let result = {};\n\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || typeof obj[key] !== 'string') {\n            continue;\n        }\n\n        let value = obj[key];\n\n        if (key.match(/^.+\\[\\]$/)) {\n            key = key.slice(0, key.length - 2);\n            value = value.split(',').map(deserializePrimitive);\n        } else {\n            value = deserializePrimitive(value);\n        }\n\n        let keyResult = result;\n        let parts = key.split('.');\n        for (let i = 0; i < parts.length; i++) {\n            let part = parts[i];\n            let isLast = (i + 1 === parts.length);\n            let isIndex = !isLast && isInteger(parts[i + 1]);\n\n            if (part === 'constructor' || part === 'prototype' || part === '__proto__') {\n                throw new Error(`Disallowed key: ${ part }`);\n            }\n\n            if (isLast) {\n                // $FlowFixMe\n                keyResult[part] = value;\n            } else {\n                // $FlowFixMe\n                keyResult = keyResult[part] = keyResult[part] || (isIndex ? [] : {});\n            }\n        }\n    }\n\n    return result;\n}\n\nexport type EventEmitterType = {\n    on : (eventName : string, handler : Function) => CancelableType,\n    once : (eventName : string, handler : Function) => CancelableType,\n    trigger : (eventName : string, ...args : $ReadOnlyArray<mixed>) => ZalgoPromise<void>,\n    triggerOnce : (eventName : string, ...args : $ReadOnlyArray<mixed>) => ZalgoPromise<void>\n};\n\nexport function eventEmitter() : EventEmitterType {\n    let triggered = {};\n    let handlers = {};\n\n    return {\n\n        on(eventName : string, handler : Function) : CancelableType {\n            let handlerList = handlers[eventName] = handlers[eventName] || [];\n\n            handlerList.push(handler);\n\n            let cancelled = false;\n\n            return {\n                cancel() {\n                    if (!cancelled) {\n                        cancelled = true;\n                        handlerList.splice(handlerList.indexOf(handler), 1);\n                    }\n\n                }\n            };\n        },\n\n        once(eventName : string, handler : Function) : CancelableType {\n\n            let listener = this.on(eventName, () => {\n                listener.cancel();\n                handler();\n            });\n\n            return listener;\n        },\n\n        trigger(eventName : string, ...args : $ReadOnlyArray<mixed>) : ZalgoPromise<void> {\n\n            let handlerList = handlers[eventName];\n            let promises = [];\n\n            if (handlerList) {\n                for (let handler of handlerList) {\n                    promises.push(ZalgoPromise.try(() => handler(...args)));\n                }\n            }\n\n            return ZalgoPromise.all(promises).then(noop);\n        },\n\n        triggerOnce(eventName : string, ...args : $ReadOnlyArray<mixed>) : ZalgoPromise<void> {\n\n            if (triggered[eventName]) {\n                return ZalgoPromise.resolve();\n            }\n\n            triggered[eventName] = true;\n            return this.trigger(eventName, ...args);\n        }\n    };\n}\n\nexport function camelToDasherize(string : string) : string {\n    return string.replace(/([A-Z])/g, (g) => {\n        return `-${ g.toLowerCase() }`;\n    });\n}\n\nexport function dasherizeToCamel(string : string) : string {\n    return string.replace(/-([a-z])/g, (g) => {\n        return g[1].toUpperCase();\n    });\n}\n\nexport function capitalizeFirstLetter(string : string) : string {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}\n\nexport function get(item : Object, path : string, def : mixed) : mixed {\n\n    if (!path) {\n        return def;\n    }\n\n    let pathParts = path.split('.');\n\n    // Loop through each section of our key path\n\n    for (let i = 0; i < pathParts.length; i++) {\n\n        // If we have an object, we can get the key\n        if (typeof item === 'object' && item !== null) {\n            item = item[pathParts[i]];\n\n        // Otherwise, we should return the default (undefined if not provided)\n        } else {\n            return def;\n        }\n    }\n\n    // If our final result is undefined, we should return the default\n\n    return item === undefined ? def : item;\n}\n\nexport function safeTimeout(method : Function, time : number) {\n\n    let interval = safeInterval(() => {\n        time -= 100;\n        if (time <= 0) {\n            interval.cancel();\n            method();\n        }\n    }, 100);\n}\n\nexport function defineLazyProp<T>(obj : Object | Array<mixed>, key : string | number, getter : () => T) {\n    if (Array.isArray(obj)) {\n        if (typeof key !== 'number') {\n            throw new TypeError(`Array key must be number`);\n        }\n    } else if (typeof obj === 'object' && obj !== null) {\n        if (typeof key !== 'string') {\n            throw new TypeError(`Object key must be string`);\n        }\n    }\n    \n    Object.defineProperty(obj, key, {\n        configurable: true,\n        enumerable:   true,\n        get:          () => {\n            // $FlowFixMe\n            delete obj[key];\n            let value = getter();\n            // $FlowFixMe\n            obj[key] = value;\n            return value;\n        },\n        set: (value : T) => {\n            // $FlowFixMe\n            delete obj[key];\n            // $FlowFixMe\n            obj[key] = value;\n        }\n    });\n}\n\nexport function arrayFrom<T>(item : Iterable<T>) : Array<T> { // eslint-disable-line no-undef\n    return Array.prototype.slice.call(item);\n}\n\nexport function isObject(item : mixed) : boolean {\n    return (typeof item === 'object' && item !== null);\n}\n\nexport function isObjectObject(obj : mixed) : boolean {\n    return isObject(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nexport function isPlainObject(obj : mixed) : boolean {\n    if (!isObjectObject(obj)) {\n        return false;\n    }\n\n    // $FlowFixMe\n    let constructor = obj.constructor;\n\n    if (typeof constructor !== 'function') {\n        return false;\n    }\n\n    let prototype = constructor.prototype;\n\n    if (!isObjectObject(prototype)) {\n        return false;\n    }\n\n    if (!prototype.hasOwnProperty('isPrototypeOf')) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function replaceObject<T : Array<mixed> | Object> (item : T, replacer : (mixed, string | number, string) => mixed, fullKey : string = '') : T {\n\n    if (Array.isArray(item)) {\n        let length = item.length;\n        let result : Array<mixed> = [];\n\n        for (let i = 0; i < length; i++) {\n\n            \n            defineLazyProp(result, i, () => {\n                let itemKey = fullKey ? `${ fullKey }.${ i }` : `${ i }`;\n                let el = item[i];\n\n                let child = replacer(el, i, itemKey);\n\n                if (isPlainObject(child) || Array.isArray(child)) {\n                    // $FlowFixMe\n                    child = replaceObject(child, replacer, itemKey);\n                }\n\n                return child;\n            });\n        }\n\n        // $FlowFixMe\n        return result;\n    } else if (isPlainObject(item)) {\n        let result = {};\n\n        for (let key in item) {\n            if (!item.hasOwnProperty(key)) {\n                continue;\n            }\n\n            defineLazyProp(result, key, () => {\n                let itemKey = fullKey ? `${ fullKey }.${ key }` : `${ key }`;\n                // $FlowFixMe\n                let el = item[key];\n\n                let child = replacer(el, key, itemKey);\n\n                if (isPlainObject(child) || Array.isArray(child)) {\n                    // $FlowFixMe\n                    child = replaceObject(child, replacer, itemKey);\n                }\n\n                return child;\n            });\n        }\n\n        // $FlowFixMe\n        return result;\n    } else {\n        throw new Error(`Pass an object or array`);\n    }\n}\n\n\nexport function copyProp(source : Object, target : Object, name : string, def : mixed) {\n    if (source.hasOwnProperty(name)) {\n        let descriptor = Object.getOwnPropertyDescriptor(source, name);\n        // $FlowFixMe\n        Object.defineProperty(target, name, descriptor);\n\n    } else {\n        target[name] = def;\n    }\n}\n\ntype RegexResultType = {\n    text : string,\n    groups : Array<string>,\n    start : number,\n    end : number,\n    length : number,\n    replace : (text : string) => string\n};\n\nexport function regex(pattern : string | RegExp, string : string, start : number = 0) : ?RegexResultType {\n\n    if (typeof pattern === 'string') {\n        // eslint-disable-next-line security/detect-non-literal-regexp\n        pattern = new RegExp(pattern);\n    }\n\n    let result = string.slice(start).match(pattern);\n\n    if (!result) {\n        return;\n    }\n\n    // $FlowFixMe\n    let index : number = result.index;\n    let regmatch = result[0];\n\n    return {\n        text:   regmatch,\n        groups: result.slice(1),\n        start:  start + index,\n        end:    start + index + regmatch.length,\n        length: regmatch.length,\n\n        replace(text : string) : string {\n\n            if (!regmatch) {\n                return '';\n            }\n\n            return `${ regmatch.slice(0, start + index) }${ text }${ regmatch.slice(index + regmatch.length) }`;\n        }\n    };\n}\n\nexport function regexAll(pattern : string | RegExp, string : string) : Array<RegexResultType> {\n\n    let matches = [];\n    let start = 0;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        let regmatch = regex(pattern, string, start);\n\n        if (!regmatch) {\n            break;\n        }\n\n        matches.push(regmatch);\n        start = match.end;\n    }\n\n    return matches;\n}\n\nexport function isDefined(value : ?mixed) : boolean {\n    return value !== null && value !== undefined;\n}\n\nexport function cycle(method : Function) : ZalgoPromise<void> {\n    return ZalgoPromise.try(method).then(() => cycle(method));\n}\n\nexport function debounce<T>(method : (...args : Array<mixed>) => T, time : number = 100) : (...args : Array<mixed>) => void {\n\n    let timeout;\n\n    const debounceWrapper = function() {\n        clearTimeout(timeout);\n\n        timeout = setTimeout(() => {\n            return method.apply(this, arguments);\n        }, time);\n    };\n\n    return setFunctionName(debounceWrapper, `${ getFunctionName(method) }::debounced`);\n}\n\nexport function isRegex(item : mixed) : boolean {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\ntype FunctionProxy<T : Function> = (method : T) => T;\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport let weakMapMemoize : FunctionProxy<*> = <R : mixed>(method : (arg : any) => R) : ((...args : Array<any>) => R) => {\n\n    let weakmap = new WeakMap();\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    return function weakmapMemoized(arg : any) : R {\n        return weakmap.getOrSet(arg, () => method.call(this, arg));\n    };\n};\n\ntype FunctionPromiseProxy<R : mixed, T : (...args : $ReadOnlyArray<mixed>) => ZalgoPromise<R>> = (T) => T;\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport let weakMapMemoizePromise : FunctionPromiseProxy<*, *> = <R : mixed>(method : (arg : any) => ZalgoPromise<R>) : ((...args : Array<any>) => ZalgoPromise<R>) => {\n\n    let weakmap = new WeakMap();\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    return function weakmapMemoizedPromise(arg : any) : ZalgoPromise<R> {\n        return weakmap.getOrSet(arg, () =>\n            method.call(this, arg).finally(() => {\n                weakmap.delete(arg);\n            })\n        );\n    };\n};\n\nexport function getOrSet<O : Object, T : mixed>(obj : O, key : string, getter : () => T) : T {\n    if (obj.hasOwnProperty(key)) {\n        return obj[key];\n    }\n\n    const val = getter();\n    obj[key] = val;\n    return val;\n}\n\nexport type CleanupType = {|\n    set : <T : mixed>(string, T) => T, // eslint-disable-line no-undef\n    register : (Function) => void,\n    all : () => ZalgoPromise<void>\n|};\n\nexport function cleanup(obj : Object) : CleanupType {\n\n    const tasks = [];\n    let cleaned = false;\n\n    return {\n        set<T : mixed>(name : string, item : T) : T {\n            if (!cleaned) {\n                obj[name] = item;\n                this.register(() => {\n                    delete obj[name];\n                });\n            }\n            return item;\n        },\n\n        register(method : Function) {\n            if (cleaned) {\n                method();\n            } else {\n                tasks.push(once(method));\n            }\n        },\n\n        all() : ZalgoPromise<void> {\n            const results = [];\n            cleaned = true;\n\n            while (tasks.length) {\n                const task = tasks.pop();\n                results.push(task());\n            }\n\n            return ZalgoPromise.all(results).then(noop);\n        }\n    };\n}\n\nexport function tryCatch<T>(fn : () => T) : {| result : T, error : void |} | {| result : void, error : mixed |} {\n    let result;\n    let error;\n\n    try {\n        result = fn();\n    } catch (err) {\n        error = err;\n    }\n    \n    // $FlowFixMe\n    return { result, error };\n}\n\nexport function removeFromArray<X, T : Array<X>>(arr : T, item : X) {\n    const index = arr.indexOf(item);\n    if (index !== -1) {\n        arr.splice(index, 1);\n    }\n}\n\nexport function assertExists<T>(name : string, thing : void | null | T) : T {\n    if (thing === null || typeof thing === 'undefined') {\n        throw new Error(`Expected ${ name } to be present`);\n    }\n                            \n    return thing;\n}\n                            \nexport function unique(arr : $ReadOnlyArray<string>) : $ReadOnlyArray<string> {\n    const result = {};\n    for (const item of arr) {\n        // eslint-disable-next-line const-immutable/no-mutation\n        result[item] = true;\n    }\n    return Object.keys(result);\n}\n","/* @flow */\n\nexport const KEY_CODES = {\n    ENTER: 13\n};\n","/* @flow */\n/* eslint max-lines: off */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { linkFrameWindow, isWindowClosed,\n    type SameDomainWindowType, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\n\nimport { inlineMemoize, noop, stringify, capitalizeFirstLetter,\n    once, extend, safeInterval, uniqueID, arrayFrom } from './util';\nimport { isDevice } from './device';\nimport { KEY_CODES } from './constants';\nimport type { CancelableType } from './types';\n\ntype ElementRefType = string | HTMLElement;\n\nexport function isDocumentReady() : boolean {\n    return Boolean(document.body) && document.readyState === 'complete';\n}\n\nexport function urlEncode(str : string) : string {\n    return str.replace(/\\?/g, '%3F').replace(/&/g, '%26').replace(/#/g, '%23').replace(/\\+/g, '%2B');\n}\n\nexport function waitForWindowReady() : ZalgoPromise<void> {\n    return inlineMemoize(waitForWindowReady, () : ZalgoPromise<void> => {\n        return new ZalgoPromise(resolve => {\n            if (isDocumentReady()) {\n                resolve();\n            }\n\n            window.addEventListener('load', () => resolve());\n        });\n    });\n}\n\nexport function waitForDocumentReady() : ZalgoPromise<void> {\n    return inlineMemoize(waitForDocumentReady, () : ZalgoPromise<void> => {\n        return new ZalgoPromise(resolve => {\n\n            if (isDocumentReady()) {\n                return resolve();\n            }\n\n            let interval = setInterval(() => {\n                if (isDocumentReady()) {\n                    clearInterval(interval);\n                    return resolve();\n                }\n            }, 10);\n        });\n    });\n}\n\nexport function waitForDocumentBody() : ZalgoPromise<HTMLBodyElement> {\n    return waitForDocumentReady().then(() => {\n        if (document.body) {\n            return document.body;\n        }\n\n        throw new Error('Document ready but document.body not present');\n    });\n}\n\nexport function parseQuery(queryString : string) : Object {\n    return inlineMemoize(parseQuery, () : Object => {\n        let params = {};\n\n        if (!queryString) {\n            return params;\n        }\n\n        if (queryString.indexOf('=') === -1) {\n            return params;\n        }\n\n        for (let pair of queryString.split('&')) {\n            pair = pair.split('=');\n\n            if (pair[0] && pair[1]) {\n                params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n            }\n        }\n\n        return params;\n    }, [ queryString ]);\n}\n\n\nexport function getQueryParam(name : string) : string {\n    return parseQuery(window.location.search.slice(1))[name];\n}\n\nexport function urlWillRedirectPage(url : string) : boolean {\n\n    if (url.indexOf('#') === -1) {\n        return true;\n    }\n\n    if (url.indexOf('#') === 0) {\n        return false;\n    }\n\n    if (url.split('#')[0] === window.location.href.split('#')[0]) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function formatQuery(obj : { [ string ] : string } = {}) : string {\n\n    return Object.keys(obj).filter(key => {\n        return typeof obj[key] === 'string';\n    }).map(key => {\n        return `${ urlEncode(key) }=${ urlEncode(obj[key]) }`;\n    }).join('&');\n}\n\nexport function extendQuery(originalQuery : string, props : { [ string ] : string } = {}) : string {\n\n    if (!props || !Object.keys(props).length) {\n        return originalQuery;\n    }\n\n    return formatQuery({\n        ...parseQuery(originalQuery),\n        ...props\n    });\n}\n\nexport function extendUrl(url : string, options : { query? : { [string] : string }, hash? : { [string] : string } } = {}) : string {\n\n    let query = options.query || {};\n    let hash = options.hash || {};\n\n    let originalUrl;\n    let originalQuery;\n    let originalHash;\n\n    [ originalUrl, originalHash ] = url.split('#');\n    [ originalUrl, originalQuery ] = originalUrl.split('?');\n\n    let queryString = extendQuery(originalQuery, query);\n    let hashString = extendQuery(originalHash, hash);\n\n    if (queryString) {\n        originalUrl = `${ originalUrl }?${ queryString }`;\n    }\n\n    if (hashString) {\n        originalUrl = `${ originalUrl }#${ hashString }`;\n    }\n\n    return originalUrl;\n}\n\nexport function redirect(url : string, win : CrossDomainWindowType = window) : ZalgoPromise<void> {\n    return new ZalgoPromise(resolve => {\n        win.location = url;\n        if (!urlWillRedirectPage(url)) {\n            resolve();\n        }\n    });\n}\n\nexport function hasMetaViewPort() : boolean {\n    let meta = document.querySelector('meta[name=viewport]');\n\n    if (isDevice() && window.screen.width < 660 && !meta) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function isElementVisible(el : HTMLElement) : boolean {\n    return Boolean(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n}\n\nexport function enablePerformance() : boolean {\n    return inlineMemoize(enablePerformance, () : boolean => {\n        /* eslint-disable compat/compat */\n        return Boolean(\n            window.performance &&\n            performance.now &&\n            performance.timing &&\n            performance.timing.connectEnd &&\n            performance.timing.navigationStart &&\n            (Math.abs(performance.now() - Date.now()) > 1000) &&\n            (performance.now() - (performance.timing.connectEnd - performance.timing.navigationStart)) > 0\n        );\n        /* eslint-enable compat/compat */\n    });\n}\n\nexport function getPageRenderTime() : ZalgoPromise<?number> {\n    return waitForDocumentReady().then(() => {\n\n        if (!enablePerformance()) {\n            return;\n        }\n\n        let timing = window.performance.timing;\n\n        if (timing.connectEnd && timing.domInteractive) {\n            return timing.domInteractive - timing.connectEnd;\n        }\n    });\n}\n\nexport function htmlEncode(html : string = '') : string {\n    return html.toString()\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#39;')\n        .replace(/\\//g, '&#x2F;');\n}\n\nexport function isBrowser() : boolean {\n    return (typeof window !== 'undefined');\n}\n\nexport function querySelectorAll(selector : string, doc : HTMLElement = window.document) : Array<HTMLElement> {\n    return Array.prototype.slice.call(doc.querySelectorAll(selector));\n}\n\nexport function onClick(element : HTMLElement, handler : (Event) => void) {\n    element.addEventListener('touchstart', noop);\n    element.addEventListener('click', handler);\n    element.addEventListener('keypress', (event : Event) => {\n        // $FlowFixMe\n        if (event.keyCode === KEY_CODES.ENTER) {\n            return handler(event);\n        }\n    });\n}\n\nexport function getScript({ host = window.location.host, path } : { host? : string, path : string }) : ?HTMLScriptElement {\n    return inlineMemoize(getScript, () : ?HTMLScriptElement => {\n\n        let url = `${ host }${ path }`;\n        let scripts = Array.prototype.slice.call(document.getElementsByTagName('script'));\n\n        for (let script of scripts) {\n            if (!script.src) {\n                continue;\n            }\n\n            let src = script.src.replace(/^https?:\\/\\//, '').split('?')[0];\n\n            if (src === url) {\n                return script;\n            }\n        }\n    }, [ path ]);\n}\n\nexport function isLocalStorageEnabled() : boolean {\n    return inlineMemoize(isLocalStorageEnabled, () => {\n        try {\n            if (typeof window === 'undefined') {\n                return false;\n            }\n\n            if (window.localStorage) {\n                let value = Math.random().toString();\n                window.localStorage.setItem('__test__localStorage__', value);\n                let result = window.localStorage.getItem('__test__localStorage__');\n                window.localStorage.removeItem('__test__localStorage__');\n                if (value === result) {\n                    return true;\n                }\n            }\n        } catch (err) {\n            // pass\n        }\n        return false;\n    });\n}\n\nexport function getBrowserLocales() : Array<{ country? : string, lang : string }> {\n    let nav = window.navigator;\n\n    let locales = nav.languages\n        ? Array.prototype.slice.apply(nav.languages)\n        : [];\n\n    if (nav.language) {\n        locales.push(nav.language);\n    }\n\n    if (nav.userLanguage) {\n        locales.push(nav.userLanguage);\n    }\n\n    return locales.map(locale => {\n\n        if (locale && locale.match(/^[a-z]{2}[-_][A-Z]{2}$/)) {\n            let [ lang, country ] = locale.split(/[-_]/);\n            return { country, lang };\n        }\n\n        if (locale && locale.match(/^[a-z]{2}$/)) {\n            return { lang: locale };\n        }\n\n        return null;\n\n    }).filter(Boolean);\n}\n\n\nexport function appendChild(container : HTMLElement, child : HTMLElement | Text) {\n    container.appendChild(child);\n}\n\nexport function isElement(element : mixed) : boolean {\n\n    if (element instanceof window.Element) {\n        return true;\n    }\n\n    if (element !== null && typeof element === 'object' && element.nodeType === 1 && typeof element.style === 'object' && typeof element.ownerDocument === 'object') {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getElementSafe(id : ElementRefType, doc : Document | HTMLElement = document) : ?HTMLElement {\n\n    if (isElement(id)) {\n        // $FlowFixMe\n        return id;\n    }\n\n    if (typeof id === 'string') {\n        return doc.querySelector(id);\n    }\n}\n\nexport function getElement(id : ElementRefType, doc : Document | HTMLElement = document) : HTMLElement {\n\n    let element = getElementSafe(id, doc);\n\n    if (element) {\n        return element;\n    }\n\n    throw new Error(`Can not find element: ${ stringify(id) }`);\n}\n\nexport function elementReady(id : ElementRefType) : ZalgoPromise<window.HTMLElement> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        let name = stringify(id);\n        let el = getElementSafe(id);\n\n        if (el) {\n            return resolve(el);\n        }\n\n        if (isDocumentReady()) {\n            return reject(new Error(`Document is ready and element ${ name } does not exist`));\n        }\n\n        let interval = setInterval(() => {\n\n            el = getElementSafe(id);\n\n            if (el) {\n                clearInterval(interval);\n                return resolve(el);\n            }\n\n            if (isDocumentReady()) {\n                clearInterval(interval);\n                return reject(new Error(`Document is ready and element ${ name } does not exist`));\n            }\n        }, 10);\n    });\n}\n\nexport function PopupOpenError(message : string) {\n    this.message = message;\n}\n\nPopupOpenError.prototype = Object.create(Error.prototype);\n\ntype PopupOptions = {|\n    name? : string,\n    width? : number,\n    height? : number,\n    top? : number,\n    left? : number,\n    status? : 0 | 1,\n    resizable? : 0 | 1,\n    toolbar? : 0 | 1,\n    menubar? : 0 | 1,\n    scrollbars? : 0 | 1\n|};\n\nexport function popup(url : string, options? : PopupOptions) : CrossDomainWindowType {\n\n    // $FlowFixMe\n    options = options || {};\n\n    let { width, height } = options;\n\n    let top = 0;\n    let left = 0;\n\n    if (width) {\n        if (window.outerWidth) {\n            left = Math.round((window.outerWidth - width) / 2) + window.screenX;\n        } else if (window.screen.width) {\n            left = Math.round((window.screen.width - width) / 2);\n        }\n    }\n\n    if (height) {\n        if (window.outerHeight) {\n            top = Math.round((window.outerHeight - height) / 2) + window.screenY;\n        } else if (window.screen.height) {\n            top = Math.round((window.screen.height - height) / 2);\n        }\n    }\n\n    if (width && height) {\n        options = {\n            top,\n            left,\n            width,\n            height,\n            status:     1,\n            toolbar:    0,\n            menubar:    0,\n            resizable:  1,\n            scrollbars: 1,\n            ...options\n        };\n    }\n\n    let name = options.name || '';\n    delete options.name;\n\n    // eslint-disable-next-line array-callback-return\n    let params = Object.keys(options).map(key => {\n        // $FlowFixMe\n        if (options[key] !== null && options[key] !== undefined) {\n            return `${ key }=${ stringify(options[key]) }`;\n        }\n    }).filter(Boolean).join(',');\n\n    let win;\n\n    try {\n        win = window.open(url, name, params, true);\n    } catch (err) {\n        throw new PopupOpenError(`Can not open popup window - ${ err.stack || err.message }`);\n    }\n\n    if (isWindowClosed(win)) {\n        let err = new PopupOpenError(`Can not open popup window - blocked`);\n        throw err;\n    }\n\n    window.addEventListener('unload', () => win.close());\n\n    return win;\n}\n\n\nexport function writeToWindow(win : SameDomainWindowType, html : string) {\n    try {\n        win.document.open();\n        win.document.write(html);\n        win.document.close();\n    } catch (err) {\n        try {\n            win.location = `javascript: document.open(); document.write(${ JSON.stringify(html) }); document.close();`;\n        } catch (err2) {\n            // pass\n        }\n    }\n}\n\nexport function writeElementToWindow(win : SameDomainWindowType, el : HTMLElement) {\n\n    let tag = el.tagName.toLowerCase();\n\n    if (tag !== 'html') {\n        throw new Error(`Expected element to be html, got ${ tag }`);\n    }\n\n    let documentElement = win.document.documentElement;\n\n    for (const child of arrayFrom(documentElement.children)) {\n        documentElement.removeChild(child);\n    }\n\n    for (const child of arrayFrom(el.children)) {\n        documentElement.appendChild(child);\n    }\n}\n\nexport function setStyle(el : HTMLElement, styleText : string, doc : Document = window.document) {\n    // $FlowFixMe\n    if (el.styleSheet) {\n        // $FlowFixMe\n        el.styleSheet.cssText = styleText;\n    } else {\n        el.appendChild(doc.createTextNode(styleText));\n    }\n}\n\nexport type ElementOptionsType = {\n    style? : { [ string ] : string },\n    id? : string,\n    class? : ?Array<string>,\n    attributes? : { [ string ] : string },\n    styleSheet? : ?string,\n    html? : ?string\n};\n\nlet awaitFrameLoadPromises : WeakMap<HTMLIFrameElement, ZalgoPromise<HTMLIFrameElement>>;\n\nexport function awaitFrameLoad(frame : HTMLIFrameElement) : ZalgoPromise<HTMLIFrameElement> {\n    awaitFrameLoadPromises = awaitFrameLoadPromises || new WeakMap();\n\n    if (awaitFrameLoadPromises.has(frame)) {\n        let promise = awaitFrameLoadPromises.get(frame);\n        if (promise) {\n            return promise;\n        }\n    }\n\n    let promise = new ZalgoPromise((resolve, reject) => {\n        frame.addEventListener('load', () => {\n            linkFrameWindow(frame);\n            resolve(frame);\n        });\n\n        frame.addEventListener('error', (err : Event) => {\n            if (frame.contentWindow) {\n                resolve(frame);\n            } else {\n                reject(err);\n            }\n        });\n    });\n\n    awaitFrameLoadPromises.set(frame, promise);\n\n    return promise;\n}\n\nexport function awaitFrameWindow(frame : HTMLIFrameElement) : ZalgoPromise<CrossDomainWindowType> {\n    return awaitFrameLoad(frame).then(loadedFrame => {\n\n        if (!loadedFrame.contentWindow) {\n            throw new Error(`Could not find window in iframe`);\n        }\n\n        return loadedFrame.contentWindow;\n    });\n}\n\nexport function createElement(tag : string = 'div', options : ElementOptionsType = {}, container : ?HTMLElement) : HTMLElement {\n\n    tag = tag.toLowerCase();\n    let element = document.createElement(tag);\n\n    if (options.style) {\n        extend(element.style, options.style);\n    }\n\n    if (options.class) {\n        element.className = options.class.join(' ');\n    }\n\n    if (options.id) {\n        element.setAttribute('id', options.id);\n    }\n\n    if (options.attributes) {\n        for (let key of Object.keys(options.attributes)) {\n            element.setAttribute(key, options.attributes[key]);\n        }\n    }\n\n    if (options.styleSheet) {\n        setStyle(element, options.styleSheet);\n    }\n\n    if (container) {\n        appendChild(container, element);\n    }\n\n    if (options.html) {\n        if (tag === 'iframe') {\n            // $FlowFixMe\n            if (!container || !element.contentWindow) {\n                throw new Error(`Iframe html can not be written unless container provided and iframe in DOM`);\n            }\n\n            // $FlowFixMe\n            writeToWindow(element.contentWindow, options.html);\n\n        } else {\n            element.innerHTML = options.html;\n        }\n    }\n\n    return element;\n}\n\n\nexport type IframeElementOptionsType = {\n    style? : { [ string ] : string },\n    class? : ?Array<string>,\n    attributes? : { [ string ] : string },\n    styleSheet? : ?string,\n    html? : ?string,\n    url? : ?string\n};\n\nexport function iframe(options : IframeElementOptionsType = {}, container : ?HTMLElement) : HTMLIFrameElement {\n\n    let attributes = options.attributes || {};\n    let style = options.style || {};\n\n    let frame = createElement('iframe', {\n        attributes: {\n            allowTransparency: 'true',\n            ...attributes\n        },\n        style: {\n            backgroundColor: 'transparent',\n            border:          'none',\n            ...style\n        },\n        html:  options.html,\n        class: options.class\n    });\n\n    const isIE = window.navigator.userAgent.match(/MSIE|Edge/i);\n    \n    if (!frame.hasAttribute('id')) {\n        frame.setAttribute('id', uniqueID());\n    }\n\n    // $FlowFixMe\n    awaitFrameLoad(frame);\n\n    if (container) {\n        let el = getElement(container);\n        el.appendChild(frame);\n    }\n\n    if (options.url || isIE) {\n        frame.setAttribute('src', options.url || 'about:blank');\n    }\n\n    // $FlowFixMe\n    return frame;\n}\n\nexport function addEventListener(obj : HTMLElement, event : string, handler : (event : Event) => void) : CancelableType {\n    obj.addEventListener(event, handler);\n    return {\n        cancel() {\n            obj.removeEventListener(event, handler);\n        }\n    };\n}\n\nexport function bindEvents(element : HTMLElement, eventNames : Array<string>, handler : (event : Event) => void) : CancelableType {\n\n    handler = once(handler);\n\n    for (let eventName of eventNames) {\n        element.addEventListener(eventName, handler);\n    }\n\n    return {\n        cancel: once(() => {\n            for (let eventName of eventNames) {\n                element.removeEventListener(eventName, handler);\n            }\n        })\n    };\n}\n\nconst VENDOR_PREFIXES = [ 'webkit', 'moz', 'ms', 'o' ];\n\nexport function setVendorCSS(element : HTMLElement, name : string, value : string) {\n\n    // $FlowFixMe\n    element.style[name] = value;\n\n    let capitalizedName = capitalizeFirstLetter(name);\n\n    for (let prefix of VENDOR_PREFIXES) {\n        // $FlowFixMe\n        element.style[`${ prefix }${ capitalizedName }`] = value;\n    }\n}\n\nconst ANIMATION_START_EVENTS = [ 'animationstart', 'webkitAnimationStart', 'oAnimationStart', 'MSAnimationStart' ];\nconst ANIMATION_END_EVENTS   = [ 'animationend', 'webkitAnimationEnd', 'oAnimationEnd', 'MSAnimationEnd' ];\n\nexport function animate(element : ElementRefType, name : string, clean : (Function) => void, timeout : number = 1000) : ZalgoPromise<void> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        let el = getElement(element);\n\n        if (!el) {\n            return resolve();\n        }\n\n        let hasStarted = false;\n\n        let startTimeout;\n        let endTimeout;\n        let startEvent;\n        let endEvent;\n\n        function cleanUp() {\n            clearTimeout(startTimeout);\n            clearTimeout(endTimeout);\n            startEvent.cancel();\n            endEvent.cancel();\n        }\n\n        startEvent = bindEvents(el, ANIMATION_START_EVENTS, event => {\n\n            // $FlowFixMe\n            if (event.target !== el || event.animationName !== name) {\n                return;\n            }\n\n            clearTimeout(startTimeout);\n\n            event.stopPropagation();\n\n            startEvent.cancel();\n            hasStarted = true;\n\n            endTimeout = setTimeout(() => {\n                cleanUp();\n                resolve();\n            }, timeout);\n        });\n\n        endEvent = bindEvents(el, ANIMATION_END_EVENTS, event => {\n\n            // $FlowFixMe\n            if (event.target !== el || event.animationName !== name) {\n                return;\n            }\n\n            cleanUp();\n\n            // $FlowFixMe\n            if (typeof event.animationName === 'string' && event.animationName !== name) {\n                return reject(`Expected animation name to be ${ name }, found ${ event.animationName }`);\n            }\n\n            return resolve();\n        });\n\n        setVendorCSS(el, 'animationName', name);\n\n        startTimeout = setTimeout(() => {\n            if (!hasStarted) {\n                cleanUp();\n                return resolve();\n            }\n        }, 200);\n\n        if (clean) {\n            clean(cleanUp);\n        }\n    });\n}\n\nconst STYLE = {\n\n    DISPLAY: {\n        NONE:  'none',\n        BLOCK: 'block'\n    },\n\n    VISIBILITY: {\n        VISIBLE: 'visible',\n        HIDDEN:  'hidden'\n    },\n\n    IMPORTANT: 'important'\n};\n\nexport function makeElementVisible(element : HTMLElement) {\n    element.style.setProperty('visibility', '');\n}\n\nexport function makeElementInvisible(element : HTMLElement) {\n    element.style.setProperty('visibility', STYLE.VISIBILITY.HIDDEN, STYLE.IMPORTANT);\n}\n\n\nexport function showElement(element : HTMLElement) {\n    element.style.setProperty('display', '');\n}\n\nexport function hideElement(element : HTMLElement) {\n    element.style.setProperty('display', STYLE.DISPLAY.NONE, STYLE.IMPORTANT);\n}\n\nexport function destroyElement(element : HTMLElement) {\n    if (element && element.parentNode) {\n        element.parentNode.removeChild(element);\n    }\n}\n\nexport function showAndAnimate(element : HTMLElement, name : string, clean : (Function) => void) : ZalgoPromise<void> {\n    let animation = animate(element, name, clean);\n    showElement(element);\n    return animation;\n}\n\nexport function animateAndHide(element : HTMLElement, name : string, clean : (Function) => void) : ZalgoPromise<void> {\n    return animate(element, name, clean).then(() => {\n        hideElement(element);\n    });\n}\n\nexport function addClass(element : HTMLElement, name : string) {\n    element.classList.add(name);\n}\n\nexport function removeClass(element : HTMLElement, name : string) {\n    element.classList.remove(name);\n}\n\nexport function isElementClosed(el : HTMLElement) : boolean {\n    if (!el || !el.parentNode) {\n        return true;\n    }\n    return false;\n}\n\nexport function watchElementForClose(element : HTMLElement, handler : () => mixed) : CancelableType {\n    handler = once(handler);\n\n    let interval;\n\n    if (isElementClosed(element)) {\n        handler();\n    } else {\n        interval = safeInterval(() => {\n            if (isElementClosed(element)) {\n                interval.cancel();\n                handler();\n            }\n        }, 50);\n    }\n\n    return {\n        cancel() {\n            if (interval) {\n                interval.cancel();\n            }\n        }\n    };\n}\n\nexport function fixScripts(el : HTMLElement, doc : Document = window.document) {\n    for (let script of querySelectorAll('script', el)) {\n        let parentNode = script.parentNode;\n\n        if (!parentNode) {\n            continue;\n        }\n\n        let newScript = doc.createElement('script');\n        newScript.text = script.textContent;\n        parentNode.replaceChild(newScript, script);\n    }\n}\n\ntype OnResizeOptions = {|\n    width? : boolean,\n    height? : boolean,\n    interval? : number,\n    win? : SameDomainWindowType\n|};\n\nexport function onResize(el : HTMLElement, handler : ({ width : number, height : number }) => void, { width = true, height = true, interval = 100, win = window } : OnResizeOptions = {}) : {} {\n    let currentWidth = el.offsetWidth;\n    let currentHeight = el.offsetHeight;\n\n    handler({ width: currentWidth, height: currentHeight });\n\n    let check = () => {\n        let newWidth = el.offsetWidth;\n        let newHeight = el.offsetHeight;\n\n        if ((width && newWidth !== currentWidth) || (height && newHeight !== currentHeight)) {\n            handler({ width: newWidth, height: newHeight });\n        }\n\n        currentWidth = newWidth;\n        currentHeight = newHeight;\n    };\n\n    let observer;\n    let timeout;\n\n    if (typeof win.ResizeObserver !== 'undefined') {\n        observer = new win.ResizeObserver(check);\n        observer.observe(el);\n\n    } else if (typeof win.MutationObserver !== 'undefined') {\n        observer = new win.MutationObserver(check);\n        observer.observe(el, {\n            attributes:    true,\n            childList:     true,\n            subtree:       true,\n            characterData: false\n        });\n        win.addEventListener('resize', check);\n    } else {\n        let loop = () => {\n            check();\n            timeout = setTimeout(loop, interval);\n        };\n        loop();\n    }\n\n    return {\n        cancel: () => {\n            observer.disconnect();\n            window.removeEventListener('resize', check);\n            clearTimeout(timeout);\n        }\n    };\n}\n\nexport function getResourceLoadTime(url : string) : ?number {\n\n    if (!enablePerformance()) {\n        return;\n    }\n\n    if (!window.performance || typeof window.performance.getEntries !== 'function') {\n        return;\n    }\n\n    const entries = window.performance.getEntries();\n\n    for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n\n        if (entry && entry.name && entry.name.indexOf(url) === 0 && typeof entry.duration === 'number') {\n            return Math.floor(entry.duration);\n        }\n    }\n}\n","/* @flow */\n\nimport { uniqueID, getGlobal, inlineMemoize } from './util';\nimport { isLocalStorageEnabled } from './dom';\n\ntype Getter<T> = <T>(handler : (Object) => T) => T;\n\nexport type Storage = {\n    getState : Getter<*>,\n    getID : () => string,\n    getSessionState : Getter<*>,\n    getSessionID : () => string\n};\n\nconst DEFAULT_SESSION_STORAGE = 20 * 60 * 1000;\n\nexport function getStorage({ name, lifetime = DEFAULT_SESSION_STORAGE } : { name : string, lifetime? : number }) : Storage {\n    return inlineMemoize(getStorage, () => {\n        const STORAGE_KEY = `__${ name }_storage__`;\n\n        let accessedStorage;\n\n        function getState<T>(handler : (storage : Object) => T) : T {\n\n            let localStorageEnabled = isLocalStorageEnabled();\n            let storage;\n\n            if (accessedStorage) {\n                storage = accessedStorage;\n            }\n\n            if (!storage && localStorageEnabled) {\n                let rawStorage = window.localStorage.getItem(STORAGE_KEY);\n\n                if (rawStorage) {\n                    storage = JSON.parse(rawStorage);\n                }\n            }\n\n            if (!storage) {\n                storage = getGlobal()[STORAGE_KEY];\n            }\n\n            if (!storage) {\n                storage = {\n                    id: uniqueID()\n                };\n            }\n\n            if (!storage.id) {\n                storage.id = uniqueID();\n            }\n\n            accessedStorage = storage;\n\n            let result = handler(storage);\n\n            if (localStorageEnabled) {\n                window.localStorage.setItem(STORAGE_KEY, JSON.stringify(storage));\n            } else {\n                getGlobal()[STORAGE_KEY] = storage;\n            }\n\n            accessedStorage = null;\n\n            return result;\n        }\n\n        function getID() : string {\n            return getState(storage => storage.id);\n        }\n\n        function getSession<T>(handler : (state : Object) => T) : T {\n            return getState(storage => {\n\n                let session = storage.__session__;\n                let now = Date.now();\n\n                if (session && ((now - session.created) > lifetime)) {\n                    session = null;\n                }\n\n                if (!session) {\n                    session = {\n                        guid:    uniqueID(),\n                        created: now\n                    };\n                }\n\n                storage.__session__ = session;\n\n                return handler(session);\n            });\n        }\n\n        function getSessionState<T>(handler : (state : Object) => T) : T {\n            return getSession(session => {\n                session.state = session.state || {};\n                return handler(session.state);\n            });\n        }\n\n        function getSessionID() : string {\n            return getSession(session => session.guid);\n        }\n\n        return {\n            getState,\n            getID,\n            getSessionState,\n            getSessionID\n        };\n    }, [ { name, lifetime } ]);\n}\n","/* @flow */\n\nimport { noop } from './util';\nimport { getStorage } from './storage';\n\nfunction getBelterExperimentStorage() : Object {\n    return getStorage({ name: 'belter_experiment' });\n}\n\nfunction isEventUnique(name : string) : boolean {\n    return getBelterExperimentStorage().getSessionState(state => {\n        state.loggedBeacons = state.loggedBeacons || [];\n\n        if (state.loggedBeacons.indexOf(name) === -1) {\n            state.loggedBeacons.push(name);\n            return true;\n        }\n\n        return false;\n    });\n}\n\nexport type Experiment = {\n    isEnabled : () => boolean,\n    isDisabled : () => boolean,\n    getTreatment : () => string,\n    log : (string, payload? : { [string] : ?string }) => Experiment,\n    logStart : (payload? : { [string] : ?string }) => Experiment,\n    logComplete : (payload? : { [string] : ?string }) => Experiment\n};\n\nfunction getThrottlePercentile(name : string) : number {\n    return getBelterExperimentStorage().getState(state => {\n        state.throttlePercentiles = state.throttlePercentiles || {};\n        state.throttlePercentiles[name] = state.throttlePercentiles[name] || Math.floor(Math.random() * 100);\n        return state.throttlePercentiles[name];\n    });\n}\n\nconst THROTTLE_GROUP = {\n    TEST:     'test',\n    CONTROL:  'control',\n    THROTTLE: 'throttle'\n};\n\ntype ExperimentOptions = {\n    name : string,\n    sample? : number,\n    logTreatment? : ({ name : string, treatment : string, payload : { [string] : ?string } }) => void,\n    logCheckpoint? : ({ name : string, treatment : string, checkpoint : string, payload : { [string] : ?string } }) => void\n};\n\nexport function experiment({ name, sample = 50, logTreatment = noop, logCheckpoint = noop } : ExperimentOptions) : Experiment {\n\n    let throttle = getThrottlePercentile(name);\n\n    let group;\n\n    if (throttle < sample) {\n        group = THROTTLE_GROUP.TEST;\n    } else if ((sample >= 50) || ((sample <= throttle) && (throttle < (sample * 2)))) {\n        group = THROTTLE_GROUP.CONTROL;\n    } else {\n        group = THROTTLE_GROUP.THROTTLE;\n    }\n\n    let treatment = `${ name }_${ group }`;\n\n    let started = false;\n    let forced = false;\n\n    try {\n        if (window.localStorage && window.localStorage.getItem(name)) {\n            forced = true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    return {\n\n        isEnabled() : boolean {\n            return (group === THROTTLE_GROUP.TEST) || forced;\n        },\n\n        isDisabled() : boolean {\n            return (group !== THROTTLE_GROUP.TEST) && !forced;\n        },\n\n        getTreatment() : string {\n            return treatment;\n        },\n\n        log(checkpoint : string, payload? : { [string] : ?string } = {}) : Experiment {\n            if (!started) {\n                return this;\n            }\n\n            if (isEventUnique(`${ name }_${ treatment }_${ JSON.stringify(payload) }`)) {\n                logTreatment({ name, treatment, payload });\n            }\n\n            if (isEventUnique(`${ name }_${ treatment }_${ checkpoint }_${ JSON.stringify(payload) }`)) {\n                logCheckpoint({ name, treatment, checkpoint, payload });\n            }\n\n            return this;\n        },\n\n        logStart(payload? : { [string] : ?string } = {}) : Experiment {\n            started = true;\n            return this.log(`start`, payload);\n        },\n\n        logComplete(payload? : { [string] : ?string } = {}) : Experiment {\n            return this.log(`complete`, payload);\n        }\n    };\n}\n","/* @flow */\n\nimport { getGlobal } from './util';\n\nexport function getGlobalNameSpace<T : Object>({ name, version = 'latest' } : { name : string, version? : string }) : { get : (string, defValue? : T) => T } {\n\n    let global = getGlobal();\n    let globalKey = `__${ name }__${ version }_global__`;\n\n    let namespace = global[globalKey] = global[globalKey] || {};\n\n    return {\n        get: (key : string, defValue? : T) : T => {\n            // $FlowFixMe\n            defValue = defValue || {};\n            let item = namespace[key] = namespace[key] || defValue;\n            return item;\n        }\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { type SameDomainWindowType } from 'cross-domain-utils/src';\n\ntype RequestOptionsType = {\n    url : string,\n    method? : string,\n    headers? : { [key : string] : string },\n    json? : $ReadOnlyArray<mixed> | Object,\n    data? : { [key : string] : string },\n    body? : string,\n    win? : SameDomainWindowType,\n    timeout? : number\n};\n\ntype ResponseType = {\n    status : number,\n    headers : { [string] : string },\n    body : Object\n};\n\nconst HEADERS = {\n    CONTENT_TYPE: 'content-type',\n    ACCEPT:       'accept'\n};\n\nlet headerBuilders = [];\n\nfunction parseHeaders(rawHeaders : string = '') : { [string] : string } {\n    let result = {};\n    for (let line of rawHeaders.trim().split('\\n')) {\n        let [ key, ...values ] = line.split(':');\n        result[key.toLowerCase()] = values.join(':').trim();\n    }\n    return result;\n}\n\nexport function request({ url, method = 'get', headers = {}, json, data, body, win = window, timeout = 0 } : RequestOptionsType) : ZalgoPromise<ResponseType> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        if ((json && data) || (json && body) || (data && json)) {\n            throw new Error(`Only options.json or options.data or options.body should be passed`);\n        }\n\n        let normalizedHeaders = {};\n\n        for (let key of Object.keys(headers)) {\n            normalizedHeaders[key.toLowerCase()] = headers[key];\n        }\n\n        if (json) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] = normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/json';\n        } else if (data || body) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] = normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/x-www-form-urlencoded; charset=utf-8';\n        }\n\n        normalizedHeaders[HEADERS.ACCEPT] = normalizedHeaders[HEADERS.ACCEPT] || 'application/json';\n\n        for (let headerBuilder of headerBuilders) {\n            let builtHeaders = headerBuilder();\n\n            for (let key of Object.keys(builtHeaders)) {\n                normalizedHeaders[key.toLowerCase()] = builtHeaders[key];\n            }\n        }\n\n        let xhr = new win.XMLHttpRequest();\n\n        xhr.addEventListener('load', function xhrLoad() : void {\n\n            let responseHeaders = parseHeaders(this.getAllResponseHeaders());\n\n            if (!this.status) {\n                return reject(new Error(`Request to ${ method.toLowerCase() } ${ url } failed: no response status code.`));\n            }\n            \n            let contentType = responseHeaders['content-type'];\n            let isJSON = contentType && (contentType.indexOf('application/json') === 0 || contentType.indexOf('text/json') === 0);\n            let responseBody = this.responseText;\n\n            try {\n                responseBody = JSON.parse(responseBody);\n            } catch (err) {\n                if (isJSON) {\n                    return reject(new Error(`Invalid json: ${ this.responseText }.`));\n                }\n            }\n\n            let res = {\n                status:  this.status,\n                headers: responseHeaders,\n                body:    responseBody\n            };\n\n            return resolve(res);\n\n        }, false);\n\n        xhr.addEventListener('error', (evt) => {\n            reject(new Error(`Request to ${ method.toLowerCase() } ${ url } failed: ${ evt.toString() }.`));\n        }, false);\n\n        xhr.open(method, url, true);\n\n        for (let key in normalizedHeaders) {\n            if (normalizedHeaders.hasOwnProperty(key)) {\n                xhr.setRequestHeader(key, normalizedHeaders[key]);\n            }\n        }\n\n        if (json) {\n            body = JSON.stringify(json);\n        } else if (data) {\n            body = Object.keys(data).map(key => {\n                return `${ encodeURIComponent(key) }=${ data ? encodeURIComponent(data[key]) : '' }`;\n            }).join('&');\n        }\n\n        xhr.timeout = timeout;\n        xhr.ontimeout = function xhrTimeout() {\n            reject(new Error(`Request to ${ method.toLowerCase() } ${ url } has timed out`));\n        };\n\n        xhr.send(body);\n    });\n}\n\nexport function addHeaderBuilder(method : () => { [string] : string }) {\n    headerBuilders.push(method);\n}\n","/* @flow */\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\ndeclare var __TEST__ : boolean;\n\nexport type JSONPrimitive = string | boolean | number;\nexport type JSONObject = { [string] : JSONPrimitive | JSONObject } | Array<JSONPrimitive | JSONObject>;\nexport type JSONType = JSONObject | JSONPrimitive;\n\nexport type CancelableType = {\n    cancel : () => void\n};\n","/* @flow */\n\nimport { memoize, promisify } from './util';\n\nexport function memoized(target : Object, name : string, descriptor : Object) {\n    descriptor.value = memoize(descriptor.value, { name, thisNamespace: true });\n}\n\nexport function promise(target : Object, name : string, descriptor : Object) {\n    descriptor.value = promisify(descriptor.value, { name });\n}\n","/* @flow */\n\nexport function isPerc(str : string) : boolean {\n    return typeof str === 'string' && (/^[0-9]+%$/).test(str);\n}\n\nexport function isPx(str : string) : boolean {\n    return typeof str === 'string' && (/^[0-9]+px$/).test(str);\n}\n\nexport function toNum(val : string | number) : number {\n\n    if (typeof val === 'number') {\n        return val;\n    }\n\n    let match = val.match(/^([0-9]+)(px|%)$/);\n\n    if (!match) {\n        throw new Error(`Could not match css value from ${ val }`);\n    }\n\n    return parseInt(match[1], 10);\n}\n\nexport function toPx(val : number | string) : string {\n    return `${ toNum(val) }px`;\n}\n\nexport function toCSS(val : number | string) : string {\n\n    if (typeof val === 'number') {\n        return toPx(val);\n    }\n\n    return isPerc(val) ? val : toPx(val);\n}\n\nexport function percOf(num : number, perc : string) : number {\n    return parseInt(num * toNum(perc)  / 100, 10);\n}\n\nexport function normalizeDimension(dim : string | number, max : number) : number {\n    if (typeof dim === 'number') {\n        return dim;\n    } else if (isPerc(dim)) {\n        return percOf(max, dim);\n    } else if (isPx(dim)) {\n        return toNum(dim);\n    } else {\n        throw new Error(`Can not normalize dimension: ${ dim }`);\n    }\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nimport { noop, tryCatch, removeFromArray } from './util';\n\ntype Prom<X> = Promise<X> | ZalgoPromise<X>; // eslint-disable-line no-restricted-globals, promise/no-native\n\ntype Handler = <T, A : $ReadOnlyArray<mixed>>(name : string, fn? : (...args : A) => T) => (...args : A) => T; // eslint-disable-line no-undef\ntype Wrapper<T> = ({ expect : Handler, avoid : Handler, expectError : Handler, error : Handler }) => (Prom<T> | void);\n\nexport function wrapPromise<T>(method : Wrapper<T>, { timeout = 5000 } : { timeout? : number } = {}) : ZalgoPromise<void> {\n    let expected : Array<string> = [];\n    let promises : Array<ZalgoPromise<*>> = [];\n\n    let timer = setTimeout(() => {\n        if (expected.length) {\n            promises.push(ZalgoPromise.asyncReject(new Error(`Expected ${ expected[0] } to be called`)));\n        }\n    }, timeout);\n\n    let expect : Handler = (name, fn = noop) => {\n        expected.push(name);\n        \n        // $FlowFixMe\n        return function expectWrapper(...args) : * {\n            removeFromArray(expected, name);\n\n            // $FlowFixMe\n            let { result, error } = tryCatch(() => fn.call(this, ...args));\n\n            if (error) {\n                promises.push(ZalgoPromise.asyncReject(error));\n                throw error;\n            }\n\n            promises.push(ZalgoPromise.resolve(result));\n            return result;\n        };\n    };\n\n    let avoid : Handler = (name : string, fn = noop) => {\n\n        // $FlowFixMe\n        return function avoidWrapper(...args) : * {\n            promises.push(ZalgoPromise.asyncReject(new Error(`Expected ${ name } to not be called`)));\n            // $FlowFixMe\n            return fn.call(this, ...args);\n        };\n    };\n\n    let expectError : Handler = (name, fn = noop) => {\n        expected.push(name);\n\n        // $FlowFixMe\n        return function expectErrorWrapper(...args) : * {\n            removeFromArray(expected, name);\n\n            // $FlowFixMe\n            let { result, error } = tryCatch(() => fn.call(this, ...args));\n\n            if (error) {\n                throw error;\n            }\n\n            promises.push(ZalgoPromise.resolve(result).then(() => {\n                throw new Error(`Expected ${ name } to throw an error`);\n            }, noop));\n            return result;\n        };\n    };\n\n    promises.push(ZalgoPromise.try(() => method({ expect, avoid, expectError, error: avoid })));\n\n    let drain = () => {\n        return ZalgoPromise.try(() => {\n            if (promises.length) {\n                return promises.pop();\n            }\n        }).then(() => {\n            if (promises.length) {\n                return drain();\n            }\n            if (expected.length) {\n                return ZalgoPromise.delay(10).then(drain);\n            }\n        });\n    };\n\n    return drain().then(() => {\n        clearTimeout(timer);\n    });\n}\n","/* @flow */\n\nexport * from './device';\nexport * from './dom';\nexport * from './experiment';\nexport * from './global';\nexport * from './storage';\nexport * from './util';\nexport * from './http';\nexport * from './types';\nexport * from './decorators';\nexport * from './css';\nexport * from './test';\n","/* @flow */\n\nexport const BRIDGE_TIMEOUT = 5000;\nexport const CHILD_WINDOW_TIMEOUT = 5000;\n\nexport const ACK_TIMEOUT = 2000;\nexport const ACK_TIMEOUT_KNOWN = 10000;\nexport const RES_TIMEOUT = __TEST__ ? 2000 : -1;\nexport const RESPONSE_CYCLE_TIME = 500;\n","/* @flow */\n\nexport const MESSAGE_TYPE = {\n    REQUEST:  ('postrobot_message_request' : 'postrobot_message_request'),\n    RESPONSE: ('postrobot_message_response' : 'postrobot_message_response'),\n    ACK:      ('postrobot_message_ack' : 'postrobot_message_ack')\n};\n\nexport const MESSAGE_ACK = {\n    SUCCESS: ('success' : 'success'),\n    ERROR:   ('error' : 'error')\n};\n\nexport const MESSAGE_NAME = {\n    METHOD:      ('postrobot_method' : 'postrobot_method'),\n    HELLO:       ('postrobot_hello' : 'postrobot_hello'),\n    OPEN_TUNNEL: ('postrobot_open_tunnel' : 'postrobot_open_tunnel')\n};\n\nexport const SEND_STRATEGY = {\n    POST_MESSAGE: ('postrobot_post_message' : 'postrobot_post_message'),\n    BRIDGE:       ('postrobot_bridge' : 'postrobot_bridge'),\n    GLOBAL:       ('postrobot_global' : 'postrobot_global')\n};\n\nexport const BRIDGE_NAME_PREFIX = '__postrobot_bridge__';\nexport const POSTROBOT_PROXY =    '__postrobot_proxy__';\n\nexport const WILDCARD = '*';\n\nexport const SERIALIZATION_TYPE = {\n    CROSS_DOMAIN_ZALGO_PROMISE: ('cross_domain_zalgo_promise' : 'cross_domain_zalgo_promise'),\n    CROSS_DOMAIN_FUNCTION:      ('cross_domain_function' : 'cross_domain_function'),\n    CROSS_DOMAIN_WINDOW:        ('cross_domain_window' : 'cross_domain_window')\n};\n","/* @flow */\n\nexport * from './config';\nexport * from './constants';\n","/* @flow */\n\nimport { type CrossDomainWindowType, type SameDomainWindowType } from 'cross-domain-utils/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\nimport { getOrSet } from 'belter/src';\n\nexport function getGlobal(win : SameDomainWindowType = window) : Object {\n    if (win !== window) {\n        return win[__POST_ROBOT__.__GLOBAL_KEY__];\n    }\n    const global : Object = win[__POST_ROBOT__.__GLOBAL_KEY__] = win[__POST_ROBOT__.__GLOBAL_KEY__] || {};\n    return global;\n}\n\nexport function deleteGlobal() {\n    delete window[__POST_ROBOT__.__GLOBAL_KEY__];\n}\n\ntype ObjectGetter = () => Object;\nconst getObj : ObjectGetter = () => ({});\n\ntype GetOrSet<T> = ((string, () => T) => T) & ((string, () => void) => void);\n\ntype GlobalStore<T> = {|\n    get : ((string, T) => T) & ((string, void) => T | void),\n    set : (string, T) => T,\n    has : (string) => boolean,\n    del : (string) => void,\n    getOrSet : GetOrSet<T>,\n    reset : () => void,\n    keys : () => $ReadOnlyArray<string>\n|};\n\nexport function globalStore<T : mixed>(key? : string = 'store', defStore? : ObjectGetter = getObj) : GlobalStore<T> {\n    return getOrSet(getGlobal(), key, () => {\n        let store = defStore();\n\n        return {\n            has: (storeKey) => {\n                return store.hasOwnProperty(storeKey);\n            },\n            get: (storeKey, defVal) => {\n                // $FlowFixMe\n                return store.hasOwnProperty(storeKey) ? store[storeKey] : defVal;\n            },\n            set: (storeKey, val) => {\n                store[storeKey] = val;\n                return val;\n            },\n            del: (storeKey) => {\n                delete store[storeKey];\n            },\n            getOrSet: (storeKey, getter) => {\n                // $FlowFixMe\n                return getOrSet(store, storeKey, getter);\n            },\n            reset: () => {\n                store = defStore();\n            },\n            keys: () => {\n                return Object.keys(store);\n            }\n        };\n    });\n}\n\nexport class WildCard {}\n\nexport function getWildcard() : WildCard {\n    const global = getGlobal();\n    global.WINDOW_WILDCARD = global.WINDOW_WILDCARD || new WildCard();\n    return global.WINDOW_WILDCARD;\n}\n\ntype WindowStore<T> = {|\n    get : ((CrossDomainWindowType | WildCard, T) => T) & ((CrossDomainWindowType | WildCard, void) => T | void),\n    set : (CrossDomainWindowType | WildCard, T) => T,\n    has : (CrossDomainWindowType | WildCard) => boolean,\n    del : (CrossDomainWindowType | WildCard) => void,\n    getOrSet : (CrossDomainWindowType | WildCard, () => T) => T\n|};\n\nexport function windowStore<T>(key? : string = 'store', defStore? : ObjectGetter = getObj) : WindowStore<T> {\n    return globalStore('windowStore').getOrSet(key, () => {\n        const winStore = new WeakMap();\n\n        const getStore = (win : CrossDomainWindowType | WildCard) : ObjectGetter => {\n            return winStore.getOrSet(win, defStore);\n        };\n    \n        return {\n            has: (win) => {\n                const store = getStore(win);\n                return store.hasOwnProperty(key);\n            },\n            get: (win, defVal) => {\n                const store = getStore(win);\n                // $FlowFixMe\n                return store.hasOwnProperty(key) ? store[key] : defVal;\n            },\n            set: (win, val) => {\n                const store = getStore(win);\n                store[key] = val;\n                return val;\n            },\n            del: (win) => {\n                const store = getStore(win);\n                delete store[key];\n            },\n            getOrSet: (win, getter) => {\n                const store = getStore(win);\n                return getOrSet(store, key, getter);\n            }\n        };\n    });\n}\n","/* @flow */\n\nimport { getAncestor, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { noop, uniqueID } from 'belter/src';\n\nimport { MESSAGE_NAME, WILDCARD } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, CancelableType } from '../types';\n\nfunction getInstanceID() : string {\n    return globalStore('instance').getOrSet('instanceID', uniqueID);\n}\n\nfunction getHelloPromise(win : CrossDomainWindowType) : ZalgoPromise<{ domain : string }> {\n    const helloPromises = windowStore('helloPromises');\n    return helloPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nfunction resolveHelloPromise(win : CrossDomainWindowType, { domain }) : ZalgoPromise<{ domain : string }> {\n    const helloPromises = windowStore('helloPromises');\n    const existingPromise = helloPromises.get(win);\n    if (existingPromise) {\n        existingPromise.resolve({ domain });\n    }\n    const newPromise = ZalgoPromise.resolve({ domain });\n    helloPromises.set(win, newPromise);\n    return newPromise;\n}\n\nfunction listenForHello({ on } : { on : OnType }) : CancelableType {\n    return on(MESSAGE_NAME.HELLO, { domain: WILDCARD }, ({ source, origin }) => {\n        resolveHelloPromise(source, { domain: origin });\n        return { instanceID: getInstanceID() };\n    });\n}\n\nexport function sayHello(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<{ win : CrossDomainWindowType, domain : string, instanceID : string }> {\n    return send(win, MESSAGE_NAME.HELLO, { instanceID: getInstanceID() }, { domain: WILDCARD, timeout: -1 })\n        .then(({ origin, data: { instanceID } }) => {\n            resolveHelloPromise(win, { domain: origin });\n            return { win, domain: origin, instanceID };\n        });\n}\n\nexport function getWindowInstanceID(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<string> {\n    return windowStore('windowInstanceIDPromises').getOrSet(win, () => {\n        return sayHello(win, { send }).then(({ instanceID }) => instanceID);\n    });\n}\n\nexport function initHello({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore('builtinListeners').getOrSet('helloListener', () => {\n        const listener = listenForHello({ on });\n\n        const parent = getAncestor();\n        if (parent) {\n            sayHello(parent, { send }).catch(noop);\n        }\n\n        return listener;\n    });\n}\n\nexport function awaitWindowHello(win : CrossDomainWindowType, timeout : number = 5000, name : string = 'Window') : ZalgoPromise<{ domain : string }> {\n    let promise = getHelloPromise(win);\n\n    if (timeout !== -1) {\n        promise = promise.timeout(timeout, new Error(`${ name } did not load after ${ timeout }ms`));\n    }\n\n    return promise;\n}\n","/* @flow */\n\nimport { getUserAgent } from 'cross-domain-utils/src';\n\nexport function needsGlobalMessagingForBrowser() : boolean {\n\n    if (getUserAgent(window).match(/MSIE|rv:11|trident|edge\\/12|edge\\/13/i)) {\n        return true;\n    }\n\n    return false;\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport { windowStore } from '../global';\n\nexport function markWindowKnown(win : CrossDomainWindowType) {\n    const knownWindows = windowStore('knownWindows');\n    knownWindows.set(win, true);\n}\n\nexport function isWindowKnown(win : CrossDomainWindowType) : boolean {\n    const knownWindows = windowStore('knownWindows');\n    return knownWindows.get(win, false);\n}\n","/* @flow */\n\nexport * from './hello';\nexport * from './compat';\nexport * from './windows';\n","/* @flow */\n\nexport const TYPE = {\n    FUNCTION:  ('function' : 'function'),\n    ERROR:     ('error' : 'error'),\n    PROMISE:   ('promise' : 'promise'),\n    REGEX:     ('regex' : 'regex'),\n    DATE:      ('date' : 'date'),\n    ARRAY:     ('array' : 'array'),\n    OBJECT:    ('object' : 'object'),\n    STRING:    ('string' : 'string'),\n    NUMBER:    ('number' : 'number'),\n    BOOLEAN:   ('boolean' : 'boolean'),\n    NULL:      ('null' : 'null'),\n    UNDEFINED: ('undefined' : 'undefined')\n};\n","/* @flow */\n\nimport { TYPE } from './constants';\nimport type { CustomSerializedType } from './types';\n\nexport function isSerializedType(item : mixed) : boolean {\n    return (typeof item === 'object' && item !== null && typeof item.__type__ === 'string');\n}\n\nexport function determineType(val : mixed) : $Values<typeof TYPE> | void {\n    if (typeof val === 'undefined') {\n        return TYPE.UNDEFINED;\n    }\n\n    if (val === null) {\n        return TYPE.NULL;\n    }\n\n    if (Array.isArray(val)) {\n        return TYPE.ARRAY;\n    }\n\n    if (typeof val === 'function') {\n        return TYPE.FUNCTION;\n    }\n\n    if (typeof val === 'object') {\n\n        if (val instanceof Error) {\n            return TYPE.ERROR;\n        }\n\n        if (typeof val.then === 'function') {\n            return TYPE.PROMISE;\n        }\n\n        if (Object.prototype.toString.call(val) === '[object RegExp]') {\n            return TYPE.REGEX;\n        }\n\n        if (Object.prototype.toString.call(val) === '[object Date]') {\n            return TYPE.DATE;\n        }\n\n        return TYPE.OBJECT;\n    }\n\n    if (typeof val === 'string') {\n        return TYPE.STRING;\n    }\n\n    if (typeof val === 'number') {\n        return TYPE.NUMBER;\n    }\n\n    if (typeof val === 'boolean') {\n        return TYPE.BOOLEAN;\n    }\n}\n\nexport function serializeType<T : string, V : mixed>(type : T, val : V) : CustomSerializedType<T, V> {\n    return {\n        __type__: type,\n        __val__:  val\n    };\n}\n","/* @flow */\n\nexport type SerializedArray<T : mixed = mixed> = $ReadOnlyArray<T>;\n\nexport function serializeArray<T : mixed>(val : $ReadOnlyArray<T>) : SerializedArray<T> {\n    return val;\n}\n\nexport function deserializeArray<T : mixed>(val : SerializedArray<T>) : $ReadOnlyArray<T> {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedBoolean = boolean;\n\nexport function serializeBoolean(val : boolean) : SerializedBoolean {\n    return val;\n}\n\nexport function deserializeBoolean(val : SerializedBoolean) : boolean {\n    return val;\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedDate = string;\n\nexport function serializeDate(val : Date) : NativeSerializedType<typeof TYPE.DATE, SerializedDate> {\n    return serializeType(TYPE.DATE, val.toJSON());\n}\n\nexport function deserializeDate(val : string) : Date {\n    return new Date(val);\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedError = {|\n    message : string,\n    stack : string,\n    code : string | number | void\n|};\n\n// $FlowFixMe\nexport function serializeError({ message, stack, code } : Error) : NativeSerializedType<typeof TYPE.ERROR, SerializedError> {\n    return serializeType(TYPE.ERROR, { message, stack, code });\n}\n\nexport function deserializeError({ message, stack, code } : SerializedError) : Error {\n    const error = new Error(message);\n    // $FlowFixMe\n    error.code = code;\n    error.stack = `${ stack }\\n\\n${ error.stack }`;\n    return error;\n}\n","/* @flow */\n\nexport type SerializedFunction = void;\n\nexport function serializeFunction() : SerializedFunction {\n    // pass\n}\n\nexport function deserializeFunction() {\n    throw new Error(`Function serialization is not implemented; nothing to deserialize`);\n}\n","/* @flow */\n\nexport type SerializedNumber = number;\n\nexport function serializeNumber(val : number) : SerializedNumber {\n    return val;\n}\n\nexport function deserializeNumber(val : SerializedNumber) : number {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedObject = Object;\n\nexport function serializeObject(val : Object) : SerializedObject {\n    return val;\n}\n\nexport function deserializeObject(val : SerializedObject) : Object {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedPromise = void;\n\nexport function serializePromise() : SerializedPromise {\n    // pass\n}\n\nexport function deserializePromise() {\n    throw new Error(`Promise serialization is not implemented; nothing to deserialize`);\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedRegex = string;\n\nexport function serializeRegex(val : RegExp) : NativeSerializedType<typeof TYPE.REGEX, SerializedRegex> {\n    return serializeType(TYPE.REGEX, val.source);\n}\n\nexport function deserializeRegex(val : string) : RegExp {\n    // eslint-disable-next-line security/detect-non-literal-regexp\n    return new RegExp(val);\n}\n","/* @flow */\n\nexport type SerializedString = string;\n\nexport function serializeString(val : string) : SerializedString {\n    return val;\n}\n\nexport function deserializeString(val : SerializedString) : string {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedNull = null;\n\nexport function serializeNull(val : null) : SerializedNull {\n    return val;\n}\n\nexport function deserializeNull(val : SerializedNull) : null {\n    return val;\n}\n","/* @flow */\n\nexport * from './array';\nexport * from './boolean';\nexport * from './date';\nexport * from './error';\nexport * from './function';\nexport * from './number';\nexport * from './object';\nexport * from './promise';\nexport * from './regex';\nexport * from './string';\nexport * from './null';\n","/* @flow */\n\nimport { TYPE } from './constants';\nimport type { Thenable, CustomSerializedType, NativeSerializedType } from './types';\nimport { determineType, isSerializedType } from './common';\nimport {\n    serializeFunction,\n    serializeError, type SerializedError,\n    serializePromise,\n    serializeRegex, type SerializedRegex,\n    serializeDate, type SerializedDate,\n    serializeArray,\n    serializeObject,\n    serializeString,\n    serializeNumber,\n    serializeBoolean,\n    serializeNull\n} from './serializers';\n\ntype NativeSerializer<V : mixed, S : mixed, T : $Values<typeof TYPE>> = (value : V, key : string) => NativeSerializedType<T, S>;\ntype CustomSerializer<V : mixed, S : mixed, T : string> = (value : V, key : string) => CustomSerializedType<T, S>;\ntype PrimitiveSerializer<V : mixed, S : mixed> = (value : V, key : string) => S;\ntype CustomOrPrimitiveSerializer<V : mixed, T : string> = CustomSerializer<V, *, T> | PrimitiveSerializer<V, *>;\ntype NativeOrCustomOrPrimitiveSerializer<V : mixed, S : mixed, T : string> = NativeSerializer<V, S, T> | CustomOrPrimitiveSerializer<V, T>;\n\ntype Serializers = {|\n    function? : CustomOrPrimitiveSerializer<Function, typeof TYPE.FUNCTION>,\n    error? : NativeOrCustomOrPrimitiveSerializer<Error, SerializedError, typeof TYPE.ERROR>,\n    promise? : CustomOrPrimitiveSerializer<Thenable, typeof TYPE.PROMISE>,\n    regex? : NativeOrCustomOrPrimitiveSerializer<RegExp, SerializedRegex, typeof TYPE.REGEX>,\n    date? : NativeOrCustomOrPrimitiveSerializer<Date, SerializedDate, typeof TYPE.DATE>,\n    array? : CustomOrPrimitiveSerializer<$ReadOnlyArray<mixed>, typeof TYPE.ARRAY>,\n    object? : CustomOrPrimitiveSerializer<Object, typeof TYPE.OBJECT>,\n    string? : CustomOrPrimitiveSerializer<string, typeof TYPE.STRING>,\n    number? : CustomOrPrimitiveSerializer<number, typeof TYPE.NUMBER>,\n    boolean? : CustomOrPrimitiveSerializer<boolean, typeof TYPE.BOOLEAN>,\n    null? : CustomOrPrimitiveSerializer<null, typeof TYPE.NULL>\n|};\n\nconst SERIALIZER : Serializers = {\n    [ TYPE.FUNCTION ]:  serializeFunction,\n    [ TYPE.ERROR ]:     serializeError,\n    [ TYPE.PROMISE ]:   serializePromise,\n    [ TYPE.REGEX ]:     serializeRegex,\n    [ TYPE.DATE ]:      serializeDate,\n    [ TYPE.ARRAY ]:     serializeArray,\n    [ TYPE.OBJECT ]:    serializeObject,\n    [ TYPE.STRING ]:    serializeString,\n    [ TYPE.NUMBER ]:    serializeNumber,\n    [ TYPE.BOOLEAN ]:   serializeBoolean,\n    [ TYPE.NULL ]:      serializeNull\n};\n\n// $FlowFixMe\nconst defaultSerializers : Serializers = {};\n\nexport function serialize<T : mixed>(obj : T, serializers : Serializers = defaultSerializers) : string {\n\n    function replacer(key) : ?mixed {\n        const val = this[key];\n\n        if (isSerializedType(this)) {\n            return val;\n        }\n        \n        const type = determineType(val);\n\n        if (!type) {\n            return val;\n        }\n\n        // $FlowFixMe\n        const serializer = serializers[type] || SERIALIZER[type];\n\n        if (!serializer) {\n            return val;\n        }\n\n        return serializer(val, key);\n    }\n\n    const result = JSON.stringify(obj, replacer);\n\n    if (typeof result === 'undefined') {\n        return TYPE.UNDEFINED;\n    }\n\n    return result;\n}\n","/* @flow */\n\nimport type { Thenable } from './types';\nimport { TYPE } from './constants';\nimport { determineType, isSerializedType } from './common';\nimport {\n    deserializeFunction,\n    deserializeError, type SerializedError,\n    deserializePromise,\n    deserializeRegex, type SerializedRegex,\n    deserializeDate, type SerializedDate,\n    deserializeArray,\n    deserializeObject,\n    deserializeString,\n    deserializeNumber,\n    deserializeBoolean,\n    deserializeNull\n} from './serializers';\n\ntype Deserializer<V : mixed, S : mixed> = (serializedValue : S, key : string) => V;\ntype PrimitiveDeserializer<V, S = V> = (serializedValue : S, key : string) => V;\n\ntype Deserializers = {\n    function? : Deserializer<Function, *>,\n    error? : Deserializer<Error, SerializedError>,\n    promise? : Deserializer<Thenable, *>,\n    regex? : Deserializer<RegExp, SerializedRegex>,\n    date? : Deserializer<Date, SerializedDate>,\n    array? : PrimitiveDeserializer<$ReadOnlyArray<mixed>>,\n    object? : PrimitiveDeserializer<Object>,\n    string? : PrimitiveDeserializer<string>,\n    number? : PrimitiveDeserializer<number>,\n    boolean? : PrimitiveDeserializer<boolean>,\n    null? : PrimitiveDeserializer<null>,\n    [string] : Deserializer<mixed, *>\n};\n\n// $FlowFixMe\nconst DESERIALIZER : Deserializers = {\n    [ TYPE.FUNCTION ]:  deserializeFunction,\n    [ TYPE.ERROR ]:     deserializeError,\n    [ TYPE.PROMISE ]:   deserializePromise,\n    [ TYPE.REGEX ]:     deserializeRegex,\n    [ TYPE.DATE ]:      deserializeDate,\n    [ TYPE.ARRAY ]:     deserializeArray,\n    [ TYPE.OBJECT ]:    deserializeObject,\n    [ TYPE.STRING ]:    deserializeString,\n    [ TYPE.NUMBER ]:    deserializeNumber,\n    [ TYPE.BOOLEAN ]:   deserializeBoolean,\n    [ TYPE.NULL ]:      deserializeNull\n};\n\n// $FlowFixMe\nconst defaultDeserializers : Deserializers = {};\n\nexport function deserialize<T : mixed | null | void>(str : string, deserializers : Deserializers = defaultDeserializers) : T {\n    if (str === TYPE.UNDEFINED) {\n        // $FlowFixMe\n        return;\n    }\n\n    function replacer(key, val) : ?mixed {\n        if (isSerializedType(this)) {\n            return val;\n        }\n\n        let type;\n        let value;\n\n        if (isSerializedType(val)) {\n            type = val.__type__;\n            value = val.__val__;\n        } else {\n            type = determineType(val);\n            value = val;\n        }\n\n        if (!type) {\n            return value;\n        }\n\n        // $FlowFixMe\n        const deserializer = deserializers[type] || DESERIALIZER[type];\n\n        if (!deserializer) {\n            return value;\n        }\n\n        return deserializer(value, key);\n    }\n\n    return JSON.parse(str, replacer);\n}\n","/* @flow */\n\nimport { TYPE } from './constants';\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type Thenable = {\n    then : (onSuccess? : (val? : mixed) => mixed, onError? : (err? : mixed) => mixed) => Thenable,\n    catch : (onError? : (err? : mixed) => mixed) => Thenable\n};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type NativeSerializedType<T : $Values<typeof TYPE>, V : mixed> = {\n    __type__ : T,\n    __val__ : V\n};\n\nexport type CustomSerializedType<T : string, V : mixed> = {|\n    __type__ : T,\n    __val__ : V\n|};\n","/* @flow */\n\nexport * from './serialize';\nexport * from './deserialize';\nexport * from './serializers';\nexport * from './constants';\nexport * from './common';\nexport * from './types';\n","/* @flow */\n\nimport { type ZalgoPromise } from 'zalgo-promise/src';\nimport { getParent, isWindowClosed, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop, uniqueID } from 'belter/src';\n\nimport { MESSAGE_NAME, WILDCARD } from '../conf';\nimport { getGlobal, globalStore } from '../global';\nimport type { SendType, ResponseMessageEvent } from '../types';\n\nfunction cleanTunnelWindows() {\n    const tunnelWindows = globalStore('tunnelWindows');\n\n    for (const key of tunnelWindows.keys()) {\n        const tunnelWindow = tunnelWindows[key];\n\n        try {\n            noop(tunnelWindow.source);\n        } catch (err) {\n            tunnelWindows.del(key);\n            continue;\n        }\n\n        if (isWindowClosed(tunnelWindow.source)) {\n            tunnelWindows.del(key);\n        }\n    }\n}\n\ntype TunnelWindowDataType = {|\n    name : string,\n    source : CrossDomainWindowType,\n    canary : () => void,\n    sendMessage : (message : string) => void\n|};\n\nfunction addTunnelWindow({ name, source, canary, sendMessage } : TunnelWindowDataType) : string {\n    cleanTunnelWindows();\n    const id = uniqueID();\n    const tunnelWindows = globalStore('tunnelWindows');\n    tunnelWindows.set(id, { name, source, canary, sendMessage });\n    return id;\n}\n\nexport function setupOpenTunnelToParent({ send } : { send : SendType }) {\n    getGlobal(window).openTunnelToParent = function openTunnelToParent({ name, source, canary, sendMessage } : TunnelWindowDataType) : ZalgoPromise<ResponseMessageEvent> {\n\n        const tunnelWindows = globalStore('tunnelWindows');\n        const parentWindow = getParent(window);\n    \n        if (!parentWindow) {\n            throw new Error(`No parent window found to open tunnel to`);\n        }\n    \n        const id = addTunnelWindow({ name, source, canary, sendMessage });\n    \n        return send(parentWindow, MESSAGE_NAME.OPEN_TUNNEL, {\n    \n            name,\n    \n            sendMessage() {\n    \n                const tunnelWindow = tunnelWindows.get(id);\n    \n                try {\n                    // IE gets antsy if you try to even reference a closed window\n                    noop(tunnelWindow && tunnelWindow.source);\n                } catch (err) {\n                    tunnelWindows.del(id);\n                    return;\n                }\n    \n                if (!tunnelWindow || !tunnelWindow.source || isWindowClosed(tunnelWindow.source)) {\n                    return;\n                }\n    \n                try {\n                    tunnelWindow.canary();\n                } catch (err) {\n                    return;\n                }\n    \n                tunnelWindow.sendMessage.apply(this, arguments);\n            }\n    \n        }, { domain: WILDCARD });\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, isSameDomain, isOpener, isSameTopWindow, matchDomain, getUserAgent, getDomainFromUrl, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { BRIDGE_NAME_PREFIX } from '../conf';\nimport { windowStore } from '../global';\n\nexport function needsBridgeForBrowser() : boolean {\n\n    if (getUserAgent(window).match(/MSIE|trident|edge\\/12|edge\\/13/i)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForWin(win : CrossDomainWindowType) : boolean {\n\n    if (!isSameTopWindow(window, win)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForDomain(domain : ?string, win : ?CrossDomainWindowType) : boolean {\n\n    if (domain) {\n        if (getDomain() !== getDomainFromUrl(domain)) {\n            return true;\n        }\n    } else if (win) {\n        if (!isSameDomain(win))  {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function needsBridge({ win, domain } : { win? : CrossDomainWindowType, domain? : string }) : boolean {\n\n    if (!needsBridgeForBrowser()) {\n        return false;\n    }\n\n    if (domain && !needsBridgeForDomain(domain, win)) {\n        return false;\n    }\n\n    if (win && !needsBridgeForWin(win)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function getBridgeName(domain : string) : string {\n\n    domain = domain || getDomainFromUrl(domain);\n\n    const sanitizedDomain = domain.replace(/[^a-zA-Z0-9]+/g, '_');\n\n    const id = `${ BRIDGE_NAME_PREFIX }_${ sanitizedDomain }`;\n\n    return id;\n}\n\nexport function isBridge() : boolean {\n    return Boolean(window.name && window.name === getBridgeName(getDomain()));\n}\n\nexport const documentBodyReady = new ZalgoPromise(resolve => {\n\n    if (window.document && window.document.body) {\n        return resolve(window.document.body);\n    }\n\n    const interval = setInterval(() => {\n        if (window.document && window.document.body) {\n            clearInterval(interval);\n            return resolve(window.document.body);\n        }\n    }, 10);\n});\n\nexport function registerRemoteWindow(win : CrossDomainWindowType) {\n    const remoteWindowPromises = windowStore('remoteWindowPromises');\n    remoteWindowPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nexport function findRemoteWindow(win : CrossDomainWindowType) : ZalgoPromise<(remoteWin : CrossDomainWindowType, message : string, remoteDomain : string) => void> {\n    const remoteWindowPromises = windowStore('remoteWindowPromises');\n    const remoteWinPromise = remoteWindowPromises.get(win);\n\n    if (!remoteWinPromise) {\n        throw new Error(`Remote window promise not found`);\n    }\n\n    return remoteWinPromise;\n}\n\ntype SendMessageType = {|\n    (string) : void,\n    fireAndForget : (string) => void\n|};\n\nexport function registerRemoteSendMessage(win : CrossDomainWindowType, domain : string, sendMessage : SendMessageType) {\n    const sendMessageWrapper = (remoteWin : CrossDomainWindowType, remoteDomain : string, message : string) => {\n        if (remoteWin !== win) {\n            throw new Error(`Remote window does not match window`);\n        }\n\n        if (!matchDomain(remoteDomain, domain)) {\n            throw new Error(`Remote domain ${ remoteDomain } does not match domain ${ domain }`);\n        }\n\n        sendMessage.fireAndForget(message);\n    };\n\n    findRemoteWindow(win).resolve(sendMessageWrapper);\n}\n\nexport function rejectRemoteSendMessage(win : CrossDomainWindowType, err : Error) {\n    findRemoteWindow(win).reject(err).catch(noop);\n}\n\nexport function sendBridgeMessage(win : CrossDomainWindowType, domain : string, message : string) : ZalgoPromise<void> {\n\n    const messagingChild  = isOpener(window, win);\n    const messagingParent = isOpener(win, window);\n\n    if (!messagingChild && !messagingParent) {\n        throw new Error(`Can only send messages to and from parent and popup windows`);\n    }\n\n    return findRemoteWindow(win).then(sendMessage => {\n        return sendMessage(win, domain, message);\n    });\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isSameDomain, getOpener, getDomain, getFrameByName, assertSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { getGlobal, windowStore } from '../global';\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { needsBridge, registerRemoteWindow, rejectRemoteSendMessage, registerRemoteSendMessage, getBridgeName } from './common';\n\nfunction awaitRemoteBridgeForWindow (win : CrossDomainWindowType) : ZalgoPromise<?CrossDomainWindowType> {\n    return windowStore('remoteBridgeAwaiters').getOrSet(win, () => {\n        return ZalgoPromise.try(() => {\n            const frame = getFrameByName(win, getBridgeName(getDomain()));\n\n            if (!frame) {\n                return;\n            }\n\n            if (isSameDomain(frame) && getGlobal(assertSameDomain(frame))) {\n                return frame;\n            }\n\n            return new ZalgoPromise(resolve => {\n\n                let interval;\n                let timeout; // eslint-disable-line prefer-const\n\n                interval = setInterval(() => { // eslint-disable-line prefer-const\n                    if (frame && isSameDomain(frame) && getGlobal(assertSameDomain(frame))) {\n                        clearInterval(interval);\n                        clearTimeout(timeout);\n                        return resolve(frame);\n                    }\n                }, 100);\n\n                timeout = setTimeout(() => {\n                    clearInterval(interval);\n                    return resolve();\n                }, 2000);\n            });\n        });\n    });\n}\n\nexport function openTunnelToOpener({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) : ZalgoPromise<void> {\n    return ZalgoPromise.try(() => {\n        const opener = getOpener(window);\n        \n        if (!opener || !needsBridge({ win: opener })) {\n            return;\n        }\n\n        registerRemoteWindow(opener);\n\n        return awaitRemoteBridgeForWindow(opener).then(bridge => {\n\n            if (!bridge) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: no bridge found in opener`));\n            }\n\n            if (!window.name) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: window does not have a name`));\n            }\n\n            return getGlobal(assertSameDomain(bridge)).openTunnelToParent({\n\n                name: window.name,\n\n                source: window,\n\n                canary() {\n                    // pass\n                },\n\n                sendMessage(message) {\n\n                    try {\n                        noop(window);\n                    } catch (err) {\n                        return;\n                    }\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    try {\n                        receiveMessage({\n                            data:   message,\n                            origin: this.origin,\n                            source: this.source\n                        }, { on, send });\n                    } catch (err) {\n                        ZalgoPromise.reject(err);\n                    }\n                }\n\n            }).then(({ source, origin, data }) => {\n\n                if (source !== opener) {\n                    throw new Error(`Source does not match opener`);\n                }\n\n                registerRemoteSendMessage(source, origin, data.sendMessage);\n\n            }).catch(err => {\n\n                rejectRemoteSendMessage(opener, err);\n                throw err;\n            });\n        });\n    });\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, getFrameByName, isWindowClosed, getDomainFromUrl, normalizeMockUrl, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport { BRIDGE_TIMEOUT, MESSAGE_NAME } from '../conf';\nimport { awaitWindowHello } from '../lib';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { getBridgeName, documentBodyReady, registerRemoteSendMessage, registerRemoteWindow } from './common';\n\nexport function listenForOpenTunnel({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) {\n    const popupWindowsByName = globalStore('popupWindowsByName');\n\n    on(MESSAGE_NAME.OPEN_TUNNEL, ({ source, origin, data }) => {\n        const bridgePromise = globalStore('bridges').get(origin);\n\n        if (!bridgePromise) {\n            throw new Error(`Can not find bridge promise for domain ${ origin }`);\n        }\n\n        return bridgePromise.then(bridge => {\n            if (source !== bridge) {\n                throw new Error(`Message source does not matched registered bridge for domain ${ origin }`);\n            }\n\n            if (!data.name) {\n                throw new Error(`Register window expected to be passed window name`);\n            }\n\n            if (!data.sendMessage) {\n                throw new Error(`Register window expected to be passed sendMessage method`);\n            }\n\n            if (!popupWindowsByName.has(data.name)) {\n                throw new Error(`Window with name ${ data.name } does not exist, or was not opened by this window`);\n            }\n\n            if (!popupWindowsByName.get(data.name).domain) {\n                throw new Error(`We do not have a registered domain for window ${ data.name }`);\n            }\n\n            if (popupWindowsByName.get(data.name).domain !== origin) {\n                throw new Error(`Message origin ${ origin } does not matched registered window origin ${ popupWindowsByName.get(data.name).domain }`);\n            }\n\n            registerRemoteSendMessage(popupWindowsByName.get(data.name).win, origin, data.sendMessage);\n\n            return {\n                sendMessage(message) {\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    const winDetails = popupWindowsByName.get(data.name);\n\n                    if (!winDetails) {\n                        return;\n                    }\n\n                    try {\n                        receiveMessage({\n                            data:   message,\n                            origin: winDetails.domain,\n                            source: winDetails.win\n                        }, { on, send });\n                    } catch (err) {\n                        ZalgoPromise.reject(err);\n                    }\n                }\n            };\n        });\n    });\n}\n\nfunction openBridgeFrame(name : string, url : string) : HTMLIFrameElement {\n\n    const iframe = document.createElement(`iframe`);\n\n    iframe.setAttribute(`name`, name);\n    iframe.setAttribute(`id`,   name);\n\n    iframe.setAttribute(`style`, `display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;`);\n    iframe.setAttribute(`frameborder`, `0`);\n    iframe.setAttribute(`border`, `0`);\n    iframe.setAttribute(`scrolling`, `no`);\n    iframe.setAttribute(`allowTransparency`, `true`);\n\n    iframe.setAttribute(`tabindex`, `-1`);\n    iframe.setAttribute(`hidden`, `true`);\n    iframe.setAttribute(`title`, ``);\n    iframe.setAttribute(`role`, `presentation`);\n\n    iframe.src = url;\n\n    return iframe;\n}\n\nexport function hasBridge(url : string, domain : string) : boolean {\n    const bridges = globalStore('bridges');\n    return bridges.has(domain || getDomainFromUrl(url));\n}\n\nexport function openBridge(url : string, domain : string) : ZalgoPromise<CrossDomainWindowType> {\n    const bridges = globalStore('bridges');\n    const bridgeFrames = globalStore('bridgeFrames');\n    \n    domain = domain || getDomainFromUrl(url);\n    \n    return bridges.getOrSet(domain, () => ZalgoPromise.try(() => {\n\n        if (getDomain() === domain) {\n            throw new Error(`Can not open bridge on the same domain as current domain: ${ domain }`);\n        }\n\n        const name  = getBridgeName(domain);\n        const frame = getFrameByName(window, name);\n\n        if (frame) {\n            throw new Error(`Frame with name ${ name } already exists on page`);\n        }\n\n        const iframe = openBridgeFrame(name, url);\n        bridgeFrames.set(domain, iframe);\n\n        return documentBodyReady.then(body => {\n\n            body.appendChild(iframe);\n            const bridge = iframe.contentWindow;\n\n            return new ZalgoPromise((resolve, reject) => {\n\n                iframe.addEventListener('load', resolve);\n                iframe.addEventListener('error', reject);\n\n            }).then(() => {\n\n                return awaitWindowHello(bridge, BRIDGE_TIMEOUT, `Bridge ${ url }`);\n\n            }).then(() => {\n\n                return bridge;\n            });\n        });\n    }));\n}\n\ntype WinDetails = {|\n    win : CrossDomainWindowType,\n    domain? : ?string,\n    name? : ?string\n|};\n\nexport function linkWindow({ win, name, domain } : WinDetails) : WinDetails {\n    const popupWindowsByName = globalStore('popupWindowsByName');\n    const popupWindowsByWin = windowStore('popupWindowsByWin');\n\n    for (const winName of popupWindowsByName.keys()) {\n        // $FlowFixMe\n        const details = popupWindowsByName.get(winName);\n        if (!details || isWindowClosed(details.win)) {\n            popupWindowsByName.del(winName);\n        }\n    }\n\n    const details = popupWindowsByWin.getOrSet(win, () : WinDetails => {\n        if (!name) {\n            return { win };\n        }\n        \n        return popupWindowsByName.getOrSet(name, () : WinDetails => {\n            return { win, name };\n        });\n    });\n\n    if (details.win && details.win !== win) {\n        throw new Error(`Different window already linked for window: ${ name || 'undefined' }`);\n    }\n\n    if (name) {\n        details.name = name;\n        popupWindowsByName.set(name, details);\n    }\n\n    if (domain) {\n        details.domain = domain;\n        registerRemoteWindow(win);\n    }\n\n    popupWindowsByWin.set(win, details);\n    \n    return details;\n}\n\nexport function linkUrl(win : CrossDomainWindowType, url : string) {\n    linkWindow({ win, domain: getDomainFromUrl(url) });\n}\n\nexport function listenForWindowOpen() {\n    const windowOpen = window.open;\n\n    window.open = function windowOpenWrapper(url : string, name : string, options : string, last : mixed) : mixed {\n        const win = windowOpen.call(this, normalizeMockUrl(url), name, options, last);\n    \n        if (!win) {\n            return win;\n        }\n    \n        linkWindow({ win, name, domain: url ? getDomainFromUrl(url) : null });\n    \n        return win;\n    };\n}\n\nexport function destroyBridges() {\n    const bridges = globalStore('bridges');\n    const bridgeFrames = globalStore('bridgeFrames');\n\n    for (const domain of bridgeFrames.keys()) {\n        const frame = bridgeFrames.get(domain);\n        if (frame && frame.parentNode) {\n            frame.parentNode.removeChild(frame);\n        }\n    }\n    bridgeFrames.reset();\n    bridges.reset();\n}\n","/* @flow */\n\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { listenForWindowOpen, listenForOpenTunnel } from './parent';\nimport { setupOpenTunnelToParent } from './bridge';\nimport { openTunnelToOpener } from './child';\n\nexport function setupBridge({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) {\n    listenForWindowOpen();\n    listenForOpenTunnel({ on, send, receiveMessage });\n    setupOpenTunnelToParent({ on, send });\n    openTunnelToOpener({ on, send, receiveMessage });\n}\n","/* @flow */\n\n\nexport * from './bridge';\nexport * from './child';\nexport * from './common';\nexport * from './parent';\nexport * from './setup';\n","/* @flow */\n\nimport { isSameDomain, isWindowClosed, type CrossDomainWindowType, closeWindow,\n    type DomainMatcher, getOpener, WINDOW_TYPE, isWindow, assertSameDomain, getFrameForWindow } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { uniqueID, memoizePromise } from 'belter/src';\nimport { serializeType, type CustomSerializedType } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport { getWindowInstanceID } from '../lib';\nimport { linkWindow } from '../bridge';\nimport type { SendType } from '../types';\n\nfunction cleanupProxyWindows() {\n    const idToProxyWindow = globalStore('idToProxyWindow');\n    for (const id of idToProxyWindow.keys()) {\n        // $FlowFixMe\n        if (idToProxyWindow.get(id).shouldClean()) {\n            idToProxyWindow.del(id);\n        }\n    }\n}\n\ntype SerializedWindowType = {|\n    id : string,\n    getType : () => ZalgoPromise<$Values<typeof WINDOW_TYPE>>,\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    isClosed : () => ZalgoPromise<boolean>,\n    setLocation : (string) => ZalgoPromise<void>,\n    getName : () => ZalgoPromise<?string>,\n    setName : (string) => ZalgoPromise<void>,\n    getInstanceID : () => ZalgoPromise<string>\n|};\n\nfunction getSerializedWindow(winPromise : ZalgoPromise<CrossDomainWindowType>, { send, id = uniqueID() } : { send : SendType, id? : string }) : SerializedWindowType {\n    let windowName;\n    \n    return {\n        id,\n        getType: () => winPromise.then(win => {\n            return getOpener(win) ? WINDOW_TYPE.POPUP : WINDOW_TYPE.IFRAME;\n        }),\n        getInstanceID: memoizePromise(() => winPromise.then(win => getWindowInstanceID(win, { send }))),\n        close:         () => winPromise.then(closeWindow),\n        getName:       () => winPromise.then(win => {\n            if (isWindowClosed(win)) {\n                return;\n            }\n\n            return windowName;\n        }),\n        focus:   () => winPromise.then(win => {\n            win.focus();\n        }),\n        isClosed: () => winPromise.then(win => {\n            return isWindowClosed(win);\n        }),\n        setLocation: (href) => winPromise.then(win => {\n            if (isSameDomain(win)) {\n                try {\n                    if (win.location && typeof win.location.replace === 'function') {\n                        // $FlowFixMe\n                        win.location.replace(href);\n                        return;\n                    }\n                } catch (err) {\n                    // pass\n                }\n            }\n\n            win.location = href;\n        }),\n        setName: (name) => winPromise.then(win => {\n            if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n                linkWindow({ win, name });\n            }\n\n            const sameDomain = isSameDomain(win);\n            const frame = getFrameForWindow(win);\n\n            if (!sameDomain) {\n                throw new Error(`Can not set name for cross-domain window: ${ name }`);\n            }\n\n            assertSameDomain(win).name = name;\n            if (frame) {\n                frame.setAttribute('name', name);\n            }\n\n            windowName = name;\n        })\n    };\n}\n\nexport class ProxyWindow {\n\n    id : string\n    isProxyWindow : true = true\n    serializedWindow : SerializedWindowType\n    actualWindow : ?CrossDomainWindowType\n    actualWindowPromise : ZalgoPromise<CrossDomainWindowType>\n    send : SendType\n    name : string\n\n    constructor({ send, win, serializedWindow } : { win? : CrossDomainWindowType, serializedWindow? : SerializedWindowType, send : SendType }) {\n        this.actualWindowPromise = new ZalgoPromise();\n        this.serializedWindow = serializedWindow || getSerializedWindow(this.actualWindowPromise, { send });\n        globalStore('idToProxyWindow').set(this.getID(), this);\n        if (win) {\n            this.setWindow(win, { send });\n        }\n    }\n\n    getID() : string {\n        return this.serializedWindow.id;\n    }\n\n    getType() : ZalgoPromise<$Values<typeof WINDOW_TYPE>> {\n        return this.serializedWindow.getType();\n    }\n\n    isPopup() : ZalgoPromise<boolean> {\n        return this.getType().then(type => {\n            return type === WINDOW_TYPE.POPUP;\n        });\n    }\n\n    setLocation(href : string) : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.setLocation(href).then(() => this);\n    }\n\n    getName() : ZalgoPromise<?string> {\n        return this.serializedWindow.getName();\n    }\n\n    setName(name : string) : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.setName(name).then(() => this);\n    }\n\n    close() : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.close().then(() => this);\n    }\n\n    focus() : ZalgoPromise<ProxyWindow> {\n        const isPopupPromise = this.isPopup();\n        const getNamePromise = this.getName();\n\n        const reopenPromise = ZalgoPromise.hash({ isPopup: isPopupPromise, name: getNamePromise }).then(({ isPopup, name }) => {\n            if (isPopup && name) {\n                window.open('', name);\n            }\n        });\n        const focusPromise = this.serializedWindow.focus();\n\n        return ZalgoPromise.all([\n            reopenPromise,\n            focusPromise\n        ]).then(() => this);\n    }\n\n    isClosed() : ZalgoPromise<boolean> {\n        return this.serializedWindow.isClosed();\n    }\n\n    getWindow() : ?CrossDomainWindowType {\n        return this.actualWindow;\n    }\n\n    setWindow(win : CrossDomainWindowType, { send } : { send : SendType }) {\n        this.actualWindow = win;\n        this.actualWindowPromise.resolve(this.actualWindow);\n        this.serializedWindow = getSerializedWindow(this.actualWindowPromise, { send, id: this.getID() });\n        windowStore('winToProxyWindow').set(win, this);\n    }\n\n    awaitWindow() : ZalgoPromise<CrossDomainWindowType> {\n        return this.actualWindowPromise;\n    }\n\n    matchWindow(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<boolean> {\n        return ZalgoPromise.try(() => {\n            if (this.actualWindow) {\n                return win === this.actualWindow;\n            }\n            \n            return ZalgoPromise.hash({\n                proxyInstanceID:       this.getInstanceID(),\n                knownWindowInstanceID: getWindowInstanceID(win, { send })\n            }).then(({ proxyInstanceID, knownWindowInstanceID }) => {\n                const match = proxyInstanceID === knownWindowInstanceID;\n\n                if (match) {\n                    this.setWindow(win, { send });\n                }\n\n                return match;\n            });\n        });\n    }\n\n    unwrap() : CrossDomainWindowType | ProxyWindow {\n        return this.actualWindow || this;\n    }\n\n    getInstanceID() : ZalgoPromise<string> {\n        return this.serializedWindow.getInstanceID();\n    }\n\n    shouldClean() : boolean {\n        return Boolean(this.actualWindow && isWindowClosed(this.actualWindow));\n    }\n\n    serialize() : SerializedWindowType {\n        return this.serializedWindow;\n    }\n\n    static unwrap(win : CrossDomainWindowType | ProxyWindow) : CrossDomainWindowType | ProxyWindow {\n        return ProxyWindow.isProxyWindow(win)\n            // $FlowFixMe\n            ? win.unwrap()\n            : win;\n    }\n\n    static serialize(win : CrossDomainWindowType | ProxyWindow, { send } : { send : SendType }) : SerializedWindowType {\n        cleanupProxyWindows();\n        return ProxyWindow.toProxyWindow(win, { send }).serialize();\n    }\n\n    static deserialize(serializedWindow : SerializedWindowType, { send } : { send : SendType }) : ProxyWindow {\n        cleanupProxyWindows();\n        return globalStore('idToProxyWindow').get(serializedWindow.id) || new ProxyWindow({ serializedWindow, send });\n    }\n\n    static isProxyWindow(obj : CrossDomainWindowType | ProxyWindow) : boolean {\n        // $FlowFixMe\n        return Boolean(obj && !isWindow(obj) && obj.isProxyWindow);\n    }\n\n    static toProxyWindow(win : CrossDomainWindowType | ProxyWindow, { send } : { send : SendType }) : ProxyWindow {\n        cleanupProxyWindows();\n\n        if (ProxyWindow.isProxyWindow(win)) {\n            // $FlowFixMe\n            return win;\n        }\n\n        // $FlowFixMe\n        const actualWindow : CrossDomainWindowType = win;\n        \n        return windowStore('winToProxyWindow').get(actualWindow) || new ProxyWindow({ win: actualWindow, send });\n    }\n}\n\nexport type SerializedWindow = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW, SerializedWindowType>;\n\nexport function serializeWindow(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, win : CrossDomainWindowType, { send } : { send : SendType }) : SerializedWindow {\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW, ProxyWindow.serialize(win, { send }));\n}\n\nexport function deserializeWindow(source : CrossDomainWindowType | ProxyWindow, origin : string, win : SerializedWindowType, { send } : { send : SendType }) : ProxyWindow {\n    return ProxyWindow.deserialize(win, { send });\n}\n","/* @flow */\n\nimport { matchDomain, getDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { uniqueID, isRegex } from 'belter/src';\nimport { serializeType, type CustomSerializedType } from 'universal-serialize/src';\n\nimport { MESSAGE_NAME, WILDCARD, SERIALIZATION_TYPE } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, CancelableType } from '../types';\n\nimport { ProxyWindow } from './window';\n\ntype StoredMethod = {|\n    name : string,\n    domain : DomainMatcher,\n    val : Function,\n    source : CrossDomainWindowType | ProxyWindow\n|};\n\nfunction addMethod(id : string, val : Function, name : string, source : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher) {\n    const methodStore = windowStore('methodStore');\n    const proxyWindowMethods = globalStore('proxyWindowMethods');\n    \n    if (ProxyWindow.isProxyWindow(source)) {\n        proxyWindowMethods.set(id, { val, name, domain, source });\n    } else {\n        proxyWindowMethods.del(id);\n        // $FlowFixMe\n        const methods = methodStore.getOrSet(source, () => ({}));\n        methods[id] = { domain, name, val, source };\n    }\n}\n\nfunction lookupMethod(source : CrossDomainWindowType, id : string) : ?StoredMethod {\n    const methodStore = windowStore('methodStore');\n    const proxyWindowMethods = globalStore('proxyWindowMethods');\n    const methods = methodStore.getOrSet(source, () => ({}));\n    return methods[id] || proxyWindowMethods.get(id);\n}\n\nfunction listenForFunctionCalls({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore('builtinListeners').getOrSet('functionCalls', () => {\n        return on(MESSAGE_NAME.METHOD, { domain: WILDCARD }, ({ source, origin, data } : { source : CrossDomainWindowType, origin : string, data : Object }) => {\n            const { id, name } = data;\n\n            const meth = lookupMethod(source, id);\n    \n            if (!meth) {\n                throw new Error(`Could not find method '${ name }' with id: ${ data.id } in ${ getDomain(window) }`);\n            }\n\n            const { source: methodSource, domain, val } = meth;\n            \n            return ZalgoPromise.try(() => {\n                if (!matchDomain(domain, origin)) {\n                    // $FlowFixMe\n                    throw new Error(`Method '${ data.name }' domain ${ JSON.stringify(isRegex(meth.domain) ? meth.domain.source : meth.domain) } does not match origin ${ origin } in ${ getDomain(window) }`);\n                }\n                \n                if (ProxyWindow.isProxyWindow(methodSource)) {\n                    // $FlowFixMe\n                    return methodSource.matchWindow(source, { send }).then(match => {\n                        if (!match) {\n                            throw new Error(`Method call '${ data.name }' failed - proxy window does not match source in ${ getDomain(window) }`);\n                        }\n                    });\n                }\n            }).then(() => {\n                return val.apply({ source, origin }, data.args);\n            }, err => {\n                return ZalgoPromise.try(() => {\n                    if (val.onError) {\n                        return val.onError(err);\n                    }\n                }).then(() => {\n                    // $FlowFixMe\n                    if (err.stack) {\n                        // $FlowFixMe\n                        err.stack = `Remote call to ${ name }()\\n\\n${ err.stack }`;\n                    }\n\n                    throw err;\n                });\n            }).then(result => {\n                return { result, id, name };\n            });\n        });\n    });\n}\n\nexport type SerializedFunction = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, {\n    id : string,\n    name : string\n}>;\n\n// eslint-disable-next-line flowtype/require-exact-type\ntype SerializableFunction<T> = {\n    () : ZalgoPromise<T> | T,\n    __id__? : string,\n    __name__? : string\n};\n\nexport function serializeFunction<T>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, val : SerializableFunction<T>, key : string, { on, send } : { on : OnType, send : SendType }) : SerializedFunction {\n    listenForFunctionCalls({ on, send });\n    \n    const id = val.__id__ || uniqueID();\n    destination = ProxyWindow.unwrap(destination);\n    let name = val.__name__ || val.name || key;\n\n    if (typeof name === 'string' && typeof name.indexOf === 'function' && name.indexOf('anonymous::') === 0) {\n        name = name.replace('anonymous::', `${ key }::`);\n    }\n\n    if (ProxyWindow.isProxyWindow(destination)) {\n        addMethod(id, val, name, destination, domain);\n\n        // $FlowFixMe\n        destination.awaitWindow().then(win => {\n            addMethod(id, val, name, win, domain);\n        });\n    } else {\n        addMethod(id, val, name, destination, domain);\n    }\n\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, { id, name });\n}\n\nexport function deserializeFunction<T>(source : CrossDomainWindowType | ProxyWindow, origin : string, { id, name } : { id : string, name : string }, { send } : { send : SendType }) : (...args : $ReadOnlyArray<mixed>) => ZalgoPromise<T> {\n    const getDeserializedFunction = (opts? : Object = {}) => {\n        function crossDomainFunctionWrapper<X : mixed>() : ZalgoPromise<X> {\n            let originalStack;\n    \n            if (__DEBUG__) {\n                originalStack = (new Error(`Original call to ${ name }():`)).stack;\n            }\n    \n            return ProxyWindow.toProxyWindow(source, { send }).awaitWindow().then(win => {\n                const meth = lookupMethod(win, id);\n    \n                if (meth && meth.val !== crossDomainFunctionWrapper) {\n                    return meth.val.apply({ source: window, origin: getDomain() }, arguments);\n                } else {\n                    // $FlowFixMe\n                    const options = { domain: origin, fireAndForget: opts.fireAndForget };\n                    const args = Array.prototype.slice.call(arguments);\n\n                    return send(win, MESSAGE_NAME.METHOD, { id, name, args }, options)\n                        .then(res => {\n                            if (!opts.fireAndForget) {\n                                return res.data.result;\n                            }\n                        });\n                }\n    \n            }).catch(err => {\n                // $FlowFixMe\n                if (__DEBUG__ && originalStack && err.stack) {\n                    // $FlowFixMe\n                    err.stack = `${ err.stack }\\n\\n${ originalStack }`;\n                }\n                throw err;\n            });\n        }\n\n        crossDomainFunctionWrapper.__name__ = name;\n        crossDomainFunctionWrapper.__origin__ = origin;\n        crossDomainFunctionWrapper.__source__ = source;\n        crossDomainFunctionWrapper.__id__ = id;\n\n        crossDomainFunctionWrapper.origin = origin;\n\n        return crossDomainFunctionWrapper;\n    };\n\n    const crossDomainFunctionWrapper = getDeserializedFunction();\n    crossDomainFunctionWrapper.fireAndForget = getDeserializedFunction({ fireAndForget: true });\n\n    return crossDomainFunctionWrapper;\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { serializeType, type CustomSerializedType, type Thenable } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport type { OnType, SendType } from '../types';\n\nimport { serializeFunction, type SerializedFunction } from './function';\nimport { ProxyWindow } from './window';\n\nexport type SerializedPromise = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n    then : SerializedFunction\n}>;\n\nexport function serializePromise(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, val : Thenable, key : string, { on, send } : { on : OnType, send : SendType }) : SerializedPromise {\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n        then: serializeFunction(destination, domain, (resolve, reject) => val.then(resolve, reject), key, { on, send })\n    });\n}\n\nexport function deserializePromise<T>(source : CrossDomainWindowType | ProxyWindow, origin : string, { then } : { then : Function }) : ZalgoPromise<T> {\n    return new ZalgoPromise(then);\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType, isWindow, type DomainMatcher } from 'cross-domain-utils/src';\nimport { TYPE, serialize, deserialize, type Thenable } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport type { OnType, SendType } from '../types';\n\nimport { serializeFunction, deserializeFunction, type SerializedFunction } from './function';\nimport { serializePromise, deserializePromise, type SerializedPromise } from './promise';\nimport { serializeWindow, deserializeWindow, type SerializedWindow, ProxyWindow } from './window';\n\nexport function serializeMessage<T : mixed>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, obj : T, { on, send } : { on : OnType, send : SendType }) : string {\n    return serialize(obj, {\n        [ TYPE.PROMISE ]:  (val : Thenable, key : string) : SerializedPromise => serializePromise(destination, domain, val, key, { on, send }),\n        [ TYPE.FUNCTION ]: (val : Function, key : string) : SerializedFunction => serializeFunction(destination, domain, val, key, { on, send }),\n        [ TYPE.OBJECT ]:   (val : CrossDomainWindowType) : Object | SerializedWindow => {\n            return (isWindow(val) || ProxyWindow.isProxyWindow(val)) ? serializeWindow(destination, domain, val, { on, send }) : val;\n        }\n    });\n}\n\nexport function deserializeMessage<T : mixed>(source : CrossDomainWindowType | ProxyWindow, origin : string, message : string, { on, send } : { on : OnType, send : SendType }) : T {\n    return deserialize(message, {\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE ]: (serializedPromise)  => deserializePromise(source, origin, serializedPromise),\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION ]:      (serializedFunction) => deserializeFunction(source, origin, serializedFunction, { on, send }),\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW ]:        (serializedWindow)   => deserializeWindow(source, origin, serializedWindow, { send })\n    });\n}\n","/* @flow */\n\nexport * from './serialize';\nexport * from './function';\nexport * from './promise';\nexport * from './window';\n","/* @flow */\n\nimport { isSameDomain, isSameTopWindow, isActuallySameDomain, getActualDomain,\n    getDomain, type CrossDomainWindowType, type DomainMatcher, PROTOCOL } from 'cross-domain-utils/src';\n\nimport { SEND_STRATEGY, WILDCARD } from '../../conf';\nimport { needsGlobalMessagingForBrowser } from '../../lib';\nimport { getGlobal } from '../../global';\nimport { sendBridgeMessage, needsBridgeForBrowser, isBridge } from '../../bridge';\n\nexport const SEND_MESSAGE_STRATEGIES = {};\n\nSEND_MESSAGE_STRATEGIES[SEND_STRATEGY.POST_MESSAGE] = (win : CrossDomainWindowType, serializedMessage : string, domain : DomainMatcher) => {\n\n    if (__TEST__) {\n        if (needsGlobalMessagingForBrowser() && isSameTopWindow(window, win) === false) {\n            return;\n        }\n    }\n\n    let domains;\n\n    if (Array.isArray(domain)) {\n        domains = domain;\n    } else if (typeof domain === 'string') {\n        domains = [ domain ];\n    } else {\n        domains = [ WILDCARD ];\n    }\n\n    domains = domains.map(dom => {\n\n        if (__TEST__) {\n            if (dom.indexOf(PROTOCOL.MOCK) === 0) {\n                if (window.location.protocol === PROTOCOL.FILE) {\n                    return WILDCARD;\n                }\n\n                if (!isActuallySameDomain(win)) {\n                    throw new Error(`Attempting to send messsage to mock domain ${ dom }, but window is actually cross-domain`);\n                }\n\n                // $FlowFixMe\n                const windowDomain = getDomain(win);\n                \n                if (windowDomain !== dom) {\n                    throw new Error(`Mock domain target ${ dom } does not match window domain ${ windowDomain }`);\n                }\n\n                // $FlowFixMe\n                return getActualDomain(win);\n\n            }\n        }\n        \n        if (dom.indexOf(PROTOCOL.FILE) === 0) {\n            return WILDCARD;\n        }\n\n        return dom;\n    });\n\n    domains.forEach(dom => {\n        win.postMessage(serializedMessage, dom);\n    });\n};\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n\n    SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.BRIDGE] = (win : CrossDomainWindowType, serializedMessage : string, domain : string) => {\n\n        if (!needsBridgeForBrowser() && !isBridge()) {\n            throw new Error(`Bridge not needed for browser`);\n        }\n\n        if (isSameDomain(win)) {\n            throw new Error(`Post message through bridge disabled between same domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use bridge to communicate between two different windows, not between frames`);\n        }\n\n        sendBridgeMessage(win, domain, serializedMessage);\n    };\n}\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__ || __POST_ROBOT__.__GLOBAL_MESSAGE_SUPPORT__) {\n    \n    SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.GLOBAL] = (win : CrossDomainWindowType, serializedMessage : string) => {\n\n        if (!needsGlobalMessagingForBrowser()) {\n            throw new Error(`Global messaging not needed for browser`);\n        }\n\n        if (!isSameDomain(win)) {\n            throw new Error(`Post message through global disabled between different domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use global to communicate between two different windows, not between frames`);\n        }\n\n        // $FlowFixMe\n        const foreignGlobal = getGlobal(win);\n\n        if (!foreignGlobal) {\n            throw new Error(`Can not find postRobot global on foreign window`);\n        }\n\n        foreignGlobal.receiveMessage({\n            source: window,\n            origin: getDomain(),\n            data:   serializedMessage\n        });\n    };\n}\n","/* @flow */\n\nimport { isWindowClosed, getDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { uniqueID, stringifyError } from 'belter/src';\n\nimport { serializeMessage } from '../../serialize';\nimport type { Message } from '../types';\nimport type { OnType, SendType } from '../../types';\n\nimport { SEND_MESSAGE_STRATEGIES } from './strategies';\n\nexport function sendMessage(win : CrossDomainWindowType, domain : DomainMatcher, message : Message, { on, send } : { on : OnType, send : SendType }) {\n    if (isWindowClosed(win)) {\n        throw new Error('Window is closed');\n    }\n    \n    const serializedMessage = serializeMessage(win, domain, {\n        [ __POST_ROBOT__.__GLOBAL_KEY__ ]: {\n            id:     uniqueID(),\n            origin: getDomain(window),\n            ...message\n        }\n    }, { on, send });\n\n    const strategies = Object.keys(SEND_MESSAGE_STRATEGIES);\n    const errors = [];\n\n    for (const strategyName of strategies) {\n        try {\n            SEND_MESSAGE_STRATEGIES[strategyName](win, serializedMessage, domain);\n        } catch (err) {\n            errors.push(err);\n        }\n    }\n\n    if (errors.length === strategies.length) {\n        throw new Error(`All post-robot messaging strategies failed:\\n\\n${ errors.map((err, i) => `${ i }. ${ stringifyError(err) }`).join('\\n\\n') }`);\n    }\n}\n","/* @flow */\n\nimport { type ZalgoPromise } from 'zalgo-promise/src';\nimport { matchDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { isRegex, getOrSet } from 'belter/src';\n\nimport { getWildcard, type WildCard, globalStore, windowStore } from '../global';\nimport { WILDCARD } from '../conf';\n\nexport function resetListeners() {\n    const responseListeners = globalStore('responseListeners');\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    responseListeners.reset();\n    erroredResponseListeners.reset();\n}\n\nconst __DOMAIN_REGEX__ = '__domain_regex__';\n\nexport type RequestListenerType = {|\n    handler : ({ source : CrossDomainWindowType, origin : string, data : mixed }) => (mixed | ZalgoPromise<mixed>),\n    handleError : (err : mixed) => void,\n    window : ?CrossDomainWindowType,\n    name : string,\n    domain : DomainMatcher\n|};\n\nexport type ResponseListenerType = {|\n    name : string,\n    win : CrossDomainWindowType,\n    domain : DomainMatcher,\n    promise : ZalgoPromise<*>,\n    ack? : ?boolean,\n    cancelled? : ?boolean\n|};\n\nexport function addResponseListener(hash : string, listener : ResponseListenerType) {\n    const responseListeners = globalStore('responseListeners');\n    responseListeners.set(hash, listener);\n}\n\nexport function getResponseListener(hash : string) : ?ResponseListenerType {\n    const responseListeners = globalStore('responseListeners');\n    return responseListeners.get(hash);\n}\n\nexport function deleteResponseListener(hash : string) {\n    const responseListeners = globalStore('responseListeners');\n    responseListeners.del(hash);\n}\n\nexport function cancelResponseListeners() {\n    const responseListeners = globalStore('responseListeners');\n    for (const hash of responseListeners.keys()) {\n        const listener = responseListeners.get(hash);\n        if (listener) {\n            listener.cancelled = true;\n        }\n        responseListeners.del(hash);\n    }\n}\n\nexport function markResponseListenerErrored(hash : string) {\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    erroredResponseListeners.set(hash, true);\n}\n\nexport function isResponseListenerErrored(hash : string) : boolean {\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    return erroredResponseListeners.has(hash);\n}\n\nexport function getRequestListener({ name, win, domain } : { name : string, win : ?(CrossDomainWindowType | WildCard), domain : ?(string | RegExp) }) : ?RequestListenerType {\n    const requestListeners = windowStore('requestListeners');\n\n    if (win === WILDCARD) {\n        win = null;\n    }\n\n    if (domain === WILDCARD) {\n        domain = null;\n    }\n\n    if (!name) {\n        throw new Error(`Name required to get request listener`);\n    }\n\n    for (const winQualifier of [ win, getWildcard() ]) {\n        if (!winQualifier) {\n            continue;\n        }\n\n        const nameListeners = requestListeners.get(winQualifier);\n\n        if (!nameListeners) {\n            continue;\n        }\n\n        const domainListeners = nameListeners[name];\n\n        if (!domainListeners) {\n            continue;\n        }\n\n        if (domain && typeof domain === 'string') {\n            if (domainListeners[domain]) {\n                return domainListeners[domain];\n            }\n\n            if (domainListeners[__DOMAIN_REGEX__]) {\n                for (const { regex, listener } of domainListeners[__DOMAIN_REGEX__]) {\n                    if (matchDomain(regex, domain)) {\n                        return listener;\n                    }\n                }\n            }\n        }\n\n        if (domainListeners[WILDCARD]) {\n            return domainListeners[WILDCARD];\n        }\n    }\n}\n\nexport function addRequestListener({ name, win, domain } : { name : string, win : ?(CrossDomainWindowType | WildCard), domain : ?DomainMatcher }, listener : RequestListenerType) : { cancel : () => void } {\n    const requestListeners = windowStore('requestListeners');\n\n    if (!name || typeof name !== 'string') {\n        throw new Error(`Name required to add request listener`);\n    }\n\n    if (Array.isArray(win)) {\n        const listenersCollection = [];\n\n        for (const item of win) {\n            listenersCollection.push(addRequestListener({ name, domain, win: item }, listener));\n        }\n\n        return {\n            cancel() {\n                for (const cancelListener of listenersCollection) {\n                    cancelListener.cancel();\n                }\n            }\n        };\n    }\n\n    if (Array.isArray(domain)) {\n        const listenersCollection = [];\n\n        for (const item of domain) {\n            listenersCollection.push(addRequestListener({ name, win, domain: item }, listener));\n        }\n\n        return {\n            cancel() {\n                for (const cancelListener of listenersCollection) {\n                    cancelListener.cancel();\n                }\n            }\n        };\n    }\n\n    const existingListener = getRequestListener({ name, win, domain });\n\n    if (!win || win === WILDCARD) {\n        win = getWildcard();\n    }\n\n    domain = domain || WILDCARD;\n\n    if (existingListener) {\n        if (win && domain) {\n            throw new Error(`Request listener already exists for ${ name } on domain ${ domain.toString() } for ${ win === getWildcard() ? 'wildcard' : 'specified' } window`);\n        } else if (win) {\n            throw new Error(`Request listener already exists for ${ name } for ${ win === getWildcard() ? 'wildcard' : 'specified' } window`);\n        } else if (domain) {\n            throw new Error(`Request listener already exists for ${ name } on domain ${ domain.toString() }`);\n        } else {\n            throw new Error(`Request listener already exists for ${ name }`);\n        }\n    }\n\n    const nameListeners = requestListeners.getOrSet(win, () => ({}));\n    const domainListeners = getOrSet(nameListeners, name, () => ({}));\n\n    const strDomain = domain.toString();\n\n    let regexListeners;\n    let regexListener;\n\n    if (isRegex(domain)) {\n        regexListeners = getOrSet(domainListeners, __DOMAIN_REGEX__, () => []);\n        regexListener = { regex: domain, listener };\n        regexListeners.push(regexListener);\n    } else {\n        domainListeners[strDomain] = listener;\n    }\n\n    return {\n        cancel() {\n            delete domainListeners[strDomain];\n\n            if (regexListener) {\n                regexListeners.splice(regexListeners.indexOf(regexListener, 1));\n\n                if (!regexListeners.length) {\n                    delete domainListeners[__DOMAIN_REGEX__];\n                }\n            }\n\n            if (!Object.keys(domainListeners).length) {\n                delete nameListeners[name];\n            }\n\n            if (win && !Object.keys(nameListeners).length) {\n                requestListeners.del(win);\n            }\n        }\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, isWindowClosed, matchDomain, stringifyDomainPattern, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop, stringifyError } from 'belter/src';\n\nimport { MESSAGE_TYPE, MESSAGE_ACK, MESSAGE_NAME } from '../../conf';\nimport { sendMessage } from '../send';\nimport { getRequestListener, getResponseListener, deleteResponseListener, isResponseListenerErrored } from '../listeners';\nimport type { RequestMessage, AckResponseMessage, SuccessResponseMessage, ErrorResponseMessage } from '../types';\nimport type { OnType, SendType } from '../../types';\n\nexport const RECEIVE_MESSAGE_TYPES = {\n\n    [ MESSAGE_TYPE.REQUEST ](source : CrossDomainWindowType, origin : string, message : RequestMessage, { on, send } : { on : OnType, send : SendType }) : ZalgoPromise<void> {\n\n        const options = getRequestListener({ name: message.name, win: source, domain: origin });\n\n        const logName = (message.name === MESSAGE_NAME.METHOD && message.data && typeof message.data.name === 'string') ? `${ message.data.name }()` : message.name;\n\n        if (__DEBUG__) {\n            // eslint-disable-next-line no-console\n            console.info('receive::req', logName, origin, '\\n\\n', message.data);\n        }\n\n        function sendResponse(type : $Values<typeof MESSAGE_TYPE>, ack? : $Values<typeof MESSAGE_ACK>, response = {}) {\n\n            if (message.fireAndForget || isWindowClosed(source)) {\n                return;\n            }\n\n            if (__DEBUG__ && type !== MESSAGE_TYPE.ACK) {\n                if (ack === MESSAGE_ACK.SUCCESS) {\n                    // $FlowFixMe\n                    console.info('respond::res', logName, origin, '\\n\\n', response.data);  // eslint-disable-line no-console\n                } else if (ack === MESSAGE_ACK.ERROR) {\n                    // $FlowFixMe\n                    console.error('respond::err', logName, origin, '\\n\\n', response.error); // eslint-disable-line no-console\n                }\n            }\n\n            try {\n                // $FlowFixMe\n                sendMessage(source, origin, {\n                    type,\n                    ack,\n                    hash:   message.hash,\n                    name:   message.name,\n                    ...response\n                }, { on, send });\n            } catch (err) {\n                throw new Error(`Send response message failed for ${ logName } in ${ getDomain() }\\n\\n${ stringifyError(err) }`);\n            }\n        }\n\n        return ZalgoPromise.all([\n\n            sendResponse(MESSAGE_TYPE.ACK),\n\n            ZalgoPromise.try(() => {\n\n                if (!options) {\n                    throw new Error(`No handler found for post message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n                }\n\n                if (!matchDomain(options.domain, origin)) {\n                    throw new Error(`Request origin ${ origin } does not match domain ${ options.domain.toString() }`);\n                }\n\n                const data = message.data;\n\n                return options.handler({ source, origin, data });\n\n            }).then(data => {\n                return sendResponse(MESSAGE_TYPE.RESPONSE, MESSAGE_ACK.SUCCESS, { data });\n\n            }, error => {\n                return sendResponse(MESSAGE_TYPE.RESPONSE, MESSAGE_ACK.ERROR, { error });\n            })\n\n        ]).then(noop).catch(err => {\n            if (options && options.handleError) {\n                return options.handleError(err);\n            } else {\n                throw err;\n            }\n        });\n    },\n\n    [ MESSAGE_TYPE.ACK ](source : CrossDomainWindowType, origin : string, message : AckResponseMessage) {\n\n        if (isResponseListenerErrored(message.hash)) {\n            return;\n        }\n\n        const options = getResponseListener(message.hash);\n\n        if (!options) {\n            throw new Error(`No handler found for post message ack for message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n        }\n\n        try {\n            if (!matchDomain(options.domain, origin)) {\n                throw new Error(`Ack origin ${ origin } does not match domain ${ options.domain.toString() }`);\n            }\n    \n            if (source !== options.win) {\n                throw new Error(`Ack source does not match registered window`);\n            }\n        } catch (err) {\n            options.promise.reject(err);\n        }\n\n        options.ack = true;\n    },\n\n    [ MESSAGE_TYPE.RESPONSE ](source : CrossDomainWindowType, origin : string, message : SuccessResponseMessage | ErrorResponseMessage) : void | ZalgoPromise<void> {\n\n        if (isResponseListenerErrored(message.hash)) {\n            return;\n        }\n\n        const options = getResponseListener(message.hash);\n\n        if (!options) {\n            throw new Error(`No handler found for post message response for message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Response origin ${ origin } does not match domain ${ stringifyDomainPattern(options.domain) }`);\n        }\n\n        if (source !== options.win) {\n            throw new Error(`Response source does not match registered window`);\n        }\n\n        deleteResponseListener(message.hash);\n\n        const logName = (message.name === MESSAGE_NAME.METHOD && message.data && typeof message.data.name === 'string') ? `${ message.data.name }()` : message.name;\n\n        if (message.ack === MESSAGE_ACK.ERROR) {\n            if (__DEBUG__) {\n                console.error('receive::err', logName, origin, '\\n\\n', message.error); // eslint-disable-line no-console\n            }\n\n            options.promise.reject(message.error);\n\n        } else if (message.ack === MESSAGE_ACK.SUCCESS) {\n            if (__DEBUG__) {\n                console.info('receive::res', logName, origin, '\\n\\n', message.data); // eslint-disable-line no-console\n            }\n\n            options.promise.resolve({ source, origin, data: message.data });\n        }\n    }\n};\n","/* @flow */\n\nimport { isWindowClosed, type CrossDomainWindowType, getDomain, isSameTopWindow, PROTOCOL  } from 'cross-domain-utils/src';\nimport { addEventListener, noop } from 'belter/src';\n\nimport { markWindowKnown, needsGlobalMessagingForBrowser } from '../../lib';\nimport { deserializeMessage } from '../../serialize';\nimport { getGlobal, globalStore } from '../../global';\nimport type { OnType, SendType, MessageEvent, CancelableType } from '../../types';\n\nimport { RECEIVE_MESSAGE_TYPES } from './types';\n\nfunction parseMessage(message : string, source : CrossDomainWindowType, origin : string, { on, send } : { on : OnType, send : SendType }) : ?Object {\n    let parsedMessage;\n\n    try {\n        parsedMessage = deserializeMessage(source, origin, message, { on, send });\n    } catch (err) {\n        return;\n    }\n\n    if (!parsedMessage) {\n        return;\n    }\n\n    if (typeof parsedMessage !== 'object' || parsedMessage === null) {\n        return;\n    }\n\n    parsedMessage = parsedMessage[__POST_ROBOT__.__GLOBAL_KEY__];\n\n    if (!parsedMessage || typeof parsedMessage !== 'object' || parsedMessage === null) {\n        return;\n    }\n\n    if (!parsedMessage.type || typeof parsedMessage.type !== 'string') {\n        return;\n    }\n\n    if (!RECEIVE_MESSAGE_TYPES[parsedMessage.type]) {\n        return;\n    }\n\n    return parsedMessage;\n}\n\nexport function receiveMessage(event : MessageEvent, { on, send } : { on : OnType, send : SendType }) {\n    const receivedMessages = globalStore('receivedMessages');\n\n    if (!window || window.closed) {\n        throw new Error(`Message received in closed window`);\n    }\n\n    try {\n        if (!event.source) {\n            return;\n        }\n    } catch (err) {\n        return;\n    }\n\n    let { source, origin, data } = event;\n\n    if (__TEST__) {\n        // $FlowFixMe\n        origin = getDomain(source);\n    }\n\n    const message = parseMessage(data, source, origin, { on, send });\n\n    if (!message) {\n        return;\n    }\n\n    markWindowKnown(source);\n\n    if (receivedMessages.has(message.id)) {\n        return;\n    }\n\n    receivedMessages.set(message.id, true);\n\n    if (isWindowClosed(source) && !message.fireAndForget) {\n        return;\n    }\n\n    if (message.origin.indexOf(PROTOCOL.FILE) === 0) {\n        origin = `${ PROTOCOL.FILE }//`;\n    }\n\n    RECEIVE_MESSAGE_TYPES[message.type](source, origin, message, { on, send });\n}\n\nexport function setupGlobalReceiveMessage({ on, send } : { on : OnType, send : SendType }) {\n    const global = getGlobal();\n    global.receiveMessage = global.receiveMessage || (message => receiveMessage(message, { on, send }));\n}\n\ntype ListenerEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : string,\n    sourceElement : CrossDomainWindowType,\n    originalEvent? : { origin : string }\n|};\n\nexport function messageListener(event : ListenerEvent, { on, send } : { on : OnType, send : SendType }) {\n\n    try {\n        noop(event.source);\n    } catch (err) {\n        return;\n    }\n\n    const source = event.source || event.sourceElement;\n    let origin = event.origin || (event.originalEvent && event.originalEvent.origin);\n    const data = event.data;\n\n    if (origin === 'null') {\n        origin = `${ PROTOCOL.FILE }//`;\n    }\n\n    if (!source) {\n        return;\n    }\n\n    if (!origin) {\n        throw new Error(`Post message did not have origin domain`);\n    }\n\n    if (__TEST__) {\n        if (needsGlobalMessagingForBrowser() && isSameTopWindow(source, window) === false) {\n            return;\n        }\n    }\n\n    receiveMessage({ source, origin, data }, { on, send });\n}\n\nexport function listenForMessages({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore().getOrSet('postMessageListener', () => {\n        return addEventListener(window, 'message', event => {\n            // $FlowFixMe\n            messageListener(event, { on, send });\n        });\n    });\n}\n\nexport function stopListenForMessages() {\n    const listener = globalStore().get('postMessageListener');\n    if (listener) {\n        listener.cancel();\n    }\n}\n","/* @flow */\n\nexport * from './receive';\nexport * from './send';\nexport * from './listeners';\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nimport { addRequestListener, type RequestListenerType } from '../drivers';\nimport { WILDCARD } from '../conf';\nimport type { ServerOptionsType, HandlerType, CancelableType } from '../types';\n\nexport function on(name : string, options : ServerOptionsType | HandlerType, handler : ?HandlerType) : CancelableType {\n\n    if (!name) {\n        throw new Error('Expected name');\n    }\n\n    if (typeof options === 'function') {\n        handler = options;\n        // $FlowFixMe\n        options = {};\n    }\n\n    if (!handler) {\n        throw new Error('Expected handler');\n    }\n\n    options = options || {};\n    options.name = name;\n    options.handler = handler || options.handler;\n\n    const win = options.window;\n    const domain = options.domain;\n\n    const listenerOptions : RequestListenerType = {\n        handler:     options.handler,\n        handleError: options.errorHandler || (err => {\n            throw err;\n        }),\n        window: win,\n        domain: domain || WILDCARD,\n        name\n    };\n\n    const requestListener = addRequestListener({ name, win, domain }, listenerOptions);\n\n    return {\n        cancel() {\n            requestListener.cancel();\n        }\n    };\n}\n\nexport function once(name : string, options? : ServerOptionsType | HandlerType, handler? : HandlerType) : ZalgoPromise<{ source : mixed, origin : string, data : Object }> {\n    \n    // $FlowFixMe\n    options = options || {};\n    if (typeof options === 'function') {\n        handler = options;\n        // $FlowFixMe\n        options = {};\n    }\n\n    const promise = new ZalgoPromise();\n    let listener; // eslint-disable-line prefer-const\n\n    options.errorHandler = (err) => {\n        listener.cancel();\n        promise.reject(err);\n    };\n\n    listener = on(name, options, event => {\n        listener.cancel();\n        promise.resolve(event);\n        if (handler) {\n            return handler(event);\n        }\n    });\n\n    promise.cancel = listener.cancel;\n    return promise;\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isAncestor, isWindowClosed, getDomain, matchDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { uniqueID, isRegex, noop, safeInterval, stringify, stringifyError } from 'belter/src';\n\n\nimport { CHILD_WINDOW_TIMEOUT, MESSAGE_TYPE, WILDCARD, MESSAGE_NAME, ACK_TIMEOUT, RES_TIMEOUT, ACK_TIMEOUT_KNOWN, RESPONSE_CYCLE_TIME } from '../conf';\nimport { sendMessage, addResponseListener, deleteResponseListener, markResponseListenerErrored, type ResponseListenerType } from '../drivers';\nimport { awaitWindowHello, sayHello, isWindowKnown } from '../lib';\nimport { windowStore } from '../global';\nimport type { SendType } from '../types';\n\nimport { on } from './on';\n\nfunction validateOptions(name : string, win : CrossDomainWindowType, domain : ?DomainMatcher) {\n    if (!name) {\n        throw new Error('Expected name');\n    }\n\n    if (domain) {\n        if (typeof domain !== 'string' && !Array.isArray(domain) && !isRegex(domain)) {\n            throw new TypeError(`Expected domain to be a string, array, or regex`);\n        }\n    }\n\n    if (isWindowClosed(win)) {\n        throw new Error('Target window is closed');\n    }\n}\n\nfunction normalizeDomain(win : CrossDomainWindowType, targetDomain : DomainMatcher, actualDomain : ?string, { send } : { send : SendType }) : ZalgoPromise<string | $ReadOnlyArray<string>> {\n    if (typeof targetDomain === 'string') {\n        return ZalgoPromise.resolve(targetDomain);\n    }\n    \n    return ZalgoPromise.try(() => {\n        return actualDomain || sayHello(win, { send }).then(({ domain }) => domain);\n\n    }).then(normalizedDomain => {\n        if (!matchDomain(targetDomain, targetDomain)) {\n            throw new Error(`Domain ${ stringify(targetDomain) } does not match ${ stringify(targetDomain) }`);\n        }\n\n        return normalizedDomain;\n    });\n}\n\nexport const send : SendType = (win, name, data, options) => {\n    options = options || {};\n    let domain = options.domain || WILDCARD;\n    const responseTimeout = options.timeout || RES_TIMEOUT;\n    const childTimeout = options.timeout || CHILD_WINDOW_TIMEOUT;\n    const fireAndForget = options.fireAndForget || false;\n\n    // $FlowFixMe\n    return ZalgoPromise.try(() => {\n        validateOptions(name, win, domain);\n\n        if (isAncestor(window, win)) {\n            return awaitWindowHello(win, childTimeout);\n        }\n        \n    }).then(({ domain: actualDomain } = {}) => {\n\n        return normalizeDomain(win, domain, actualDomain, { send });\n    }).then(targetDomain => {\n\n        domain = targetDomain;\n\n        const logName = (name === MESSAGE_NAME.METHOD && data && typeof data.name === 'string') ? `${ data.name }()` : name;\n\n        if (__DEBUG__) {\n            console.info('send::req', logName, domain, '\\n\\n', data); // eslint-disable-line no-console\n        }\n\n        const promise = new ZalgoPromise();\n        const hash = `${ name }_${ uniqueID() }`;\n\n        if (!fireAndForget) {\n            const responseListener : ResponseListenerType = { name, win, domain, promise };\n            addResponseListener(hash, responseListener);\n\n            const reqPromises = windowStore('requestPromises').getOrSet(win, () => []);\n            reqPromises.push(promise);\n\n            promise.catch(() => {\n                markResponseListenerErrored(hash);\n                deleteResponseListener(hash);\n            });\n\n            const totalAckTimeout = isWindowKnown(win) ? ACK_TIMEOUT_KNOWN : ACK_TIMEOUT;\n            const totalResTimeout = responseTimeout;\n\n            let ackTimeout = totalAckTimeout;\n            let resTimeout = totalResTimeout;\n        \n            const interval = safeInterval(() => {\n                if (isWindowClosed(win)) {\n                    return promise.reject(new Error(`Window closed for ${ name } before ${ responseListener.ack ? 'response' : 'ack' }`));\n                }\n\n                if (responseListener.cancelled) {\n                    return promise.reject(new Error(`Response listener was cancelled for ${ name }`));\n                }\n\n                ackTimeout = Math.max(ackTimeout - RESPONSE_CYCLE_TIME, 0);\n                if (resTimeout !== -1) {\n                    resTimeout = Math.max(resTimeout - RESPONSE_CYCLE_TIME, 0);\n                }\n\n                if (!responseListener.ack && ackTimeout === 0) {\n                    return promise.reject(new Error(`No ack for postMessage ${ logName } in ${ getDomain() } in ${ totalAckTimeout }ms`));\n\n                } else if (resTimeout === 0) {\n                    return promise.reject(new Error(`No response for postMessage ${ logName } in ${ getDomain() } in ${ totalResTimeout }ms`));\n                }\n            }, RESPONSE_CYCLE_TIME);\n\n            promise.finally(() => {\n                interval.cancel();\n                reqPromises.splice(reqPromises.indexOf(promise, 1));\n            }).catch(noop);\n        }\n\n        try {\n            sendMessage(win, domain, {\n                type: MESSAGE_TYPE.REQUEST,\n                hash,\n                name,\n                data,\n                fireAndForget\n            }, { on, send });\n        } catch (err) {\n            throw new Error(`Send request message failed for ${ logName } in ${ getDomain() }\\n\\n${ stringifyError(err) }`);\n        }\n    \n        return fireAndForget ? promise.resolve() : promise;\n    });\n};\n","/* @flow */\n\nexport * from './on';\nexport * from './send';\n","/* @flow */\n\nimport type { CrossDomainWindowType, DomainMatcher } from 'cross-domain-utils/src';\n\nimport { initHello } from './lib';\nimport { listenForMessages, stopListenForMessages, receiveMessage, setupGlobalReceiveMessage, cancelResponseListeners } from './drivers';\nimport { getGlobal, deleteGlobal } from './global';\nimport { on, send } from './public';\nimport { setupBridge } from './bridge';\nimport { serializeMessage as internalSerializeMessage, deserializeMessage as internalDeserializeMessage, ProxyWindow } from './serialize';\n\nexport function serializeMessage<T>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, obj : T) : string {\n    return internalSerializeMessage(destination, domain, obj, { on, send });\n}\n\nexport function deserializeMessage<T : mixed>(source : CrossDomainWindowType | ProxyWindow, origin : string, message : string) : T {\n    return internalDeserializeMessage(source, origin, message, { on, send });\n}\n\nexport function createProxyWindow(win? : CrossDomainWindowType) : ProxyWindow {\n    return new ProxyWindow({ send, win });\n}\n\nexport function toProxyWindow(win : CrossDomainWindowType | ProxyWindow) : ProxyWindow {\n    return ProxyWindow.toProxyWindow(win, { send });\n}\n\nexport function setup() {\n    if (!getGlobal().initialized) {\n        getGlobal().initialized = true;\n    \n        setupGlobalReceiveMessage({ on, send });\n        listenForMessages({ on, send });\n    \n        if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n            setupBridge({ on, send, receiveMessage });\n        }\n\n        initHello({ on, send });\n    }\n}\n\nexport function destroy() {\n    cancelResponseListeners();\n    stopListenForMessages();\n    deleteGlobal();\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from 'zalgo-promise/src';\nimport type { CrossDomainWindowType, DomainMatcher } from 'cross-domain-utils/src';\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CancelableType = {\n    cancel : () => void\n};\n\nexport type ErrorHandlerType = (err : mixed) => void;\n\nexport type HandlerType = ({\n    source : CrossDomainWindowType,\n    origin : string,\n    data : any // eslint-disable-line flowtype/no-weak-types\n}) => (void | any | ZalgoPromise<any>); // eslint-disable-line flowtype/no-weak-types\n\nexport type ServerOptionsType = {|\n    handler? : ?HandlerType,\n    errorHandler? : ?ErrorHandlerType,\n    window? : CrossDomainWindowType,\n    name? : ?string,\n    domain? : ?DomainMatcher,\n    once? : ?boolean,\n    errorOnClose? : ?boolean\n|};\n\nexport type OnType = (\n    name : string,\n    options : ServerOptionsType | HandlerType,\n    handler : ?HandlerType\n) => CancelableType;\n\ntype RegularRequestOptionsType = {|\n    domain? : ?DomainMatcher,\n    fireAndForget? : false,\n    timeout? : ?number\n|};\n\ntype FireAndForgetRequestOptionsType = {|\n    domain? : ?DomainMatcher,\n    fireAndForget : true,\n    timeout? : ?number\n|};\n\nexport type RequestOptionsType = RegularRequestOptionsType | FireAndForgetRequestOptionsType;\n\nexport type ResponseMessageEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : Object\n|};\n\ntype RegularSendType = (\n    win : CrossDomainWindowType,\n    name : string,\n    data : ?Object,\n    options? : RegularRequestOptionsType\n) => ZalgoPromise<ResponseMessageEvent>;\n\ntype FireAndForgetSendType = (\n    win : CrossDomainWindowType,\n    name : string,\n    data : ?Object,\n    options? : FireAndForgetRequestOptionsType\n) => ZalgoPromise<void>;\n\nexport type SendType = RegularSendType & FireAndForgetSendType;\n\nexport type MessageEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : string\n|};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CrossDomainFunctionType<A, R> = {\n    (...args : A) : ZalgoPromise<R>,\n    fireAndForget : (...args : A) => ZalgoPromise<void>,\n    __id__? : string,\n    __name__? : string\n};\n\nexport type ReceiveMessageType = (MessageEvent, { on : OnType, send : SendType }) => void;\n","/* @flow */\n\nimport { type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { windowStore } from './global';\n\nexport function cleanUpWindow(win : CrossDomainWindowType) {\n    const requestPromises = windowStore('requestPromises');\n    for (const promise of requestPromises.get(win, [])) {\n        promise.reject(new Error(`Window cleaned up before response`)).catch(noop);\n    }\n}\n","/* @flow */\n\nimport { setup } from './setup';\nimport { setupBridge, openBridge, linkWindow, linkUrl, isBridge, needsBridge, needsBridgeForBrowser, hasBridge,\n    needsBridgeForWin, needsBridgeForDomain, destroyBridges } from './bridge';\n\nexport { ZalgoPromise as Promise } from 'zalgo-promise/src';\n\nexport * from './types';\nexport { ProxyWindow } from './serialize';\nexport { setup, destroy, serializeMessage, deserializeMessage, createProxyWindow, toProxyWindow } from './setup';\nexport { on, once, send } from './public';\nexport { markWindowKnown } from './lib';\nexport { cleanUpWindow } from './clean';\nexport let bridge;\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n    bridge = { setupBridge, openBridge, linkWindow, linkUrl, isBridge, needsBridge,\n        needsBridgeForBrowser, hasBridge, needsBridgeForWin, needsBridgeForDomain, destroyBridges };\n}\n\nif (__POST_ROBOT__.__AUTO_SETUP__) {\n    setup();\n}\n"],"sourceRoot":""}