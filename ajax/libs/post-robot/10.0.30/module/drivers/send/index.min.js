"use strict";exports.__esModule=!0,exports.sendMessage=sendMessage;var _src=require("cross-domain-utils/src"),_src2=require("belter/src"),_serialize=require("../../serialize"),_strategies=require("./strategies");function sendMessage(e,s,r,{on:i,send:t}){if((0,_src.isWindowClosed)(e))throw new Error("Window is closed");const n=(0,_serialize.serializeMessage)(e,s,{[__POST_ROBOT__.__GLOBAL_KEY__]:{id:(0,_src2.uniqueID)(),origin:(0,_src.getDomain)(window),...r}},{on:i,send:t}),o=Object.keys(_strategies.SEND_MESSAGE_STRATEGIES),_=[];for(const r of o)try{_strategies.SEND_MESSAGE_STRATEGIES[r](e,n,s)}catch(e){_.push(e)}if(_.length===o.length)throw new Error(`All post-robot messaging strategies failed:\n\n${_.map((e,s)=>`${s}. ${(0,_src2.stringifyError)(e)}`).join("\n\n")}`)}