"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.__BackgroundImpl=exports.Background=void 0;var _react=_interopRequireDefault(require("react")),_reactMeasure=_interopRequireWildcard(require("react-measure")),_constructUrl=_interopRequireDefault(require("./constructUrl")),_extractQueryParams3=_interopRequireDefault(require("./extractQueryParams")),_targetWidths=_interopRequireDefault(require("./targetWidths")),_findClosest=_interopRequireDefault(require("./findClosest"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var PACKAGE_VERSION="9.0.2",noop=function(){},findNearestWidth=function(e){return(0,_findClosest.default)(e,_targetWidths.default)},toFixed=function(e,t){return+t.toFixed(e)},BackgroundImpl=function(e){function t(e){r(e),"function"==typeof h&&h(e)}var r=e.measureRef,n=(e.measure,e.contentRect),o=e.imgixParams,i=void 0===o?{}:o,a=(e.onLoad,e.disableLibraryParam),u=e.src,c=e.children,l=e.className,d=void 0===l?"":l,f=i.w,s=i.h,p=null!=n.bounds.width&&null!=n.bounds.height,y=e.htmlAttributes||{},b=toFixed(2,i.dpr||global.devicePixelRatio||1),h=y.ref,_=function(){if(null!=f&&null!=s)return{width:f,height:s};if(!p)return{width:void 0,height:void 0};var e=n.bounds.width/n.bounds.height;if(null==f&&null==s){var t=findNearestWidth(n.bounds.width);return{width:t,height:Math.ceil(t/e)}}if(null==f)return null!=s?{width:Math.ceil(s*e),height:s}:void 0;var r=Math.ceil(f/e);return{width:f,height:r}}(),g=_.width,m=_.height,v=null!=g&&null!=m,O=_objectSpread({},y);if(!v)return _react.default.createElement("div",_extends({},O,{className:"react-imgix-bg-loading ".concat(d),ref:t}),c);var w,j,P,x=(w=_slicedToArray((0,_extractQueryParams3.default)(u),2),j=w[0],P=_objectSpread({},w[1],{fit:"crop"},i,{},a?{}:{ixlib:"react-".concat(PACKAGE_VERSION)},{width:g,height:m,dpr:b}),(0,_constructUrl.default)(j,P)),R=_objectSpread({},y.style,{backgroundImage:"url(".concat(x,")"),backgroundSize:void 0!==(y.style||{}).backgroundSize?y.style.backgroundSize:"cover"});return _react.default.createElement("div",_extends({},O,{className:d,ref:t,style:R}),c)};exports.__BackgroundImpl=BackgroundImpl;var Background=(0,_reactMeasure.withContentRect)("bounds")(BackgroundImpl);exports.Background=Background;