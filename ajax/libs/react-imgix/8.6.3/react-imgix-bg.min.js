"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__BackgroundImpl=exports.Background=void 0;var _react=_interopRequireDefault(require("react")),_reactMeasure=_interopRequireWildcard(require("react-measure")),_constructUrl=_interopRequireDefault(require("./constructUrl")),_extractQueryParams3=_interopRequireDefault(require("./extractQueryParams")),_targetWidths=_interopRequireDefault(require("./targetWidths")),_findClosest=_interopRequireDefault(require("./findClosest"));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return t}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function _objectSpread(r){for(var e=1;e<arguments.length;e++)if(e%2){var t=null!=arguments[e]?arguments[e]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(e){_defineProperty(r,e,t[e])})}else Object.defineProperties(r,Object.getOwnPropertyDescriptors(arguments[e]));return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var PACKAGE_VERSION="8.6.3",noop=function(){},findNearestWidth=function(e){return(0,_findClosest.default)(e,_targetWidths.default)},toFixed=function(e,r){return+r.toFixed(e)},BackgroundImpl=function(e){function r(e){t(e),"function"==typeof b&&b(e)}var t=e.measureRef,n=(e.measure,e.contentRect),i=e.imgixParams,a=void 0===i?{}:i,o=(e.onLoad,e.disableLibraryParam),u=e.src,c=e.children,l=e.className,d=void 0===l?"":l,s=a.w,f=a.h,p=null!=n.bounds.top,_=e.htmlAttributes||{},h=toFixed(2,a.dpr||global.devicePixelRatio||1),b=_.ref,y=function(){if(null!=s&&null!=f)return{width:s,height:f};if(!p)return{width:void 0,height:void 0};var e=n.bounds.width/n.bounds.height;if(null==s&&null==f){var r=findNearestWidth(n.bounds.width);return{width:r,height:Math.ceil(r/e)}}if(null==s)return null!=f?{width:Math.ceil(f*e),height:f}:void 0;var t=Math.ceil(s/e);return{width:s,height:t}}(),g=y.width,v=y.height,m=null!=g&&null!=v,O=_objectSpread({},_);if(!m)return _react.default.createElement("div",_extends({},O,{className:"react-imgix-bg-loading ".concat(d),ref:r}),c);var w,P,x,j=(w=_slicedToArray((0,_extractQueryParams3.default)(u),2),P=w[0],x=_objectSpread({},w[1],{fit:"crop"},a,{},o?{}:{ixlib:"react-".concat(PACKAGE_VERSION)},{width:g,height:v,dpr:h}),(0,_constructUrl.default)(P,x)),R=_objectSpread({},_.style,{backgroundImage:"url(".concat(j,")"),backgroundSize:void 0!==(_.style||{}).backgroundSize?_.style.backgroundSize:"cover"});return _react.default.createElement("div",_extends({},O,{className:d,ref:r,style:R}),c)};exports.__BackgroundImpl=BackgroundImpl;var Background=(0,_reactMeasure.withContentRect)("bounds")(BackgroundImpl);exports.Background=Background;