"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__BackgroundImpl=exports.Background=void 0;var _react=_interopRequireDefault(require("react")),_reactMeasure=_interopRequireWildcard(require("react-measure")),_constructUrl=_interopRequireDefault(require("./constructUrl")),_extractQueryParams3=_interopRequireDefault(require("./extractQueryParams")),_targetWidths=_interopRequireDefault(require("./targetWidths")),_findClosest=_interopRequireDefault(require("./findClosest"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r=_getRequireWildcardCache();if(r&&r.has(e))return r.get(e);var t={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=n?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(t,i,a):t[i]=e[i]}}return t.default=e,r&&r.set(e,t),t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var PACKAGE_VERSION="9.0.0",noop=function(){},findNearestWidth=function(e){return(0,_findClosest.default)(e,_targetWidths.default)},toFixed=function(e,r){return+r.toFixed(e)},BackgroundImpl=function(e){function r(e){t(e),"function"==typeof b&&b(e)}var t=e.measureRef,n=(e.measure,e.contentRect),i=e.imgixParams,a=void 0===i?{}:i,o=(e.onLoad,e.disableLibraryParam),u=e.src,c=e.children,l=e.className,d=void 0===l?"":l,s=a.w,f=a.h,p=null!=n.bounds.top,h=e.htmlAttributes||{},_=toFixed(2,a.dpr||global.devicePixelRatio||1),b=h.ref,y=function(){if(null!=s&&null!=f)return{width:s,height:f};if(!p)return{width:void 0,height:void 0};var e=n.bounds.width/n.bounds.height;if(null==s&&null==f){var r=findNearestWidth(n.bounds.width);return{width:r,height:Math.ceil(r/e)}}if(null==s)return null!=f?{width:Math.ceil(f*e),height:f}:void 0;var t=Math.ceil(s/e);return{width:s,height:t}}(),g=y.width,v=y.height,m=null!=g&&null!=v,O=_objectSpread({},h);if(!m)return _react.default.createElement("div",_extends({},O,{className:"react-imgix-bg-loading ".concat(d),ref:r}),c);var w,P,j,x=(w=_slicedToArray((0,_extractQueryParams3.default)(u),2),P=w[0],j=_objectSpread({},w[1],{fit:"crop"},a,{},o?{}:{ixlib:"react-".concat(PACKAGE_VERSION)},{width:g,height:v,dpr:_}),(0,_constructUrl.default)(P,j)),R=_objectSpread({},h.style,{backgroundImage:"url(".concat(x,")"),backgroundSize:void 0!==(h.style||{}).backgroundSize?h.style.backgroundSize:"cover"});return _react.default.createElement("div",_extends({},O,{className:d,ref:r,style:R}),c)};exports.__BackgroundImpl=BackgroundImpl;var Background=(0,_reactMeasure.withContentRect)("bounds")(BackgroundImpl);exports.Background=Background;