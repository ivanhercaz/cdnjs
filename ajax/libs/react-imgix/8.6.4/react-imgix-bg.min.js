"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__BackgroundImpl=exports.Background=void 0;var _react=_interopRequireDefault(require("react")),_reactMeasure=_interopRequireWildcard(require("react-measure")),_constructUrl=_interopRequireDefault(require("./constructUrl")),_extractQueryParams3=_interopRequireDefault(require("./extractQueryParams")),_targetWidths=_interopRequireDefault(require("./targetWidths")),_findClosest=_interopRequireDefault(require("./findClosest"));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return t}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var PACKAGE_VERSION="8.6.4",noop=function(){},findNearestWidth=function(e){return(0,_findClosest.default)(e,_targetWidths.default)},toFixed=function(e,r){return+r.toFixed(e)},BackgroundImpl=function(e){function r(e){t(e),"function"==typeof y&&y(e)}var t=e.measureRef,n=(e.measure,e.contentRect),i=e.imgixParams,o=void 0===i?{}:i,a=(e.onLoad,e.disableLibraryParam),u=e.src,c=e.children,l=e.className,d=void 0===l?"":l,s=o.w,f=o.h,p=null!=n.bounds.top,h=e.htmlAttributes||{},_=toFixed(2,o.dpr||global.devicePixelRatio||1),y=h.ref,b=function(){if(null!=s&&null!=f)return{width:s,height:f};if(!p)return{width:void 0,height:void 0};var e=n.bounds.width/n.bounds.height;if(null==s&&null==f){var r=findNearestWidth(n.bounds.width);return{width:r,height:Math.ceil(r/e)}}if(null==s)return null!=f?{width:Math.ceil(f*e),height:f}:void 0;var t=Math.ceil(s/e);return{width:s,height:t}}(),g=b.width,v=b.height,m=null!=g&&null!=v,O=_objectSpread({},h);if(!m)return _react.default.createElement("div",_extends({},O,{className:"react-imgix-bg-loading ".concat(d),ref:r}),c);var w,P,j,x=(w=_slicedToArray((0,_extractQueryParams3.default)(u),2),P=w[0],j=_objectSpread({},w[1],{fit:"crop"},o,{},a?{}:{ixlib:"react-".concat(PACKAGE_VERSION)},{width:g,height:v,dpr:_}),(0,_constructUrl.default)(P,j)),R=_objectSpread({},h.style,{backgroundImage:"url(".concat(x,")"),backgroundSize:void 0!==(h.style||{}).backgroundSize?h.style.backgroundSize:"cover"});return _react.default.createElement("div",_extends({},O,{className:d,ref:r,style:R}),c)};exports.__BackgroundImpl=BackgroundImpl;var Background=(0,_reactMeasure.withContentRect)("bounds")(BackgroundImpl);exports.Background=Background;