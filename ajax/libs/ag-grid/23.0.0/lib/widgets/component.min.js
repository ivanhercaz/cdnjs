"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(i<3?r(s):3<i?r(e,o,s):r(e,o))||s);return 3<i&&s&&Object.defineProperty(e,o,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),beanStub_1=require("../context/beanStub"),utils_1=require("../utils"),compIdSequence=new utils_1.NumberSequence,Component=function(o){function n(t){var e=o.call(this)||this;return e.childComponents=[],e.annotatedEventListeners=[],e.displayed=!0,e.visible=!0,e.compId=compIdSequence.next(),t&&e.setTemplate(t),e}return __extends(n,o),n.prototype.getCompId=function(){return this.compId},n.prototype.createChildComponentsFromTags=function(n){var r=this;utils_1._.copyNodeList(n.childNodes).forEach(function(e){var t=r.getContext().createComponentFromElement(e,function(t){r.copyAttributesFromNode(e,t.getGui())});if(t){if(t.addItems&&e.children.length){r.createChildComponentsFromTags(e);var o=Array.prototype.slice.call(e.children);t.addItems(o)}r.swapComponentForNode(t,n,e)}else e.childNodes&&r.createChildComponentsFromTags(e)})},n.prototype.copyAttributesFromNode=function(t,o){utils_1._.iterateNamedNodeMap(t.attributes,function(t,e){o.setAttribute(t,e)})},n.prototype.swapComponentForNode=function(t,e,o){var n=t.getGui();e.replaceChild(n,o),e.insertBefore(document.createComment(o.nodeName),n),this.childComponents.push(t),this.swapInComponentForQuerySelectors(t,o)},n.prototype.swapInComponentForQuerySelectors=function(e,o){for(var t=Object.getPrototypeOf(this),n=this;null!=t;){var r=t.__agComponentMetaData,i=t.constructor.name;r&&r[i]&&r[i].querySelectors&&r[i].querySelectors.forEach(function(t){n[t.attributeName]===o&&(n[t.attributeName]=e)}),t=Object.getPrototypeOf(t)}},n.prototype.setTemplate=function(t){var e=utils_1._.loadTemplate(t);this.setTemplateFromElement(e)},n.prototype.setTemplateFromElement=function(t){this.eGui=t,(this.eGui.__agComponent=this).addAnnotatedEventListeners(),this.wireQuerySelectors(),this.getContext()&&this.createChildComponentsFromTags(this.getGui())},n.prototype.createChildComponentsPreConstruct=function(){!this.getGui()||this.createChildComponentsFromTags(this.getGui())},n.prototype.wireQuerySelectors=function(){var r=this;if(this.eGui)for(var o=Object.getPrototypeOf(this),t=function(){var t=o.__agComponentMetaData,e=o.constructor.name;if(t&&t[e]&&t[e].querySelectors){var n=i;t[e].querySelectors.forEach(function(t){var e=r.eGui.querySelector(t.querySelector);if(e){var o=e.__agComponent;n[t.attributeName]=o||e}})}o=Object.getPrototypeOf(o)},i=this;null!=o;)t()},n.prototype.addAnnotatedEventListeners=function(){var o=this;if(this.removeAnnotatedEventListeners(),this.eGui){var t=this.getAgComponentMetaData("listenerMethods");utils_1._.missingOrEmpty(t)||(this.annotatedEventListeners||(this.annotatedEventListeners=[]),t.forEach(function(t){var e=o[t.methodName].bind(o);o.eGui.addEventListener(t.eventName,e),o.annotatedEventListeners.push({eventName:t.eventName,listener:e})}))}},n.prototype.getAgComponentMetaData=function(t){for(var e=[],o=Object.getPrototypeOf(this);null!=o;){var n=o.__agComponentMetaData,r=o.constructor.name;if(void 0===r){var i=/function\s([^(]{1,})\(/.exec(o.constructor.toString());i&&1<i.length&&(r=i[1].trim())}n&&n[r]&&n[r][t]&&(e=e.concat(n[r][t])),o=Object.getPrototypeOf(o)}return e},n.prototype.removeAnnotatedEventListeners=function(){var e=this;this.annotatedEventListeners&&this.eGui&&(this.annotatedEventListeners.forEach(function(t){e.eGui.removeEventListener(t.eventName,t.listener)}),this.annotatedEventListeners=[])},n.prototype.getGui=function(){return this.eGui},n.prototype.setParentComponent=function(t){this.parentComponent=t},n.prototype.getParentComponent=function(){return this.parentComponent},n.prototype.setGui=function(t){this.eGui=t},n.prototype.queryForHtmlElement=function(t){return this.eGui.querySelector(t)},n.prototype.queryForHtmlInputElement=function(t){return this.eGui.querySelector(t)},n.prototype.appendChild=function(t){if(utils_1._.isNodeOrElement(t))this.eGui.appendChild(t);else{var e=t;this.eGui.appendChild(e.getGui()),this.childComponents.push(e)}},n.prototype.addFeature=function(t,e){t.wireBean(e),e.destroy&&this.addDestroyFunc(e.destroy.bind(e))},n.prototype.isDisplayed=function(){return this.displayed},n.prototype.setVisible=function(t){t!==this.visible&&(this.visible=t,utils_1._.setVisible(this.eGui,t))},n.prototype.setDisplayed=function(t){if(t!==this.displayed){this.displayed=t,utils_1._.setDisplayed(this.eGui,t);var e={type:n.EVENT_DISPLAYED_CHANGED,visible:this.displayed};this.dispatchEvent(e)}},n.prototype.addOrRemoveCssClass=function(t,e){utils_1._.addOrRemoveCssClass(this.eGui,t,e)},n.prototype.destroy=function(){o.prototype.destroy.call(this),this.childComponents.forEach(function(t){t&&t.destroy&&t.destroy()}),this.childComponents.length=0,this.removeAnnotatedEventListeners()},n.prototype.addGuiEventListener=function(t,e){var o=this;this.getGui().addEventListener(t,e),this.addDestroyFunc(function(){return o.getGui().removeEventListener(t,e)})},n.prototype.addCssClass=function(t){utils_1._.addCssClass(this.getGui(),t)},n.prototype.removeCssClass=function(t){utils_1._.removeCssClass(this.getGui(),t)},n.prototype.getAttribute=function(t){var e=this.getGui();return e?e.getAttribute(t):null},n.prototype.getRefElement=function(t){return this.queryForHtmlElement('[ref="'+t+'"]')},n.EVENT_DISPLAYED_CHANGED="displayedChanged",__decorate([context_1.PreConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],n.prototype,"createChildComponentsPreConstruct",null),n}(beanStub_1.BeanStub);exports.Component=Component;