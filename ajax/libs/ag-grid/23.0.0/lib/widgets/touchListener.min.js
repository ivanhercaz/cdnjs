"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var eventService_1=require("../eventService"),utils_1=require("../utils"),TouchListener=function(){function s(t,e){var i=this;void 0===e&&(e=!1),this.destroyFuncs=[],this.touching=!1,this.eventService=new eventService_1.EventService,this.eElement=t,this.preventMouseClick=e;var n=this.onTouchStart.bind(this),o=this.onTouchMove.bind(this),s=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",n,{passive:!0}),this.eElement.addEventListener("touchmove",o,{passive:!0}),this.eElement.addEventListener("touchend",s,{passive:!1}),this.destroyFuncs.push(function(){i.eElement.removeEventListener("touchstart",n,{passive:!0}),i.eElement.removeEventListener("touchmove",o,{passive:!0}),i.eElement.removeEventListener("touchend",s,{passive:!1})})}return s.prototype.getActiveTouch=function(t){for(var e=0;e<t.length;e++){if(t[e].identifier===this.touchStart.identifier)return t[e]}return null},s.prototype.addEventListener=function(t,e){this.eventService.addEventListener(t,e)},s.prototype.removeEventListener=function(t,e){this.eventService.removeEventListener(t,e)},s.prototype.onTouchStart=function(i){var n=this;if(!this.touching){this.touchStart=i.touches[0],this.touching=!0,this.moved=!1;var o=this.touchStart;window.setTimeout(function(){var t=n.touchStart===o;if(n.touching&&t&&!n.moved){n.moved=!0;var e={type:s.EVENT_LONG_TAP,touchStart:n.touchStart,touchEvent:i};n.eventService.dispatchEvent(e)}},500)}},s.prototype.onTouchMove=function(t){if(this.touching){var e=this.getActiveTouch(t.touches);if(e)!utils_1._.areEventsNear(e,this.touchStart,4)&&(this.moved=!0)}},s.prototype.onTouchEnd=function(t){if(this.touching){if(!this.moved){var e={type:s.EVENT_TAP,touchStart:this.touchStart};this.eventService.dispatchEvent(e),this.checkForDoubleTap()}this.preventMouseClick&&t.preventDefault(),this.touching=!1}},s.prototype.checkForDoubleTap=function(){var t=(new Date).getTime();if(this.lastTapTime&&0<this.lastTapTime){var e=t-this.lastTapTime;if(s.DOUBLE_TAP_MILLIS<e){var i={type:s.EVENT_DOUBLE_TAP,touchStart:this.touchStart};this.eventService.dispatchEvent(i),this.lastTapTime=null}else this.lastTapTime=t}else this.lastTapTime=t},s.prototype.destroy=function(){this.destroyFuncs.forEach(function(t){return t()})},s.EVENT_TAP="tap",s.EVENT_DOUBLE_TAP="doubleTap",s.EVENT_LONG_TAP="longTap",s.DOUBLE_TAP_MILLIS=500,s}();exports.TouchListener=TouchListener;