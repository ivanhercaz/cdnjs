"use strict";var __decorate=this&&this.__decorate||function(e,o,t,n){var r,p=arguments.length,i=p<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,n);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(i=(p<3?r(i):3<p?r(o,t,i):r(o,t))||i);return 3<p&&i&&Object.defineProperty(o,t,i),i},__metadata=this&&this.__metadata||function(e,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,o)};Object.defineProperty(exports,"__esModule",{value:!0});var ComponentSource,context_1=require("../../context/context"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),userComponentRegistry_1=require("./userComponentRegistry"),agComponentUtils_1=require("./agComponentUtils"),componentMetadataProvider_1=require("./componentMetadataProvider"),utils_1=require("../../utils");!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.REGISTERED_BY_NAME=1]="REGISTERED_BY_NAME",e[e.HARDCODED=2]="HARDCODED"}(ComponentSource=exports.ComponentSource||(exports.ComponentSource={}));var UserComponentFactory=function(){function e(){}return e.prototype.newDateComponent=function(e){return this.createAndInitUserComponent(this.gridOptions,e,"dateComponent","agDateInput")},e.prototype.newHeaderComponent=function(e){return this.createAndInitUserComponent(e.column.getColDef(),e,"headerComponent","agColumnHeader")},e.prototype.newHeaderGroupComponent=function(e){return this.createAndInitUserComponent(e.columnGroup.getColGroupDef(),e,"headerGroupComponent","agColumnGroupHeader")},e.prototype.newFullWidthGroupRowInnerCellRenderer=function(e){return this.createAndInitUserComponent(this.gridOptions,e,"groupRowInnerRenderer",null,!0)},e.prototype.newFullWidthCellRenderer=function(e,o,t){return this.createAndInitUserComponent(null,e,o,t)},e.prototype.newCellRenderer=function(e,o){return this.createAndInitUserComponent(e,o,"cellRenderer",null,!0)},e.prototype.newPinnedRowCellRenderer=function(e,o){return this.createAndInitUserComponent(e,o,"pinnedRowCellRenderer",null,!0)},e.prototype.newCellEditor=function(e,o){return this.createAndInitUserComponent(e,o,"cellEditor","agCellEditor")},e.prototype.newInnerCellRenderer=function(e,o){return this.createAndInitUserComponent(e,o,"innerRenderer",null)},e.prototype.newLoadingOverlayComponent=function(e){return this.createAndInitUserComponent(this.gridOptions,e,"loadingOverlayComponent","agLoadingOverlay")},e.prototype.newNoRowsOverlayComponent=function(e){return this.createAndInitUserComponent(this.gridOptions,e,"noRowsOverlayComponent","agNoRowsOverlay")},e.prototype.newTooltipComponent=function(e){var o=e.colDef;return this.createAndInitUserComponent(o,e,"tooltipComponent","agTooltipComponent")},e.prototype.newFilterComponent=function(e,o,t,n){return this.createAndInitUserComponent(e,o,"filter",t,!1,n)},e.prototype.newFloatingFilterComponent=function(e,o,t){return this.createAndInitUserComponent(e,o,"floatingFilterComponent",t,!0)},e.prototype.newToolPanelComponent=function(e,o){return this.createAndInitUserComponent(e,o,"toolPanel")},e.prototype.newStatusPanelComponent=function(e,o){return this.createAndInitUserComponent(e,o,"statusPanel")},e.prototype.createAndInitUserComponent=function(e,o,t,n,r,p){void 0===r&&(r=!1),e=e||this.gridOptions;var i=this.createComponentInstance(e,t,o,n,r);if(!i)return null;var a=i.componentInstance,m=this.createFinalParams(e,t,o,i.paramsFromSelector);this.addReactHacks(m);var c=p?p(m,a):m,s=this.initComponent(a,c);return null==s?utils_1.Promise.resolve(a):s.map(function(e){return a})},e.prototype.addReactHacks=function(e){var o=this.context.getBean("agGridReact");o&&(e.agGridReact=utils_1._.cloneObject(o));var t=this.context.getBean("frameworkComponentWrapper");t&&(e.frameworkComponentWrapper=t)},e.prototype.createUserComponentFromConcreteClass=function(e,o){var t=new e;return this.initComponent(t,o),t},e.prototype.lookupComponentClassDef=function(e,o,t,n){void 0===t&&(t=null);var r,p=null,i=null,a=null,m=null;if(null!=e){var c=e[o];null==c||!0===c||("string"==typeof c?p=c:"boolean"==typeof c||(this.agComponentUtils.doesImplementIComponent(c)?i=c:a=c)),m=e[o+"Framework"],r=e[o+"Selector"]}if(i&&m||p&&m||a&&m)throw Error("ag-grid: you are trying to specify: "+o+" twice as a component.");if(m&&!this.frameworkComponentWrapper)throw Error("ag-grid: you are specifying a framework component but you are not using a framework version of ag-grid for : "+o);if(r&&(p||i||a||m))throw Error("ag-grid: you can't specify both, the selector and the component of ag-grid for : "+o);if(m)return{componentFromFramework:!0,component:m,source:ComponentSource.HARDCODED,paramsFromSelector:null};if(i)return{componentFromFramework:!1,component:i,source:ComponentSource.HARDCODED,paramsFromSelector:null};if(a)return this.agComponentUtils.adaptFunction(o,a,!1,ComponentSource.HARDCODED);var s,u=r?r(t):null;if(!(s=u&&u.component?u.component:p||n))return null;var l=this.lookupFromRegisteredComponents(o,s);return{componentFromFramework:l.componentFromFramework,component:l.component,source:l.source,paramsFromSelector:u?u.params:null}},e.prototype.lookupFromRegisteredComponents=function(e,o){var t=null!=o?o:e,n=this.userComponentRegistry.retrieve(t);return null==n?null:n.componentFromFramework?{component:n.component,componentFromFramework:!0,source:ComponentSource.REGISTERED_BY_NAME,paramsFromSelector:null}:this.agComponentUtils.doesImplementIComponent(n.component)?{component:n.component,componentFromFramework:!1,source:n.source==userComponentRegistry_1.RegisteredComponentSource.REGISTERED?ComponentSource.REGISTERED_BY_NAME:ComponentSource.DEFAULT,paramsFromSelector:null}:this.agComponentUtils.adaptFunction(e,n.component,n.componentFromFramework,n.source==userComponentRegistry_1.RegisteredComponentSource.REGISTERED?ComponentSource.REGISTERED_BY_NAME:ComponentSource.DEFAULT)},e.prototype.createFinalParams=function(e,o,t,n){void 0===n&&(n=null);var r={};utils_1._.mergeDeep(r,t);var p=e?e[o+"Params"]:null;return null!=p&&("function"==typeof p?utils_1._.mergeDeep(r,p(t)):"object"==typeof p&&utils_1._.mergeDeep(r,p)),utils_1._.mergeDeep(r,n),r},e.prototype.createComponentInstance=function(e,o,t,n,r){var p,i=this.lookupComponentClassDef(e,o,t,n);if(!i||!i.component)return r||console.error("Error creating component "+o+"=>"+n),null;if(i.componentFromFramework){var a=i.component,m=this.componentMetadataProvider.retrieve(o);p=this.frameworkComponentWrapper.wrap(a,m.mandatoryMethodList,m.optionalMethodList,n)}else p=new i.component;return{componentInstance:p,paramsFromSelector:i.paramsFromSelector}},e.prototype.initComponent=function(e,o){return this.context.wireBean(e),null==e.init?void 0:e.init(o)},__decorate([context_1.Autowired("gridOptions"),__metadata("design:type",Object)],e.prototype,"gridOptions",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_1.Context)],e.prototype,"context",void 0),__decorate([context_1.Autowired("agComponentUtils"),__metadata("design:type",agComponentUtils_1.AgComponentUtils)],e.prototype,"agComponentUtils",void 0),__decorate([context_1.Autowired("componentMetadataProvider"),__metadata("design:type",componentMetadataProvider_1.ComponentMetadataProvider)],e.prototype,"componentMetadataProvider",void 0),__decorate([context_1.Autowired("userComponentRegistry"),__metadata("design:type",userComponentRegistry_1.UserComponentRegistry)],e.prototype,"userComponentRegistry",void 0),__decorate([context_1.Optional("frameworkComponentWrapper"),__metadata("design:type",Object)],e.prototype,"frameworkComponentWrapper",void 0),e=__decorate([context_1.Bean("userComponentFactory")],e)}();exports.UserComponentFactory=UserComponentFactory;