"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var a,n=arguments.length,o=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;0<=s;s--)(a=t[s])&&(o=(n<3?a(o):3<n?a(e,i,o):a(e,i))||o);return 3<n&&o&&Object.defineProperty(e,i,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var agAbstractLabel_1=require("./agAbstractLabel"),componentAnnotations_1=require("./componentAnnotations"),context_1=require("../context/context"),dragService_1=require("../dragAndDrop/dragService"),agInputNumberField_1=require("./agInputNumberField"),agAbstractField_1=require("./agAbstractField"),utils_1=require("../utils"),AgAngleSelect=function(e){function i(){var t=e.call(this,i.TEMPLATE)||this;return t.radius=0,t.offsetX=0,t.offsetY=0,t}return __extends(i,e),i.prototype.postConstruct=function(){var i=this;e.prototype.postConstruct.call(this),this.dragListener={eElement:this.eParentCircle,dragStartPixels:0,onDragStart:function(t){i.parentCircleRect=i.eParentCircle.getBoundingClientRect()},onDragging:function(t){return i.calculateAngleDrag(t)},onDragStop:function(){}},this.dragService.addDragSource(this.dragListener),this.eAngleValue.setLabel("").setLabelWidth(5).setInputWidth(45).setMin(0).setMax(360).setValue(""+this.degrees).onValueChange(function(t){null!=t&&""!==t||(t="0"),t=i.eAngleValue.normalizeValue(t);var e=parseFloat(t);180<e&&(e-=360),i.setValue(e)}),this.updateNumberInput(),utils_1._.exists(this.getValue())&&this.eAngleValue.setValue(this.normalizeNegativeValue(this.getValue()).toString()),this.addDestroyableEventListener(this,agAbstractField_1.AgAbstractField.EVENT_CHANGED,function(){i.eAngleValue.getInputElement().contains(document.activeElement)||i.updateNumberInput()})},i.prototype.updateNumberInput=function(){var t=this.normalizeNegativeValue(this.getValue());this.eAngleValue.setValue(t.toString())},i.prototype.positionChildCircle=function(t){var e=this.parentCircleRect||{width:24,height:24},i=this.eChildCircle,r=e.width/2,a=e.height/2;i.style.left=r+8*Math.cos(t)+"px",i.style.top=a+8*Math.sin(t)+"px"},i.prototype.calculatePolar=function(){var t=this.offsetX,e=this.offsetY,i=Math.atan2(e,t);this.degrees=this.toDegrees(i),this.radius=Math.sqrt(t*t+e*e),this.positionChildCircle(i)},i.prototype.calculateCartesian=function(){var t=this.toRadians(this.getValue()),e=this.getRadius();this.setOffsetX(Math.cos(t)*e).setOffsetY(Math.sin(t)*e)},i.prototype.setOffsetX=function(t){return this.offsetX!==t&&(this.offsetX=t,this.calculatePolar()),this},i.prototype.setOffsetY=function(t){return this.offsetY!==t&&(this.offsetY=t,this.calculatePolar()),this},i.prototype.calculateAngleDrag=function(t){var e=this.parentCircleRect,i=e.width/2,r=e.height/2,a=t.clientX-e.left-i,n=t.clientY-e.top-r,o=Math.atan2(n,a);this.setValue(o,!0)},i.prototype.toDegrees=function(t){return t/Math.PI*180},i.prototype.toRadians=function(t){return t/180*Math.PI},i.prototype.normalizeNegativeValue=function(t){return t<0?360+t:t},i.prototype.normalizeAngle180=function(t){return(t%=2*Math.PI)<-Math.PI?t+=2*Math.PI:t>=Math.PI&&(t-=2*Math.PI),t},i.prototype.getRadius=function(){return this.radius},i.prototype.setRadius=function(t){return this.radius===t||(this.radius=t,this.calculateCartesian()),this},i.prototype.onValueChange=function(t){var e=this;return this.addDestroyableEventListener(this,agAbstractField_1.AgAbstractField.EVENT_CHANGED,function(){t(e.degrees)}),this},i.prototype.getValue=function(t){return t?this.toRadians(this.degrees):this.degrees},i.prototype.setValue=function(t,e){var i;return i=e?t:this.normalizeAngle180(this.toRadians(t)),t=this.toDegrees(i),this.degrees!==t&&(this.degrees=Math.floor(t),this.calculateCartesian(),this.positionChildCircle(i),this.dispatchEvent({type:agAbstractField_1.AgAbstractField.EVENT_CHANGED})),this},i.prototype.setWidth=function(t){return utils_1._.setFixedWidth(this.getGui(),t),this},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.dragService.removeDragSource(this.dragListener)},i.TEMPLATE='<div class="ag-angle-select">\n            <label ref="eLabel"></label>\n            <div class="ag-wrapper">\n                <div ref="eAngleSelectField" class="ag-angle-select-field">\n                    <div ref="eParentCircle" class="ag-parent-circle">\n                        <div ref="eChildCircle" class="ag-child-circle"></div>\n                    </div>\n                </div>\n                <ag-input-number-field ref="eAngleValue"></ag-input-number-field>\n            </div>\n        </div>',__decorate([componentAnnotations_1.RefSelector("eLabel"),__metadata("design:type",HTMLElement)],i.prototype,"eLabel",void 0),__decorate([componentAnnotations_1.RefSelector("eParentCircle"),__metadata("design:type",HTMLElement)],i.prototype,"eParentCircle",void 0),__decorate([componentAnnotations_1.RefSelector("eChildCircle"),__metadata("design:type",HTMLElement)],i.prototype,"eChildCircle",void 0),__decorate([componentAnnotations_1.RefSelector("eAngleValue"),__metadata("design:type",agInputNumberField_1.AgInputNumberField)],i.prototype,"eAngleValue",void 0),__decorate([context_1.Autowired("dragService"),__metadata("design:type",dragService_1.DragService)],i.prototype,"dragService",void 0),i}(agAbstractLabel_1.AgAbstractLabel);exports.AgAngleSelect=AgAngleSelect;