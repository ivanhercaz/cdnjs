"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var cellComp_1=require("./cellComp"),rowNode_1=require("../entities/rowNode"),column_1=require("../entities/column"),events_1=require("../events"),component_1=require("../widgets/component"),utils_1=require("../utils"),RowComp=function(u){function s(e,t,o,n,i,s,r,a,l,d,h){var p=u.call(this)||this;return p.eAllRowContainers=[],p.active=!0,p.rowContainerReadyCount=0,p.refreshNeeded=!1,p.columnRefreshPending=!1,p.cellComps={},p.createSecondPassFuncs=[],p.removeFirstPassFuncs=[],p.removeSecondPassFuncs=[],p.initialised=!1,p.parentScope=e,p.beans=r,p.bodyContainerComp=t,p.pinnedLeftContainerComp=o,p.pinnedRightContainerComp=n,p.fullWidthContainerComp=i,p.rowNode=s,p.rowIsEven=p.rowNode.rowIndex%2==0,p.paginationPage=p.beans.paginationProxy.getCurrentPage(),p.useAnimationFrameForCreate=l,p.printLayout=d,p.embedFullWidth=h,p.setAnimateFlags(a),p}return __extends(s,u),s.prototype.init=function(){var e=this;this.rowFocused=this.beans.focusedCellController.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned),this.scope=this.createChildScopeOrNull(this.rowNode.data),this.setupRowContainers(),this.addListeners(),this.slideRowIn&&this.createSecondPassFuncs.push(function(){e.onTopChanged()}),this.fadeRowIn&&this.createSecondPassFuncs.push(function(){e.eAllRowContainers.forEach(function(e){return utils_1._.removeCssClass(e,"ag-opacity-zero")})})},s.prototype.createTemplate=function(e,t){void 0===t&&(t=null);var o=[],n=this.rowNode.rowHeight,i=this.getInitialRowClasses(t).join(" "),s=utils_1._.escape(this.rowNode.id),r=this.preProcessStylesFromGridOptions(),a=this.getRowBusinessKey(),l=utils_1._.escape(a),d=this.getInitialRowTopStyle(),h=this.rowNode.getRowIndexString(),p=this.beans.gridPanel.headerRootComp.getHeaderRowCount();return o.push("<div"),o.push(' role="row"'),o.push(' row-index="'+h+'" aria-rowindex="'+(p+this.rowNode.rowIndex+1)+'"'),o.push(s?' row-id="'+s+'"':""),o.push(a?' row-business-key="'+l+'"':""),o.push(' comp-id="'+this.getCompId()+'"'),o.push(' class="'+i+'"'),o.push(' style="height: '+n+"px; "+d+" "+r+'">'),o.push(e),o.push("</div>"),o.join("")},s.prototype.getCellForCol=function(e){var t=this.cellComps[e.getColId()];return t?t.getGui():null},s.prototype.afterFlush=function(){this.initialised||(this.initialised=!0,this.executeProcessRowPostCreateFunc())},s.prototype.executeProcessRowPostCreateFunc=function(){var e=this.beans.gridOptionsWrapper.getProcessRowPostCreateFunc();e&&e({eRow:this.eBodyRow,ePinnedLeftRow:this.ePinnedLeftRow,ePinnedRightRow:this.ePinnedRightRow,node:this.rowNode,api:this.beans.gridOptionsWrapper.getApi(),rowIndex:this.rowNode.rowIndex,addRenderedRowListener:this.addEventListener.bind(this),columnApi:this.beans.gridOptionsWrapper.getColumnApi(),context:this.beans.gridOptionsWrapper.getContext()})},s.prototype.getInitialRowTopStyle=function(){if(this.printLayout)return"";var e=this.slideRowIn?this.roundRowTopToBounds(this.rowNode.oldRowTop):this.rowNode.rowTop,t=this.applyPaginationOffset(e),o=this.beans.maxDivHeightScaler.getRealPixelPosition(t);return this.beans.gridOptionsWrapper.isSuppressRowTransform()?"top: "+o+"px; ":"transform: translateY("+o+"px);"},s.prototype.getRowBusinessKey=function(){var e=this.beans.gridOptionsWrapper.getBusinessKeyForNodeFunc();if("function"==typeof e)return e(this.rowNode)},s.prototype.areAllContainersReady=function(){return 3===this.rowContainerReadyCount},s.prototype.lazyCreateCells=function(e,t){if(this.active){var o=this.createCells(e);t.innerHTML=o.template,this.callAfterRowAttachedOnCells(o.cellComps,t),this.rowContainerReadyCount++,this.areAllContainersReady()&&this.refreshNeeded&&this.refreshCells()}},s.prototype.createRowContainer=function(t,o,n){var i=this,s=this.useAnimationFrameForCreate,r=s?{cellComps:[],template:""}:this.createCells(o),e=this.createTemplate(r.template);t.appendRowTemplate(e,function(){var e=t.getRowElement(i.getCompId());i.afterRowAttached(t,e),n(e),s?i.beans.taskQueue.addP1Task(i.lazyCreateCells.bind(i,o,e),i.rowNode.rowIndex):(i.callAfterRowAttachedOnCells(r.cellComps,e),i.rowContainerReadyCount=3)})},s.prototype.createChildScopeOrNull=function(e){if(!this.beans.gridOptionsWrapper.isAngularCompileRows())return null;var t=this.parentScope.$new();return t.data=__assign({},e),t.rowNode=this.rowNode,t.context=this.beans.gridOptionsWrapper.getContext(),this.addDestroyFunc(function(){t.$destroy(),t.data=null,t.rowNode=null,t.context=null}),t},s.prototype.setupRowContainers=function(){var e=this.beans.gridOptionsWrapper.getIsFullWidthCellFunc(),t=!!e&&e(this.rowNode),o=this.beans.doingMasterDetail&&this.rowNode.detail,n=this.beans.columnController.isPivotMode(),i=this.rowNode.group&&!this.rowNode.footer&&this.beans.gridOptionsWrapper.isGroupUseEntireRow(n);this.rowNode.stub?this.createFullWidthRows(s.LOADING_CELL_RENDERER,s.LOADING_CELL_RENDERER_COMP_NAME):o?this.createFullWidthRows(s.DETAIL_CELL_RENDERER,s.DETAIL_CELL_RENDERER_COMP_NAME):t?this.createFullWidthRows(s.FULL_WIDTH_CELL_RENDERER,null):i?this.createFullWidthRows(s.GROUP_ROW_RENDERER,s.GROUP_ROW_RENDERER_COMP_NAME):this.setupNormalRowContainers()},s.prototype.setupNormalRowContainers=function(){var e,t,o,n=this;o=this.printLayout?(e=this.beans.columnController.getAllDisplayedColumns(),t=[],[]):(e=this.beans.columnController.getAllDisplayedCenterVirtualColumnsForRow(this.rowNode),t=this.beans.columnController.getDisplayedLeftColumnsForRow(this.rowNode),this.beans.columnController.getDisplayedRightColumnsForRow(this.rowNode)),this.createRowContainer(this.bodyContainerComp,e,function(e){return n.eBodyRow=e}),this.createRowContainer(this.pinnedRightContainerComp,o,function(e){return n.ePinnedRightRow=e}),this.createRowContainer(this.pinnedLeftContainerComp,t,function(e){return n.ePinnedLeftRow=e})},s.prototype.createFullWidthRows=function(e,t){var o=this;this.fullWidthRow=!0,this.embedFullWidth?(this.createFullWidthRowContainer(this.bodyContainerComp,null,null,e,t,function(e){o.eFullWidthRowBody=e},function(e){o.fullWidthRowComponentBody=e}),this.printLayout||(this.createFullWidthRowContainer(this.pinnedLeftContainerComp,column_1.Column.PINNED_LEFT,"ag-cell-last-left-pinned",e,t,function(e){o.eFullWidthRowLeft=e},function(e){o.fullWidthRowComponentLeft=e}),this.createFullWidthRowContainer(this.pinnedRightContainerComp,column_1.Column.PINNED_RIGHT,"ag-cell-first-right-pinned",e,t,function(e){o.eFullWidthRowRight=e},function(e){o.fullWidthRowComponentRight=e}))):this.createFullWidthRowContainer(this.fullWidthContainerComp,null,null,e,t,function(e){o.eFullWidthRow=e},function(e){o.fullWidthRowComponent=e})},s.prototype.setAnimateFlags=function(e){if(e){var t=utils_1._.exists(this.rowNode.oldRowTop);this.slideRowIn=t,this.fadeRowIn=!t}else this.slideRowIn=!1,this.fadeRowIn=!1},s.prototype.isEditing=function(){return this.editingRow},s.prototype.stopRowEditing=function(e){this.stopEditing(e)},s.prototype.isFullWidth=function(){return this.fullWidthRow},s.prototype.refreshFullWidth=function(){function e(e,t,o){if(!e||!t)return!0;if(!t.refresh)return!1;var n=i.createFullWidthParams(e,o);return t.refresh(n)}var i=this,t=e(this.eFullWidthRow,this.fullWidthRowComponent,null),o=e(this.eFullWidthRowBody,this.fullWidthRowComponentBody,null),n=e(this.eFullWidthRowLeft,this.fullWidthRowComponentLeft,column_1.Column.PINNED_LEFT),s=e(this.eFullWidthRowRight,this.fullWidthRowComponentRight,column_1.Column.PINNED_RIGHT);return t&&o&&n&&s},s.prototype.addListeners=function(){this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_HEIGHT_CHANGED,this.onRowHeightChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_ROW_SELECTED,this.onRowSelected.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_ROW_INDEX_CHANGED,this.onRowIndexChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_TOP_CHANGED,this.onTopChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_EXPANDED_CHANGED,this.onExpandedChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_DATA_CHANGED,this.onRowNodeDataChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_CELL_CHANGED,this.onRowNodeCellChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_DRAGGING_CHANGED,this.onRowNodeDraggingChanged.bind(this));var e=this.beans.eventService;this.addDestroyableEventListener(e,events_1.Events.EVENT_HEIGHT_SCALE_CHANGED,this.onTopChanged.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_VIRTUAL_COLUMNS_CHANGED,this.onVirtualColumnsChanged.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_COLUMN_RESIZED,this.onColumnResized.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_CELL_FOCUSED,this.onCellFocusChanged.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_PAGINATION_CHANGED,this.onPaginationChanged.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_GRID_COLUMNS_CHANGED,this.onGridColumnsChanged.bind(this)),this.addDestroyableEventListener(e,events_1.Events.EVENT_MODEL_UPDATED,this.onModelUpdated.bind(this)),this.addListenersForCellComps()},s.prototype.addListenersForCellComps=function(){var e=this;this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_ROW_INDEX_CHANGED,function(){e.forEachCellComp(function(e){return e.onRowIndexChanged()})}),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_CELL_CHANGED,function(t){e.forEachCellComp(function(e){return e.onCellChanged(t)})})},s.prototype.onGridColumnsChanged=function(){this.removeRenderedCells(Object.keys(this.cellComps))},s.prototype.onRowNodeDataChanged=function(t){this.forEachCellComp(function(e){return e.refreshCell({suppressFlash:!t.update,newData:!t.update})}),this.onRowSelected(),this.postProcessCss()},s.prototype.onRowNodeCellChanged=function(e){this.postProcessCss()},s.prototype.postProcessCss=function(){this.postProcessStylesFromGridOptions(),this.postProcessClassesFromGridOptions(),this.postProcessRowClassRules(),this.postProcessRowDragging()},s.prototype.onRowNodeDraggingChanged=function(){this.postProcessRowDragging()},s.prototype.postProcessRowDragging=function(){var t=this.rowNode.dragging;this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-dragging",t)})},s.prototype.onExpandedChanged=function(){var t=this.rowNode;this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-group-expanded",t.expanded)}),this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-group-contracted",!t.expanded)})},s.prototype.onDisplayedColumnsChanged=function(){this.fullWidthRow||this.refreshCells()},s.prototype.destroyFullWidthComponents=function(){this.fullWidthRowComponent&&(this.beans.detailRowCompCache.addOrDestroy(this.rowNode,null,this.fullWidthRowComponent),this.fullWidthRowComponent=null),this.fullWidthRowComponentBody&&(this.beans.detailRowCompCache.addOrDestroy(this.rowNode,null,this.fullWidthRowComponentBody),this.fullWidthRowComponent=null),this.fullWidthRowComponentLeft&&(this.beans.detailRowCompCache.addOrDestroy(this.rowNode,column_1.Column.PINNED_LEFT,this.fullWidthRowComponentLeft),this.fullWidthRowComponentLeft=null),this.fullWidthRowComponentRight&&(this.beans.detailRowCompCache.addOrDestroy(this.rowNode,column_1.Column.PINNED_RIGHT,this.fullWidthRowComponentRight),this.fullWidthRowComponent=null)},s.prototype.getContainerForCell=function(e){switch(e){case column_1.Column.PINNED_LEFT:return this.ePinnedLeftRow;case column_1.Column.PINNED_RIGHT:return this.ePinnedRightRow;default:return this.eBodyRow}},s.prototype.onVirtualColumnsChanged=function(){this.fullWidthRow||this.refreshCells()},s.prototype.onColumnResized=function(){this.fullWidthRow||this.refreshCells()},s.prototype.refreshCells=function(){if(this.areAllContainersReady())if(this.beans.gridOptionsWrapper.isSuppressAnimationFrame()||this.printLayout)this.refreshCellsInAnimationFrame();else{if(this.columnRefreshPending)return;this.beans.taskQueue.addP1Task(this.refreshCellsInAnimationFrame.bind(this),this.rowNode.rowIndex)}else this.refreshNeeded=!0},s.prototype.refreshCellsInAnimationFrame=function(){if(this.active){var e,t,o;this.columnRefreshPending=!1,o=this.printLayout?(e=this.beans.columnController.getAllDisplayedColumns(),t=[],[]):(e=this.beans.columnController.getAllDisplayedCenterVirtualColumnsForRow(this.rowNode),t=this.beans.columnController.getDisplayedLeftColumnsForRow(this.rowNode),this.beans.columnController.getDisplayedRightColumnsForRow(this.rowNode)),this.insertCellsIntoContainer(this.eBodyRow,e),this.insertCellsIntoContainer(this.ePinnedLeftRow,t),this.insertCellsIntoContainer(this.ePinnedRightRow,o);var n=Object.keys(this.cellComps);e.forEach(function(e){return utils_1._.removeFromArray(n,e.getId())}),t.forEach(function(e){return utils_1._.removeFromArray(n,e.getId())}),o.forEach(function(e){return utils_1._.removeFromArray(n,e.getId())});var i=utils_1._.filter(n,this.isCellEligibleToBeRemoved.bind(this));this.removeRenderedCells(i)}},s.prototype.removeRenderedCells=function(e){var o=this;e.forEach(function(e){var t=o.cellComps[e];utils_1._.missing(t)||(t.detach(),t.destroy(),o.cellComps[e]=null)})},s.prototype.isCellEligibleToBeRemoved=function(e){var t=this.beans.columnController.getAllDisplayedColumns(),o=this.cellComps[e];if(!o)return!0;if(this.isCellInWrongRow(o))return!0;var n=o.isEditing(),i=this.beans.focusedCellController.isCellFocused(o.getCellPosition());if(n||i){var s=o.getColumn();return!(0<=t.indexOf(s))}return!0},s.prototype.ensureCellInCorrectContainer=function(e){if(!this.printLayout){var t=e.getGui(),o=e.getColumn().getPinned(),n=this.getContainerForCell(o),i=e.getParentRow();i!==n&&(i&&i.removeChild(t),n.appendChild(t),e.setParentRow(n))}},s.prototype.isCellInWrongRow=function(e){var t=e.getColumn(),o=this.getContainerForCell(t.getPinned());return e.getParentRow()!==o},s.prototype.insertCellsIntoContainer=function(n,e){var i=this;if(n){var s=[],r=[];e.forEach(function(e){var t=e.getId(),o=i.cellComps[t];o?i.ensureCellInCorrectContainer(o):i.createNewCell(e,n,s,r)}),0<s.length&&(utils_1._.appendHtml(n,s.join("")),this.callAfterRowAttachedOnCells(r,n))}},s.prototype.addDomData=function(e){var t=this.beans.gridOptionsWrapper;t.setDomData(e,s.DOM_DATA_KEY_RENDERED_ROW,this),this.addDestroyFunc(function(){t.setDomData(e,s.DOM_DATA_KEY_RENDERED_ROW,null)})},s.prototype.createNewCell=function(e,t,o,n){var i=new cellComp_1.CellComp(this.scope,this.beans,e,this.rowNode,this,!1,this.printLayout),s=i.getCreateTemplate();o.push(s),n.push(i),(this.cellComps[e.getId()]=i).setParentRow(t)},s.prototype.onMouseEvent=function(e,t){switch(e){case"dblclick":this.onRowDblClick(t);break;case"click":this.onRowClick(t)}},s.prototype.createRowEvent=function(e,t){return{type:e,node:this.rowNode,data:this.rowNode.data,rowIndex:this.rowNode.rowIndex,rowPinned:this.rowNode.rowPinned,context:this.beans.gridOptionsWrapper.getContext(),api:this.beans.gridOptionsWrapper.getApi(),columnApi:this.beans.gridOptionsWrapper.getColumnApi(),event:t}},s.prototype.createRowEventWithSource=function(e,t){var o=this.createRowEvent(e,t);return o.source=this,o},s.prototype.onRowDblClick=function(e){if(!utils_1._.isStopPropagationForAgGrid(e)){var t=this.createRowEventWithSource(events_1.Events.EVENT_ROW_DOUBLE_CLICKED,e);this.beans.eventService.dispatchEvent(t)}},s.prototype.onRowClick=function(e){if(!utils_1._.isStopPropagationForAgGrid(e)){var t=this.createRowEventWithSource(events_1.Events.EVENT_ROW_CLICKED,e);this.beans.eventService.dispatchEvent(t);var o=e.ctrlKey||e.metaKey,n=e.shiftKey;if(!this.rowNode.group&&this.rowNode.selectable&&!this.rowNode.rowPinned&&this.beans.gridOptionsWrapper.isRowSelection()&&!this.beans.gridOptionsWrapper.isSuppressRowClickSelection()){var i=this.beans.gridOptionsWrapper.isRowMultiSelectWithClick(),s=this.beans.gridOptionsWrapper.isRowDeselection();if(this.rowNode.isSelected())i?this.rowNode.setSelectedParams({newValue:!1}):o?s&&this.rowNode.setSelectedParams({newValue:!1}):this.rowNode.setSelectedParams({newValue:!0,clearSelection:!0});else{var r=!i&&!o;this.rowNode.setSelectedParams({newValue:!0,clearSelection:r,rangeSelect:n})}}}},s.prototype.createFullWidthRowContainer=function(s,r,e,a,l,d,h){var p=this,t=this.createTemplate("",e);s.appendRowTemplate(t,function(){function e(e){if(p.isAlive()){var t=e.getGui();o.appendChild(t),h(e)}else e.destroy&&e.destroy()}var o=s.getRowElement(p.getCompId()),t=p.createFullWidthParams(o,r),n=p.beans.detailRowCompCache.get(p.rowNode,r);if(n)e(n);else{var i=p.beans.userComponentFactory.newFullWidthCellRenderer(t,a,l);if(!i)return void console.error("ag-Grid: fullWidthCellRenderer not defined");i.then(e)}p.afterRowAttached(s,o),d(o),p.angular1Compile(o)})},s.prototype.angular1Compile=function(e){this.scope&&this.beans.$compile(e)(this.scope)},s.prototype.createFullWidthParams=function(e,t){return{fullWidth:!0,data:this.rowNode.data,node:this.rowNode,value:this.rowNode.key,$scope:this.scope?this.scope:this.parentScope,$compile:this.beans.$compile,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsWrapper.getApi(),columnApi:this.beans.gridOptionsWrapper.getColumnApi(),context:this.beans.gridOptionsWrapper.getContext(),eGridCell:e,eParentOfValue:e,pinned:t,addRenderedRowListener:this.addEventListener.bind(this)}},s.prototype.getInitialRowClasses=function(e){var t=[],o=this.beans.gridOptionsWrapper.isTreeData(),n=this.rowNode;return utils_1._.exists(e)&&t.push(e),t.push("ag-row"),t.push(this.rowFocused?"ag-row-focus":"ag-row-no-focus"),this.fadeRowIn&&t.push("ag-opacity-zero"),t.push(this.rowIsEven?"ag-row-even":"ag-row-odd"),n.isSelected()&&t.push("ag-row-selected"),n.group?(t.push("ag-row-group"),t.push("ag-row-level-"+n.level),n.footer&&t.push("ag-row-footer")):t.push("ag-row-level-"+(n.parent?n.parent.level+1:"0")),n.stub&&t.push("ag-row-stub"),this.fullWidthRow&&t.push("ag-full-width-row"),(o?n.allChildrenCount:n.group&&!n.footer)&&t.push(n.expanded?"ag-row-group-expanded":"ag-row-group-contracted"),n.dragging&&t.push("ag-row-dragging"),utils_1._.pushAll(t,this.processClassesFromGridOptions()),utils_1._.pushAll(t,this.preProcessRowClassRules()),t.push(this.printLayout?"ag-row-position-relative":"ag-row-position-absolute"),this.firstRowOnPage=this.isFirstRowOnPage(),this.lastRowOnPage=this.isLastRowOnPage(),this.firstRowOnPage&&t.push("ag-row-first"),this.lastRowOnPage&&t.push("ag-row-last"),t},s.prototype.isFirstRowOnPage=function(){return this.rowNode.rowIndex===this.beans.paginationProxy.getPageFirstRow()},s.prototype.isLastRowOnPage=function(){return this.rowNode.rowIndex===this.beans.paginationProxy.getPageLastRow()},s.prototype.onModelUpdated=function(){var t=this.isFirstRowOnPage(),o=this.isLastRowOnPage();this.firstRowOnPage!==t&&(this.firstRowOnPage=t,this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-first",t)})),this.lastRowOnPage!==o&&(this.lastRowOnPage=o,this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-last",o)}))},s.prototype.preProcessRowClassRules=function(){var t=[];return this.processRowClassRules(function(e){t.push(e)},function(e){}),t},s.prototype.processRowClassRules=function(e,t){this.beans.stylingService.processClassRules(this.beans.gridOptionsWrapper.rowClassRules(),{value:void 0,colDef:void 0,data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsWrapper.getApi(),columnApi:this.beans.gridOptionsWrapper.getColumnApi(),$scope:this.scope,context:this.beans.gridOptionsWrapper.getContext()},e,t)},s.prototype.stopEditing=function(t){if(void 0===t&&(t=!1),this.forEachCellComp(function(e){e.stopEditing(t)}),this.editingRow){if(!t){var e=this.createRowEvent(events_1.Events.EVENT_ROW_VALUE_CHANGED);this.beans.eventService.dispatchEvent(e)}this.setEditingRow(!1)}},s.prototype.setEditingRow=function(t){this.editingRow=t,this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-editing",t)});var e=t?this.createRowEvent(events_1.Events.EVENT_ROW_EDITING_STARTED):this.createRowEvent(events_1.Events.EVENT_ROW_EDITING_STOPPED);this.beans.eventService.dispatchEvent(e)},s.prototype.startRowEditing=function(o,n,i){void 0===o&&(o=null),void 0===n&&(n=null),void 0===i&&(i=null),this.editingRow||(this.forEachCellComp(function(e){var t=e===i;t?e.startEditingIfEnabled(o,n,t):e.startEditingIfEnabled(null,null,t)}),this.setEditingRow(!0))},s.prototype.forEachCellComp=function(o){utils_1._.iterateObject(this.cellComps,function(e,t){t&&o(t)})},s.prototype.postProcessClassesFromGridOptions=function(){var e=this,t=this.processClassesFromGridOptions();t&&t.length&&t.forEach(function(t){e.eAllRowContainers.forEach(function(e){return utils_1._.addCssClass(e,t)})})},s.prototype.postProcessRowClassRules=function(){var e=this;this.processRowClassRules(function(t){e.eAllRowContainers.forEach(function(e){return utils_1._.addCssClass(e,t)})},function(t){e.eAllRowContainers.forEach(function(e){return utils_1._.removeCssClass(e,t)})})},s.prototype.processClassesFromGridOptions=function(){function e(e){"string"==typeof e?t.push(e):Array.isArray(e)&&e.forEach(function(e){return t.push(e)})}var t=[],o=this.beans.gridOptionsWrapper.getRowClass();if(o){if("function"==typeof o)return void console.warn("ag-Grid: rowClass should not be a function, please use getRowClass instead");e(o)}var n=this.beans.gridOptionsWrapper.getRowClassFunc();n&&e(n({node:this.rowNode,data:this.rowNode.data,rowIndex:this.rowNode.rowIndex,context:this.beans.gridOptionsWrapper.getContext(),api:this.beans.gridOptionsWrapper.getApi()}));return t},s.prototype.preProcessStylesFromGridOptions=function(){var e=this.processStylesFromGridOptions();return utils_1._.cssStyleObjectToMarkup(e)},s.prototype.postProcessStylesFromGridOptions=function(){var t=this.processStylesFromGridOptions();this.eAllRowContainers.forEach(function(e){return utils_1._.addStylesToElement(e,t)})},s.prototype.processStylesFromGridOptions=function(){var e=this.beans.gridOptionsWrapper.getRowStyle();if(!e||"function"!=typeof e){var t,o=this.beans.gridOptionsWrapper.getRowStyleFunc();if(o)t=o({data:this.rowNode.data,node:this.rowNode,api:this.beans.gridOptionsWrapper.getApi(),context:this.beans.gridOptionsWrapper.getContext(),$scope:this.scope});return utils_1._.assign({},e,t)}console.warn("ag-Grid: rowStyle should be an object of key/value styles, not be a function, use getRowStyle() instead")},s.prototype.createCells=function(e){var n=this,i=[],s=[];return e.forEach(function(e){var t=new cellComp_1.CellComp(n.scope,n.beans,e,n.rowNode,n,!1,n.printLayout),o=t.getCreateTemplate();i.push(o),s.push(t),n.cellComps[e.getId()]=t}),{template:i.join(""),cellComps:s}},s.prototype.onRowSelected=function(){var t=this.rowNode.isSelected();this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-selected",t)})},s.prototype.callAfterRowAttachedOnCells=function(e,t){var o=this;e.forEach(function(e){e.setParentRow(t),e.afterAttached(),o.editingRow&&e.startEditingIfEnabled()})},s.prototype.afterRowAttached=function(e,t){var o=this;this.addDomData(t),this.removeSecondPassFuncs.push(function(){e.removeRowElement(t)}),this.removeFirstPassFuncs.push(function(){if(utils_1._.exists(o.rowNode.rowTop)){var e=o.roundRowTopToBounds(o.rowNode.rowTop);o.setRowTop(e)}else utils_1._.addCssClass(t,"ag-opacity-zero")}),this.eAllRowContainers.push(t),this.useAnimationFrameForCreate?this.beans.taskQueue.addP2Task(this.addHoverFunctionality.bind(this,t)):this.addHoverFunctionality(t)},s.prototype.addHoverFunctionality=function(e){var t=this;this.active&&(this.addDestroyableEventListener(e,"mouseenter",function(){return t.rowNode.onMouseEnter()}),this.addDestroyableEventListener(e,"mouseleave",function(){return t.rowNode.onMouseLeave()}),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_MOUSE_ENTER,function(){t.beans.gridOptionsWrapper.isSuppressRowHoverHighlight()||utils_1._.addCssClass(e,"ag-row-hover")}),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_MOUSE_LEAVE,function(){utils_1._.removeCssClass(e,"ag-row-hover")}))},s.prototype.roundRowTopToBounds=function(e){var t=this.beans.gridPanel.getVScrollPosition(),o=this.applyPaginationOffset(t.top,!0)-100,n=this.applyPaginationOffset(t.bottom,!0)+100;return Math.min(Math.max(o,e),n)},s.prototype.getFrameworkOverrides=function(){return this.beans.frameworkOverrides},s.prototype.onRowHeightChanged=function(){if(utils_1._.exists(this.rowNode.rowHeight)){var t=this.rowNode.rowHeight+"px";this.eAllRowContainers.forEach(function(e){return e.style.height=t})}},s.prototype.addEventListener=function(e,t){"renderedRowRemoved"!==e&&"rowRemoved"!==e||(e=events_1.Events.EVENT_VIRTUAL_ROW_REMOVED,console.warn("ag-Grid: Since version 11, event renderedRowRemoved is now called "+events_1.Events.EVENT_VIRTUAL_ROW_REMOVED)),u.prototype.addEventListener.call(this,e,t)},s.prototype.removeEventListener=function(e,t){"renderedRowRemoved"!==e&&"rowRemoved"!==e||(e=events_1.Events.EVENT_VIRTUAL_ROW_REMOVED,console.warn("ag-Grid: Since version 11, event renderedRowRemoved and rowRemoved is now called "+events_1.Events.EVENT_VIRTUAL_ROW_REMOVED)),u.prototype.removeEventListener.call(this,e,t)},s.prototype.destroy=function(e){(void 0===e&&(e=!1),u.prototype.destroy.call(this),this.active=!1,this.destroyFullWidthComponents(),e)?(this.removeFirstPassFuncs.forEach(function(e){return e()}),this.removeSecondPassFuncs.push(this.destroyContainingCells.bind(this))):(this.destroyContainingCells(),this.getAndClearDelayedDestroyFunctions().forEach(function(e){return e()}));var t=this.createRowEvent(events_1.Events.EVENT_VIRTUAL_ROW_REMOVED);this.dispatchEvent(t),this.beans.eventService.dispatchEvent(t)},s.prototype.destroyContainingCells=function(){this.forEachCellComp(function(e){return e.destroy()}),this.destroyFullWidthComponents()},s.prototype.getAndClearDelayedDestroyFunctions=function(){var e=this.removeSecondPassFuncs;return this.removeSecondPassFuncs=[],e},s.prototype.onCellFocusChanged=function(){var t=this.beans.focusedCellController.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned);t!==this.rowFocused&&(this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-focus",t)}),this.eAllRowContainers.forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-row-no-focus",!t)}),this.rowFocused=t),!t&&this.editingRow&&this.stopEditing(!1)},s.prototype.onPaginationChanged=function(){var e=this.beans.paginationProxy.getCurrentPage();this.paginationPage!==e&&(this.paginationPage=e,this.onTopChanged())},s.prototype.onTopChanged=function(){this.setRowTop(this.rowNode.rowTop)},s.prototype.applyPaginationOffset=function(e,t){return void 0===t&&(t=!1),this.rowNode.isRowPinned()?e:e+this.beans.paginationProxy.getPixelOffset()*(t?1:-1)},s.prototype.setRowTop=function(e){if(!this.printLayout&&utils_1._.exists(e)){var t=this.applyPaginationOffset(e),o=this.beans.maxDivHeightScaler.getRealPixelPosition(t)+"px";this.beans.gridOptionsWrapper.isSuppressRowTransform()?this.eAllRowContainers.forEach(function(e){return e.style.top=o}):this.eAllRowContainers.forEach(function(e){return e.style.transform="translateY("+o+")"})}},s.prototype.getAndClearNextVMTurnFunctions=function(){var e=this.createSecondPassFuncs;return this.createSecondPassFuncs=[],e},s.prototype.getRowNode=function(){return this.rowNode},s.prototype.getRenderedCellForColumn=function(t){var o=this,e=this.cellComps[t.getColId()];if(e)return e;var n=Object.keys(this.cellComps).map(function(e){return o.cellComps[e]}).filter(function(e){return e&&-1!==e.getColSpanningList().indexOf(t)});return n.length?n[0]:void 0},s.prototype.onRowIndexChanged=function(){this.onCellFocusChanged(),this.updateRowIndexes()},s.prototype.updateRowIndexes=function(){var t=this,o=this.rowNode.getRowIndexString(),n=this.rowNode.rowIndex%2==0,i=this.rowIsEven!==n,s=this.beans.gridPanel.headerRootComp.getHeaderRowCount();i&&(this.rowIsEven=n),this.eAllRowContainers.forEach(function(e){e.setAttribute("row-index",o),e.setAttribute("aria-rowindex",(s+t.rowNode.rowIndex+1).toString()),i&&(utils_1._.addOrRemoveCssClass(e,"ag-row-even",n),utils_1._.addOrRemoveCssClass(e,"ag-row-odd",!n))})},s.prototype.ensureDomOrder=function(){[{el:this.getBodyRowElement(),ct:this.bodyContainerComp},{el:this.getPinnedLeftRowElement(),ct:this.pinnedLeftContainerComp},{el:this.getPinnedRightRowElement(),ct:this.pinnedRightContainerComp},{el:this.getFullWidthRowElement(),ct:this.fullWidthContainerComp}].forEach(function(e){e.el&&e.ct.ensureDomOrder(e.el)})},s.prototype.getPinnedLeftRowElement=function(){return this.ePinnedLeftRow?this.ePinnedLeftRow:this.eFullWidthRowLeft},s.prototype.getPinnedRightRowElement=function(){return this.ePinnedRightRow?this.ePinnedRightRow:this.eFullWidthRowRight},s.prototype.getBodyRowElement=function(){return this.eBodyRow?this.eBodyRow:this.eFullWidthRowBody},s.prototype.getFullWidthRowElement=function(){return this.eFullWidthRow},s.DOM_DATA_KEY_RENDERED_ROW="renderedRow",s.FULL_WIDTH_CELL_RENDERER="fullWidthCellRenderer",s.GROUP_ROW_RENDERER="groupRowRenderer",s.GROUP_ROW_RENDERER_COMP_NAME="agGroupRowRenderer",s.LOADING_CELL_RENDERER="loadingCellRenderer",s.LOADING_CELL_RENDERER_COMP_NAME="agLoadingCellRenderer",s.DETAIL_CELL_RENDERER="detailCellRenderer",s.DETAIL_CELL_RENDERER_COMP_NAME="agDetailCellRenderer",s}(component_1.Component);exports.RowComp=RowComp;