"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__decorate=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(i=(s<3?n(i):3<s?n(t,o,i):n(t,o))||i);return 3<s&&i&&Object.defineProperty(t,o,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../../widgets/component"),column_1=require("../../entities/column"),context_1=require("../../context/context"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),sortController_1=require("../../sortController"),touchListener_1=require("../../widgets/touchListener"),eventService_1=require("../../eventService"),componentAnnotations_1=require("../../widgets/componentAnnotations"),events_1=require("../../events"),utils_1=require("../../utils"),HeaderComp=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastMovingChanged=0,e}return __extends(o,t),o.prototype.init=function(e){var t=utils_1._.firstExistingValue(e.template,o.TEMPLATE);t=t&&t.trim?t.trim():t,this.setTemplate(t),this.params=e,this.setupTap(),this.setupIcons(e.column),this.setupMenu(),this.setupSort(),this.setupFilterIcon(),this.setupText(e.displayName)},o.prototype.setupText=function(e){var t=utils_1._.escape(e);this.eText&&(this.eText.innerHTML=t)},o.prototype.setupIcons=function(e){this.addInIcon("sortAscending",this.eSortAsc,e),this.addInIcon("sortDescending",this.eSortDesc,e),this.addInIcon("sortUnSort",this.eSortNone,e),this.addInIcon("menu",this.eMenu,e),this.addInIcon("filter",this.eFilter,e)},o.prototype.addInIcon=function(e,t,o){if(null!=t){var r=utils_1._.createIconNoSpan(e,this.gridOptionsWrapper,o);t.appendChild(r)}},o.prototype.setupTap=function(){var o=this,t=this.gridOptionsWrapper;if(!t.isSuppressTouch()){var e=new touchListener_1.TouchListener(this.getGui(),!0),r=t.isSuppressMenuHide(),n=r&&utils_1._.exists(this.eMenu),s=n?new touchListener_1.TouchListener(this.eMenu,!0):e;if(this.params.enableMenu){var i=n?"EVENT_TAP":"EVENT_LONG_TAP";this.addDestroyableEventListener(s,touchListener_1.TouchListener[i],function(e){t.getApi().showColumnMenuAfterMouseClick(o.params.column,e.touchStart)})}if(this.params.enableSorting){this.addDestroyableEventListener(e,touchListener_1.TouchListener.EVENT_TAP,function(e){var t=e.touchStart.target;r&&o.eMenu.contains(t)||o.sortController.progressSort(o.params.column,!1,"uiColumnSorted")})}this.addDestroyFunc(function(){return e.destroy()}),n&&this.addDestroyFunc(function(){return s.destroy()})}},o.prototype.setupMenu=function(){var e=this;if(this.eMenu){var t=this.gridOptionsWrapper.isSuppressMenuHide();if(!this.params.enableMenu||utils_1._.isUserAgentIPad()&&!t)utils_1._.removeFromParent(this.eMenu);else{this.addDestroyableEventListener(this.eMenu,"click",function(){return e.showMenu(e.eMenu)}),t||(this.eMenu.style.opacity="0",this.addGuiEventListener("mouseover",function(){e.eMenu.style.opacity="1"}),this.addGuiEventListener("mouseout",function(){e.eMenu.style.opacity="0"}));var o=this.eMenu.style;o.transition="opacity 0.2s, border 0.2s",o["-webkit-transition"]="opacity 0.2s, border 0.2s"}}},o.prototype.showMenu=function(e){this.menuFactory.showMenuAfterButtonClick(this.params.column,e)},o.prototype.removeSortIcons=function(){utils_1._.removeFromParent(this.eSortAsc),utils_1._.removeFromParent(this.eSortDesc),utils_1._.removeFromParent(this.eSortNone),utils_1._.removeFromParent(this.eSortOrder)},o.prototype.setupSort=function(){var n=this;if(this.params.enableSorting){var s=this.gridOptionsWrapper.isMultiSortKeyCtrl();this.addDestroyableEventListener(this.params.column,column_1.Column.EVENT_MOVING_CHANGED,function(){n.lastMovingChanged=(new Date).getTime()}),this.eLabel&&this.addDestroyableEventListener(this.eLabel,"click",function(e){var t=n.params.column.isMoving(),o=(new Date).getTime()-n.lastMovingChanged<50;if(!(t||o)){var r=s?e.ctrlKey||e.metaKey:e.shiftKey;n.params.progressSort(r)}}),this.addDestroyableEventListener(this.params.column,column_1.Column.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.onSortChanged(),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_SORT_CHANGED,this.setMultiSortOrder.bind(this)),this.setMultiSortOrder()}else this.removeSortIcons()},o.prototype.onSortChanged=function(){if(utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-sorted-asc",this.params.column.isSortAscending()),utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-sorted-desc",this.params.column.isSortDescending()),utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-sorted-none",this.params.column.isSortNone()),this.eSortAsc&&utils_1._.addOrRemoveCssClass(this.eSortAsc,"ag-hidden",!this.params.column.isSortAscending()),this.eSortDesc&&utils_1._.addOrRemoveCssClass(this.eSortDesc,"ag-hidden",!this.params.column.isSortDescending()),this.eSortNone){var e=!this.params.column.getColDef().unSortIcon&&!this.gridOptionsWrapper.isUnSortIcon();utils_1._.addOrRemoveCssClass(this.eSortNone,"ag-hidden",e||!this.params.column.isSortNone())}},o.prototype.setMultiSortOrder=function(){if(this.eSortOrder){var e=this.params.column,t=this.sortController.getColumnsWithSortingOrdered(),o=t.indexOf(e),r=1<t.length,n=e.isSorting()&&r;utils_1._.setDisplayed(this.eSortOrder,n),0<=o?this.eSortOrder.innerHTML=(o+1).toString():utils_1._.clearElement(this.eSortOrder)}},o.prototype.setupFilterIcon=function(){this.eFilter&&(this.addDestroyableEventListener(this.params.column,column_1.Column.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.onFilterChanged())},o.prototype.onFilterChanged=function(){var e=this.params.column.isFilterActive();utils_1._.addOrRemoveCssClass(this.eFilter,"ag-hidden",!e)},o.TEMPLATE='<div class="ag-cell-label-container" role="presentation">  <span ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>  <div ref="eLabel" class="ag-header-cell-label" role="presentation" unselectable="on">    <span ref="eText" class="ag-header-cell-text" role="columnheader" unselectable="on"></span>    <span ref="eFilter" class="ag-header-icon ag-filter-icon" aria-hidden="true"></span>    <span ref="eSortOrder" class="ag-header-icon ag-sort-order" aria-hidden="true"></span>    <span ref="eSortAsc" class="ag-header-icon ag-sort-ascending-icon" aria-hidden="true"></span>    <span ref="eSortDesc" class="ag-header-icon ag-sort-descending-icon" aria-hidden="true"></span>    <span ref="eSortNone" class="ag-header-icon ag-sort-none-icon" aria-hidden="true"></span>  </div></div>',__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],o.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("sortController"),__metadata("design:type",sortController_1.SortController)],o.prototype,"sortController",void 0),__decorate([context_1.Autowired("menuFactory"),__metadata("design:type",Object)],o.prototype,"menuFactory",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],o.prototype,"eventService",void 0),__decorate([componentAnnotations_1.RefSelector("eFilter"),__metadata("design:type",HTMLElement)],o.prototype,"eFilter",void 0),__decorate([componentAnnotations_1.RefSelector("eSortAsc"),__metadata("design:type",HTMLElement)],o.prototype,"eSortAsc",void 0),__decorate([componentAnnotations_1.RefSelector("eSortDesc"),__metadata("design:type",HTMLElement)],o.prototype,"eSortDesc",void 0),__decorate([componentAnnotations_1.RefSelector("eSortNone"),__metadata("design:type",HTMLElement)],o.prototype,"eSortNone",void 0),__decorate([componentAnnotations_1.RefSelector("eSortOrder"),__metadata("design:type",HTMLElement)],o.prototype,"eSortOrder",void 0),__decorate([componentAnnotations_1.RefSelector("eMenu"),__metadata("design:type",HTMLElement)],o.prototype,"eMenu",void 0),__decorate([componentAnnotations_1.RefSelector("eLabel"),__metadata("design:type",HTMLElement)],o.prototype,"eLabel",void 0),__decorate([componentAnnotations_1.RefSelector("eText"),__metadata("design:type",HTMLElement)],o.prototype,"eText",void 0),o}(component_1.Component);exports.HeaderComp=HeaderComp;