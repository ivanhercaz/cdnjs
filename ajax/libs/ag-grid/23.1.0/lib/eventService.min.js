"use strict";var __decorate=this&&this.__decorate||function(t,e,i,n){var s,r=arguments.length,o=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var c=t.length-1;0<=c;c--)(s=t[c])&&(o=(r<3?s(o):3<r?s(e,i,o):s(e,i))||o);return 3<r&&o&&Object.defineProperty(e,i,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__param=this&&this.__param||function(i,n){return function(t,e){n(t,e,i)}};Object.defineProperty(exports,"__esModule",{value:!0});var logger_1=require("./logger"),context_1=require("./context/context"),context_2=require("./context/context"),gridOptionsWrapper_1=require("./gridOptionsWrapper"),utils_1=require("./utils"),EventService=function(){function t(){this.allSyncListeners={},this.allAsyncListeners={},this.globalSyncListeners=[],this.globalAsyncListeners=[],this.asyncFunctionsQueue=[],this.scheduled=!1,this.firedEvents={}}var c;return(c=t).prototype.setBeans=function(t,e,i){if(void 0===i&&(i=null),this.logger=t.create("EventService"),i){var n=e.useAsyncEvents();this.addGlobalListener(i,n)}},t.prototype.getListenerList=function(t,e){var i=e?this.allAsyncListeners:this.allSyncListeners,n=i[t];return n||(n=[],i[t]=n),n},t.prototype.addEventListener=function(t,e,i){void 0===i&&(i=!1);var n=this.getListenerList(t,i);n.indexOf(e)<0&&n.push(e)},t.prototype.addModalPriorityEventListener=function(t,e,i){void 0===i&&(i=!1),this.addEventListener(t+c.PRIORITY,e,i)},t.prototype.addGlobalListener=function(t,e){void 0===e&&(e=!1),e?this.globalAsyncListeners.push(t):this.globalSyncListeners.push(t)},t.prototype.removeEventListener=function(t,e,i){void 0===i&&(i=!1);var n=this.getListenerList(t,i);utils_1._.removeFromArray(n,e)},t.prototype.removeGlobalListener=function(t,e){void 0===e&&(e=!1),e?utils_1._.removeFromArray(this.globalAsyncListeners,t):utils_1._.removeFromArray(this.globalSyncListeners,t)},t.prototype.dispatchEvent=function(t){this.dispatchToListeners(t,!0),this.dispatchToListeners(t,!1),this.firedEvents[t.type]=!0},t.prototype.dispatchEventOnce=function(t){this.firedEvents[t.type]||this.dispatchEvent(t)},t.prototype.dispatchToListeners=function(e,i){var n=this,t=i?this.globalAsyncListeners:this.globalSyncListeners,s=e.type,r=this.getListenerList(s+c.PRIORITY,i);utils_1._.forEachSnapshotFirst(r,function(t){i?n.dispatchAsync(function(){return t(e)}):t(e)});var o=this.getListenerList(s,i);utils_1._.forEachSnapshotFirst(o,function(t){i?n.dispatchAsync(function(){return t(e)}):t(e)}),utils_1._.forEachSnapshotFirst(t,function(t){i?n.dispatchAsync(function(){return t(s,e)}):t(s,e)})},t.prototype.dispatchAsync=function(t){this.asyncFunctionsQueue.push(t),this.scheduled||(window.setTimeout(this.flushAsyncQueue.bind(this),0),this.scheduled=!0)},t.prototype.flushAsyncQueue=function(){this.scheduled=!1;var t=this.asyncFunctionsQueue.slice();this.asyncFunctionsQueue=[],t.forEach(function(t){return t()})},t.PRIORITY="-P1",__decorate([__param(0,context_2.Qualifier("loggerFactory")),__param(1,context_2.Qualifier("gridOptionsWrapper")),__param(2,context_2.Qualifier("globalEventListener")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory,gridOptionsWrapper_1.GridOptionsWrapper,Function]),__metadata("design:returntype",void 0)],t.prototype,"setBeans",null),t=c=__decorate([context_1.Bean("eventService")],t)}();exports.EventService=EventService;