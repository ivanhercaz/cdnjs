"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate=this&&this.__decorate||function(t,e,r,o){var i,n=arguments.length,s=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var a=t.length-1;0<=a;a--)(i=t[a])&&(s=(n<3?i(s):3<n?i(e,r,s):i(e,r))||s);return 3<n&&s&&Object.defineProperty(e,r,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("./component"),utils_1=require("../utils"),componentAnnotations_1=require("./componentAnnotations"),context_1=require("../context/context"),AgColorPanel=function(r){function o(t){var e=r.call(this,o.TEMPLATE)||this;return e.H=1,e.S=1,e.B=1,e.A=1,e.isSpectrumDragging=!1,e.isSpectrumHueDragging=!1,e.isSpectrumAlphaDragging=!1,e.colorChanged=!1,e.picker=t.picker,e}return __extends(o,r),o.prototype.postConstruct=function(){var t=this.getGui();this.initRecentColors(),this.addDestroyableEventListener(this.spectrumVal,"mousedown",this.onSpectrumDraggerDown.bind(this)),this.addDestroyableEventListener(t,"mousemove",this.onSpectrumDraggerMove.bind(this)),this.addDestroyableEventListener(this.spectrumHue,"mousedown",this.onSpectrumHueDown.bind(this)),this.addDestroyableEventListener(t,"mousemove",this.onSpectrumHueMove.bind(this)),this.addDestroyableEventListener(this.spectrumAlpha,"mousedown",this.onSpectrumAlphaDown.bind(this)),this.addDestroyableEventListener(t,"mousemove",this.onSpectrumAlphaMove.bind(this)),this.addDestroyableEventListener(document,"mouseup",this.onMouseUp.bind(this)),this.addDestroyableEventListener(this.recentColors,"click",this.onRecentColorClick.bind(this))},o.prototype.refreshSpectrumRect=function(){return this.spectrumValRect=this.spectrumVal.getBoundingClientRect()},o.prototype.refreshHueRect=function(){return this.spectrumHueRect=this.spectrumHue.getBoundingClientRect()},o.prototype.refreshAlphaRect=function(){return this.spectrumAlphaRect=this.spectrumAlpha.getBoundingClientRect()},o.prototype.onSpectrumDraggerDown=function(t){this.refreshSpectrumRect(),this.isSpectrumDragging=!0,this.moveDragger(t)},o.prototype.onSpectrumDraggerMove=function(t){this.isSpectrumDragging&&this.moveDragger(t)},o.prototype.onSpectrumHueDown=function(t){this.refreshHueRect(),this.isSpectrumHueDragging=!0,this.moveHueSlider(t)},o.prototype.onSpectrumHueMove=function(t){this.isSpectrumHueDragging&&this.moveHueSlider(t)},o.prototype.onSpectrumAlphaDown=function(t){this.refreshAlphaRect(),this.isSpectrumAlphaDragging=!0,this.moveAlphaSlider(t)},o.prototype.onSpectrumAlphaMove=function(t){this.isSpectrumAlphaDragging&&this.moveAlphaSlider(t)},o.prototype.onMouseUp=function(){this.isSpectrumDragging=!1,this.isSpectrumHueDragging=!1,this.isSpectrumAlphaDragging=!1},o.prototype.moveDragger=function(t){var e=this.spectrumValRect;if(e){var r=t.clientX-e.left,o=t.clientY-e.top;r=Math.max(r,0),r=Math.min(r,e.width),o=Math.max(o,0),o=Math.min(o,e.height),this.setSpectrumValue(r/e.width,1-o/e.height)}},o.prototype.moveHueSlider=function(t){var e=this.spectrumHueRect;if(e){var r=this.spectrumHueSlider,o=r.getBoundingClientRect(),i=t.clientX-e.left;i=Math.max(i,0),i=Math.min(i,e.width),this.H=1-i/e.width,r.style.left=i+o.width/2+"px",this.update()}},o.prototype.moveAlphaSlider=function(t){var e=this.spectrumAlphaRect;if(e){var r=this.spectrumAlphaSlider,o=r.getBoundingClientRect(),i=t.clientX-e.left;i=Math.max(i,0),i=Math.min(i,e.width),this.A=i/e.width,r.style.left=i+o.width/2+"px",this.update()}},o.prototype.update=function(){var t=utils_1.Color.fromHSB(360*this.H,this.S,this.B,this.A),e=utils_1.Color.fromHSB(360*this.H,1,1),r=t.toRgbaString(),o=this.picker;utils_1.Color.fromString(o.getValue()).toRgbaString()!==r&&(this.colorChanged=!0),o.setValue(r),this.spectrumColor.style.backgroundColor=e.toRgbaString(),this.spectrumDragger.style.backgroundColor=r},o.prototype.setSpectrumValue=function(t,e){var r=this.spectrumValRect||this.refreshSpectrumRect();if(r){var o=this.spectrumDragger,i=o.getBoundingClientRect();t=Math.max(0,t),t=Math.min(1,t),e=Math.max(0,e),e=Math.min(1,e),this.S=t,this.B=e,o.style.left=t*r.width-i.width/2+"px",o.style.top=(1-e)*r.height-i.height/2+"px",this.update()}},o.prototype.initRecentColors=function(){var t=o.recentColors.map(function(t,e){return'<div class="ag-recent-color" id='+e+' style="background-color: '+t+'; width: 15px; height: 15px;" recent-color="'+t+'"></div>'});this.recentColors.innerHTML=t.join("")},o.prototype.setValue=function(t){var e=utils_1.Color.fromString(t),r=e.toHSB(),o=r[0],i=r[1],n=r[2];this.H=(isNaN(o)?0:o)/360,this.A=e.a;var s=this.spectrumHueRect||this.refreshHueRect(),a=this.spectrumAlphaRect||this.refreshAlphaRect();this.spectrumHueSlider.style.left=(this.H-1)*-s.width+"px",this.spectrumAlphaSlider.style.left=this.A*a.width+"px",this.setSpectrumValue(i,n)},o.prototype.onRecentColorClick=function(t){var e=t.target;if(utils_1._.exists(e.id)){var r=parseInt(e.id,10);this.setValue(o.recentColors[r]),this.destroy()}},o.prototype.addRecentColor=function(){var e=utils_1.Color.fromHSB(360*this.H,this.S,this.B,this.A).toRgbaString(),t=o.recentColors;this.colorChanged&&t[0]!==e&&(t=t.filter(function(t){return t!=e}),(t=[e].concat(t)).length>o.maxRecentColors&&(t=t.slice(0,o.maxRecentColors)),o.recentColors=t)},o.prototype.destroy=function(){r.prototype.destroy.call(this),this.addRecentColor()},o.maxRecentColors=8,o.recentColors=[],o.TEMPLATE='<div class="ag-color-panel">\n            <div ref="spectrumColor" class="ag-spectrum-color">\n                <div class="ag-spectrum-sat ag-fill">\n                    <div ref="spectrumVal" class="ag-spectrum-val ag-fill">\n                        <div ref="spectrumDragger" class="ag-spectrum-dragger"></div>\n                    </div>\n                </div>\n            </div>\n            <div class="ag-spectrum-tools">\n                <div ref="spectrumHue" class="ag-spectrum-hue ag-hue-alpha">\n                    <div class="ag-spectrum-hue-background"></div>\n                    <div ref="spectrumHueSlider" class="ag-spectrum-slider"></div>\n                </div>\n                <div ref="spectrumAlpha" class="ag-spectrum-alpha ag-hue-alpha">\n                    <div class="ag-spectrum-alpha-background"></div>\n                    <div ref="spectrumAlphaSlider" class="ag-spectrum-slider"></div>\n                </div>\n                <div ref="recentColors" class="ag-recent-colors"></div>\n            </div>\n        </div>',__decorate([componentAnnotations_1.RefSelector("spectrumColor"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumColor",void 0),__decorate([componentAnnotations_1.RefSelector("spectrumVal"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumVal",void 0),__decorate([componentAnnotations_1.RefSelector("spectrumDragger"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumDragger",void 0),__decorate([componentAnnotations_1.RefSelector("spectrumHue"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumHue",void 0),__decorate([componentAnnotations_1.RefSelector("spectrumHueSlider"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumHueSlider",void 0),__decorate([componentAnnotations_1.RefSelector("spectrumAlpha"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumAlpha",void 0),__decorate([componentAnnotations_1.RefSelector("spectrumAlphaSlider"),__metadata("design:type",HTMLElement)],o.prototype,"spectrumAlphaSlider",void 0),__decorate([componentAnnotations_1.RefSelector("recentColors"),__metadata("design:type",HTMLElement)],o.prototype,"recentColors",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],o.prototype,"postConstruct",null),o}(component_1.Component);exports.AgColorPanel=AgColorPanel;