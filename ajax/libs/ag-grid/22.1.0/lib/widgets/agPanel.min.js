"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var p=t.length-1;0<=p;p--)(n=t[p])&&(r=(s<3?n(r):3<s?n(e,i,r):n(e,i))||r);return 3<s&&r&&Object.defineProperty(e,i,r),r},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var componentAnnotations_1=require("./componentAnnotations"),context_1=require("../context/context"),component_1=require("./component"),popupService_1=require("./popupService"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),utils_1=require("../utils"),AgPanel=function(i){function o(t){var e=i.call(this,o.TEMPLATE)||this;return e.closable=!0,e.positioned=!1,e.dragStartPosition={x:0,y:0},e.position={x:0,y:0},e.size={width:void 0,height:void 0},e.config=t,e}return __extends(o,i),o.prototype.postConstruct=function(){var i=this,t=this.config,e=t.component,o=t.closable,n=t.hideTitleBar,s=t.title,r=t.minWidth,p=t.width,a=t.minHeight,h=t.height,l=t.centered,c=t.x,d=t.y,u=this.getGui();e&&this.setBodyComponent(e),n?utils_1._.addCssClass(this.eTitleBar,"ag-hidden"):(s&&this.setTitle(s),this.setClosable(null!=o?o:this.closable)),this.addDestroyableEventListener(this.eTitleBar,"mousedown",function(t){if(u.contains(t.relatedTarget)||u.contains(document.activeElement)||i.eTitleBarButtons.contains(t.target))t.preventDefault();else{var e=i.eContentWrapper.querySelector("button, [href], input, select, textarea, [tabindex]");e&&e.focus()}}),this.positioned||(this.minHeight=null!=a?a:250,this.minWidth=null!=r?r:250,this.popupParent=this.popupService.getPopupParent(),p&&this.setWidth(p),h&&this.setHeight(h),this.renderComponent&&this.renderComponent(),p&&h||this.refreshSize(),l?this.center():(c||d)&&this.offsetElement(c,d),this.positioned=!0,this.eContentWrapper.style.height="0")},o.prototype.renderComponent=function(){var t=this,e=this.getGui();e.focus(),this.close=function(){e.parentElement.removeChild(e),t.destroy()}},o.prototype.updateDragStartPosition=function(t,e){this.dragStartPosition={x:t,y:e}},o.prototype.calculateMouseMovement=function(t){var e=this.popupParent.getBoundingClientRect(),i=t.e,o=t.isLeft,n=t.isTop,s=t.anywhereWithin,r=t.topBuffer,p=i.clientX-this.dragStartPosition.x,a=i.clientY-this.dragStartPosition.y,h=this.getWidth(),l=this.getHeight(),c=e.left>=i.clientX&&this.position.x<=0||e.right<=i.clientX&&e.right<=this.position.x+e.left+h;return{movementX:p=(c=c||(o?p<0&&i.clientX>this.position.x+e.left||0<p&&i.clientX<this.position.x+e.left:s?p<0&&i.clientX>this.position.x+e.left+h||0<p&&i.clientX<this.position.x+e.left:p<0&&i.clientX>this.position.x+e.left+h||0<p&&i.clientX<this.position.x+e.left+h))?0:p,movementY:a=e.top>=i.clientY&&this.position.y<=0||e.bottom<=i.clientY&&e.bottom<=this.position.y+e.top+l||n&&(a<0&&i.clientY>this.position.y+e.top+(r||0)||0<a&&i.clientY<this.position.y+e.top)||!n&&(a<0&&i.clientY>this.position.y+e.top+l||0<a&&i.clientY<this.position.y+e.top+l)?0:a}},o.prototype.refreshSize=function(){var t=this.size,e=t.width,i=t.height;e||this.setWidth(this.getGui().offsetWidth),i||this.setHeight(this.getGui().offsetHeight)},o.prototype.offsetElement=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=this.getGui();this.popupService.positionPopup({ePopup:i,x:t,y:e,minWidth:this.minWidth,minHeight:this.minHeight,keepWithinBounds:!0}),this.position.x=parseInt(i.style.left,10),this.position.y=parseInt(i.style.top,10)},o.prototype.getHeight=function(){return this.size.height},o.prototype.setHeight=function(t){var e=this.getGui(),i=!1;if("string"==typeof t&&-1!==t.indexOf("%"))utils_1._.setFixedHeight(e,t),t=utils_1._.getAbsoluteHeight(e),i=!0;else{t=Math.max(this.minHeight,t);var o=e.offsetParent;o&&o.clientHeight&&t+this.position.y>o.clientHeight&&(t=o.clientHeight-this.position.y)}this.size.height!==t&&(this.size.height=t,i?(e.style.maxHeight="unset",e.style.minHeight="unset"):utils_1._.setFixedHeight(e,t))},o.prototype.getWidth=function(){return this.size.width},o.prototype.setWidth=function(t){var e=this.getGui(),i=!1;if("string"==typeof t&&-1!==t.indexOf("%"))utils_1._.setFixedWidth(e,t),t=utils_1._.getAbsoluteWidth(e),i=!0;else{t=Math.max(this.minWidth,t);var o=e.offsetParent;o&&o.clientWidth&&t+this.position.x>o.clientWidth&&(t=o.clientWidth-this.position.x)}this.size.width!==t&&(this.size.width=t,i?(e.style.maxWidth="unset",e.style.minWidth="unset"):utils_1._.setFixedWidth(e,t))},o.prototype.center=function(){var t=this.getGui(),e=t.offsetParent.clientWidth/2-this.getWidth()/2,i=t.offsetParent.clientHeight/2-this.getHeight()/2;this.offsetElement(e,i)},o.prototype.setClosable=function(t){if(t!==this.closable&&(this.closable=t),t){var e=this.closeButtonComp=new component_1.Component(o.CLOSE_BTN_TEMPLATE);this.getContext().wireBean(e),(i=e.getGui()).appendChild(utils_1._.createIconNoSpan("close",this.gridOptionsWrapper)),this.addTitleBarButton(e),e.addDestroyableEventListener(i,"click",this.onBtClose.bind(this))}else if(this.closeButtonComp){var i;(i=this.closeButtonComp.getGui()).parentElement.removeChild(i),this.closeButtonComp.destroy(),this.closeButtonComp=void 0}},o.prototype.setBodyComponent=function(t){t.setParentComponent(this),this.eContentWrapper.appendChild(t.getGui())},o.prototype.addTitleBarButton=function(t,e){var i=this.eTitleBarButtons,o=i.children,n=o.length;null==e&&(e=n),e=Math.max(0,Math.min(e,n));var s=t.getGui();utils_1._.addCssClass(s,"ag-button"),0===e?i.insertAdjacentElement("afterbegin",s):e===n?i.insertAdjacentElement("beforeend",s):o[e-1].insertAdjacentElement("afterend",s),t.setParentComponent(this)},o.prototype.getBodyHeight=function(){return utils_1._.getInnerHeight(this.eContentWrapper)},o.prototype.getBodyWidth=function(){return utils_1._.getInnerWidth(this.eContentWrapper)},o.prototype.setTitle=function(t){this.eTitle.innerText=t},o.prototype.onBtClose=function(){this.close()},o.prototype.destroy=function(){i.prototype.destroy.call(this),this.closeButtonComp&&(this.closeButtonComp.destroy(),this.closeButtonComp=void 0);var t=this.getGui();t&&t.offsetParent&&this.close()},o.TEMPLATE='<div class="ag-panel" tabindex="-1">\n            <div ref="eTitleBar" class="ag-title-bar ag-unselectable">\n                <span ref="eTitle" class="ag-title-bar-title"></span>\n                <div ref="eTitleBarButtons" class="ag-title-bar-buttons"></div>\n            </div>\n            <div ref="eContentWrapper" class="ag-panel-content-wrapper"></div>\n        </div>',o.CLOSE_BTN_TEMPLATE='<div class="ag-button"></div>',__decorate([context_1.Autowired("popupService"),__metadata("design:type",popupService_1.PopupService)],o.prototype,"popupService",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],o.prototype,"gridOptionsWrapper",void 0),__decorate([componentAnnotations_1.RefSelector("eContentWrapper"),__metadata("design:type",HTMLElement)],o.prototype,"eContentWrapper",void 0),__decorate([componentAnnotations_1.RefSelector("eTitleBar"),__metadata("design:type",HTMLElement)],o.prototype,"eTitleBar",void 0),__decorate([componentAnnotations_1.RefSelector("eTitleBarButtons"),__metadata("design:type",HTMLElement)],o.prototype,"eTitleBarButtons",void 0),__decorate([componentAnnotations_1.RefSelector("eTitle"),__metadata("design:type",HTMLElement)],o.prototype,"eTitle",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],o.prototype,"postConstruct",null),o}(component_1.Component);exports.AgPanel=AgPanel;