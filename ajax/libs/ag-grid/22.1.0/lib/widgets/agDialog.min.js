"use strict";var __extends=this&&this.__extends||function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,i,s){var o,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(n=(r<3?o(n):3<r?o(t,i,n):o(t,i))||n);return 3<r&&n&&Object.defineProperty(t,i,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var dragService_1=require("../dragAndDrop/dragService"),context_1=require("../context/context"),agPanel_1=require("./agPanel"),component_1=require("./component"),utils_1=require("../utils"),AgDialog=function(n){function e(e){var t=n.call(this,e)||this;return t.RESIZE_TEMPLATE='\n        <div class="ag-resizer-wrapper">\n            <div ref="eTopLeftResizer" class="ag-resizer ag-resizer-topLeft"></div>\n            <div ref="eTopResizer" class="ag-resizer ag-resizer-top"></div>\n            <div ref="eTopRightResizer" class="ag-resizer ag-resizer-topRight"></div>\n            <div ref="eRightResizer" class="ag-resizer ag-resizer-right"></div>\n            <div ref="eBottomRightResizer" class="ag-resizer ag-resizer-bottomRight"></div>\n            <div ref="eBottomResizer" class="ag-resizer ag-resizer-bottom"></div>\n            <div ref="eBottomLeftResizer" class="ag-resizer ag-resizer-bottomLeft"></div>\n            <div ref="eLeftResizer" class="ag-resizer ag-resizer-left"></div>\n        </div>\n    ',t.MAXIMIZE_BTN_TEMPLATE='<div class="ag-dialog-button"></span>',t.resizable={},t.isResizable=!1,t.movable=!1,t.isMoving=!1,t.isMaximizable=!1,t.isMaximized=!1,t.maximizeListeners=[],t.resizeListenerDestroy=null,t.isResizing=!1,t.lastPosition={x:0,y:0,width:0,height:0},t}return __extends(e,n),e.prototype.postConstruct=function(){var t=this,i=this.getGui(),e=this.config,s=e.movable,o=e.resizable,r=e.maximizable;utils_1._.addCssClass(i,"ag-dialog"),this.moveElement=this.eTitleBar,n.prototype.postConstruct.call(this),this.addDestroyableEventListener(i,"focusin",function(e){i.contains(e.relatedTarget)||t.popupService.bringPopupToFront(i)}),s&&this.setMovable(s),r&&this.setMaximizable(r),this.addResizers(),o&&this.setResizable(o)},e.prototype.renderComponent=function(){var e=this.getGui(),t=this.config,i=t.alwaysOnTop,s=t.modal;this.close=this.popupService.addPopup(s,e,!0,this.destroy.bind(this),void 0,i),e.focus()},e.prototype.addResizers=function(){var e=this.getGui();if(e){var t=(new DOMParser).parseFromString(this.RESIZE_TEMPLATE,"text/html").body;e.appendChild(t.firstChild),this.createMap()}},e.prototype.createMap=function(){var e=this.getGui();this.resizerMap={topLeft:{element:e.querySelector("[ref=eTopLeftResizer]")},top:{element:e.querySelector("[ref=eTopResizer]")},topRight:{element:e.querySelector("[ref=eTopRightResizer]")},right:{element:e.querySelector("[ref=eRightResizer]")},bottomRight:{element:e.querySelector("[ref=eBottomRightResizer]")},bottom:{element:e.querySelector("[ref=eBottomResizer]")},bottomLeft:{element:e.querySelector("[ref=eBottomLeftResizer]")},left:{element:e.querySelector("[ref=eLeftResizer]")}}},e.prototype.getResizerElement=function(e){return this.resizerMap[e].element},e.prototype.onResizeStart=function(e){this.isResizing=!0,this.updateDragStartPosition(e.clientX,e.clientY)},e.prototype.onResize=function(e,t){if(this.isResizing){var i=!!t.match(/left/i),s=!!t.match(/right/i),o=!!t.match(/top/i),r=!!t.match(/bottom/i),n=i||s,a=o||r,h=this.calculateMouseMovement({e:e,isLeft:i,isTop:o}),l=h.movementX,c=h.movementY,p=0,m=0;if(n&&l){var d=i?-1:1,g=this.getWidth(),f=g+l*d,u=!1;i&&(p=g-f,(this.position.x+p<=0||f<=this.minWidth)&&(u=!0,p=0)),u||this.setWidth(f)}if(a&&c){d=o?-1:1;var v=this.getHeight(),z=v+c*d,y=!1;o&&(m=v-z,(this.position.y+m<=0||z<=this.minHeight)&&(y=!0,m=0)),y||this.setHeight(z)}this.updateDragStartPosition(e.clientX,e.clientY),(p||m)&&this.offsetElement(this.position.x+p,this.position.y+m)}},e.prototype.onResizeEnd=function(){this.isResizing=!1;var e={type:"resize",api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi()};this.localEventService&&this.localEventService.dispatchEvent(e)},e.prototype.onMoveStart=function(e){this.isMoving=!0,this.updateDragStartPosition(e.clientX,e.clientY)},e.prototype.onMove=function(e){if(this.isMoving){var t=this.position,i=t.x,s=t.y,o=this.calculateMouseMovement({e:e,isTop:!0,anywhereWithin:!0,topBuffer:this.getHeight()-this.getBodyHeight()}),r=o.movementX,n=o.movementY;this.offsetElement(i+r,s+n),this.updateDragStartPosition(e.clientX,e.clientY)}},e.prototype.onMoveEnd=function(){this.isMoving=!1},e.prototype.toggleMaximize=function(){if(this.isMaximized){var e=this.lastPosition,t=e.x,i=e.y,s=e.width,o=e.height;this.setWidth(s),this.setHeight(o),this.offsetElement(t,i)}else this.lastPosition.width=this.getWidth(),this.lastPosition.height=this.getHeight(),this.lastPosition.x=this.position.x,this.lastPosition.y=this.position.y,this.offsetElement(0,0),this.setHeight("100%"),this.setWidth("100%");this.isMaximized=!this.isMaximized,this.refreshMaximizeIcon()},e.prototype.refreshMaximizeIcon=function(){utils_1._.addOrRemoveCssClass(this.maximizeIcon,"ag-hidden",this.isMaximized),utils_1._.addOrRemoveCssClass(this.minimizeIcon,"ag-hidden",!this.isMaximized)},e.prototype.clearMaximizebleListeners=function(){this.maximizeListeners.length&&(this.maximizeListeners.forEach(function(e){return e()}),this.maximizeListeners.length=0),this.resizeListenerDestroy&&(this.resizeListenerDestroy(),this.resizeListenerDestroy=null)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.setResizable(!1),this.setMovable(!1),this.maximizeButtonComp&&(this.maximizeButtonComp.destroy(),this.maximizeButtonComp=void 0),this.clearMaximizebleListeners()},e.prototype.setResizable=function(r){var n=this,a=!1;"boolean"==typeof r&&(r={topLeft:r,top:r,topRight:r,right:r,bottomRight:r,bottom:r,bottomLeft:r,left:r}),Object.keys(r).forEach(function(e){var t=e,i=!!r[t],s=n.getResizerElement(t),o=n.resizerMap[t].dragSource||{eElement:s,onDragStart:n.onResizeStart.bind(n),onDragging:function(e){return n.onResize(e,t)},onDragStop:n.onResizeEnd.bind(n)};!!n.resizable[t]==i&&(n.isAlive()||i)||(i?(n.dragService.addDragSource(o),s.style.pointerEvents="all",a=!0):(n.dragService.removeDragSource(o),s.style.pointerEvents="none"),n.resizerMap[t].dragSource=i?o:void 0)}),this.isResizable=a},e.prototype.setMovable=function(e){if(e!==this.movable){this.movable=e;var t=this.moveElementDragListener||{eElement:this.moveElement,onDragStart:this.onMoveStart.bind(this),onDragging:this.onMove.bind(this),onDragStop:this.onMoveEnd.bind(this)};e?(this.dragService.addDragSource(t),this.moveElementDragListener=t):(this.dragService.removeDragSource(t),this.moveElementDragListener=void 0)}},e.prototype.setMaximizable=function(e){var t=this;if(!1===e)return this.clearMaximizebleListeners(),void(this.maximizeButtonComp&&(this.maximizeButtonComp.destroy(),this.maximizeButtonComp=this.maximizeIcon=this.minimizeIcon=void 0));var i=this.eTitleBar;if(i&&e!==this.isMaximizable){var s=this.maximizeButtonComp=new component_1.Component(this.MAXIMIZE_BTN_TEMPLATE);this.getContext().wireBean(s);var o=s.getGui();o.appendChild(this.maximizeIcon=utils_1._.createIconNoSpan("maximize",this.gridOptionsWrapper)),o.appendChild(this.minimizeIcon=utils_1._.createIconNoSpan("minimize",this.gridOptionsWrapper)),utils_1._.addCssClass(this.minimizeIcon,"ag-hidden"),s.addDestroyableEventListener(o,"click",this.toggleMaximize.bind(this)),this.addTitleBarButton(s,0),this.maximizeListeners.push(this.addDestroyableEventListener(i,"dblclick",this.toggleMaximize.bind(this))),this.resizeListenerDestroy=this.addDestroyableEventListener(this,"resize",function(){t.isMaximized=!1,t.refreshMaximizeIcon()})}},__decorate([context_1.Autowired("dragService"),__metadata("design:type",dragService_1.DragService)],e.prototype,"dragService",void 0),e}(agPanel_1.AgPanel);exports.AgDialog=AgDialog;