"use strict";var __decorate=this&&this.__decorate||function(t,e,o,r){var n,u=arguments.length,i=u<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(i=(u<3?n(i):3<u?n(e,o,i):n(e,o))||i);return 3<u&&i&&Object.defineProperty(e,o,i),i},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),columnUtils_1=require("./columnUtils"),columnGroup_1=require("../entities/columnGroup"),originalColumnGroup_1=require("../entities/originalColumnGroup"),context_2=require("../context/context"),utils_1=require("../utils"),DisplayedGroupCreator=function(){function t(){}return t.prototype.createDisplayedGroups=function(t,i,a,l,e){var c,p,s=this,d=[],f=this.mapOldGroupsById(e);return t.forEach(function(t){for(var e=s.getOriginalPathForColumn(i,t),o=[],r=!p,n=0;n<e.length;n++)if(r||e[n]!==p[n]){var u=s.createColumnGroup(e[n],a,f,l);o[n]=u,0==n?d.push(u):o[n-1].addChild(u)}else o[n]=c[n];0===o.length?d.push(t):utils_1._.last(o).addChild(t);c=o,p=e}),this.setupParentsIntoColumns(d,null),d},t.prototype.createColumnGroup=function(t,e,o,r){var n=t.getGroupId(),u=e.getInstanceIdForKey(n),i=o[columnGroup_1.ColumnGroup.createUniqueId(n,u)];return i&&i.getOriginalColumnGroup()!==t&&(i=null),utils_1._.exists(i)?i.reset():(i=new columnGroup_1.ColumnGroup(t,n,u,r),this.context.wireBean(i)),i},t.prototype.mapOldGroupsById=function(t){var o={},r=function(t){t.forEach(function(t){if(t instanceof columnGroup_1.ColumnGroup){var e=t;o[t.getUniqueId()]=e,r(e.getChildren())}})};return t&&r(t),o},t.prototype.setupParentsIntoColumns=function(t,o){var r=this;t.forEach(function(t){if(t.setParent(o),t instanceof columnGroup_1.ColumnGroup){var e=t;r.setupParentsIntoColumns(e.getChildren(),e)}})},t.prototype.getOriginalPathForColumn=function(t,i){var a=[],l=!1;return function t(e,o){for(var r=0;r<e.length;r++){if(l)return;var n=e[r];if(n instanceof originalColumnGroup_1.OriginalColumnGroup){var u=n;t(u.getChildren(),o+1),a[o]=n}else n===i&&(l=!0)}}(t,0),l?a:(console.warn("could not get path"),null)},__decorate([context_1.Autowired("columnUtils"),__metadata("design:type",columnUtils_1.ColumnUtils)],t.prototype,"columnUtils",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_2.Context)],t.prototype,"context",void 0),t=__decorate([context_2.Bean("displayedGroupCreator")],t)}();exports.DisplayedGroupCreator=DisplayedGroupCreator;