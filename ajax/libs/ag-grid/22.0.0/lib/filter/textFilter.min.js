"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var l,n=arguments.length,o=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;0<=s;s--)(l=t[s])&&(o=(n<3?l(o):3<n?l(e,i,o):l(e,i))||o);return 3<n&&o&&Object.defineProperty(e,i,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var baseFilter_1=require("./baseFilter"),componentAnnotations_1=require("../widgets/componentAnnotations"),utils_1=require("../utils"),TextFilter=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return __extends(l,e),l.prototype.getDefaultType=function(){return baseFilter_1.BaseFilter.CONTAINS},l.prototype.customInit=function(){this.comparator=this.filterParams.textCustomComparator?this.filterParams.textCustomComparator:l.DEFAULT_COMPARATOR,this.formatter=this.filterParams.textFormatter?this.filterParams.textFormatter:1==this.filterParams.caseSensitive?l.DEFAULT_FORMATTER:l.DEFAULT_LOWERCASE_FORMATTER,e.prototype.customInit.call(this)},l.prototype.modelFromFloatingFilter=function(t){return{type:this.selectedFilter,filter:t,filterType:"text"}},l.prototype.getApplicableFilterTypes=function(){return[baseFilter_1.BaseFilter.EQUALS,baseFilter_1.BaseFilter.NOT_EQUAL,baseFilter_1.BaseFilter.STARTS_WITH,baseFilter_1.BaseFilter.ENDS_WITH,baseFilter_1.BaseFilter.CONTAINS,baseFilter_1.BaseFilter.NOT_CONTAINS]},l.prototype.bodyTemplate=function(t){var e=this.translate.bind(this);return'<div class="ag-filter-body">\n            <div class="ag-input-text-wrapper">\n                <input class="ag-filter-filter" id='+(t==baseFilter_1.FilterConditionType.MAIN?"filterText":"filterConditionText")+' type="text" placeholder="'+e("filterOoo","Filter...")+'"/>\n            </div>\n        </div>'},l.prototype.initialiseFilterBodyUi=function(t){e.prototype.initialiseFilterBodyUi.call(this,t),this.addFilterChangedListener(t),this.setFilter(this.filterConditionText,baseFilter_1.FilterConditionType.CONDITION),this.setFilterType(this.selectedFilterCondition,baseFilter_1.FilterConditionType.CONDITION)},l.prototype.addFilterChangedListener=function(t){var e=this,i=t===baseFilter_1.FilterConditionType.MAIN?this.eFilterTextField:this.eFilterConditionTextField,r=this.getDebounceMs(this.filterParams),l=utils_1._.debounce(function(){return e.onFilterTextFieldChanged(t)},r);this.addDestroyableEventListener(i,"input",l)},l.prototype.refreshFilterBodyUi=function(t){var e=t===baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition;this.eFilterConditionTextField&&this.addFilterChangedListener(baseFilter_1.FilterConditionType.CONDITION);var i=t===baseFilter_1.FilterConditionType.MAIN?this.eFilterTextField:this.eFilterConditionTextField;if(i){var r=!this.doesFilterHaveHiddenInput(e)&&e!==baseFilter_1.BaseFilter.EMPTY;utils_1._.setVisible(i,r)}},l.prototype.afterGuiAttached=function(){this.eFilterTextField.focus()},l.prototype.filterValues=function(t){return t===baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText},l.prototype.individualFilterPasses=function(t,e){var i=e==baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText,r=e==baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition,l=this.customFilterOptions[r];if(!l||null==i&&!l.hideFilterInput)return i?this.checkIndividualFilter(t,r,i):e===baseFilter_1.FilterConditionType.MAIN||"AND"===this.conditionValue;var n=this.filterParams.valueGetter(t.node),o=this.formatter(n);return l.test(i,o)},l.prototype.checkIndividualFilter=function(t,e,i){var r=this.filterParams.valueGetter(t.node),l=this.formatter(i);if(null==r||void 0===r)return e===baseFilter_1.BaseFilter.NOT_EQUAL||e===baseFilter_1.BaseFilter.NOT_CONTAINS;var n=this.formatter(r);return this.comparator(e,n,l)},l.prototype.onFilterTextFieldChanged=function(t){var e=t===baseFilter_1.FilterConditionType.MAIN?this.eFilterTextField.value:this.eFilterConditionTextField.value,i=t===baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText,r=utils_1._.makeNull(e);if(r&&""===r.trim()&&(r=null),i!==r){var l=r&&1!=this.filterParams.caseSensitive?r.toLowerCase():r,n=i&&1!=this.filterParams.caseSensitive?i.toLowerCase():i;t===baseFilter_1.FilterConditionType.MAIN?this.filterText=this.formatter(r):this.filterConditionText=this.formatter(r),n!==l&&this.onFilterChanged()}},l.prototype.setFilter=function(t,e){if(t=utils_1._.makeNull(t),e===baseFilter_1.FilterConditionType.MAIN)if(t){if(this.filterText=this.formatter(t),!this.eFilterTextField)return;this.eFilterTextField.value=t}else{if(this.filterText=null,!this.eFilterTextField)return;this.eFilterTextField.value=null}else if(t){if(this.filterConditionText=this.formatter(t),!this.eFilterConditionTextField)return;this.eFilterConditionTextField.value=t}else{if(this.filterConditionText=null,!this.eFilterConditionTextField)return;this.eFilterConditionTextField.value=null}},l.prototype.getFilter=function(){return this.filterText},l.prototype.resetState=function(t){void 0===t&&(t=!1),t||(this.setFilterType(this.defaultFilter,baseFilter_1.FilterConditionType.MAIN),this.setFilter(null,baseFilter_1.FilterConditionType.MAIN)),this.setFilterType(this.defaultFilter,baseFilter_1.FilterConditionType.CONDITION),this.setFilter(null,baseFilter_1.FilterConditionType.CONDITION)},l.prototype.serialize=function(t){var e=t===baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition,i=t===baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText;return{type:e||this.defaultFilter,filter:i,filterType:"text"}},l.prototype.parse=function(t,e){this.setFilterType(t.type,e),this.setFilter(t.filter,e)},l.prototype.setType=function(t,e){this.setFilterType(t,e)},l.DEFAULT_FORMATTER=function(t){return t},l.DEFAULT_LOWERCASE_FORMATTER=function(t){return null==t?null:t.toString().toLowerCase()},l.DEFAULT_COMPARATOR=function(t,e,i){switch(t){case l.CONTAINS:return 0<=e.indexOf(i);case l.NOT_CONTAINS:return-1===e.indexOf(i);case l.EQUALS:return e===i;case l.NOT_EQUAL:return e!=i;case l.STARTS_WITH:return 0===e.indexOf(i);case l.ENDS_WITH:var r=e.lastIndexOf(i);return 0<=r&&r===e.length-i.length;default:return console.warn("invalid filter type "+t),!1}},__decorate([componentAnnotations_1.QuerySelector("#filterText"),__metadata("design:type",HTMLInputElement)],l.prototype,"eFilterTextField",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterConditionText"),__metadata("design:type",HTMLInputElement)],l.prototype,"eFilterConditionTextField",void 0),l}(baseFilter_1.ComparableBaseFilter);exports.TextFilter=TextFilter;