"use strict";var __decorate=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;0<=s;s--)(i=t[s])&&(a=(r<3?i(a):3<r?i(e,o,a):i(e,o))||a);return 3<r&&a&&Object.defineProperty(e,o,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),constants_1=require("../constants"),mouseEventService_1=require("./mouseEventService"),paginationProxy_1=require("../rowModels/paginationProxy"),focusedCellController_1=require("../focusedCellController"),animationFrameService_1=require("../misc/animationFrameService"),columnController_1=require("../columnController/columnController"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),utils_1=require("../utils"),NavigationService=function(){function t(){this.timeLastPageEventProcessed=0}return t.prototype.init=function(){this.scrollWidth=this.gridOptionsWrapper.getScrollbarWidth()},t.prototype.registerGridComp=function(t){this.gridPanel=t},t.prototype.handlePageScrollingKey=function(t){var e=t.which||t.keyCode,o=t.altKey,n=t.ctrlKey,i=this.mouseEventService.getCellPositionForEvent(t);if(!i)return!1;var r=!1;switch(e){case constants_1.Constants.KEY_PAGE_HOME:case constants_1.Constants.KEY_PAGE_END:n||o||(this.onHomeOrEndKey(e),r=!0);break;case constants_1.Constants.KEY_LEFT:case constants_1.Constants.KEY_RIGHT:n&&!o&&(this.onCtrlLeftOrRight(e,i),r=!0);break;case constants_1.Constants.KEY_UP:case constants_1.Constants.KEY_DOWN:n&&!o&&(this.onCtrlUpOrDown(e,i),r=!0);break;case constants_1.Constants.KEY_PAGE_DOWN:n||o||(this.onPageDown(i),r=!0);break;case constants_1.Constants.KEY_PAGE_UP:n||o||(this.onPageUp(i),r=!0)}return r&&t.preventDefault(),r},t.prototype.isTimeSinceLastPageEventToRecent=function(){return(new Date).getTime()-this.timeLastPageEventProcessed<100},t.prototype.setTimeLastPageEventProcessed=function(){this.timeLastPageEventProcessed=(new Date).getTime()},t.prototype.onPageDown=function(t){if(!this.isTimeSinceLastPageEventToRecent()){var e=this.gridPanel.getVScrollPosition(),o=e.bottom-e.top;this.gridPanel.isHorizontalScrollShowing()&&(o-=this.scrollWidth);var n=this.paginationProxy.getPixelOffset(),i=e.top+o,r=this.paginationProxy.getRowIndexAtPixel(i+n),a=this.paginationProxy.getRow(t.rowIndex).rowTop+o-n,s=this.paginationProxy.getRowIndexAtPixel(a+n),l=this.paginationProxy.getPageLastRow();l<s&&(s=l),l<r&&(r=l),this.navigateTo(r,"top",null,s,t.column),this.setTimeLastPageEventProcessed()}},t.prototype.onPageUp=function(t){if(!this.isTimeSinceLastPageEventToRecent()){var e=this.gridPanel.getVScrollPosition(),o=e.bottom-e.top;this.gridPanel.isHorizontalScrollShowing()&&(o-=this.scrollWidth);var n=this.paginationProxy.getPixelOffset(),i=e.top,r=this.paginationProxy.getRowIndexAtPixel(i+n),a=this.paginationProxy.getRow(t.rowIndex),s=a.rowTop+a.rowHeight-o-n,l=this.paginationProxy.getRowIndexAtPixel(s+n),c=this.paginationProxy.getPageFirstRow();l<c&&(l=c),r<c&&(r=c),this.navigateTo(r,"bottom",null,l,t.column),this.setTimeLastPageEventProcessed()}},t.prototype.navigateTo=function(t,e,o,n,i){if(utils_1._.exists(o)&&this.gridPanel.ensureColumnVisible(o),utils_1._.exists(t)&&this.gridPanel.ensureIndexVisible(t,e),this.animationFrameService.flushAllFrames(),this.focusedCellController.setFocusedCell(n,i,null,!0),this.rangeController){var r={rowIndex:n,rowPinned:null,column:i};this.rangeController.setRangeToCell(r)}},t.prototype.onCtrlUpOrDown=function(t,e){var o=t===constants_1.Constants.KEY_UP?0:this.paginationProxy.getPageLastRow();this.navigateTo(o,null,e.column,o,e.column)},t.prototype.onCtrlLeftOrRight=function(t,e){var o=t===constants_1.Constants.KEY_LEFT,n=this.columnController.getAllDisplayedColumns(),i=o?n[0]:utils_1._.last(n);this.navigateTo(e.rowIndex,null,i,e.rowIndex,i)},t.prototype.onHomeOrEndKey=function(t){var e=t===constants_1.Constants.KEY_PAGE_HOME,o=this.columnController.getAllDisplayedColumns(),n=e?o[0]:utils_1._.last(o),i=e?0:this.paginationProxy.getPageLastRow();this.navigateTo(i,null,n,i,n)},__decorate([context_1.Autowired("mouseEventService"),__metadata("design:type",mouseEventService_1.MouseEventService)],t.prototype,"mouseEventService",void 0),__decorate([context_1.Autowired("paginationProxy"),__metadata("design:type",paginationProxy_1.PaginationProxy)],t.prototype,"paginationProxy",void 0),__decorate([context_1.Autowired("focusedCellController"),__metadata("design:type",focusedCellController_1.FocusedCellController)],t.prototype,"focusedCellController",void 0),__decorate([context_1.Autowired("animationFrameService"),__metadata("design:type",animationFrameService_1.AnimationFrameService)],t.prototype,"animationFrameService",void 0),__decorate([context_1.Optional("rangeController"),__metadata("design:type",Object)],t.prototype,"rangeController",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],t.prototype,"columnController",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"init",null),t=__decorate([context_1.Bean("navigationService")],t)}();exports.NavigationService=NavigationService;