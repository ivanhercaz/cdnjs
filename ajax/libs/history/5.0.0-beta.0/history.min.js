!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.History={})}(this,function(n){"use strict";function b(){return(b=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n}).apply(this,arguments)}var m="POP",k="REPLACE",O="beforeunload",x="popstate",H=function(n){n.preventDefault(),n.returnValue=""},S=function(){return Math.random().toString(36).substr(2,8)},w=function(e){return Object.keys(e).reduce(function(n,t){return Object.defineProperty(n,t,{enumerable:!0,value:e[t]})},Object.create(null))},E=function(n){var t=n.pathname,e=void 0===t?"/":t,r=n.search,i=void 0===r?"":r,o=n.hash;return e+i+(void 0===o?"":o)},L=function(n){var t={};if(n){var e=n.indexOf("#");0<=e&&(t.hash=n.substr(e),n=n.substr(0,e));var r=n.indexOf("?");0<=r&&(t.search=n.substr(r),n=n.substr(0,r)),n&&(t.pathname=n)}return t},j=function(){var n=[];return{get length(){return n.length},push:function(t){return n.push(t)&&function(){n=n.filter(function(n){return n!==t})}},call:function(t){n.forEach(function(n){return n&&n(t)})}}},y=function(n,t,e){return Math.min(Math.max(n,t),e)};n.createMemoryHistory=function(n){function o(n,t){return void 0===t&&(t=null),w(b({},v,{},"string"==typeof n?L(n):n,{state:t,key:S()}))}function u(n,t,e){return!d.length||(d.call({action:n,location:t,retry:e}),!1)}function a(n,t){h=n,v=t,p.call({action:h,location:v})}function r(n){var t=y(s+n,0,f.length-1),e=f[t];u("POP",e,function(){r(n)})&&(s=t,a("POP",e))}var t=void 0===n?{}:n,e=t.initialEntries,i=void 0===e?["/"]:e,c=t.initialIndex,l=void 0===c?0:c,f=i.map(function(n){return w(b({pathname:"/",search:"",hash:"",state:null,key:S()},"string"==typeof n?L(n):n))}),s=y(l,0,f.length-1),h=m,v=f[s],d=j(),p=j();return{get action(){return h},get location(){return v},createHref:E,push:function n(t,e){var r=o(t,e);u("PUSH",r,function(){return n(t,e)})&&(s+=1,f.splice(s,f.length,r),a("PUSH",r))},replace:function n(t,e){var r=k,i=o(t,e);u(r,i,function(){return n(t,e)})&&(f[s]=i,a(r,i))},go:r,back:function(){r(-1)},forward:function(){r(1)},listen:function(n){return p.push(n)},block:function(n){return d.push(n)}}},n.createBrowserHistory=function(n){function i(){var n=a.location,t=n.pathname,e=n.search,r=n.hash,i=c.state||{};return[i.idx,w({pathname:t,search:e,hash:r,state:i.usr||null,key:i.key||"default"})]}var t=(void 0===n?{}:n).window,a=void 0===t?document.defaultView:t,c=a.history,o=null;a.addEventListener(x,function(){if(o)f.call(o),o=null;else{var n=i(),t=n[0],e=n[1];if(f.length){if(null!=t){var r=l-t;r&&(o={action:"POP",location:e,retry:function(){g(-1*r)}},g(r))}}else y("POP")}});var e=m,r=i(),l=r[0],u=r[1],f=j(),s=j();null==l&&(l=0,c.replaceState(b({},c.state,{idx:l}),null));function h(n,t){return void 0===t&&(t=null),w(b({},u,{},"string"==typeof n?L(n):n,{state:t,key:S()}))}function v(n,t){return[{usr:n.state,key:n.key,idx:t},p(n)]}function d(n,t,e){return!f.length||(f.call({action:n,location:t,retry:e}),!1)}var p=E,y=function(n){e=n;var t=i();l=t[0],u=t[1],s.call({action:e,location:u})},g=function(n){c.go(n)};return{get action(){return e},get location(){return u},createHref:p,push:function n(t,e){var r=h(t,e);if(d("PUSH",r,function(){return n(t,e)})){var i=v(r,l+1),o=i[0],u=i[1];try{c.pushState(o,null,u)}catch(n){a.location.assign(u)}y("PUSH")}},replace:function n(t,e){var r=k,i=h(t,e);if(d(r,i,function(){return n(t,e)})){var o=v(i,l),u=o[0],a=o[1];c.replaceState(u,null,a),y(r)}},go:g,back:function(){g(-1)},forward:function(){g(1)},listen:function(n){return s.push(n)},block:function(n){var t=f.push(n);return 1===f.length&&a.addEventListener(O,H),function(){t(),f.length||a.removeEventListener(O,H)}}}},n.createHashHistory=function(n){function i(){var n=L(c.location.hash.substr(1)),t=n.pathname,e=void 0===t?"/":t,r=n.search,i=void 0===r?"":r,o=n.hash,u=void 0===o?"":o,a=l.state||{};return[a.idx,w({pathname:e,search:i,hash:u,state:a.usr||null,key:a.key||"default"})]}function e(){if(o)s.call(o),o=null;else{var n=i(),t=n[0],e=n[1];if(s.length){if(null!=t){var r=f-t;r&&(o={action:"POP",location:e,retry:function(){P(-1*r)}},P(r))}}else g("POP")}}var t=(void 0===n?{}:n).window,c=void 0===t?document.defaultView:t,l=c.history,o=null;c.addEventListener(x,e),c.addEventListener("hashchange",function(n){var t=i()[1];E(t)!==E(a)&&e()});var r=m,u=i(),f=u[0],a=u[1],s=j(),h=j();null==f&&(f=0,l.replaceState(b({},l.state,{idx:f}),null));function v(n){var t=document.querySelector("base"),e="";if(t&&t.getAttribute("href")){var r=c.location.href,i=r.indexOf("#");e=-1===i?r:r.slice(0,i)}return e+"#"+E(n)}function d(n,t){return void 0===t&&(t=null),w(b({},a,{},"string"==typeof n?L(n):n,{state:t,key:S()}))}function p(n,t){return[{usr:n.state,key:n.key,idx:t},v(n)]}function y(n,t,e){return!s.length||(s.call({action:n,location:t,retry:e}),!1)}var g=function(n){r=n;var t=i();f=t[0],a=t[1],h.call({action:r,location:a})},P=function(n){l.go(n)};return{get action(){return r},get location(){return a},createHref:v,push:function n(t,e){var r=d(t,e);if(y("PUSH",r,function(){return n(t,e)})){var i=p(r,f+1),o=i[0],u=i[1];try{l.pushState(o,null,u)}catch(n){c.location.assign(u)}g("PUSH")}},replace:function n(t,e){var r=k,i=d(t,e);if(y(r,i,function(){return n(t,e)})){var o=p(i,f),u=o[0],a=o[1];l.replaceState(u,null,a),g(r)}},go:P,back:function(){P(-1)},forward:function(){P(1)},listen:function(n){return h.push(n)},block:function(n){var t=s.push(n);return 1===s.length&&c.addEventListener(O,H),function(){t(),s.length||c.removeEventListener(O,H)}}}},Object.defineProperty(n,"__esModule",{value:!0})});
