!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],n):n(t.unistore={},t.react)}(this,function(t,s){function a(t,n){for(var e in n)t[e]=n[e];return t}var n,e={store:function(){}},r=((n=s.Component)&&(o.__proto__=n),((o.prototype=Object.create(n&&n.prototype)).constructor=o).prototype.getChildContext=function(){return{store:this.props.store}},o.prototype.render=function(){return s.Children.only(this.props.children)},o);function o(){n.apply(this,arguments)}r.childContextTypes=e,t.createStore=function(u){var i=[];function n(t){for(var n=[],e=0;e<i.length;e++)i[e]===t?t=null:n.push(i[e]);i=n}function e(t,n,e){u=n?t:a(a({},u),t);for(var r=i,o=0;o<r.length;o++)r[o](u,e)}return u=u||{},{action:function(o){function i(t){e(t,!1,o)}return function(){for(var t=arguments,n=[u],e=0;e<arguments.length;e++)n.push(t[e]);var r=o.apply(this,n);if(null!=r)return r.then?r.then(i):i(r)}},setState:e,subscribe:function(t){return i.push(t),function(){n(t)}},unsubscribe:n,getState:function(){return u}}},t.Provider=r,t.connect=function(f,p){var r;return"function"!=typeof f&&("string"==typeof(r=f||[])&&(r=r.split(/\s*,\s*/)),f=function(t){for(var n={},e=0;e<r.length;e++)n[r[e]]=t[r[e]];return n}),function(c){function t(t,n){var r=this;s.Component.call(this,t,n);function e(){var t=f(o?o.getState():{},r.props);for(var n in t)if(t[n]!==i[n])return i=t,r.forceUpdate();for(var e in i)if(!(e in t))return i=t,r.forceUpdate()}var o=n.store,i=f(o?o.getState():{},t),u=p?function(t,n){"function"==typeof t&&(t=t(n));var e={};for(var r in t)e[r]=n.action(t[r]);return e}(p,o):{store:o};this.componentDidMount=function(){o.subscribe(e)},this.componentWillUnmount=function(){o.unsubscribe(e)},this.render=function(){return s.createElement(c,a(a(a({},u),r.props),i))}}return t.contextTypes=e,(t.prototype=Object.create(s.Component.prototype)).constructor=t}}});