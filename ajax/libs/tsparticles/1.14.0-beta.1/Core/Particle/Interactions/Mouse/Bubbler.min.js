"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ProcessBubbleType_1=require("../../../../Enums/ProcessBubbleType"),Utils_1=require("../../../../Utils/Utils"),HoverMode_1=require("../../../../Enums/Modes/HoverMode"),ClickMode_1=require("../../../../Enums/Modes/ClickMode"),Constants_1=require("../../../../Utils/Constants"),ColorUtils_1=require("../../../../Utils/ColorUtils"),Circle_1=require("../../../../Utils/Circle"),Bubbler=function(){function e(){}return e.reset=function(e){delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color},e.bubble=function(e,i){var b=e.options.interactivity.events,t=b.onHover,l=b.onClick,o=t.enable,s=t.mode,u=l.enable,r=l.mode;o&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,s)?this.hoverBubble(e):u&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,r)&&this.clickBubble(e)},e.process=function(e,i,b,t,l){var o,s,u,r,a,c,n,p=l.bubbleObj.optValue;void 0!==p&&(o=e.options.interactivity.modes.bubble.duration,s=e.retina.bubbleModeDistance,u=l.particlesObj.optValue,r=l.bubbleObj.value,a=l.particlesObj.value||0,c=l.type,p!==u&&(e.bubble.durationEnd?r&&(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete i.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete i.bubble.opacity):b<=s?(null!=r?r:a)!==p&&(n=a-t*(a-p)/o,c===ProcessBubbleType_1.ProcessBubbleType.size&&(i.bubble.radius=n),c===ProcessBubbleType_1.ProcessBubbleType.opacity&&(i.bubble.opacity=n)):(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete i.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete i.bubble.opacity)))},e.clickBubble=function(e){var i,b=e.options,t=e.interactivity.mouse.clickPosition;if(void 0!==t)for(var l=e.retina.bubbleModeDistance,o=0,s=e.particles.quadTree.query(new Circle_1.Circle(t.x,t.y,l));o<s.length;o++){var u,r,a=s[o],c=a.getPosition(),n=Utils_1.Utils.getDistance(c,t),p=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;e.bubble.clicking&&(p>b.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),p>2*b.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1),u={bubbleObj:{optValue:e.retina.bubbleModeSize,value:a.bubble.radius},particlesObj:{optValue:null!==(i=a.sizeValue)&&void 0!==i?i:e.retina.sizeValue,value:a.size.value},type:ProcessBubbleType_1.ProcessBubbleType.size},this.process(e,a,n,p,u),r={bubbleObj:{optValue:b.interactivity.modes.bubble.opacity,value:a.bubble.opacity},particlesObj:{optValue:a.particlesOptions.opacity.value,value:a.opacity.value},type:ProcessBubbleType_1.ProcessBubbleType.opacity},this.process(e,a,n,p,r),!e.bubble.durationEnd&&n<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,a):delete a.bubble.color)}},e.hoverBubble=function(e){var i=e.interactivity.mouse.position;if(void 0!==i)for(var b=e.retina.bubbleModeDistance,t=0,l=e.particles.quadTree.query(new Circle_1.Circle(i.x,i.y,b));t<l.length;t++){var o=l[t],s=o.getPosition(),u=Utils_1.Utils.getDistance(s,i),r=1-u/e.retina.bubbleModeDistance;u<=e.retina.bubbleModeDistance?0<=r&&e.interactivity.status===Constants_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,o,r),this.hoverBubbleOpacity(e,o,r),this.hoverBubbleColor(e,o)):this.reset(o),e.interactivity.status===Constants_1.Constants.mouseLeaveEvent&&this.reset(o)}},e.hoverBubbleSize=function(e,i,b){var t,l,o,s,u=e.retina.bubbleModeSize;void 0!==u&&(l=null!==(t=i.sizeValue)&&void 0!==t?t:e.retina.sizeValue,o=i.size.value,void 0!==(s=this.calculateBubbleValue(o,u,l,b))&&(i.bubble.radius=s))},e.hoverBubbleOpacity=function(e,i,b){var t,l,o,s=e.options.interactivity.modes.bubble.opacity;void 0!==s&&(t=i.particlesOptions.opacity.value,l=i.opacity.value,void 0!==(o=this.calculateBubbleValue(l,s,t,b))&&(i.bubble.opacity=o))},e.calculateBubbleValue=function(e,i,b,t){if(b<i){var l=e+(i-b)*t;return Utils_1.Utils.clamp(l,e,i)}if(i<b){l=e-(b-i)*t;return Utils_1.Utils.clamp(l,i,e)}},e.hoverBubbleColor=function(e,i){var b=e.options;if(void 0===i.bubble.color){var t=b.interactivity.modes.bubble.color;if(void 0===t)return;i.bubble.color=ColorUtils_1.ColorUtils.colorToRgb(t instanceof Array?Utils_1.Utils.itemFromArray(t):t)}},e}();exports.Bubbler=Bubbler;