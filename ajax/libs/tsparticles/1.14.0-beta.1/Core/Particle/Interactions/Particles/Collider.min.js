"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Utils_1=require("../../../../Utils/Utils"),CollisionMode_1=require("../../../../Enums/CollisionMode"),Circle_1=require("../../../../Utils/Circle"),Collider=function(){function i(){}return i.collide=function(i,t,o){for(var e=i.getPosition(),l=0,r=t.particles.quadTree.query(new Circle_1.Circle(e.x,e.y,2*i.size.value));l<r.length;l++){var a,s,n,c=r[l];i!==c&&c.particlesOptions.collisions.enable&&i.particlesOptions.collisions.mode===c.particlesOptions.collisions.mode&&(a=c.getPosition(),s=Utils_1.Utils.getDistance(e,a),n=t.retina.sizeValue,s<=this.getRadius(i,n)+this.getRadius(c,n)&&this.resolveCollision(i,c))}},i.getRadius=function(i,t){return i.bubble.radius||i.size.value||t},i.resolveCollision=function(i,t){var o=i.getPosition(),e=t.getPosition();switch(i.particlesOptions.collisions.mode){case CollisionMode_1.CollisionMode.bounce:var l,r,a,s,n,c,v,h,u,z=i.velocity.horizontal-t.velocity.horizontal,d=i.velocity.vertical-t.velocity.vertical;0<=z*(e.x-o.x)+d*(e.y-o.y)&&(l=-Math.atan2(e.y-o.y,e.x-o.x),r=i.size.value,a=t.size.value,s=this.rotate(i.velocity,l),n=this.rotate(t.velocity,l),c={horizontal:s.horizontal*(r-a)/(r+a)+2*n.horizontal*a/(r+a),vertical:s.vertical},v={horizontal:n.horizontal*(r-a)/(r+a)+2*s.horizontal*a/(r+a),vertical:n.vertical},h=this.rotate(c,-l),u=this.rotate(v,-l),i.velocity.horizontal=h.horizontal,i.velocity.vertical=h.vertical,t.velocity.horizontal=u.horizontal,t.velocity.vertical=u.vertical)}},i.rotate=function(i,t){return{horizontal:i.horizontal*Math.cos(t)-i.vertical*Math.sin(t),vertical:i.horizontal*Math.sin(t)+i.vertical*Math.cos(t)}},i}();exports.Collider=Collider;