"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Utils_1=require("../../../../Utils/Utils"),CollisionMode_1=require("../../../../Enums/CollisionMode"),QuadTree_1=require("../../../../Utils/QuadTree"),Collider=function(){function i(){}return i.collide=function(i,t,e){for(var o=i.getPosition(),l=0,r=t.particles.quadTree.query(new QuadTree_1.Circle(o.x,o.y,2*i.size.value));l<r.length;l++){var a,s,n,c=r[l];i!==c&&c.particlesOptions.collisions.enable&&i.particlesOptions.collisions.mode===c.particlesOptions.collisions.mode&&(a=c.getPosition(),s=Utils_1.Utils.getDistance(o,a),n=t.retina.sizeValue,s<=this.getRadius(i,n)+this.getRadius(c,n)&&this.resolveCollision(i,c))}},i.getRadius=function(i,t){return i.bubble.radius||i.size.value||t},i.resolveCollision=function(i,t){var e=i.getPosition(),o=t.getPosition();switch(i.particlesOptions.collisions.mode){case CollisionMode_1.CollisionMode.bounce:var l,r,a,s,n,c,v,u,h,d=i.velocity.horizontal-t.velocity.horizontal,z=i.velocity.vertical-t.velocity.vertical;0<=d*(o.x-e.x)+z*(o.y-e.y)&&(l=-Math.atan2(o.y-e.y,o.x-e.x),r=i.size.value,a=t.size.value,s=this.rotate(i.velocity,l),n=this.rotate(t.velocity,l),c={horizontal:s.horizontal*(r-a)/(r+a)+2*n.horizontal*a/(r+a),vertical:s.vertical},v={horizontal:n.horizontal*(r-a)/(r+a)+2*s.horizontal*a/(r+a),vertical:n.vertical},u=this.rotate(c,-l),h=this.rotate(v,-l),i.velocity.horizontal=u.horizontal,i.velocity.vertical=u.vertical,t.velocity.horizontal=h.horizontal,t.velocity.vertical=h.vertical)}},i.rotate=function(i,t){return{horizontal:i.horizontal*Math.cos(t)-i.vertical*Math.sin(t),vertical:i.horizontal*Math.sin(t)+i.vertical*Math.cos(t)}},i}();exports.Collider=Collider;