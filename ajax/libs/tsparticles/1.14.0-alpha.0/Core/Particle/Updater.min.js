"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var OutMode_1=require("../../Enums/OutMode"),Utils_1=require("../../Utils/Utils"),Mover_1=require("./Mover"),RotateDirection_1=require("../../Enums/RotateDirection"),SizeAnimationStatus_1=require("../../Enums/SizeAnimationStatus"),OpacityAnimationStatus_1=require("../../Enums/OpacityAnimationStatus"),Updater=function(){function l(t,i){this.container=t,this.particle=i,this.mover=new Mover_1.Mover(t,i)}return l.checkBounds=function(t,i,e,o,a){(e<t+i&&0<o||t-i<0&&o<0)&&a()},l.prototype.update=function(t){this.mover.move(t),this.updateOpacity(t),this.updateSize(t),this.updateAngle(t),this.fixOutOfCanvasPosition(),this.updateOutMode()},l.prototype.updateOpacity=function(t){var i=this.container.options,e=this.particle,o=0<i.fpsLimit?60*t/1e3:3.6;if(e.particlesOptions.opacity.animation.enable){switch(e.opacity.status){case OpacityAnimationStatus_1.OpacityAnimationStatus.increasing:e.opacity.value>=e.particlesOptions.opacity.value?e.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.decreasing:e.opacity.value+=(e.opacity.velocity||0)*o;break;case OpacityAnimationStatus_1.OpacityAnimationStatus.decreasing:e.opacity.value<=e.particlesOptions.opacity.animation.minimumValue?e.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.increasing:e.opacity.value-=(e.opacity.velocity||0)*o}e.opacity.value<0&&(e.opacity.value=0)}},l.prototype.updateSize=function(t){var i,e=this.container,o=e.options,a=this.particle,s=0<o.fpsLimit?60*t/1e3:3.6;if(a.particlesOptions.size.animation.enable){switch(a.size.status){case SizeAnimationStatus_1.SizeAnimationStatus.increasing:a.size.value>=(null!==(i=a.sizeValue)&&void 0!==i?i:e.retina.sizeValue)?a.size.status=SizeAnimationStatus_1.SizeAnimationStatus.decreasing:a.size.value+=(a.size.velocity||0)*s;break;case SizeAnimationStatus_1.SizeAnimationStatus.decreasing:a.size.value<=a.particlesOptions.size.animation.minimumValue?a.size.status=SizeAnimationStatus_1.SizeAnimationStatus.increasing:a.size.value-=(a.size.velocity||0)*s}a.size.value<0&&(a.size.value=0)}},l.prototype.updateAngle=function(t){var i=this.container.options,e=this.particle,o=0<i.fpsLimit?60*t/1e3:3.6;if(e.particlesOptions.rotate.animation.enable)switch(e.rotateDirection){case RotateDirection_1.RotateDirection.clockwise:e.angle+=e.particlesOptions.rotate.animation.speed*Math.PI/18*o,360<e.angle&&(e.angle-=360);break;case RotateDirection_1.RotateDirection.counterClockwise:default:e.angle-=e.particlesOptions.rotate.animation.speed*Math.PI/18*o,e.angle<0&&(e.angle+=360)}},l.prototype.fixOutOfCanvasPosition=function(){var t,i=this.container,e=this.particle,o=e.particlesOptions.move.outMode,a=i.canvas.size;if(t=o===OutMode_1.OutMode.bounce?{bottom:a.height,left:e.size.value,right:a.width,top:e.size.value}:o===OutMode_1.OutMode.bounceHorizontal?{bottom:a.height+e.size.value-e.offset.y,left:e.size.value,right:a.width,top:-e.size.value-e.offset.y}:o===OutMode_1.OutMode.bounceVertical?{bottom:a.height,left:-e.size.value-e.offset.x,right:a.width+e.size.value+e.offset.x,top:e.size.value}:{bottom:a.height+e.size.value-e.offset.y,left:-e.size.value-e.offset.x,right:a.width+e.size.value+e.offset.x,top:-e.size.value-e.offset.y},o===OutMode_1.OutMode.destroy){var s=e.size.value;Utils_1.Utils.isPointInside(e.position,i.canvas.size,s)||i.particles.remove(e)}else{s=e.size.value;var n=Utils_1.Utils.calculateBounds(e.position,s);n.left>a.width-e.offset.x?(e.position.x=t.left,e.position.y=Math.random()*a.height):n.right<-e.offset.x&&(e.position.x=t.right,e.position.y=Math.random()*a.height),n.top>a.height-e.offset.y?(e.position.x=Math.random()*a.width,e.position.y=t.top):n.bottom<-e.offset.y&&(e.position.x=Math.random()*a.width,e.position.y=t.bottom)}},l.prototype.updateOutMode=function(){switch(this.particle.particlesOptions.move.outMode){case OutMode_1.OutMode.bounce:case OutMode_1.OutMode.bounceVertical:case OutMode_1.OutMode.bounceHorizontal:this.updateBounce()}},l.prototype.updateBounce=function(){for(var t=this.container,i=this.particle,e=!1,o=0,a=t.plugins;o<a.length;o++){var s=a[o];if(void 0!==s.particleBounce&&(e=s.particleBounce(i)),e)break}if(!e){var n=i.particlesOptions.move.outMode,u=i.position.x+i.offset.x,c=i.position.y+i.offset.y;if(n===OutMode_1.OutMode.bounce||n===OutMode_1.OutMode.bounceHorizontal){var r=i.size.value,p=i.velocity.horizontal;l.checkBounds(u,r,t.canvas.size.width,p,function(){i.velocity.horizontal*=-1})}if(n===OutMode_1.OutMode.bounce||n===OutMode_1.OutMode.bounceVertical){r=i.size.value,p=i.velocity.vertical;l.checkBounds(c,r,t.canvas.size.height,p,function(){i.velocity.vertical*=-1})}}},l}();exports.Updater=Updater;