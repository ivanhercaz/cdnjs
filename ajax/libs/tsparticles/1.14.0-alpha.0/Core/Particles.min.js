"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Particle_1=require("./Particle"),InteractionManager_1=require("./Particle/Interactions/Particles/InteractionManager"),Utils_1=require("../Utils/Utils"),HoverMode_1=require("../Enums/Modes/HoverMode"),Grabber_1=require("./Particle/Interactions/Mouse/Grabber"),ClickMode_1=require("../Enums/Modes/ClickMode"),Repulser_1=require("./Particle/Interactions/Mouse/Repulser"),DivMode_1=require("../Enums/Modes/DivMode"),Bubbler_1=require("./Particle/Interactions/Mouse/Bubbler"),Connector_1=require("./Particle/Interactions/Mouse/Connector"),QuadTree_1=require("../Utils/QuadTree"),Particles=function(){function e(e){this.container=e,this.array=[],this.interactionsEnabled=!1;var r=this.container.canvas.size;this.noiseZ=0,this.quadTree=new QuadTree_1.QuadTree(new QuadTree_1.Rectangle(0,0,r.width,r.height),4)}return Object.defineProperty(e.prototype,"count",{get:function(){return this.array.length},enumerable:!0,configurable:!0}),e.prototype.init=function(){for(var e=this.container,r=e.options,t=!1,i=this.noiseZ=0,n=e.plugins;i<n.length;i++){var a=n[i];if(void 0!==a.particlesInitialization&&(t=a.particlesInitialization()),t)break}if(!t)for(var o=this.array.length;o<r.particles.number.value;o++)this.addParticle(new Particle_1.Particle(e));if(this.interactionsEnabled=r.particles.lineLinked.enable||r.particles.move.attract.enable||r.particles.collisions.enable||r.infection.enable,r.infection.enable)for(o=0;o<r.infection.infections;o++){var s=this.array.filter(function(e){return void 0===e.infectionStage});Utils_1.Utils.itemFromArray(s).startInfection(0)}},e.prototype.redraw=function(){this.clear(),this.init(),this.draw(0)},e.prototype.removeAt=function(e,r){if(0<=e&&e<=this.count)for(var t=0,i=this.array.splice(e,null!=r?r:1);t<i.length;t++){i[t].destroy()}},e.prototype.remove=function(e){this.removeAt(this.array.indexOf(e))},e.prototype.update=function(e){for(var r=this.container,t=r.options,i=0;i<this.array.length;i++){var n=this.array[i];Bubbler_1.Bubbler.reset(n);for(var a=!0,o=0,s=r.absorbers;o<s.length;o++){if(!(a=s[o].attract(n)))break}if(a){n.update(i,e);var l={x:n.position.x+n.offset.x,y:n.position.y+n.offset.y};r.particles.quadTree.insert(new QuadTree_1.Point(l.x,l.y,n))}}var c=t.interactivity.events.onHover.mode,u=t.interactivity.events.onClick.mode,d=t.interactivity.events.onDiv.mode;Utils_1.Utils.isInArray(HoverMode_1.HoverMode.grab,c)&&Grabber_1.Grabber.grab(r),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,c)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,u)||Utils_1.Utils.isInArray(DivMode_1.DivMode.repulse,d))&&Repulser_1.Repulser.repulse(r),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,c)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,u))&&Bubbler_1.Bubbler.bubble(r),Utils_1.Utils.isInArray(HoverMode_1.HoverMode.connect,c)&&Connector_1.Connector.connect(r);for(var h=0,p=this.array;h<p.length;h++){n=p[h];this.interactionsEnabled&&InteractionManager_1.InteractionManager.interact(n,r)}},e.prototype.draw=function(e){var r=this.container;r.canvas.clear();var t=this.container.canvas.size;this.quadTree=new QuadTree_1.QuadTree(new QuadTree_1.Rectangle(0,0,t.width,t.height),4),this.update(e),this.noiseZ+=4e-4;for(var i=0,n=r.plugins;i<n.length;i++){var a=n[i];void 0!==a.draw&&a.draw()}for(var o=0,s=r.absorbers;o<s.length;o++){s[o].draw()}for(var l=0,c=this.array;l<c.length;l++){c[l].draw()}},e.prototype.clear=function(){this.array=[]},e.prototype.push=function(e,r){var t,i,n=this.container,a=n.options;this.pushing=!0,0<a.particles.number.limit&&this.array.length+e>a.particles.number.limit&&this.removeQuantity(this.array.length+e-a.particles.number.limit),r&&(i=null!==(t=r.position)&&void 0!==t?t:{x:0,y:0});for(var o=0;o<e;o++)this.addParticle(new Particle_1.Particle(n,i));a.particles.move.enable||this.container.play(),this.pushing=!1},e.prototype.addParticle=function(e){this.array.push(e)},e.prototype.removeQuantity=function(e){var r=this.container.options;this.removeAt(0,e),r.particles.move.enable||this.container.play()},e}();exports.Particles=Particles;