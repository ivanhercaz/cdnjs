import{Particle}from"./Particle";export class Emitter{constructor(t,i,s){var e,o,n;this.container=t,this.initialPosition=s,this.emitterOptions=i,this.position=null!==(e=this.initialPosition)&&void 0!==e?e:this.calcPosition(),this.size=null!==(o=this.emitterOptions.size)&&void 0!==o?o:{height:0,width:0},this.lifeCount=null!==(n=this.emitterOptions.life.count)&&void 0!==n?n:-1,this.start()}emit(){const t=this.container,i={x:this.position.x,y:this.position.y},s=t.canvas.dimension.height*this.size.width/100,e=t.canvas.dimension.height*this.size.height/100;i.x+=s*(Math.random()-.5),i.y+=e*(Math.random()-.5);const o=new Particle(t,i,this);for(let i=0;i<this.emitterOptions.rate.quantity;i++)t.particles.addParticle(o)}start(){(this.lifeCount>0||!this.emitterOptions.life.count)&&(void 0===this.startInterval&&(this.startInterval=setInterval(()=>{this.emit()},1e3*this.emitterOptions.rate.delay)),this.lifeCount>0&&this.prepareToDie())}stop(){const t=this.startInterval;void 0!==t&&(clearInterval(t),delete this.startInterval)}resize(){var t;this.position=null!==(t=this.initialPosition)&&void 0!==t?t:this.calcPosition()}prepareToDie(){var t;this.lifeCount>0&&void 0!==(null===(t=this.emitterOptions.life)||void 0===t?void 0:t.duration)&&setTimeout(()=>{var t;this.stop(),this.lifeCount--,this.lifeCount>0?(this.position=this.calcPosition(),setTimeout(()=>{this.start()},null!==(t=this.emitterOptions.life.delay)&&void 0!==t?t:0)):this.destroy()},1e3*this.emitterOptions.life.duration)}destroy(){const t=this.container,i=t.emitters.indexOf(this);i>=0&&t.emitters.splice(i,1)}calcPosition(){var t;const i=this.container,s=null!==(t=this.emitterOptions.position)&&void 0!==t?t:{x:100*Math.random(),y:100*Math.random()};return{x:s.x/100*i.canvas.dimension.width,y:s.y/100*i.canvas.dimension.height}}};