import{Particle}from"./Particle";import{PolygonMaskType}from"../Enums/PolygonMaskType";import{PolygonMaskInlineArrangement}from"../Enums/PolygonMaskInlineArrangement";import{InteractionManager}from"./Particle/InteractionManager";import{SpatialGrid}from"./Utils/SpatialGrid";export class Particles{constructor(t){this.container=t,this.array=[],this.interactionsEnabled=!1,this.spatialGrid=new SpatialGrid(this.container.canvas.dimension)}get count(){return this.array.length}init(){const t=this.container,n=t.options;if(!n.polygon.enable||n.polygon.type!==PolygonMaskType.inline||n.polygon.inline.arrangement!==PolygonMaskInlineArrangement.onePerPoint&&n.polygon.inline.arrangement!==PolygonMaskInlineArrangement.perPoint)for(let i=this.array.length;i<n.particles.number.value;i++)this.addParticle(new Particle(t));else t.polygon.drawPointsOnPolygonPath();this.interactionsEnabled=n.particles.lineLinked.enable||n.particles.move.attract.enable||n.particles.move.collisions}redraw(){this.clear(),this.init(),this.draw(0)}removeAt(t,n){if(t>=0&&t<=this.count)for(const i of this.array.splice(t,null!=n?n:1))i.destroy()}remove(t){this.removeAt(this.array.indexOf(t))}update(t){for(let n=0;n<this.array.length;n++){const i=this.array[n];i.update(n,t),this.interactionsEnabled&&InteractionManager.interact(i,this.container)}}draw(t){const n=this.container,i=n.options;n.canvas.clear(),this.update(t),this.spatialGrid.setGrid(this.array,this.container.canvas.dimension),i.polygon.enable&&i.polygon.draw.enable&&n.polygon.drawPolygon();for(const t of this.array)t.draw()}clear(){this.array=[]}push(t,n){var i;const a=this.container,e=a.options;let r;this.pushing=!0,e.particles.number.limit>0&&this.array.length+t>e.particles.number.limit&&this.removeQuantity(this.array.length+t-e.particles.number.limit),n&&(r=null!==(i=n.position)&&void 0!==i?i:{x:0,y:0});for(let n=0;n<t;n++)this.addParticle(new Particle(a,r));e.particles.move.enable||this.container.play(),this.pushing=!1}addParticle(t){this.array.push(t)}removeQuantity(t){const n=this.container.options;this.removeAt(0,t),n.particles.move.enable||this.container.play()}};