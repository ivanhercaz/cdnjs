"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ProcessBubbleType_1=require("../../Enums/ProcessBubbleType"),Utils_1=require("../Utils/Utils"),HoverMode_1=require("../../Enums/Modes/HoverMode"),ClickMode_1=require("../../Enums/Modes/ClickMode"),Constants_1=require("../Utils/Constants"),ColorUtils_1=require("../Utils/ColorUtils"),Bubbler=function(){function s(e,i){this.container=e,this.particle=i}return s.reset=function(e){delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color},s.prototype.bubble=function(){var e=this.container.options,i=e.interactivity.events.onHover.enable,t=e.interactivity.events.onHover.mode,b=e.interactivity.events.onClick.enable,o=e.interactivity.events.onClick.mode;i&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,t)?this.hoverBubble():b&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,o)&&this.clickBubble()},s.prototype.process=function(e,i,t){var b=t.bubbleObj.optValue;if(void 0!==b){var o=this.container,s=this.particle,l=o.options.interactivity.modes.bubble.duration,r=o.retina.bubbleModeDistance,a=t.particlesObj.optValue,u=t.bubbleObj.value,n=t.particlesObj.value||0,c=t.type;if(b!==a)if(o.bubble.durationEnd)u&&(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete s.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete s.bubble.opacity);else if(e<=r){if((null!=u?u:n)!==b){var p=n-i*(n-b)/l;c===ProcessBubbleType_1.ProcessBubbleType.size&&(s.bubble.radius=p),c===ProcessBubbleType_1.ProcessBubbleType.opacity&&(s.bubble.opacity=p)}}else c===ProcessBubbleType_1.ProcessBubbleType.size&&delete s.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete s.bubble.opacity}},s.prototype.clickBubble=function(){var e,i=this.container,t=i.options,b=this.particle,o=i.interactivity.mouse.clickPosition||{x:0,y:0},s=Utils_1.Utils.getDistanceBetweenCoordinates(b.position,o),l=((new Date).getTime()-(i.interactivity.mouse.clickTime||0))/1e3;if(i.bubble.clicking){l>t.interactivity.modes.bubble.duration&&(i.bubble.durationEnd=!0),l>2*t.interactivity.modes.bubble.duration&&(i.bubble.clicking=!1,i.bubble.durationEnd=!1);var r={bubbleObj:{optValue:i.retina.bubbleModeSize,value:b.bubble.radius},particlesObj:{optValue:null!==(e=b.sizeValue)&&void 0!==e?e:i.retina.sizeValue,value:b.size.value},type:ProcessBubbleType_1.ProcessBubbleType.size};this.process(s,l,r);var a={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:b.bubble.opacity},particlesObj:{optValue:b.particlesOptions.opacity.value,value:b.opacity.value},type:ProcessBubbleType_1.ProcessBubbleType.opacity};this.process(s,l,a),!i.bubble.durationEnd&&s<=i.retina.bubbleModeDistance?this.hoverBubbleColor():delete b.bubble.color}},s.prototype.hoverBubble=function(){var e=this.container,i=this.particle,t=e.interactivity.mouse.position||{x:0,y:0},b=Utils_1.Utils.getDistanceBetweenCoordinates(i.position,t),o=1-b/e.retina.bubbleModeDistance;b<=e.retina.bubbleModeDistance?0<=o&&e.interactivity.status===Constants_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(o),this.hoverBubbleOpacity(o),this.hoverBubbleColor()):s.reset(i),e.interactivity.status===Constants_1.Constants.mouseLeaveEvent&&s.reset(i)},s.prototype.hoverBubbleSize=function(e){var i,t,b=this.container,o=b.options,s=this.particle,l=o.interactivity.modes.bubble.size;if(void 0!==l){var r=s.particlesOptions.size.value,a=s.size.value;if(b.retina.bubbleModeSize>(null!==(i=s.sizeValue)&&void 0!==i?i:b.retina.sizeValue))a<(u=a+l*e)&&u<=l&&(s.bubble.radius=u);else if(b.retina.bubbleModeSize<(null!==(t=s.sizeValue)&&void 0!==t?t:b.retina.sizeValue)){var u;(u=a-(r-l)*e)<a&&l<=u&&(s.bubble.radius=u)}}},s.prototype.hoverBubbleOpacity=function(e){var i=this.container.options,t=this.particle,b=i.interactivity.modes.bubble.opacity;if(void 0!==b){var o=t.particlesOptions.opacity.value,s=t.opacity.value;if(o<b)s<(l=s+b*e)&&l<=b&&(t.bubble.opacity=l);else if(b<o){var l;(l=s-(o-b)*e)<s&&b<=l&&(t.bubble.opacity=l)}}},s.prototype.hoverBubbleColor=function(){var e=this.container.options,i=this.particle;if(void 0===i.bubble.color){var t=e.interactivity.modes.bubble.color;if(void 0===t)return;var b=void 0;if(t instanceof Array){var o=Utils_1.Utils.itemFromArray(t);b="string"==typeof o?{value:o}:o}else b="string"==typeof t?{value:t}:t;i.bubble.color=ColorUtils_1.ColorUtils.colorToRgb(b)}},s}();exports.Bubbler=Bubbler;