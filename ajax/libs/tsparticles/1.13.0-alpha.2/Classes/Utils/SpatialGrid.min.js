"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Utils_1=require("./Utils"),SpatialGrid=function(){function t(t){this.grid=[],this.cellSize=5,this.widthSegment=Math.round(t.width/this.cellSize),this.heightSegment=Math.round(t.height/this.cellSize)}return t.prototype.setGrid=function(t,i){for(var e=[],r=null!=i&&i.width?(null==i?void 0:i.width)/this.cellSize:this.widthSegment,h=null!=i&&i.height?(null==i?void 0:i.height)/this.cellSize:this.heightSegment,s=0;s<t.length;s++){var n=this.index(t[s].position);Array.isArray(e[n.x])||(e[n.x]=[]),Array.isArray(e[n.x][n.y])||(e[n.x][n.y]=[]),e[n.x][n.y].push(t[s])}this.widthSegment=r,this.heightSegment=h,this.grid=e},t.prototype.queryInCell=function(t){var i=this.index(t);return Array.isArray(this.grid[i.x])&&Array.isArray(this.grid[i.x][i.y])&&this.grid[i.x][i.y]||[]},t.prototype.queryRadius=function(t,i){for(var e=this.index(t),r=this.radius({x:i,y:i}),h=this.select(this.indexOp(e,"-",r),this.indexOp(e,"+",r)),s=[],n=0;n<h.length;n++)h[n]&&Utils_1.Utils.getDistanceBetweenCoordinates(h[n].position,t)<=i&&(s[s.length+1]=h[n]);return s},t.prototype.queryRadiusWithDist=function(t,i){for(var e=this.index(t),r=this.radius({x:i,y:i}),h=this.select(this.indexOp(e,"-",r),this.indexOp(e,"+",r)),s=[],n=0;n<h.length;n++)if(h[n]){var l=Utils_1.Utils.getDistanceBetweenCoordinates(h[n].position,t);l<=i&&s.push({dist:l,particle:h[n]})}return s},t.prototype.select=function(t,i){for(var e=[],r=t.x;r<=i.x;r++)if(Array.isArray(this.grid[r]))for(var h=t.y;h<=i.y;h++)if(Array.isArray(this.grid[r][h]))for(var s=0;s<this.grid[r][h].length;s++)null!=this.grid[r][h][s]&&(e[e.length+1]=this.grid[r][h][s]);return e},t.prototype.index=function(t){return{x:Math.round(t.x/this.widthSegment),y:Math.round(t.y/this.heightSegment)}},t.prototype.radius=function(t){return{x:Math.ceil(t.x/this.widthSegment),y:Math.ceil(t.y/this.heightSegment)}},t.prototype.indexOp=function(t,i,e){return"+"==i?{x:this.clamp(t.x+e.x),y:this.clamp(t.y+e.y)}:{x:this.clamp(t.x-e.x),y:this.clamp(t.y-e.y)}},t.prototype.clamp=function(t){return Utils_1.Utils.clamp(t,0,this.cellSize)},t}();exports.SpatialGrid=SpatialGrid;