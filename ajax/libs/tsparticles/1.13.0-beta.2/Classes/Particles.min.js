"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Particle_1=require("./Particle"),PolygonMaskType_1=require("../Enums/PolygonMaskType"),PolygonMaskInlineArrangement_1=require("../Enums/PolygonMaskInlineArrangement"),InteractionManager_1=require("./Interactions/Particles/InteractionManager"),SpatialGrid_1=require("./Utils/SpatialGrid"),Utils_1=require("./Utils/Utils"),HoverMode_1=require("../Enums/Modes/HoverMode"),Grabber_1=require("./Interactions/Mouse/Grabber"),ClickMode_1=require("../Enums/Modes/ClickMode"),Repulser_1=require("./Interactions/Mouse/Repulser"),DivMode_1=require("../Enums/Modes/DivMode"),Bubbler_1=require("./Interactions/Mouse/Bubbler"),Connecter_1=require("./Interactions/Mouse/Connecter"),Particles=function(){function e(e){this.container=e,this.array=[],this.interactionsEnabled=!1,this.spatialGrid=new SpatialGrid_1.SpatialGrid(this.container.canvas.dimension)}return Object.defineProperty(e.prototype,"count",{get:function(){return this.array.length},enumerable:!0,configurable:!0}),e.prototype.init=function(){var e=this.container,r=e.options;if(!r.polygon.enable||r.polygon.type!==PolygonMaskType_1.PolygonMaskType.inline||r.polygon.inline.arrangement!==PolygonMaskInlineArrangement_1.PolygonMaskInlineArrangement.onePerPoint&&r.polygon.inline.arrangement!==PolygonMaskInlineArrangement_1.PolygonMaskInlineArrangement.perPoint)for(var t=this.array.length;t<r.particles.number.value;t++)this.addParticle(new Particle_1.Particle(e));else e.polygon.drawPointsOnPolygonPath();this.interactionsEnabled=r.particles.lineLinked.enable||r.particles.move.attract.enable||r.particles.move.collisions},e.prototype.redraw=function(){this.clear(),this.init(),this.draw(0)},e.prototype.removeAt=function(e,r){if(0<=e&&e<=this.count)for(var t=0,i=this.array.splice(e,null!=r?r:1);t<i.length;t++){i[t].destroy()}},e.prototype.remove=function(e){this.removeAt(this.array.indexOf(e))},e.prototype.update=function(e){for(var r=this.container,t=r.options,i=0;i<this.array.length;i++){var n=this.array[i];Bubbler_1.Bubbler.reset(n),n.update(i,e)}var o=t.interactivity.events.onHover.mode,a=t.interactivity.events.onClick.mode,s=t.interactivity.events.onDiv.mode;Utils_1.Utils.isInArray(HoverMode_1.HoverMode.grab,o)&&Grabber_1.Grabber.grab(r),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,o)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,a)||Utils_1.Utils.isInArray(DivMode_1.DivMode.repulse,s))&&Repulser_1.Repulser.repulse(r),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,o)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,a))&&Bubbler_1.Bubbler.bubble(r),Utils_1.Utils.isInArray(HoverMode_1.HoverMode.connect,o)&&Connecter_1.Connecter.connect(r);for(var l=0,c=this.array;l<c.length;l++){n=c[l];this.interactionsEnabled&&InteractionManager_1.InteractionManager.interact(n,r)}},e.prototype.draw=function(e){var r=this.container,t=r.options;r.canvas.clear(),this.update(e),this.spatialGrid.setGrid(this.array,this.container.canvas.dimension),t.polygon.enable&&t.polygon.draw.enable&&r.polygon.drawPolygon();for(var i=0,n=this.array;i<n.length;i++){n[i].draw()}},e.prototype.clear=function(){this.array=[]},e.prototype.push=function(e,r){var t,i,n=this.container,o=n.options;this.pushing=!0,0<o.particles.number.limit&&this.array.length+e>o.particles.number.limit&&this.removeQuantity(this.array.length+e-o.particles.number.limit),r&&(i=null!==(t=r.position)&&void 0!==t?t:{x:0,y:0});for(var a=0;a<e;a++)this.addParticle(new Particle_1.Particle(n,i));o.particles.move.enable||this.container.play(),this.pushing=!1},e.prototype.addParticle=function(e){this.array.push(e)},e.prototype.removeQuantity=function(e){var r=this.container.options;this.removeAt(0,e),r.particles.move.enable||this.container.play()},e}();exports.Particles=Particles;