"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var OutMode_1=require("../../Enums/OutMode"),Utils_1=require("../Utils/Utils"),PolygonMaskType_1=require("../../Enums/PolygonMaskType"),Mover_1=require("./Mover"),RotateDirection_1=require("../../Enums/RotateDirection"),SizeAnimationStatus_1=require("../../Enums/SizeAnimationStatus"),OpacityAnimationStatus_1=require("../../Enums/OpacityAnimationStatus"),Updater=function(){function c(t,i){this.container=t,this.particle=i,this.mover=new Mover_1.Mover(t,i)}return c.checkBounds=function(t,i,e,o,a){(e<t+i&&0<o||t-i<0&&o<0)&&a()},c.prototype.update=function(t){this.mover.move(t),this.updateOpacity(),this.updateSize(),this.updateAngle(),this.fixOutOfCanvasPosition(),this.updateOutMode()},c.prototype.updateOpacity=function(){var t=this.particle;if(t.particlesOptions.opacity.animation.enable){switch(t.opacity.status){case OpacityAnimationStatus_1.OpacityAnimationStatus.increasing:t.opacity.value>=t.particlesOptions.opacity.value?t.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.decreasing:t.opacity.value+=t.opacity.velocity||0;break;case OpacityAnimationStatus_1.OpacityAnimationStatus.decreasing:t.opacity.value<=t.particlesOptions.opacity.animation.minimumValue?t.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.increasing:t.opacity.value-=t.opacity.velocity||0}t.opacity.value<0&&(t.opacity.value=0)}},c.prototype.updateSize=function(){var t,i=this.container,e=this.particle;if(e.particlesOptions.size.animation.enable){switch(e.size.status){case SizeAnimationStatus_1.SizeAnimationStatus.increasing:e.size.value>=(null!==(t=e.sizeValue)&&void 0!==t?t:i.retina.sizeValue)?e.size.status=SizeAnimationStatus_1.SizeAnimationStatus.decreasing:e.size.value+=e.size.velocity||0;break;case SizeAnimationStatus_1.SizeAnimationStatus.decreasing:e.size.value<=e.particlesOptions.size.animation.minimumValue?e.size.status=SizeAnimationStatus_1.SizeAnimationStatus.increasing:e.size.value-=e.size.velocity||0}e.size.value<0&&(e.size.value=0)}},c.prototype.updateAngle=function(){var t=this.particle;if(t.particlesOptions.rotate.animation.enable)switch(t.rotateDirection){case RotateDirection_1.RotateDirection.clockwise:t.angle+=t.particlesOptions.rotate.animation.speed*Math.PI/18,360<t.angle&&(t.angle-=360);break;case RotateDirection_1.RotateDirection.counterClockwise:default:t.angle-=t.particlesOptions.rotate.animation.speed*Math.PI/18,t.angle<0&&(t.angle+=360)}},c.prototype.fixOutOfCanvasPosition=function(){var t,i=this.container,e=this.particle,o=e.particlesOptions.move.outMode,a=i.canvas.size;if(t=o===OutMode_1.OutMode.bounce?{bottom:a.height,left:e.size.value,right:a.width,top:e.size.value}:o===OutMode_1.OutMode.bounceHorizontal?{bottom:a.height+e.size.value-e.offset.y,left:e.size.value,right:a.width,top:-e.size.value-e.offset.y}:o===OutMode_1.OutMode.bounceVertical?{bottom:a.height,left:-e.size.value-e.offset.x,right:a.width+e.size.value+e.offset.x,top:e.size.value}:{bottom:a.height+e.size.value-e.offset.y,left:-e.size.value-e.offset.x,right:a.width+e.size.value+e.offset.x,top:-e.size.value-e.offset.y},o===OutMode_1.OutMode.destroy){var n=e.size.value;Utils_1.Utils.isPointInside(e.position,i.canvas.size,n)||i.particles.remove(e)}else{n=e.size.value;var s=Utils_1.Utils.calculateBounds(e.position,n);s.left>a.width-e.offset.x?(e.position.x=t.left,e.position.y=Math.random()*a.height):s.right<-e.offset.x&&(e.position.x=t.right,e.position.y=Math.random()*a.height),s.top>a.height-e.offset.y?(e.position.x=Math.random()*a.width,e.position.y=t.top):s.bottom<-e.offset.y&&(e.position.x=Math.random()*a.width,e.position.y=t.bottom)}},c.prototype.updateOutMode=function(){switch(this.particle.particlesOptions.move.outMode){case OutMode_1.OutMode.bounce:case OutMode_1.OutMode.bounceVertical:case OutMode_1.OutMode.bounceHorizontal:this.updateBounce()}},c.prototype.updateBounce=function(){var t=this.container,i=t.options,e=this.particle;if(i.polygon.enable&&i.polygon.type!==PolygonMaskType_1.PolygonMaskType.none&&i.polygon.type!==PolygonMaskType_1.PolygonMaskType.inline)t.polygon.checkInsidePolygon(e.position)||this.polygonBounce();else if(i.polygon.enable&&i.polygon.type===PolygonMaskType_1.PolygonMaskType.inline){if(e.initialPosition)Utils_1.Utils.getDistanceBetweenCoordinates(e.initialPosition,e.position)>t.retina.polygonMaskMoveRadius&&this.polygonBounce()}else{var o=e.particlesOptions.move.outMode,a=e.position.x+e.offset.x,n=e.position.y+e.offset.y;if(o===OutMode_1.OutMode.bounce||o===OutMode_1.OutMode.bounceHorizontal){var s=e.size.value,u=e.velocity.horizontal;c.checkBounds(a,s,t.canvas.size.width,u,function(){e.velocity.horizontal*=-1})}if(o===OutMode_1.OutMode.bounce||o===OutMode_1.OutMode.bounceVertical){s=e.size.value,u=e.velocity.vertical;c.checkBounds(n,s,t.canvas.size.height,u,function(){e.velocity.vertical*=-1})}}},c.prototype.polygonBounce=function(){var t=this.particle;t.velocity.horizontal=-t.velocity.horizontal+t.velocity.vertical/2,t.velocity.vertical=-t.velocity.vertical+t.velocity.horizontal/2},c}();exports.Updater=Updater;