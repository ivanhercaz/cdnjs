"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ShapeUtils = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _ShapeType = require("../../Enums/ShapeType");

var ShapeUtils = /*#__PURE__*/function () {
  function ShapeUtils() {
    (0, _classCallCheck2["default"])(this, ShapeUtils);
  }

  (0, _createClass2["default"])(ShapeUtils, null, [{
    key: "drawShape",
    value: function drawShape(context, particle, radius, stroke) {
      var pos = {
        x: particle.offset.x,
        y: particle.offset.y
      };
      var sides = particle.container.options.particles.shape.polygon.sides;

      switch (particle.shape) {
        case _ShapeType.ShapeType.line:
          this.drawLineShape(context, radius, stroke);
          break;

        case _ShapeType.ShapeType.circle:
          this.drawCircleShape(context, radius, pos);
          break;

        case _ShapeType.ShapeType.edge:
        case _ShapeType.ShapeType.square:
          this.drawSquareShape(context, radius);
          break;

        case _ShapeType.ShapeType.triangle:
          this.drawTriangleShape(context, radius);
          break;

        case _ShapeType.ShapeType.polygon:
          this.drawPolygonShape(context, radius, sides);
          break;

        case _ShapeType.ShapeType.star:
          this.drawStarShape(context, radius, sides);
          break;

        case _ShapeType.ShapeType.heart:
          this.drawHeartShape(context, radius);
          break;

        case _ShapeType.ShapeType["char"]:
        case _ShapeType.ShapeType.character:
          var style = particle.container.options.particles.shape.character.style;
          var weight = particle.container.options.particles.shape.character.weight;
          var size = Math.round(radius) * 2;
          var font = particle.container.options.particles.shape.character.font;
          var text = particle.text;
          var fill = particle.container.options.particles.shape.character.fill;
          context.font = "".concat(style, " ").concat(weight, " ").concat(size, "px ").concat(font);
          this.drawTextShape(context, text, radius, fill);
          break;

        case _ShapeType.ShapeType.image:
          this.drawImageShape(context, particle, radius);
          break;
      }
    }
  }, {
    key: "drawTriangleShape",
    value: function drawTriangleShape(context, radius) {
      var start = {
        x: -radius,
        y: radius / 1.66
      };
      var side = {
        count: {
          denominator: 2,
          numerator: 3
        },
        length: radius * 2
      };
      this.drawGenericPolygonShape(context, start, side);
    }
  }, {
    key: "drawPolygonShape",
    value: function drawPolygonShape(context, radius, sides) {
      var start = {
        x: -radius / (sides / 3.5),
        y: -radius / (2.66 / 3.5)
      };
      var side = {
        count: {
          denominator: 1,
          numerator: sides
        },
        length: radius * 2.66 / (sides / 3)
      };
      this.drawGenericPolygonShape(context, start, side);
    }
  }, {
    key: "drawStarShape",
    value: function drawStarShape(context, radius, sides) {
      var start = {
        x: -radius * 2 / (sides / 4),
        y: -radius / (2 * 2.66 / 3.5)
      };
      var side = {
        count: {
          denominator: 2,
          numerator: sides
        },
        length: radius * 2 * 2.66 / (sides / 3)
      };
      this.drawGenericPolygonShape(context, start, side);
    }
  }, {
    key: "drawLineShape",
    value: function drawLineShape(context, length, stroke) {
      context.moveTo(0, -length / 2);
      context.lineTo(0, length / 2);
      context.strokeStyle = stroke.color;
      context.lineWidth = stroke.width;
      context.stroke();
    }
  }, {
    key: "drawCircleShape",
    value: function drawCircleShape(context, radius, center) {
      context.arc(center.x, center.y, radius, 0, Math.PI * 2, false);
    }
  }, {
    key: "drawSquareShape",
    value: function drawSquareShape(context, side) {
      context.rect(-side, -side, side * 2, side * 2);
    }
  }, {
    key: "drawHeartShape",
    value: function drawHeartShape(context, radius) {
      var x = -radius / 2;
      var y = -radius / 2;
      context.moveTo(x, y + radius / 4);
      context.quadraticCurveTo(x, y, x + radius / 4, y);
      context.quadraticCurveTo(x + radius / 2, y, x + radius / 2, y + radius / 4);
      context.quadraticCurveTo(x + radius / 2, y, x + radius * 3 / 4, y);
      context.quadraticCurveTo(x + radius, y, x + radius, y + radius / 4);
      context.quadraticCurveTo(x + radius, y + radius / 2, x + radius * 3 / 4, y + radius * 3 / 4);
      context.lineTo(x + radius / 2, y + radius);
      context.lineTo(x + radius / 4, y + radius * 3 / 4);
      context.quadraticCurveTo(x, y + radius / 2, x, y + radius / 4);
    }
  }, {
    key: "drawTextShape",
    value: function drawTextShape(context, text, radius, fill) {
      if (text === undefined) {
        return;
      }

      var pos = {
        x: -radius / 2,
        y: radius / 2
      };

      if (fill) {
        context.fillText(text, pos.x, pos.y);
      } else {
        context.strokeText(text, pos.x, pos.y);
      }
    }
  }, {
    key: "drawGenericPolygonShape",
    value: function drawGenericPolygonShape(context, start, side) {
      // By Programming Thomas - https://programmingthomas.wordpress.com/2013/04/03/n-sided-shapes/
      var sideCount = side.count.numerator * side.count.denominator;
      var decimalSides = side.count.numerator / side.count.denominator;
      var interiorAngleDegrees = 180 * (decimalSides - 2) / decimalSides;
      var interiorAngle = Math.PI - Math.PI * interiorAngleDegrees / 180; // convert to radians

      if (!context) {
        return;
      }

      context.save();
      context.beginPath();
      context.translate(start.x, start.y);
      context.moveTo(0, 0);

      for (var i = 0; i < sideCount; i++) {
        context.lineTo(side.length, 0);
        context.translate(side.length, 0);
        context.rotate(interiorAngle);
      } // c.stroke();


      context.fill();
      context.restore();
    }
  }, {
    key: "drawImageShape",
    value: function drawImageShape(context, particle, radius) {
      var _particle$image;

      if (!context) {
        return;
      }

      var imgObj = (_particle$image = particle.image) === null || _particle$image === void 0 ? void 0 : _particle$image.data.obj;

      if (!imgObj) {
        return;
      }

      var ratio = 1;

      if (particle.image) {
        ratio = particle.image.ratio;
      }

      var pos = {
        x: -radius,
        y: -radius
      };
      context.drawImage(imgObj, pos.x, pos.y, radius * 2, radius * 2 / ratio);
    }
  }]);
  return ShapeUtils;
}();

exports.ShapeUtils = ShapeUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9DbGFzc2VzL1V0aWxzL1NoYXBlVXRpbHMudHMiXSwibmFtZXMiOlsiU2hhcGVVdGlscyIsImNvbnRleHQiLCJwYXJ0aWNsZSIsInJhZGl1cyIsInN0cm9rZSIsInBvcyIsIngiLCJvZmZzZXQiLCJ5Iiwic2lkZXMiLCJjb250YWluZXIiLCJvcHRpb25zIiwicGFydGljbGVzIiwic2hhcGUiLCJwb2x5Z29uIiwiU2hhcGVUeXBlIiwibGluZSIsImRyYXdMaW5lU2hhcGUiLCJjaXJjbGUiLCJkcmF3Q2lyY2xlU2hhcGUiLCJlZGdlIiwic3F1YXJlIiwiZHJhd1NxdWFyZVNoYXBlIiwidHJpYW5nbGUiLCJkcmF3VHJpYW5nbGVTaGFwZSIsImRyYXdQb2x5Z29uU2hhcGUiLCJzdGFyIiwiZHJhd1N0YXJTaGFwZSIsImhlYXJ0IiwiZHJhd0hlYXJ0U2hhcGUiLCJjaGFyYWN0ZXIiLCJzdHlsZSIsIndlaWdodCIsInNpemUiLCJNYXRoIiwicm91bmQiLCJmb250IiwidGV4dCIsImZpbGwiLCJkcmF3VGV4dFNoYXBlIiwiaW1hZ2UiLCJkcmF3SW1hZ2VTaGFwZSIsInN0YXJ0Iiwic2lkZSIsImNvdW50IiwiZGVub21pbmF0b3IiLCJudW1lcmF0b3IiLCJsZW5ndGgiLCJkcmF3R2VuZXJpY1BvbHlnb25TaGFwZSIsIm1vdmVUbyIsImxpbmVUbyIsInN0cm9rZVN0eWxlIiwiY29sb3IiLCJsaW5lV2lkdGgiLCJ3aWR0aCIsImNlbnRlciIsImFyYyIsIlBJIiwicmVjdCIsInF1YWRyYXRpY0N1cnZlVG8iLCJ1bmRlZmluZWQiLCJmaWxsVGV4dCIsInN0cm9rZVRleHQiLCJzaWRlQ291bnQiLCJkZWNpbWFsU2lkZXMiLCJpbnRlcmlvckFuZ2xlRGVncmVlcyIsImludGVyaW9yQW5nbGUiLCJzYXZlIiwiYmVnaW5QYXRoIiwidHJhbnNsYXRlIiwiaSIsInJvdGF0ZSIsInJlc3RvcmUiLCJpbWdPYmoiLCJkYXRhIiwib2JqIiwicmF0aW8iLCJkcmF3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T0FBTCxFQUFjO0FBQ1Y7QUFDSDs7QUFFRCxVQUFNd0UsTUFBTSxzQkFBR3ZFLFFBQVEsQ0FBQ3NDLEtBQVosb0RBQUcsZ0JBQWdCa0MsSUFBaEIsQ0FBcUJDLEdBQXBDOztBQUVBLFVBQUksQ0FBQ0YsTUFBTCxFQUFhO0FBQ1Q7QUFDSDs7QUFFRCxVQUFJRyxLQUFLLEdBQUcsQ0FBWjs7QUFFQSxVQUFJMUUsUUFBUSxDQUFDc0MsS0FBYixFQUFvQjtBQUNoQm9DLFFBQUFBLEtBQUssR0FBRzFFLFFBQVEsQ0FBQ3NDLEtBQVQsQ0FBZW9DLEtBQXZCO0FBQ0g7O0FBRUQsVUFBTXZFLEdBQUcsR0FBRztBQUNSQyxRQUFBQSxDQUFDLEVBQUUsQ0FBQ0gsTUFESTtBQUVSSyxRQUFBQSxDQUFDLEVBQUUsQ0FBQ0w7QUFGSSxPQUFaO0FBS0FGLE1BQUFBLE9BQU8sQ0FBQzRFLFNBQVIsQ0FBa0JKLE1BQWxCLEVBQTBCcEUsR0FBRyxDQUFDQyxDQUE5QixFQUFpQ0QsR0FBRyxDQUFDRyxDQUFyQyxFQUF3Q0wsTUFBTSxHQUFHLENBQWpELEVBQW9EQSxNQUFNLEdBQUcsQ0FBVCxHQUFheUUsS0FBakU7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UGFydGljbGV9IGZyb20gXCIuLi9QYXJ0aWNsZVwiO1xuaW1wb3J0IHtJU3Ryb2tlfSBmcm9tIFwiLi4vLi4vSW50ZXJmYWNlcy9PcHRpb25zL1BhcnRpY2xlcy9TaGFwZS9JU3Ryb2tlXCI7XG5pbXBvcnQge1NoYXBlVHlwZX0gZnJvbSBcIi4uLy4uL0VudW1zL1NoYXBlVHlwZVwiO1xuaW1wb3J0IHtJQ29vcmRpbmF0ZXN9IGZyb20gXCIuLi8uLi9JbnRlcmZhY2VzL0lDb29yZGluYXRlc1wiO1xuaW1wb3J0IHtJU2lkZX0gZnJvbSBcIi4uLy4uL0ludGVyZmFjZXMvSVNpZGVcIjtcblxuZXhwb3J0IGNsYXNzIFNoYXBlVXRpbHMge1xuICAgIHB1YmxpYyBzdGF0aWMgZHJhd1NoYXBlKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZTogUGFydGljbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBJU3Ryb2tlKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHBvcyA9IHtcbiAgICAgICAgICAgIHg6IHBhcnRpY2xlLm9mZnNldC54LFxuICAgICAgICAgICAgeTogcGFydGljbGUub2Zmc2V0LnksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgc2lkZXMgPSBwYXJ0aWNsZS5jb250YWluZXIub3B0aW9ucy5wYXJ0aWNsZXMuc2hhcGUucG9seWdvbi5zaWRlcztcblxuICAgICAgICBzd2l0Y2ggKHBhcnRpY2xlLnNoYXBlKSB7XG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5saW5lOlxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd0xpbmVTaGFwZShjb250ZXh0LCByYWRpdXMsIHN0cm9rZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLmNpcmNsZTpcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdDaXJjbGVTaGFwZShjb250ZXh0LCByYWRpdXMsIHBvcyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLmVkZ2U6XG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5zcXVhcmU6XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3U3F1YXJlU2hhcGUoY29udGV4dCwgcmFkaXVzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUudHJpYW5nbGU6XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3VHJpYW5nbGVTaGFwZShjb250ZXh0LCByYWRpdXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5wb2x5Z29uOlxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd1BvbHlnb25TaGFwZShjb250ZXh0LCByYWRpdXMsIHNpZGVzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuc3RhcjpcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdTdGFyU2hhcGUoY29udGV4dCwgcmFkaXVzLCBzaWRlcyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLmhlYXJ0OlxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd0hlYXJ0U2hhcGUoY29udGV4dCwgcmFkaXVzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuY2hhcjpcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLmNoYXJhY3RlcjpcbiAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IHBhcnRpY2xlLmNvbnRhaW5lci5vcHRpb25zLnBhcnRpY2xlcy5zaGFwZS5jaGFyYWN0ZXIuc3R5bGU7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2VpZ2h0ID0gcGFydGljbGUuY29udGFpbmVyLm9wdGlvbnMucGFydGljbGVzLnNoYXBlLmNoYXJhY3Rlci53ZWlnaHQ7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IE1hdGgucm91bmQocmFkaXVzKSAqIDI7XG4gICAgICAgICAgICAgICAgY29uc3QgZm9udCA9IHBhcnRpY2xlLmNvbnRhaW5lci5vcHRpb25zLnBhcnRpY2xlcy5zaGFwZS5jaGFyYWN0ZXIuZm9udDtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gcGFydGljbGUudGV4dDtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxsID0gcGFydGljbGUuY29udGFpbmVyLm9wdGlvbnMucGFydGljbGVzLnNoYXBlLmNoYXJhY3Rlci5maWxsO1xuXG4gICAgICAgICAgICAgICAgY29udGV4dC5mb250ID0gYCR7c3R5bGV9ICR7d2VpZ2h0fSAke3NpemV9cHggJHtmb250fWA7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdUZXh0U2hhcGUoY29udGV4dCwgdGV4dCwgcmFkaXVzLCBmaWxsKTtcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5pbWFnZTpcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdJbWFnZVNoYXBlKGNvbnRleHQsIHBhcnRpY2xlLCByYWRpdXMpO1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBkcmF3VHJpYW5nbGVTaGFwZShjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHJhZGl1czogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHN0YXJ0OiBJQ29vcmRpbmF0ZXMgPSB7XG4gICAgICAgICAgICB4OiAtcmFkaXVzLFxuICAgICAgICAgICAgeTogcmFkaXVzIC8gMS42NixcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzaWRlOiBJU2lkZSA9IHtcbiAgICAgICAgICAgIGNvdW50OiB7XG4gICAgICAgICAgICAgICAgZGVub21pbmF0b3I6IDIsXG4gICAgICAgICAgICAgICAgbnVtZXJhdG9yOiAzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlbmd0aDogcmFkaXVzICogMixcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmRyYXdHZW5lcmljUG9seWdvblNoYXBlKGNvbnRleHQsIHN0YXJ0LCBzaWRlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBkcmF3UG9seWdvblNoYXBlKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcmFkaXVzOiBudW1iZXIsIHNpZGVzOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc3RhcnQ6IElDb29yZGluYXRlcyA9IHtcbiAgICAgICAgICAgIHg6IC1yYWRpdXMgLyAoc2lkZXMgLyAzLjUpLFxuICAgICAgICAgICAgeTogLXJhZGl1cyAvICgyLjY2IC8gMy41KSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc2lkZTogSVNpZGUgPSB7XG4gICAgICAgICAgICBjb3VudDoge1xuICAgICAgICAgICAgICAgIGRlbm9taW5hdG9yOiAxLFxuICAgICAgICAgICAgICAgIG51bWVyYXRvcjogc2lkZXMsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGVuZ3RoOiByYWRpdXMgKiAyLjY2IC8gKHNpZGVzIC8gMyksXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5kcmF3R2VuZXJpY1BvbHlnb25TaGFwZShjb250ZXh0LCBzdGFydCwgc2lkZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd1N0YXJTaGFwZShjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHJhZGl1czogbnVtYmVyLCBzaWRlczogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHN0YXJ0OiBJQ29vcmRpbmF0ZXMgPSB7XG4gICAgICAgICAgICB4OiAtcmFkaXVzICogMiAvIChzaWRlcyAvIDQpLFxuICAgICAgICAgICAgeTogLXJhZGl1cyAvICgyICogMi42NiAvIDMuNSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNpZGU6IElTaWRlID0ge1xuICAgICAgICAgICAgY291bnQ6IHtcbiAgICAgICAgICAgICAgICBkZW5vbWluYXRvcjogMixcbiAgICAgICAgICAgICAgICBudW1lcmF0b3I6IHNpZGVzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlbmd0aDogcmFkaXVzICogMiAqIDIuNjYgLyAoc2lkZXMgLyAzKSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmRyYXdHZW5lcmljUG9seWdvblNoYXBlKGNvbnRleHQsIHN0YXJ0LCBzaWRlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBkcmF3TGluZVNoYXBlKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgbGVuZ3RoOiBudW1iZXIsIHN0cm9rZTogSVN0cm9rZSk6IHZvaWQge1xuICAgICAgICBjb250ZXh0Lm1vdmVUbygwLCAtbGVuZ3RoIC8gMik7XG4gICAgICAgIGNvbnRleHQubGluZVRvKDAsIGxlbmd0aCAvIDIpO1xuICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gc3Ryb2tlLmNvbG9yO1xuICAgICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IHN0cm9rZS53aWR0aDtcbiAgICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBkcmF3Q2lyY2xlU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCByYWRpdXM6IG51bWJlciwgY2VudGVyOiBJQ29vcmRpbmF0ZXMpOiB2b2lkIHtcbiAgICAgICAgY29udGV4dC5hcmMoY2VudGVyLngsIGNlbnRlci55LCByYWRpdXMsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd1NxdWFyZVNoYXBlKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgc2lkZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnRleHQucmVjdCgtc2lkZSwgLXNpZGUsIHNpZGUgKiAyLCBzaWRlICogMik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0hlYXJ0U2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCByYWRpdXM6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB4ID0gLXJhZGl1cyAvIDI7XG4gICAgICAgIGNvbnN0IHkgPSAtcmFkaXVzIC8gMjtcblxuICAgICAgICBjb250ZXh0Lm1vdmVUbyh4LCB5ICsgcmFkaXVzIC8gNCk7XG4gICAgICAgIGNvbnRleHQucXVhZHJhdGljQ3VydmVUbyh4LCB5LCB4ICsgcmFkaXVzIC8gNCwgeSk7XG4gICAgICAgIGNvbnRleHQucXVhZHJhdGljQ3VydmVUbyh4ICsgcmFkaXVzIC8gMiwgeSwgeCArIHJhZGl1cyAvIDIsIHkgKyByYWRpdXMgLyA0KTtcbiAgICAgICAgY29udGV4dC5xdWFkcmF0aWNDdXJ2ZVRvKHggKyByYWRpdXMgLyAyLCB5LCB4ICsgcmFkaXVzICogMyAvIDQsIHkpO1xuICAgICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8oeCArIHJhZGl1cywgeSwgeCArIHJhZGl1cywgeSArIHJhZGl1cyAvIDQpO1xuICAgICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8oeCArIHJhZGl1cywgeSArIHJhZGl1cyAvIDIsIHggKyByYWRpdXMgKiAzIC8gNCwgeSArIHJhZGl1cyAqIDMgLyA0KTtcbiAgICAgICAgY29udGV4dC5saW5lVG8oeCArIHJhZGl1cyAvIDIsIHkgKyByYWRpdXMpO1xuICAgICAgICBjb250ZXh0LmxpbmVUbyh4ICsgcmFkaXVzIC8gNCwgeSArIHJhZGl1cyAqIDMgLyA0KTtcbiAgICAgICAgY29udGV4dC5xdWFkcmF0aWNDdXJ2ZVRvKHgsIHkgKyByYWRpdXMgLyAyLCB4LCB5ICsgcmFkaXVzIC8gNCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd1RleHRTaGFwZShjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpdXM6IG51bWJlciwgZmlsbDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBpZiAodGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3MgPSB7XG4gICAgICAgICAgICB4OiAtcmFkaXVzIC8gMixcbiAgICAgICAgICAgIHk6IHJhZGl1cyAvIDIsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGZpbGwpIHtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFRleHQodGV4dCwgcG9zLngsIHBvcy55KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlVGV4dCh0ZXh0LCBwb3MueCwgcG9zLnkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0dlbmVyaWNQb2x5Z29uU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBzdGFydDogSUNvb3JkaW5hdGVzLCBzaWRlOiBJU2lkZSk6IHZvaWQge1xuICAgICAgICAvLyBCeSBQcm9ncmFtbWluZyBUaG9tYXMgLSBodHRwczovL3Byb2dyYW1taW5ndGhvbWFzLndvcmRwcmVzcy5jb20vMjAxMy8wNC8wMy9uLXNpZGVkLXNoYXBlcy9cbiAgICAgICAgY29uc3Qgc2lkZUNvdW50ID0gc2lkZS5jb3VudC5udW1lcmF0b3IgKiBzaWRlLmNvdW50LmRlbm9taW5hdG9yO1xuICAgICAgICBjb25zdCBkZWNpbWFsU2lkZXMgPSBzaWRlLmNvdW50Lm51bWVyYXRvciAvIHNpZGUuY291bnQuZGVub21pbmF0b3I7XG4gICAgICAgIGNvbnN0IGludGVyaW9yQW5nbGVEZWdyZWVzID0gKDE4MCAqIChkZWNpbWFsU2lkZXMgLSAyKSkgLyBkZWNpbWFsU2lkZXM7XG4gICAgICAgIGNvbnN0IGludGVyaW9yQW5nbGUgPSBNYXRoLlBJIC0gTWF0aC5QSSAqIGludGVyaW9yQW5nbGVEZWdyZWVzIC8gMTgwOyAvLyBjb252ZXJ0IHRvIHJhZGlhbnNcblxuICAgICAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQuc2F2ZSgpO1xuICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZShzdGFydC54LCBzdGFydC55KTtcbiAgICAgICAgY29udGV4dC5tb3ZlVG8oMCwgMCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaWRlQ291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29udGV4dC5saW5lVG8oc2lkZS5sZW5ndGgsIDApO1xuICAgICAgICAgICAgY29udGV4dC50cmFuc2xhdGUoc2lkZS5sZW5ndGgsIDApO1xuICAgICAgICAgICAgY29udGV4dC5yb3RhdGUoaW50ZXJpb3JBbmdsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjLnN0cm9rZSgpO1xuICAgICAgICBjb250ZXh0LmZpbGwoKTtcbiAgICAgICAgY29udGV4dC5yZXN0b3JlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0ltYWdlU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBwYXJ0aWNsZTogUGFydGljbGUsIHJhZGl1czogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaW1nT2JqID0gcGFydGljbGUuaW1hZ2U/LmRhdGEub2JqO1xuXG4gICAgICAgIGlmICghaW1nT2JqKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmF0aW8gPSAxO1xuXG4gICAgICAgIGlmIChwYXJ0aWNsZS5pbWFnZSkge1xuICAgICAgICAgICAgcmF0aW8gPSBwYXJ0aWNsZS5pbWFnZS5yYXRpbztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvcyA9IHtcbiAgICAgICAgICAgIHg6IC1yYWRpdXMsXG4gICAgICAgICAgICB5OiAtcmFkaXVzLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltZ09iaiwgcG9zLngsIHBvcy55LCByYWRpdXMgKiAyLCByYWRpdXMgKiAyIC8gcmF0aW8pO1xuICAgIH1cbn1cbiJdfQ==