"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ProcessBubbleType_1=require("../../../../Enums/ProcessBubbleType"),Utils_1=require("../../../../Utils/Utils"),HoverMode_1=require("../../../../Enums/Modes/HoverMode"),ClickMode_1=require("../../../../Enums/Modes/ClickMode"),Constants_1=require("../../../../Utils/Constants"),ColorUtils_1=require("../../../../Utils/ColorUtils"),QuadTree_1=require("../../../../Utils/QuadTree"),Bubbler=function(){function e(){}return e.reset=function(e){delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color},e.bubble=function(e,i){var t=e.options,b=t.interactivity.events.onHover.enable,o=t.interactivity.events.onHover.mode,l=t.interactivity.events.onClick.enable,s=t.interactivity.events.onClick.mode;b&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,o)?this.hoverBubble(e):l&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,s)&&this.clickBubble(e)},e.process=function(e,i,t,b,o){var l=o.bubbleObj.optValue;if(void 0!==l){var s=e.options.interactivity.modes.bubble.duration,r=e.retina.bubbleModeDistance,u=o.particlesObj.optValue,a=o.bubbleObj.value,n=o.particlesObj.value||0,c=o.type;if(l!==u)if(e.bubble.durationEnd)a&&(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete i.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete i.bubble.opacity);else if(t<=r){if((null!=a?a:n)!==l){var v=n-b*(n-l)/s;c===ProcessBubbleType_1.ProcessBubbleType.size&&(i.bubble.radius=v),c===ProcessBubbleType_1.ProcessBubbleType.opacity&&(i.bubble.opacity=v)}}else c===ProcessBubbleType_1.ProcessBubbleType.size&&delete i.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete i.bubble.opacity}},e.clickBubble=function(e){var i,t=e.options,b=e.interactivity.mouse.clickPosition;if(void 0!==b)for(var o=e.retina.bubbleModeDistance,l=0,s=e.particles.quadTree.query(new QuadTree_1.Circle(b.x,b.y,o));l<s.length;l++){var r=s[l],u={x:r.position.x+r.offset.x,y:r.position.y+r.offset.y},a=Utils_1.Utils.getDistanceBetweenCoordinates(u,b),n=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;if(e.bubble.clicking){n>t.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),n>2*t.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1);var c={bubbleObj:{optValue:e.retina.bubbleModeSize,value:r.bubble.radius},particlesObj:{optValue:null!==(i=r.sizeValue)&&void 0!==i?i:e.retina.sizeValue,value:r.size.value},type:ProcessBubbleType_1.ProcessBubbleType.size};this.process(e,r,a,n,c);var v={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:r.bubble.opacity},particlesObj:{optValue:r.particlesOptions.opacity.value,value:r.opacity.value},type:ProcessBubbleType_1.ProcessBubbleType.opacity};this.process(e,r,a,n,v),!e.bubble.durationEnd&&a<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,r):delete r.bubble.color}}},e.hoverBubble=function(e){var i=e.interactivity.mouse.position;if(void 0!==i)for(var t=e.retina.bubbleModeDistance,b=0,o=e.particles.quadTree.query(new QuadTree_1.Circle(i.x,i.y,t));b<o.length;b++){var l=o[b],s={x:l.position.x+l.offset.x,y:l.position.y+l.offset.y},r=Utils_1.Utils.getDistanceBetweenCoordinates(s,i),u=1-r/e.retina.bubbleModeDistance;r<=e.retina.bubbleModeDistance?0<=u&&e.interactivity.status===Constants_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,l,u),this.hoverBubbleOpacity(e,l,u),this.hoverBubbleColor(e,l)):this.reset(l),e.interactivity.status===Constants_1.Constants.mouseLeaveEvent&&this.reset(l)}},e.hoverBubbleSize=function(e,i,t){var b,o=e.retina.bubbleModeSize;if(void 0!==o){var l=null!==(b=i.sizeValue)&&void 0!==b?b:e.retina.sizeValue,s=i.size.value,r=this.calculateBubbleValue(s,o,l,t);void 0!==r&&(i.bubble.radius=r)}},e.hoverBubbleOpacity=function(e,i,t){var b=e.options.interactivity.modes.bubble.opacity;if(void 0!==b){var o=i.particlesOptions.opacity.value,l=i.opacity.value,s=this.calculateBubbleValue(l,b,o,t);void 0!==s&&(i.bubble.opacity=s)}},e.calculateBubbleValue=function(e,i,t,b){if(t<i){var o=e+(i-t)*b;return Utils_1.Utils.clamp(o,e,i)}if(i<t){o=e-(t-i)*b;return Utils_1.Utils.clamp(o,i,e)}},e.hoverBubbleColor=function(e,i){var t=e.options;if(void 0===i.bubble.color){var b=t.interactivity.modes.bubble.color;if(void 0===b)return;i.bubble.color=ColorUtils_1.ColorUtils.colorToRgb(b instanceof Array?Utils_1.Utils.itemFromArray(b):b)}},e}();exports.Bubbler=Bubbler;