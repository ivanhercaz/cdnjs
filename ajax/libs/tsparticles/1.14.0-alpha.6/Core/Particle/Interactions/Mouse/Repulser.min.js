"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClickMode_1=require("../../../../Enums/Modes/ClickMode"),HoverMode_1=require("../../../../Enums/Modes/HoverMode"),OutMode_1=require("../../../../Enums/OutMode"),Utils_1=require("../../../../Utils/Utils"),DivMode_1=require("../../../../Enums/Modes/DivMode"),Constants_1=require("../../../../Utils/Constants"),QuadTree_1=require("../../../../Utils/QuadTree"),Repulser=function(){function e(){}return e.repulse=function(e,i){var t=e.options.interactivity,o=t.events.onHover.enable,s=t.events.onClick.enable,r=e.interactivity.status===Constants_1.Constants.mouseMoveEvent,n=t.events.onHover.mode,l=t.events.onClick.mode,u=t.events.onDiv.mode;r&&o&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,n)?this.hoverRepulse(e):s&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,l)?this.clickRepulse(e):t.events.onDiv.enable&&Utils_1.Utils.isInArray(DivMode_1.DivMode.repulse,u)&&this.divRepulse(e)},e.divRepulse=function(e){var i=e.options,t=document.getElementById(i.interactivity.events.onDiv.elementId);if(t){var o={x:t.offsetLeft+t.offsetWidth/2,y:t.offsetTop+t.offsetHeight/2},s=t.offsetWidth/2;e.retina.isRetina&&(o.x*=e.retina.pixelRatio,o.y*=e.retina.pixelRatio,s*=e.retina.pixelRatio);var r=s;this.processRepulse(e,o,r)}},e.hoverRepulse=function(e){var i=e.interactivity.mouse.position;if(i){var t=e.retina.repulseModeDistance;this.processRepulse(e,i,t)}},e.processRepulse=function(e,i,t){for(var o=0,s=e.particles.quadTree.query(new QuadTree_1.Circle(i.x,i.y,t));o<s.length;o++){var r=s[o],n=r.position.x-i.x,l=r.position.y-i.y,u=Math.sqrt(n*n+l*l),a=n/u,c=l/u,v=100*e.options.interactivity.modes.repulse.speed,p=Utils_1.Utils.clamp((1-Math.pow(u/t,2))*v,0,50),d=r.particlesOptions.move.outMode,M=r.size.value,y={x:r.position.x+a*p,y:r.position.y+c*p};if(d===OutMode_1.OutMode.bounce||d===OutMode_1.OutMode.bounceVertical||d===OutMode_1.OutMode.bounceHorizontal){var h=0<y.x-M&&y.x+M<e.canvas.size.width,f=0<y.y-M&&y.y+M<e.canvas.size.height;d!==OutMode_1.OutMode.bounceVertical&&!h||(r.position.x=y.x),d!==OutMode_1.OutMode.bounceHorizontal&&!f||(r.position.y=y.y)}else r.position.x=y.x,r.position.y=y.y}},e.clickRepulse=function(e){if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){var i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),o=e.interactivity.mouse.clickPosition;if(void 0===o)return;for(var s=0,r=e.particles.quadTree.query(new QuadTree_1.Circle(o.x,o.y,t));s<r.length;s++){if(void 0!==(null==(p=r[s])?void 0:p.position)){var n=o.x-p.position.x,l=o.y-p.position.y,u=n*n+l*l,a=-t*e.options.interactivity.modes.repulse.speed/u;u<=t&&(e.repulse.particles.push(p),this.processClickRepulse(e,p,n,l,a))}}}else if(!1===e.repulse.clicking){for(var c=0,v=e.repulse.particles;c<v.length;c++){var p;(p=v[c]).velocity.horizontal=p.initialVelocity.horizontal,p.velocity.vertical=p.initialVelocity.vertical}e.repulse.particles=[]}},e.processClickRepulse=function(e,i,t,o,s){var r=e.options,n=Math.atan2(o,t);i.velocity.horizontal=s*Math.cos(n),i.velocity.vertical=s*Math.sin(n);var l=r.particles.move.outMode;if(l===OutMode_1.OutMode.bounce||l===OutMode_1.OutMode.bounceHorizontal||l===OutMode_1.OutMode.bounceVertical){var u=i.position.x+i.velocity.horizontal,a=i.position.y+i.velocity.vertical;l!==OutMode_1.OutMode.bounceVertical&&(u+i.size.value>e.canvas.size.width||u-i.size.value<0)&&(i.velocity.horizontal=-i.velocity.horizontal),l!==OutMode_1.OutMode.bounceHorizontal&&(a+i.size.value>e.canvas.size.height||a-i.size.value<0)&&(i.velocity.vertical=-i.velocity.vertical)}},e}();exports.Repulser=Repulser;