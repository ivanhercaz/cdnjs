"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Particle_1=require("../Core/Particle"),Utils_1=require("../Utils/Utils"),SizeMode_1=require("../Enums/SizeMode"),EmitterSize_1=require("../Options/Classes/Emitters/EmitterSize"),Emitter=function(){function i(i,t,e){var s,o,n;this.emitters=i,this.container=i.container,this.initialPosition=e,this.emitterOptions=Utils_1.Utils.deepExtend({},t),this.position=null!==(s=this.initialPosition)&&void 0!==s?s:this.calcPosition();var r,a=Utils_1.Utils.deepExtend({},this.emitterOptions.particles);void 0===a&&(a={}),void 0===a.move&&(a.move={}),void 0===a.move.direction&&(a.move.direction=this.emitterOptions.direction),this.particlesOptions=a,this.size=null!==(o=this.emitterOptions.size)&&void 0!==o?o:((r=new EmitterSize_1.EmitterSize).load({height:0,width:0,mode:SizeMode_1.SizeMode.percent}),r),this.lifeCount=null!==(n=this.emitterOptions.life.count)&&void 0!==n?n:-1,this.play()}return i.prototype.play=function(){var i=this;(0<this.lifeCount||!this.emitterOptions.life.count)&&(void 0===this.startInterval&&(this.startInterval=window.setInterval(function(){i.emit()},1e3*this.emitterOptions.rate.delay)),0<this.lifeCount&&this.prepareToDie())},i.prototype.pause=function(){var i=this.startInterval;void 0!==i&&(clearInterval(i),delete this.startInterval)},i.prototype.resize=function(){var i=this.initialPosition;this.position=i&&Utils_1.Utils.isPointInside(i,this.container.canvas.size)?i:this.calcPosition()},i.prototype.prepareToDie=function(){var i,t=this;0<this.lifeCount&&void 0!==(null===(i=this.emitterOptions.life)||void 0===i?void 0:i.duration)&&window.setTimeout(function(){var i;t.pause(),t.lifeCount--,0<t.lifeCount?(t.position=t.calcPosition(),window.setTimeout(function(){t.play()},null!==(i=t.emitterOptions.life.delay)&&void 0!==i?i:0)):t.destroy()},1e3*this.emitterOptions.life.duration)},i.prototype.destroy=function(){var i=this.emitters.array.indexOf(this);0<=i&&this.emitters.array.splice(i,1)},i.prototype.calcPosition=function(){var i,t=this.container,e=null!==(i=this.emitterOptions.position)&&void 0!==i?i:{x:100*Math.random(),y:100*Math.random()};return{x:e.x/100*t.canvas.size.width,y:e.y/100*t.canvas.size.height}},i.prototype.emit=function(){for(var i=this.container,t=this.position,e=this.size.mode===SizeMode_1.SizeMode.percent?i.canvas.size.width*this.size.width/100:this.size.width,s=this.size.mode===SizeMode_1.SizeMode.percent?i.canvas.size.height*this.size.height/100:this.size.height,o=0;o<this.emitterOptions.rate.quantity;o++){var n=new Particle_1.Particle(i,{x:t.x+e*(Math.random()-.5),y:t.y+s*(Math.random()-.5)},this.particlesOptions);i.particles.addParticle(n)}},i}();exports.Emitter=Emitter;