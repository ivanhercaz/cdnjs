"use strict";var __awaiter=this&&this.__awaiter||function(t,a,o,h){return new(o=o||Promise)(function(i,e){function s(t){try{n(h.next(t))}catch(t){e(t)}}function r(t){try{n(h.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?i(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(s,r)}n((h=h.apply(t,a||[])).next())})},__generator=this&&this.__generator||function(i,s){var r,n,a,t,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&e[0]?n.return:e[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,e[1])).done)return a;switch(n=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,n=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){o.label=e[1];break}if(6===e[0]&&o.label<a[1]){o.label=a[1],a=e;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(e);break}a[2]&&o.ops.pop(),o.trys.pop();continue}e=s.call(i,o)}catch(t){e=[6,t],n=0}finally{r=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(exports,"__esModule",{value:!0});var Canvas_1=require("./Canvas"),EventListeners_1=require("./Utils/EventListeners"),Particles_1=require("./Particles"),Retina_1=require("./Retina"),ShapeType_1=require("../Enums/ShapeType"),PolygonMask_1=require("./PolygonMask"),FrameManager_1=require("./FrameManager"),Options_1=require("./Options/Options"),Utils_1=require("./Utils/Utils"),Presets_1=require("./Utils/Presets"),Emitter_1=require("./Emitter"),Absorber_1=require("./Absorber"),Container=function(){function s(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];this.started=!1,this.destroyed=!1,this.id=t,this.paused=!0,this.sourceOptions=e,this.lastFrameTime=0,this.pageHidden=!1,this.retina=new Retina_1.Retina(this),this.canvas=new Canvas_1.Canvas(this),this.particles=new Particles_1.Particles(this),this.polygon=new PolygonMask_1.PolygonMask(this),this.drawer=new FrameManager_1.FrameManager(this),this.interactivity={mouse:{}},this.images=[],this.bubble={},this.repulse={particles:[]},this.emitters=[],this.absorbers=[],this.options=new Options_1.Options;for(var r=0,n=i;r<n.length;r++){var a=n[r];this.options.load(Presets_1.Presets.getPreset(a))}this.sourceOptions&&this.options.load(this.sourceOptions),this.eventListeners=new EventListeners_1.EventListeners(this)}return s.requestFrame=function(t){return window.customRequestAnimationFrame(t)},s.cancelAnimation=function(t){window.cancelAnimationFrame(t)},s.prototype.play=function(){var e=this;if(this.paused){this.lastFrameTime=performance.now(),this.paused=!1;for(var t=0,i=this.emitters;t<i.length;t++){i[t].start()}}this.drawAnimationFrame=s.requestFrame(function(t){return e.drawer.nextFrame(t)})},s.prototype.pause=function(){if(void 0!==this.drawAnimationFrame){for(var t=0,e=this.emitters;t<e.length;t++){e[t].stop()}this.emitters=[],this.absorbers=[],s.cancelAnimation(this.drawAnimationFrame),delete this.drawAnimationFrame,this.paused=!0}},s.prototype.densityAutoParticles=function(){if(this.canvas.element&&this.options.particles.number.density.enable){var t=this.canvas.element.width*this.canvas.element.height/1e3;this.retina.isRetina&&(t/=2*this.retina.pixelRatio);var e=t*this.options.particles.number.value/this.options.particles.number.density.area,i=this.particles.count;i<e?this.particles.push(Math.abs(e-i)):e<i&&this.particles.removeQuantity(i-e)}},s.prototype.destroy=function(){this.stop(),this.retina.reset(),this.canvas.destroy(),delete this.interactivity,delete this.options,delete this.retina,delete this.canvas,delete this.particles,delete this.polygon,delete this.bubble,delete this.repulse,delete this.images,delete this.drawer,delete this.eventListeners,this.destroyed=!0},s.prototype.exportImg=function(t){this.exportImage(t)},s.prototype.exportImage=function(t,e,i){var s;return null===(s=this.canvas.element)||void 0===s?void 0:s.toBlob(t,null!=e?e:"image/png",i)},s.prototype.exportConfiguration=function(){return JSON.stringify(this.options,void 0,2)},s.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.stop(),[4,this.start()];case 1:return t.sent(),[2]}})})},s.prototype.stop=function(){if(this.started){this.started=!1,this.eventListeners.removeListeners(),this.pause(),this.images=[],this.particles.clear(),this.retina.reset(),this.canvas.clear(),this.polygon.reset();for(var t=0,e=this.emitters;t<e.length;t++){e[t].stop()}this.emitters=[],delete this.particles.lineLinkedColor}},s.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){var e,i,s,r,n,a;return __generator(this,function(t){switch(t.label){case 0:return this.started?[2]:(this.started=!0,this.eventListeners.addListeners(),[4,this.polygon.init()]);case 1:if(t.sent(),!Utils_1.Utils.isInArray(ShapeType_1.ShapeType.char,this.options.particles.shape.type)&&!Utils_1.Utils.isInArray(ShapeType_1.ShapeType.character,this.options.particles.shape.type))return[3,8];if(!(this.options.particles.shape.character instanceof Array))return[3,6];e=0,i=this.options.particles.shape.character,t.label=2;case 2:return e<i.length?(s=i[e],[4,Utils_1.Utils.loadFont(s)]):[3,5];case 3:t.sent(),t.label=4;case 4:return e++,[3,2];case 5:return[3,8];case 6:return void 0===(s=this.options.particles.shape.character)?[3,8]:[4,Utils_1.Utils.loadFont(s)];case 7:t.sent(),t.label=8;case 8:if(!Utils_1.Utils.isInArray(ShapeType_1.ShapeType.image,this.options.particles.shape.type))return[3,15];if(!(this.options.particles.shape.image instanceof Array))return[3,13];r=0,n=this.options.particles.shape.image,t.label=9;case 9:return r<n.length?(a=n[r],[4,this.loadImageShape(a)]):[3,12];case 10:t.sent(),t.label=11;case 11:return r++,[3,9];case 12:return[3,15];case 13:return[4,this.loadImageShape(this.options.particles.shape.image)];case 14:t.sent(),t.label=15;case 15:return this.init(),this.play(),[2]}})})},s.prototype.loadImageShape=function(s){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),i=(e=this.images).push,[4,Utils_1.Utils.loadImage(s)];case 1:return i.apply(e,[t.sent()]),[3,3];case 2:return t.sent(),[3,3];case 3:return[2]}})})},s.prototype.init=function(){if(this.retina.init(),this.canvas.init(),this.particles.init(),this.options.emitters instanceof Array)for(var t=0,e=this.options.emitters;t<e.length;t++){var i=e[t],s=new Emitter_1.Emitter(this,i);this.emitters.push(s)}else{i=this.options.emitters,s=new Emitter_1.Emitter(this,i);this.emitters.push(s)}if(this.options.absorbers instanceof Array)for(var r=0,n=this.options.absorbers;r<n.length;r++){var a=n[r],o=new Absorber_1.Absorber(this,a);this.absorbers.push(o)}else{a=this.options.absorbers,o=new Absorber_1.Absorber(this,a);this.absorbers.push(o)}this.densityAutoParticles()},s}();exports.Container=Container;