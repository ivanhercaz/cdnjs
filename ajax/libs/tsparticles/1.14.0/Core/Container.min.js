"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),Canvas_1=require("./Canvas"),EventListeners_1=require("../Utils/EventListeners"),Particles_1=require("./Particles"),Retina_1=require("./Retina"),FrameManager_1=require("./FrameManager"),Options_1=require("../Options/Classes/Options"),Plugins_1=require("../Utils/Plugins"),SimplexNoise_1=require("../Utils/SimplexNoise"),Container=function(){function e(t,i){for(var e=[],s=2;s<arguments.length;s++)e[s-2]=arguments[s];this.started=!1,this.destroyed=!1,this.id=t,this.paused=!0,this.sourceOptions=i,this.lastFrameTime=0,this.pageHidden=!1,this.retina=new Retina_1.Retina(this),this.canvas=new Canvas_1.Canvas(this),this.particles=new Particles_1.Particles(this),this.drawer=new FrameManager_1.FrameManager(this),this.interactivity={mouse:{}},this.bubble={},this.repulse={particles:[]},this.plugins={},this.drawers={},this.density=1,this.options=new Options_1.Options;for(var n=0,r=e;n<r.length;n++){var a=r[n];this.options.load(Plugins_1.Plugins.getPreset(a))}for(var o=0,h=Plugins_1.Plugins.getSupportedShapes();o<h.length;o++){var l=h[o];this.drawers[l]=Plugins_1.Plugins.getShapeDrawer(l)}this.sourceOptions&&this.options.load(this.sourceOptions),this.simplex=new SimplexNoise_1.SimplexNoise,this.eventListeners=new EventListeners_1.EventListeners(this)}return e.requestFrame=function(t){return window.customRequestAnimationFrame(t)},e.cancelAnimation=function(t){window.cancelAnimationFrame(t)},e.prototype.play=function(t){var i=this.paused||t;if(this.paused&&(this.paused=!1),i){for(var e in this.plugins){var s=this.plugins[e];s.play&&s.play()}this.lastFrameTime=performance.now()}this.draw()},e.prototype.pause=function(){if(void 0!==this.drawAnimationFrame&&(e.cancelAnimation(this.drawAnimationFrame),delete this.drawAnimationFrame),!this.paused){for(var t in this.plugins){var i=this.plugins[t];i.pause&&i.pause()}this.pageHidden||(this.paused=!0)}},e.prototype.draw=function(){var i=this;this.drawAnimationFrame=e.requestFrame(function(t){return i.drawer.nextFrame(t)})},e.prototype.getAnimationStatus=function(){return!this.paused},e.prototype.densityAutoParticles=function(){this.initDensityFactor();var t=this.options.particles.number,i=t.value,e=0<t.limit?t.limit:i,s=Math.min(i,e)*this.density,n=this.particles.count;n<s?this.particles.push(Math.abs(s-n)):s<n&&this.particles.removeQuantity(n-s)},e.prototype.initDensityFactor=function(){var t,i,e=this.options.particles.number.density;this.canvas.element&&e.enable&&(t=this.canvas.element,i=this.retina.pixelRatio,this.density=t.width*t.height/(e.factor*i*e.area))},e.prototype.destroy=function(){for(var t in this.stop(),this.retina.reset(),this.canvas.destroy(),delete this.interactivity,delete this.options,delete this.retina,delete this.canvas,delete this.particles,delete this.bubble,delete this.repulse,delete this.drawer,delete this.eventListeners,this.drawers){var i=this.drawers[t];void 0!==i.destroy&&i.destroy(this)}this.drawers={},this.destroyed=!0},e.prototype.exportImg=function(t){this.exportImage(t)},e.prototype.exportImage=function(t,i,e){var s;return null===(s=this.canvas.element)||void 0===s?void 0:s.toBlob(t,null!=i?i:"image/png",e)},e.prototype.exportConfiguration=function(){return JSON.stringify(this.options,void 0,2)},e.prototype.refresh=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(t){switch(t.label){case 0:return this.stop(),[4,this.start()];case 1:return t.sent(),[2]}})})},e.prototype.stop=function(){if(this.started){for(var t in this.started=!1,this.eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.retina.reset(),this.canvas.clear(),this.plugins){var i=this.plugins[t];void 0!==i.stop&&i.stop()}this.plugins={},delete this.particles.lineLinkedColor}},e.prototype.start=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var i,e,s,n,r,a,o,h,l,u,p;return tslib_1.__generator(this,function(t){switch(t.label){case 0:if(this.started)return[2];for(r in i=Plugins_1.Plugins.getAvailablePlugins(this))this.plugins[r]=i[r];for(s in this.started=!0,this.eventListeners.addListeners(),e=[],this.plugins)e.push(s);n=0,t.label=1;case 1:return n<e.length?(r=e[n],void 0===(a=this.plugins[r]).startAsync?[3,3]:[4,a.startAsync()]):[3,5];case 2:return t.sent(),[3,4];case 3:void 0!==a.start&&a.start(),t.label=4;case 4:return n++,[3,1];case 5:for(h in o=[],this.drawers)o.push(h);l=0,t.label=6;case 6:return l<o.length?(u=o[l],void 0===(p=this.drawers[u]).init?[3,8]:[4,p.init(this)]):[3,9];case 7:t.sent(),t.label=8;case 8:return l++,[3,6];case 9:return this.init(),this.play(),[2]}})})},e.prototype.init=function(){for(var t in this.retina.init(),this.canvas.init(),this.particles.init(),this.densityAutoParticles(),this.plugins){var i=this.plugins[t];void 0!==i.init&&i.init()}},e}();exports.Container=Container;