"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Bubbler_1=require("./Particle/Bubbler"),Grabber_1=require("./Particle/Grabber"),Repulser_1=require("./Particle/Repulser"),ShapeType_1=require("../Enums/ShapeType"),Updater_1=require("./Particle/Updater"),Utils_1=require("./Utils/Utils"),PolygonMaskType_1=require("../Enums/PolygonMaskType"),Connecter_1=require("./Particle/Connecter"),HoverMode_1=require("../Enums/Modes/HoverMode"),ClickMode_1=require("../Enums/Modes/ClickMode"),RotateDirection_1=require("../Enums/RotateDirection"),ColorUtils_1=require("./Utils/ColorUtils"),Particles_1=require("./Options/Particles/Particles"),SizeAnimationStatus_1=require("../Enums/SizeAnimationStatus"),OpacityAnimationStatus_1=require("../Enums/OpacityAnimationStatus"),Particle=function(){function i(i,t,e){var s,o,a,r,l,n,c,h,p,u;this.container=i,this.emitter=e,this.fill=!0,this.close=!0,this.links=[];var d=i.options,y=new Particles_1.Particles;if(y.load(d.particles),void 0!==(null==e?void 0:e.emitterOptions.particles)){var v=e.emitterOptions.particles.shape.type;this.shape=v instanceof Array?Utils_1.Utils.itemFromArray(v):v,(m=e.emitterOptions.particles.shape.options[this.shape])&&(this.shapeData=m instanceof Array?Utils_1.Utils.itemFromArray(m):m,this.fill=null!==(s=this.shapeData.fill)&&void 0!==s?s:this.fill,this.close=null!==(o=this.shapeData.close)&&void 0!==o?o:this.close),y.load(null===(a=this.shapeData)||void 0===a?void 0:a.particles),y.load(e.emitterOptions.particles)}else{var m;v=d.particles.shape.type;this.shape=v instanceof Array?Utils_1.Utils.itemFromArray(v):v,(m=d.particles.shape.options[this.shape])&&(this.shapeData=m instanceof Array?Utils_1.Utils.itemFromArray(m):m,this.fill=null!==(r=this.shapeData.fill)&&void 0!==r?r:this.fill,this.close=null!==(l=this.shapeData.close)&&void 0!==l?l:this.close),y.load(null===(n=this.shapeData)||void 0===n?void 0:n.particles)}this.particlesOptions=y,i.retina.initParticle(this);var _=this.particlesOptions.color,U=null!==(c=this.sizeValue)&&void 0!==c?c:i.retina.sizeValue,b="boolean"==typeof this.particlesOptions.size.random?this.particlesOptions.size.random:this.particlesOptions.size.random.enable;if(this.size={value:b&&void 0!==this.randomMinimumSize?Utils_1.Utils.randomInRange(this.randomMinimumSize,U)*this.container.retina.pixelRatio:U},this.direction=e?e.emitterOptions.direction:this.particlesOptions.move.direction,this.bubble={},this.angle=this.particlesOptions.rotate.random?360*Math.random():this.particlesOptions.rotate.value,this.particlesOptions.rotate.direction==RotateDirection_1.RotateDirection.random){var g=Math.floor(2*Math.random());this.rotateDirection=0<g?RotateDirection_1.RotateDirection.counterClockwise:RotateDirection_1.RotateDirection.clockwise}else this.rotateDirection=this.particlesOptions.rotate.direction;this.particlesOptions.size.animation.enable&&(this.size.status=SizeAnimationStatus_1.SizeAnimationStatus.increasing,this.size.velocity=(null!==(h=this.sizeAnimationSpeed)&&void 0!==h?h:i.retina.sizeAnimationSpeed)/100,this.particlesOptions.size.animation.sync||(this.size.velocity=this.size.velocity*Math.random())),this.particlesOptions.rotate.animation.enable&&(this.particlesOptions.rotate.animation.sync||(this.angle=360*Math.random())),this.position=this.calcPosition(this.container,t),d.polygon.enable&&d.polygon.type===PolygonMaskType_1.PolygonMaskType.inline&&(this.initialPosition={x:this.position.x,y:this.position.y}),this.offset={x:0,y:0},this.particlesOptions.move.collisions&&this.checkOverlap(t),_ instanceof Array?this.color=ColorUtils_1.ColorUtils.colorToRgb(Utils_1.Utils.itemFromArray(_)):this.color=ColorUtils_1.ColorUtils.colorToRgb(_);var f=this.particlesOptions.opacity.random,O=this.particlesOptions.opacity.value;if(this.opacity={value:f.enable?Utils_1.Utils.randomInRange(f.minimumValue,O):O},this.particlesOptions.opacity.animation.enable&&(this.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.increasing,this.opacity.velocity=this.particlesOptions.opacity.animation.speed/100,this.particlesOptions.opacity.animation.sync||(this.opacity.velocity*=Math.random())),this.initialVelocity=this.calculateVelocity(),this.velocity={horizontal:this.initialVelocity.horizontal,vertical:this.initialVelocity.vertical},this.shape===ShapeType_1.ShapeType.image){var M=this.particlesOptions.shape,z=(g=Utils_1.Utils.arrayRandomIndex(i.images),i.images[g]),C=M.image instanceof Array?M.image[g]:M.image;this.image={data:z,ratio:C.width/C.height,replaceColor:C.replaceColor,src:C.src},this.image.ratio||(this.image.ratio=1),this.fill=null!==(p=C.fill)&&void 0!==p?p:this.fill,this.close=null!==(u=C.close)&&void 0!==u?u:this.close}this.stroke=this.particlesOptions.stroke instanceof Array?Utils_1.Utils.itemFromArray(this.particlesOptions.stroke):this.particlesOptions.stroke,this.strokeColor="string"==typeof this.stroke.color?ColorUtils_1.ColorUtils.stringToRgb(this.stroke.color):ColorUtils_1.ColorUtils.colorToRgb(this.stroke.color),this.shadowColor="string"==typeof this.particlesOptions.shadow.color?ColorUtils_1.ColorUtils.stringToRgb(this.particlesOptions.shadow.color):ColorUtils_1.ColorUtils.colorToRgb(this.particlesOptions.shadow.color),this.updater=new Updater_1.Updater(this.container,this),this.bubbler=new Bubbler_1.Bubbler(this.container,this),this.repulser=new Repulser_1.Repulser(this.container,this)}return i.prototype.resetVelocity=function(){var i=this.calculateVelocity();this.velocity.horizontal=i.horizontal,this.velocity.vertical=i.vertical},i.prototype.update=function(i,t){var e=this.container,s=e.options;this.links=[],this.updater.update(t);var o=s.interactivity.events.onHover.mode,a=s.interactivity.events.onClick.mode;if(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.grab,o)&&Grabber_1.Grabber.grab(this,e),Utils_1.Utils.isInArray(HoverMode_1.HoverMode.connect,s.interactivity.events.onHover.mode))for(var r=i+1;r<e.particles.count;r++){var l=e.particles.array[r];Connecter_1.Connecter.connect(this,l,e)}(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,o)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,a))&&this.bubbler.bubble(),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,o)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,a))&&this.repulser.repulse()},i.prototype.draw=function(){this.container.canvas.drawParticle(this)},i.prototype.isOverlapping=function(){for(var i=this.container,t=this,e=!1,s=0,o=0,a=i.particles.array.filter(function(i){return i!=t});o<a.length;o++){var r=a[o];if(s++,Utils_1.Utils.getDistanceBetweenCoordinates(t.position,r.position)<=t.size.value+r.size.value){e=!0;break}}return{collisionFound:e,iterations:s}},i.prototype.checkOverlap=function(i){var t=this.container,e=this,s=e.isOverlapping();s.iterations>=t.particles.count?t.particles.remove(this):s.collisionFound&&(e.position.x=i?i.x:Math.random()*t.canvas.dimension.width,e.position.y=i?i.y:Math.random()*t.canvas.dimension.height,e.checkOverlap())},i.prototype.destroy=function(){},i.prototype.calcPosition=function(i,t){var e,s,o={x:0,y:0};if(i.options.polygon.enable&&0<(null!==(s=null===(e=i.polygon.raw)||void 0===e?void 0:e.length)&&void 0!==s?s:0))if(t)o.x=t.x,o.y=t.y;else{var a=i.polygon.randomPointInPolygon();o.x=a.x,o.y=a.y}else o.x=t?t.x:Math.random()*i.canvas.dimension.width,o.y=t?t.y:Math.random()*i.canvas.dimension.height,o.x>i.canvas.dimension.width-2*this.size.value?o.x-=this.size.value:o.x<2*this.size.value&&(o.x+=this.size.value),o.y>i.canvas.dimension.height-2*this.size.value?o.y-=this.size.value:o.y<2*this.size.value&&(o.y+=this.size.value);return o},i.prototype.calculateVelocity=function(){var i=Utils_1.Utils.getParticleBaseVelocity(this),t={horizontal:0,vertical:0};return this.particlesOptions.move.straight?(t.horizontal=i.x,t.vertical=i.y,this.particlesOptions.move.random&&(t.horizontal*=Math.random(),t.vertical*=Math.random())):(t.horizontal=i.x+Math.random()-.5,t.vertical=i.y+Math.random()-.5),t},i}();exports.Particle=Particle;