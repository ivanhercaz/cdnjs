"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Updater = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _OutMode = require("../../Enums/OutMode");

var _Utils = require("../Utils/Utils");

var _ClickMode = require("../../Enums/Modes/ClickMode");

var _PolygonMaskType = require("../../Enums/PolygonMaskType");

/**
 * Particle updater, it manages movement
 */
var Updater = /*#__PURE__*/function () {
  function Updater(container, particle) {
    (0, _classCallCheck2["default"])(this, Updater);
    this.particle = void 0;
    this.container = void 0;
    this.container = container;
    this.particle = particle;
  }

  (0, _createClass2["default"])(Updater, [{
    key: "update",
    value: function update(delta) {
      /* move the particle */
      this.move(delta);
      /* parallax */

      this.moveParallax();
      /* change opacity status */

      this.updateOpacity();
      /* change size */

      this.updateSize();
      /* change particle position if it is out of canvas */

      this.fixOutOfCanvasPosition();
      /* out of canvas modes */

      this.updateOutMode();
    }
  }, {
    key: "move",
    value: function move(delta) {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;

      if (options.particles.move.enable) {
        var slowFactor = this.getProximitySpeedFactor();
        var deltaFactor = 60 * delta / 1000;
        var moveSpeed = container.retina.moveSpeed / 2 * slowFactor * deltaFactor;
        particle.position.x += particle.velocity.horizontal * moveSpeed;
        particle.position.y += particle.velocity.vertical * moveSpeed;
      }
    }
  }, {
    key: "getProximitySpeedFactor",
    value: function getProximitySpeedFactor() {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;
      var active = options.interactivity.modes.slow.active;

      if (!active) {
        return 1;
      }

      var mousePos = this.container.interactivity.mouse.position;

      if (!mousePos) {
        return 1;
      }

      var particlePos = particle.position;

      var dist = _Utils.Utils.getDistanceBetweenCoordinates(mousePos, particlePos);

      var radius = container.retina.slowModeRadius;

      if (dist > radius) {
        return 1;
      }

      var proximityFactor = dist / radius || 0;
      var slowFactor = options.interactivity.modes.slow.factor;
      return proximityFactor / slowFactor;
    }
  }, {
    key: "moveParallax",
    value: function moveParallax() {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;
      var parallaxForce = options.interactivity.events.onHover.parallax.force;
      var mousePos = container.interactivity.mouse.position || {
        x: 0,
        y: 0
      };
      var windowDimension = {
        height: window.innerHeight / 2,
        width: window.innerWidth / 2
      };
      var parallaxSmooth = options.interactivity.events.onHover.parallax.smooth;

      if (options.interactivity.events.onHover.parallax.enable) {
        /* smaller is the particle, longer is the offset distance */
        var tmp = {
          x: (mousePos.x - windowDimension.width) * (particle.radius / parallaxForce),
          y: (mousePos.y - windowDimension.height) * (particle.radius / parallaxForce)
        };
        particle.offset.x += (tmp.x - particle.offset.x) / parallaxSmooth; // Easing equation

        particle.offset.y += (tmp.y - particle.offset.y) / parallaxSmooth; // Easing equation
      }
    }
  }, {
    key: "updateOpacity",
    value: function updateOpacity() {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;

      if (options.particles.opacity.animation.enable) {
        if (particle.opacity.status) {
          if (particle.opacity.value >= options.particles.opacity.value) {
            particle.opacity.status = false;
          }

          particle.opacity.value += particle.opacity.velocity || 0;
        } else {
          if (particle.opacity.value <= options.particles.opacity.animation.minimumValue) {
            particle.opacity.status = true;
          }

          particle.opacity.value -= particle.opacity.velocity || 0;
        }

        if (particle.opacity.value < 0) {
          particle.opacity.value = 0;
        }
      }
    }
  }, {
    key: "updateSize",
    value: function updateSize() {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;

      if (options.particles.size.animation.enable) {
        if (particle.size.status) {
          if (particle.radius >= container.retina.sizeValue) {
            particle.size.status = false;
          }

          particle.radius += particle.size.velocity || 0;
        } else {
          if (particle.radius <= options.particles.size.animation.minimumValue) {
            particle.size.status = true;
          }

          particle.radius -= particle.size.velocity || 0;
        }

        if (particle.radius < 0) {
          particle.radius = 0;
        }
      }
    }
  }, {
    key: "fixOutOfCanvasPosition",
    value: function fixOutOfCanvasPosition() {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;
      var outMode = options.particles.move.outMode;
      var newPos;

      if (outMode === _OutMode.OutMode.bounce) {
        newPos = {
          x_left: particle.radius,
          x_right: container.canvas.dimension.width,
          y_bottom: container.canvas.dimension.height,
          y_top: particle.radius
        };
      } else if (outMode === _OutMode.OutMode.bounceHorizontal) {
        newPos = {
          x_left: particle.radius,
          x_right: container.canvas.dimension.width,
          y_bottom: container.canvas.dimension.height + particle.radius - particle.offset.y,
          y_top: -particle.radius - particle.offset.y
        };
      } else if (outMode === _OutMode.OutMode.bounceVertical) {
        newPos = {
          x_left: -particle.radius - particle.offset.x,
          x_right: container.canvas.dimension.width + particle.radius + particle.offset.x,
          y_bottom: container.canvas.dimension.height,
          y_top: particle.radius
        };
      } else {
        newPos = {
          x_left: -particle.radius - particle.offset.x,
          x_right: container.canvas.dimension.width + particle.radius + particle.offset.x,
          y_bottom: container.canvas.dimension.height + particle.radius - particle.offset.y,
          y_top: -particle.radius - particle.offset.y
        };
      }

      if (outMode === _OutMode.OutMode.destroy) {
        if (particle.position.x + particle.radius < 0 || particle.position.y + particle.radius < 0 || particle.position.x - particle.radius > container.canvas.dimension.width || particle.position.y - particle.radius > container.canvas.dimension.height) {
          var idx = container.particles.array.indexOf(particle);
          container.particles.array.splice(idx, 1);
          /* remove the canvas if the array is empty */

          var clickMode = options.interactivity.events.onClick.mode;

          if (!container.particles.array.length && !_Utils.Utils.isInArray(_ClickMode.ClickMode.push, clickMode)) {
            container.destroy();
          }
        }
      } else {
        var nextPos = {
          x_left: particle.position.x - particle.radius,
          x_right: particle.position.x + particle.radius,
          y_top: particle.position.y - particle.radius,
          y_bottom: particle.position.y + particle.radius
        };
        var dimension = container.canvas.dimension;

        if (nextPos.x_left > dimension.width - particle.offset.x) {
          particle.position.x = newPos.x_left;
          particle.position.y = Math.random() * dimension.height;
        } else if (nextPos.x_right < -particle.offset.x) {
          particle.position.x = newPos.x_right;
          particle.position.y = Math.random() * dimension.height;
        }

        if (nextPos.y_top > container.canvas.dimension.height - particle.offset.y) {
          particle.position.y = newPos.y_top;
          particle.position.x = Math.random() * container.canvas.dimension.width;
        } else if (nextPos.y_bottom < -particle.offset.y) {
          particle.position.y = newPos.y_bottom;
          particle.position.x = Math.random() * container.canvas.dimension.width;
        }
      }
    }
  }, {
    key: "updateOutMode",
    value: function updateOutMode() {
      var container = this.container;
      var options = container.options;

      switch (options.particles.move.outMode) {
        case _OutMode.OutMode.bounce:
        case _OutMode.OutMode.bounceVertical:
        case _OutMode.OutMode.bounceHorizontal:
          this.updateBounce();
          break;
      }
    }
  }, {
    key: "updateBounce",
    value: function updateBounce() {
      var container = this.container;
      var options = container.options;
      var particle = this.particle;
      /* check bounce against polygon boundaries */

      if (options.polygon.type !== _PolygonMaskType.PolygonMaskType.none && options.polygon.type !== _PolygonMaskType.PolygonMaskType.inline) {
        if (!container.polygon.checkInsidePolygon(particle.position)) {
          this.polygonBounce();
        }
      } else if (options.polygon.type === _PolygonMaskType.PolygonMaskType.inline) {
        if (!particle.initialPosition) {
          particle.initialPosition = {
            x: 0,
            y: 0
          };
        }

        var dist = _Utils.Utils.getDistanceBetweenCoordinates(particle.initialPosition, particle.position);

        if (dist > container.retina.polygonMaskMoveRadius) {
          this.polygonBounce();
        }
      } else {
        var outMode = options.particles.move.outMode;
        var x = particle.position.x + particle.offset.x;
        var y = particle.position.y + particle.offset.y;

        if (outMode === _OutMode.OutMode.bounce || outMode === _OutMode.OutMode.bounceHorizontal) {
          Updater.checkBounds(x, particle.radius, container.canvas.dimension.width, function () {
            particle.velocity.horizontal = -particle.velocity.horizontal;
          });
        }

        if (outMode === _OutMode.OutMode.bounce || outMode === _OutMode.OutMode.bounceVertical) {
          Updater.checkBounds(y, particle.radius, container.canvas.dimension.height, function () {
            particle.velocity.vertical = -particle.velocity.vertical;
          });
        }
      }
    }
  }, {
    key: "polygonBounce",
    value: function polygonBounce() {
      var particle = this.particle;
      particle.velocity.horizontal = -particle.velocity.horizontal + particle.velocity.vertical / 2;
      particle.velocity.vertical = -particle.velocity.vertical + particle.velocity.horizontal / 2;
    }
  }], [{
    key: "checkBounds",
    value: function checkBounds(coordinate, radius, size, outside) {
      if (coordinate + radius > size || coordinate - radius < 0) {
        outside();
      }
    }
  }]);
  return Updater;
}();

exports.Updater = Updater;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9DbGFzc2VzL1BhcnRpY2xlL1VwZGF0ZXIudHMiXSwibmFtZXMiOlsiVXBkYXRlciIsImNvbnRhaW5lciIsInBhcnRpY2xlIiwiZGVsdGEiLCJtb3ZlIiwibW92ZVBhcmFsbGF4IiwidXBkYXRlT3BhY2l0eSIsInVwZGF0ZVNpemUiLCJmaXhPdXRPZkNhbnZhc1Bvc2l0aW9uIiwidXBkYXRlT3V0TW9kZSIsIm9wdGlvbnMiLCJwYXJ0aWNsZXMiLCJlbmFibGUiLCJzbG93RmFjdG9yIiwiZ2V0UHJveGltaXR5U3BlZWRGYWN0b3IiLCJkZWx0YUZhY3RvciIsIm1vdmVTcGVlZCIsInJldGluYSIsInBvc2l0aW9uIiwieCIsInZlbG9jaXR5IiwiaG9yaXpvbnRhbCIsInkiLCJ2ZXJ0aWNhbCIsImFjdGl2ZSIsImludGVyYWN0aXZpdHkiLCJtb2RlcyIsInNsb3ciLCJtb3VzZVBvcyIsIm1vdXNlIiwicGFydGljbGVQb3MiLCJkaXN0IiwiVXRpbHMiLCJnZXREaXN0YW5jZUJldHdlZW5Db29yZGluYXRlcyIsInJhZGl1cyIsInNsb3dNb2RlUmFkaXVzIiwicHJveGltaXR5RmFjdG9yIiwiZmFjdG9yIiwicGFyYWxsYXhGb3JjZSIsImV2ZW50cyIsIm9uSG92ZXIiLCJwYXJhbGxheCIsImZvcmNlIiwid2luZG93RGltZW5zaW9uIiwiaGVpZ2h0Iiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJ3aWR0aCIsImlubmVyV2lkdGgiLCJwYXJhbGxheFNtb290aCIsInNtb290aCIsInRtcCIsIm9mZnNldCIsIm9wYWNpdHkiLCJhbmltYXRpb24iLCJzdGF0dXMiLCJ2YWx1ZSIsIm1pbmltdW1WYWx1ZSIsInNpemUiLCJzaXplVmFsdWUiLCJvdXRNb2RlIiwibmV3UG9zIiwiT3V0TW9kZSIsImJvdW5jZSIsInhfbGVmdCIsInhfcmlnaHQiLCJjYW52YXMiLCJkaW1lbnNpb24iLCJ5X2JvdHRvbSIsInlfdG9wIiwiYm91bmNlSG9yaXpvbnRhbCIsImJvdW5jZVZlcnRpY2FsIiwiZGVzdHJveSIsImlkeCIsImFycmF5IiwiaW5kZXhPZiIsInNwbGljZSIsImNsaWNrTW9kZSIsIm9uQ2xpY2siLCJtb2RlIiwibGVuZ3RoIiwiaXNJbkFycmF5IiwiQ2xpY2tNb2RlIiwicHVzaCIsIm5leHRQb3MiLCJNYXRoIiwicmFuZG9tIiwidXBkYXRlQm91bmNlIiwicG9seWdvbiIsInR5cGUiLCJQb2x5Z29uTWFza1R5cGUiLCJub25lIiwiaW5saW5lIiwiY2hlY2tJbnNpZGVQb2x5Z29uIiwicG9seWdvbkJvdW5jZSIsImluaXRpYWxQb3NpdGlvbiIsInBvbHlnb25NYXNrTW92ZVJhZGl1cyIsImNoZWNrQm91bmRzIiwiY29vcmRpbmF0ZSIsIm91dHNpZGUiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7O0FBR0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRUE7OztJQUdhQSxPO0FBSVQsbUJBQVlDLFNBQVosRUFBa0NDLFFBQWxDLEVBQXNEO0FBQUE7QUFBQSxTQUhyQ0EsUUFHcUM7QUFBQSxTQUZyQ0QsU0FFcUM7QUFDbEQsU0FBS0EsU0FBTCxHQUFpQkEsU0FBakI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCQSxRQUFoQjtBQUNIOzs7OzJCQUVhQyxLLEVBQXFCO0FBQy9CO0FBQ0EsV0FBS0MsSUFBTCxDQUFVRCxLQUFWO0FBRUE7O0FBQ0EsV0FBS0UsWUFBTDtBQUVBOztBQUNBLFdBQUtDLGFBQUw7QUFFQTs7QUFDQSxXQUFLQyxVQUFMO0FBRUE7O0FBQ0EsV0FBS0Msc0JBQUw7QUFFQTs7QUFDQSxXQUFLQyxhQUFMO0FBQ0g7Ozt5QkFFWU4sSyxFQUFxQjtBQUM5QixVQUFNRixTQUFTLEdBQUcsS0FBS0EsU0FBdkI7QUFDQSxVQUFNUyxPQUFPLEdBQUdULFNBQVMsQ0FBQ1MsT0FBMUI7QUFDQSxVQUFNUixRQUFRLEdBQUcsS0FBS0EsUUFBdEI7O0FBRUEsVUFBSVEsT0FBTyxDQUFDQyxTQUFSLENBQWtCUCxJQUFsQixDQUF1QlEsTUFBM0IsRUFBbUM7QUFDL0Is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V0FBUixDQUFvQjNFLENBQXBCLEVBQXVCcEIsUUFBUSxDQUFDZ0MsTUFBaEMsRUFBd0NqQyxTQUFTLENBQUNpRSxNQUFWLENBQWlCQyxTQUFqQixDQUEyQnZCLE1BQW5FLEVBQTJFLFlBQU07QUFDN0UxQyxZQUFBQSxRQUFRLENBQUNrQixRQUFULENBQWtCRyxRQUFsQixHQUE2QixDQUFDckIsUUFBUSxDQUFDa0IsUUFBVCxDQUFrQkcsUUFBaEQ7QUFDSCxXQUZEO0FBR0g7QUFDSjtBQUNKOzs7b0NBUTZCO0FBQzFCLFVBQU1yQixRQUFRLEdBQUcsS0FBS0EsUUFBdEI7QUFFQUEsTUFBQUEsUUFBUSxDQUFDa0IsUUFBVCxDQUFrQkMsVUFBbEIsR0FBK0IsQ0FBQ25CLFFBQVEsQ0FBQ2tCLFFBQVQsQ0FBa0JDLFVBQW5CLEdBQWlDbkIsUUFBUSxDQUFDa0IsUUFBVCxDQUFrQkcsUUFBbEIsR0FBNkIsQ0FBN0Y7QUFDQXJCLE1BQUFBLFFBQVEsQ0FBQ2tCLFFBQVQsQ0FBa0JHLFFBQWxCLEdBQTZCLENBQUNyQixRQUFRLENBQUNrQixRQUFULENBQWtCRyxRQUFuQixHQUErQnJCLFFBQVEsQ0FBQ2tCLFFBQVQsQ0FBa0JDLFVBQWxCLEdBQStCLENBQTNGO0FBQ0g7OztnQ0FYMEI2RSxVLEVBQW9CaEUsTSxFQUFnQndCLEksRUFBY3lDLE8sRUFBMkI7QUFDcEcsVUFBS0QsVUFBVSxHQUFHaEUsTUFBYixHQUFzQndCLElBQXZCLElBQWlDd0MsVUFBVSxHQUFHaEUsTUFBYixHQUFzQixDQUEzRCxFQUErRDtBQUMzRGlFLFFBQUFBLE9BQU87QUFDVjtBQUNKIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7Q29udGFpbmVyfSBmcm9tIFwiLi4vQ29udGFpbmVyXCI7XG5pbXBvcnQge091dE1vZGV9IGZyb20gXCIuLi8uLi9FbnVtcy9PdXRNb2RlXCI7XG5pbXBvcnQge1BhcnRpY2xlfSBmcm9tIFwiLi4vUGFydGljbGVcIjtcbmltcG9ydCB7VXRpbHN9IGZyb20gXCIuLi9VdGlscy9VdGlsc1wiO1xuaW1wb3J0IHtDbGlja01vZGV9IGZyb20gXCIuLi8uLi9FbnVtcy9Nb2Rlcy9DbGlja01vZGVcIjtcbmltcG9ydCB7UG9seWdvbk1hc2tUeXBlfSBmcm9tIFwiLi4vLi4vRW51bXMvUG9seWdvbk1hc2tUeXBlXCI7XG5cbi8qKlxuICogUGFydGljbGUgdXBkYXRlciwgaXQgbWFuYWdlcyBtb3ZlbWVudFxuICovXG5leHBvcnQgY2xhc3MgVXBkYXRlciB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXJ0aWNsZTogUGFydGljbGU7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjb250YWluZXI6IENvbnRhaW5lcjtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcjogQ29udGFpbmVyLCBwYXJ0aWNsZTogUGFydGljbGUpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMucGFydGljbGUgPSBwYXJ0aWNsZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlKGRlbHRhOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgLyogbW92ZSB0aGUgcGFydGljbGUgKi9cbiAgICAgICAgdGhpcy5tb3ZlKGRlbHRhKTtcblxuICAgICAgICAvKiBwYXJhbGxheCAqL1xuICAgICAgICB0aGlzLm1vdmVQYXJhbGxheCgpO1xuXG4gICAgICAgIC8qIGNoYW5nZSBvcGFjaXR5IHN0YXR1cyAqL1xuICAgICAgICB0aGlzLnVwZGF0ZU9wYWNpdHkoKTtcblxuICAgICAgICAvKiBjaGFuZ2Ugc2l6ZSAqL1xuICAgICAgICB0aGlzLnVwZGF0ZVNpemUoKTtcblxuICAgICAgICAvKiBjaGFuZ2UgcGFydGljbGUgcG9zaXRpb24gaWYgaXQgaXMgb3V0IG9mIGNhbnZhcyAqL1xuICAgICAgICB0aGlzLmZpeE91dE9mQ2FudmFzUG9zaXRpb24oKTtcblxuICAgICAgICAvKiBvdXQgb2YgY2FudmFzIG1vZGVzICovXG4gICAgICAgIHRoaXMudXBkYXRlT3V0TW9kZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbW92ZShkZWx0YTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gY29udGFpbmVyLm9wdGlvbnM7XG4gICAgICAgIGNvbnN0IHBhcnRpY2xlID0gdGhpcy5wYXJ0aWNsZTtcblxuICAgICAgICBpZiAob3B0aW9ucy5wYXJ0aWNsZXMubW92ZS5lbmFibGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHNsb3dGYWN0b3IgPSB0aGlzLmdldFByb3hpbWl0eVNwZWVkRmFjdG9yKCk7XG4gICAgICAgICAgICBjb25zdCBkZWx0YUZhY3RvciA9ICg2MCAqIGRlbHRhKSAvIDEwMDA7XG4gICAgICAgICAgICBjb25zdCBtb3ZlU3BlZWQgPSBjb250YWluZXIucmV0aW5hLm1vdmVTcGVlZCAvIDIgKiBzbG93RmFjdG9yICogZGVsdGFGYWN0b3I7XG5cbiAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnggKz0gcGFydGljbGUudmVsb2NpdHkuaG9yaXpvbnRhbCAqIG1vdmVTcGVlZDtcbiAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnkgKz0gcGFydGljbGUudmVsb2NpdHkudmVydGljYWwgKiBtb3ZlU3BlZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFByb3hpbWl0eVNwZWVkRmFjdG9yKCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gY29udGFpbmVyLm9wdGlvbnM7XG4gICAgICAgIGNvbnN0IHBhcnRpY2xlID0gdGhpcy5wYXJ0aWNsZTtcbiAgICAgICAgY29uc3QgYWN0aXZlID0gb3B0aW9ucy5pbnRlcmFjdGl2aXR5Lm1vZGVzLnNsb3cuYWN0aXZlO1xuXG4gICAgICAgIGlmICghYWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1vdXNlUG9zID0gdGhpcy5jb250YWluZXIuaW50ZXJhY3Rpdml0eS5tb3VzZS5wb3NpdGlvbjtcblxuICAgICAgICBpZiAoIW1vdXNlUG9zKSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBhcnRpY2xlUG9zID0gcGFydGljbGUucG9zaXRpb247XG4gICAgICAgIGNvbnN0IGRpc3QgPSBVdGlscy5nZXREaXN0YW5jZUJldHdlZW5Db29yZGluYXRlcyhtb3VzZVBvcywgcGFydGljbGVQb3MpO1xuICAgICAgICBjb25zdCByYWRpdXMgPSBjb250YWluZXIucmV0aW5hLnNsb3dNb2RlUmFkaXVzO1xuXG4gICAgICAgIGlmIChkaXN0ID4gcmFkaXVzKSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHByb3hpbWl0eUZhY3RvciA9IGRpc3QgLyByYWRpdXMgfHwgMDtcbiAgICAgICAgY29uc3Qgc2xvd0ZhY3RvciA9IG9wdGlvbnMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5zbG93LmZhY3RvcjtcblxuICAgICAgICByZXR1cm4gcHJveGltaXR5RmFjdG9yIC8gc2xvd0ZhY3RvcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIG1vdmVQYXJhbGxheCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250YWluZXI7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb250YWluZXIub3B0aW9ucztcbiAgICAgICAgY29uc3QgcGFydGljbGUgPSB0aGlzLnBhcnRpY2xlO1xuICAgICAgICBjb25zdCBwYXJhbGxheEZvcmNlID0gb3B0aW9ucy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbkhvdmVyLnBhcmFsbGF4LmZvcmNlO1xuICAgICAgICBjb25zdCBtb3VzZVBvcyA9IGNvbnRhaW5lci5pbnRlcmFjdGl2aXR5Lm1vdXNlLnBvc2l0aW9uIHx8IHt4OiAwLCB5OiAwfTtcbiAgICAgICAgY29uc3Qgd2luZG93RGltZW5zaW9uID0ge1xuICAgICAgICAgICAgaGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyLFxuICAgICAgICAgICAgd2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoIC8gMixcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcGFyYWxsYXhTbW9vdGggPSBvcHRpb25zLmludGVyYWN0aXZpdHkuZXZlbnRzLm9uSG92ZXIucGFyYWxsYXguc21vb3RoO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmludGVyYWN0aXZpdHkuZXZlbnRzLm9uSG92ZXIucGFyYWxsYXguZW5hYmxlKSB7XG4gICAgICAgICAgICAvKiBzbWFsbGVyIGlzIHRoZSBwYXJ0aWNsZSwgbG9uZ2VyIGlzIHRoZSBvZmZzZXQgZGlzdGFuY2UgKi9cbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IHtcbiAgICAgICAgICAgICAgICB4OiAobW91c2VQb3MueCAtIHdpbmRvd0RpbWVuc2lvbi53aWR0aCkgKiAocGFydGljbGUucmFkaXVzIC8gcGFyYWxsYXhGb3JjZSksXG4gICAgICAgICAgICAgICAgeTogKG1vdXNlUG9zLnkgLSB3aW5kb3dEaW1lbnNpb24uaGVpZ2h0KSAqIChwYXJ0aWNsZS5yYWRpdXMgLyBwYXJhbGxheEZvcmNlKSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHBhcnRpY2xlLm9mZnNldC54ICs9ICh0bXAueCAtIHBhcnRpY2xlLm9mZnNldC54KSAvIHBhcmFsbGF4U21vb3RoOyAvLyBFYXNpbmcgZXF1YXRpb25cbiAgICAgICAgICAgIHBhcnRpY2xlLm9mZnNldC55ICs9ICh0bXAueSAtIHBhcnRpY2xlLm9mZnNldC55KSAvIHBhcmFsbGF4U21vb3RoOyAvLyBFYXNpbmcgZXF1YXRpb25cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlT3BhY2l0eSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250YWluZXI7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb250YWluZXIub3B0aW9ucztcbiAgICAgICAgY29uc3QgcGFydGljbGUgPSB0aGlzLnBhcnRpY2xlO1xuXG4gICAgICAgIGlmIChvcHRpb25zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW1hdGlvbi5lbmFibGUpIHtcbiAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5vcGFjaXR5LnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5vcGFjaXR5LnZhbHVlID49IG9wdGlvbnMucGFydGljbGVzLm9wYWNpdHkudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eS5zdGF0dXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5vcGFjaXR5LnZhbHVlICs9IChwYXJ0aWNsZS5vcGFjaXR5LnZlbG9jaXR5IHx8IDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUub3BhY2l0eS52YWx1ZSA8PSBvcHRpb25zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW1hdGlvbi5taW5pbXVtVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eS5zdGF0dXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBhcnRpY2xlLm9wYWNpdHkudmFsdWUgLT0gKHBhcnRpY2xlLm9wYWNpdHkudmVsb2NpdHkgfHwgMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5vcGFjaXR5LnZhbHVlIDwgMCkge1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLm9wYWNpdHkudmFsdWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVTaXplKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcjtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbnRhaW5lci5vcHRpb25zO1xuICAgICAgICBjb25zdCBwYXJ0aWNsZSA9IHRoaXMucGFydGljbGU7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMucGFydGljbGVzLnNpemUuYW5pbWF0aW9uLmVuYWJsZSkge1xuICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnNpemUuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnJhZGl1cyA+PSBjb250YWluZXIucmV0aW5hLnNpemVWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zaXplLnN0YXR1cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnJhZGl1cyArPSAocGFydGljbGUuc2l6ZS52ZWxvY2l0eSB8fCAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnJhZGl1cyA8PSBvcHRpb25zLnBhcnRpY2xlcy5zaXplLmFuaW1hdGlvbi5taW5pbXVtVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuc2l6ZS5zdGF0dXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnJhZGl1cyAtPSAocGFydGljbGUuc2l6ZS52ZWxvY2l0eSB8fCAwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnJhZGl1cyA8IDApIHtcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5yYWRpdXMgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaXhPdXRPZkNhbnZhc1Bvc2l0aW9uKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcjtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbnRhaW5lci5vcHRpb25zO1xuICAgICAgICBjb25zdCBwYXJ0aWNsZSA9IHRoaXMucGFydGljbGU7XG4gICAgICAgIGNvbnN0IG91dE1vZGUgPSBvcHRpb25zLnBhcnRpY2xlcy5tb3ZlLm91dE1vZGU7XG5cbiAgICAgICAgbGV0IG5ld1BvcztcblxuICAgICAgICBpZiAob3V0TW9kZSA9PT0gT3V0TW9kZS5ib3VuY2UpIHtcbiAgICAgICAgICAgIG5ld1BvcyA9IHtcbiAgICAgICAgICAgICAgICB4X2xlZnQ6IHBhcnRpY2xlLnJhZGl1cyxcbiAgICAgICAgICAgICAgICB4X3JpZ2h0OiBjb250YWluZXIuY2FudmFzLmRpbWVuc2lvbi53aWR0aCxcbiAgICAgICAgICAgICAgICB5X2JvdHRvbTogY29udGFpbmVyLmNhbnZhcy5kaW1lbnNpb24uaGVpZ2h0LFxuICAgICAgICAgICAgICAgIHlfdG9wOiBwYXJ0aWNsZS5yYWRpdXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKG91dE1vZGUgPT09IE91dE1vZGUuYm91bmNlSG9yaXpvbnRhbCkge1xuICAgICAgICAgICAgbmV3UG9zID0ge1xuICAgICAgICAgICAgICAgIHhfbGVmdDogcGFydGljbGUucmFkaXVzLFxuICAgICAgICAgICAgICAgIHhfcmlnaHQ6IGNvbnRhaW5lci5jYW52YXMuZGltZW5zaW9uLndpZHRoLFxuICAgICAgICAgICAgICAgIHlfYm90dG9tOiBjb250YWluZXIuY2FudmFzLmRpbWVuc2lvbi5oZWlnaHQgKyBwYXJ0aWNsZS5yYWRpdXMgLSBwYXJ0aWNsZS5vZmZzZXQueSxcbiAgICAgICAgICAgICAgICB5X3RvcDogLXBhcnRpY2xlLnJhZGl1cyAtIHBhcnRpY2xlLm9mZnNldC55LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmIChvdXRNb2RlID09PSBPdXRNb2RlLmJvdW5jZVZlcnRpY2FsKSB7XG4gICAgICAgICAgICBuZXdQb3MgPSB7XG4gICAgICAgICAgICAgICAgeF9sZWZ0OiAtcGFydGljbGUucmFkaXVzIC0gcGFydGljbGUub2Zmc2V0LngsXG4gICAgICAgICAgICAgICAgeF9yaWdodDogY29udGFpbmVyLmNhbnZhcy5kaW1lbnNpb24ud2lkdGggKyBwYXJ0aWNsZS5yYWRpdXMgKyBwYXJ0aWNsZS5vZmZzZXQueCxcbiAgICAgICAgICAgICAgICB5X2JvdHRvbTogY29udGFpbmVyLmNhbnZhcy5kaW1lbnNpb24uaGVpZ2h0LFxuICAgICAgICAgICAgICAgIHlfdG9wOiBwYXJ0aWNsZS5yYWRpdXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3UG9zID0ge1xuICAgICAgICAgICAgICAgIHhfbGVmdDogLXBhcnRpY2xlLnJhZGl1cyAtIHBhcnRpY2xlLm9mZnNldC54LFxuICAgICAgICAgICAgICAgIHhfcmlnaHQ6IGNvbnRhaW5lci5jYW52YXMuZGltZW5zaW9uLndpZHRoICsgcGFydGljbGUucmFkaXVzICsgcGFydGljbGUub2Zmc2V0LngsXG4gICAgICAgICAgICAgICAgeV9ib3R0b206IGNvbnRhaW5lci5jYW52YXMuZGltZW5zaW9uLmhlaWdodCArIHBhcnRpY2xlLnJhZGl1cyAtIHBhcnRpY2xlLm9mZnNldC55LFxuICAgICAgICAgICAgICAgIHlfdG9wOiAtcGFydGljbGUucmFkaXVzIC0gcGFydGljbGUub2Zmc2V0LnksXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG91dE1vZGUgPT09IE91dE1vZGUuZGVzdHJveSkge1xuICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnBvc2l0aW9uLnggKyBwYXJ0aWNsZS5yYWRpdXMgPCAwIHx8XG4gICAgICAgICAgICAgICAgcGFydGljbGUucG9zaXRpb24ueSArIHBhcnRpY2xlLnJhZGl1cyA8IDAgfHxcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5wb3NpdGlvbi54IC0gcGFydGljbGUucmFkaXVzID4gY29udGFpbmVyLmNhbnZhcy5kaW1lbnNpb24ud2lkdGggfHxcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5wb3NpdGlvbi55IC0gcGFydGljbGUucmFkaXVzID4gY29udGFpbmVyLmNhbnZhcy5kaW1lbnNpb24uaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gY29udGFpbmVyLnBhcnRpY2xlcy5hcnJheS5pbmRleE9mKHBhcnRpY2xlKTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIucGFydGljbGVzLmFycmF5LnNwbGljZShpZHgsIDEpO1xuXG4gICAgICAgICAgICAgICAgLyogcmVtb3ZlIHRoZSBjYW52YXMgaWYgdGhlIGFycmF5IGlzIGVtcHR5ICovXG4gICAgICAgICAgICAgICAgY29uc3QgY2xpY2tNb2RlID0gb3B0aW9ucy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbkNsaWNrLm1vZGU7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5lci5wYXJ0aWNsZXMuYXJyYXkubGVuZ3RoICYmICFVdGlscy5pc0luQXJyYXkoQ2xpY2tNb2RlLnB1c2gsIGNsaWNrTW9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBuZXh0UG9zID0ge1xuICAgICAgICAgICAgICAgIHhfbGVmdDogcGFydGljbGUucG9zaXRpb24ueCAtIHBhcnRpY2xlLnJhZGl1cyxcbiAgICAgICAgICAgICAgICB4X3JpZ2h0OiBwYXJ0aWNsZS5wb3NpdGlvbi54ICsgcGFydGljbGUucmFkaXVzLFxuICAgICAgICAgICAgICAgIHlfdG9wOiBwYXJ0aWNsZS5wb3NpdGlvbi55IC0gcGFydGljbGUucmFkaXVzLFxuICAgICAgICAgICAgICAgIHlfYm90dG9tOiBwYXJ0aWNsZS5wb3NpdGlvbi55ICsgcGFydGljbGUucmFkaXVzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGNvbnRhaW5lci5jYW52YXMuZGltZW5zaW9uO1xuXG4gICAgICAgICAgICBpZiAobmV4dFBvcy54X2xlZnQgPiBkaW1lbnNpb24ud2lkdGggLSBwYXJ0aWNsZS5vZmZzZXQueCkge1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnggPSBuZXdQb3MueF9sZWZ0O1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnkgPSBNYXRoLnJhbmRvbSgpICogZGltZW5zaW9uLmhlaWdodDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV4dFBvcy54X3JpZ2h0IDwgLXBhcnRpY2xlLm9mZnNldC54KSB7XG4gICAgICAgICAgICAgICAgcGFydGljbGUucG9zaXRpb24ueCA9IG5ld1Bvcy54X3JpZ2h0O1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnkgPSBNYXRoLnJhbmRvbSgpICogZGltZW5zaW9uLmhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG5leHRQb3MueV90b3AgPiBjb250YWluZXIuY2FudmFzLmRpbWVuc2lvbi5oZWlnaHQgLSBwYXJ0aWNsZS5vZmZzZXQueSkge1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnkgPSBuZXdQb3MueV90b3A7XG4gICAgICAgICAgICAgICAgcGFydGljbGUucG9zaXRpb24ueCA9IE1hdGgucmFuZG9tKCkgKiBjb250YWluZXIuY2FudmFzLmRpbWVuc2lvbi53aWR0aDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV4dFBvcy55X2JvdHRvbSA8IC1wYXJ0aWNsZS5vZmZzZXQueSkge1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnBvc2l0aW9uLnkgPSBuZXdQb3MueV9ib3R0b207XG4gICAgICAgICAgICAgICAgcGFydGljbGUucG9zaXRpb24ueCA9IE1hdGgucmFuZG9tKCkgKiBjb250YWluZXIuY2FudmFzLmRpbWVuc2lvbi53aWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlT3V0TW9kZSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250YWluZXI7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb250YWluZXIub3B0aW9ucztcblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMucGFydGljbGVzLm1vdmUub3V0TW9kZSkge1xuICAgICAgICAgICAgY2FzZSBPdXRNb2RlLmJvdW5jZTpcbiAgICAgICAgICAgIGNhc2UgT3V0TW9kZS5ib3VuY2VWZXJ0aWNhbDpcbiAgICAgICAgICAgIGNhc2UgT3V0TW9kZS5ib3VuY2VIb3Jpem9udGFsOlxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQm91bmNlKCk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlQm91bmNlKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcjtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbnRhaW5lci5vcHRpb25zO1xuICAgICAgICBjb25zdCBwYXJ0aWNsZSA9IHRoaXMucGFydGljbGU7XG5cbiAgICAgICAgLyogY2hlY2sgYm91bmNlIGFnYWluc3QgcG9seWdvbiBib3VuZGFyaWVzICovXG4gICAgICAgIGlmIChvcHRpb25zLnBvbHlnb24udHlwZSAhPT0gUG9seWdvbk1hc2tUeXBlLm5vbmUgJiYgb3B0aW9ucy5wb2x5Z29uLnR5cGUgIT09IFBvbHlnb25NYXNrVHlwZS5pbmxpbmUpIHtcbiAgICAgICAgICAgIGlmICghY29udGFpbmVyLnBvbHlnb24uY2hlY2tJbnNpZGVQb2x5Z29uKHBhcnRpY2xlLnBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucG9seWdvbkJvdW5jZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMucG9seWdvbi50eXBlID09PSBQb2x5Z29uTWFza1R5cGUuaW5saW5lKSB7XG4gICAgICAgICAgICBpZiAoIXBhcnRpY2xlLmluaXRpYWxQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLmluaXRpYWxQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBVdGlscy5nZXREaXN0YW5jZUJldHdlZW5Db29yZGluYXRlcyhwYXJ0aWNsZS5pbml0aWFsUG9zaXRpb24sIHBhcnRpY2xlLnBvc2l0aW9uKTtcbiAgICAgICAgICAgIGlmIChkaXN0ID4gY29udGFpbmVyLnJldGluYS5wb2x5Z29uTWFza01vdmVSYWRpdXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvbHlnb25Cb3VuY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG91dE1vZGUgPSBvcHRpb25zLnBhcnRpY2xlcy5tb3ZlLm91dE1vZGU7XG4gICAgICAgICAgICBjb25zdCB4ID0gcGFydGljbGUucG9zaXRpb24ueCArIHBhcnRpY2xlLm9mZnNldC54O1xuICAgICAgICAgICAgY29uc3QgeSA9IHBhcnRpY2xlLnBvc2l0aW9uLnkgKyBwYXJ0aWNsZS5vZmZzZXQueTtcblxuICAgICAgICAgICAgaWYgKG91dE1vZGUgPT09IE91dE1vZGUuYm91bmNlIHx8IG91dE1vZGUgPT09IE91dE1vZGUuYm91bmNlSG9yaXpvbnRhbCkge1xuICAgICAgICAgICAgICAgIFVwZGF0ZXIuY2hlY2tCb3VuZHMoeCwgcGFydGljbGUucmFkaXVzLCBjb250YWluZXIuY2FudmFzLmRpbWVuc2lvbi53aWR0aCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52ZWxvY2l0eS5ob3Jpem9udGFsID0gLXBhcnRpY2xlLnZlbG9jaXR5Lmhvcml6b250YWw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvdXRNb2RlID09PSBPdXRNb2RlLmJvdW5jZSB8fCBvdXRNb2RlID09PSBPdXRNb2RlLmJvdW5jZVZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlci5jaGVja0JvdW5kcyh5LCBwYXJ0aWNsZS5yYWRpdXMsIGNvbnRhaW5lci5jYW52YXMuZGltZW5zaW9uLmhlaWdodCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52ZWxvY2l0eS52ZXJ0aWNhbCA9IC1wYXJ0aWNsZS52ZWxvY2l0eS52ZXJ0aWNhbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGNoZWNrQm91bmRzKGNvb3JkaW5hdGU6IG51bWJlciwgcmFkaXVzOiBudW1iZXIsIHNpemU6IG51bWJlciwgb3V0c2lkZTogKCkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICBpZiAoKGNvb3JkaW5hdGUgKyByYWRpdXMgPiBzaXplKSB8fCAoY29vcmRpbmF0ZSAtIHJhZGl1cyA8IDApKSB7XG4gICAgICAgICAgICBvdXRzaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHBvbHlnb25Cb3VuY2UoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2xlID0gdGhpcy5wYXJ0aWNsZTtcblxuICAgICAgICBwYXJ0aWNsZS52ZWxvY2l0eS5ob3Jpem9udGFsID0gLXBhcnRpY2xlLnZlbG9jaXR5Lmhvcml6b250YWwgKyAocGFydGljbGUudmVsb2NpdHkudmVydGljYWwgLyAyKTtcbiAgICAgICAgcGFydGljbGUudmVsb2NpdHkudmVydGljYWwgPSAtcGFydGljbGUudmVsb2NpdHkudmVydGljYWwgKyAocGFydGljbGUudmVsb2NpdHkuaG9yaXpvbnRhbCAvIDIpO1xuICAgIH1cbn1cbiJdfQ==