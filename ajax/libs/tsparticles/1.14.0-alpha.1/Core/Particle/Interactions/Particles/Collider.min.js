"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Utils_1=require("../../../../Utils/Utils"),CollisionMode_1=require("../../../../Enums/CollisionMode"),QuadTree_1=require("../../../../Utils/QuadTree"),Collider=function(){function i(){}return i.collide=function(i,o){for(var t={x:i.position.x+i.offset.x,y:i.position.y+i.offset.y},e=0,l=o.particles.quadTree.query(new QuadTree_1.Circle(t.x,t.y,2*i.size.value));e<l.length;e++){var s=l[e];if(i!==s&&s.particlesOptions.collisions.enable&&i.particlesOptions.collisions.mode===s.particlesOptions.collisions.mode){var r={x:i.position.x+i.offset.x,y:i.position.y+i.offset.y},a={x:s.position.x+s.offset.x,y:s.position.y+s.offset.y},n=Utils_1.Utils.getDistanceBetweenCoordinates(r,a),c=o.retina.sizeValue;n<=this.getRadius(i,c)+this.getRadius(s,c)&&this.resolveCollision(i,s)}}},i.getRadius=function(i,o){return i.bubble.radius||i.size.value||o},i.resolveCollision=function(i,o){var t=i.position.x+i.offset.x,e=i.position.y+i.offset.y,l=o.position.x+o.offset.x,s=o.position.y+o.offset.y;switch(i.particlesOptions.collisions.mode){case CollisionMode_1.CollisionMode.bounce:if(0<=(i.velocity.horizontal-o.velocity.horizontal)*(l-t)+(i.velocity.vertical-o.velocity.vertical)*(s-e)){var r=-Math.atan2(s-e,l-t),a=i.size.value,n=o.size.value,c=this.rotate(i.velocity,r),v=this.rotate(o.velocity,r),u={horizontal:c.horizontal*(a-n)/(a+n)+2*v.horizontal*n/(a+n),vertical:c.vertical},f={horizontal:v.horizontal*(a-n)/(a+n)+2*c.horizontal*n/(a+n),vertical:v.vertical},h=this.rotate(u,-r),y=this.rotate(f,-r);i.velocity.horizontal=h.horizontal,i.velocity.vertical=h.vertical,o.velocity.horizontal=y.horizontal,o.velocity.vertical=y.vertical}}},i.rotate=function(i,o){return{horizontal:i.horizontal*Math.cos(o)-i.vertical*Math.sin(o),vertical:i.horizontal*Math.sin(o)+i.vertical*Math.cos(o)}},i}();exports.Collider=Collider;