"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Constants_1=require("./Utils/Constants"),Utils_1=require("./Utils/Utils"),CanvasUtils_1=require("./Utils/CanvasUtils"),ColorUtils_1=require("./Utils/ColorUtils"),Canvas=function(){function o(o){this.container=o,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}return o.prototype.init=function(){this.resize();var o=this.container.options,t=o.backgroundMask.cover,i="string"==typeof o.backgroundMask.cover?{value:o.backgroundMask.cover}:o.backgroundMask.cover,e=o.particles.move.trail;this.coverColor=ColorUtils_1.ColorUtils.colorToRgb(void 0!==t.color?"string"==typeof t.color?{value:t.color}:t.color:i),this.trailFillColor="string"==typeof e.fillColor?ColorUtils_1.ColorUtils.stringToRgb(e.fillColor):ColorUtils_1.ColorUtils.colorToRgb(e.fillColor),this.paint()},o.prototype.loadCanvas=function(o,t){var i;o.className||(o.className=Constants_1.Constants.canvasClass),this.generatedCanvas&&null!==(i=this.element)&&void 0!==i&&i.remove(),this.generatedCanvas=null!=t&&t,this.element=o,this.size.height=o.offsetHeight,this.size.width=o.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()},o.prototype.destroy=function(){var o;this.generatedCanvas&&null!==(o=this.element)&&void 0!==o&&o.remove(),this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},o.prototype.resize=function(){this.element&&(this.element.width=this.size.width,this.element.height=this.size.height)},o.prototype.paint=function(){var o=this.container.options;this.context&&(o.backgroundMask.enable&&o.backgroundMask.cover&&this.coverColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.coverColor)):this.paintBase())},o.prototype.clear=function(){var o=this.container.options,t=o.particles.move.trail;o.backgroundMask.enable?this.paint():t.enable&&0<t.length&&this.trailFillColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.trailFillColor,1/t.length)):this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},o.prototype.isPointInPath=function(o,t){var i,e;return null!==(e=null===(i=this.context)||void 0===i?void 0:i.isPointInPath(o,t.x,t.y))&&void 0!==e&&e},o.prototype.drawPolygonMask=function(){for(var o=this.container,t=o.options,i=this.context,e=t.polygon.draw,s=o.polygon,l=s.raw,n=0,r=s.paths;n<r.length;n++){var a=r[n].path2d,c=s.path2DSupported;i&&(c&&a&&s.offset?CanvasUtils_1.CanvasUtils.drawPolygonMaskPath(i,a,e.stroke,s.offset):l&&CanvasUtils_1.CanvasUtils.drawPolygonMask(i,l,e.stroke))}},o.prototype.drawAbsorber=function(o){var t=this.context;t&&CanvasUtils_1.CanvasUtils.drawAbsorber(t,o)},o.prototype.drawLinkedLine=function(o,t,i){var e,s=this.container,l=s.options,n=o.position,r=t.position,a=this.context;if(a){var c,v=l.particles.twinkle.lines,C=v.frequency,d="string"==typeof v.color?{value:v.color}:v.color,p=void 0!==d?ColorUtils_1.ColorUtils.colorToRgb(d):void 0;if(v.enable&&Math.random()<C&&void 0!==p)c=p,i=v.opacity;else if(s.particles.lineLinkedColor===Constants_1.Constants.randomColorValue)c=ColorUtils_1.ColorUtils.getRandomRgbColor();else if("mid"==s.particles.lineLinkedColor&&o.color&&t.color){var h=o.color,u=t.color;c={b:Utils_1.Utils.mix(h.b,u.b,o.size.value,t.size.value),g:Utils_1.Utils.mix(h.g,u.g,o.size.value,t.size.value),r:Utils_1.Utils.mix(h.r,u.r,o.size.value,t.size.value)}}else c=s.particles.lineLinkedColor;var g=null!==(e=o.lineLinkedWidth)&&void 0!==e?e:s.retina.lineLinkedWidth;CanvasUtils_1.CanvasUtils.drawLineLinked(a,g,n,r,l.backgroundMask.enable,c,i,o.particlesOptions.lineLinked.shadow)}},o.prototype.drawConnectLine=function(o,t){var i,e=this.lineStyle(o,t);if(e){var s=this.context;s&&CanvasUtils_1.CanvasUtils.drawConnectLine(s,null!==(i=o.lineLinkedWidth)&&void 0!==i?i:this.container.retina.lineLinkedWidth,e,o.position,t.position)}},o.prototype.drawGrabLine=function(o,t,i){var e,s=this.container,l=o.particlesOptions.lineLinked.color,n=s.particles.grabLineColor||("string"==typeof l?ColorUtils_1.ColorUtils.stringToRgb(l):ColorUtils_1.ColorUtils.colorToRgb(l));n==Constants_1.Constants.randomColorValue&&(n=ColorUtils_1.ColorUtils.getRandomRgbColor()),s.particles.grabLineColor=n;var r,a=s.canvas.context;if(a&&void 0!==(r=s.particles.grabLineColor===Constants_1.Constants.randomColorValue?ColorUtils_1.ColorUtils.getRandomRgbColor():s.particles.grabLineColor)){var c={x:o.position.x+o.offset.x,y:o.position.y+o.offset.y};CanvasUtils_1.CanvasUtils.drawGrabLine(a,null!==(e=o.lineLinkedWidth)&&void 0!==e?e:s.retina.lineLinkedWidth,c,i,r,t)}},o.prototype.drawParticle=function(o){var t,i,e,s=this.container.options,l=o.particlesOptions.twinkle.particles,n=l.frequency,r="string"==typeof l.color?{value:l.color}:l.color,a=void 0!==r?ColorUtils_1.ColorUtils.colorToRgb(r):void 0,c=l.enable&&Math.random()<n,v=null!==(t=o.bubble.radius)&&void 0!==t?t:o.size.value,C=c?l.opacity:null!==(i=o.bubble.opacity)&&void 0!==i?i:o.opacity.value,d=c&&void 0!==a?a:null!==(e=o.bubble.color)&&void 0!==e?e:o.color,p=void 0!==d?ColorUtils_1.ColorUtils.getStyleFromColor(d,C):void 0;this.context&&p&&CanvasUtils_1.CanvasUtils.drawParticle(this.context,o,p,s.backgroundMask.enable,v,C,o.particlesOptions.shadow)},o.prototype.paintBase=function(o){this.context&&CanvasUtils_1.CanvasUtils.paintBase(this.context,this.size,o)},o.prototype.lineStyle=function(o,t){var i=this.container.options.interactivity.modes.connect;if(o.color&&t.color){var e=o.color,s=t.color,l={b:Utils_1.Utils.mix(e.b,s.b,o.size.value,t.size.value),g:Utils_1.Utils.mix(e.g,s.g,o.size.value,t.size.value),r:Utils_1.Utils.mix(e.r,s.r,o.size.value,t.size.value)};if(this.context)return CanvasUtils_1.CanvasUtils.gradient(this.context,o,t,l,i.lineLinked.opacity)}},o.prototype.initBackground=function(){var o=this.container.options.background,t=this.element;if(t){var i=t.style;if(o.color){var e="string"==typeof o.color?ColorUtils_1.ColorUtils.stringToRgb(o.color):ColorUtils_1.ColorUtils.colorToRgb(o.color);e&&(i.backgroundColor=ColorUtils_1.ColorUtils.getStyleFromColor(e,o.opacity))}o.image&&(i.backgroundImage=o.image),o.position&&(i.backgroundPosition=o.position),o.repeat&&(i.backgroundRepeat=o.repeat),o.size&&(i.backgroundSize=o.size)}},o}();exports.Canvas=Canvas;