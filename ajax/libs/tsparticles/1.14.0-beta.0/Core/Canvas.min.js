"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Constants_1=require("../Utils/Constants"),CanvasUtils_1=require("../Utils/CanvasUtils"),ColorUtils_1=require("../Utils/ColorUtils"),Canvas=function(){function t(t){this.container=t,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}return t.prototype.init=function(){this.resize();var t=this.container.options,o=t.backgroundMask.cover.color,i=t.particles.move.trail;this.coverColor=ColorUtils_1.ColorUtils.colorToRgb(o),this.trailFillColor=ColorUtils_1.ColorUtils.colorToRgb(i.fillColor),this.paint()},t.prototype.loadCanvas=function(t,o){var i;t.className||(t.className=Constants_1.Constants.canvasClass),this.generatedCanvas&&null!==(i=this.element)&&void 0!==i&&i.remove(),this.generatedCanvas=null!=o&&o,this.element=t,this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()},t.prototype.destroy=function(){var t;this.generatedCanvas&&null!==(t=this.element)&&void 0!==t&&t.remove(),this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.resize=function(){this.element&&(this.element.width=this.size.width,this.element.height=this.size.height)},t.prototype.paint=function(){var t=this.container.options;this.context&&(t.backgroundMask.enable&&t.backgroundMask.cover&&this.coverColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.coverColor)):this.paintBase())},t.prototype.clear=function(){var t=this.container.options,o=t.particles.move.trail;t.backgroundMask.enable?this.paint():o.enable&&0<o.length&&this.trailFillColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.trailFillColor,1/o.length)):this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.isPointInPath=function(t,o){var i,n;return null!==(n=null===(i=this.context)||void 0===i?void 0:i.isPointInPath(t,o.x,o.y))&&void 0!==n&&n},t.prototype.drawLinkedLine=function(t,o){var i,n,e,s,l,r,a,c,C,d=this.container,h=d.options,v=o.destination,p=o.opacity,u=t.getPosition(),g=v.getPosition(),U=this.context;U&&((n=t.particlesOptions.twinkle.lines).enable&&(e=n.frequency,l=void 0!==(s="string"==typeof n.color?{value:n.color}:n.color)?ColorUtils_1.ColorUtils.colorToRgb(s):void 0,Math.random()<e&&void 0!==l&&(c=l,p=n.opacity)),c=c||(d.particles.lineLinkedColor===Constants_1.Constants.randomColorValue?ColorUtils_1.ColorUtils.getRandomRgbColor():"mid"==d.particles.lineLinkedColor&&t.color&&v.color?(r=t.color,a=v.color,ColorUtils_1.ColorUtils.mix(r,a,t.size.value,v.size.value)):d.particles.lineLinkedColor),C=null!==(i=t.lineLinkedWidth)&&void 0!==i?i:d.retina.lineLinkedWidth,CanvasUtils_1.CanvasUtils.drawLinkedLine(U,C,u,g,h.backgroundMask.enable,c,p,t.particlesOptions.lineLinked.shadow))},t.prototype.drawConnectLine=function(t,o){var i,n,e,s,l=this.lineStyle(t,o);!l||(n=this.context)&&(e=t.getPosition(),s=o.getPosition(),CanvasUtils_1.CanvasUtils.drawConnectLine(n,null!==(i=t.lineLinkedWidth)&&void 0!==i?i:this.container.retina.lineLinkedWidth,l,e,s))},t.prototype.drawGrabLine=function(t,o,i){var n,e=this.container,s=t.particlesOptions.lineLinked.color,l=e.particles.grabLineColor||("string"==typeof s?ColorUtils_1.ColorUtils.stringToRgb(s):ColorUtils_1.ColorUtils.colorToRgb(s));l==Constants_1.Constants.randomColorValue&&(l=ColorUtils_1.ColorUtils.getRandomRgbColor()),e.particles.grabLineColor=l;var r,a,c=e.canvas.context;!c||void 0!==(a=e.particles.grabLineColor===Constants_1.Constants.randomColorValue?ColorUtils_1.ColorUtils.getRandomRgbColor():e.particles.grabLineColor)&&(r=t.getPosition(),CanvasUtils_1.CanvasUtils.drawGrabLine(c,null!==(n=t.lineLinkedWidth)&&void 0!==n?n:e.retina.lineLinkedWidth,r,i,a,o))},t.prototype.drawParticle=function(t,o){var i,n,e,s=this.container.options,l=t.particlesOptions.twinkle.particles,r=l.frequency,a="string"==typeof l.color?{value:l.color}:l.color,c=void 0!==a?ColorUtils_1.ColorUtils.colorToRgb(a):void 0,C=l.enable&&Math.random()<r,d=null!==(i=t.bubble.radius)&&void 0!==i?i:t.size.value,h=C?l.opacity:null!==(n=t.bubble.opacity)&&void 0!==n?n:t.opacity.value,v=t.infectionStage,p=s.infection.stages,u=void 0!==v?p[v].color:void 0,g=u?ColorUtils_1.ColorUtils.colorToRgb(u):void 0,U=C&&void 0!==c?c:null!==(e=null!=g?g:t.bubble.color)&&void 0!==e?e:t.color,b=void 0!==U?ColorUtils_1.ColorUtils.getStyleFromColor(U,h):void 0;if(this.context&&b){this.context.save();for(var k=0,y=t.links;k<y.length;k++){var _=y[k];this.drawLinkedLine(t,_)}this.context.restore(),CanvasUtils_1.CanvasUtils.drawParticle(this.container,this.context,t,o,b,s.backgroundMask.enable,d,h,t.particlesOptions.shadow)}},t.prototype.drawPlugin=function(t,o){this.context&&CanvasUtils_1.CanvasUtils.drawPlugin(this.context,t,o)},t.prototype.paintBase=function(t){this.context&&CanvasUtils_1.CanvasUtils.paintBase(this.context,this.size,t)},t.prototype.lineStyle=function(t,o){var i=this.container.options.interactivity.modes.connect;if(t.color&&o.color&&this.context)return CanvasUtils_1.CanvasUtils.gradient(this.context,t,o,i.lineLinked.opacity)},t.prototype.initBackground=function(){var t,o,i=this.container.options.background,n=this.element;n&&(t=n.style,!i.color||(o=ColorUtils_1.ColorUtils.colorToRgb(i.color))&&(t.backgroundColor=ColorUtils_1.ColorUtils.getStyleFromColor(o,i.opacity)),i.image&&(t.backgroundImage=i.image),i.position&&(t.backgroundPosition=i.position),i.repeat&&(t.backgroundRepeat=i.repeat),i.size&&(t.backgroundSize=i.size))},t}();exports.Canvas=Canvas;