"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Utils_1=require("./Utils"),SpatialGrid=function(){function t(t){this.grid=[],this.cellSize=20,this.widthSegment=Math.round(t.width/this.cellSize),this.heightSegment=Math.round(t.height/this.cellSize)}return t.prototype.setGrid=function(t,i){for(var e=[],r=null!=i&&i.width?(null==i?void 0:i.width)/this.cellSize:this.widthSegment,n=null!=i&&i.height?(null==i?void 0:i.height)/this.cellSize:this.heightSegment,s=0,h=t;s<h.length;s++){var o=h[s],a=this.index(o.position);Array.isArray(e[a.x])||(e[a.x]=[]),Array.isArray(e[a.x][a.y])||(e[a.x][a.y]=[]),e[a.x][a.y].push(o)}this.widthSegment=r,this.heightSegment=n,this.grid=e},t.prototype.queryInCell=function(t){var i=this.index(t);return Array.isArray(this.grid[i.x])&&Array.isArray(this.grid[i.x][i.y])&&this.grid[i.x][i.y]||[]},t.prototype.queryRadius=function(t,i){for(var e=this.index(t),r=this.radius({x:i,y:i}),n=[],s=0,h=this.select(this.indexOp(e,"-",r),this.indexOp(e,"+",r)).filter(function(t){return void 0!==t});s<h.length;s++){var o=h[s];Utils_1.Utils.getDistanceBetweenCoordinates(o.position,t)<=i&&n.push(o)}return n},t.prototype.queryRadiusWithDistance=function(t,i){for(var e=this.index(t),r=this.radius({x:i,y:i}),n=[],s=0,h=this.select(this.indexOp(e,"-",r),this.indexOp(e,"+",r)).filter(function(t){return void 0!==t});s<h.length;s++){var o=h[s];if(o){var a=Utils_1.Utils.getDistanceBetweenCoordinates(o.position,t);a<=i&&n.push({distance:a,particle:o})}}return n},t.prototype.select=function(t,i){for(var e=[],r=t.x;r<=i.x;r++)if(Array.isArray(this.grid[r]))for(var n=t.y;n<=i.y;n++)if(Array.isArray(this.grid[r][n]))for(var s=0,h=this.grid[r][n].filter(function(t){return void 0!==t});s<h.length;s++){var o=h[s];e.push(o)}return e},t.prototype.index=function(t){return{x:Math.round(t.x/this.widthSegment),y:Math.round(t.y/this.heightSegment)}},t.prototype.radius=function(t){return{x:Math.ceil(t.x/this.widthSegment),y:Math.ceil(t.y/this.heightSegment)}},t.prototype.indexOp=function(t,i,e){return"+"==i?{x:this.clamp(t.x+e.x),y:this.clamp(t.y+e.y)}:{x:this.clamp(t.x-e.x),y:this.clamp(t.y-e.y)}},t.prototype.clamp=function(t){return Utils_1.Utils.clamp(t,0,this.cellSize)},t}();exports.SpatialGrid=SpatialGrid;