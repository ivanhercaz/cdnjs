"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClickMode_1=require("../../Enums/Modes/ClickMode"),InteractivityDetect_1=require("../../Enums/InteractivityDetect"),PolygonMaskType_1=require("../../Enums/PolygonMaskType"),Constants_1=require("./Constants"),EventListeners=function(){function e(e){var t=this;this.container=e,this.canPush=!0,this.mouseMoveHandler=function(e){return t.mouseTouchMove(e)},this.touchStartHandler=function(e){return t.mouseTouchMove(e)},this.touchMoveHandler=function(e){return t.mouseTouchMove(e)},this.touchEndHandler=function(){return t.mouseTouchFinish()},this.mouseLeaveHandler=function(){return t.mouseTouchFinish()},this.touchCancelHandler=function(){return t.mouseTouchFinish()},this.touchEndClickHandler=function(e){return t.mouseTouchClick(e)},this.mouseUpHandler=function(e){return t.mouseTouchClick(e)},this.visibilityChangeHandler=function(){return t.handleVisibilityChange()},this.resizeHandler=function(){return t.handleWindowResize()}}return e.prototype.addListeners=function(){this.manageListeners(!0)},e.prototype.removeListeners=function(){this.manageListeners(!1)},e.prototype.manageListeners=function(e){var t=this.container,n=t.options;n.interactivity.detectsOn===InteractivityDetect_1.InteractivityDetect.window?t.interactivity.element=window:n.interactivity.detectsOn===InteractivityDetect_1.InteractivityDetect.parent&&t.canvas.element?t.interactivity.element=t.canvas.element.parentNode:t.interactivity.element=t.canvas.element;var i=t.interactivity.element;i&&(n.interactivity.events.onHover.enable||n.interactivity.events.onClick.enable)&&(this.manageListener(i,Constants_1.Constants.mouseMoveEvent,this.mouseMoveHandler,e),this.manageListener(i,Constants_1.Constants.touchStartEvent,this.touchStartHandler,e),this.manageListener(i,Constants_1.Constants.touchMoveEvent,this.touchMoveHandler,e),n.interactivity.events.onClick.enable||this.manageListener(i,Constants_1.Constants.touchEndEvent,this.touchEndHandler,e),this.manageListener(i,Constants_1.Constants.mouseLeaveEvent,this.mouseLeaveHandler,e),this.manageListener(i,Constants_1.Constants.touchCancelEvent,this.touchCancelHandler,e)),n.interactivity.events.onClick.enable&&i&&(this.manageListener(i,Constants_1.Constants.touchEndEvent,this.touchEndClickHandler,e),this.manageListener(i,Constants_1.Constants.mouseUpEvent,this.mouseUpHandler,e)),n.interactivity.events.resize&&this.manageListener(window,Constants_1.Constants.resizeEvent,this.resizeHandler,e),document&&this.manageListener(document,Constants_1.Constants.visibilityChangeEvent,this.visibilityChangeHandler,e,!1)},e.prototype.manageListener=function(e,t,n,i,s){i?this.addListener(e,t,n,s):this.removeListener(e,t,n,s)},e.prototype.addListener=function(e,t,n,i){e.addEventListener(t,n,i)},e.prototype.removeListener=function(e,t,n,i){e.removeEventListener(t,n,i)},e.prototype.handleWindowResize=function(){var e=this.container,t=e.options;e.canvas.element&&(e.canvas.dimension.width=e.canvas.element.offsetWidth,e.canvas.dimension.height=e.canvas.element.offsetHeight,e.retina.isRetina&&(e.canvas.dimension.width*=e.retina.pxRatio,e.canvas.dimension.height*=e.retina.pxRatio),e.canvas.element.width=e.canvas.dimension.width,e.canvas.element.height=e.canvas.dimension.height,t.particles.move.enable||e.particles.redraw(),e.densityAutoParticles(),e.polygon.redraw())},e.prototype.handleVisibilityChange=function(){var e=this.container;e.options.pauseOnBlur&&(null!==document&&void 0!==document&&document.hidden?(e.pageHidden=!0,e.pause()):(e.pageHidden=!1,e.play()))},e.prototype.mouseTouchMove=function(e){var t,n,i,s,o=this.container,a=o.options;if(e.type.startsWith("mouse")){this.canPush=!0;var r=e;if(o.interactivity.element===window&&o.canvas.element){var c=o.canvas.element.getBoundingClientRect();s={x:r.clientX-c.left,y:r.clientY-c.top}}else if(a.interactivity.detectsOn===InteractivityDetect_1.InteractivityDetect.parent){var u=r.target,l=r.currentTarget;if(u&&l){var v=u.getBoundingClientRect(),h=l.getBoundingClientRect();s={x:r.offsetX+v.left-h.left,y:r.offsetY+v.top-h.top}}else s={x:r.offsetX||r.clientX,y:r.offsetY||r.clientY}}else s={x:r.offsetX||r.clientX,y:r.offsetY||r.clientY}}else{this.canPush="touchmove"!==e.type;var d=e.touches[e.touches.length-1],m=null===(t=o.canvas.element)||void 0===t?void 0:t.getBoundingClientRect();s={x:d.clientX-(null!==(n=null==m?void 0:m.left)&&void 0!==n?n:0),y:d.clientY-(null!==(i=null==m?void 0:m.top)&&void 0!==i?i:0)}}o.interactivity.mouse.position=s,o.retina.isRetina&&(o.interactivity.mouse.position.x*=o.retina.pxRatio,o.interactivity.mouse.position.y*=o.retina.pxRatio),o.interactivity.status=Constants_1.Constants.mouseMoveEvent},e.prototype.mouseTouchFinish=function(){var e=this.container;delete e.interactivity.mouse.position,e.interactivity.status=Constants_1.Constants.mouseLeaveEvent},e.prototype.mouseTouchClick=function(e){var t=this.container,n=t.options;n.polygon.enable&&n.polygon.type!==PolygonMaskType_1.PolygonMaskType.none&&n.polygon.type!==PolygonMaskType_1.PolygonMaskType.inline&&!t.polygon.checkInsidePolygon(t.interactivity.mouse.position)||this.doMouseTouchClick(e)},e.prototype.doMouseTouchClick=function(e){var t=this,n=this.container,i=n.options;if(this.canPush){n.interactivity.mouse.position&&(n.interactivity.mouse.clickPosition={x:n.interactivity.mouse.position.x,y:n.interactivity.mouse.position.y}),n.interactivity.mouse.clickTime=(new Date).getTime();var s=i.interactivity.modes.push.quantity,o=i.interactivity.modes.remove.quantity;switch(i.interactivity.events.onClick.mode){case ClickMode_1.ClickMode.push:i.particles.move.enable||1===i.interactivity.modes.push.quantity?n.particles.push(s,n.interactivity.mouse):1<i.interactivity.modes.push.quantity&&n.particles.push(s);break;case ClickMode_1.ClickMode.remove:n.particles.removeQuantity(o);break;case ClickMode_1.ClickMode.bubble:n.bubble.clicking=!0;break;case ClickMode_1.ClickMode.repulse:n.repulse.clicking=!0,n.repulse.count=0,n.repulse.finish=!1,setTimeout(function(){n.destroyed||(n.repulse.clicking=!1)},1e3*i.interactivity.modes.repulse.duration)}}e.preventDefault(),"touchend"===e.type&&setTimeout(function(){return t.mouseTouchFinish()},500),e.preventDefault()},e}();exports.EventListeners=EventListeners;