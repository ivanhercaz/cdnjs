"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Constants_1=require("./Utils/Constants"),Utils_1=require("./Utils/Utils"),CanvasUtils_1=require("./Utils/CanvasUtils"),ColorUtils_1=require("./Utils/ColorUtils"),Canvas=function(){function t(t){this.container=t,this.dimension={height:0,width:0},this.context=null,this.generatedCanvas=!1}return t.prototype.init=function(){this.size();var t=this.container.options,o=t.backgroundMask.cover,i=t.particles.move.trail;this.coverColor=ColorUtils_1.ColorUtils.colorToRgb(void 0!==o.color?o.color:t.backgroundMask.cover),this.trailFillColor="string"==typeof i.fillColor?ColorUtils_1.ColorUtils.stringToRgb(i.fillColor):ColorUtils_1.ColorUtils.colorToRgb(i.fillColor),this.paint()},t.prototype.loadCanvas=function(t,o){var i;t.className||(t.className=Constants_1.Constants.canvasClass),this.generatedCanvas&&null!==(i=this.element)&&void 0!==i&&i.remove(),this.generatedCanvas=null!=o&&o,this.element=t,this.dimension.height=t.offsetHeight,this.dimension.width=t.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()},t.prototype.destroy=function(){var t;this.generatedCanvas&&null!==(t=this.element)&&void 0!==t&&t.remove(),this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.dimension)},t.prototype.size=function(){this.element&&(this.element.width=this.dimension.width,this.element.height=this.dimension.height)},t.prototype.paint=function(){var t=this.container.options;this.context&&(t.backgroundMask.enable&&t.backgroundMask.cover&&this.coverColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.coverColor)):this.paintBase())},t.prototype.clear=function(){var t=this.container.options,o=t.particles.move.trail;t.backgroundMask.enable?this.paint():o.enable&&0<o.length&&this.trailFillColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.trailFillColor,1/o.length)):this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.dimension)},t.prototype.isPointInPath=function(t,o){var i,n;return null!==(n=null===(i=this.context)||void 0===i?void 0:i.isPointInPath(t,o.x,o.y))&&void 0!==n&&n},t.prototype.drawPolygonMask=function(){var t=this.container,o=t.options,i=this.context,n=o.polygon.draw,s=t.polygon,r=s.raw,e=s.polygonPath,l=s.path2DSupported;i&&(l&&e&&s.offset?CanvasUtils_1.CanvasUtils.drawPolygonMaskPath(i,e,n.stroke,s.offset):r&&CanvasUtils_1.CanvasUtils.drawPolygonMask(i,r,n.stroke))},t.prototype.drawLinkedLine=function(t,o,i,n,s){var r=this.container,e=r.options,l=this.context;if(l){var a;if(r.particles.lineLinkedColor===Constants_1.Constants.randomColorValue)a=ColorUtils_1.ColorUtils.getRandomRgbColor();else if("mid"==r.particles.lineLinkedColor&&t.color&&o.color){var c=t.color,d=o.color;a={b:Math.floor(Utils_1.Utils.mix(c.b,d.b,t.radius,o.radius)),g:Math.floor(Utils_1.Utils.mix(c.g,d.g,t.radius,o.radius)),r:Math.floor(Utils_1.Utils.mix(c.r,d.r,t.radius,o.radius))}}else a=r.particles.lineLinkedColor;var C=r.retina.lineLinkedWidth;CanvasUtils_1.CanvasUtils.drawLineLinked(l,C,i,n,e.backgroundMask.enable,a,s,e.particles.lineLinked.shadow)}},t.prototype.drawConnectLine=function(t,o){var i=this.lineStyle(t,o);if(i){var n=this.context;n&&CanvasUtils_1.CanvasUtils.drawConnectLine(n,this.container.retina.lineLinkedWidth,i,t.position,o.position)}},t.prototype.drawGrabLine=function(t,o,i){var n=this.container,s=n.options.particles.lineLinked.color,r=n.particles.lineLinkedColor||("string"==typeof s?ColorUtils_1.ColorUtils.stringToRgb(s):ColorUtils_1.ColorUtils.colorToRgb(s));r==Constants_1.Constants.randomColorValue&&(r=ColorUtils_1.ColorUtils.getRandomRgbColor()),n.particles.lineLinkedColor=r;var e={r:127,g:127,b:127},l=n.canvas.context;if(l){e=n.particles.lineLinkedColor==Constants_1.Constants.randomColorValue?ColorUtils_1.ColorUtils.getRandomRgbColor()||e:n.particles.lineLinkedColor||e;var a={x:t.position.x+t.offset.x,y:t.position.y+t.offset.y};CanvasUtils_1.CanvasUtils.drawGrabLine(l,n.retina.lineLinkedWidth,a,i,e,o)}},t.prototype.drawParticle=function(t){var o,i=this.container.options,n=void 0!==t.bubbler.radius?t.bubbler.radius:t.radius,s=void 0!==t.bubbler.opacity?t.bubbler.opacity:t.opacity.value;t.color&&(o=ColorUtils_1.ColorUtils.getStyleFromColor(t.color,s)),this.context&&o&&CanvasUtils_1.CanvasUtils.drawParticle(this.context,t,o,i.backgroundMask.enable,n,s)},t.prototype.paintBase=function(t){this.context&&CanvasUtils_1.CanvasUtils.paintBase(this.context,this.dimension,t)},t.prototype.lineStyle=function(t,o){var i=this.container.options.interactivity.modes.connect;if(t.color&&o.color){var n=t.color,s=o.color,r={b:Utils_1.Utils.mix(n.b,s.b,t.radius,o.radius),g:Utils_1.Utils.mix(n.g,s.g,t.radius,o.radius),r:Utils_1.Utils.mix(n.r,s.r,t.radius,o.radius)};if(this.context)return CanvasUtils_1.CanvasUtils.gradient(this.context,t,o,r,i.lineLinked.opacity)}},t.prototype.initBackground=function(){var t=this.container.options.background,o=this.element;if(o){var i=o.style;if(t.color){var n="string"==typeof t.color?ColorUtils_1.ColorUtils.stringToRgb(t.color):ColorUtils_1.ColorUtils.colorToRgb(t.color);n&&(i.backgroundColor=ColorUtils_1.ColorUtils.getStyleFromColor(n,t.opacity))}t.image&&(i.backgroundImage=t.image),t.position&&(i.backgroundPosition=t.position),t.repeat&&(i.backgroundRepeat=t.repeat),t.size&&(i.backgroundSize=t.size)}},t}();exports.Canvas=Canvas;