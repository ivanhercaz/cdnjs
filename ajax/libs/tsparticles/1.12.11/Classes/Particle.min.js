"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Bubbler_1=require("./Particle/Bubbler"),Drawer_1=require("./Particle/Drawer"),Grabber_1=require("./Particle/Grabber"),Repulser_1=require("./Particle/Repulser"),ShapeType_1=require("../Enums/ShapeType"),Updater_1=require("./Particle/Updater"),Utils_1=require("./Utils/Utils"),PolygonMaskType_1=require("../Enums/PolygonMaskType"),Connecter_1=require("./Particle/Connecter"),InteractionManager_1=require("./Particle/InteractionManager"),HoverMode_1=require("../Enums/Modes/HoverMode"),ClickMode_1=require("../Enums/Modes/ClickMode"),RotateDirection_1=require("../Enums/RotateDirection"),ColorUtils_1=require("./Utils/ColorUtils"),Particle=function(){function C(i,t){var e,r,o,a,s,l,n,c,h=(this.container=i).options,p=h.particles.color;if(this.size={},this.angle=h.particles.rotate.random?360*Math.random():h.particles.rotate.value,h.particles.rotate.direction==RotateDirection_1.RotateDirection.random){var y=Math.floor(2*Math.random());this.rotateDirection=0<y?RotateDirection_1.RotateDirection.counterClockwise:RotateDirection_1.RotateDirection.clockwise}else this.rotateDirection=h.particles.rotate.direction;var d=h.particles.size.random,u=i.retina.sizeValue;this.radius=d.enable?Utils_1.Utils.randomInRange(d.minimumValue,u):u,h.particles.size.animation.enable&&(this.size.status=!1,this.size.velocity=i.retina.sizeAnimationSpeed/100,h.particles.size.animation.sync||(this.size.velocity=this.size.velocity*Math.random())),h.particles.rotate.animation.enable&&(h.particles.rotate.animation.sync||(this.angle=360*Math.random())),this.position=this.calcPosition(this.container,t),h.polygon.enable&&h.polygon.type===PolygonMaskType_1.PolygonMaskType.inline&&(this.initialPosition={x:this.position.x,y:this.position.y}),this.offset={x:0,y:0},h.particles.move.collisions&&this.checkOverlap(t),p instanceof Array?this.color=ColorUtils_1.ColorUtils.colorToRgb(Utils_1.Utils.itemFromArray(p)):this.color=ColorUtils_1.ColorUtils.colorToRgb(p);var v=h.particles.opacity.random,m=h.particles.opacity.value;this.opacity={value:v.enable?Utils_1.Utils.randomInRange(v.minimumValue,m):m},h.particles.opacity.animation.enable&&(this.opacity.status=!1,this.opacity.velocity=h.particles.opacity.animation.speed/100,h.particles.opacity.animation.sync||(this.opacity.velocity*=Math.random())),this.initialVelocity=C.calculateVelocity(h),this.velocity={horizontal:this.initialVelocity.horizontal,vertical:this.initialVelocity.vertical},this.fill=!0,this.close=!0;var g=h.particles.shape.type;if(g instanceof Array?this.shape=Utils_1.Utils.itemFromArray(g):this.shape=g,this.shape===ShapeType_1.ShapeType.image){var _=h.particles.shape,U=(y=Utils_1.Utils.arrayRandomIndex(i.images),i.images[y]),b=_.image instanceof Array?_.image[y]:_.image;this.image={data:U,ratio:b.width/b.height,replaceColor:b.replaceColor,src:b.src},this.image.ratio||(this.image.ratio=1),this.fill=null!==(e=b.fill)&&void 0!==e?e:this.fill,this.close=null!==(r=b.close)&&void 0!==r?r:this.close}if(this.shape===ShapeType_1.ShapeType.polygon&&(h.particles.shape.polygon instanceof Array?this.polygon=Utils_1.Utils.itemFromArray(h.particles.shape.polygon):this.polygon=h.particles.shape.polygon,this.fill=null!==(o=this.polygon.fill)&&void 0!==o?o:this.fill,this.close=null!==(a=this.polygon.close)&&void 0!==a?a:this.close),h.particles.stroke instanceof Array?this.stroke=Utils_1.Utils.itemFromArray(h.particles.stroke):this.stroke=h.particles.stroke,this.strokeColor="string"==typeof this.stroke.color?ColorUtils_1.ColorUtils.stringToRgb(this.stroke.color):ColorUtils_1.ColorUtils.colorToRgb(this.stroke.color),this.shadowColor="string"==typeof h.particles.shadow.color?ColorUtils_1.ColorUtils.stringToRgb(h.particles.shadow.color):ColorUtils_1.ColorUtils.colorToRgb(h.particles.shadow.color),this.shape===ShapeType_1.ShapeType.char||this.shape===ShapeType_1.ShapeType.character){h.particles.shape.character instanceof Array?this.character=Utils_1.Utils.itemFromArray(h.particles.shape.character):this.character=h.particles.shape.character;var f=this.character.value;this.text=f instanceof Array?Utils_1.Utils.itemFromArray(f):f,this.fill=null!==(s=this.character.fill)&&void 0!==s?s:this.fill,this.close=null!==(l=this.character.close)&&void 0!==l?l:this.close}var M=h.particles.shape.custom[this.shape];M&&(this.shapeData=M instanceof Array?Utils_1.Utils.itemFromArray(M):M,this.fill=null!==(n=this.shapeData.fill)&&void 0!==n?n:this.fill,this.close=null!==(c=this.shapeData.close)&&void 0!==c?c:this.close),this.updater=new Updater_1.Updater(this.container,this),this.bubbler=new Bubbler_1.Bubbler(this.container,this),this.repulser=new Repulser_1.Repulser(this.container,this),this.drawer=new Drawer_1.Drawer(this.container,this),this.grabber=new Grabber_1.Grabber(this.container,this),this.connecter=new Connecter_1.Connecter(this.container,this),this.interactionManager=new InteractionManager_1.InteractionManager(this.container,this)}return C.calculateVelocity=function(i){var t=Utils_1.Utils.getParticleBaseVelocity(i),e={horizontal:0,vertical:0};return i.particles.move.straight?(e.horizontal=t.x,e.vertical=t.y,i.particles.move.random&&(e.horizontal*=Math.random(),e.vertical*=Math.random())):(e.horizontal=t.x+Math.random()-.5,e.vertical=t.y+Math.random()-.5),e},C.prototype.resetVelocity=function(){var i=this.container.options,t=C.calculateVelocity(i);this.velocity.horizontal=t.horizontal,this.velocity.vertical=t.vertical},C.prototype.update=function(i,t){var e=this.container,r=e.options;this.updater.update(t);var o=r.interactivity.events.onHover.mode,a=r.interactivity.events.onClick.mode;if(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.grab,o)&&this.grabber.grab(),Utils_1.Utils.isInArray(HoverMode_1.HoverMode.connect,r.interactivity.events.onHover.mode))for(var s=i+1;s<e.particles.count;s++){var l=e.particles.array[s];this.connecter.connect(l)}(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,o)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,a))&&this.bubbler.bubble(),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,o)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,a))&&this.repulser.repulse()},C.prototype.interact=function(i){this.interactionManager.interact(i)},C.prototype.draw=function(){this.drawer.draw()},C.prototype.isOverlapping=function(){for(var i=this.container,t=this,e=!1,r=0,o=0,a=i.particles.array.filter(function(i){return i!=t});o<a.length;o++){var s=a[o];if(r++,Utils_1.Utils.getDistanceBetweenCoordinates(t.position,s.position)<=t.radius+s.radius){e=!0;break}}return{collisionFound:e,iterations:r}},C.prototype.checkOverlap=function(i){var t=this.container,e=this,r=e.isOverlapping();r.iterations>=t.particles.count?t.particles.remove(this):r.collisionFound&&(e.position.x=i?i.x:Math.random()*t.canvas.dimension.width,e.position.y=i?i.y:Math.random()*t.canvas.dimension.height,e.checkOverlap())},C.prototype.calcPosition=function(i,t){var e,r,o={x:0,y:0};if(i.options.polygon.enable&&0<(null!==(r=null===(e=i.polygon.raw)||void 0===e?void 0:e.length)&&void 0!==r?r:0))if(t)o.x=t.x,o.y=t.y;else{var a=i.polygon.randomPointInPolygon();o.x=a.x,o.y=a.y}else o.x=t?t.x:Math.random()*i.canvas.dimension.width,o.y=t?t.y:Math.random()*i.canvas.dimension.height,o.x>i.canvas.dimension.width-2*this.radius?o.x-=this.radius:o.x<2*this.radius&&(o.x+=this.radius),o.y>i.canvas.dimension.height-2*this.radius?o.y-=this.radius:o.y<2*this.radius&&(o.y+=this.radius);return o},C}();exports.Particle=Particle;