"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ProcessBubbleType_1=require("../../../Enums/ProcessBubbleType"),Utils_1=require("../../Utils/Utils"),HoverMode_1=require("../../../Enums/Modes/HoverMode"),ClickMode_1=require("../../../Enums/Modes/ClickMode"),Constants_1=require("../../Utils/Constants"),ColorUtils_1=require("../../Utils/ColorUtils"),Bubbler=function(){function e(){}return e.reset=function(e){delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color},e.bubble=function(e){var i=e.options,t=i.interactivity.events.onHover.enable,b=i.interactivity.events.onHover.mode,l=i.interactivity.events.onClick.enable,o=i.interactivity.events.onClick.mode;t&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,b)?this.hoverBubble(e):l&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,o)&&this.clickBubble(e)},e.process=function(e,i,t,b,l){var o=l.bubbleObj.optValue;if(void 0!==o){var s=e.options.interactivity.modes.bubble.duration,r=e.retina.bubbleModeDistance,u=l.particlesObj.optValue,a=l.bubbleObj.value,n=l.particlesObj.value||0,c=l.type;if(o!==u)if(e.bubble.durationEnd)a&&(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete i.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete i.bubble.opacity);else if(t<=r){if((null!=a?a:n)!==o){var v=n-b*(n-o)/s;c===ProcessBubbleType_1.ProcessBubbleType.size&&(i.bubble.radius=v),c===ProcessBubbleType_1.ProcessBubbleType.opacity&&(i.bubble.opacity=v)}}else c===ProcessBubbleType_1.ProcessBubbleType.size&&delete i.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete i.bubble.opacity}},e.clickBubble=function(e){var i,t=e.options,b=e.interactivity.mouse.clickPosition;if(void 0!==b)for(var l=0,o=e.particles.spatialGrid.queryRadius(b,e.retina.bubbleModeDistance);l<o.length;l++){var s=o[l];if(void 0!==(null==s?void 0:s.position)){var r=Utils_1.Utils.getDistanceBetweenCoordinates(s.position,b),u=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;if(e.bubble.clicking){u>t.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),u>2*t.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1);var a={bubbleObj:{optValue:e.retina.bubbleModeSize,value:s.bubble.radius},particlesObj:{optValue:null!==(i=s.sizeValue)&&void 0!==i?i:e.retina.sizeValue,value:s.size.value},type:ProcessBubbleType_1.ProcessBubbleType.size};this.process(e,s,r,u,a);var n={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:s.bubble.opacity},particlesObj:{optValue:s.particlesOptions.opacity.value,value:s.opacity.value},type:ProcessBubbleType_1.ProcessBubbleType.opacity};this.process(e,s,r,u,n),!e.bubble.durationEnd&&r<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,s):delete s.bubble.color}}}},e.hoverBubble=function(e){var i=e.interactivity.mouse.position;if(void 0!==i)for(var t=0,b=e.particles.spatialGrid.queryRadiusWithDistance(i,e.retina.bubbleModeDistance);t<b.length;t++){var l=b[t],o=l.distance,s=l.particle;if(void 0!==(null==s?void 0:s.position)){var r=1-o/e.retina.bubbleModeDistance;o<=e.retina.bubbleModeDistance?0<=r&&e.interactivity.status===Constants_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,s,r),this.hoverBubbleOpacity(e,s,r),this.hoverBubbleColor(e,s)):this.reset(s),e.interactivity.status===Constants_1.Constants.mouseLeaveEvent&&this.reset(s)}}},e.hoverBubbleSize=function(e,i,t){var b,l=e.retina.bubbleModeSize;if(void 0!==l){var o=null!==(b=i.sizeValue)&&void 0!==b?b:e.retina.sizeValue,s=i.size.value;if(o<l){var r=s+(l-o)*t;i.bubble.radius=Utils_1.Utils.clamp(r,s,l)}else if(l<o){r=s-(o-l)*t;i.bubble.radius=Utils_1.Utils.clamp(r,l,s)}}},e.hoverBubbleOpacity=function(e,i,t){var b=e.options.interactivity.modes.bubble.opacity;if(void 0!==b){var l=i.particlesOptions.opacity.value,o=i.opacity.value;if(l<b){var s=o+(b-l)*t;i.bubble.opacity=Utils_1.Utils.clamp(s,o,b)}else if(b<l){s=o-(l-b)*t;i.bubble.opacity=Utils_1.Utils.clamp(s,b,o)}}},e.hoverBubbleColor=function(e,i){var t=e.options;if(void 0===i.bubble.color){var b=t.interactivity.modes.bubble.color;if(void 0===b)return;var l=void 0;if(b instanceof Array){var o=Utils_1.Utils.itemFromArray(b);l="string"==typeof o?{value:o}:o}else l="string"==typeof b?{value:b}:b;i.bubble.color=ColorUtils_1.ColorUtils.colorToRgb(l)}},e}();exports.Bubbler=Bubbler;