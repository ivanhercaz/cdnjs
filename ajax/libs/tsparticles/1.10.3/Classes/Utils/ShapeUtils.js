"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ShapeUtils = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _ShapeType = require("../../Enums/ShapeType");

var ShapeUtils = /*#__PURE__*/function () {
  function ShapeUtils() {
    (0, _classCallCheck2["default"])(this, ShapeUtils);
  }

  (0, _createClass2["default"])(ShapeUtils, null, [{
    key: "drawShape",
    value: function drawShape(context, particle, radius, stroke) {
      var pos = {
        x: particle.offset.x,
        y: particle.offset.y
      };
      var sides = particle.container.options.particles.shape.polygon.sides;

      switch (particle.shape) {
        case _ShapeType.ShapeType.line:
          this.drawLineShape(context, radius, stroke);
          break;

        case _ShapeType.ShapeType.circle:
          this.drawCircleShape(context, radius, pos);
          break;

        case _ShapeType.ShapeType.edge:
        case _ShapeType.ShapeType.square:
          this.drawSquareShape(context, radius);
          break;

        case _ShapeType.ShapeType.triangle:
          this.drawTriangleShape(context, radius);
          break;

        case _ShapeType.ShapeType.polygon:
          this.drawPolygonShape(context, radius, sides);
          break;

        case _ShapeType.ShapeType.star:
          this.drawStarShape(context, radius, sides);
          break;

        case _ShapeType.ShapeType.heart:
          this.drawHeartShape(context, radius);
          break;

        case _ShapeType.ShapeType["char"]:
        case _ShapeType.ShapeType.character:
          this.drawTextShape(context, particle.character, particle.text, radius);
          break;

        case _ShapeType.ShapeType.image:
          this.drawImageShape(context, particle, radius);
          break;
      }
    }
  }, {
    key: "drawTriangleShape",
    value: function drawTriangleShape(context, radius) {
      var start = {
        x: -radius,
        y: radius / 1.66
      };
      var side = {
        count: {
          denominator: 2,
          numerator: 3
        },
        length: radius * 2
      };
      this.drawGenericPolygonShape(context, start, side);
    }
  }, {
    key: "drawPolygonShape",
    value: function drawPolygonShape(context, radius, sides) {
      var start = {
        x: -radius / (sides / 3.5),
        y: -radius / (2.66 / 3.5)
      };
      var side = {
        count: {
          denominator: 1,
          numerator: sides
        },
        length: radius * 2.66 / (sides / 3)
      };
      this.drawGenericPolygonShape(context, start, side);
    }
  }, {
    key: "drawStarShape",
    value: function drawStarShape(context, radius, sides) {
      var start = {
        x: -radius * 2 / (sides / 4),
        y: -radius / (2 * 2.66 / 3.5)
      };
      var side = {
        count: {
          denominator: 2,
          numerator: sides
        },
        length: radius * 2 * 2.66 / (sides / 3)
      };
      this.drawGenericPolygonShape(context, start, side);
    }
  }, {
    key: "drawLineShape",
    value: function drawLineShape(context, length, stroke) {
      context.moveTo(0, -length / 2);
      context.lineTo(0, length / 2);
      context.strokeStyle = stroke.color;
      context.lineWidth = stroke.width;
      context.stroke();
    }
  }, {
    key: "drawCircleShape",
    value: function drawCircleShape(context, radius, center) {
      context.arc(center.x, center.y, radius, 0, Math.PI * 2, false);
    }
  }, {
    key: "drawSquareShape",
    value: function drawSquareShape(context, side) {
      context.rect(-side, -side, side * 2, side * 2);
    }
  }, {
    key: "drawHeartShape",
    value: function drawHeartShape(context, radius) {
      var x = -radius / 2;
      var y = -radius / 2;
      context.moveTo(x, y + radius / 4);
      context.quadraticCurveTo(x, y, x + radius / 4, y);
      context.quadraticCurveTo(x + radius / 2, y, x + radius / 2, y + radius / 4);
      context.quadraticCurveTo(x + radius / 2, y, x + radius * 3 / 4, y);
      context.quadraticCurveTo(x + radius, y, x + radius, y + radius / 4);
      context.quadraticCurveTo(x + radius, y + radius / 2, x + radius * 3 / 4, y + radius * 3 / 4);
      context.lineTo(x + radius / 2, y + radius);
      context.lineTo(x + radius / 4, y + radius * 3 / 4);
      context.quadraticCurveTo(x, y + radius / 2, x, y + radius / 4);
    }
  }, {
    key: "drawTextShape",
    value: function drawTextShape(context, character, text, radius) {
      if (text === undefined || character === undefined) {
        return;
      }

      var style = character.style;
      var weight = character.weight;
      var size = Math.round(radius) * 2;
      var font = character.font;
      var fill = character.fill;
      context.font = "".concat(style, " ").concat(weight, " ").concat(size, "px \"").concat(font, "\"");
      var pos = {
        x: -radius / 2,
        y: radius / 2
      };

      if (fill) {
        context.fillText(text, pos.x, pos.y);
      } else {
        context.strokeText(text, pos.x, pos.y);
      }
    }
  }, {
    key: "drawGenericPolygonShape",
    value: function drawGenericPolygonShape(context, start, side) {
      // By Programming Thomas - https://programmingthomas.wordpress.com/2013/04/03/n-sided-shapes/
      var sideCount = side.count.numerator * side.count.denominator;
      var decimalSides = side.count.numerator / side.count.denominator;
      var interiorAngleDegrees = 180 * (decimalSides - 2) / decimalSides;
      var interiorAngle = Math.PI - Math.PI * interiorAngleDegrees / 180; // convert to radians

      if (!context) {
        return;
      }

      context.save();
      context.beginPath();
      context.translate(start.x, start.y);
      context.moveTo(0, 0);

      for (var i = 0; i < sideCount; i++) {
        context.lineTo(side.length, 0);
        context.translate(side.length, 0);
        context.rotate(interiorAngle);
      } // c.stroke();


      context.fill();
      context.restore();
    }
  }, {
    key: "drawImageShape",
    value: function drawImageShape(context, particle, radius) {
      var _particle$image;

      if (!context) {
        return;
      }

      var imgObj = (_particle$image = particle.image) === null || _particle$image === void 0 ? void 0 : _particle$image.data.obj;

      if (!imgObj) {
        return;
      }

      var ratio = 1;

      if (particle.image) {
        ratio = particle.image.ratio;
      }

      var pos = {
        x: -radius,
        y: -radius
      };
      context.drawImage(imgObj, pos.x, pos.y, radius * 2, radius * 2 / ratio);
    }
  }]);
  return ShapeUtils;
}();

exports.ShapeUtils = ShapeUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9DbGFzc2VzL1V0aWxzL1NoYXBlVXRpbHMudHMiXSwibmFtZXMiOlsiU2hhcGVVdGlscyIsImNvbnRleHQiLCJwYXJ0aWNsZSIsInJhZGl1cyIsInN0cm9rZSIsInBvcyIsIngiLCJvZmZzZXQiLCJ5Iiwic2lkZXMiLCJjb250YWluZXIiLCJvcHRpb25zIiwicGFydGljbGVzIiwic2hhcGUiLCJwb2x5Z29uIiwiU2hhcGVUeXBlIiwibGluZSIsImRyYXdMaW5lU2hhcGUiLCJjaXJjbGUiLCJkcmF3Q2lyY2xlU2hhcGUiLCJlZGdlIiwic3F1YXJlIiwiZHJhd1NxdWFyZVNoYXBlIiwidHJpYW5nbGUiLCJkcmF3VHJpYW5nbGVTaGFwZSIsImRyYXdQb2x5Z29uU2hhcGUiLCJzdGFyIiwiZHJhd1N0YXJTaGFwZSIsImhlYXJ0IiwiZHJhd0hlYXJ0U2hhcGUiLCJjaGFyYWN0ZXIiLCJkcmF3VGV4dFNoYXBlIiwidGV4dCIsImltYWdlIiwiZHJhd0ltYWdlU2hhcGUiLCJzdGFydCIsInNpZGUiLCJjb3VudCIsImRlbm9taW5hdG9yIiwibnVtZXJhdG9yIiwibGVuZ3RoIiwiZHJhd0dlbmVyaWNQb2x5Z29uU2hhcGUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJzdHJva2VTdHlsZSIsImNvbG9yIiwibGluZVdpZHRoIiwid2lkdGgiLCJjZW50ZXIiLCJhcmMiLCJNYXRoIiwiUEkiLCJyZWN0IiwicXVhZHJhdGljQ3VydmVUbyIsInVuZGVmaW5lZCIsInN0eWxlIiwid2VpZ2h0Iiwic2l6ZSIsInJvdW5kIiwiZm9udCIsImZpbGwiLCJmaWxsVGV4dCIsInN0cm9rZVRleHQiLCJzaWRlQ291bnQiLCJkZWNpbWFsU2lkZXMiLCJpbnRlcmlvckFuZ2xlRGVncmVlcyIsImludGVyaW9yQW5nbGUiLCJzYXZlIiwiYmVnaW5QYXRoIiwidHJhbnNsYXRlIiwiaSIsInJvdGF0ZSIsInJlc3RvcmUiLCJpbWdPYmoiLCJkYXRhIiwib2JqIiwicmF0aW8iLCJkcmF3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QUFDSDs7QUFFRCxVQUFNdkUsR0FBRyxHQUFHO0FBQ1JDLFFBQUFBLENBQUMsRUFBRSxDQUFDSCxNQURJO0FBRVJLLFFBQUFBLENBQUMsRUFBRSxDQUFDTDtBQUZJLE9BQVo7QUFLQUYsTUFBQUEsT0FBTyxDQUFDNEUsU0FBUixDQUFrQkosTUFBbEIsRUFBMEJwRSxHQUFHLENBQUNDLENBQTlCLEVBQWlDRCxHQUFHLENBQUNHLENBQXJDLEVBQXdDTCxNQUFNLEdBQUcsQ0FBakQsRUFBb0RBLE1BQU0sR0FBRyxDQUFULEdBQWF5RSxLQUFqRTtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtQYXJ0aWNsZX0gZnJvbSBcIi4uL1BhcnRpY2xlXCI7XG5pbXBvcnQge0lTdHJva2V9IGZyb20gXCIuLi8uLi9JbnRlcmZhY2VzL09wdGlvbnMvUGFydGljbGVzL1NoYXBlL0lTdHJva2VcIjtcbmltcG9ydCB7U2hhcGVUeXBlfSBmcm9tIFwiLi4vLi4vRW51bXMvU2hhcGVUeXBlXCI7XG5pbXBvcnQge0lDb29yZGluYXRlc30gZnJvbSBcIi4uLy4uL0ludGVyZmFjZXMvSUNvb3JkaW5hdGVzXCI7XG5pbXBvcnQge0lTaWRlfSBmcm9tIFwiLi4vLi4vSW50ZXJmYWNlcy9JU2lkZVwiO1xuaW1wb3J0IHtJQ2hhcmFjdGVyU2hhcGV9IGZyb20gXCIuLi8uLi9JbnRlcmZhY2VzL09wdGlvbnMvUGFydGljbGVzL1NoYXBlL0lDaGFyYWN0ZXJTaGFwZVwiO1xuXG5leHBvcnQgY2xhc3MgU2hhcGVVdGlscyB7XG4gICAgcHVibGljIHN0YXRpYyBkcmF3U2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlOiBQYXJ0aWNsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpdXM6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2U6IElTdHJva2UpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcG9zID0ge1xuICAgICAgICAgICAgeDogcGFydGljbGUub2Zmc2V0LngsXG4gICAgICAgICAgICB5OiBwYXJ0aWNsZS5vZmZzZXQueSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzaWRlcyA9IHBhcnRpY2xlLmNvbnRhaW5lci5vcHRpb25zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLnNpZGVzO1xuXG4gICAgICAgIHN3aXRjaCAocGFydGljbGUuc2hhcGUpIHtcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLmxpbmU6XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3TGluZVNoYXBlKGNvbnRleHQsIHJhZGl1cywgc3Ryb2tlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuY2lyY2xlOlxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd0NpcmNsZVNoYXBlKGNvbnRleHQsIHJhZGl1cywgcG9zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuZWRnZTpcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLnNxdWFyZTpcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdTcXVhcmVTaGFwZShjb250ZXh0LCByYWRpdXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS50cmlhbmdsZTpcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdUcmlhbmdsZVNoYXBlKGNvbnRleHQsIHJhZGl1cyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLnBvbHlnb246XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3UG9seWdvblNoYXBlKGNvbnRleHQsIHJhZGl1cywgc2lkZXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5zdGFyOlxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd1N0YXJTaGFwZShjb250ZXh0LCByYWRpdXMsIHNpZGVzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuaGVhcnQ6XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3SGVhcnRTaGFwZShjb250ZXh0LCByYWRpdXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5jaGFyOlxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuY2hhcmFjdGVyOlxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd1RleHRTaGFwZShjb250ZXh0LCBwYXJ0aWNsZS5jaGFyYWN0ZXIsIHBhcnRpY2xlLnRleHQsIHJhZGl1cyk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuaW1hZ2U6XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3SW1hZ2VTaGFwZShjb250ZXh0LCBwYXJ0aWNsZSwgcmFkaXVzKTtcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd1RyaWFuZ2xlU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCByYWRpdXM6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBzdGFydDogSUNvb3JkaW5hdGVzID0ge1xuICAgICAgICAgICAgeDogLXJhZGl1cyxcbiAgICAgICAgICAgIHk6IHJhZGl1cyAvIDEuNjYsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgc2lkZTogSVNpZGUgPSB7XG4gICAgICAgICAgICBjb3VudDoge1xuICAgICAgICAgICAgICAgIGRlbm9taW5hdG9yOiAyLFxuICAgICAgICAgICAgICAgIG51bWVyYXRvcjogMyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZW5ndGg6IHJhZGl1cyAqIDIsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5kcmF3R2VuZXJpY1BvbHlnb25TaGFwZShjb250ZXh0LCBzdGFydCwgc2lkZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd1BvbHlnb25TaGFwZShjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHJhZGl1czogbnVtYmVyLCBzaWRlczogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHN0YXJ0OiBJQ29vcmRpbmF0ZXMgPSB7XG4gICAgICAgICAgICB4OiAtcmFkaXVzIC8gKHNpZGVzIC8gMy41KSxcbiAgICAgICAgICAgIHk6IC1yYWRpdXMgLyAoMi42NiAvIDMuNSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNpZGU6IElTaWRlID0ge1xuICAgICAgICAgICAgY291bnQ6IHtcbiAgICAgICAgICAgICAgICBkZW5vbWluYXRvcjogMSxcbiAgICAgICAgICAgICAgICBudW1lcmF0b3I6IHNpZGVzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlbmd0aDogcmFkaXVzICogMi42NiAvIChzaWRlcyAvIDMpLFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZHJhd0dlbmVyaWNQb2x5Z29uU2hhcGUoY29udGV4dCwgc3RhcnQsIHNpZGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRyYXdTdGFyU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCByYWRpdXM6IG51bWJlciwgc2lkZXM6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBzdGFydDogSUNvb3JkaW5hdGVzID0ge1xuICAgICAgICAgICAgeDogLXJhZGl1cyAqIDIgLyAoc2lkZXMgLyA0KSxcbiAgICAgICAgICAgIHk6IC1yYWRpdXMgLyAoMiAqIDIuNjYgLyAzLjUpLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaWRlOiBJU2lkZSA9IHtcbiAgICAgICAgICAgIGNvdW50OiB7XG4gICAgICAgICAgICAgICAgZGVub21pbmF0b3I6IDIsXG4gICAgICAgICAgICAgICAgbnVtZXJhdG9yOiBzaWRlcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZW5ndGg6IHJhZGl1cyAqIDIgKiAyLjY2IC8gKHNpZGVzIC8gMyksXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5kcmF3R2VuZXJpY1BvbHlnb25TaGFwZShjb250ZXh0LCBzdGFydCwgc2lkZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0xpbmVTaGFwZShjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIGxlbmd0aDogbnVtYmVyLCBzdHJva2U6IElTdHJva2UpOiB2b2lkIHtcbiAgICAgICAgY29udGV4dC5tb3ZlVG8oMCwgLWxlbmd0aCAvIDIpO1xuICAgICAgICBjb250ZXh0LmxpbmVUbygwLCBsZW5ndGggLyAyKTtcbiAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IHN0cm9rZS5jb2xvcjtcbiAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBzdHJva2Uud2lkdGg7XG4gICAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0NpcmNsZVNoYXBlKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcmFkaXVzOiBudW1iZXIsIGNlbnRlcjogSUNvb3JkaW5hdGVzKTogdm9pZCB7XG4gICAgICAgIGNvbnRleHQuYXJjKGNlbnRlci54LCBjZW50ZXIueSwgcmFkaXVzLCAwLCBNYXRoLlBJICogMiwgZmFsc2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRyYXdTcXVhcmVTaGFwZShjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHNpZGU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb250ZXh0LnJlY3QoLXNpZGUsIC1zaWRlLCBzaWRlICogMiwgc2lkZSAqIDIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRyYXdIZWFydFNoYXBlKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcmFkaXVzOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeCA9IC1yYWRpdXMgLyAyO1xuICAgICAgICBjb25zdCB5ID0gLXJhZGl1cyAvIDI7XG5cbiAgICAgICAgY29udGV4dC5tb3ZlVG8oeCwgeSArIHJhZGl1cyAvIDQpO1xuICAgICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8oeCwgeSwgeCArIHJhZGl1cyAvIDQsIHkpO1xuICAgICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8oeCArIHJhZGl1cyAvIDIsIHksIHggKyByYWRpdXMgLyAyLCB5ICsgcmFkaXVzIC8gNCk7XG4gICAgICAgIGNvbnRleHQucXVhZHJhdGljQ3VydmVUbyh4ICsgcmFkaXVzIC8gMiwgeSwgeCArIHJhZGl1cyAqIDMgLyA0LCB5KTtcbiAgICAgICAgY29udGV4dC5xdWFkcmF0aWNDdXJ2ZVRvKHggKyByYWRpdXMsIHksIHggKyByYWRpdXMsIHkgKyByYWRpdXMgLyA0KTtcbiAgICAgICAgY29udGV4dC5xdWFkcmF0aWNDdXJ2ZVRvKHggKyByYWRpdXMsIHkgKyByYWRpdXMgLyAyLCB4ICsgcmFkaXVzICogMyAvIDQsIHkgKyByYWRpdXMgKiAzIC8gNCk7XG4gICAgICAgIGNvbnRleHQubGluZVRvKHggKyByYWRpdXMgLyAyLCB5ICsgcmFkaXVzKTtcbiAgICAgICAgY29udGV4dC5saW5lVG8oeCArIHJhZGl1cyAvIDQsIHkgKyByYWRpdXMgKiAzIC8gNCk7XG4gICAgICAgIGNvbnRleHQucXVhZHJhdGljQ3VydmVUbyh4LCB5ICsgcmFkaXVzIC8gMiwgeCwgeSArIHJhZGl1cyAvIDQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRyYXdUZXh0U2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyOiBJQ2hhcmFjdGVyU2hhcGUgfCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpdXM6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAodGV4dCA9PT0gdW5kZWZpbmVkIHx8IGNoYXJhY3RlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHlsZSA9IGNoYXJhY3Rlci5zdHlsZTtcbiAgICAgICAgY29uc3Qgd2VpZ2h0ID0gY2hhcmFjdGVyLndlaWdodDtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IE1hdGgucm91bmQocmFkaXVzKSAqIDI7XG4gICAgICAgIGNvbnN0IGZvbnQgPSBjaGFyYWN0ZXIuZm9udDtcbiAgICAgICAgY29uc3QgZmlsbCA9IGNoYXJhY3Rlci5maWxsO1xuXG4gICAgICAgIGNvbnRleHQuZm9udCA9IGAke3N0eWxlfSAke3dlaWdodH0gJHtzaXplfXB4IFwiJHtmb250fVwiYDtcblxuICAgICAgICBjb25zdCBwb3MgPSB7XG4gICAgICAgICAgICB4OiAtcmFkaXVzIC8gMixcbiAgICAgICAgICAgIHk6IHJhZGl1cyAvIDIsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGZpbGwpIHtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFRleHQodGV4dCwgcG9zLngsIHBvcy55KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlVGV4dCh0ZXh0LCBwb3MueCwgcG9zLnkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0dlbmVyaWNQb2x5Z29uU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBzdGFydDogSUNvb3JkaW5hdGVzLCBzaWRlOiBJU2lkZSk6IHZvaWQge1xuICAgICAgICAvLyBCeSBQcm9ncmFtbWluZyBUaG9tYXMgLSBodHRwczovL3Byb2dyYW1taW5ndGhvbWFzLndvcmRwcmVzcy5jb20vMjAxMy8wNC8wMy9uLXNpZGVkLXNoYXBlcy9cbiAgICAgICAgY29uc3Qgc2lkZUNvdW50ID0gc2lkZS5jb3VudC5udW1lcmF0b3IgKiBzaWRlLmNvdW50LmRlbm9taW5hdG9yO1xuICAgICAgICBjb25zdCBkZWNpbWFsU2lkZXMgPSBzaWRlLmNvdW50Lm51bWVyYXRvciAvIHNpZGUuY291bnQuZGVub21pbmF0b3I7XG4gICAgICAgIGNvbnN0IGludGVyaW9yQW5nbGVEZWdyZWVzID0gKDE4MCAqIChkZWNpbWFsU2lkZXMgLSAyKSkgLyBkZWNpbWFsU2lkZXM7XG4gICAgICAgIGNvbnN0IGludGVyaW9yQW5nbGUgPSBNYXRoLlBJIC0gTWF0aC5QSSAqIGludGVyaW9yQW5nbGVEZWdyZWVzIC8gMTgwOyAvLyBjb252ZXJ0IHRvIHJhZGlhbnNcblxuICAgICAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQuc2F2ZSgpO1xuICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZShzdGFydC54LCBzdGFydC55KTtcbiAgICAgICAgY29udGV4dC5tb3ZlVG8oMCwgMCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaWRlQ291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29udGV4dC5saW5lVG8oc2lkZS5sZW5ndGgsIDApO1xuICAgICAgICAgICAgY29udGV4dC50cmFuc2xhdGUoc2lkZS5sZW5ndGgsIDApO1xuICAgICAgICAgICAgY29udGV4dC5yb3RhdGUoaW50ZXJpb3JBbmdsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjLnN0cm9rZSgpO1xuICAgICAgICBjb250ZXh0LmZpbGwoKTtcbiAgICAgICAgY29udGV4dC5yZXN0b3JlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZHJhd0ltYWdlU2hhcGUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBwYXJ0aWNsZTogUGFydGljbGUsIHJhZGl1czogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaW1nT2JqID0gcGFydGljbGUuaW1hZ2U/LmRhdGEub2JqO1xuXG4gICAgICAgIGlmICghaW1nT2JqKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmF0aW8gPSAxO1xuXG4gICAgICAgIGlmIChwYXJ0aWNsZS5pbWFnZSkge1xuICAgICAgICAgICAgcmF0aW8gPSBwYXJ0aWNsZS5pbWFnZS5yYXRpbztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvcyA9IHtcbiAgICAgICAgICAgIHg6IC1yYWRpdXMsXG4gICAgICAgICAgICB5OiAtcmFkaXVzLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltZ09iaiwgcG9zLngsIHBvcy55LCByYWRpdXMgKiAyLCByYWRpdXMgKiAyIC8gcmF0aW8pO1xuICAgIH1cbn1cbiJdfQ==