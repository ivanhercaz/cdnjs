"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Particle_1=require("./Particle"),Emitter=function(){function t(t,i,e){var o,n,s;this.container=t,this.initialPosition=e,this.emitterOptions=i,this.position=null!==(o=this.initialPosition)&&void 0!==o?o:this.calcPosition(),this.size=null!==(n=this.emitterOptions.size)&&void 0!==n?n:{height:0,width:0},this.lifeCount=null!==(s=this.emitterOptions.life.count)&&void 0!==s?s:-1,this.start()}return t.prototype.emit=function(){for(var t=this.container,i=this.position,e=t.canvas.dimension.height*this.size.width/100,o=t.canvas.dimension.height*this.size.height/100,n=0;n<this.emitterOptions.rate.quantity;n++){var s=new Particle_1.Particle(t,{x:i.x+e*(Math.random()-.5),y:i.y+o*(Math.random()-.5)},this);t.particles.addParticle(s)}},t.prototype.start=function(){var t=this;(0<this.lifeCount||!this.emitterOptions.life.count)&&(void 0===this.startInterval&&(this.startInterval=window.setInterval(function(){t.emit()},1e3*this.emitterOptions.rate.delay)),0<this.lifeCount&&this.prepareToDie())},t.prototype.stop=function(){var t=this.startInterval;void 0!==t&&(clearInterval(t),delete this.startInterval)},t.prototype.resize=function(){var t;this.position=null!==(t=this.initialPosition)&&void 0!==t?t:this.calcPosition()},t.prototype.prepareToDie=function(){var t,i=this;0<this.lifeCount&&void 0!==(null===(t=this.emitterOptions.life)||void 0===t?void 0:t.duration)&&window.setTimeout(function(){var t;i.stop(),i.lifeCount--,0<i.lifeCount?(i.position=i.calcPosition(),window.setTimeout(function(){i.start()},null!==(t=i.emitterOptions.life.delay)&&void 0!==t?t:0)):i.destroy()},1e3*this.emitterOptions.life.duration)},t.prototype.destroy=function(){var t=this.container,i=t.emitters.indexOf(this);0<=i&&t.emitters.splice(i,1)},t.prototype.calcPosition=function(){var t,i=this.container,e=null!==(t=this.emitterOptions.position)&&void 0!==t?t:{x:100*Math.random(),y:100*Math.random()};return{x:e.x/100*i.canvas.dimension.width,y:e.y/100*i.canvas.dimension.height}},t}();exports.Emitter=Emitter;