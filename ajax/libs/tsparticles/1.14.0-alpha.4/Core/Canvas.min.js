"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Constants_1=require("../Utils/Constants"),CanvasUtils_1=require("../Utils/CanvasUtils"),ColorUtils_1=require("../Utils/ColorUtils"),Canvas=function(){function t(t){this.container=t,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}return t.prototype.init=function(){this.resize();var t=this.container.options,o=t.backgroundMask.cover.color,i=t.particles.move.trail;this.coverColor=ColorUtils_1.ColorUtils.colorToRgb(o),this.trailFillColor=ColorUtils_1.ColorUtils.colorToRgb(i.fillColor),this.paint()},t.prototype.loadCanvas=function(t,o){var i;t.className||(t.className=Constants_1.Constants.canvasClass),this.generatedCanvas&&null!==(i=this.element)&&void 0!==i&&i.remove(),this.generatedCanvas=null!=o&&o,this.element=t,this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()},t.prototype.destroy=function(){var t;this.generatedCanvas&&null!==(t=this.element)&&void 0!==t&&t.remove(),this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.resize=function(){this.element&&(this.element.width=this.size.width,this.element.height=this.size.height)},t.prototype.paint=function(){var t=this.container.options;this.context&&(t.backgroundMask.enable&&t.backgroundMask.cover&&this.coverColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.coverColor)):this.paintBase())},t.prototype.clear=function(){var t=this.container.options,o=t.particles.move.trail;t.backgroundMask.enable?this.paint():o.enable&&0<o.length&&this.trailFillColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromColor(this.trailFillColor,1/o.length)):this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.isPointInPath=function(t,o){var i,e;return null!==(e=null===(i=this.context)||void 0===i?void 0:i.isPointInPath(t,o.x,o.y))&&void 0!==e&&e},t.prototype.drawLinkedLine=function(t,o,i){var e,n=this.container,s=n.options,l={x:t.position.x+t.offset.x,y:t.position.y+t.offset.y},r={x:o.position.x+o.offset.x,y:o.position.y+o.offset.y},a=this.context;if(a){var c,C=s.particles.twinkle.lines,d=C.frequency,h=C.color,v=void 0!==h?ColorUtils_1.ColorUtils.colorToRgb(h):void 0;if(C.enable&&Math.random()<d&&void 0!==v)c=v,i=C.opacity;else if(n.particles.lineLinkedColor===Constants_1.Constants.randomColorValue)c=ColorUtils_1.ColorUtils.getRandomRgbColor();else if("mid"==n.particles.lineLinkedColor&&t.color&&o.color){var p=t.color,u=o.color;c=ColorUtils_1.ColorUtils.mix(p,u,t.size.value,o.size.value)}else c=n.particles.lineLinkedColor;var f=null!==(e=t.lineLinkedWidth)&&void 0!==e?e:n.retina.lineLinkedWidth;CanvasUtils_1.CanvasUtils.drawLineLinked(a,f,l,r,s.backgroundMask.enable,c,i,t.particlesOptions.lineLinked.shadow)}},t.prototype.drawConnectLine=function(t,o){var i,e=this.lineStyle(t,o);if(e){var n=this.context;if(n){var s={x:t.position.x+t.offset.x,y:t.position.y+t.offset.y},l={x:o.position.x+o.offset.x,y:o.position.y+o.offset.y};CanvasUtils_1.CanvasUtils.drawConnectLine(n,null!==(i=t.lineLinkedWidth)&&void 0!==i?i:this.container.retina.lineLinkedWidth,e,s,l)}}},t.prototype.drawGrabLine=function(t,o,i){var e,n=this.container,s=t.particlesOptions.lineLinked.color,l=n.particles.grabLineColor||("string"==typeof s?ColorUtils_1.ColorUtils.stringToRgb(s):ColorUtils_1.ColorUtils.colorToRgb(s));l==Constants_1.Constants.randomColorValue&&(l=ColorUtils_1.ColorUtils.getRandomRgbColor()),n.particles.grabLineColor=l;var r,a=n.canvas.context;if(a&&void 0!==(r=n.particles.grabLineColor===Constants_1.Constants.randomColorValue?ColorUtils_1.ColorUtils.getRandomRgbColor():n.particles.grabLineColor)){var c={x:t.position.x+t.offset.x,y:t.position.y+t.offset.y};CanvasUtils_1.CanvasUtils.drawGrabLine(a,null!==(e=t.lineLinkedWidth)&&void 0!==e?e:n.retina.lineLinkedWidth,c,i,r,o)}},t.prototype.drawParticle=function(t){var o,i,e,n=this.container.options,s=t.particlesOptions.twinkle.particles,l=s.frequency,r="string"==typeof s.color?{value:s.color}:s.color,a=void 0!==r?ColorUtils_1.ColorUtils.colorToRgb(r):void 0,c=s.enable&&Math.random()<l,C=null!==(o=t.bubble.radius)&&void 0!==o?o:t.size.value,d=c?s.opacity:null!==(i=t.bubble.opacity)&&void 0!==i?i:t.opacity.value,h=t.infectionStage,v=n.infection.stages,p=void 0!==h?v[h].color:void 0,u=p?ColorUtils_1.ColorUtils.colorToRgb(p):void 0,f=c&&void 0!==a?a:null!==(e=null!=u?u:t.bubble.color)&&void 0!==e?e:t.color,g=void 0!==f?ColorUtils_1.ColorUtils.getStyleFromColor(f,d):void 0;this.context&&g&&CanvasUtils_1.CanvasUtils.drawParticle(this.container,this.context,t,g,n.backgroundMask.enable,C,d,t.particlesOptions.shadow)},t.prototype.drawPlugin=function(t){this.context&&CanvasUtils_1.CanvasUtils.drawPlugin(this.context,t)},t.prototype.paintBase=function(t){this.context&&CanvasUtils_1.CanvasUtils.paintBase(this.context,this.size,t)},t.prototype.lineStyle=function(t,o){var i=this.container.options.interactivity.modes.connect;if(t.color&&o.color&&this.context)return CanvasUtils_1.CanvasUtils.gradient(this.context,t,o,i.lineLinked.opacity)},t.prototype.initBackground=function(){var t=this.container.options.background,o=this.element;if(o){var i=o.style;if(t.color){var e=ColorUtils_1.ColorUtils.colorToRgb(t.color);e&&(i.backgroundColor=ColorUtils_1.ColorUtils.getStyleFromColor(e,t.opacity))}t.image&&(i.backgroundImage=t.image),t.position&&(i.backgroundPosition=t.position),t.repeat&&(i.backgroundRepeat=t.repeat),t.size&&(i.backgroundSize=t.size)}},t}();exports.Canvas=Canvas;