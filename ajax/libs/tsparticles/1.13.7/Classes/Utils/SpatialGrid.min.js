"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Utils_1=require("./Utils"),SpatialGrid=function(){function t(t){this.grid=[],this.cellSize=20,this.widthSegment=Math.round(t.width/this.cellSize),this.heightSegment=Math.round(t.height/this.cellSize)}return t.prototype.setGrid=function(t,i){for(var e=[],r=null!=i&&i.width?(null==i?void 0:i.width)/this.cellSize:this.widthSegment,s=null!=i&&i.height?(null==i?void 0:i.height)/this.cellSize:this.heightSegment,h=0,n=t;h<n.length;h++){var o=n[h],a={x:o.position.x+o.offset.x,y:o.position.y+o.offset.y},y=this.index(a);Array.isArray(e[y.x])||(e[y.x]=[]),Array.isArray(e[y.x][y.y])||(e[y.x][y.y]=[]),e[y.x][y.y].push(o)}this.widthSegment=r,this.heightSegment=s,this.grid=e},t.prototype.queryInCell=function(t){var i=this.index(t);return Array.isArray(this.grid[i.x])&&Array.isArray(this.grid[i.x][i.y])&&this.grid[i.x][i.y]||[]},t.prototype.queryRadius=function(t,i){for(var e=this.index(t),r=this.radius({x:i,y:i}),s=[],h=0,n=this.select(this.indexOp(e,"-",r),this.indexOp(e,"+",r));h<n.length;h++){var o=n[h],a={x:o.position.x+o.offset.x,y:o.position.y+o.offset.y};Utils_1.Utils.getDistanceBetweenCoordinates(a,t)<=i&&s.push(o)}return s},t.prototype.queryRadiusWithDistance=function(t,i){for(var e=this.index(t),r=this.radius({x:i,y:i}),s=[],h=0,n=this.select(this.indexOp(e,"-",r),this.indexOp(e,"+",r));h<n.length;h++){var o=n[h],a={x:o.position.x+o.offset.x,y:o.position.y+o.offset.y},y=Utils_1.Utils.getDistanceBetweenCoordinates(a,t);y<=i&&s.push({distance:y,particle:o})}return s},t.prototype.select=function(t,i){for(var e=[],r=t.x;r<=i.x;r++)if(Array.isArray(this.grid[r]))for(var s=t.y;s<=i.y;s++)if(Array.isArray(this.grid[r][s]))for(var h=0,n=this.grid[r][s];h<n.length;h++){var o=n[h];e.push(o)}return e},t.prototype.index=function(t){return{x:Math.round(t.x/this.widthSegment),y:Math.round(t.y/this.heightSegment)}},t.prototype.radius=function(t){return{x:Math.ceil(t.x/this.widthSegment),y:Math.ceil(t.y/this.heightSegment)}},t.prototype.indexOp=function(t,i,e){return"+"==i?{x:this.clamp(t.x+e.x),y:this.clamp(t.y+e.y)}:{x:this.clamp(t.x-e.x),y:this.clamp(t.y-e.y)}},t.prototype.clamp=function(t){return Utils_1.Utils.clamp(t,0,this.cellSize)},t}();exports.SpatialGrid=SpatialGrid;