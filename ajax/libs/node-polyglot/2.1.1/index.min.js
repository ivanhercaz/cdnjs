"use strict";var forEach=require("for-each"),warning=require("warning"),has=require("has"),trim=require("string.prototype.trim"),warn=function(r){warning(!1,r)},replace=String.prototype.replace,split=String.prototype.split,delimeter="||||",pluralTypes={arabic:function(r){return r<3?r:3<=r%100&&r%100<=10?3:11<=r%100?4:5},chinese:function(){return 0},german:function(r){return 1!==r?1:0},french:function(r){return 1<r?1:0},russian:function(r){return r%10==1&&r%100!=11?0:2<=r%10&&r%10<=4&&(r%100<10||20<=r%100)?1:2},czech:function(r){return 1===r?0:2<=r&&r<=4?1:2},polish:function(r){return 1===r?0:2<=r%10&&r%10<=4&&(r%100<10||20<=r%100)?1:2},icelandic:function(r){return r%10!=1||r%100==11?1:0}},pluralTypeToLanguages={arabic:["ar"],chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru","lt"],czech:["cs","sk"],polish:["pl"],icelandic:["is"]};function langToTypeMap(r){var e={};return forEach(r,function(r,t){forEach(r,function(r){e[r]=t})}),e}function pluralTypeName(r){var t=langToTypeMap(pluralTypeToLanguages);return t[r]||t[split.call(r,/-/,1)[0]]||t.en}function pluralTypeIndex(r,t){return pluralTypes[pluralTypeName(r)](t)}var dollarRegex=/\$/g,dollarBillsYall="$$",tokenRegex=/%\{(.*?)\}/g;function transformPhrase(r,t,e){if("string"!=typeof r)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return r;var n=r,o="number"==typeof t?{smart_count:t}:t;if(null!=o.smart_count&&n){var l=split.call(n,delimeter);n=trim(l[pluralTypeIndex(e||"en",o.smart_count)]||l[0])}return n=replace.call(n,tokenRegex,function(r,t){return has(o,t)&&null!=o[t]?replace.call(o[t],dollarRegex,dollarBillsYall):""})}function Polyglot(r){var t=r||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en",this.allowMissing=!!t.allowMissing,this.warn=t.warn||warn}Polyglot.prototype.locale=function(r){return r&&(this.currentLocale=r),this.currentLocale},Polyglot.prototype.extend=function(r,n){forEach(r,function(r,t){var e=n?n+"."+t:t;"object"==typeof r?this.extend(r,e):this.phrases[e]=r},this)},Polyglot.prototype.unset=function(r,n){"string"==typeof r?delete this.phrases[r]:forEach(r,function(r,t){var e=n?n+"."+t:t;"object"==typeof r?this.unset(r,e):delete this.phrases[e]},this)},Polyglot.prototype.clear=function(){this.phrases={}},Polyglot.prototype.replace=function(r){this.clear(),this.extend(r)},Polyglot.prototype.t=function(r,t){var e,n,o=null==t?{}:t;return"string"==typeof this.phrases[r]?e=this.phrases[r]:"string"==typeof o._?e=o._:this.allowMissing?e=r:(this.warn('Missing translation for key: "'+r+'"'),n=r),"string"==typeof e&&(n=transformPhrase(e,o,this.currentLocale)),n},Polyglot.prototype.has=function(r){return has(this.phrases,r)},Polyglot.transformPhrase=transformPhrase,module.exports=Polyglot;