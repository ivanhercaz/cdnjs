"use strict";var forEach=require("for-each"),warning=require("warning"),has=require("has"),trim=require("string.prototype.trim"),warn=function(e){warning(!1,e)},replace=String.prototype.replace,split=String.prototype.split,delimeter="||||",pluralTypes={arabic:function(e){return e<3?e:3<=e%100&&e%100<=10?3:11<=e%100?4:5},chinese:function(){return 0},german:function(e){return 1!==e?1:0},french:function(e){return 1<e?1:0},russian:function(e){return e%10==1&&e%100!=11?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2},czech:function(e){return 1===e?0:2<=e&&e<=4?1:2},polish:function(e){return 1===e?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0}},pluralTypeToLanguages={arabic:["ar"],chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru","lt"],czech:["cs","sk"],polish:["pl"],icelandic:["is"]};function langToTypeMap(e){var t={};return forEach(e,function(e,r){forEach(e,function(e){t[e]=r})}),t}function pluralTypeName(e){var r=langToTypeMap(pluralTypeToLanguages);return r[e]||r[split.call(e,/-/,1)[0]]||r.en}function pluralTypeIndex(e,r){return pluralTypes[pluralTypeName(e)](r)}var dollarRegex=/\$/g,dollarBillsYall="$$",tokenRegex=/%\{(.*?)\}/g;function transformPhrase(e,r,t){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==r)return e;var n=e,o="number"==typeof r?{smart_count:r}:r;if(null!=o.smart_count&&n){var s=split.call(n,delimeter);n=trim(s[pluralTypeIndex(t||"en",o.smart_count)]||s[0])}return n=replace.call(n,tokenRegex,function(e,r){return has(o,r)?null==o[r]?e:replace.call(o[r],dollarRegex,dollarBillsYall):""})}function Polyglot(e){var r=e||{};this.phrases={},this.extend(r.phrases||{}),this.currentLocale=r.locale||"en";var t=r.allowMissing?transformPhrase:null;this.onMissingKey="function"==typeof r.onMissingKey?r.onMissingKey:t,this.warn=r.warn||warn}Polyglot.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},Polyglot.prototype.extend=function(e,n){forEach(e,function(e,r){var t=n?n+"."+r:r;"object"==typeof e?this.extend(e,t):this.phrases[t]=e},this)},Polyglot.prototype.unset=function(e,n){"string"==typeof e?delete this.phrases[e]:forEach(e,function(e,r){var t=n?n+"."+r:r;"object"==typeof e?this.unset(e,t):delete this.phrases[t]},this)},Polyglot.prototype.clear=function(){this.phrases={}},Polyglot.prototype.replace=function(e){this.clear(),this.extend(e)},Polyglot.prototype.t=function(e,r){var t,n,o=null==r?{}:r;if("string"==typeof this.phrases[e])t=this.phrases[e];else if("string"==typeof o._)t=o._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,o,this.currentLocale)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof t&&(n=transformPhrase(t,o,this.currentLocale)),n},Polyglot.prototype.has=function(e){return has(this.phrases,e)},Polyglot.transformPhrase=transformPhrase,module.exports=Polyglot;