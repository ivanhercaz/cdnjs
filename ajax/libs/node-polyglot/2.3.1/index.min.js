"use strict";var forEach=require("for-each"),warning=require("warning"),has=require("has"),trim=require("string.prototype.trim"),warn=function(r){warning(!1,r)},replace=String.prototype.replace,split=String.prototype.split,delimiter="||||",russianPluralGroups=function(r){var e=r%100,n=e%10;return 11!=e&&1==n?0:2<=n&&n<=4&&!(12<=e&&e<=14)?1:2},pluralTypes={arabic:function(r){if(r<3)return r;var e=r%100;return 3<=e&&e<=10?3:11<=e?4:5},bosnian_serbian:russianPluralGroups,chinese:function(){return 0},croatian:russianPluralGroups,french:function(r){return 1<r?1:0},german:function(r){return 1!==r?1:0},russian:russianPluralGroups,lithuanian:function(r){return r%10==1&&r%100!=11?0:2<=r%10&&r%10<=9&&(r%100<11||19<r%100)?1:2},czech:function(r){return 1===r?0:2<=r&&r<=4?1:2},polish:function(r){if(1===r)return 0;var e=r%10;return 2<=e&&e<=4&&(r%100<10||20<=r%100)?1:2},icelandic:function(r){return r%10!=1||r%100==11?1:0},slovenian:function(r){var e=r%100;return 1==e?0:2==e?1:3==e||4==e?2:3}},pluralTypeToLanguages={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function langToTypeMap(r){var n={};return forEach(r,function(r,e){forEach(r,function(r){n[r]=e})}),n}function pluralTypeName(r){var e=langToTypeMap(pluralTypeToLanguages);return e[r]||e[split.call(r,/-/,1)[0]]||e.en}function pluralTypeIndex(r,e){return pluralTypes[pluralTypeName(r)](e)}function escape(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function constructTokenRegex(r){var e=r&&r.prefix||"%{",n=r&&r.suffix||"}";if(e===delimiter||n===delimiter)throw new RangeError('"'+delimiter+'" token is reserved for pluralization');return new RegExp(escape(e)+"(.*?)"+escape(n),"g")}var defaultTokenRegex=/%\{(.*?)\}/g;function transformPhrase(r,e,n,t){if("string"!=typeof r)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return r;var i=r,o=t||defaultTokenRegex,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&i){var a=split.call(i,delimiter);i=trim(a[pluralTypeIndex(n||"en",s.smart_count)]||a[0])}return i=replace.call(i,o,function(r,e){return has(s,e)&&null!=s[e]?s[e]:r})}function Polyglot(r){var e=r||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var n=e.allowMissing?transformPhrase:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:n,this.warn=e.warn||warn,this.tokenRegex=constructTokenRegex(e.interpolation)}Polyglot.prototype.locale=function(r){return r&&(this.currentLocale=r),this.currentLocale},Polyglot.prototype.extend=function(r,t){forEach(r,function(r,e){var n=t?t+"."+e:e;"object"==typeof r?this.extend(r,n):this.phrases[n]=r},this)},Polyglot.prototype.unset=function(r,t){"string"==typeof r?delete this.phrases[r]:forEach(r,function(r,e){var n=t?t+"."+e:e;"object"==typeof r?this.unset(r,n):delete this.phrases[n]},this)},Polyglot.prototype.clear=function(){this.phrases={}},Polyglot.prototype.replace=function(r){this.clear(),this.extend(r)},Polyglot.prototype.t=function(r,e){var n,t,i=null==e?{}:e;if("string"==typeof this.phrases[r])n=this.phrases[r];else if("string"==typeof i._)n=i._;else if(this.onMissingKey){t=(0,this.onMissingKey)(r,i,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+r+'"'),t=r;return"string"==typeof n&&(t=transformPhrase(n,i,this.currentLocale,this.tokenRegex)),t},Polyglot.prototype.has=function(r){return has(this.phrases,r)},Polyglot.transformPhrase=function(r,e,n){return transformPhrase(r,e,n)},module.exports=Polyglot;