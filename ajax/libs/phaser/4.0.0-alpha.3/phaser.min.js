var Phaser=function(t){"use strict";var e=(o.prototype.drawImage=function(t,e,o){void 0===e&&(e=0),void 0===o&&(o=0),this.context.drawImage(t,e,o)},o.prototype.draw=function(t){this.context.fillStyle="#ff0000",this.context.fillText(t,10,40),this.context.fillStyle="#0000ff",this.context.fillText(t,10,20),this.context.fillStyle="#ffff00",this.context.fillText(t,10,60)},o);function o(t,e){void 0===t&&(t=800),void 0===e&&(e=600),this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,document.body.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.context.fillStyle="#2d2d2d",this.context.fillRect(0,0,t,e)}var n,i,s,r,a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function c(t){var e="function"==typeof Symbol&&t[Symbol.iterator],o=0;return e?e.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}function d(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,i,r=o.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=r.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}return s}(i=n=n||{})[i.IDLE=0]="IDLE",i[i.LOADING=1]="LOADING",i[i.PROCESSING=2]="PROCESSING",i[i.COMPLETE=3]="COMPLETE",i[i.SHUTDOWN=4]="SHUTDOWN",i[i.DESTROYED=5]="DESTROYED",(r=s=s||{})[r.PENDING=0]="PENDING",r[r.LOADING=1]="LOADING",r[r.LOADED=2]="LOADED",r[r.FAILED=3]="FAILED",r[r.PROCESSING=4]="PROCESSING",r[r.ERRORED=5]="ERRORED",r[r.COMPLETE=6]="COMPLETE",r[r.DESTROYED=7]="DESTROYED",r[r.POPULATED=8]="POPULATED",r[r.TIMED_OUT=9]="TIMED_OUT",r[r.ABORTED=10]="ABORTED";var l=(h.prototype.setBaseURL=function(t){return void 0===t&&(t=""),""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this},h.prototype.setPath=function(t){return void 0===t&&(t=""),""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this},h.prototype.setFileGroup=function(t){return void 0===t&&(t=""),this.fileGroup=t,this},h.prototype.isLoading=function(){return this.state===n.LOADING||this.state===n.PROCESSING},h.prototype.isReady=function(){return this.state===n.IDLE||this.state===n.COMPLETE},h.prototype.addFile=function(o){return console.log("addFile"),this.getURL(o),this.list.add(o),this.totalToLoad++,console.log(o),new Promise(function(t,e){o.fileResolve=t,o.fileReject=e})},h.prototype.start=function(){this.isReady()&&(this.progress=0,this.totalFailed=0,this.totalComplete=0,this.totalToLoad=this.list.size,0===this.totalToLoad?this.loadComplete():(this.state=n.LOADING,this.inflight.clear(),this.queue.clear(),this._deleteQueue.clear(),this.updateProgress(),this.checkLoadQueue()))},h.prototype.getURL=function(t){if(t.url.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/))return t;t.url=this.baseURL+this.path+t.url},h.prototype.updateProgress=function(){this.progress=1-(this.list.size+this.inflight.size)/this.totalToLoad},h.prototype.checkLoadQueue=function(){var e,t,o=this;try{for(var n=c(this.list),i=n.next();!i.done;i=n.next()){var r=i.value;if((r.state===s.POPULATED||r.state===s.PENDING&&this.inflight.size<this.maxParallelDownloads)&&(this.inflight.add(r),this.list.delete(r),r.load().then(function(t){return o.nextFile(t,!0)}).catch(function(t){return o.nextFile(t,!1)})),this.inflight.size===this.maxParallelDownloads)break}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},h.prototype.nextFile=function(t,e){console.log("nextFile",t,e),e?this.queue.add(t):this._deleteQueue.add(t),this.inflight.delete(t),0<this.list.size?(console.log("nextFile - still something in the list"),this.checkLoadQueue()):0===this.inflight.size&&(console.log("nextFile calling finishedLoading"),this.loadComplete())},h.prototype.loadComplete=function(){this.list.clear(),this.inflight.clear(),this.progress=1,this.state=n.COMPLETE},h);function h(){this.fileGroup="",this.prefix="",this.baseURL="",this.path="",this.maxParallelDownloads=32,this.crossOrigin="",this.state=n.IDLE,this.progress=0,this.totalToLoad=0,this.totalFailed=0,this.totalComplete=0,this.list=new Set,this.inflight=new Set,this.queue=new Set,this._deleteQueue=new Set,this.state=n.IDLE}function u(e){var o,t,a=new XMLHttpRequest;e.xhrLoader=a;var n=e.xhrSettings;a.open("GET",e.url,n.async,n.username,n.password),a.responseType=n.responseType,a.timeout=n.timeout,a.setRequestHeader("X-Requested-With",n.requestedWith),n.header&&n.headerValue&&a.setRequestHeader(n.header,n.headerValue),n.overrideMimeType&&a.overrideMimeType(n.overrideMimeType);var l=new Map([["loadstart",function(t){return e.onLoadStart(t)}],["load",function(t){return e.onLoad(t)}],["loadend",function(t){return e.onLoadEnd(t)}],["progress",function(t){return e.onProgress(t)}],["timeout",function(t){return e.onTimeout(t)}],["abort",function(t){return e.onAbort(t)}],["error",function(t){return e.onError(t)}]]);try{for(var i=c(l),r=i.next();!r.done;r=i.next()){var s=d(r.value,2),h=s[0],u=s[1];a.addEventListener(h,u)}}catch(t){o={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}e.resetXHR=function(){var e,t;try{for(var o=c(l),n=o.next();!n.done;n=o.next()){var i=d(n.value,2),r=i[0],s=i[1];a.removeEventListener(r,s)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},a.send()}function f(t){return void 0===t&&(t={responseType:"blob",async:!0,username:"",password:"",timeout:0}),{responseType:t.responseType,async:t.async,username:t.username,password:t.password,timeout:t.timeout,header:void 0,headerValue:void 0,requestedWith:"XMLHttpRequest",overrideMimeType:void 0}}function p(t,e,o){return{key:t,url:e,type:o,xhrLoader:void 0,xhrSettings:f(),data:null,state:s.PENDING,bytesLoaded:0,bytesTotal:0,percentComplete:0,load:function(){var o=this;return console.log("File.load",this.key),this.state=s.PENDING,u(this),new Promise(function(t,e){o.loaderResolve=t,o.loaderReject=e})},onLoadStart:function(t){console.log("onLoadStart"),this.state=s.LOADING},onLoad:function(t){var e=this;console.log("onLoad");var o=this.xhrLoader,n=o.responseURL&&0===o.responseURL.indexOf("file://")&&0===o.status;t.target&&o.status;4===o.readyState&&400<=o.status&&o.status,this.onProcess().then(function(){return e.onComplete()}).catch(function(){return e.onError()})},onLoadEnd:function(t){console.log("onLoadEnd"),this.resetXHR(),this.state=s.LOADED},onTimeout:function(t){console.log("onTimeout"),this.state=s.TIMED_OUT},onAbort:function(t){console.log("onAbort"),this.state=s.ABORTED},onError:function(t){console.log("onError"),this.state=s.ERRORED,this.fileReject&&this.fileReject(this)},onProgress:function(t){console.log("onProgress"),t.lengthComputable&&(this.bytesLoaded=t.loaded,this.bytesTotal=t.total,this.percentComplete=Math.min(t.loaded/t.total,1),console.log(this.percentComplete,"%"))},onProcess:function(){return console.log("File.onProcess"),this.state=s.PROCESSING,new Promise(function(t,e){t()})},onComplete:function(){console.log("onComplete!"),this.state=s.COMPLETE,this.fileResolve?this.fileResolve(this):this.loaderResolve&&this.loaderResolve(this)},onDestroy:function(){this.state=s.DESTROYED}}}function E(t,e){var n=p(t,e=e||t+".png","image");return n.xhrSettings.responseType="blob",n.onProcess=function(){console.log("ImageFile.onProcess"),n.state=s.PROCESSING;var o=new Image;return n.data=o,new Promise(function(t,e){o.onload=function(){console.log("ImageFile.onload"),o.onload=null,o.onerror=null,n.state=s.COMPLETE,t(n)},o.onerror=function(t){console.log("ImageFile.onerror"),o.onload=null,o.onerror=null,n.state=s.FAILED,e(n)},console.log("ImageFile.set src",n.url),o.src=n.url,o.complete&&o.width&&o.height&&(console.log("ImageFile.instant"),o.onload=null,o.onerror=null,n.state=s.COMPLETE,t(n))})},n}var y,L,g,v=(a(L=D,g=y=l),L.prototype=null===g?Object.create(g):(m.prototype=g.prototype,new m),D.prototype.image=function(t,e){return void 0===e&&(e=""),this.addFile(E(t,e))},D);function m(){this.constructor=L}function D(){return y.call(this)||this}var R={BaseLoader:l,BaseLoaderState:n,File:p,FileState:s,LoaderPlugin:v,XHRLoader:u,XHRSettings:f,FileTypes:{ImageFile:E}};return t.Game=e,t.Loader=R,t}({});