"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Game{constructor(t=800,e=600){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,document.body.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.context.fillStyle="#2d2d2d",this.context.fillRect(0,0,t,e)}draw(t){this.context.fillStyle="#ff0000",this.context.fillText(t,10,40),this.context.fillStyle="#0000ff",this.context.fillText(t,10,20),this.context.fillStyle="#ffff00",this.context.fillText(t,10,60)}}function XHRLoader(t){const e=new XMLHttpRequest;return e.open("GET",t.src,!0),e.responseType="blob",new Promise((s,i)=>{e.onload=(()=>{s(t)}),e.onerror=(()=>{i(t)}),e.send()})}function File(t,e,s){return{key:t,url:e,type:s,data:null,state:exports.FileState.PENDING,onStateChange(t){this.state!==t&&(this.state=t,t===exports.FileState.COMPLETE?this.resolve&&this.resolve(this):t===exports.FileState.FAILED&&this.reject&&this.reject(this))},load(){return this.onStateChange(exports.FileState.LOADING),XHRLoader(this)}}}!function(t){t[t.PENDING=0]="PENDING",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.FAILED=3]="FAILED",t[t.PROCESSING=4]="PROCESSING",t[t.ERRORED=5]="ERRORED",t[t.COMPLETE=6]="COMPLETE",t[t.DESTROYED=7]="DESTROYED",t[t.POPULATED=8]="POPULATED"}(exports.FileState||(exports.FileState={})),function(t){t[t.IDLE=0]="IDLE",t[t.LOADING=1]="LOADING",t[t.PROCESSING=2]="PROCESSING",t[t.COMPLETE=3]="COMPLETE",t[t.SHUTDOWN=4]="SHUTDOWN",t[t.DESTROYED=5]="DESTROYED"}(exports.LoaderState||(exports.LoaderState={}));class BaseLoader{constructor(){this.fileGroup="",this.prefix="",this.baseURL="",this.path="",this.maxParallelDownloads=32,this.crossOrigin="",this.state=exports.LoaderState.IDLE,this.progress=0,this.totalToLoad=0,this.totalFailed=0,this.totalComplete=0,this.list=new Set,this.inflight=new Set,this.queue=new Set,this._deleteQueue=new Set,this.state=exports.LoaderState.IDLE}setBaseURL(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setFileGroup(t=""){return this.fileGroup=t,this}isLoading(){return this.state===exports.LoaderState.LOADING||this.state===exports.LoaderState.PROCESSING}isReady(){return this.state===exports.LoaderState.IDLE||this.state===exports.LoaderState.COMPLETE}addFile(t,e){const s=File(t,e,"image");return this.list.add(s),this.totalToLoad++,new Promise((t,e)=>{s.resolve=t,s.reject=e})}start(){this.isReady()&&(this.progress=0,this.totalFailed=0,this.totalComplete=0,this.totalToLoad=this.list.size,0===this.totalToLoad?this.loadComplete():(this.state=exports.LoaderState.LOADING,this.inflight.clear(),this.queue.clear(),this._deleteQueue.clear(),this.updateProgress(),this.checkLoadQueue()))}updateProgress(){this.progress=1-(this.list.size+this.inflight.size)/this.totalToLoad}checkLoadQueue(){for(const t of this.list)if((t.state===exports.FileState.POPULATED||t.state===exports.FileState.PENDING&&this.inflight.size<this.maxParallelDownloads)&&(this.inflight.add(t),this.list.delete(t),t.load().then(t=>this.nextFile(t,!0)).catch(t=>this.nextFile(t,!1))),this.inflight.size===this.maxParallelDownloads)break}nextFile(t,e){}loadComplete(){this.list.clear(),this.inflight.clear(),this.queue.clear(),this.progress=1,this.state=exports.LoaderState.COMPLETE}}class Loader extends BaseLoader{constructor(){super()}image(t,e=""){return this.addFile(t,e)}}exports.BaseLoader=BaseLoader,exports.File=File,exports.Game=Game,exports.Loader=Loader;