define(["./_base/kernel","require","./has","./has!host-browser?./request"],function(e,i,t,r){var f;t("host-browser")?f=function(e,t,n){r(e,{sync:!!t,headers:{"X-Requested-With":null}}).then(n)}:i.getText?f=i.getText:console.error("dojo/text plugin failed to load because loader does not support getText");function d(e){if(e){var t=(e=e.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"")).match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);t&&(e=t[1])}else e="";return e}var h={},p={},v={};return e.cache=function(e,t,n){var r;"string"==typeof e?/\//.test(e)?(r=e,n=t):r=i.toUrl(e.replace(/\./g,"/")+(t?"/"+t:"")):(r=e+"",n=t);var o=null!=n&&"string"!=typeof n?n.value:n,s=n&&n.sanitize;return"string"==typeof o?(h[r]=o,s?d(o):o):null===o?(delete h[r],null):(r in h||f(r,!0,function(e){h[r]=e}),s?d(h[r]):h[r])},{dynamic:!0,normalize:function(e,t){var n=e.split("!"),r=n[0];return(/^\./.test(r)?t(r):r)+(n[1]?"!"+n[1]:"")},load:function(e,t,n){function r(e){n(s?d(e):e)}var o=e.split("!"),s=1<o.length,i=o[0],l=t.toUrl(o[0]),a="url:"+l,u=p;if(i in h?u=h[i]:t.cache&&a in t.cache?u=t.cache[a]:l in h&&(u=h[l]),u===p)if(v[l])v[l].push(r);else{var c=v[l]=[r];f(l,!t.async,function(e){h[i]=h[l]=e;for(var t=0;t<c.length;)c[t++](e);delete v[l]})}else r(u)}}});