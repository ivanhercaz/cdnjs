define(["./_base/lang","./dom","./io-query","./json"],function(r,u,t,i){function f(e,t,i){if(null!==i){var n=e[t];"string"==typeof n?e[t]=[n,i]:r.isArray(n)?n.push(i):e[t]=i}}var s={fieldToObject:function(e){var t=null;if(e=u.byId(e)){var i=e.name,n=(e.type||"").toLowerCase();if(i&&n&&!e.disabled)if("radio"==n||"checkbox"==n)e.checked&&(t=e.value);else if(e.multiple){t=[];for(var r=[e.firstChild];r.length;)for(var o=r.pop();o;o=o.nextSibling){if(1!=o.nodeType||"option"!=o.tagName.toLowerCase()){o.nextSibling&&r.push(o.nextSibling),o.firstChild&&r.push(o.firstChild);break}o.selected&&t.push(o.value)}}else t=e.value}return t},toObject:function(e){for(var t={},i=u.byId(e).elements,n=0,r=i.length;n<r;++n){var o=i[n],l=o.name,a=(o.type||"").toLowerCase();l&&a&&"file|submit|image|reset|button".indexOf(a)<0&&!o.disabled&&(f(t,l,s.fieldToObject(o)),"image"==a&&(t[l+".x"]=t[l+".y"]=t[l].x=t[l].y=0))}return t},toQuery:function(e){return t.objectToQuery(s.toObject(e))},toJson:function(e,t){return i.stringify(s.toObject(e),null,t?4:0)}};return s});