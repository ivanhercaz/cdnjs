define(["./_base/kernel","require","./_base/config","./aspect","./_base/lang","./topic","./domReady","./sniff"],function(t,u,d,o,f,e,n,i){t.hash=function(o,t){return arguments.length?("#"==o.charAt(0)&&(o=o.substring(1)),t?l(o):location.hash="#"+o,o):b()};var m,a,r,g=d.hashPollFrequency||100;function p(o,t){var e=o.indexOf(t);return 0<=e?o.substring(e+1):""}function b(){return p(location.href,"#")}function v(){e.publish("/dojo/hashchange",b())}function s(){b()!==m&&(m=b(),v())}function l(o){if(a){if(a.isTransitioning())return void setTimeout(f.hitch(null,l,o),g);var t=(e=a.iframe.location.href).indexOf("?");a.iframe.location.replace(e.substring(0,t)+"?"+o)}else{var e=location.href.replace(/#.*/,"");location.replace(e+"#"+o),r||s()}}function h(){var e=document.createElement("iframe"),o="dojo-hash-iframe",n=d.dojoBlankHtmlUrl||u.toUrl("./resources/blank.html");d.useXDomain&&!d.dojoBlankHtmlUrl&&console.warn("dojo/hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),e.id=o,e.src=n+"?"+b(),e.style.display="none",document.body.appendChild(e),this.iframe=t.global[o];var i,a,r,s,l,h=this.iframe.location;function c(){m=b(),i=l?m:p(h.href,"?"),a=!1,r=null}this.isTransitioning=function(){return a},this.pollLocation=function(){if(!l)try{var o=p(h.href,"?");document.title!=s&&(s=this.iframe.document.title=document.title)}catch(o){l=!0,console.error("dojo/hash: Error adding history entry. Server unreachable.")}var t=b();if(a&&m===t){if(!l&&o!==r)return void setTimeout(f.hitch(this,this.pollLocation),0);c(),v()}else if(m!==t||!l&&i!==o){if(m!==t)return a=!0,r=m=t,e.src=n+"?"+r,l=!1,void setTimeout(f.hitch(this,this.pollLocation),0);l||(location.href="#"+h.search.substring(1),c(),v())}else;setTimeout(f.hitch(this,this.pollLocation),g)},c(),setTimeout(f.hitch(this,this.pollLocation),g)}return n(function(){"onhashchange"in t.global&&(!i("ie")||8<=i("ie")&&"BackCompat"!=document.compatMode)?r=o.after(t.global,"onhashchange",v,!0):document.addEventListener?(m=b(),setInterval(s,g)):document.attachEvent&&(a=new h)}),t.hash});