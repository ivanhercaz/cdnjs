define(["../_base/lang","../_base/array","../date","../cldr/supplemental","../i18n","../regexp","../string","../i18n!../cldr/nls/gregorian","module"],function(i,w,u,p,l,a,v,e,r){var y={};function d(m,b,h,k){return k.replace(/([a-z])\1*/gi,function(e){var a,r,t=e.charAt(0),n=e.length,s=["abbr","wide","narrow"];switch(t){case"G":a=b[n<4?"eraAbbr":"eraNames"][m.getFullYear()<0?0:1];break;case"y":switch(a=m.getFullYear(),n){case 1:break;case 2:if(!h.fullYear){a=(a=String(a)).substr(a.length-2);break}default:r=!0}break;case"Q":case"q":a=Math.ceil((m.getMonth()+1)/3),r=!0;break;case"M":case"L":var c=m.getMonth();if(n<3)a=c+1,r=!0;else{var o=["months","L"==t?"standAlone":"format",s[n-3]].join("-");a=b[o][c]}break;case"w":a=y._getWeekOfYear(m,0),r=!0;break;case"d":a=m.getDate(),r=!0;break;case"D":a=y._getDayOfYear(m),r=!0;break;case"e":case"c":var i=m.getDay();if(n<2){a=(i-p.getFirstDayOfWeek(h.locale)+8)%7;break}case"E":if(i=m.getDay(),n<3)a=i+1,r=!0;else{var l=["days","c"==t?"standAlone":"format",s[n-3]].join("-");a=b[l][i]}break;case"a":var u=m.getHours()<12?"am":"pm";a=h[u]||b["dayPeriods-format-wide-"+u];break;case"h":case"H":case"K":case"k":var d=m.getHours();switch(t){case"h":a=d%12||12;break;case"H":a=d;break;case"K":a=d%12;break;case"k":a=d||24}r=!0;break;case"m":a=m.getMinutes(),r=!0;break;case"s":a=m.getSeconds(),r=!0;break;case"S":a=Math.round(m.getMilliseconds()*Math.pow(10,n-3)),r=!0;break;case"v":case"z":if(a=y._getZone(m,!0,h))break;n=4;case"Z":var f=y._getZone(m,!1,h),g=[f<=0?"+":"-",v.pad(Math.floor(Math.abs(f)/60),2),v.pad(Math.abs(f)%60,2)];4==n&&(g.splice(0,0,"GMT"),g.splice(3,0,":")),a=g.join("");break;default:throw new Error("dojo.date.locale.format: invalid pattern char: "+k)}return r&&(a=v.pad(a,n)),a})}function f(e,r,t,a){function n(e){return e}r=r||n,t=t||n,a=a||n;var s=e.match(/(''|[^'])+/g),c="'"==e.charAt(0);return w.forEach(s,function(e,a){e?(s[a]=(c?t:r)(e.replace(/''/g,"'")),c=!c):s[a]=""}),a(s.join(""))}i.setObject(r.id.replace(/\//g,"."),y),y._getZone=function(e,a,r){return a?u.getTimezoneName(e):e.getTimezoneOffset()},y.format=function(e,a){a=a||{};var r,t=l.normalizeLocale(a.locale),n=a.formatLength||"short",s=y._getGregorianBundle(t),c=[],o=i.hitch(this,d,e,s,a);return"year"==a.selector?f(s["dateFormatItem-yyyy"]||"yyyy",o):("date"!=a.selector&&(r=a.timePattern||s["timeFormat-"+n])&&c.push(f(r,o)),"time"!=a.selector&&(r=a.datePattern||s["dateFormat-"+n])&&c.push(f(r,o)),1==c.length?c[0]:s["dateTimeFormat-"+n].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(e,a){return c[a]}))},y.regexp=function(e){return y._parseInfo(e).regexp},y._parseInfo=function(e){e=e||{};var a=l.normalizeLocale(e.locale),r=y._getGregorianBundle(a),t=e.formatLength||"short",n=e.datePattern||r["dateFormat-"+t],s=e.timePattern||r["timeFormat-"+t],c=[];return{regexp:f("date"==e.selector?n:"time"==e.selector?s:r["dateTimeFormat-"+t].replace(/\{(\d+)\}/g,function(e,a){return[s,n][a]}),i.hitch(this,o,c,r,e)),tokens:c,bundle:r}},y.parse=function(e,g){var a=/[\u200E\u200F\u202A\u202E]/g,r=y._parseInfo(g),m=r.tokens,b=r.bundle,t=new RegExp("^"+r.regexp.replace(a,"")+"$",r.strict?"":"i").exec(e&&e.replace(a,""));if(!t)return null;var h=["abbr","wide","narrow"],k=[1970,0,1,0,0,0,0],p="",n=w.every(t,function(e,a){if(!a)return!0;var r=m[a-1],t=r.length,n=r.charAt(0);switch(n){case"y":if(2!=t&&g.strict)k[0]=e;else if(e<100){e=Number(e);var s=""+(new Date).getFullYear(),c=100*s.substring(0,2),o=Math.min(Number(s.substring(2,4))+20,99);k[0]=e<o?c+e:c-100+e}else{if(g.strict)return!1;k[0]=e}break;case"M":case"L":if(2<t){var i=b["months-"+("L"==n?"standAlone":"format")+"-"+h[t-3]].concat();if(g.strict||(e=e.replace(".","").toLowerCase(),i=w.map(i,function(e){return e.replace(".","").toLowerCase()})),-1==(e=w.indexOf(i,e)))return!1}else e--;k[1]=e;break;case"E":case"e":case"c":var l=b["days-"+("c"==n?"standAlone":"format")+"-"+h[t-3]].concat();if(g.strict||(e=e.toLowerCase(),l=w.map(l,function(e){return e.toLowerCase()})),-1==(e=w.indexOf(l,e)))return!1;break;case"D":k[1]=0;case"d":k[2]=e;break;case"a":var u=g.am||b["dayPeriods-format-wide-am"],d=g.pm||b["dayPeriods-format-wide-pm"];if(!g.strict){var f=/\./g;e=e.replace(f,"").toLowerCase(),u=u.replace(f,"").toLowerCase(),d=d.replace(f,"").toLowerCase()}if(g.strict&&e!=u&&e!=d)return!1;p=e==d?"p":e==u?"a":"";break;case"K":24==e&&(e=0);case"h":case"H":case"k":if(23<e)return!1;k[3]=e;break;case"m":k[4]=e;break;case"s":k[5]=e;break;case"S":k[6]=e}return!0}),s=+k[3];"p"===p&&s<12?k[3]=12+s:"a"===p&&12==s&&(k[3]=0);var c=new Date(k[0],k[1],k[2],k[3],k[4],k[5],k[6]);g.strict&&c.setFullYear(k[0]);var o=m.join(""),i=-1!=o.indexOf("d"),l=-1!=o.indexOf("M");return!n||l&&c.getMonth()>k[1]||i&&c.getDate()>k[2]?null:((l&&c.getMonth()<k[1]||i&&c.getDate()<k[2])&&(c=u.add(c,"hour",1)),c)};var g=["abbr","wide","narrow"];function o(i,l,u,e){return e=a.escapeString(e),u.strict||(e=e.replace(" a"," ?a")),e.replace(/([a-z])\1*/gi,function(e){var a,r=e.charAt(0),t=e.length,n="",s="";switch(u.strict?(1<t&&(n="0{"+(t-1)+"}"),2<t&&(s="0{"+(t-2)+"}")):(n="0?",s="0{0,2}"),r){case"y":a="\\d{2,4}";break;case"M":case"L":if(2<t)a=l["months-"+("L"==r?"standAlone":"format")+"-"+g[t-3]].slice(0).join("|"),u.strict||(a="(?:"+(a=a.replace(/\./g,""))+")\\.?");else a="1[0-2]|"+n+"[1-9]";break;case"D":a="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+n+"[1-9][0-9]|"+s+"[1-9]";break;case"d":a="3[01]|[12]\\d|"+n+"[1-9]";break;case"w":a="[1-4][0-9]|5[0-3]|"+n+"[1-9]";break;case"E":case"e":case"c":a=".+?";break;case"h":a="1[0-2]|"+n+"[1-9]";break;case"k":a="1[01]|"+n+"\\d";break;case"H":a="1\\d|2[0-3]|"+n+"\\d";break;case"K":a="1\\d|2[0-4]|"+n+"[1-9]";break;case"m":case"s":a="[0-5]\\d";break;case"S":a="\\d{"+t+"}";break;case"a":var c=u.am||l["dayPeriods-format-wide-am"],o=u.pm||l["dayPeriods-format-wide-pm"];a=c+"|"+o,u.strict||(c!=c.toLowerCase()&&(a+="|"+c.toLowerCase()),o!=o.toLowerCase()&&(a+="|"+o.toLowerCase()),-1!=a.indexOf(".")&&(a+="|"+a.replace(/\./g,""))),a=a.replace(/\./g,"\\.");break;default:a=".*"}return i&&i.push(e),"("+a+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var n=[],s={};return y.addCustomFormats=function(e,a){n.push({pkg:e,name:a}),s={}},y._getGregorianBundle=function(r){if(s[r])return s[r];var t={};return w.forEach(n,function(e){var a=l.getLocalization(e.pkg,e.name,r);t=i.mixin(t,a)},this),s[r]=t},y.addCustomFormats(r.id.replace(/\/date\/locale$/,".cldr"),"gregorian"),y.getNames=function(e,a,r,t){var n,s=y._getGregorianBundle(t),c=[e,r,a];"standAlone"==r&&1==(n=s[c.join("-")])[0]&&(n=void 0);return c[1]="format",(n||s[c.join("-")]).concat()},y.isWeekend=function(e,a){var r=p.getWeekend(a),t=(e||new Date).getDay();return r.end<r.start&&(r.end+=7,t<r.start&&(t+=7)),t>=r.start&&t<=r.end},y._getDayOfYear=function(e){return u.difference(new Date(e.getFullYear(),0,1,e.getHours()),e)+1},y._getWeekOfYear=function(e,a){1==arguments.length&&(a=0);var r=new Date(e.getFullYear(),0,1).getDay(),t=(r-a+7)%7,n=Math.floor((y._getDayOfYear(e)+t-1)/7);return r==a&&n++,n},y});