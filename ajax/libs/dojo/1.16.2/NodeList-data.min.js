define(["./_base/kernel","./query","./_base/lang","./_base/array","./dom-attr"],function(e,t,o,n,r){function d(e){var a=r.get(e,f);return a||(a="pid"+c++,r.set(e,f,a)),a}var a=t.NodeList,i={},c=0,f="data-dojo-dataid";a._nodeDataCache=e._nodeDataCache=i;var u=e._nodeData=function(e,a,t){var n,r=d(e);return i[r]||(i[r]={}),1==arguments.length?i[r]:("string"==typeof a?2<arguments.length?i[r][a]=t:n=i[r][a]:n=o.mixin(i[r],a),n)},_=e._removeNodeData=function(e,a){var t=d(e);i[t]&&(a?delete i[t][a]:delete i[t])};return a._gcNodeData=e._gcNodeData=function(){var e=t("["+f+"]").map(d);for(var a in i)n.indexOf(e,a)<0&&delete i[a]},o.extend(a,{data:a._adaptWithCondition(u,function(e){return 0===e.length||1==e.length&&"string"==typeof e[0]}),removeData:a._adaptAsForEach(_)}),a});