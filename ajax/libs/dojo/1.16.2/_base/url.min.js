define(["./kernel"],function(t){var p=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),o=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$"),c=function(){for(var t=null,h=arguments,e=[h[0]],r=1;r<h.length;r++)if(h[r]){var i=new c(h[r]+""),s=new c(e[0]+"");if(""!=i.path||i.scheme||i.authority||i.query){if(!i.scheme&&(i.scheme=s.scheme,!i.authority&&(i.authority=s.authority,"/"!=i.path.charAt(0)))){for(var a=(s.path.substring(0,s.path.lastIndexOf("/")+1)+i.path).split("/"),n=0;n<a.length;n++)"."==a[n]?n==a.length-1?a[n]="":(a.splice(n,1),n--):0<n&&(1!=n||""!=a[0])&&".."==a[n]&&".."!=a[n-1]&&(n==a.length-1?(a.splice(n,1),a[n-1]=""):(a.splice(n-1,2),n-=2));i.path=a.join("/")}}else i.fragment!=t&&(s.fragment=i.fragment),i=s;e=[],i.scheme&&e.push(i.scheme,":"),i.authority&&e.push("//",i.authority),e.push(i.path),i.query&&e.push("?",i.query),i.fragment&&e.push("#",i.fragment)}this.uri=e.join("");var u=this.uri.match(p);this.scheme=u[2]||(u[1]?"":t),this.authority=u[4]||(u[3]?"":t),this.path=u[5],this.query=u[7]||(u[6]?"":t),this.fragment=u[9]||(u[8]?"":t),this.authority!=t&&(u=this.authority.match(o),this.user=u[3]||t,this.password=u[4]||t,this.host=u[6]||u[7],this.port=u[9]||t)};return c.prototype.toString=function(){return this.uri},t._Url=c});