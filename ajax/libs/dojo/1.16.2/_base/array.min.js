define(["./kernel","../has","./lang"],function(r,n,t){var u={};function a(r){return u[r]=new Function("item","index","array",r)}function e(o){var l=!o;return function(r,n,t){var e,f=0,i=r&&r.length||0;if(i&&"string"==typeof r&&(r=r.split("")),"string"==typeof n&&(n=u[n]||a(n)),t){for(;f<i;++f)if(e=!n.call(t,r[f],f,r),o^e)return!e}else for(;f<i;++f)if(e=!n(r[f],f,r),o^e)return!e;return l}}function f(l){var u=1,a=0,s=0;return l||(u=a=s=-1),function(r,n,t,e){if(e&&0<u)return c.lastIndexOf(r,n,t);var f,i=r&&r.length||0,o=l?i+s:a;for(void 0===t?f=l?a:i+s:t<0?(f=i+t)<0&&(f=a):f=i<=t?i+s:t,i&&"string"==typeof r&&(r=r.split(""));f!=o;f+=u)if(r[f]==n)return f;return-1}}var c={every:e(!1),some:e(!0),indexOf:f(!0),lastIndexOf:f(!1),forEach:function(r,n,t){var e=0,f=r&&r.length||0;if(f&&"string"==typeof r&&(r=r.split("")),"string"==typeof n&&(n=u[n]||a(n)),t)for(;e<f;++e)n.call(t,r[e],e,r);else for(;e<f;++e)n(r[e],e,r)},map:function(r,n,t,e){var f=0,i=r&&r.length||0,o=new(e||Array)(i);if(i&&"string"==typeof r&&(r=r.split("")),"string"==typeof n&&(n=u[n]||a(n)),t)for(;f<i;++f)o[f]=n.call(t,r[f],f,r);else for(;f<i;++f)o[f]=n(r[f],f,r);return o},filter:function(r,n,t){var e,f=0,i=r&&r.length||0,o=[];if(i&&"string"==typeof r&&(r=r.split("")),"string"==typeof n&&(n=u[n]||a(n)),t)for(;f<i;++f)e=r[f],n.call(t,e,f,r)&&o.push(e);else for(;f<i;++f)n(e=r[f],f,r)&&o.push(e);return o},clearCache:function(){u={}}};return n("extend-dojo")&&t.mixin(r,c),c});