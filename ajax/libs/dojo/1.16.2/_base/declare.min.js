define(["./kernel","../has","./lang"],function(t,b,_){var n,g=_.mixin,w=Object.prototype,v=w.toString,O=0,x="constructor";function j(t,e){throw new Error("declare"+(e?" "+e:"")+": "+t)}function k(t,e,n,r){var i,o,s,a,c,l,p,h,f,u=this._inherited=this._inherited||{};if("string"==typeof t&&(i=t,t=e,e=n,n=r),"function"==typeof t)a=t,t=e,e=n;else try{a=t.callee}catch(t){if(!(t instanceof TypeError))throw t;j("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass)}if((i=i||a.nom)||j("can't deduce a name to call inherited()",this.declaredClass),n=r=0,s=(c=this.constructor._meta).bases,f=u.p,i!=x){if(u.c!==a&&(c=(l=s[f=0])._meta).hidden[i]!==a){(o=c.chains)&&"string"==typeof o[i]&&j("calling chained method with inherited: "+i,this.declaredClass);do{if(c=l._meta,p=l.prototype,c&&(p[i]===a&&p.hasOwnProperty(i)||c.hidden[i]===a))break}while(l=s[++f]);f=l?f:-1}if(l=s[++f])if(p=l.prototype,l._meta&&p.hasOwnProperty(i))n=p[i];else{h=w[i];do{if((n=(p=l.prototype)[i])&&(l._meta?p.hasOwnProperty(i):n!==h))break}while(l=s[++f])}n=l&&n||w[i]}else{if(u.c!==a&&(c=s[f=0]._meta)&&c.ctor!==a){for((o=c.chains)&&"manual"===o.constructor||j("calling chained constructor with inherited",this.declaredClass);(l=s[++f])&&(!(c=l._meta)||c.ctor!==a););f=l?f:-1}for(;(l=s[++f])&&!(n=(c=l._meta)?c.ctor:l););n=l&&n}if(u.c=n,u.p=f,n)return!0===e?n:n.apply(this,e||t)}function P(t,e,n){return"string"==typeof t?"function"==typeof e?this.__inherited(t,e,n,!0):this.__inherited(t,e,!0):"function"==typeof t?this.__inherited(t,e,!0):this.__inherited(t,!0)}n=b("csp-restrictions")?function(){}:new Function;var C=t.config.isDebug?function(t,e,n,r){var i=this.getInherited(t,e,n);if(i)return i.apply(this,r||n||e||t)}:k;function F(t){for(var e=this.constructor._meta.bases,n=0,r=e.length;n<r;++n)if(e[n]===t)return!0;return this instanceof t}function q(t,e){for(var n in e)n!=x&&e.hasOwnProperty(n)&&(t[n]=e[n]);if(b("bug-for-in-skips-shadowed"))for(var r=_._extraNames,i=r.length;i;)(n=r[--i])!=x&&e.hasOwnProperty(n)&&(t[n]=e[n])}function M(t){return E.safeMixin(this.prototype,t),this}function A(t,e){return t instanceof Array||"function"==typeof t||(e=t,t=void 0),e=e||{},E([this].concat(t=t||[]),e)}function D(o,s,a){return function(){var t,e,n,r=0,i=1;for(a&&(r=s.length-1,i=-1);t=s[r];r+=i)(n=((e=t._meta)?e.hidden:t.prototype)[o])&&n.apply(this,arguments)}}function I(t){n.prototype=t.prototype;var e=new n;return n.prototype=null,e}function N(t){var e=t.callee,n=I(e);return e.apply(n,t),n}function E(t,e,n){"string"!=typeof t&&(n=e,e=t,t=""),n=n||{};var r,i,o,s,a,c,l,p,h,f,u,d,y=1,m=e;if("[object Array]"==v.call(e)?(o=(c=function(t,e){for(var n,r,i,o,s,a,c,l,p=[],h=[{cls:0,refs:[]}],f={},u=1,d=t.length,y=0;y<d;++y){for((i=t[y])?"[object Function]"!=v.call(i)&&j("mixin #"+y+" is not a callable constructor.",e):j("mixin #"+y+" is unknown. Did you use dojo.require to pull it in?",e),o=0,n=(r=i._meta?i._meta.bases:[i]).length-1;0<=n;--n)(s=r[n].prototype).hasOwnProperty("declaredClass")||(s.declaredClass="uniqName_"+O++),c=s.declaredClass,f.hasOwnProperty(c)||(f[c]={count:0,refs:[],cls:r[n]},++u),a=f[c],o&&o!==a&&(a.refs.push(o),++o.count),o=a;++o.count,h[0].refs.push(o)}for(;h.length;){for(o=h.pop(),p.push(o.cls),--u;1==(l=o.refs).length;){if(!(o=l[0])||--o.count){o=0;break}p.push(o.cls),--u}if(o)for(y=0,d=l.length;y<d;++y)--(o=l[y]).count||h.push(o)}return u&&j("can't build consistent linearization",e),i=t[0],p[0]=i?i._meta&&i===p[p.length-i._meta.bases.length]?i._meta.bases.length:1:0,p}(e,t))[0],e=c[y=c.length-o]):(c=[0],e?"[object Function]"==v.call(e)?(o=e._meta,c=c.concat(o?o.bases:e)):j("base class is not a callable constructor.",t):null!==e&&j("unknown base class. Did you use dojo.require to pull it in?",t)),e)for(i=y-1;r=I(e),i;--i)((o=c[i])._meta?q:g)(r,o.prototype),(s=b("csp-restrictions")?function(){}:new Function).superclass=e,e=(s.prototype=r).constructor=s;else r={};for(E.safeMixin(r,n),(o=n.constructor)!==w.constructor&&(o.nom=x,r.constructor=o),i=y-1;i;--i)(o=c[i]._meta)&&o.chains&&(l=g(l||{},o.chains));if(r["-chains-"]&&(l=g(l||{},r["-chains-"])),e&&e.prototype&&e.prototype["-chains-"]&&(l=g(l||{},e.prototype["-chains-"])),o=!l||!l.hasOwnProperty(x),c[0]=s=l&&"manual"===l.constructor?(d=c,function(){var t,e,n=arguments,r=0;if(!(this instanceof n.callee))return N(n);for(;t=d[r];++r)if(t=(e=t._meta)?e.ctor:t){t.apply(this,n);break}(t=this.postscript)&&t.apply(this,n)}):1==c.length?(f=n.constructor,u=o,function(){var t,e=arguments,n=e,r=e[0];if(!(this instanceof e.callee))return N(e);u&&(r&&(t=r.preamble)&&(n=t.apply(this,n)||n),(t=this.preamble)&&t.apply(this,n)),f&&f.apply(this,e),(t=this.postscript)&&t.apply(this,e)}):(p=c,h=o,function(){var t,e,n,r,i=arguments,o=i,s=i[0],a=p.length;if(!(this instanceof i.callee))return N(i);if(h&&(s&&s.preamble||this.preamble))for((r=new Array(p.length))[0]=i,e=0;(s=i[0])&&(t=s.preamble)&&(i=t.apply(this,i)||i),(t=(t=p[e].prototype).hasOwnProperty("preamble")&&t.preamble)&&(i=t.apply(this,i)||i),++e!=a;)r[e]=i;for(e=a-1;0<=e;--e)(t=(n=(t=p[e])._meta)?n.ctor:t)&&t.apply(this,r?r[e]:i);(t=this.postscript)&&t.apply(this,o)}),s._meta={bases:c,hidden:n,chains:l,parents:m,ctor:n.constructor},s.superclass=e&&e.prototype,s.extend=M,s.createSubclass=A,(s.prototype=r).constructor=s,r.getInherited=P,r.isInstanceOf=F,r.inherited=C,r.__inherited=k,t&&(r.declaredClass=t,_.setObject(t,s)),l)for(a in l)r[a]&&"string"==typeof l[a]&&a!=x&&((o=r[a]=D(a,c,"after"===l[a])).nom=a);return s}return t.safeMixin=E.safeMixin=function(t,e){var n,r;for(n in e)(r=e[n])===w[n]&&n in w||n==x||("[object Function]"==v.call(r)&&(r.nom=n),t[n]=r);if(b("bug-for-in-skips-shadowed")&&e)for(var i=_._extraNames,o=i.length;o;)(r=e[n=i[--o]])===w[n]&&n in w||n==x||("[object Function]"==v.call(r)&&(r.nom=n),t[n]=r);return t},t.declare=E});