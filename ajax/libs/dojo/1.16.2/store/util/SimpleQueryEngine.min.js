define(["../../_base/array"],function(f){return function(e,i){switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var u=e;e=function(t){for(var r in u){var n=u[r];if(n&&n.test){if(!n.test(t[r],t))return!1}else if(n!=t[r])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}function t(t){var r=f.filter(t,e),a=i&&i.sort;if(a&&r.sort("function"==typeof a?a:function(t,r){for(var n,e=0;n=a[e];e++){var i=t[n.attribute],u=r[n.attribute];if((i=null!=i?i.valueOf():i)!=(u=null!=u?u.valueOf():u))return!!n.descending==(null==i||u<i)?-1:1}return 0}),i&&(i.start||i.count)){var n=r.length;(r=r.slice(i.start||0,(i.start||0)+(i.count||1/0))).total=n}return r}return t.matches=e,t}});