define(["../../_base/array","../../_base/lang","../../when"],function(u,n,o){var f=function(e){if(!e)return e;var a=!!e.then;function t(r){e[r]=function(){var n=arguments,t=o(e,function(t){return Array.prototype.unshift.call(n,t),f(u[r].apply(u,n))});if("forEach"!==r||a)return t}}return a&&(e=n.delegate(e)),t("forEach"),t("filter"),t("map"),null==e.total&&(e.total=o(e,function(t){return t.length})),e};return n.setObject("dojo.store.util.QueryResults",f),f});