define(["./_base/kernel","./_base/lang","./_base/array","./_base/declare","./dom","./dom-construct","./parser"],function(t,o,r,e,n,s,i){var a=0,c={_secureForInnerHtml:function(t){return t.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/gi,"")},_emptyNode:s.empty,_setNodeContent:function(t,e){if(s.empty(t),e)if("number"==typeof e&&(e=e.toString()),"string"==typeof e&&(e=s.toDom(e,t.ownerDocument)),!e.nodeType&&o.isArrayLike(e))for(var n=e.length,r=0;r<e.length;r=n==e.length?r+1:0)s.place(e[r],t,"last");else s.place(e,t,"last");return t},_ContentSetter:e("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:t._scopeName,startup:!0,constructor:function(t,e){o.mixin(this,t||{}),e=this.node=n.byId(this.node||e),this.id||(this.id=["Setter",e?e.id||e.tagName:"",a++].join("_"))},set:function(t,e){void 0!==t&&(this.content=t),"number"==typeof t&&(t=t.toString()),e&&this._mixin(e),this.onBegin(),this.setContent();var n=this.onEnd();return n&&n.then?n:this.node},setContent:function(){var e=this.node;if(!e)throw new Error(this.declaredClass+": setContent given no node");try{e=c._setNodeContent(e,this.content)}catch(t){var n=this.onContentError(t);try{e.innerHTML=n}catch(t){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+t.message,t)}}this.node=e},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred),this.parseResults&&this.parseResults.length&&(r.forEach(this.parseResults,function(t){t.destroy&&t.destroy()}),delete this.parseResults),s.empty(this.node)},onBegin:function(){var t=this.content;if(o.isString(t)&&(this.cleanContent&&(t=c._secureForInnerHtml(t)),this.extractContent)){var e=t.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);e&&(t=e[1])}return this.empty(),this.content=t,this.node},onEnd:function(){return this.parseContent&&this._parse(),this.node},tearDown:function(){delete this.parseResults,delete this.parseDeferred,delete this.node,delete this.content},onContentError:function(t){return"Error occurred setting content: "+t},onExecError:function(t){return"Error occurred executing scripts: "+t},_mixin:function(t){var e,n={};for(e in t)e in n||(this[e]=t[e])},_parse:function(){var t=this.node;try{var e={};r.forEach(["dir","lang","textDir"],function(t){this[t]&&(e[t]=this[t])},this);var n=this;this.parseDeferred=i.parse({rootNode:t,noStart:!this.startup,inherited:e,scope:this.parserScope}).then(function(t){return n.parseResults=t},function(t){n._onError("Content",t,"Error parsing in _ContentSetter#"+n.id)})}catch(t){this._onError("Content",t,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(t,e,n){var r=this["on"+t+"Error"].call(this,e);n?console.error(n,e):r&&c._setNodeContent(this.node,r,!0)}}),set:function(t,e,n){return null==e&&(console.warn("dojo.html.set: no cont argument provided, using empty string"),e=""),"number"==typeof e&&(e=e.toString()),n?new c._ContentSetter(o.mixin(n,{content:e,node:t})).set():c._setNodeContent(t,e,!0)}};return o.setObject("dojo.html",c),c});