define(["../_base/array","../_base/lang","../Deferred","../when"],function(e,u,o,f){"use strict";var c=e.some;return function(e){var n,r,s;u.isArray(e)?r=e:e&&"object"==typeof e&&(n=e);var t=[];if(n){for(var i in r=[],n)Object.hasOwnProperty.call(n,i)&&(t.push(i),r.push(n[i]));s={}}else r&&(s=[]);if(!r||!r.length)return(new o).resolve(s);var l=new o;l.promise.always(function(){s=t=null});var a=r.length;return c(r,function(e,r){return n||t.push(r),f(e,function(e){l.isFulfilled()||(s[t[r]]=e,0==--a&&l.resolve(s))},l.reject),l.isFulfilled()}),l.promise}});