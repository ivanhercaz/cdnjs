define(["./_base/kernel","./has","./dom","./on","./_base/array","./_base/lang","./selector/_loader","./selector/_loader!default"],function(o,u,a,i,s,f,e,t){"use strict";u.add("array-extensible",function(){return 1==f.delegate([],{length:1}).length&&!u("bug-for-in-skips-shadowed")});function c(n,r,e){return r=[0].concat(l.call(r,0)),e=e||o.global,function(t){return r[0]=t,n.apply(e,r)}}function h(t){var n=this instanceof _&&u("array-extensible");"number"==typeof t&&(t=Array(t));var r=t&&"length"in t?t:arguments;if(n||!r.sort){for(var e=n?this:[],i=e.length=r.length,o=0;o<i;o++)e[o]=r[o];if(n)return e;r=e}return f._mixin(r,y),r._NodeListCtor=function(t){return _(t)},r}var r=Array.prototype,l=r.slice,p=r.concat,d=s.forEach,_=h,y=_.prototype=u("array-extensible")?[]:{};function v(e,i){function o(t,n){if("string"==typeof n&&!(n=a.byId(n)))return new i([]);var r="string"==typeof t?e(t,n):t?t.end&&t.on?t:[t]:[];return r.end&&r.on?r:new i(r)}if(o.matches=e.match||function(t,n,r){return 0<o.filter([t],n,r).length},o.filter=e.filter||function(n,t,r){return o(t,r).filter(function(t){return-1<s.indexOf(n,t)})},"function"!=typeof e){var r=e.search;e=function(t,n){return r(n||document,t)}}return o}_._wrap=y._wrap=function(t,n,r){var e=new(r||this._NodeListCtor||_)(t);return n?e._stash(n):e},_._adaptAsMap=function(t,n){return function(){return this.map(c(t,arguments,n))}},_._adaptAsForEach=function(t,n){return function(){return this.forEach(c(t,arguments,n)),this}},_._adaptAsFilter=function(t,n){return function(){return this.filter(c(t,arguments,n))}},_._adaptWithCondition=function(r,e,i){return function(){var t=arguments,n=c(r,t,i);return e.call(i||o.global,t)?this.map(n):(this.forEach(n),this)}},d(["slice","splice"],function(t){var n=r[t];y[t]=function(){return this._wrap(n.apply(this,arguments),"slice"==t?this:null)}}),d(["indexOf","lastIndexOf","every","some"],function(t){var n=s[t];y[t]=function(){return n.apply(o,[this].concat(l.call(arguments,0)))}}),f.extend(h,{constructor:_,_NodeListCtor:_,toString:function(){return this.join(",")},_stash:function(t){return this._parent=t,this},on:function(n,r){var e=this.map(function(t){return i(t,n,r)});return e.remove=function(){for(var t=0;t<e.length;t++)e[t].remove()},e},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},concat:function(t){var n=l.call(this,0),r=s.map(arguments,function(t){return l.call(t,0)});return this._wrap(p.apply(n,r),this)},map:function(t,n){return this._wrap(s.map(this,t,n),this)},forEach:function(t,n){return d(this,t,n),this},filter:function(t){var n=arguments,r=this,e=0;if("string"==typeof t){if(r=g._filterResult(this,n[0]),1==n.length)return r._stash(this);e=1}return this._wrap(s.filter(r,n[e],n[e+1]),this)},instantiate:function(t,n){var r=f.isFunction(t)?t:f.getObject(t);return n=n||{},this.forEach(function(t){new r(n,t)})},at:function(){var n=new this._NodeListCtor(0);return d(arguments,function(t){t<0&&(t=this.length+t),this[t]&&n.push(this[t])},this),n._stash(this)}});var g=v(t,h);return o.query=v(t,function(t){return h(t)}),g.load=function(t,n,r){e.load(t,n,function(t){r(v(t,h))})},o._filterQueryResult=g._filterResult=function(t,n,r){return new h(g.filter(t,n,r))},o.NodeList=g.NodeList=h,g});