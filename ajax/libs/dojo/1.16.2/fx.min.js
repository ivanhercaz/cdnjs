define(["./_base/lang","./Evented","./_base/kernel","./_base/array","./aspect","./_base/fx","./dom","./dom-style","./dom-geometry","./ready","require"],function(h,t,n,e,a,u,c,f,_,i,o){n.isAsync||i(0,function(){o(["./fx/Toggler"])});function r(t){this._index=-1,this._animations=t||[],this._current=this._onAnimateCtx=this._onEndCtx=null,this.duration=0,e.forEach(this._animations,function(t){t&&(void 0!==t.duration&&(this.duration+=t.duration),t.delay&&(this.duration+=t.delay))},this)}var s=n.fx={},d={_fire:function(t,n){return this[t]&&this[t].apply(this,n||[]),this}};r.prototype=new t,h.extend(r,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove(),this._onEndCtx.remove(),this._onAnimateCtx=this._onEndCtx=null,this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=a.after(this._current,"onAnimate",h.hitch(this,"_onAnimate"),!0),this._onEndCtx=a.after(this._current,"onEnd",h.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(t,n){if(this._current||(this._current=this._animations[this._index=0]),!n&&"playing"==this._current.status())return this;var i=a.after(this._current,"beforeBegin",h.hitch(this,function(){this._fire("beforeBegin")}),!0),e=a.after(this._current,"onBegin",h.hitch(this,function(t){this._fire("onBegin",arguments)}),!0),o=a.after(this._current,"onPlay",h.hitch(this,function(t){this._fire("onPlay",arguments),i.remove(),e.remove(),o.remove()}));return this._onAnimateCtx&&this._onAnimateCtx.remove(),this._onAnimateCtx=a.after(this._current,"onAnimate",h.hitch(this,"_onAnimate"),!0),this._onEndCtx&&this._onEndCtx.remove(),this._onEndCtx=a.after(this._current,"onEnd",h.hitch(this,"_onEnd"),!0),this._current.play.apply(this._current,arguments),this},pause:function(){if(this._current){var n=a.after(this._current,"onPause",h.hitch(this,function(t){this._fire("onPause",arguments),n.remove()}),!0);this._current.pause()}return this},gotoPercent:function(t,n){this.pause();var i=this.duration*t;return this._current=null,e.some(this._animations,function(t,n){return i<=t.duration?(this._current=t,this._index=n,!0):(i-=t.duration,!1)},this),this._current&&this._current.gotoPercent(i/this._current.duration),n&&this.play(),this},stop:function(t){if(this._current){if(t){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var n=a.after(this._current,"onStop",h.hitch(this,function(t){this._fire("onStop",arguments),n.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop(),this._onAnimateCtx&&this._onAnimateCtx.remove(),this._onEndCtx&&this._onEndCtx.remove()}}),h.extend(r,d),s.chain=function(t){return new r(h.isArray(t)?t:Array.prototype.slice.call(t,0))};function l(t){this._animations=t||[],this._connects=[],this._finished=0,this.duration=0,e.forEach(t,function(t){var n=t.duration;t.delay&&(n+=t.delay),this.duration<n&&(this.duration=n),this._connects.push(a.after(t,"onEnd",h.hitch(this,"_onEnd"),!0))},this),this._pseudoAnimation=new u.Animation({curve:[0,1],duration:this.duration});var n=this;e.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],function(t){n._connects.push(a.after(n._pseudoAnimation,t,function(){n._fire(t,arguments)},!0))})}return h.extend(l,{_doAction:function(n,i){return e.forEach(this._animations,function(t){t[n].apply(t,i)}),this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(t,n){var i=this._pseudoAnimation;i[t].apply(i,n)},play:function(t,n){return this._finished=0,this._doAction("play",arguments),this._call("play",arguments),this},pause:function(){return this._doAction("pause",arguments),this._call("pause",arguments),this},gotoPercent:function(t,n){var i=this.duration*t;return e.forEach(this._animations,function(t){t.gotoPercent(t.duration<i?1:i/t.duration,n)}),this._call("gotoPercent",arguments),this},stop:function(t){return this._doAction("stop",arguments),this._call("stop",arguments),this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop(),e.forEach(this._connects,function(t){t.remove()})}}),h.extend(l,d),s.combine=function(t){return new l(h.isArray(t)?t:Array.prototype.slice.call(t,0))},s.wipeIn=function(t){function n(){o.height="auto",o.overflow=i}var i,e=t.node=c.byId(t.node),o=e.style,r=u.animateProperty(h.mixin({properties:{height:{start:function(){if(i=o.overflow,(o.overflow="hidden")==o.visibility||"none"==o.display)return o.height="1px",o.display="",o.visibility="",1;var t=f.get(e,"height");return Math.max(t,1)},end:function(){return e.scrollHeight}}}},t));return a.after(r,"onStop",n,!0),a.after(r,"onEnd",n,!0),r},s.wipeOut=function(t){var n,i=(t.node=c.byId(t.node)).style,e=u.animateProperty(h.mixin({properties:{height:{end:1}}},t));a.after(e,"beforeBegin",function(){n=i.overflow,i.overflow="hidden",i.display=""},!0);function o(){i.overflow=n,i.height="auto",i.display="none"}return a.after(e,"onStop",o,!0),a.after(e,"onEnd",o,!0),e},s.slideTo=function(t){var e,n=t.node=c.byId(t.node),o=null,r=null,i=(e=n,function(){var t=f.getComputedStyle(e),n=t.position;if(o="absolute"==n?e.offsetTop:parseInt(t.top)||0,r="absolute"==n?e.offsetLeft:parseInt(t.left)||0,"absolute"!=n&&"relative"!=n){var i=_.position(e,!0);o=i.y,r=i.x,e.style.position="absolute",e.style.top=o+"px",e.style.left=r+"px"}});i();var s=u.animateProperty(h.mixin({properties:{top:t.top||0,left:t.left||0}},t));return a.after(s,"beforeBegin",i,!0),s},s});