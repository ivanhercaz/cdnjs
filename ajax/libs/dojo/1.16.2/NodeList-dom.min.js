define(["./_base/kernel","./query","./_base/array","./_base/lang","./dom-class","./dom-construct","./dom-geometry","./dom-attr","./dom-style"],function(u,i,o,a,t,f,e,r,n){function s(t){return 1==t.length&&"string"==typeof t[0]}function l(t){var e=t.parentNode;e&&e.removeChild(t)}var p=i.NodeList,h=p._adaptWithCondition,c=p._adaptAsForEach,d=p._adaptAsMap;function m(n){return function(t,e,r){return 2==arguments.length?n["string"==typeof e?"get":"set"](t,e):n.set(t,e,r)}}return a.extend(p,{_normalize:function(t,e){var r=!0===t.parse;if("string"==typeof t.template){var n=t.templateFunc||u.string&&u.string.substitute;t=n?n(t.template,t):t}var i=typeof t;return"string"==i||"number"==i?t=11==(t=f.toDom(t,e&&e.ownerDocument)).nodeType?a._toArray(t.childNodes):[t]:a.isArrayLike(t)?a.isArray(t)||(t=a._toArray(t)):t=[t],r&&(t._runParse=!0),t},_cloneNode:function(t){return t.cloneNode(!0)},_place:function(t,e,r,n){if(1==e.nodeType||"only"!=r)for(var i,o=e,a=t.length,s=a-1;0<=s;s--){var l=n?this._cloneNode(t[s]):t[s];if(t._runParse&&u.parser&&u.parser.parse)for((i=i||o.ownerDocument.createElement("div")).appendChild(l),u.parser.parse(i),l=i.firstChild;i.firstChild;)i.removeChild(i.firstChild);s==a-1?f.place(l,o,r):o.parentNode.insertBefore(l,o),o=l}},position:d(e.position),attr:h(m(r),s),style:h(m(n),s),addClass:c(t.add),removeClass:c(t.remove),toggleClass:c(t.toggle),replaceClass:c(t.replace),empty:c(f.empty),removeAttr:c(r.remove),marginBox:d(e.getMarginBox),place:function(t,e){var r=i(t)[0];return this.forEach(function(t){f.place(t,r,e)})},orphan:function(t){return(t?i._filterResult(this,t):this).forEach(l)},adopt:function(t,e){return i(t).place(this[0],e)._stash(this)},query:function(e){if(!e)return this;var r=new p;return this.map(function(t){i(e,t).forEach(function(t){void 0!==t&&r.push(t)})}),r._stash(this)},filter:function(t){var e=arguments,r=this,n=0;if("string"==typeof t){if(r=i._filterResult(this,e[0]),1==e.length)return r._stash(this);n=1}return this._wrap(o.filter(r,e[n],e[n+1]),this)},addContent:function(t,e){t=this._normalize(t,this[0]);for(var r,n=0;r=this[n];n++)t.length?this._place(t,r,e,0<n):f.empty(r);return this}}),p});