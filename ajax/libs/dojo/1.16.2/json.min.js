define(["./has"],function(has){"use strict";var hasJSON="undefined"!=typeof JSON;if(has.add("json-parse",hasJSON),has.add("json-stringify",hasJSON&&'{"a":1}'==JSON.stringify({a:0},function(r,n){return n||1})),has("json-stringify"))return JSON;var escapeString=function(r){return('"'+r.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};return{parse:has("json-parse")?JSON.parse:function(str,strict){if(strict&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(str))throw new SyntaxError("Invalid characters in JSON");return eval("("+str+")")},stringify:function(r,g,h){var y;return"string"==typeof g&&(h=g,g=null),function r(i,n,e){g&&(i=g(e,i));var t,a=typeof i;if("number"==a)return isFinite(i)?i+"":"null";if("boolean"==a)return i+"";if(null===i)return"null";if("string"==typeof i)return escapeString(i);if("function"==a||"undefined"==a)return y;if("function"==typeof i.toJSON)return r(i.toJSON(e),n,e);if(i instanceof Date)return'"{FullYear}-{Month+}-{Date}T{Hours}:{Minutes}:{Seconds}Z"'.replace(/\{(\w+)(\+)?\}/g,function(r,n,e){var t=i["getUTC"+n]()+(e?1:0);return t<10?"0"+t:t});if(i.valueOf()!==i)return r(i.valueOf(),n,e);var s=h?n+h:"",f=h?" ":"",u=h?"\n":"";if(i instanceof Array){var o=i.length,c=[];for(e=0;e<o;e++)"string"!=typeof(t=r(i[e],s,e))&&(t="null"),c.push(u+s+t);return"["+c.join(",")+u+n+"]"}var l=[];for(e in i){var p;if(i.hasOwnProperty(e)){if("number"==typeof e)p='"'+e+'"';else{if("string"!=typeof e)continue;p=escapeString(e)}if("string"!=typeof(t=r(i[e],s,e)))continue;l.push(u+s+p+":"+f+t)}}return"{"+l.join(",")+u+n+"}"}(r,"","")}}});