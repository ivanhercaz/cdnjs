define(["./Deferred","./promise/Promise"],function(f,c){"use strict";return function(e,n,r,t){var i=e&&"function"==typeof e.then,o=i&&e instanceof c;if(!i)return 1<arguments.length?n?n(e):e:(new f).resolve(e);if(!o){var s=new f(e.cancel);e.then(s.resolve,s.reject,s.progress),e=s.promise}return n||r||t?e.then(n,r,t):e}});