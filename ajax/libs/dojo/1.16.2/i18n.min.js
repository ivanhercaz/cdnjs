define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./has!host-browser?./_base/xhr","./json","module"],function(g,v,y,m,x,b,a,L,r){y.add("dojo-preload-i18n-Api",1),y.add("dojo-v1x-i18n-Api",1);function t(e,n,o){return o=o?o.toLowerCase():g.locale,e=e.replace(/\./g,"/"),n=n.replace(/\./g,"/"),/root/i.test(o)?e+"/nls/"+n:e+"/nls/"+o+"/"+n}function l(e,o,n){function u(){--_||n(b.delegate(A[c]))}var r,i,t=j.exec(e),f=t[1]+"/",s=t[5]||t[4],d=f+s,a=t[5]&&t[4],l=a||g.locale||"",c=d+"/"+l,p=a?[l]:(r=l,i=x.extraLocale||[],(i=b.isArray(i)?i:[i]).push(r),i),_=p.length,h=e.split("*"),v="preload"==h[1];if(y("dojo-preload-i18n-Api")){if(v&&(A[e]||(A[e]=1,O(h[2],L.parse(h[3]),1,o)),n(1)),v||z(e,o,n)&&!A[c])return}else if(v)return void n(1);m.forEach(p,function(e){var r,i,t,a,l,c,n=d+"/"+e;y("dojo-preload-i18n-Api")&&M(n),A[n]?u():(t=f,a=s,l=e,c=u,(r=o)([i=d],function(e){var n=b.clone(e.root||e.ROOT),o=function(e,n,o,r){for(var i=[o+r],t=n.split("-"),a="",l=0;l<t.length;l++)a+=(a?"-":"")+t[l],e&&!e[a]||(i.push(o+a+"/"+r),i.specificity=a);return i}(!e._v1x&&e,l,t,a);r(o,function(){for(var e=1;e<o.length;e++)n=b.mixin(b.clone(n),arguments[e]);(A[i+"/"+l]=n).$locale=o.specificity,c()})}))})}var e=g.i18n={},j=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,A={},n=g.getL10nName=function(e,n,o){return r.id+"!"+t(e,n,o)};if(y("dojo-preload-i18n-Api")||y("dojo-v1x-i18n-Api"))var o=e.normalizeLocale=function(e){var n=e?e.toLowerCase():g.locale;return"root"==n?"ROOT":n},c=function(e,n){return!y("dojo-sync-loader")||!y("dojo-v1x-i18n-Api")||n.isXdUrl(v.toUrl(e+".js"))},u=0,f=[],O=e._preloadLocalizations=function(r,i,t,s){function d(e,n){for(var o=e.split("-");o.length;){if(n(o.join("-")))return;o.pop()}n("ROOT")}function p(){u++}function _(){for(--u;!u&&f.length;)l.apply(null,f.shift())}function h(e,n,o,r){return r.toAbsMid(e+n+"/"+o)}function e(f){d(f=o(f),function(u){if(0<=m.indexOf(i,u)){var e=r.replace(/\./g,"/")+"_"+u;return p(),o=function(e){for(var n in e){var o,r,i=e[n],t=n.match(/(.+)\/([^\/]+)$/);if(t&&(o=t[2],r=t[1]+"/",i._localized)){var a;if("ROOT"===u){var l=a=i._localized;delete i._localized,l.root=i,A[v.toAbsMid(n)]=l}else a=i._localized,A[h(r,o,u,v)]=i;if(u!==f){function c(n,o,r,i){var t=[],a=[];d(f,function(e){i[e]&&(t.push(v.toAbsMid(n+e+"/"+o)),a.push(h(n,o,e,v)))}),t.length?(p(),s(t,function(){for(var e=t.length-1;0<=e;e--)r=b.mixin(b.clone(r),arguments[e]),A[a[e]]=r;A[h(n,o,f,v)]=b.clone(r),_()})):A[h(n,o,f,v)]=r}c(r,o,i,a)}}}_()},c(n=e,s)||t?s([n],o):$([n],o,s),1}var n,o})}s=s||v,e(),m.forEach(g.config.extraLocale,e)},z=function(e,n,o){return u&&f.push([e,n,o]),u},M=function(){};if(y("dojo-v1x-i18n-Api")){var s,d={},p={},$=function(e,n,i){var t=[];m.forEach(e,function(o){var r=i.toUrl(o+".js");function e(e){var n=(s=s||new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"))(e,M,o,d);n===d?t.push(A[r]=d.result):(n instanceof Error&&(console.error("failed to evaluate i18n bundle; url="+r,n),n={}),t.push(A[r]=/nls\/[^\/]+\/[^\/]+$/.test(r)?n:{root:n,_v1x:1}))}if(A[r])t.push(A[r]);else{var n=i.syncLoadNls(o);if(n=n||M(o.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1")))t.push(n);else if(a)a.get({url:r,sync:!0,load:e,error:function(){t.push(A[r]={})}});else try{i.getText(r,!0,e)}catch(e){t.push(A[r]={})}}}),n&&n.apply(null,t)};M=function(e){for(var n,o=e.split("/"),r=g.global[o[0]],i=1;r&&i<o.length-1;r=r[o[i++]]);return r&&(n=(n=r[o[i]])||r[o[i].replace(/-/g,"_")])&&(A[e]=n),n},e.getLocalization=function(e,n,o){var r,i=t(e,n,o);return p[i]?p[i]:(l(i,c(i,v)?v:function(e,n){$(e,n,v)},function(e){p[i]=e,r=e}),r)}}return b.mixin(e,{dynamic:!0,normalize:function(e,n){return/^\./.test(e)?n(e):e},load:l,cache:A,getL10nName:n})});