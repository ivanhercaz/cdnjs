define(["../_base/config","../_base/json","../_base/kernel","../_base/lang","../_base/xhr","../sniff","../_base/window","../dom","../dom-construct","../query","require","../aspect","../request/iframe"],function(l,u,f,e,c,r,t,d,o,n,a,m,h){f.deprecated("dojo/io/iframe","Use dojo/request/iframe.","2.0");var s=h._iframeName;s=s.substring(0,s.lastIndexOf("_"));var i=e.delegate(h,{create:function(){return i._frame=h.create.apply(h,arguments)},get:null,post:null,send:function(e){var n,r=c._ioSetArgs(e,function(e){n&&n.cancel()},function(e){var r=null,t=e.ioArgs;try{var o=t.handleAs;"xml"===o||"html"===o?r=n.response.data:(r=n.response.text,"json"===o?r=u.fromJson(r):"javascript"===o&&(r=f.eval(r)))}catch(e){r=e}return r},function(e,r){return r.ioArgs._hasError=!0,e}),t=r.ioArgs,o="GET",a=d.byId(e.form);e.method&&"POST"===e.method.toUpperCase()&&a&&(o="POST");var s={method:o,handleAs:"json"===e.handleAs||"javascript"===e.handleAs?"text":e.handleAs,form:e.form,query:a?null:e.content,data:a?e.content:null,timeout:e.timeout,ioArgs:t};if(s.method&&(s.method=s.method.toUpperCase()),l.ioPublish&&f.publish&&!1!==t.args.ioPublish)var i=m.after(h,"_notifyStart",function(e){e.options.ioArgs===t&&(i.remove(),c._ioNotifyStart(r))},!0);return n=h(t.url,s,!0),t._callNext=n._callNext,n.then(function(){r.resolve(r)}).otherwise(function(e){r.ioArgs.error=e,r.reject(e)}),r},_iframeOnload:t.global[s+"_onload"]});return e.setObject("dojo.io.iframe",i),i});