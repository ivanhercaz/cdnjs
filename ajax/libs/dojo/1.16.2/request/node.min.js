define(["require","./util","./handlers","../errors/RequestTimeoutError","../node!http","../node!https","../node!url","../node!stream"],function(e,p,c,u,d,h,l,t){var m=t.Stream,f={method:"GET",query:null,data:void 0,headers:{}};function o(e,t){var s=p.parseArgs(e,p.deepCreate(f,t),t&&t.data instanceof m);e=s.url,t=s.options;var r=p.deferred(s,function(e,t){t.clientRequest.abort()});e=l.parse(e);var o=s.requestOptions={hostname:e.hostname,port:e.port,socketPath:t.socketPath,method:t.method,headers:t.headers,agent:t.agent,pfx:t.pfx,key:t.key,passphrase:t.passphrase,cert:t.cert,ca:t.ca,ciphers:t.ciphers,rejectUnauthorized:!1!==t.rejectUnauthorized};e.path&&(o.path=e.path),(t.user||t.password)&&(o.auth=(t.user||"")+":"+(t.password||""));var n=s.clientRequest=("https:"===e.protocol?h:d).request(o);if(t.socketOptions&&("timeout"in t.socketOptions&&n.setTimeout(t.socketOptions.timeout),"noDelay"in t.socketOptions&&n.setNoDelay(t.socketOptions.noDelay),"keepAlive"in t.socketOptions)){var a=t.socketOptions.keepAlive;n.setKeepAlive(0<=a,a||0)}if(n.on("socket",function(){s.hasSocket=!0,r.progress(s)}),n.on("response",function(t){s.clientResponse=t,s.status=t.statusCode,s.getHeader=function(e){return t.headers[e.toLowerCase()]||null};var o=[];t.on("data",function(e){o.push(e)}),t.on("end",function(){i&&clearTimeout(i),s.text=o.join(""),p.checkStatus(s.status)||r.reject({message:"http response code "+s.status,response:s});try{c(s),r.resolve(s)}catch(e){r.reject(e)}})}),n.on("error",r.reject),t.data?"string"==typeof t.data?n.end(t.data):t.data.pipe(n):n.end(),t.timeout)var i=setTimeout(function(){r.cancel(new u(s))},t.timeout);return r.promise}return p.addCommonMethods(o),o});