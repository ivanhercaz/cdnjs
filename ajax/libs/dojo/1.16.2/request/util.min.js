define(["exports","../errors/RequestError","../errors/CancelError","../Deferred","../io-query","../_base/array","../_base/lang","../promise/Promise","../has"],function(s,d,y,h,a,t,l,v,i){function c(e){return i("native-arraybuffer")&&e instanceof ArrayBuffer}function f(e){return i("native-blob")&&e instanceof Blob}function u(e){return e&&"object"==typeof e&&(n=e,!(i("native-formdata")&&n instanceof FormData))&&(t=e,!("undefined"!=typeof Element?t instanceof Element:1===t.nodeType))&&!f(e)&&!c(e);var t,n}s.deepCopy=function(e,t){for(var n in t){var r=e[n],o=t[n];"__proto__"!==n&&r!==o&&(u(o)?"[object Date]"===Object.prototype.toString.call(o)?e[n]=new Date(o):l.isArray(o)?e[n]=s.deepCopyArray(o):r&&"object"==typeof r?s.deepCopy(r,o):e[n]=s.deepCopy({},o):e[n]=o)}return e},s.deepCopyArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];"object"==typeof o?t.push(s.deepCopy({},o)):t.push(o)}return t},s.deepCreate=function(e,t){t=t||{};var n,r,o=l.delegate(e);for(n in e)(r=e[n])&&"object"==typeof r&&(o[n]=s.deepCreate(r,t[n]));return s.deepCopy(o,t)};var b=Object.freeze||function(e){return e};function C(e){return b(e)}function E(e){return void 0!==e.data?e.data:e.text}s.deferred=function(t,n,e,r,o,a){var i=new h(function(e){return n&&n(i,t),e&&(e instanceof d||e instanceof y)?e:new y("Request canceled",t)});i.response=t,i.isValid=e,i.isReady=r,i.handleResponse=o;var c=i.then(C).otherwise(function(e){throw e.response=t,e});s.notify&&c.then(l.hitch(s.notify,"emit","load"),l.hitch(s.notify,"emit","error"));var f=c.then(E),u=new v;for(var p in f)f.hasOwnProperty(p)&&(u[p]=f[p]);return u.response=c,b(u),a&&i.then(function(e){a.call(i,e)},function(e){a.call(i,t,e)}),i.promise=u,i.then=u.then,i},s.addCommonMethods=function(r,e){t.forEach(e||["GET","POST","PUT","DELETE"],function(n){r[("DELETE"===n?"DEL":n).toLowerCase()]=function(e,t){return(t=l.delegate(t||{})).method=n,r(e,t)}})},s.parseArgs=function(e,t,n){var r=t.data,o=t.query;return r&&!n&&("object"!=typeof r||i("native-xhr2")&&(c(r)||f(r))||(t.data=a.objectToQuery(r))),o?("object"==typeof o&&(o=a.objectToQuery(o)),t.preventCache&&(o+=(o?"&":"")+"request.preventCache="+ +new Date)):t.preventCache&&(o="request.preventCache="+ +new Date),e&&o&&(e+=(~e.indexOf("?")?"&":"?")+o),{url:e,options:t,getHeader:function(e){return null}}},s.checkStatus=function(e){return 200<=(e=e||0)&&e<300||304===e||1223===e||!e}});