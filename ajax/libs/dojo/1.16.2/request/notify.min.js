define(["../Evented","../_base/lang","./util"],function(e,n,t){var i=0,o=[].slice,r=n.mixin(new e,{onsend:function(n){i||this.emit("start"),i++},_onload:function(n){this.emit("done",n)},_onerror:function(n){this.emit("done",n)},_ondone:function(n){--i<=0&&(i=0,this.emit("stop"))},emit:function(n,t){var i=e.prototype.emit.apply(this,arguments);return this["_on"+n]&&this["_on"+n].apply(this,o.call(arguments,1)),i}});function s(n,t){return r.on(n,t)}return s.emit=function(n,t,i){return r.emit(n,t,i)},t.notify=s});