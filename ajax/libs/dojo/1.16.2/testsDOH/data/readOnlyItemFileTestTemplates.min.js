define(["dojo/main","doh/main","require","dojo/data/api/Read","dojo/data/api/Identity","dojo/date","dojo/date/stamp"],function(l,d,o){l.getObject("data.readOnlyItemFileTestTemplates",!0,tests),l.declare("tests.data.Wrapper",null,{_wrapped:null,constructor:function(e){this._wrapped=e},getValue:function(){return this._wrapped},setValue:function(e){this._wrapped=e},toString:function(){return"WRAPPER: ["+this._wrapped+"]"}}),tests.data.readOnlyItemFileTestTemplates.registerTestsForDatastore=function(e){function t(t){return function(e){return t.runTest(a,e)}}for(var a=l.getObject(e),r=tests.data.readOnlyItemFileTestTemplates.testTemplates,n=[],u=0;u<r.length;++u){var i=r[u],s={};s.name=i.name,s.runTest=t(i),n.push(s)}var o="IFSCommonTests: "+e;d.register(o,n)},tests.data.readOnlyItemFileTestTemplates.getTestData=function(e){var t=null;return"countries"===e?t=l.isBrowser?{url:o.toUrl("./countries.json")}:{data:{identifier:"abbr",label:"name",items:[{abbr:"ec",name:"Ecuador",capital:"Quito"},{abbr:"eg",name:"Egypt",capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara"},{abbr:"ee",name:"Estonia",capital:"Tallinn"},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}}:"countries_withNull"===e?t=l.isBrowser?{url:o.toUrl("./countries_withNull.json")}:{data:{identifier:"abbr",items:[{abbr:"ec",name:null,capital:"Quito"},{abbr:"eg",name:null,capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara"},{abbr:"ee",name:null,capital:"Tallinn"},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}}:"countries_withoutid"===e?t=l.isBrowser?{url:o.toUrl("./countries_withoutid.json")}:{data:{label:"name",items:[{abbr:"ec",name:null,capital:"Quito"},{abbr:"eg",name:null,capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara"},{abbr:"ee",name:null,capital:"Tallinn"},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}}:"countries_withBoolean"===e?t=l.isBrowser?{url:o.toUrl("./countries_withBoolean.json")}:{data:{identifier:"abbr",items:[{abbr:"ec",name:"Ecuador",capital:"Quito",real:!0},{abbr:"eg",name:"Egypt",capital:"Cairo",real:!0},{abbr:"sv",name:"El Salvador",capital:"San Salvador",real:!0},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo",real:!0},{abbr:"er",name:"Eritrea",capital:"Asmara",real:!0},{abbr:"ee",name:"Estonia",capital:"Tallinn",real:!0},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa",real:!0},{abbr:"ut",name:"Utopia",capital:"Paradise",real:!1}]}}:"countries_withDates"===e?t=l.isBrowser?{url:o.toUrl("./countries_withDates.json")}:{data:{identifier:"abbr",items:[{abbr:"ec",name:"Ecuador",capital:"Quito"},{abbr:"eg",name:"Egypt",capital:"Cairo"},{abbr:"sv",name:"El Salvador",capital:"San Salvador"},{abbr:"gq",name:"Equatorial Guinea",capital:"Malabo"},{abbr:"er",name:"Eritrea",capital:"Asmara",independence:{_type:"Date",_value:"1993-05-24T00:00:00Z"}},{abbr:"ee",name:"Estonia",capital:"Tallinn",independence:{_type:"Date",_value:"1991-08-20T00:00:00Z"}},{abbr:"et",name:"Ethiopia",capital:"Addis Ababa"}]}}:"geography_hierarchy_small"===e?t=l.isBrowser?{url:o.toUrl("./geography_hierarchy_small.json")}:{data:{items:[{name:"Africa",countries:[{name:"Egypt",capital:"Cairo"},{name:"Kenya",capital:"Nairobi"},{name:"Sudan",capital:"Khartoum"}]},{name:"Australia",capital:"Canberra"},{name:"North America",countries:[{name:"Canada",population:"33 million",cities:[{name:"Toronto",population:"2.5 million"},{name:"Alberta",population:"1 million"}]},{name:"United States of America",capital:"Washington DC",states:[{name:"Missouri"},{name:"Arkansas"}]}]}]}}:"data_multitype"===e?t=l.isBrowser?{url:o.toUrl("./data_multitype.json")}:{data:{identifier:"count",label:"count",items:[{count:1,value:"true"},{count:2,value:!0},{count:3,value:"false"},{count:4,value:!1},{count:5,value:!0},{count:6,value:!0},{count:7,value:"true"},{count:8,value:"true"},{count:9,value:"false"},{count:10,value:!1},{count:11,value:[!1,!1]},{count:"12",value:[!1,"true"]}]}}:"countries_references"===e&&(t=l.isBrowser?{url:o.toUrl("./countries_references.json")}:{data:{identifier:"name",label:"name",items:[{name:"Africa",type:"continent",children:[{_reference:"Egypt"},{_reference:"Kenya"},{_reference:"Sudan"}]},{name:"Egypt",type:"country"},{name:"Kenya",type:"country",children:[{_reference:"Nairobi"},{_reference:"Mombasa"}]},{name:"Nairobi",type:"city"},{name:"Mombasa",type:"city"},{name:"Sudan",type:"country",children:{_reference:"Khartoum"}},{name:"Khartoum",type:"city"},{name:"Asia",type:"continent",children:[{_reference:"China"},{_reference:"India"},{_reference:"Russia"},{_reference:"Mongolia"}]},{name:"China",type:"country"},{name:"India",type:"country"},{name:"Russia",type:"country"},{name:"Mongolia",type:"country"},{name:"Australia",type:"continent",population:"21 million",children:{_reference:"Commonwealth of Australia"}},{name:"Commonwealth of Australia",type:"country",population:"21 million"},{name:"Europe",type:"continent",children:[{_reference:"Germany"},{_reference:"France"},{_reference:"Spain"},{_reference:"Italy"}]},{name:"Germany",type:"country"},{name:"France",type:"country"},{name:"Spain",type:"country"},{name:"Italy",type:"country"},{name:"North America",type:"continent",children:[{_reference:"Mexico"},{_reference:"Canada"},{_reference:"United States of America"}]},{name:"Mexico",type:"country",population:"108 million",area:"1,972,550 sq km",children:[{_reference:"Mexico City"},{_reference:"Guadalajara"}]},{name:"Mexico City",type:"city",population:"19 million",timezone:"-6 UTC"},{name:"Guadalajara",type:"city",population:"4 million",timezone:"-6 UTC"},{name:"Canada",type:"country",population:"33 million",area:"9,984,670 sq km",children:[{_reference:"Ottawa"},{_reference:"Toronto"}]},{name:"Ottawa",type:"city",population:"0.9 million",timezone:"-5 UTC"},{name:"Toronto",type:"city",population:"2.5 million",timezone:"-5 UTC"},{name:"United States of America",type:"country"},{name:"South America",type:"continent",children:[{_reference:"Brazil"},{_reference:"Argentina"}]},{name:"Brazil",type:"country",population:"186 million"},{name:"Argentina",type:"country",population:"40 million"}]}}),t},tests.data.readOnlyItemFileTestTemplates.testTemplates=[{name:"Identity API: fetchItemByIdentity()",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){if(a.assertTrue(null!==e),null!==e){var t=r.getValue(e,"name");a.assertEqual(t,"El Salvador")}n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Identity API: fetchItemByIdentity() preventCache",runTest:function(e,a){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.urlPreventCache=!0;var r=new e(t),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){if(a.assertTrue(null!==e),null!==e){var t=r.getValue(e,"name");a.assertEqual(t,"El Salvador")}n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Identity API: fetchItemByIdentity() notFound",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred;return a.fetchItemByIdentity({identity:"sv_not",onItem:function(e){t.assertTrue(null===e),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Identity API: getIdentityAttributes()",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){a.assertTrue(null!==e);var t=r.getIdentityAttributes(e);a.assertTrue(l.isArray(t)),a.assertEqual(1,t.length),a.assertEqual("abbr",t[0]),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Identity API: fetchItemByIdentity() commentFilteredJson",runTest:function(e,a){if(l.isBrowser){var r=new e({url:o.toUrl("./countries_commentFiltered.json")}),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"name");a.assertEqual(t,"El Salvador"),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}}},{name:"Identity API: fetchItemByIdentity() nullValue",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withNull")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"ec",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"name");a.assertEqual(t,null),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Identity API: fetchItemByIdentity() booleanValue",runTest:function(e,r){var n=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withBoolean")),u=new d.Deferred;return n.fetchItemByIdentity({identity:"ut",onItem:function(e){r.assertTrue(null!==e);var t=n.getValue(e,"name");r.assertEqual(t,"Utopia");var a=n.getValue(e,"real");r.assertEqual(a,!1),u.callback(!0)},onError:function(e){r.assertTrue(!1),u.errback(e)}}),u}},{name:"Identity API: fetchItemByIdentity() withoutSpecifiedIdInData",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withoutid")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"2",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"name");a.assertEqual(t,"El Salvador"),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Identity API: fetchItemByIdentity() Object.prototype item identifier",runTest:function(e,t){var a=new e({data:{identifier:"id",items:[{id:"toString",value:"aha"}]}}),r=new d.Deferred;return a.fetchItemByIdentity({identity:"toString",onItem:function(e){t.assertTrue("aha"==e.value),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Identity API: fetchItemByIdentity() Object.prototype item identifier 2",runTest:function(e,t){var a=new e({data:{identifier:"id",items:[{id:"hasOwnProperty",value:"yep"}]}}),r=new d.Deferred;return a.fetchItemByIdentity({identity:"hasOwnProperty",onItem:function(e){t.assertTrue("yep"==e.value),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Identity API: fetchItemByIdentity() Object.prototype identity",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withoutid")),r=new d.Deferred;return a.fetchItemByIdentity({identity:"toString",onItem:function(e){t.assertTrue(null===e),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Identity API: fetchItemByIdentity() Object.prototype identity 2",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withoutid")),r=new d.Deferred;return a.fetchItemByIdentity({identity:"hasOwnProperty",onItem:function(e){t.assertTrue(null===e),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Identity API: getIdentity()",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred;return a.fetchItemByIdentity({identity:"sv",onItem:function(e){t.assertTrue(null!==e),t.assertTrue("sv"===a.getIdentity(e)),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Identity API: getIdentity() withoutSpecifiedId",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withoutid")),n=new d.Deferred;return r.fetch({query:{abbr:"sv"},onItem:function(e,t){a.assertTrue(null!==e),a.assertTrue(2===r.getIdentity(e)),n.callback(!0)},onError:function(e,t){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: fetch() all",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred;return t.fetch({onComplete:function(e,t){a.is(7,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() all failOk",runTest:function(e,t){if(l.isBrowser){var a=new e({url:"noSuchUrl",failOk:!0});console.log(a);var r=new d.Deferred;return a.fetch({onComplete:function(e,t){r.errback(new Error("Should not be here, should have failed load."))},onError:function(e,t){r.callback(!0)}}),r}}},{name:"Read API: fetch() abort",runTest:function(e,a){if(l.isBrowser){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred,n=!1;var u=t.fetch({onComplete:function(e,t){a.is(7,e.length),n?(console.log("Made it to complete callback and abort was called.  Problem."),r.errback(new Error("Should not be here."))):(console.log("in onComplete and abort has not been called.  Timing.  This is okay."),r.callback(!0))},onError:function(e,t){a.assertTrue(!0),r.callback(!0)}});return n=!0,console.log("Calling abort."),u.abort(),r}}},{name:"Read API: fetch() all (count === Infinity)",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred;return t.fetch({onComplete:function(e,t){a.is(7,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)},start:0,count:1/0}),r}},{name:"Read API: fetch() all PreventCache",runTest:function(e,a){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.urlPreventCache=!0;var r=new e(t),n=new d.Deferred;return r.fetch({onComplete:function(e,t){a.is(7,e.length),n.callback(!0)},onError:function(e,t){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: fetch() one",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred;return t.fetch({query:{abbr:"ec"},onComplete:function(e,t){a.assertEqual(e.length,1),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() shallow",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("geography_hierarchy_small")),r=new d.Deferred;return t.fetch({query:{name:"A*"},onComplete:function(e,t){a.assertEqual(e.length,2),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() Multiple",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("geography_hierarchy_small")),r=new d.Deferred,n=[!1,!1];function u(e,t){a.assertTrue(!1),r.errback(e)}return t.fetch({query:{name:"A*"},onComplete:function(e,t){n[0]=!0,a.assertEqual(e.length,2),n[0]&&n[1]&&r.callback(!0)},onError:u}),t.fetch({query:{name:"N*"},onComplete:function(e,t){n[1]=!0,n[0]&&n[1]&&r.callback(!0)},onError:u}),r}},{name:"Read API: fetch() MultipleMixedFetch",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred,u=[!1,!1];function t(e){a.assertTrue(!1),n.errback(e)}return r.fetch({query:{name:"El*"},onComplete:function(e,t){u[0]=!0,a.assertEqual(e.length,1),u[0]&&u[1]&&n.callback(!0)},onError:t}),r.fetchItemByIdentity({identity:"sv",onItem:function(e){u[1]=!0,a.assertTrue(null!==e);var t=r.getValue(e,"name");a.assertEqual(t,"El Salvador"),u[0]&&u[1]&&n.callback(!0)},onError:t}),n}},{name:"Read API: fetch() deep",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("geography_hierarchy_small")),r=new d.Deferred;return t.fetch({query:{name:"A*"},onComplete:function(e,t){a.assertEqual(e.length,4),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)},queryOptions:{deep:!0}}),r}},{name:"Read API: fetch() hierarchy off",runTest:function(e,i){var s=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("geography_hierarchy_small"));s.hierarchical=!1;var o=new d.Deferred;return s.fetch({query:{name:"A*"},onComplete:function(e,t){var a;i.assertEqual(e.length,2);var r=!0;for(a=0;a<e.length;a++){var n,u=s.getValues(e[a],"countries");if(u)for(n=0;n<u.length&&(r=!s.isItem(u[n]));n++);if(!r)break}r?o.callback(!0):o.errback(new Error("Located a child item with hierarchy off and no references in the data.  Error."))},onError:function(e,t){i.assertTrue(!1),o.errback(e)},queryOptions:{deep:!0}}),o}},{name:"Read API: fetch() hierarchy off refs still parse",runTest:function(e,i){var s=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_references"));s.hierarchical=!1;var o=new d.Deferred;return s.fetch({query:{name:"A*"},onComplete:function(e,t){var a;i.assertEqual(e.length,4);var r=!0;for(a=0;a<e.length;a++){var n,u=s.getValues(e[a],"children");if(u)for(n=0;n<u.length&&(r=s.isItem(u[n]));n++);if(!r)break}r?o.callback(!0):o.errback(new Error("Found a non-child item in a reference list in a references based input.  Error."))},onError:function(e,t){i.assertTrue(!1),o.errback(e)},queryOptions:{deep:!0}}),o}},{name:"Read API: fetch() one_commentFilteredJson",runTest:function(e,a){if(l.isBrowser){var t=new e({url:o.toUrl("./countries_commentFiltered.json")}),r=new d.Deferred;return t.fetch({query:{abbr:"ec"},onComplete:function(e,t){a.assertEqual(e.length,1),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}}},{name:"Read API: fetch() withNull",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withNull")),r=new d.Deferred;return t.fetch({query:{name:"E*"},onComplete:function(e,t){a.assertEqual(4,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() all_streaming",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return count=0,r.fetch({onBegin:function(e,t){a.assertEqual(e,7)},onItem:function(e,t){a.assertTrue(r.isItem(e)),count++},onComplete:function(e,t){a.assertEqual(count,7),a.assertTrue(null===e),n.callback(!0)},onError:function(e,t){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: fetch() paging",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;function u(e,t){a.assertEqual(e.length,5),t.start=3,t.count=1,t.onComplete=i,r.fetch(t)}function i(e,t){a.assertEqual(e.length,1),t.start=0,t.count=5,t.onComplete=s,r.fetch(t)}function s(e,t){a.assertEqual(e.length,5),t.start=2,t.count=20,t.onComplete=o,r.fetch(t)}function o(e,t){a.assertEqual(e.length,5),t.start=9,t.count=100,t.onComplete=l,r.fetch(t)}function l(e,t){a.assertEqual(e.length,0),t.start=2,t.count=20,t.onComplete=c,r.fetch(t)}function c(e,t){a.assertEqual(e.length,5),n.callback(!0)}return r.fetch({onComplete:function(e,t){a.assertEqual(e.length,7),t.start=1,t.count=5,t.onComplete=u,r.fetch(t)},onError:function(e,t){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: fetch() with MultiType Match",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("data_multitype")),r=new d.Deferred;return t.fetch({query:{count:"1*"},onComplete:function(e,t){a.assertEqual(4,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() with RegExp Match",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("data_multitype")),r=new d.Deferred;return t.fetch({query:{count:new RegExp("^1.*$","gi")},onComplete:function(e,t){a.assertEqual(4,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() with RegExp Match Inline",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("data_multitype")),r=new d.Deferred;return t.fetch({query:{count:/^1.*$/gi},onComplete:function(e,t){a.assertEqual(4,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: fetch() with MultiType, MultiValue Match",runTest:function(e,a){var t=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("data_multitype")),r=new d.Deferred;return t.fetch({query:{value:"true"},onComplete:function(e,t){a.assertEqual(7,e.length),r.callback(!0)},onError:function(e,t){a.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: getLabel()",runTest:function(e,r){var n=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),u=new d.Deferred;return n.fetch({query:{abbr:"ec"},onComplete:function(e,t){r.assertEqual(e.length,1);var a=n.getLabel(e[0]);r.assertTrue(null!==a),r.assertEqual("Ecuador",a),u.callback(!0)},onError:function(e,t){r.assertTrue(!1),u.errback(e)}}),u}},{name:"Read API: getLabelAttributes()",runTest:function(e,r){var n=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),u=new d.Deferred;return n.fetch({query:{abbr:"ec"},onComplete:function(e,t){r.assertEqual(e.length,1);var a=n.getLabelAttributes(e[0]);r.assertTrue(l.isArray(a)),r.assertEqual("name",a[0]),u.callback(!0)},onError:function(e,t){r.assertTrue(!1),u.errback(e)}}),u}},{name:"Read API: getValue()",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"name");a.assertTrue("El Salvador"===t),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: getValues()",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){a.assertTrue(null!==e);var t=r.getValues(e,"name");a.assertTrue(l.isArray(t)),a.assertEqual(t.length,1),a.assertEqual(t[0],"El Salvador"),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: isItem()",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new d.Deferred;return a.fetchItemByIdentity({identity:"sv",onItem:function(e){t.assertTrue(null!==e),t.assertTrue(a.isItem(e)),t.assertTrue(!a.isItem({})),r.callback(!0)},onError:function(e){t.assertTrue(!1),r.errback(e)}}),r}},{name:"Read API: isItem() multistore",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),u=new d.Deferred;function i(e){a.assertTrue(!1),u.errback(e)}return r.fetchItemByIdentity({identity:"sv",onItem:function(t){a.assertTrue(null!==t),n.fetchItemByIdentity({identity:"sv",onItem:function(e){a.assertTrue(null!==t),a.assertTrue(null!==e),a.assertTrue(r.isItem(t)),a.assertTrue(n.isItem(e)),a.assertTrue(!r.isItem(e)),a.assertTrue(!n.isItem(t)),u.callback(!0)},onError:i})},onError:i}),u}},{name:"Read API: hasAttribute()",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){try{a.assertTrue(null!==e),a.assertTrue(r.hasAttribute(e,"abbr")),a.assertTrue(!r.hasAttribute(e,"abbr_not"));var t=!1;try{r.hasAttribute(e,null)}catch(e){t=!0}a.assertTrue(t),n.callback(!0)}catch(e){n.errback(e)}},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: containsValue()",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"sv",onItem:function(e){a.assertTrue(null!==e),a.assertTrue(r.containsValue(e,"abbr","sv")),a.assertTrue(!r.containsValue(e,"abbr","sv1")),a.assertTrue(!r.containsValue(e,"abbr",null));var t=!1;try{r.containsValue(e,null,"foo")}catch(e){t=!0}a.assertTrue(t),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: getAttributes()",runTest:function(e,r){var n=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),u=new d.Deferred;return n.fetchItemByIdentity({identity:"sv",onItem:function(e){r.assertTrue(null!==e),r.assertTrue(n.isItem(e));var t=n.getAttributes(e);r.assertEqual(t.length,3);for(var a=0;a<t.length;a++)r.assertTrue("name"===t[a]||"abbr"===t[a]||"capital"===t[a]);u.callback(!0)},onError:function(e){r.assertTrue(!1),u.errback(e)}}),u}},{name:"Read API: getFeatures()",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")).getFeatures();t.assertTrue(null!=a["dojo.data.api.Read"]),t.assertTrue(null!=a["dojo.data.api.Identity"])}},{name:"Read API: fetch() patternMatch0",runTest:function(e,u){var i=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),s=new d.Deferred;return i.fetch({query:{abbr:"e*"},onComplete:function(e,t){u.assertEqual(e.length,5);for(var a=!0,r=0;r<e.length;r++){var n=i.getValue(e[r],"abbr");if("ec"!==n&&"eg"!==n&&"er"!==n&&"ee"!==n&&"et"!==n){a=!1;break}}u.assertTrue(a),a?s.callback(!0):s.errback(new Error("Unexpected abbreviation found, match failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)}}),s}},{name:"Read API: fetch() patternMatch1",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}}),s=new d.Deferred;return i.fetch({query:{value:"*$*"},onComplete:function(e,t){u.assertEqual(e.length,2);for(var a=!0,r=0;r<e.length;r++){var n=i.getValue(e[r],"value");if("bit$Bite"!==n&&"jfq4@#!$!@Rf14r14i5u"!==n){a=!1;break}}u.assertTrue(a),a?s.callback(!0):s.errback(new Error("Unexpected pattern matched.  Filter failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)}}),s}},{name:"Read API: fetch() patternMatch2",runTest:function(e,n){var u=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}}),i=new d.Deferred;return u.fetch({query:{value:"bar*foo"},onComplete:function(e,t){n.assertEqual(e.length,1);for(var a=!0,r=0;r<e.length;r++){if("bar*foo"!==u.getValue(e[r],"value")){a=!1;break}}n.assertTrue(a),a?i.callback(!0):i.errback(new Error("Unexpected abbreviation found, match failure."))},onError:function(e,t){n.assertTrue(!1),i.errback(e)}}),i}},{name:"Read API: fetch() patternMatch_caseSensitive",runTest:function(e,n){var u=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"BAR*foo"},{uniqueId:4,value:"BARBananafoo"}]}}),i=new d.Deferred;return u.fetch({query:{value:"bar\\*foo"},queryOptions:{ignoreCase:!1},onComplete:function(e,t){n.assertEqual(1,e.length);for(var a=!0,r=0;r<e.length;r++){if("bar*foo"!==u.getValue(e[r],"value")){a=!1;break}}n.assertTrue(a),a?i.callback(!0):i.errback(new Error("Unexpected pattern matched.  Filter failure."))},onError:function(e,t){n.assertTrue(!1),i.errback(e)}}),i}},{name:"Read API: fetch() patternMatch_caseInsensitive",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"BAR*foo"},{uniqueId:4,value:"BARBananafoo"}]}}),s=new d.Deferred;return i.fetch({query:{value:"bar\\*foo"},queryOptions:{ignoreCase:!0},onComplete:function(e,t){u.assertEqual(e.length,2);for(var a=!0,r=0;r<e.length;r++){var n=i.getValue(e[r],"value");if("BAR*foo"!==n&&"bar*foo"!==n){a=!1;break}}u.assertTrue(a),a?s.callback(!0):s.errback(new Error("Unexpected pattern matched.  Filter failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)}}),s}},{name:"Read API: fetch() sortNumeric",runTest:function(e,n){var u=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"fo|o*b.ar"},{uniqueId:1,value:"ba|r*foo"},{uniqueId:2,value:"boomBam"},{uniqueId:3,value:"bit$Bite"},{uniqueId:4,value:"ouagadogou"},{uniqueId:5,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:6,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:7,value:"squawl"},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"zulu"},{uniqueId:8,value:"seaweed"}]}}),i=new d.Deferred;return u.fetch({onComplete:function(e,t){n.assertEqual(e.length,11);for(var a=!0,r=0;r<e.length;r++){u.getValue(e[r],"value");if(u.getValue(e[r],"uniqueId")!==r){a=!1;break}}n.assertTrue(a),a?i.callback(!0):i.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){n.assertTrue(!1),i.errback(e)},sort:[{attribute:"uniqueId"}]}),i}},{name:"Read API: fetch() sortNumericDescending",runTest:function(e,n){var u=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"fo|o*b.ar"},{uniqueId:1,value:"ba|r*foo"},{uniqueId:2,value:"boomBam"},{uniqueId:3,value:"bit$Bite"},{uniqueId:4,value:"ouagadogou"},{uniqueId:5,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:6,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:7,value:"squawl"},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"zulu"},{uniqueId:8,value:"seaweed"}]}}),i=new d.Deferred;return u.fetch({onComplete:function(e,t){n.assertEqual(e.length,11);for(var a=!0,r=0;r<e.length;r++){u.getValue(e[r],"value");if(e.length-(u.getValue(e[r],"uniqueId")+1)!==r){a=!1;break}}n.assertTrue(a),a?i.callback(!0):i.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){n.assertTrue(!1),i.errback(e)},sort:[{attribute:"uniqueId",descending:!0}]}),i}},{name:"Read API: fetch() sortNumericWithCount",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"fo|o*b.ar"},{uniqueId:1,value:"ba|r*foo"},{uniqueId:2,value:"boomBam"},{uniqueId:3,value:"bit$Bite"},{uniqueId:4,value:"ouagadogou"},{uniqueId:5,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:6,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:7,value:"squawl"},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"zulu"},{uniqueId:8,value:"seaweed"}]}}),s=new d.Deferred;return i.fetch({onComplete:function(e,t){u.assertEqual(e.length,5);for(var a=10,r=!0,n=0;n<e.length;n++){i.getValue(e[n],"value");if(i.getValue(e[n],"uniqueId")!==a){r=!1;break}a--}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"uniqueId",descending:!0}],count:5}),s}},{name:"Read API: fetch() sortAlphabetic",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"abc"},{uniqueId:1,value:"bca"},{uniqueId:2,value:"abcd"},{uniqueId:3,value:"abcdefg"},{uniqueId:4,value:"lmnop"},{uniqueId:5,value:"foghorn"},{uniqueId:6,value:"qberty"},{uniqueId:7,value:"qwerty"},{uniqueId:8,value:""},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"123abc"}]}}),s=new d.Deferred;return i.fetch({onComplete:function(e,t){var a=["","123abc","abc","abcd","abcdefg","bca","foghorn","lmnop","qberty","qwerty","seaweed"];u.assertEqual(e.length,11);for(var r=!0,n=0;n<e.length;n++){i.getValue(e[n],"value");if(i.getValue(e[n],"value")!==a[n]){r=!1;break}}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"value"}]}),s}},{name:"Read API: fetch() sortAlphabeticDescending",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"abc"},{uniqueId:1,value:"bca"},{uniqueId:2,value:"abcd"},{uniqueId:3,value:"abcdefg"},{uniqueId:4,value:"lmnop"},{uniqueId:5,value:"foghorn"},{uniqueId:6,value:"qberty"},{uniqueId:7,value:"qwerty"},{uniqueId:8,value:""},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"123abc"}]}}),s=new d.Deferred;return i.fetch({onComplete:function(e,t){var a=["","123abc","abc","abcd","abcdefg","bca","foghorn","lmnop","qberty","qwerty","seaweed"];a=a.reverse(),u.assertEqual(e.length,11);for(var r=!0,n=0;n<e.length;n++){i.getValue(e[n],"value");if(i.getValue(e[n],"value")!==a[n]){r=!1;break}}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"value",descending:!0}]}),s}},{name:"Read API: fetch() sortDate",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:new Date(0)},{uniqueId:1,value:new Date(100)},{uniqueId:2,value:new Date(1e3)},{uniqueId:3,value:new Date(2e3)},{uniqueId:4,value:new Date(3e3)},{uniqueId:5,value:new Date(4e3)},{uniqueId:6,value:new Date(5e3)},{uniqueId:7,value:new Date(6e3)},{uniqueId:8,value:new Date(7e3)},{uniqueId:9,value:new Date(8e3)},{uniqueId:10,value:new Date(9e3)}]}}),s=new d.Deferred;return i.fetch({onComplete:function(e,t){var a=[0,100,1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3];u.assertEqual(e.length,11);for(var r=!0,n=0;n<e.length;n++){i.getValue(e[n],"value");if(i.getValue(e[n],"value").getTime()!==a[n]){r=!1;break}}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"value"}]}),s}},{name:"Read API: fetch() sortDateDescending",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:new Date(0)},{uniqueId:1,value:new Date(100)},{uniqueId:2,value:new Date(1e3)},{uniqueId:3,value:new Date(2e3)},{uniqueId:4,value:new Date(3e3)},{uniqueId:5,value:new Date(4e3)},{uniqueId:6,value:new Date(5e3)},{uniqueId:7,value:new Date(6e3)},{uniqueId:8,value:new Date(7e3)},{uniqueId:9,value:new Date(8e3)},{uniqueId:10,value:new Date(9e3)}]}}),s=new d.Deferred;return i.fetch({onComplete:function(e,t){var a=[0,100,1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3];a=a.reverse(),u.assertEqual(e.length,11);for(var r=!0,n=0;n<e.length;n++){i.getValue(e[n],"value");if(i.getValue(e[n],"value").getTime()!==a[n]){r=!1;break}}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"value",descending:!0}]}),s}},{name:"Read API: fetch() sortMultiple",runTest:function(e,i){var s=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"fo|o*b.ar"},{uniqueId:2,value:"ba|r*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"jfq4@#!$!@|f1.$4r14i5u"},{uniqueId:7,value:"BaB{aMa|SaRa***F}oo"},{uniqueId:8,value:"squawl"},{uniqueId:10,value:"seaweed"},{uniqueId:12,value:"seaweed"},{uniqueId:11,value:"zulu"},{uniqueId:9,value:"seaweed"}]}}),o=new d.Deferred;return s.fetch({onComplete:function(e,t){for(var a=[7,2,4,3,1,6,5,12,10,9,8,11],r=["BaB{aMa|SaRa***F}oo","ba|r*foo","bit$Bite","boomBam","fo|o*b.ar","jfq4@#!$!@|f1.$4r14i5u","ouagadogou","seaweed","seaweed","seaweed","squawl","zulu"],n=!0,u=0;u<e.length;u++){s.getValue(e[u],"value");if(s.getValue(e[u],"uniqueId")!==a[u]||s.getValue(e[u],"value")!==r[u]){n=!1;break}}i.assertTrue(n),n?o.callback(!0):o.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){i.assertTrue(!1),o.errback(e)},sort:[{attribute:"value"},{attribute:"uniqueId",descending:!0}]}),o}},{name:"Read API: fetch() sortMultipleSpecialComparator",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,status:"CLOSED"},{uniqueId:2,status:"OPEN"},{uniqueId:3,status:"PENDING"},{uniqueId:4,status:"BLOCKED"},{uniqueId:5,status:"CLOSED"},{uniqueId:6,status:"OPEN"},{uniqueId:7,status:"PENDING"},{uniqueId:8,status:"PENDING"},{uniqueId:10,status:"BLOCKED"},{uniqueId:12,status:"BLOCKED"},{uniqueId:11,status:"OPEN"},{uniqueId:9,status:"CLOSED"}]}});i.comparatorMap={},i.comparatorMap.status=function(e,t){var a=0,r={OPEN:3,BLOCKED:2,PENDING:1,CLOSED:0};return r[t]<r[e]&&(a=1),r[e]<r[t]&&(a=-1),a};var s=new d.Deferred;return i.fetch({onComplete:function(e,t){for(var a=[11,6,2,12,10,4,8,7,3,9,5,1],r=!0,n=0;n<e.length;n++){i.getValue(e[n],"value");if(i.getValue(e[n],"uniqueId")!==a[n]){r=!1;break}}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"status",descending:!0},{attribute:"uniqueId",descending:!0}]}),s}},{name:"Read API: fetch() sortAlphabeticWithUndefined",runTest:function(e,u){var i=new e({data:{identifier:"uniqueId",items:[{uniqueId:0,value:"abc"},{uniqueId:1,value:"bca"},{uniqueId:2,value:"abcd"},{uniqueId:3,value:"abcdefg"},{uniqueId:4,value:"lmnop"},{uniqueId:5,value:"foghorn"},{uniqueId:6,value:"qberty"},{uniqueId:7,value:"qwerty"},{uniqueId:8},{uniqueId:9,value:"seaweed"},{uniqueId:10,value:"123abc"}]}}),s=new d.Deferred;return i.fetch({onComplete:function(e,t){var a=[10,0,2,3,1,5,4,6,7,9,8];u.assertEqual(e.length,11);for(var r=!0,n=0;n<e.length;n++)if(i.getValue(e[n],"uniqueId")!==a[n]){r=!1;break}u.assertTrue(r),r?s.callback(!0):s.errback(new Error("Unexpected sorting order found, sort failure."))},onError:function(e,t){u.assertTrue(!1),s.errback(e)},sort:[{attribute:"value"}]}),s}},{name:"Read API: errorCondition_idCollision_inMemory",runTest:function(e,a){var t=new e({data:{identifier:"uniqueId",items:[{uniqueId:12345,value:"foo"},{uniqueId:123456,value:"bar"},{uniqueId:12345,value:"boom"},{uniqueId:123457,value:"bit"}]}}),r=new d.Deferred;return t.fetch({onComplete:function(e,t){a.assertTrue(!1),r.callback(!1)},onError:function(e,t){a.assertTrue(!0),r.callback(!0)}}),r}},{name:"Read API: errorCondition_idCollision_xhr",runTest:function(e,a){if(l.isBrowser){var t=new e({url:o.toUrl("./countries_idcollision.json")}),r=new d.Deferred;return t.fetch({onComplete:function(e,t){a.assertTrue(!1),r.callback(!1)},onError:function(e,t){a.assertTrue(!0),r.callback(!0)}}),r}}},{name:"Read API: Date_datatype",runTest:function(e,a){var r=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries_withDates")),n=new d.Deferred;return r.fetchItemByIdentity({identity:"er",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"independence");a.assertTrue(t instanceof Date),a.assertTrue("1993-05-24T00:00:00Z"===l.date.stamp.toISOString(t,{zulu:!0})),n.callback(!0)},onError:function(e){a.assertTrue(!1),n.errback(e)}}),n}},{name:"Read API: custom_datatype_Color_SimpleMapping",runTest:function(e,r){var n=new e({data:{identifier:"name",items:[{name:"Kermit",species:"frog",color:{_type:"Color",_value:"green"}},{name:"Beaker",hairColor:{_type:"Color",_value:"red"}}]},typeMap:{Color:l.Color}}),u=new d.Deferred;return n.fetchItemByIdentity({identity:"Beaker",onItem:function(e){r.assertTrue(null!==e);var t=e,a=n.getValue(t,"hairColor");r.assertTrue(a instanceof l.Color),r.assertTrue("#ff0000"==a.toHex()),u.callback(!0)},onError:function(e){u.errback(e)}}),u}},{name:"Read API: custom_datatype_Color_GeneralMapping",runTest:function(e,r){var n=new e({data:{identifier:"name",items:[{name:"Kermit",species:"frog",color:{_type:"Color",_value:"green"}},{name:"Beaker",hairColor:{_type:"Color",_value:"red"}}]},typeMap:{Color:{type:l.Color,deserialize:function(e){return new l.Color(e)}}}}),u=new d.Deferred;return n.fetchItemByIdentity({identity:"Beaker",onItem:function(e){r.assertTrue(null!==e);var t=e,a=n.getValue(t,"hairColor");r.assertTrue(a instanceof l.Color),r.assertTrue("#ff0000"==a.toHex()),u.callback(!0)},onError:function(e){u.errback(e)}}),u}},{name:"Read API: custom_datatype_CustomObject 0 (False) value",runTest:function(e,a){var r=new e({data:{identifier:"name",items:[{name:"Bob",species:"human",age:{_type:"tests.data.Wrapper",_value:0}},{name:"Nancy",species:"human",age:{_type:"tests.data.Wrapper",_value:32}}]},typeMap:{"tests.data.Wrapper":{type:tests.data.Wrapper,deserialize:function(e){return new tests.data.Wrapper(e)}}}}),n=new d.Deferred;return r.fetchItemByIdentity({identity:"Bob",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"age");a.assertTrue(t instanceof tests.data.Wrapper),a.assertTrue("WRAPPER: [0]"==t.toString()),n.callback(!0)},onError:function(e){n.errback(e)}}),n}},{name:"Read API: custom_datatype_CustomObject Boolean False values",runTest:function(e,a){var r=new e({data:{identifier:"name",items:[{name:"Bob",isHuman:{_type:"tests.data.Wrapper",_value:!1}},{name:"Nancy",isHuman:{_type:"tests.data.Wrapper",_value:!0}}]},typeMap:{"tests.data.Wrapper":{type:tests.data.Wrapper,deserialize:function(e){return new tests.data.Wrapper(e)}}}}),n=new d.Deferred;return r.fetchItemByIdentity({identity:"Bob",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"isHuman");a.assertTrue(t instanceof tests.data.Wrapper),a.assertTrue("WRAPPER: [false]"==t.toString()),n.callback(!0)},onError:function(e){n.errback(e)}}),n}},{name:"Read API: custom_datatype_CustomObject Empty String values",runTest:function(e,a){var r=new e({data:{identifier:"name",items:[{name:"Bob",lastName:{_type:"tests.data.Wrapper",_value:""}},{name:"Nancy",lastName:{_type:"tests.data.Wrapper",_value:"Doe"}}]},typeMap:{"tests.data.Wrapper":{type:tests.data.Wrapper,deserialize:function(e){return new tests.data.Wrapper(e)}}}}),n=new d.Deferred;return r.fetchItemByIdentity({identity:"Bob",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"lastName");a.assertTrue(t instanceof tests.data.Wrapper),a.assertTrue("WRAPPER: []"==t.toString()),n.callback(!0)},onError:function(e){n.errback(e)}}),n}},{name:"Read API: custom_datatype_CustomObject explicit null values",runTest:function(e,a){var r=new e({data:{identifier:"name",items:[{name:"Bob",lastName:{_type:"tests.data.Wrapper",_value:null}},{name:"Nancy",lastName:{_type:"tests.data.Wrapper",_value:"Doe"}}]},typeMap:{"tests.data.Wrapper":{type:tests.data.Wrapper,deserialize:function(e){return new tests.data.Wrapper(e)}}}}),n=new d.Deferred;return r.fetchItemByIdentity({identity:"Bob",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"lastName");a.assertTrue(t instanceof tests.data.Wrapper),a.assertTrue("WRAPPER: [null]"==t.toString()),n.callback(!0)},onError:function(e){n.errback(e)}}),n}},{name:"Read API: custom_datatype_CustomObject explicit undefined value",runTest:function(e,a){var r=new e({data:{identifier:"name",items:[{name:"Bob",lastName:{_type:"tests.data.Wrapper",_value:void 0}},{name:"Nancy",lastName:{_type:"tests.data.Wrapper",_value:"Doe"}}]},typeMap:{"tests.data.Wrapper":{type:tests.data.Wrapper,deserialize:function(e){return new tests.data.Wrapper(e)}}}}),n=new d.Deferred;return r.fetchItemByIdentity({identity:"Bob",onItem:function(e){a.assertTrue(null!==e);var t=r.getValue(e,"lastName");a.assertTrue(t instanceof tests.data.Wrapper),a.assertTrue("WRAPPER: [undefined]"==t.toString()),n.callback(!0)},onError:function(e){n.errback(e)}}),n}},{name:"Read API: hierarchical_data",runTest:function(e,u){var i=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("geography_hierarchy_small")),s=new d.Deferred;return i.fetch({query:{name:"North America"},onComplete:function(e,t){u.assertEqual(e.length,1);var a=e[0],r=i.getValue(a,"countries"),n=i.getValue(r,"cities");u.assertEqual(i.getValue(r,"name"),"Canada"),u.assertEqual(i.getValue(n,"name"),"Toronto"),s.callback(!0)},onError:function(e){s.errback(e)}}),s}},{name:"Read API: close (clearOnClose: true)",runTest:function(e,n){if(l.isBrowser){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.clearOnClose=!0,t.urlPreventCache=!0;var u=new e(t),i=new d.Deferred;return u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t=null;try{n.assertTrue(null!==e);var a=e,r=u.getValue(a,"name");n.assertEqual("Ecuador",r),u.close(),n.assertTrue(0===u._arrayOfAllItems.length),n.assertTrue(!1===u._loadFinished)}catch(e){t=e}t?i.errback(t):i.callback(!0)},onError:function(e){i.errback(e)}}),i}}},{name:"Read API: close (clearOnClose: true, reset url.)",runTest:function(e,n){if(l.isBrowser){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.clearOnClose=!0,t.urlPreventCache=!0;var u=new e(t),i=new d.Deferred;function s(e){i.errback(e)}return u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t=null;try{n.assertTrue(null!==e);var a=e,r=u.getValue(a,"name");n.assertEqual("Ecuador",r),u.close(),n.assertTrue(0===u._arrayOfAllItems.length),n.assertTrue(!1===u._loadFinished),u.url=o.toUrl("./countries_withNull.json"),u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t;try{n.assertTrue(null!==e);var a=u.getValue(e,"name");n.assertEqual(null,a)}catch(e){t=e}t?i.errback(t):i.callback(!0)},onError:s})}catch(e){t=e}t&&i.errback(t)},onError:s}),i}}},{name:"Read API: fetch, close (clearOnClose: true, reset url.)",runTest:function(e,n){if(l.isBrowser){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.clearOnClose=!0,t.urlPreventCache=!0;var u=new e(t),i=new d.Deferred;function s(e){i.errback(e)}return u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t=null;try{n.assertTrue(null!==e);var a=e,r=u.getValue(a,"name");n.assertEqual("Ecuador",r),u.close(),n.assertTrue(0===u._arrayOfAllItems.length),n.assertTrue(!1===u._loadFinished),u.url=o.toUrl("./countries_withNull.json"),u.fetch({query:{abbr:"ec"},onComplete:function(e){var t;try{n.assertEqual(1,e.length);var a=e[0];n.assertTrue(null!==a);var r=u.getValue(a,"name");n.assertEqual(null,r)}catch(e){t=e}t?i.errback(t):i.callback(!0)},onError:s})}catch(e){t=e}t&&i.errback(t)},onError:s}),i}}},{name:"Read API: close (clearOnClose: true, reset _jsonFileUrl.)",runTest:function(e,n){if(l.isBrowser){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.clearOnClose=!0,t.urlPreventCache=!0;var u=new e(t),i=new d.Deferred;function s(e){i.errback(e)}return u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t=null;try{n.assertTrue(null!==e);var a=e,r=u.getValue(a,"name");n.assertEqual("Ecuador",r),u.close(),n.assertTrue(0===u._arrayOfAllItems.length),n.assertTrue(!1===u._loadFinished),u._jsonFileUrl=o.toUrl("./countries_withNull.json"),u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t;try{n.assertTrue(null!==e);var a=u.getValue(e,"name");n.assertEqual(null,a)}catch(e){t=e}t?i.errback(t):i.callback(!0)},onError:s})}catch(e){t=e}t&&i.errback(t)},onError:s}),i}}},{name:"Read API: close (clearOnClose: false)",runTest:function(e,n){if(l.isBrowser){var t=tests.data.readOnlyItemFileTestTemplates.getTestData("countries");t.urlPreventCache=!0;var u=new e(t),i=new d.Deferred;return u.fetchItemByIdentity({identity:"ec",onItem:function(e){var t=null;try{n.assertTrue(null!==e);var a=e,r=u.getValue(a,"name");n.assertEqual("Ecuador",r),u.close(),n.assertTrue(0!==u._arrayOfAllItems.length),n.assertTrue(!0===u._loadFinished)}catch(e){t=e}t?i.errback(t):i.callback(!0)},onError:function(e){i.errback(e)}}),i}}},{name:"Read API: close (clearOnClose: true, reset data.)",runTest:function(e,n){var a=new e({data:{identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]}}),u=new d.Deferred;function i(e,t){n.assertTrue(!1),u.errback(e)}return a.fetch({query:{value:"bar*foo"},onComplete:function(e,t){n.assertEqual(e.length,1);var r=e[0];a.clearOnClose=!0,a.data={identifier:"uniqueId",items:[{uniqueId:1,value:"foo*bar"},{uniqueId:2,value:"bar*foo"},{uniqueId:3,value:"boomBam"},{uniqueId:4,value:"bit$Bite"},{uniqueId:5,value:"ouagadogou"},{uniqueId:6,value:"BaBaMaSaRa***Foo"},{uniqueId:7,value:"squawl"},{uniqueId:8,value:"seaweed"},{uniqueId:9,value:"jfq4@#!$!@Rf14r14i5u"}]},a.close();a.fetch({query:{value:"bar*foo"},onComplete:function(e,t){try{n.assertEqual(e.length,1);var a=e[0];n.assertTrue(null!=r),n.assertTrue(null!=a),n.assertTrue(r!=a),u.callback(!0)}catch(e){u.errback(e)}},onError:i})},onError:i}),u}},{name:"Identity API: no_identifier_specified",runTest:function(e,o){var l=new e({data:{items:[{name:"Kermit",color:"green"},{name:"Miss Piggy",likes:"Kermit"},{name:"Beaker",hairColor:"red"}]}}),c=new d.Deferred;return l.fetch({onComplete:function(e,t){var a=l.getFeatures(),r=Boolean(a["dojo.data.api.Identity"]);o.assertTrue(r);for(var n=0;n<e.length;++n){var u=e[n],i=l.getIdentityAttributes(u);o.assertTrue(null===i);var s=l.getIdentity(u);o.assertTrue("number"==typeof s)}c.callback(!0)},onError:function(e,t){c.errback(!0)}}),c}},{name:"Identity API: hierarchical_data",runTest:function(e,o){var l=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("geography_hierarchy_small")),c=new d.Deferred;return l.fetch({onComplete:function(e,t){var a=l.getFeatures(),r=Boolean(a["dojo.data.api.Identity"]);o.assertTrue(r);for(var n=0;n<e.length;++n){var u=e[n],i=l.getIdentityAttributes(u);o.assertTrue(null===i);var s=l.getIdentity(u);o.assertTrue("number"==typeof s)}c.callback(!0)},onError:function(e,t){c.errback(!0)}}),c}},{name:"Read API: functionConformance",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new l.data.api.Read,n=!0;for(i in r){if("_"!==i.toString().charAt(0))if("function"==typeof r[i])if("function"!=typeof a[i]){n=!1;break}}t.assertTrue(n)}},{name:"Identity API: functionConformance",runTest:function(e,t){var a=new e(tests.data.readOnlyItemFileTestTemplates.getTestData("countries")),r=new l.data.api.Identity,n=!0;for(i in r){if("_"!==i.toString().charAt(0))if("function"==typeof r[i])if("function"!=typeof a[i]){n=!1;break}}t.assertTrue(n)}}]});