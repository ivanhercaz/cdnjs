define(["./_base/kernel","./aspect","./dom","./dom-class","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],function(e,t,r,c,n,s,a,d,o,u){var g,l,h,m,f,v,p,b,i,T,y=a("ios")<5,j=a("pointer-events")||a("MSPointer"),w=function(){var e={};for(var t in{down:1,move:1,up:1,cancel:1,over:1,out:1})e[t]=a("MSPointer")?"MSPointer"+t.charAt(0).toUpperCase()+t.slice(1):"pointer"+t;return e}(),X=a("touch-events"),D=!1;function Y(a,c,o){return j&&o?function(e,t){return s(e,o,t)}:X?function(e,t){var o=s(e,c,function(e){t.call(this,e),i=(new Date).getTime()}),n=s(e,a,function(e){(!i||(new Date).getTime()>i+1e3)&&t.call(this,e)});return{remove:function(){o.remove(),n.remove()}}}:function(e,t){return s(e,a,t)}}function k(e,t,o){if(!d.isRight(e)){var n=function(e){do{if(void 0!==e.dojoClick)return e}while(e=e.parentNode)}(e.target);if((l=!e.target.disabled&&n&&n.dojoClick)&&(h=(D="useTarget"==l)?n:e.target,D&&e.preventDefault(),m=e.changedTouches?e.changedTouches[0].pageX-u.global.pageXOffset:e.clientX,f=e.changedTouches?e.changedTouches[0].pageY-u.global.pageYOffset:e.clientY,v=("object"==typeof l?l.x:"number"==typeof l?l:0)||4,p=("object"==typeof l?l.y:"number"==typeof l?l:0)||4,!g)){function i(e){l=D?r.isDescendant(u.doc.elementFromPoint(e.changedTouches?e.changedTouches[0].pageX-u.global.pageXOffset:e.clientX,e.changedTouches?e.changedTouches[0].pageY-u.global.pageYOffset:e.clientY),h):l&&(e.changedTouches?e.changedTouches[0].target:e.target)==h&&Math.abs((e.changedTouches?e.changedTouches[0].pageX-u.global.pageXOffset:e.clientX)-m)<=v&&Math.abs((e.changedTouches?e.changedTouches[0].pageY-u.global.pageYOffset:e.clientY)-f)<=p}function a(o){u.doc.addEventListener(o,function(e){var t=e.target;l&&!e._dojo_click&&(new Date).getTime()<=b+1e3&&("INPUT"!=t.tagName||!c.contains(t,"dijitOffScreen"))&&(e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),"click"==o&&("INPUT"!=t.tagName||"radio"==t.type&&(c.contains(t,"dijitCheckBoxInput")||c.contains(t,"mblRadioButton"))||"checkbox"==t.type&&(c.contains(t,"dijitCheckBoxInput")||c.contains(t,"mblCheckBox")))&&"TEXTAREA"!=t.tagName&&"AUDIO"!=t.tagName&&"VIDEO"!=t.tagName&&e.preventDefault())},!0)}g=!0,u.doc.addEventListener(t,function(e){d.isRight(e)||(i(e),D&&e.preventDefault())},!0),u.doc.addEventListener(o,function(o){if(!d.isRight(o)&&(i(o),l)){b=(new Date).getTime();var e=D?h:o.target;"LABEL"===e.tagName&&(e=r.byId(e.getAttribute("for"))||e);var n=o.changedTouches?o.changedTouches[0]:o;function t(e){var t=document.createEvent("MouseEvents");return t._dojo_click=!0,t.initMouseEvent(e,!0,!0,o.view,o.detail,n.screenX,n.screenY,n.clientX,n.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,0,null),t}var a=t("mousedown"),c=t("mouseup"),u=t("click");setTimeout(function(){s.emit(e,"mousedown",a),s.emit(e,"mouseup",c),s.emit(e,"click",u),b=(new Date).getTime()},0)}},!0),a("click"),a("mousedown"),a("mouseup")}}}a("touch")&&o(j?function(){u.doc.addEventListener(w.down,function(e){k(e,w.move,w.up)},!0)}:function(){function o(e){var t=n.delegate(e,{bubbles:!0});return 6<=a("ios")&&(t.touches=e.touches,t.altKey=e.altKey,t.changedTouches=e.changedTouches,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.targetTouches=e.targetTouches),t}T=u.body(),u.doc.addEventListener("touchstart",function(e){i=(new Date).getTime();var t=T;T=e.target,s.emit(t,"dojotouchout",{relatedTarget:T,bubbles:!0}),s.emit(T,"dojotouchover",{relatedTarget:t,bubbles:!0}),k(e,"touchmove","touchend")},!0),s(u.doc,"touchmove",function(e){i=(new Date).getTime();var t=u.doc.elementFromPoint(e.pageX-(y?0:u.global.pageXOffset),e.pageY-(y?0:u.global.pageYOffset));t&&(T!==t&&(s.emit(T,"dojotouchout",{relatedTarget:t,bubbles:!0}),s.emit(t,"dojotouchover",{relatedTarget:T,bubbles:!0}),T=t),s.emit(t,"dojotouchmove",o(e))||e.preventDefault())}),s(u.doc,"touchend",function(e){i=(new Date).getTime();var t=u.doc.elementFromPoint(e.pageX-(y?0:u.global.pageXOffset),e.pageY-(y?0:u.global.pageYOffset))||u.body();s.emit(t,"dojotouchend",o(e))})});var O={press:Y("mousedown","touchstart",w.down),move:Y("mousemove","dojotouchmove",w.move),release:Y("mouseup","dojotouchend",w.up),cancel:Y(d.leave,"touchcancel",j?w.cancel:null),over:Y("mouseover","dojotouchover",w.over),out:Y("mouseout","dojotouchout",w.out),enter:d._eventHandler(Y("mouseover","dojotouchover",w.over)),leave:d._eventHandler(Y("mouseout","dojotouchout",w.out))};return a("extend-dojo")&&(e.touch=O),O});