define(["intern!object","intern/chai!assert","dojo/_base/array","../../hash","../../router/RouterBase"],function(t,r,e,o,a){var s,n,u,i,h,c,l,f,g=0;function b(t){e.forEach(t,function(t){t.remove()})}function d(t){return l.register(t,function(){g++})}t({name:"dojo/router",after:function(){o("")},existence:{before:function(){o("",!0),l=new a},methods:function(){r.ok(l.register,"Router has a register"),r.ok(l.go,"Router has a go"),r.ok(l.startup,"Router has a startup"),r.ok(l.destroy,"Router has a destroy")}},register:{before:function(){o(""),g=0,l=new a},after:function(){b(f),g=0,l._started&&l.destroy()},handle:function(){f=d("/foo"),r.ok(f.remove,"Handle has a remove"),r.ok(f.register,"Handle has a register")}},events:{beforeEach:function(){o(""),g=0,l=new a},afterEach:function(){b(f),g=0,l._started&&l.destroy()},"before startup":function(){f=d("/foo"),o("/foo"),r.strictEqual(g,0,"Count should have been 0, was "+g)},"after startup":function(){f=d("/foo"),l.startup("/foo"),r.strictEqual(g,1,"Count should have been 1, was "+g)},"change route":function(){(f=[]).push(d("/foo")),l.startup("/foo");var t=this.async();f.push(l.register("/bar",t.callback(function(){g++,r.strictEqual(g,2,"Count should have been 2, was "+g)}))),o("/bar")},go:function(){(f=[]).push(d("/foo")),f.push(d("/bar")),l.startup("/foo"),l.go("/bar"),l.go("/foo"),r.strictEqual(g,3,"Count should have been 3, was "+g)},remove:function(){f=d("/foo"),l.startup(""),f.remove(),l.go("/foo"),r.strictEqual(g,0,"Count should have been 0, was "+g)},regex:function(){l.startup(""),f=d(/^\/bar$/),l.go("/bar"),r.strictEqual(g,1,"Count should have been 1, was "+g)}},"event object":{before:function(){o(""),g=0,(l=new a).startup("")},after:function(){b(f),g=0,l._started&&l.destroy()},structure:function(){var e,o,a,s,n;f=l.register("/checkEventObject/:foo",function(t){e=t.oldPath,o=t.newPath,a=t.params,s=t.stopImmediatePropagation,n=t.preventDefault}),l.go("/checkEventObject/bar"),r.strictEqual(e,"","oldPath should be empty string, was "+e),r.strictEqual(o,"/checkEventObject/bar","newPath should be /checkEventObject/bar, was "+o),r.ok(a,"params should be a truthy value, was "+a),r.property(a,"foo","params should have a .foo property"),r.strictEqual(a.foo,"bar","params.foo should be bar, was "+a.foo),r.isFunction(s,"stopImmediatePropagation should be a function, was "+s),r.isFunction(n,"preventDefault should be a function, was "+n)}},"route arguments":{beforeEach:function(){o(""),(l=new a).startup("")},afterEach:function(){b(f),l._started&&l.destroy()},"string route":function(){s=n=null,f=l.register("/stringtest/:applied/:arg",function(t,e,o){s=e,n=o}),l.go("/stringtest/extra/args"),r.strictEqual(s,"extra","a should have been extra, was "+s),r.strictEqual(n,"args","b should have been args, was "+n)},"regex route":function(){s=n=null,f=l.register(/\/regextest\/(\w+)\/(\w+)/,function(t,e,o){s=e,n=o}),l.go("/regextest/extra/args"),r.strictEqual(s,"extra","a should have been extra, was "+s),r.strictEqual(n,"args","b should have been args, was "+n)},"string route, long with placeholders":function(){u=null,f=l.register("/path/:to/:some/:long/*thing",function(t){u=t.params}),l.go("/path/to/some/long/thing/this/is/in/splat"),r.isObject(u,"testObject should have been an object"),r.strictEqual(u.to,"to","testObject.to should have been to, was "+u.to),r.strictEqual(u.some,"some","testObject.some should have been some, was "+u.some),r.strictEqual(u.long,"long","testObject.long should have been long, was "+u.long),r.strictEqual(u.thing,"thing/this/is/in/splat","testObject.thing should have been thing/this/is/in/splat, was "+u.thing)},"string route, numerical with placeholders":function(){u=null,f=l.register("/path/:to/:some/:long/*thing",function(t){u=t.params}),l.go("/path/1/2/3/4/5/6"),r.isObject(u,"testObject should have been an object"),r.strictEqual(u.to,"1","testObject.to should have been 1, was "+u.to),r.strictEqual(u.some,"2","testObject.some should have been 2, was "+u.some),r.strictEqual(u.long,"3","testObject.long should have been 3, was "+u.long),r.strictEqual(u.thing,"4/5/6","testObject.thing should have been 4/5/6, was "+u.thing)}},"route arguments, capture groups":{beforeEach:function(){u=null,o(""),(l=new a).startup(""),f=l.register(/^\/path\/(\w+)\/(\d+)$/,function(t){u=t.params})},afterEach:function(){b(f),l._started&&l.destroy()},"full match":function(){l.go("/path/abcdef/1234"),r.isArray(u,"testObject should have been an array"),r.strictEqual(u[0],"abcdef","testObject[0] should have been abcdef, was "+u[0]),r.strictEqual(u[1],"1234","testObject[1] should have been 1234, was "+u[1])},"no match":function(){l.go("/path/abc/def"),r.ok(!u,"testObject should have been null")},"no match alternate":function(){l.go("/path/abc123/def"),r.ok(!u,"testObject should have been null")},"full match, alternate":function(){l.go("/path/abc123/456"),r.isArray(u,"testObject should have been an array"),r.strictEqual(u[0],"abc123","testObject[0] should have been abc123, was "+u[0]),r.strictEqual(u[1],"456","testObject[1] should have been 456, was "+u[1])}},"order and propagation":{beforeEach:function(){o(""),i="",f=[],(l=new a).startup("")},afterEach:function(){b(f),l._started&&l.destroy()},".registerBefore":function(){f.push(l.register("/isBefore",function(){i+="1"})),f.push(l.registerBefore("/isBefore",function(){i+="2"})),f.push(l.register("/isBefore",function(){i+="3"})),f.push(l.registerBefore("/isBefore",function(){i+="4"})),f.push(l.register("/isBefore",function(){i+="5"})),l.go("/isBefore"),r.strictEqual(i,"42135","test should have been 42135, was "+i)},".stopImmediatePropagation":function(){f.push(l.register("/stopImmediatePropagation",function(){i+="A"})),f.push(l.register("/stopImmediatePropagation",function(){i+="B"})),f.push(l.register("/stopImmediatePropagation",function(t){t.stopImmediatePropagation(),i+="C"})),f.push(l.register("/stopImmediatePropagation",function(){i+="D"})),f.push(l.register("/stopImmediatePropagation",function(){i+="E"})),l.go("/stopImmediatePropagation"),r.strictEqual(i,"ABC","test should have been ABC, was "+i)}},defaults:{before:function(){o(""),f=[],l=new a},after:function(){b(f),l._started&&l.destroy()},".preventDefault":function(){h=!1,l.startup(""),r.strictEqual(o(),"","hash should be empty"),f.push(l.register("/preventDefault",function(t){t.preventDefault()})),f.push(l.register("/allowDefault",function(){})),h=l.go("/preventDefault"),r.strictEqual(o(),"","hash should still be empty"),r.ok(!h,"goResult should be false"),h=l.go("/someOtherPath"),r.strictEqual(o(),"/someOtherPath","hash should be /someOtherPath"),r.ok(h,"goResult should be true")},"default path":function(){c=!1,f=l.register("/default",function(){c=!0}),l.startup("/default"),r.ok(!c,"Our route was not hit, but should have been")}}})});