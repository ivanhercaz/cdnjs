define(["intern!object","intern/chai!assert","../../../io/iframe","../../../_base/kernel","../../../topic","dojo/dom","dojo/dom-construct","dojo/domReady!"],function(e,n,r,c,a,t,o){var i;function s(e,t){return{setup:function(){delete document.__dojoToDomId,i=document.createElement("div"),document.body.appendChild(i),o.place('<form id="postTest" method="'+e+'" enctype="multipart/form-data"></form>',i)},test:t,teardown:function(){document.body.removeChild(i)}}}e({name:"dojo/io/iframe",GET:{text:function(){var e=this.async();r.send({url:"/__services/request/iframe?type=text",method:"GET",timeout:5e3,preventCache:!0,handle:e.callback(function(e){n.strictEqual(e,"iframe succeeded")})}).addErrback(e.reject)},"JSON with form":s("GET",function(){var e=this.async();r.send({url:"/__services/request/iframe",form:"postTest",content:{type:"json",color:"blue",size:42},timeout:5e3,preventCache:!0,handleAs:"json",handle:e.callback(function(e){n.strictEqual(e.query.color,"blue"),n.strictEqual(e.query.size,"42")})}).addErrback(e.reject)}),JSON:function(){var e=this.async();r.send({url:"/__services/request/iframe",content:{type:"json",color:"blue",size:42},timeout:5e3,preventCache:!0,handleAs:"json",handle:e.callback(function(e){n.strictEqual(e.query.color,"blue"),n.strictEqual(e.query.size,"42")})}).addErrback(e.reject)},"JSON without POST":function(){var e=this.async();r.send({url:"/__services/request/iframe",method:"POST",content:{type:"json",color:"blue",size:42},timeout:5e3,preventCache:!0,handleAs:"json",handle:e.callback(function(e){n.strictEqual(e.method,"GET"),n.strictEqual(e.query.color,"blue"),n.strictEqual(e.query.size,"42")})}).addErrback(e.reject)},JavaScript:function(){var e=this.async();r.send({url:"/__services/request/iframe",content:{type:"javascript"},timeout:5e3,preventCache:!0,handleAs:"javascript",handle:e.callback(function(){n.strictEqual(window.iframeTestingFunction(),42)})}).addErrback(e.reject)},HTML:function(){var e=this.async();r.send({url:"/__services/request/iframe",content:{type:"html"},timeout:5e3,preventCache:!0,handleAs:"html",handle:e.callback(function(e){n.strictEqual(e.getElementsByTagName("h1")[0].innerHTML,"SUCCESSFUL HTML response")})}).addErrback(e.reject)},XML:function(){var e=this.async();r.send({url:"/__services/request/iframe",content:{type:"xml"},timeout:5e3,preventCache:!0,handleAs:"xml",handle:e.callback(function(e){n.strictEqual(e.documentElement.getElementsByTagName("child").length,4)})}).addErrback(e.reject)},"content array":function(){var e=this.async();r.send({url:"/__services/request/iframe",content:{type:"text",tag:["value1","value2"]},timeout:5e3,preventCache:!0,handle:e.callback(function(e){n.notInstanceOf(e,Error)})}).addErrback(e.reject)}},POST:s("POST",function(){var e=this.async();r.send({url:"/__services/request/iframe?type=json",method:"post",form:"postTest",content:{color:"blue",size:42},timeout:5e3,preventCache:!0,handleAs:"json",handle:e.callback(function(e){n.strictEqual(e.method,"POST"),n.strictEqual(e.payload.color,"blue"),n.strictEqual(e.payload.size,"42")})}).addErrback(e.reject)}),ioPublish:{before:function(){c.config.ioPublish=!0,this._testTopicCount=0;var e=this;var t=[a.subscribe("/dojo/io/load",function(){e._testTopicCount++})];this._remover=function(){for(var e=0;e<t.length;e++)t[e].remove()}},test:function(){var e=this.async(),t=this;a.subscribe("/dojo/io/done",e.callback(function(){n.strictEqual(t.parent._testTopicCount,1)})),r.send({url:"/__services/request/iframe",timeout:5e3,preventCache:!0})},after:function(){this._remover(),c.config.ioPublish=!1}}})});