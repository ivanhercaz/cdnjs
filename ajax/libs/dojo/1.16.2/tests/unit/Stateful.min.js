define(["intern!object","intern/chai!assert","../../Stateful","sinon","dojo/_base/declare"],function(e,n,l,u,o){e({name:"dojo/Stateful",".watch":{"notifies watcher when .set()":function(){var e="foo",t=new l({foo:3}),a=u.stub();t.watch(e,a),n.equal(t.get(e),3),t.set(e,4),n.isTrue(a.calledOnce),n.deepEqual([e,3,4],a.firstCall.args),n.equal(t.get(e),4)},"handle.remove() stops notifications":function(){var e="foo",t=new l({foo:3}),a=u.stub(),o=t.watch(e,a);t.set(e,4),n.isTrue(a.calledOnce),o.remove(),t.set(e,5),n.isTrue(a.calledOnce)},"handle.remove() is reentrant and works correctly with another watch":function(){var e="foo",t=new l({foo:3}),a=u.stub(),o=u.stub(),r=t.watch(e,a);t.watch(e,o),t.set(e,4),r.remove(),r.remove(),t.set(e,5),n.isTrue(a.calledOnce),n.isTrue(o.calledTwice)},"wildcard watcher":function(){var e=new l,t=u.stub(),a=u.stub();e.set({foo:3,bar:5}),e.watch(t),e.watch("foo",a),e.set("foo",4),e.set("bar",6),n.isTrue(t.calledTwice),n.isTrue(a.calledOnce)},"child watcher":function(){var o;model=new l({user:{name:1}}),model.watch("user",function(e,t,a){a.watch(function(e,t,a){o=[e,t,a]})});var e=new l({name:2});model.set("user",e),e.set("name",3),n.deepEqual(o,["name",2,3],"child watcher work correctly")}},".set":{"hashed value":function(){var e,t=new l,a=u.stub(),o=t.watch("foo",a);t.set({foo:3,bar:5}),n.equal(t.get("foo"),3),n.equal(t.get("bar"),5),n.isTrue(a.calledOnce),(e=new l).set(t),n.equal(e.get("foo"),3),n.equal(e.get("bar"),5),n.isTrue(a.calledOnce),o.unwatch()}},"functional getters and setters":{"accessor usage":function(){var e=new(o([l],{foo:"",bar:0,baz:"",_fooSetter:function(e){this.foo=e},_fooGetter:function(){return"bar"},_barSetter:function(e){this.bar=e}}));e.set("foo","nothing"),e.set("bar",2),e.set("baz","bar"),n.equal(e.foo,"nothing","attribute set properly"),n.equal(e.get("foo"),"bar","getter working properly"),n.equal(e.bar,2,"attribute set properly"),n.equal(e.get("bar"),2,"getter working properly"),n.equal(e.baz,"bar","property set properly"),n.equal(e.get("baz"),"bar","getter working properly")},"parameter handling":function(){var e=new(o([l],{foo:null,bar:5,_fooSetter:function(e){this.foo=e},_barSetter:function(e){this.bar=e}}))({foo:function(){return"baz"},bar:4});n.typeOf(e.foo,"function"),n.equal(e.foo(),"baz"),n.equal(e.get("bar"),4)},"_changeAttrValue() inside a setter":function(){var e=u.stub(),t=u.stub(),a=new(o([l],{foo:null,bar:null,_fooSetter:function(e){this._changeAttrValue("bar",e),this.foo=e},_barSetter:function(e){this._changeAttrValue("foo",e),this.bar=e}}));a.watch("foo",e),a.watch("bar",t),a.set("foo",3),n.equal(a.get("bar"),3),a.set("bar",4),n.equal(a.get("foo"),4),n.isTrue(e.calledTwice),n.isTrue(t.calledTwice),n.deepEqual(["bar",null,3],t.firstCall.args),n.deepEqual(["foo",null,3],e.firstCall.args),n.deepEqual(["foo",3,4],e.secondCall.args),n.deepEqual(["bar",3,4],t.secondCall.args)},"serialize correctly with setters":function(){var e=new(o([l],{foo:null,_fooSetter:function(e){this.foo=e+"baz"}}))({foo:"bar"});n.equal(JSON.stringify(e),'{"foo":"barbaz"}')}}})});