define(["intern!object","intern/chai!assert","../../dom-attr","../../dom-prop","../../dom-style","dojo/dom-construct","dojo/sniff"],function(e,r,u,n,a,t,i,o){var s,d,l,c,b,h,p,v,f,m,x,y,g,q,T,I,w,N,k,C="data-dojo-test-attribute",D="the value",L=1;function E(){return"nodeid_"+L++}e({name:"dojo/dom-attr",".get":{beforeEach:function(){s=t.toDom("<div "+C+"='"+D+"'></div>"),t.place(s,document.body)},afterEach:function(){t.destroy(s)},"node + valid attribute":function(){var e=u.get(s,C);r.equal(e,D,"when a Node and valid attribute are passed, then the correct value is returned")},"string + valid attribute":function(){var e=E();s.setAttribute("id",e);var t=u.get(e,C);r.equal(t,D,"when a Node and valid attribute are passed, then the correct value is returned")},"node + 'innerHTML' returns property":function(){var e="the expected value";s.innerHTML=e,s.setAttribute("innerHTML","not the expected value");var t=u.get(s,"innerHTML");r.equal(t,e,"when an attribute and a property exist on the node, then the property is returned")},"returns correct values":function(){var e={title:"the first value",name:"the second value","data-dojo-type":"the third value"};for(var t in e)s.setAttribute(t,e[t]);var n={};for(var t in e)n[t]=u.get(s,t);for(var t in n)r.equal(n[t],e[t],"when an attribute is requested, then the correct value is returned")},forcedProp:function(){var e="innerHTML";s[e]="the property value";var t=u.get(s,e);r.equal(t,s[e],"when the requested attribute is a 'forced prop', then the correct value is returned")},textContent:function(){var e="the expected result";s.innerHTML=e;var t=u.get(s,"textContent");r.equal(t,e,"when the textContent is requested, then the result from dom-prop::get is returned")},boolean:function(){var e="the boolean attribute";s[e]=!0;var t=u.get(s,e);r.strictEqual(t,!0,"when the attribute's value is a boolean, then it is returned correctly")},function:function(){function e(){}var t="the boolean attribute";s[t]=e;var n=u.get(s,t);r.strictEqual(n,e,"when the attribute's value is a function, then it is returned correctly")},"missing attribute":function(){var e="the none existent attribute";s.getAttributeNode=function(){return null},s[e]=void 0;var t=u.get(s,e);r.isNull(t,"when the attribute doesn't exist, then 'null' is returned")}},".set":{beforeEach:function(){s=t.toDom("<div></div>"),t.place(s,document.body)},afterEach:function(){t.destroy(s)},"node + name + value":function(){u.set(s,C,D),r.equal(s.getAttribute(C),D,"when a node's attribute is set, then the node is updated properly")},"string + name + value":function(){var e=E();s.setAttribute("id",e),u.set(e,C,D),r.equal(s.getAttribute(C),D,"when a node's id is provided to set, then the node is updated properly")},"node + dictionary":function(){var e={name:"the name","data-foo":"the foo value",title:"the title"};for(var t in u.set(s,e),e)r.equal(e[t],s.getAttribute(t),"when a hash of attributes is set onto a node, then the attributes are set properly")},"node + forcedProp":function(){var e="the-css-class";u.set(s,"class",e),r.equal(s.className,e,"when the attribute is a forcedProp, then it is set properly")},"node + name + boolean":function(){var e="data-boolean";u.set(s,e,!0),r.equal(s[e],!0,"when the attribute's value is a boolean, then it is set properly")},"node + name + function":function(){function e(){}var a,t=n.set;n.set=function(e,t,n){a=n},u.set(s,"data-function",e),r.equal(a,e,"when the attribute's value is a function, then it is set properly"),n.set=t},"node + 'style' + string":function(){var e="color: black;";u.set(s,"style",e),r.equal(s.getAttribute("style"),e,"when the attribute is 'style' and a dictionary is set, then it is set properly")},"node + 'style' + dictionary":function(){var e={color:"white",backgroundColor:"red",opacity:0},t=a.set;a.set=function(e,t){setNode=e,setValue=t},u.set(s,"style",e),r.equal(setValue,e,"when the attribute is 'style' and a dictionary is set, then it is set properly"),a.set=t}},".remove":{beforeEach:function(){s=t.toDom("<div "+C+"='"+D+"'></div>"),t.place(s,document.body)},afterEach:function(){t.destroy(s)},"node + attribute":function(){u.remove(s,C),r.isNull(s.getAttribute(C),"when an attribute is removed from a node, then its value becomes 'null'")},"string + attribute":function(){var e=E();s.setAttribute("id",e),u.remove(e,C),r.isNull(s.getAttribute(C),"when a node's id is used, then the requested attribute is removed")},"node + 'className'":function(){u.remove(s,"className"),r.isNull(s.getAttribute("class"),"when a class in the 'attrNames' array, then the proper attribute is removed")}},".getNodeProp":{beforeEach:function(){s=t.toDom("<div "+C+"='"+D+"'></div>"),t.place(s,document.body)},afterEach:function(){t.destroy(s)},"node + name":function(){var e=u.getNodeProp(s,C);r.equal(e,D,"when an attribute is requested from a node, then the correct value is returned")},"string + name":function(){var e=E();s.setAttribute("id",e);var t=u.getNodeProp(e,C);r.equal(t,D,"when a node's id is passed, then the correct value is returned")},"node + 'className'":function(){var e="the-css-class";s.setAttribute("class",e);var t=u.getNodeProp(s,"className");r.equal(t,e,"when 'className' is requested, then the node's class is returned")},"node + 'innerHTML' returns property":function(){var e="the innerHTML value";s.innerHTML=e,s.setAttribute("innerHTML","not the expected value");var t=u.getNodeProp(s,"innerHTML");r.equal(t,e,"when 'innerHTML' is requested and there is both a property and attribute with that name, then the node's property is returned")},"node + 'name' returns property":function(){var e="name";s[e]="the value",s.setAttribute(e,"not the expected value");var t=u.getNodeProp(s,e);r.equal(t,D,"when an attribute is requested and there is both a property and attribute with that name, then the node's property is returned")}},".has":{beforeEach:function(){s=t.toDom("<div "+C+"='"+D+"'></div>"),t.place(s,document.body)},afterEach:function(){t.destroy(s)},"node + name":function(){var e=u.has(s,C);r.isTrue(e,"when an existing attribute on a node is checked for, then the call returns 'true'")},"string + name":function(){var e=E();s.setAttribute("id",e);var t=u.has(e,C);r.isTrue(t,"when a node's id is provided and the requested attribute exists, then the call returns 'true'")},"node + 'innerHTML'":function(){s.innerHTML=null;var e=u.has(s,"innerHTML");r.isTrue(!!e,"when the 'innerHTML' is requested, then it always returns truthy")},"node + non existent name":function(){var e=u.has(s,"doesnotexist");r.isFalse(!!e,"when an attribute that doesn't exist on a node is checked for, then the call returns 'true'")}},"validation tests":{setup:function(){d=t.toDom("<div></div>"),l=t.toDom('<input id="input-no-type">'),c=t.toDom('<input id="input-with-type" type="checkbox">'),b=t.toDom('<input id="input-no-tabindex">'),h=t.toDom('<input id="input-tabindex-minus-1" tabIndex="-1">'),p=t.toDom('<input id="input-tabindex-0" tabIndex="0">'),v=t.toDom('<input id="input-tabindex-1" tabIndex="1">'),f=t.toDom('<input id="input-text-value" type="text" value="123">'),m=t.toDom('<input id="input-no-disabled" type="text">'),x=t.toDom('<input id="input-with-disabled" type="text" disabled>'),y=t.toDom('<input id="input-with-disabled-true" disabled="disabled">'),g=t.toDom('<div id="div-no-tabindex"></div>'),q=t.toDom('<div id="div-tabindex-minus-1" tabIndex="-1"></div>'),T=t.toDom('<div id="div-tabindex-0" tabIndex="0"></div>'),I=t.toDom('<div id="div-tabindex-1" tabIndex="1"></div>'),w=t.toDom('<label id="label-no-for">label with no for </label><input type="text" id="label-test-input">'),N=t.toDom('<label id="label-with-for" for="input-with-label">label with for </label>'),k=t.toDom('<input type="text" id="input-with-label">'),t.place(d,document.body),t.place(l,d),t.place(c,d),t.place(b,d),t.place(h,d),t.place(p,d),t.place(v,d),t.place(f,d),t.place(m,d),t.place(x,d),t.place(y,d),t.place(g,d),t.place(q,d),t.place(T,d),t.place(I,d),t.place(w,d),t.place(N,d),t.place(k,d)},teardown:function(){t.destroy(d)},getTypeInput:function(){r.isFalse(u.has(l,"type")),r.isNull(u.get(l,"type")),r.isTrue(u.has(c,"type")),r.equal(u.get(c,"type"),"checkbox")},getWithString:function(){r.isFalse(u.has(l.id,"type")),r.isNull(u.get(l.id,"type")),r.isTrue(u.has(c.id,"type")),r.equal(u.get(c.id,"type"),"checkbox")},attrId:function(){r.isTrue(u.has(g.id,"id")),r.equal(g.id,u.get(g.id,"id"));var e=document.createElement("div");r.isFalse(u.has(e,"id")),r.isNull(u.get(e,"id"));var t=E();u.set(e,"id",t),r.isTrue(u.has(e,"id")),r.equal(u.get(e,"id"),t),u.remove(e,"id"),r.isFalse(u.has(e,"id")),r.isNull(u.get(e,"id"))},getTabindexDiv:function(){r.isFalse(u.has(g,"tabIndex")),r.isTrue(u.get(g,"tabIndex")<=0),r.isTrue(u.has(q,"tabIndex")),i("opera")||r.equal(u.get(q,"tabIndex"),-1),r.isTrue(u.has(T,"tabIndex")),r.equal(u.get(T,"tabIndex"),0),r.equal(u.get(I,"tabIndex"),1)},getTabindexInput:function(){r.isFalse(u.has("input-no-tabindex","tabIndex")),r.isFalse(!!u.get("input-no-tabindex","tabIndex")),r.isTrue(u.has("input-tabindex-minus-1","tabIndex")),i("opera")||r.equal(u.get("input-tabindex-minus-1","tabIndex"),-1),r.isTrue(u.has("input-tabindex-0","tabIndex")),r.equal(u.get("input-tabindex-0","tabIndex"),0),r.equal(u.get("input-tabindex-1","tabIndex"),1)},setTabindexDiv:function(){var e=document.createElement("div");r.isNull(u.get(e,"tabIndex")),u.set(e,"tabIndex",-1),i("opera")||r.equal(u.get(e,"tabIndex"),-1),u.set(e,"tabIndex",0),r.equal(u.get(e,"tabIndex"),0),u.set(e,"tabIndex",1),r.equal(u.get(e,"tabIndex"),1)},setTabindexInput:function(){var e=document.createElement("input");r.isTrue(u.get(e,"tabIndex")<=0),u.set(e,"tabIndex",-1),i("opera")||r.equal(u.get(e,"tabIndex"),-1),u.set(e,"tabIndex",0),r.equal(u.get(e,"tabIndex"),0),u.set(e,"tabIndex",1),r.equal(u.get(e,"tabIndex"),1)},removeTabindexFromDiv:function(){var e=document.createElement("div");u.set(e,"tabIndex",1),r.equal(u.get(e,"tabIndex"),1),u.remove(e,"tabIndex"),r.isNull(u.get(e,"tabIndex"))},removeDisabledFromInput:function(){var e=document.createElement("input");u.set(e,"disabled",!0),r.isTrue(u.get(e,"disabled")),u.remove(e,"disabled"),r.isFalse(u.get(e,"disabled"))},removeTabindexFromInput:function(){var e=document.createElement("input");u.set(e,"tabIndex",1),r.equal(u.get(e,"tabIndex"),1),u.remove(e,"tabIndex"),r.isNull(u.get(e,"tabIndex"))},setReadonlyInput:function(){var e=document.createElement("input");r.isFalse(u.get(e,"readonly")),u.set(e,"readonly",!0),r.isTrue(u.get(e,"readonly")),u.set(e,"readonly",!1),r.isFalse(u.get(e,"readonly"))},attr_map:function(){var e=document.createElement("input"),t=document.createElement("input"),n=0,a=!1,i={tabIndex:1,type:"text",onfocus:function(e){n++,a=!0}};u.set(e,i),u.set(t,{onfocus:function(e){a=!0}}),document.body.appendChild(e),document.body.appendChild(t),r.equal(u.get(e,"tabIndex"),i.tabIndex,"tabIndex"),r.equal(u.get(e,"type"),i.type,"type"),r.equal(n,0,"onfocus ctr == 0");var o=this.async(1e3);firstCallback=o.callback(function(){a?(console.log("one"),r.equal(n,1,"onfocus ctr == 1"),a=!1,t.focus()):setTimeout(firstCallback,50)}),secondCallback=o.callback(function(){a?(console.log("two"),a=!1,e.focus()):setTimeout(secondCallback,50)}),thirdCallback=o.callback(function(){a?(console.log("three"),r.equal(n,2,"onfocus ctr == 2"),a=!1):setTimeout(thirdCallback,50)}),a=!1,firstCallback(),e.focus()},attr_reconnect:function(){var e=document.createElement("input"),t=document.createElement("input"),n=!1,a=0;u.set(e,"type","text"),u.set(e,"onfocus",function(e){a++,n=!0}),u.set(e,"onfocus",function(e){a++,n=!0}),u.set(e,"onfocus",function(e){a++,n=!0}),u.set(t,"onfocus",function(e){n=!0}),document.body.appendChild(e),document.body.appendChild(t),r.equal(u.get(e,"type"),"text"),r.equal(a,0);var i=this.async(1e3);firstCallback=i.callback(function(){n?(r.equal(a,1,"onfocus ctr == 1"),n=!1,t.focus()):setTimeout(firstCallback,50)}),secondCallback=i.callback(function(){n?(n=!1,e.focus()):setTimeout(secondCallback,50)}),thirdCallback=i.callback(function(){n?(r.equal(a,2,"onfocus ctr == 2"),n=!1):setTimeout(thirdCallback,50)}),n=!1,firstCallback(),e.focus()},attrSpecials:function(){var e=document.createElement("div"),t={opacity:.5,width:"30px",border:"1px solid black"},n={innerHTML:"howdy!"};document.body.appendChild(e),u.set(e,{style:t}),r.equal(e.style.opacity,t.opacity),r.equal(e.style.width,t.width),r.equal(e.style.borderWidth,t.border.split(" ")[0]),u.set(e,n),r.equal(e.innerHTML,n.innerHTML),r.equal(u.get(e,"innerHTML"),n.innerHTML),u.set(e,"innerHTML","<span>howdy!</span>"),r.equal(e.firstChild.nodeType,1),r.equal(e.firstChild.nodeName.toLowerCase(),"span"),r.equal(e.innerHTML.toLowerCase(),"<span>howdy!</span>"),r.equal(u.get(e,"innerHTML").toLowerCase(),"<span>howdy!</span>")},testLabelForAttr:function(){var e=document.createElement("label");i("ie")||(r.isNull(u.get(e,"for")),r.isNull(u.get(e,"htmlFor"))),u.set(e,"for","testId"),r.equal(u.get(e,"for"),"testId");var t=document.createElement("label");u.set(t,"htmlFor","testId2"),r.equal(u.get(t,"htmlFor"),"testId2"),r.isTrue(u.has(e,"for")),r.isTrue(u.has(t,"htmlfor")),i("ie")||(r.isFalse(u.has(w,"for")),r.isFalse(u.has(w,"htmlFor"))),r.isTrue(u.has(N,"for")),r.isTrue(u.has(N,"htmlFor")),r.equal(u.get(N,"for"),"input-with-label"),r.equal(u.get(N,"htmlFor"),"input-with-label")},attrInputTextValue:function(){r.equal(f.value,"123"),r.equal(u.get("input-text-value","value"),"123"),u.set("input-text-value","value","abc"),r.equal(f.value,"abc"),r.equal(u.get("input-text-value","value"),"abc"),f.value="xyz",r.equal(f.value,"xyz"),r.equal(u.get("input-text-value","value"),"xyz"),f.value="123"},testInputDisabled:function(){r.isFalse(u.get("input-no-disabled","disabled")),r.isTrue(u.get("input-with-disabled","disabled")),r.isTrue(u.get("input-with-disabled-true","disabled"))}}})});