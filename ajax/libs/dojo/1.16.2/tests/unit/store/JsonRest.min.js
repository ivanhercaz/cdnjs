define(["intern!object","intern/chai!assert","dojo/Deferred","dojo/_base/lang","dojo/_base/array","./support/xhrStub","require","sinon"],function(e,o,r,n,t,a,s,i){var d,l,c={"test-global-header-a":!0,"test-global-header-b":"yes"},h={"test-local-header-a":!0,"test-local-header-b":"yes","test-override":"overridden"};function u(r){var e=Array.prototype.slice.call(arguments,1);e.push(c),t.forEach(e,function(e){for(var t in e)e.hasOwnProperty(t)&&o.propertyVal(r,t,e[t])})}e({name:"dojo/store/JsonRest",setup:function(){var t=new r;return s({map:{"testing/store/JsonRest":{"testing/_base/xhr":s.toAbsMid("./support/xhrStub")}}},["testing/store/JsonRest"],function(e){l=e,t.resolve()}),t.promise},beforeEach:function(){a.reset(),a.objectToQuery=i.stub(),d=new l({target:s.toUrl("dojo/tests/store/x.y").match(/(.+)x\.y$/)[1],headers:n.mixin({"test-override":!1},c)})},".get":{beforeEach:function(){var e=new r;e.resolve({id:"node1.1",name:"node1.1",someProperty:"somePropertyA1",children:[{$ref:"node1.1.1",name:"node1.1.1"},{$ref:"node1.1.2",name:"node1.1.2"}]}),a.returns(e)},test:function(){var e=this.async(),t="node1.1";d.get(t).then(e.callback(function(e){o.equal(e.name,t),o.equal(e.someProperty,"somePropertyA1")}),n.hitch(e,"reject"))},"headers provided as object":function(){d.get("destinationUrl",h),u(a.lastCall.args[1].headers,h)},"headers provided in options":function(){d.get("destinationUrl",{headers:h}),u(a.lastCall.args[1].headers,h)}},".query":{beforeEach:function(){var e=new r;e.resolve([{id:"node1",name:"node1",someProperty:"somePropertyA",children:[{$ref:"node1.1",name:"node1.1",children:!0},{$ref:"node1.2",name:"node1.2"}]},{id:"node2",name:"node2",someProperty:"somePropertyB"},{id:"node3",name:"node3",someProperty:"somePropertyC"},{id:"node4",name:"node4",someProperty:"somePropertyA"},{id:"node5",name:"node5",someProperty:"somePropertyB"}]),a.returns(e)},test:function(){var e=this.async();d.query("treeTestRoot").then(e.callback(function(e){var t=e[0];o.equal(t.name,"node1"),o.equal(t.someProperty,"somePropertyA")}),n.hitch(e,"reject"))},"null query":function(){var e=this.async();d.query().then(e.callback(function(e){var t=e[0];o.equal(t.name,"node1"),o.equal(t.someProperty,"somePropertyA")}),n.hitch(e,"reject"))},"result iteration":function(){var e=this.async();d.query("treeTestRoot").forEach(function(e,t){var r="node"+(t+1);o.equal(e.name,r)}).then(n.hitch(e,"resolve"),n.hitch(e,"reject"))},"headers provided in options with range elements":function(){d.query({},{headers:h,start:20,count:42}),u(a.lastCall.args[1].headers,h,{"X-Range":"items=20-61",Range:"items=20-61"})}},".remove":{"headers provied in options":function(){d.remove("destinationUrl",{headers:h}),u(a.lastCall.args[1].headers,h)}},".put":{"headers provided in options":function(){d.put({},{headers:h}),u(a.lastCall.args[1].headers,h)}},".add":{"headers provided in options":function(){d.add({},{headers:h}),u(a.lastCall.args[1].headers,h)}},"._getTarget":{"without slash":function(){d.target=d.target.slice(0,-1),o.equal(d.target+"/foo",d._getTarget("foo"))},"with slash":function(){o.equal(d.target+"foo",d._getTarget("foo"))},"with equals":function(){d.target=d.target.slice(0,-1)+"=",o.equal(d.target+"foo",d._getTarget("foo"))}},teardown:function(){a.throws(new Error("this is a stub function"))}})});