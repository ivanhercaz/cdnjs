define(["intern!object","intern/chai!assert","../../../store/Cache","../../../store/Memory","dojo/_base/array"],function(e,t,n,r,a){var i,u,d,o,s;e({name:"dojo/store/Cache",beforeEach:function(){u=new r({data:i=[{id:1,name:"one",prime:!(s={})},{id:2,name:"two",even:!0,prime:!0},{id:3,name:"three",prime:!0},{id:4,name:"four",even:!0,prime:!1},{id:5,name:"five",prime:!0}]}),d=new r,o=n(u,d,s)},".get":{"basic usage":function(){a.forEach(i,function(e){t.equal(o.get(e.id).name,e.name)})},"caches record on first get":function(){a.forEach(i,function(e){t.isUndefined(d.get(e.id)),t.equal(o.get(e.id).name,e.name),t.equal(d.get(e.id).name,e.name)})}},".query":{"options#isLoaded()":{"returns false .query() does not trigger a cache":function(){s.isLoaded=function(){return!1},t.equal(o.query({prime:!0}).length,3),t.equal(o.query({even:!0})[1].name,"four"),a.forEach(i,function(e){t.isUndefined(d.get(e.id))})},"returns true .query() does cache":function(){s.isLoaded=function(){return!0},t.equal(o.query({prime:!0}).length,3),t.equal(d.get(3).name,"three")},"is undefined caches by default":function(){var e=o.query();t.lengthOf(e,5),e.forEach(function(e){t.equal(d.get(e.id).name,e.name)})}},"with sort":function(){t.equal(o.query({prime:!0},{sort:[{attribute:"name"}]}).length,3),t.equal(o.query({even:!0},{sort:[{attribute:"name"}]})[1].name,"two")}},".put":{"updating a record":function(){var e=o.get(4);t.isUndefined(e.square),e.square=!0,o.put(e),e=o.get(4),t.isTrue(e.square),e=d.get(4),t.isTrue(e.square),e=u.get(4),t.isTrue(e.square)},"creating a new record":function(){o.put({id:6,perfect:!0}),t.isTrue(o.get(6).perfect),t.isTrue(d.get(6).perfect),t.isTrue(u.get(6).perfect)}},".add":{"adding a new record":function(){o.add({id:7,prime:!0}),t.isTrue(o.get(7).prime),t.isTrue(d.get(7).prime),t.isTrue(u.get(7).prime)},"adding an existing record throws":function(){var e={id:5,perfect:!0};t.throws(function(){o.add(e)})},"uses masterStore#add()":function(){var e,n=u.add;u.add=function(){return{test:"value"}},e=o.add({id:7,prop:"doesn't matter"}),t.property(e,"test"),t.equal(e.test,"value"),u.add=n}}})});