define(["intern!object","intern/chai!assert","../../../store/Memory","dojo/store/util/QueryResults"],function(e,a,t,r){var i=[{id:1,name:"one",even:!1,prime:!1,mappedTo:"E",date:new Date(1970,0,1)},{id:2,name:"two",even:!0,prime:!0,mappedTo:"D",date:new Date(1980,1,2)},{id:3,name:"three",even:!1,prime:!0,mappedTo:"C",date:new Date(1990,2,3)},{id:4,name:"four",even:!0,prime:!1,mappedTo:null,date:new Date(1972,3,6,12,1)},{id:5,name:"five",even:!1,prime:!0,mappedTo:"A",date:new Date(1972,3,6,6,2)}],u=new t({data:i});e({name:"dojo/store/Memory",".get":[function(){a.strictEqual(u.get(1).name,"one"),a.strictEqual(u.get(4).name,"four"),a.ok(u.get(5).prime)}],".query":{"with boolean":function(){a.strictEqual(u.query({prime:!0}).length,3),a.strictEqual(u.query({even:!0})[1].name,"four")},"with string":function(){a.strictEqual(u.query({name:"two"}).length,1),a.strictEqual(u.query({name:"two"})[0].name,"two")},"with RegExp":function(){a.strictEqual(u.query({name:/^t/}).length,2),a.strictEqual(u.query({name:/^t/})[1].name,"three"),a.strictEqual(u.query({name:/^o/}).length,1),a.strictEqual(u.query({name:/o/}).length,3)},"with test function":function(){var e=u.query({id:{test:function(e){return e<4}}});a.strictEqual(e.length,3);var t=u.query({even:{test:function(e,t){return e&&2<t.id}}});a.strictEqual(t.length,1)},"with sort":function(){function e(e,t){if(e.hasOwnProperty("map")){a.strictEqual(e.length,t.length,"Length of query should be "+t.length),a.strictEqual(e.total,t.total,"Total of query should be "+t.total);for(var n=0,r=t.length;n<r;n++)a.deepEqual(e[n],t[n])}else a.deepEqual(e,t)}var t=new r([i[4],i[2],i[1],i[0],i[3]]),n=new r([i[3],i[1]]);a.strictEqual(u.query({prime:!0},{sort:[{attribute:"name"}]}).length,3),e(u.query({even:!0},{sort:[{attribute:"name"}]}),n),e(u.query({even:!0},{sort:function(e,t){return e.name<t.name?-1:1}}),n),e(u.query(null,{sort:[{attribute:"mappedTo"}]}),t),e(u.query({},{sort:[{attribute:"date",descending:!1}]}).map(function(e){return e.id}),new r([1,5,4,2,3]))},"with paging":function(){a.strictEqual(u.query({prime:!0},{start:1,count:1}).length,1),a.strictEqual(u.query({even:!0},{start:1,count:1})[0].name,"four")}},".put":{update:function(){var e=u.get(4);e.square=!0,u.put(e),e=u.get(4),a.ok(e.square)},new:function(){u.put({id:6,perfect:!0}),a.ok(u.get(6).perfect)}},".add":{duplicate:function(){var t;try{u.add({id:6,perfect:!0})}catch(e){t=!0}a.ok(t)},new:function(){u.add({id:7,prime:!0}),a.ok(u.get(7).prime)},"new id assignment":function(){var e={random:!0};u.add(e),a.isDefined(e.id)}},".remove":{"existing item":function(){a.ok(u.remove(7)),a.ok(!u.get(7))},"missing item":function(){a.ok(!u.remove(77)),a.strictEqual(u.get(1).id,1)}},misc:{"IFRS style data":function(){var e=new t({data:{items:[{name:"one",even:!1,prime:!1},{name:"two",even:!0,prime:!0},{name:"three",even:!1,prime:!0}],identifier:"name"}});a.strictEqual(e.get("one").name,"one"),a.strictEqual(e.query({name:"one"})[0].name,"one")}}})});