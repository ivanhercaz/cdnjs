define(["intern!object","intern/chai!assert","../../../store/DataStore","../../../data/ItemFileReadStore","../../../data/ItemFileWriteStore","dojo/_base/lang"],function(e,r,n,t,i,a){var o,c,u;e({name:"dojo/store/DataStore",beforeEach:function(){o={items:[{id:1,name:"one",prime:!1},{id:2,name:"two",even:!0,prime:!0},{id:3,name:"three",prime:!0},{id:4,name:"four",even:!0,prime:!1},{id:5,name:"five",prime:!0,children:[{_reference:1},{_reference:2},{_reference:3}]}],identifier:"id"},(c=new i({data:a.clone(o)})).fetchItemByIdentity({identity:null}),u=new n({store:c})},construction:{"when using a read-only store then write methods unavailable":function(){var e=new n({store:new t({})});r.isNotFunction(e.put),r.isNotFunction(e.add)}},".get":function(){r.equal(u.get(1).name,"one"),r.equal(u.get(4).name,"four"),r.isTrue(u.get(5).prime),r.equal(u.get(5).children[1].name,"two"),r.ok(void 0===u.get(10))},".query":{"basic query returns expected data":function(){var e=this.async(500);u.query({even:!0}).map(e.callback(function(e){var n=o.items[e.id-1];for(var t in e)e.hasOwnProperty(t)&&r.propertyVal(n,t,e[t])}),a.hitch(e,"reject"))},"provides children":function(){var e=this.async(500);u.query({prime:!0}).then(e.callback(function(e){r.lengthOf(e,3),r.equal(e[2].children[2].name,"three")}),a.hitch(e,"reject"))}},".put":{"update a record":function(){var e=u.get(4);r.notOk(e.square),e.square=!0,u.put(e),e=u.get(4),r.isTrue(e.square)},"add a new record":function(){u.put({id:6,perfect:!0}),r.isTrue(u.get(6).perfect)},"overwrite new":function(){return u.put({id:8,name:"eight"},{overwrite:!0}).then(function(){r.fail()},function(){})}},".add":{"new record":function(){u.add({id:7,name:"seven"}),r.equal(u.get(7).name,"seven")},"existing record":function(){return u.add({id:1,name:"one"}).then(function(){r.fail()},function(){})}},".remove":{"multiple calls":function(){return u.remove(5).then(function(e){r.ok(e)}).then(function(){return u.remove(7)}).then(function(e){r.ok(!e)})}}})});