define(["intern!object","intern/chai!assert","testing"],function(o,e,f){o({name:"dojo/_base/connect",afterEach:function(){f.global.gFoo=void 0,f.global.gOk=void 0},"smoke test":function(){var o,n={foo:function(){o=!1}};n.foo(),e.isFalse(o),f.connect(n,"foo",null,function(){o=!0}),n.foo(),e.isTrue(o)},"basic test":function(){var o="",n={foo:function(){o+="foo"},bar:function(){o+="bar"},baz:function(){o+="baz"}},t=f.connect(n,"foo",n,"bar");f.connect(n,"bar",n,"baz"),o="",n.foo(),e.equal(o,"foobarbaz"),o="",n.bar(),e.equal(o,"barbaz"),o="",n.baz(),e.equal(o,"baz"),f.connect(n,"foo",n,"baz"),f.disconnect(t),o="",n.foo(),e.equal(o,"foobaz"),o="",n.bar(),e.equal(o,"barbaz"),o="",n.baz(),e.equal(o,"baz")},"hub connect disconnect 1000":function(){e.equal(function(o){function n(){}function t(){0}for(var c,e=[],i=0;i<o;i++)Math.random()<.5?e.push(f.connect("hub",t)):f.connect("hub",n);if(i<Math.pow(10,4)){for(var a=[];e.length;)c=Math.floor(Math.random()*e.length),a.push(e[c]),e.splice(c,1);e=a}for(c=0;c<e.length;c++)f.disconnect(e[c]);return 0}(1e3),0)},"test with four arguments":function(){var o,n={foo:function(){o=!1},bar:function(){o=!0}};f.connect(n,"foo",n,"bar"),n.foo(),e.isTrue(o)},"test with three arguments":function(){var o,n;f.global.gFoo=function(){o=!1},f.global.gOk=function(){o=!0},n=f.connect("gFoo",null,"gOk"),f.global.gFoo(),f.disconnect(n),e.isTrue(o),n=f.connect(null,"gFoo","gOk"),f.global.gFoo(),f.disconnect(n),e.isTrue(o),f.global.gFoo(),e.isFalse(o)},"test with two arguments":function(){var o,n;f.global.gFoo=function(){o=!1},f.global.gOk=function(){o=!0},n=f.connect("gFoo","gOk"),f.global.gFoo(),f.disconnect(n),e.isTrue(o),n=f.connect("gFoo",f.global.gOk),f.global.gFoo(),f.disconnect(n),e.isTrue(o)},"scope test one":function(){var o={ok:!0,foo:function(){this.ok=!1}},n={ok:!1,bar:function(){this.ok=!0}};f.connect(o,"foo",n,"bar"),o.foo(),e.isFalse(o.ok),e.isTrue(n.ok)},"scope test two":function(){var o={ok:!0,foo:function(){this.ok=!1}},n=!1,t=function(){this.ok=!0};f.connect(o,"foo",t),o.foo(),e.isTrue(o.ok),e.isFalse(n)},pubsub:function(){var t=0;f.subscribe("/test/blah",function(o,n){e.equal(o,"first"),e.equal(n,"second"),t++}),f.publish("/test/blah",["first","second"]),e.equal(t,1)},"connect publisher":function(){var o={inc:0,foo:function(){this.inc++}},n={inc:0,bar:function(){this.inc++}},t=f.connectPublisher("/blah",o,"foo"),c=f.connectPublisher("/blah",o,"foo");f.subscribe("/blah",n,"bar"),o.foo(),e.equal(o.inc,1),e.equal(n.inc,2),f.disconnect(t),o.foo(),e.equal(o.inc,2),e.equal(n.inc,3),f.disconnect(c),o.foo(),e.equal(o.inc,3),e.equal(n.inc,3)},"publish subscribe 1000":function(){e.equal(function(o){function n(){}function t(){e++}for(var c,e=0,i="hubbins",a=[],u=0;u<o;u++)Math.random()<.5?a.push(f.subscribe(i,t)):f.subscribe(i,n);if(u<Math.pow(10,4)){for(var s=[];a.length;)c=Math.floor(Math.random()*a.length),s.push(a[c]),a.splice(c,1);a=s}for(c=0;c<a.length;c++)f.unsubscribe(a[c]);return e=0,f.publish(i),e}(1e3),0)}})});