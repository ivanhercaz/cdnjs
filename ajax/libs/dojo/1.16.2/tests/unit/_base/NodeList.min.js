define(["intern!object","intern/chai!assert","sinon","../../../_base/NodeList","dojo","../../../query","../../../on","../../../dom-construct","../../../dom-attr","../../../string","../../../parser","../../../_base/array"],function(e,c,i,u,d,r,a,s,t){function l(e,a){for(var t,n=0;t=e[n];n++)c.equal(t.id,a[n]);c.equal(n,a.length)}var n,o,p,m,q,h,f,v,b,y,g,N,w,C,L,T,E;e({name:"dojo/_base/NodeList","connect()":{"delegates to dojo.connect for each node":function(){function e(){}var a=[document.createElement("div"),document.createElement("div")],t=new u(a),n=d.connect,l="onClick",i=[],o=[];for(var s in d.connect=function(){i.push(arguments),o=this},t.connect(l,e),a)c.propertyVal(i,{0:l,1:e}),c.propertyVal(o,a[s]);d.connect=n}},"coords()":(E=[{l:1,t:2,w:3,h:4},{l:10,t:11,w:12,h:13}],{setup:function(){for(var e in C=[],T=document.createElement("div"),E){var a=document.createElement("div");C.push(a),T.appendChild(a),a.style.position="absolute",a.style.left=E[e].l+"px",a.style.top=E[e].t+"px",a.style.width=E[e].w+"px",a.style.height=E[e].h+"px"}L=new u(C),document.body.appendChild(T)},teardown:function(){document.body.removeChild(T)},"returns array of the nodelist's nodes' coordinates":function(){var e=L.coords();for(var a in E)for(var t in E[a])c.propertyVal(e[a],E[a][t])}}),events:(w=["blur","focus","change","click","error","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","submit"],{"delegates wiring of event handlers for each to NodeList::connect with correct arguments":function(){var e=[document.createElement("input"),document.createElement("div")],a=new u(e),t=i.stub(a,"connect"),n=[];for(var l in w)t.withArgs("on"+w[l],w[l]+"0",w[l]+"1").returns(w[l]+"return");for(var l in w)n.push(a["on"+w[l]](w[l]+"0",w[l]+"1"));for(var l in w)c.isTrue(t.calledWith("on"+w[l],w[l]+"0",w[l]+"1")),c.include(n,w[l]+"return")}}),"validation tests":(y=0,g="_base/NodeList"+y++,N=a,{setup:function(){m=document.createElement("div"),n=document.createElement("div");var e=document.createElement("div");n.appendChild(e),e.id=g,e.style.width="120px",e.style.height="130px",o=document.createElement("div");var a=s.toDom('<h1>testing dojo.NodeList</h1><div id="sq100-NodeList" style="position:absolute;left:100px;top:100px;width:100px;height:100px;">    100px square, abs</div><div id="t-NodeList">    <span id="c1-NodeList">c1</span></div>');s.place(a,o),p=document.createElement("div"),a=s.toDom("<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>"),s.place(a,p),m.appendChild(n),m.appendChild(o),m.appendChild(p),document.body.appendChild(m),h=d.byId("c1-NodeList"),f=d.byId("t-NodeList"),v=d.byId("sq100-NodeList"),b=new u(h,f,h,f)},teardown:function(){document.body.removeChild(m)},connect:function(){(q=document.createElement("div")).innerHTML="<div>    <span></span></div><span class='thud'>    <button>blah</button></span>",document.body.appendChild(q);var e=0,a=r("button",q).connect("onclick",function(){e++});a[0].click(),c.equal(1,e),a[0].click(),a[0].click(),c.equal(3,e)},coords:function(){var e=new u(d.byId(g));c.isTrue(d.isArrayLike(e)),c.equal(120,e.coords()[0].w,120),c.equal(130,e.coords()[0].h,130),c.equal(r("body *").coords().length,document.body.getElementsByTagName("*").length),c.equal(r("body *").position().length,document.body.getElementsByTagName("*").length)},ctor:function(){var e=new u;e.push(h),c.equal(e.length,1)},ctorArgs:function(){var e=new u(4);e.push(h),c.equal(e.length,5)},ctorArgs2:function(){var e=new u(h,f);c.equal(e.length,2),c.equal(e[0],h),c.equal(e[1],f)},forEach:function(){var a,e=new u(h,f);e.forEach(function(e){a=e}),c.equal(a,f);var t=e.forEach(function(e,a,t){c.instanceOf(t,u),c.equal(t.length,2)});c.instanceOf(t,u),c.equal(e,t)},indexOf:function(){c.equal(b.indexOf(h),0),c.equal(b.indexOf(f),1),c.equal(b.indexOf(null),-1)},lastIndexOf:function(){c.equal(b.lastIndexOf(h),2),c.equal(b.lastIndexOf(f),3),c.equal(b.lastIndexOf(null),-1)},every:function(){var e=0,a=b.every(function(){return e++,!0});c.equal(e,4),c.isTrue(a),e=0,a=b.every(function(){return e++,!1}),c.equal(e,1),c.isFalse(a)},some:function(){var e=b.some(function(){return!0});c.isTrue(e),e=b.some(function(e){return"t-NodeList"==e.id}),c.isTrue(e)},map:function(){for(var e=b.map(function(){return!0}),a=0;a<e.length;a++)c.equal(e[a],!0);l(e.end(),["c1-NodeList","t-NodeList","c1-NodeList","t-NodeList"]);var t=0;e=b.map(function(){return t++}),c.instanceOf(e,u);var n=0;b.map(function(){return 2}).forEach(function(e){n+=e}),c.equal(n,8)},slice:function(){var e=new u(f,f,h);c.equal(e.slice(1).length,2),c.equal(e.length,3),c.equal(e.slice(-1)[0],h),c.equal(e.slice(-2).length,2),l(e.slice(1).end(),["t-NodeList","t-NodeList","c1-NodeList"])},splice:function(){var e=new u(f,f,h);c.equal(e.splice(1).length,2),c.equal(e.length,1),e=new u(f,f,h),c.equal(e.splice(-1)[0],h),c.equal(e.length,2),e=new u(f,f,h),c.equal(e.splice(-2).length,2)},spliceInsert:function(){var e=new u(f,f,h);e.splice(0,0,h),c.equal(e.length,4),c.equal(e[0],h),(e=new u(f,f,h)).splice(0,0,h,v),c.equal(e.length,5),c.equal(e[0],h),c.equal(e[1],v),c.equal(e[2],f),(e=new u(f,f,h)).splice(1,0,h,v),c.equal(e.length,5),c.equal(e[0],f),c.equal(e[1],h),c.equal(e[2],v),c.equal(e[3],f)},spliceDel:function(){var e=new u(h,f,v);e.splice(0,1),c.equal(e.length,2),c.equal(e[0],f),(e=new u(h,f,v)).splice(0,2),c.equal(e.length,1),c.equal(e[0],v),(e=new u(h,f,v)).splice(1,1),c.equal(e.length,2),c.equal(e[0],h),c.equal(e[1],v)},spliceInsertDel:function(){var e=new u(h,f,v);e.splice(1,1,v),c.equal(e.length,3),c.deepEqual(e,new u(h,v,v)),(e=new u(h,f,v)).splice(1,2,v),c.equal(e.length,2),c.deepEqual(e,new u(h,v))},queryTest:function(){var e=new u(f);c.equal(e.query("span")[0],h),"t-NodeList"!=name&&(c.equal(r(":last-child",o)[0],f),c.equal(r(":last-child",o)[1],h),c.equal(e.query().length,1),l(e.query("span").end(),["t-NodeList"]))},filter:function(){if("t-NodeList"!=name){c.equal(h,r(":first-child",o).filter(":last-child")[0]),c.equal(r("*",m).filter(function(e){return"span"==e.nodeName.toLowerCase()}).length,1);var e={filterFunc:function(e){return"span"==e.nodeName.toLowerCase()}};c.equal(r("*",m).filter(e.filterFunc).length,1),c.equal(r("*",m).filter(e.filterFunc,e).length,1),l(new u(f).filter("span").end(),["t-NodeList"])}},position:function(){var e=new u(d.byId("sq100-NodeList"));c.isTrue(d.isArrayLike(e)),c.equal(e.position()[0].w,100),c.equal(e.position()[0].h,100),c.equal(r("body *").position().length,document.body.getElementsByTagName("*").length)},styleGet:function(){var e=new u(v);c.equal(e.style("opacity")[0],1),e.push(f),d.style(f,"opacity",.5),c.equal(e.style("opacity").slice(-1)[0],.5),e.style("opacity",1)},styleSet:function(){var e=new u(v,f);e.style("opacity",.5),c.equal(d.style(e[0],"opacity"),.5),c.equal(d.style(e[1],"opacity"),.5),e.style("opacity",1)},style:function(){var e=new u(v,f);e.style("opacity",1),c.equal(e.style("opacity")[0],1),d.style(f,"opacity",.5),c.equal(e.style("opacity")[0],1),c.equal(e.style("opacity")[1],.5),e.style("opacity",1)},addRemoveClass:function(){var e=new u(v,f);e.addClass("a"),c.equal(v.className,"a"),c.equal(f.className,"a"),e.addClass("a b"),c.equal(v.className,"a b"),c.equal(f.className,"a b"),e.addClass(["a","c"]),c.equal(v.className,"a b c"),c.equal(f.className,"a b c"),e.removeClass(),c.equal(v.className,""),c.equal(f.className,""),e.addClass("    a"),c.equal(v.className,"a"),c.equal(f.className,"a"),e.addClass(" a  b "),c.equal(v.className,"a b"),c.equal(f.className,"a b"),e.addClass(" c  b a "),c.equal(v.className,"a b c"),c.equal(f.className,"a b c"),e.removeClass(" b"),c.equal(v.className,"a c"),c.equal(f.className,"a c"),e.removeClass("a b "),c.equal(v.className,"c"),c.equal(f.className,"c"),e.removeClass(["a","c"]),c.equal(v.className,""),c.equal(f.className,""),e.addClass("a b c"),e.replaceClass("d e","a b"),c.equal(v.className,"c d e","class is c d e after replacing a b with d e"),c.equal(f.className,"c d e","class is c d e after replacing a b with d e"),e.replaceClass("f","d"),c.equal(v.className,"c e f","class is c e f after replacing d with f"),c.equal(f.className,"c e f","class is c e f after replacing d with f"),e.replaceClass("d"),c.equal(v.className,"d"),c.equal(f.className,"d"),e.removeClass(),c.equal(v.className,"","empty class"),c.equal(f.className,"","empty class")},concat:function(){if("t"!=name){var e=r("span",o),a=r("div",o),t=e.concat(a);console.debug(t),c.isTrue(t.constructor==u||t.constructor==u),c.equal(t.length,a.length+e.length),l(t.end(),["c1-NodeList"])}},concat2:function(){var e=r("span",o);r("div",o),c.instanceOf(e.concat([]),u)},concat3:function(){var e=r("span",o),a=r("div",o),t=e.concat(a);c.instanceOf(t,u)},concat4:function(){var e=(new d.NodeList).concat([]);c.equal(e.length,0)},place:function(){var e=document.createElement("div");e.innerHTML="<div><span></span></div><span class='thud'><b>blah</b></span>",d.body().appendChild(e);var a=r("b",e).place(e,"first");c.instanceOf(a,u),c.equal(a.length,1),c.equal(a[0].nodeName.toLowerCase(),"b"),c.equal(a[0].parentNode,e),c.equal(a[0],e.firstChild)},orphan:function(){var e="<div><span></span></div><span class='thud'><b>blah</b></span>",a=document.createElement("div");a.innerHTML=e,d.body().appendChild(a);var t=r("span",a).orphan();c.instanceOf(t,u),c.equal(t.length,2),c.equal(a.getElementsByTagName("*").length,1),a.innerHTML=e,t=r("*",a).orphan("b"),c.equal(t.length,1),c.equal(t[0].innerHTML,"blah")},adopt:function(){var e=r(d.create("div"));e.adopt(d.create("span")),e.adopt(d.create("em"),"first"),c.equal(2,r("*",e[0]).length,2),c.equal(e[0].firstChild.tagName.toLowerCase(),"em"),c.equal(e[0].lastChild.tagName.toLowerCase(),"span")},addContent:function(){var e=document.createElement("div"),a=r(e).addContent("some text content");c.equal(a[0].childNodes.length,1),c.equal(a[0].firstChild.nodeValue,"some text content");var t=document.createElement("span");t.id="addContent1",t.innerHTML="hello",d.body().appendChild(t),c.isNotNull(d.byId("addContent1")),a.addContent(t),c.isNull(d.byId("addContent1")),c.equal(a[0].lastChild.id,"addContent1"),e.innerHTML='<select><option name="second"  value="second" selected>second</option></select>',(a=r("select",e).addContent('<option name="first" value="first">first</option>',"first")).forEach(function(e){c.equal(e.options[0].value,"first"),c.isFalse(e.options[0].selected)});var n=s.toDom('<div class="multitemplate"></div><div class="multitemplate"></div>');s.place(n,document.body),(n=r(".multitemplate")).addContent({template:"<b>[name]</b>",templateFunc:function(e,a){return e.replace(/\[name\]/g,a.name)},name:"bar"});var l=n.query("b");c.equal(l.length,2),l.forEach(function(e){c.equal(e.innerHTML,"bar")}),n.addContent({template:"<p>${name}</p>",name:"baz"});var i=n.query("p");c.equal(i.length,2),i.forEach(function(e){c.equal(e.innerHTML,"baz")}),d.declare("dojo.testsDOH.Mini",null,{constructor:function(e,a){d.mixin(this,e),a.innerHTML=this.name,this.domNode=a},name:""}),n.addContent({template:'<i dojoType="dojo.testsDOH.Mini">cool</i>',parse:!0});var o=n.query("[dojoType]");c.equal(o.length,2),d.forEach(o,function(e){c.equal(e.innerHTML,"cool")}),n.orphan()},on:function(){var e=0;d.body().appendChild(q);var a=r("button",q),t=a.on("click",function(){e++});a[0].click(),c.equal(e,1);var n=a[0].appendChild(document.createElement("span"));N.emit(a[0],"click",{}),N.emit(n,"click",{bubbles:!0}),N.emit(n,"click",{bubbles:!1}),c.equal(e,3),t.remove(),N.emit(a[0],"click",{}),c.equal(e,3)},onDelegate:function(){var e=0;d.body().appendChild(q);var a=r(".thud",q),t=r("button",q),n=a.on("button:click",function(){c.equal(t[0],this),e++});c.equal(e,0),N.emit(a[0],"click",{}),N.emit(t[0],"click",{bubbles:!0}),c.equal(e,1),n.remove(),N.emit(t[0],"click",{bubbles:!0}),c.equal(e,1),r(q).on(".thud:click, .thud button:custom",function(){e++}),N.emit(t[0],"click",{bubbles:!0}),c.equal(e,2),N.emit(t[0],"click",{bubbles:!1}),c.equal(e,2),N.emit(t[0],"custom",{bubbles:!0}),c.equal(e,3),N.emit(t[0],"mouseout",{bubbles:!0}),c.equal(e,3),t[0].click(),c.equal(e,4)},at:function(){var e=r("div",p),a=e.at(0);if(c.equal(a[0],e[0]),"t-NodeList"!=name){var t=e.at(1,3,5);c.equal(t[0],e[1]),c.equal(t[1],e[3]),c.equal(t[2],e[5]);var n=e.at(3,6,9);c.equal(n.length,2);var l=e.at(3,6).at(1);c.equal(l[0],e[6]);var i=e.at(0).end();c.equal(i,e);var o=e.at(-1);c.equal(o[0],e[e.length-1]);var s=e.at(1,-1);c.equal(e[1],s[0]),c.equal(e[e.length-1],s[1])}},attr:function(){r("div").attr("id")},_adaptAsForEach:function(){var a=!1,t=0,e={setTrue:function(e){t++,a=!0}};u.prototype.setTrue=u._adaptAsForEach(e.setTrue,e);var n=r("div").setTrue();c.isTrue(a),c.equal(n.length,t)},instantiate:function(){s.place('<p id="thinger">Hi</p><p id="thinger2">Hi</p>',document.body);var t=0;d.declare("testsDOH._base.NodeList.some.Thing",null,{foo:"baz",constructor:function(e,a){d.mixin(this,e),c.equal(this.foo,"bar",t++)}}),r("#thinger").instantiate(testsDOH._base.NodeList.some.Thing,{foo:"bar"}),r("#thinger2").instantiate("testsDOH._base.NodeList.some.Thing",{foo:"bar"}),c.equal(t,2),r("#thinger, #thinger2").orphan()},removeAttr:function(){s.place('<p id="attr" title="Foobar">Hi</p>',document.body);var e=r("#attr");c.isTrue(d.hasAttr(e[0],"title"));var a=e.attr("title");c.equal(a,"Foobar"),e.removeAttr("title"),a=t.has(e[0],"title"),c.isFalse(a),e.orphan()}})})});