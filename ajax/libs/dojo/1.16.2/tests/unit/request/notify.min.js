define(["intern!object","intern/chai!assert","dojo/promise/all","../../../request/xhr","../../../request/notify","../../../errors/CancelError"],function(e,c,o,s,a,n){function i(){var n=arguments;return function(){for(var e=0;e<n.length;e++)n[e].remove();return null}}var u;e({name:"dojo/request/notify",afterEach:function(){u=u&&u()},"start/send":function(){var e=this.async(),n=0,t=0;u=i(a("start",function(){n++}),a("send",function(){t++})),o([s.get("/__services/request/xhr?delay=1000"),s.get("/__services/request/xhr?delay=1000")]).then(e.callback(function(){c.strictEqual(n,1),c.strictEqual(t,2)}),e.reject)},load:function(){var e=this.async(),n=!1;u=i(a("done",function(){n=!0}),a("load",e.rejectOnError(function(e){c.deepEqual(e.data.query,{foo:"bar"}),c.ok(!n)})),a("stop",e.callback(function(){c.ok(n)}))),s.get("/__services/request/xhr?foo=bar",{handleAs:"json"})},error:function(){var e=this.async(),n=!1;u=i(a("done",e.rejectOnError(function(e){n=!0,c.instanceOf(e,Error)})),a("error",e.rejectOnError(function(e){c.instanceOf(e,Error),c.ok(!n)})),a("stop",e.callback(function(){c.ok(n)}))),s.get("doesntExist.text")},"done/stop":function(){var e=this.async(),n=0,t=0,r=!1;u=i(a("done",function(){n++,r=0===t}),a("stop",function(){t++})),o([s.get("/__services/request/xhr?delay=1000"),s.get("/__services/request/xhr?delay=1000")]).then(e.callback(function(){c.ok(r),c.strictEqual(n,2),c.strictEqual(t,1)}),e.reject)},cancel:function(){var e=this.async();u=i(a("send",function(e,n){n()})),s.get("/__services/request/xhr?delay=1000").then(e.reject,e.callback(function(e){c.instanceOf(e,n)}))}})});