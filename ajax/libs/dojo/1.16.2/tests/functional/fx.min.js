define(["require","intern!object","intern/chai!assert","intern/dojo/node!leadfoot/helpers/pollUntil"],function(t,n,e,o){var a="./support/fx.html";function i(n,e){return n.get("remote").setExecuteAsyncTimeout(5e3).get(t.toUrl(e)).then(o("return ready || null;"))}function u(n){return n.execute(function(){return domClass.add("foo","compressed"),domGeometry.position("foo")}).then(function(n){e.isTrue(n.h<10)})}n({name:"dojo/fx",".slideTo":function(){return i(this,a).executeAsync(function(n){var e=fx.slideTo({node:"foo",duration:500,left:500,top:50}).play();on(e,"End",function(){n(domGeometry.getMarginBox("foo"))})}).then(function(n){e.equal(n.t,50),e.equal(n.l,500)})},".wipeOut":{".play":function(){return i(this,a).executeAsync(function(n){var e=fx.wipeOut({node:"foo"}).play();on(e,"End",function(){n(domGeometry.position("foo"))})}).then(function(n){e.isTrue(n.w<5)})},onStop:function(){return i(this,a).executeAsync(function(n){var e=fx.wipeOut({node:"foo",duration:1e3});aspect.after(e,"onStop",function(){n(!0)},!0),e.play(),setTimeout(function(){e.stop()},100)}).then(function(n){e.isTrue(n)})}},".wipeIn":{".play":function(){return u(i(this,a)).executeAsync(function(n){var e=fx.wipeIn({node:"foo"}).play();on(e,"End",function(){n(domGeometry.position("foo"))})}).then(function(n){e.isTrue(10<n.h)})},onStop:function(){return u(i(this,a)).executeAsync(function(n){var e=fx.wipeIn({node:"foo",duration:1e3});aspect.after(e,"onStop",function(){n(!0)},!0),e.play(),setTimeout(function(){e.stop()},100)}).then(function(n){e.isTrue(n)})}},".chain":{"onEnd both children animations are stopped":function(){return u(i(this,a)).executeAsync(function(n){var e=fx.wipeIn({node:"foo",duration:500}),t=baseFx.fadeOut({node:"foo",duration:500}),o=fx.chain([e,t]);on(o,"End",function(){n({status:{wipeIn:e.status(),fadeOut:t.status(),anim:o.status()}})}),o.play()}).then(function(n){e.equal(n.status.wipeIn,"stopped"),e.equal(n.status.fadeOut,"stopped"),e.equal(n.status.anim,"stopped")})},delay:function(){return i(this,a).executeAsync(function(n){var e,t=fx.chain(createAnimationList());aspect.after(t,"onEnd",function(){n({expected:t.duration,actual:new Date-e})},!0),e=+new Date,t.play()}).then(function(n){e.isTrue(100<n.actual),e.closeTo(n.actual,n.actual,100)})},"onEnd is called":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2",duration:400}),t=baseFx.fadeIn({node:"foo2",duration:400}),o=fx.chain([e,t]);aspect.after(o,"onEnd",function(){n()},!0),o.play()})},"onPlay is called":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2",duration:400}),t=baseFx.fadeIn({node:"foo2",duration:400}),o=fx.chain([e,t]);aspect.after(o,"onPlay",function(){n()},!0),o.play()})},"chain multiple combine animations":function(){return i(this,a).executeAsync(function(n){var e=fx.combine([baseFx.fadeIn({node:"chained"}),baseFx.fadeOut({node:"chainedtoo"})]),t=fx.combine([baseFx.fadeOut({node:"chained"}),baseFx.fadeIn({node:"chainedtoo"})]),o=fx.chain([e,t]);aspect.after(o,"onEnd",function(){n(!0)},!0),o.play()}).then(function(n){e.isTrue(n)})}},".gotoPercent + .chain":function(){return i(this,a).executeAsync(function(n){for(var e,t=[baseFx.fadeOut({node:"baz"}),baseFx.fadeIn({node:"baz"}),fx.wipeOut({node:"baz"}),fx.wipeIn({node:"baz"}),fx.slideTo({node:"baz",top:200,left:300})],o=fx.chain(t),a=t.length,i=a-Math.floor(.34*a),u=0,c=0;e=t[c];c++)aspect.before(e,"onEnd",function(){u++});aspect.after(o,"onEnd",function(){n(i===u)}),o.gotoPercent(.34,!0)}).then(function(n){e.isTrue(n)})},".combine":{"test basic functionality":function(){return u(i(this,a)).executeAsync(function(n){var e=fx.wipeIn({node:"foo",duration:500}),t=baseFx.fadeIn({node:"foo",duration:1e3}),o=fx.combine([e,t]);aspect.after(o,"onEnd",function(){n({status:{wipeIn:e.status(),fadeIn:t.status(),combine:o.status()}})},!0),o.play()}).then(function(n){e.equal(n.status.wipeIn,"stopped"),e.equal(n.status.fadeIn,"stopped"),e.equal(n.status.combine,"stopped")})},"beforeBegin is called":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2",duration:400}),t=baseFx.fadeIn({node:"foo2",duration:400}),o=fx.combine([e,t]);aspect.after(o,"beforeBegin",function(){n(!0)},!0),o.play()}).then(function(n){e.isTrue(n)})},delay:function(){return i(this,a).executeAsync(function(n){var e,t=fx.combine(createAnimationList());aspect.after(t,"onEnd",function(){n({expected:t.duration,actual:new Date-e})},!0),e=+new Date,t.play()}).then(function(n){e.isTrue(100<n.actual),e.closeTo(n.actual,n.actual,100)})},"onEnd is called":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2",duration:400}),t=baseFx.fadeIn({node:"foo2",duration:400}),o=fx.combine([e,t]);aspect.after(o,"onEnd",function(){n()},!0),o.play()})},"onPlay is called":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2",duration:400}),t=baseFx.fadeIn({node:"foo2",duration:400}),o=fx.combine([e,t]);aspect.after(o,"onPlay",function(){n()},!0),o.play()})},"combining chains":function(){return i(this,a).executeAsync(function(n){var e=fx.chain([baseFx.fadeIn({node:"chained"}),baseFx.fadeOut({node:"chained"})]),t=fx.chain([baseFx.fadeOut({node:"chainedtoo"}),baseFx.fadeIn({node:"chainedtoo"})]),o=fx.combine([e,t]);aspect.after(o,"onEnd",function(){n(!0)},!0),o.play()}).then(function(n){e.isTrue(n)})}},".stop":{delay:function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2",delay:400});aspect.after(e,"onPlay",function(){n(!1)},!0),e.play(),e.stop(),setTimeout(function(){n(!0)},500)}).then(function(n){e.isTrue(n)})},"delay passed to play":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo2"});aspect.after(e,"onPlay",function(){n(!1)},!0),e.play(400),e.stop(),setTimeout(function(){n(!0)},600)}).then(function(n){e.isTrue(n)})}},".destroy":function(){return i(this,a).executeAsync(function(n){var e=baseFx.fadeOut({node:"foo",duration:5e3}),t=!1;aspect.after(e,"stop",function(){t=!0}),e.destroy(),n(t)}).then(function(n){e.isTrue(n)})}})});