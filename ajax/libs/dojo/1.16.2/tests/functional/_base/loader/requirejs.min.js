define(["require","intern!object","intern/chai!assert","./support/loaderTest","./support/pageReady"],function(m,e,r,t,a){function n(e,t){var n=-1<(e=m.toUrl(e)).indexOf("?")?"&":"?";return{sync:a(e,t),async:a(e+n+"async",t)}}function i(e,t){return e.executeAsync(function(e,i){e?m({aliases:[["text","dojo/text"]]}):define("text",["dojo/text"],function(e){return e}),m({baseUrl:"./",paths:{text:"../../text"}},["widget","local","text!resources/sample.html!strip"],function(e,t,n){var r=[];function a(e,t){r.push({actual:t.replace(/\s{2,}|\n/g,""),expected:e})}a("<span>Hello World!</span>",n),a('<div data-type="widget"><h1>This is a widget!</h1><p>I am in a widget</p></div>',e.template),a("subwidget",e.subWidgetName),a('<div data-type="subwidget"><h1>This is a subwidget</h1></div>',e.subWidgetTemplate),a("<span>This! is template2</span>",e.subWidgetTemplate2),a("<h1>Local</h1>",t.localHtml),i(r)})},[t]).then(function(e){for(var t;t=e.shift();)r.strictEqual(t.actual,t.expected)})}function o(e){return e.executeAsync(function(n){var t=null,e=this.location.href.split("#")[0].split("?")[1],r=e&&e.match(/locale=([\w-]+)/);r&&(t=r[1]);var a="red",i="blue";t&&-1!==t.indexOf("en-us-surfer")?a="red, dude":t&&-1!==t.indexOf("fr-")&&(a="rouge",i="bleu"),m(["dojo"],function(e){t&&(e.locale=t),m(["commonA","commonB"],function(e,t){n({commonA:{actual:e,expected:a},commonB:{actual:t,expected:i}})})})}).then(function(e){r.strictEqual(e.commonA.actual,e.commonA.expected),r.strictEqual(e.commonB.actual,e.commonB.expected)})}function u(e){return e.executeAsync(function(t){var n=null,e=this.location.href.split("#")[0].split("?")[1],r=e&&e.split("&")[0].match(/locale=([\w-]+)/);r&&(n=r[1]);var a="i18n!nls/colors";(r=e&&e.match(/bundle=([^\&]+)/))&&(a=r[1]);var i="red",o="blue";n&&-1!==n.indexOf("en-us-surfer")||-1!==a.indexOf("nls/en-us-surfer/colors")?i="red, dude":(n&&-1!==n.indexOf("fr-")||-1!==a.indexOf("fr-"))&&(i="rouge",o="bleu"),m(["dojo"],function(e){n&&(e.locale=n),m([a],function(e){t({red:{actual:e.red,expected:i},blue:{actual:e.blue,expected:o},green:{actual:e.green,expected:"green"}})})})}).then(function(e){r.strictEqual(e.red.actual,e.red.expected),r.strictEqual(e.blue.actual,e.blue.expected),r.strictEqual(e.green.actual,e.green.expected)})}e({name:"dojo/_base/loader - requirejs",simple:n("./requirejs/simple.html",function(e){return e.executeAsync(function(a){m({baseUrl:"./"},["map","simple","dimple","func"],function(e,t,n,r){a(JSON.stringify({mapName:e.name,simpleColor:t.color,dimpleColor:n.color,funcOut:r()}))})}).then(function(e){e=JSON.parse(e),r.strictEqual(e.mapName,"map"),r.strictEqual(e.simpleColor,"blue"),r.strictEqual(e.dimpleColor,"dimple-blue"),r.strictEqual(e.funcOut,"You called a function")}).executeAsync(function(e){var t=this.location.href.replace(/simple\.html.*$/,"foo"),n=t.indexOf(":"),r=t.substring(n+1,t.length).replace(/foo/,"bar"),a=this;m([t,r],function(){e(JSON.stringify({fooName:a.foo.name,barName:a.bar.name}))})}).then(function(e){e=JSON.parse(e),r.strictEqual(e.fooName,"foo"),r.strictEqual(e.barName,"bar")})}),config:n("./requirejs/config.html",function(e){return e.executeAsync(function(e){e(JSON.stringify(window.testData))}).then(function(e){e=JSON.parse(e),r.strictEqual(e.simpleColor,"blue"),r.strictEqual(e.dimpleColor,"dimple-blue"),r.strictEqual(e.funcOut,"You called a function")})}),"simple, no head":n("./requirejs/simple-nohead.html",function(e){return e.executeAsync(function(r){m(["simple","dimple","func"],function(e,t,n){r(JSON.stringify({simpleColor:e.color,dimpleColor:t.color,funcOut:n()}))})}).then(function(e){e=JSON.parse(e),r.strictEqual(e.simpleColor,"blue"),r.strictEqual(e.dimpleColor,"dimple-blue"),r.strictEqual(e.funcOut,"You called a function")})}),circular:a(m.toUrl("./requirejs/circular.html?async"),function(e){return e.executeAsync(function(o){m(["require","two","funcTwo","funcThree"],function(e,t,n,r){var a=t.doSomething(),i=new n("TWO");o(JSON.stringify({size:a.size,color:a.color,name:i.name,oneName:i.oneName(),three:r("THREE")}))})}).then(function(e){e=JSON.parse(e),r.strictEqual(e.size,"small"),r.strictEqual(e.color,"redtwo"),r.strictEqual(e.name,"TWO"),r.strictEqual(e.oneName,"ONE-NESTED"),r.strictEqual(e.three,"THREE-THREE_SUFFIX")})}),"url fetch":n("./requirejs/urlfetch/urlfetch.html",function(e){return e.executeAsync(function(l){m({baseUrl:"./",paths:{one:"two",two:"two",three:"three",four:"three"}},["one","two","three","four"],function(e,t,n,r){for(var a,i=document.getElementsByTagName("script"),o={},u=i.length-1;-1<u;u--)(a=i[u].src)&&(a in o||(o[a]=0),o[a]+=1);var s={oneName:e.name,twoOneName:t.oneName,twoName:t.name,threeName:n.name,fourThreeName:r.threeName,fourName:r.name};if(m.async)for(var c in s.counts=[],o)s.counts.push(o[c]);l(JSON.stringify(s))})}).then(function(e){if((e=JSON.parse(e)).counts)for(var t;void 0!==(t=e.counts.shift());)r.strictEqual(t,1);r.strictEqual(e.oneName,"one"),r.strictEqual(e.twoOneName,"one"),r.strictEqual(e.twoName,"two"),r.strictEqual(e.threeName,"three"),r.strictEqual(e.fourThreeName,"three"),r.strictEqual(e.fourName,"four")})}),dataMain:n("./requirejs/dataMain.html",function(e){return e.execute(function(){return this.simple.color}).then(function(e){r.strictEqual(e,"blue")})}),depoverlap:n("./requirejs/depoverlap.html",function(e){return e.execute(function(){var e,t,n,r=this.document.getElementsByTagName("script"),a={};for(e=r.length-1;-1<e;e--)(t=r[e].getAttribute("data-requiremodule"))&&(t in a||(a[t]=0),a[t]+=1);return n=this.uno.doSomething(),{counts:a,unoName:this.uno.name,dosName:n.dosName,tresName:n.tresName}}).then(function(e){var t=e.counts;for(var n in t)r.strictEqual(t[n],1);r.strictEqual(e.unoName,"uno"),r.strictEqual(e.dosName,"dos"),r.strictEqual(e.tresName,"tres")})}),i18n:{i18n:{"locale unknown":n("./requirejs/i18n/i18n.html?bundle=i18n!nls/fr-fr/colors",u),base:n("./requirejs/i18n/i18n.html",u),locale:n("./requirejs/i18n/i18n.html?locale=en-us-surfer",u),bundle:n("./requirejs/i18n/i18n.html?bundle=i18n!nls/en-us-surfer/colors",u)},common:{base:n("./requirejs/i18n/i18n.html",o),locale:n("./requirejs/i18n/i18n.html?locale=en-us-surfer",o)}},paths:n("./requirejs/paths/paths.html",function(e){return e.executeAsync(function(i){var o=0,u=this;m({baseUrl:"./",packages:[{name:"first",location:"first.js",main:"./first"}]},["first!whatever"],function(e){for(var t,n=u.document.getElementsByTagName("script"),r=n.length-1;-1<r;r--)t=n[r].getAttribute("src"),/first\.js$/.test(t)&&(o+=1);var a={async:m.async,globalCounter:u.globalCounter,name:e.name,secondName:e.secondName};m.async&&(a.scriptCounter=o),i(a)})}).then(function(e){e.async&&r.strictEqual(e.scriptCounter,1),r.strictEqual(e.globalCounter,2),r.strictEqual(e.name,"first"),r.strictEqual(e.secondName,"second")})}),relative:n("./requirejs/relative/relative.html",function(e){return e.executeAsync(function(t){define("text",["dojo/text"],function(e){return e}),m({baseUrl:m.has("host-browser")?"./":"./relative/",paths:{text:"../../text"}},["foo/bar/one"],function(e){t({name:e.name,twoName:e.twoName,threeName:e.threeName,message:e.message.replace(/\r|\n/g,"")})})}).then(function(e){r.strictEqual(e.name,"one"),r.strictEqual(e.twoName,"two"),r.strictEqual(e.threeName,"three"),r.strictEqual(e.message,"hello world")})}),text:{alias:n("./requirejs/text/text.html",function(e){return i(e,!0)}),"non-alias":n("./requirejs/text/text.html",i)},"text only":n("./requirejs/text/textOnly.html",function(e){return e.executeAsync(function(t){define("text",["dojo/text"],function(e){return e}),m({baseUrl:"./",paths:{text:"../../text"}},["text!resources/sample.html!strip"],function(e){t(e)})}).then(function(e){r.strictEqual(e,"<span>Hello World!</span>")})}),exports:a(m.toUrl("./requirejs/exports/exports.html"),function(e){return e.executeAsync(function(u){m({baseUrl:m.has("host-browser")?"./":"./exports/"},["vanilla","funcSet","assign","assign2","usethis","implicitModule","simpleReturn"],function(e,t,n,r,a,i,o){u({vanillaName:e.name,funcSet:t,assign:n,assign2:r,implicitModule:i(),simpleReturn:o()})})}).then(function(e){r.strictEqual(e.vanillaName,"vanilla"),r.strictEqual(e.funcSet,"funcSet"),r.strictEqual(e.assign,"assign"),r.strictEqual(e.assign2,"assign2"),r.strictEqual(e.implicitModule,"implicitModule"),r.strictEqual(e.simpleReturn,"simpleReturn")})}),uniques:n("./requirejs/uniques/uniques.html",function(e){return e.executeAsync(function(r){m({baseUrl:"./"},["one","two","three"],function(e,t,n){r({oneName:e.name,oneThreeName:e.threeName,oneThreeName2:e.threeName2,twoOneName:t.oneName,twoOneName2:t.oneName2,twoName:t.name,twoThreeName:t.threeName,threeName:n.name})})}).then(function(e){r.strictEqual(e.oneName,"one"),r.strictEqual(e.oneThreeName,"three"),r.strictEqual(e.oneThreeName2,"three"),r.strictEqual(e.twoOneName,"one"),r.strictEqual(e.twoOneName2,"one"),r.strictEqual(e.twoName,"two"),r.strictEqual(e.twoThreeName,"three"),r.strictEqual(e.threeName,"three")})})})});