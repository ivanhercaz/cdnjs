define(["require","intern!object","intern/chai!assert","./loader/support/loaderTest","./loader/support/pageReady","./loader/requirejs","./loader/xdomain","./loader/moduleIds","./loader/hostenv_webworkers"],function(d,o,n,s,e){function t(e){return s(d.toUrl("./loader/index.html"),{publishRequireResult:Boolean(e),packages:[{name:"dojo",location:"node_modules/dojo"},{name:"testing",location:"."}],map:{"*":{"dojo/tests":"testing/tests/functional"}}},function(e){var t=window.dojo;t.setObject("dojo.tests._base.loader.pub1","do-not-mess-with-me"),t.require("dojo.tests._base.loader.pub1"),t.require("dojo.tests._base.loader.pub2"),d(["dojo/has"],function(o){e({pub1:t.getObject("dojo.tests._base.loader.pub1"),pub2Status:t.getObject("dojo.tests._base.loader.pub2")&&t.getObject("dojo.tests._base.loader.pub2.status"),dojoConfigPublishRequireResult:!!t.config.publishRequireResult,hasPublishRequireResult:!!o("config-publishRequireResult")})})},function(o){n.strictEqual(o.pub1,"do-not-mess-with-me"),e?(n.isTrue(o.hasPublishRequireResult),n.strictEqual(o.pub2Status,"ok")):(n.isFalse(o.hasPublishRequireResult),n.isFalse(o.dojoConfigPublishRequireResult),n.isTrue(null==o.pub2Status))})}function i(o){return s(d.toUrl(o),function(e){d(["dojo"],function(o){e({requireConfig:d.rawConfig,dojoConfig:o.config,async:d.async,baseUrl:d.baseUrl,cats:void 0===d.cats,a:void 0===d.a,b:void 0===d.b})})},function(o){var e=o.requireConfig,t=o.dojoConfig;n.ok(e.async),n.strictEqual(e.baseUrl,"../../../.."),n.strictEqual(e.waitSeconds,6),n.strictEqual(e.cats,"dojo-config-dogs"),n.strictEqual(e.a,2),n.deepEqual(e.b,[3,4,5]),n.ok(o.async),n.strictEqual(o.baseUrl,"../../../../"),n.isTrue(o.cats),n.isTrue(o.a),n.isTrue(o.b),n.strictEqual(t.baseUrl,"../../../../"),n.strictEqual(t.cats,"dojo-config-dogs"),n.strictEqual(t.a,2),n.deepEqual(t.b,[3,4,5])})}o({name:"dojo/_base/loader","async with dojo require":s(d.toUrl("./loader/index.html"),{async:!0,baseUrl:".",packages:[{name:"dijit",location:"dijit"},{name:"dojox",location:"dojox"},{name:"dojo",location:"../../../../node_modules/dojo"},{name:"test-modules",location:"."}]},function(o){d({async:"sync"},["dojo"]),d({async:"legacyAsync"}),d(["test-modules/syncFromAsyncModule"],function(){o(window.syncFromAsyncModule)})},function(o){n.strictEqual(o,"OK")}),config:function(){var o,e,t={djConfig:"_djConfig","djConfig-require":"_djConfig",dojoConfig:"_dojoConfig","dojoConfig-djConfig":"_dojoConfig","dojoConfig-require":"_dojoConfig","dojoConfig-djConfig-require":"_dojoConfig",require:"_require"},i={};for(var a in t)i[a]=(e=t[o=a],s(d.toUrl("./loader/config.html")+"?"+o,[function(s,r){d(["dojo","dojo/has"],function(o,e){var t=window[s],i={baseUrl:d.baseUrl,config:t,requireConfig:d.rawConfig,dojoConfig:o.config},a={};for(var n in t.has)a[n]=e(n);i.has=a,r(i)})},[e]],function(o){var e=o.config,t=o.requireConfig,i=o.dojoConfig;for(var a in n.strictEqual(t.baseUrl,e.baseUrl),n.strictEqual(t.waitSeconds,e.waitSeconds),n.strictEqual(t.locale,e.locale),n.deepEqual(t.has,e.has),n.strictEqual(t.cats,e.cats),n.strictEqual(t.a,e.a),n.deepEqual(t.b,e.b),n.strictEqual(o.baseUrl,e.baseUrl+"/"),o.has)n.ok(o.has[a]);n.isUndefined(d.cats),n.isUndefined(d.a),n.isUndefined(d.b),n.strictEqual(i.baseUrl,e.baseUrl+"/"),n.strictEqual(i.waitSeconds,e.waitSeconds),n.strictEqual(i.locale,e.locale),n.strictEqual(i.cats,e.cats),n.strictEqual(i.a,e.a),n.deepEqual(i.b,e.b)}));return i}(),"config api":s(d.toUrl("./loader/index.html"),{async:!0,isDebug:!0,packages:[{name:"dojo",location:"node_modules/dojo"}]},function(s){d(["dojo"],function(n){n.ready(function(){var t,e={async:{}};var o=d.on("config",function(o,e){t.called1=!0,t.rawConfig1=n.mixin({},e)}),i=d.on("config",function(o,e){t.called2=!0,t.rawConfig2=n.mixin({},e)});function a(o){e.async[o]={async:d.async,legacyMode:d.legacyMode}}e.call1=t={},d({someFeature:1}),o.remove(),e.call2=t={},d({someFeature:0,someOtherFeature:1}),i.remove(),d({async:1}),a("1"),d({async:!0}),a("true"),d({async:2}),a("2"),d({async:"nonsense"}),a("nonsense"),d({async:0}),a("0"),d({async:!1}),a("false"),d({async:"sync"}),a("sync"),d({async:"legacyAsync"}),a("legacyAsync"),s(e)})})},function(o){var e=o.call1;n.ok(e.called1),n.ok(e.called2),n.strictEqual(e.rawConfig1.someFeature,1),n.strictEqual(e.rawConfig2.someFeature,1);var t,i=o.call2;for(var a in n.notOk(i.called1),n.ok(i.called2),n.strictEqual(i.rawConfig2.someFeature,0),n.strictEqual(i.rawConfig2.someOtherFeature,1),o.async)t={async:!1,legacyMode:!1},"legacyAsync"===a?t.legacyMode="legacyAsync":a in{0:1,false:1,sync:1}?t.legacyMode="sync":t.async=!0,n.deepEqual(o.async[a],t)}),"config sniff":{dojoConfig:i("./loader/config-sniff.html"),djConfig:i("./loader/config-sniff-djConfig.html")},"config has":e(d.toUrl("./loader/config-has.html"),function(o){return o.executeAsync(function(e){d(["dojo/has"],function(o){e({requireConfig:d.rawConfig,has:{"config-someConfigSwitch":o("config-someConfigSwitch"),"config-isDebug":o("config-isDebug"),"config-anotherConfigSwitch":o("config-anotherConfigSwitch"),"some-has-feature":o("some-has-feature")}})})}).then(function(o){var e=o.requireConfig;n.strictEqual(e.someConfigSwitch,0),n.strictEqual(e.isDebug,1),n.strictEqual(e.anotherConfigSwitch,2),n.strictEqual(o.has["config-someConfigSwitch"],0),n.strictEqual(o.has["config-isDebug"],1),n.strictEqual(o.has["config-anotherConfigSwitch"],2),n.strictEqual(o.has["some-has-feature"],5)}).executeAsync(function(e){d(["dojo/has"],function(o){d({someConfigSwitch:3}),e({requireConfig:d.rawConfig,"config-someConfigSwitch":o("config-someConfigSwitch")})})}).then(function(o){n.strictEqual(o.requireConfig.someConfigSwitch,3),n.strictEqual(o["config-someConfigSwitch"],0)}).executeAsync(function(e){d(["dojo/has"],function(o){d({someNewConfigSwitch:4}),e({requireConfig:d.rawConfig,"config-someNewConfigSwitch":o("config-someNewConfigSwitch")})})}).then(function(o){n.strictEqual(o.requireConfig.someNewConfigSwitch,4),n.strictEqual(o["config-someNewConfigSwitch"],4)}).executeAsync(function(e){d(["dojo/has"],function(o){d({has:{"some-has-feature":6}}),e({"some-has-feature":o("some-has-feature")})})}).then(function(o){n.strictEqual(o["some-has-feature"],5)}).executeAsync(function(e){d(["dojo/has"],function(o){o.add("some-has-feature",6),e({"some-has-feature":o("some-has-feature")})})}).then(function(o){n.strictEqual(o["some-has-feature"],5)}).executeAsync(function(e){d(["dojo/has"],function(o){o.add("some-has-feature",6,0,1),e({"some-has-feature":o("some-has-feature")})})}).then(function(o){n.strictEqual(o["some-has-feature"],6)}).executeAsync(function(e){d(["dojo/has"],function(o){d({has:{"some-new-has-feature":7}}),e({"some-new-has-feature":o("some-new-has-feature")})})}).then(function(o){n.strictEqual(o["some-new-has-feature"],7)})}),"declare steps on provide":s(d.toUrl("./loader/index.html"),{packages:[{name:"dojo",location:"node_modules/dojo"},{name:"testing",location:"."}],map:{"*":{"dojo/tests":"testing/tests/functional"}}},function(a){d(["dojo","dojo/tests/_base/loader/declareStepsOnProvideAmd"],function(o,e){var t={},i=new e;t.status1=i.status(),i=new(d("dojo/tests/_base/loader/declareStepsOnProvide1")),t.status2=i.status(),a(t)})},function(o){n.strictEqual(o.status1,"OK"),n.strictEqual(o.status2,"OK-1")}),"publish require result":{publish:t(!0),"no publish":t()},"top level module by paths":s(d.toUrl("./loader/index.html"),{packages:[{name:"dojo",location:"node_modules/dojo"}]},function(l){var c={},u={};define("myModule1",[],c),define("myModule2",[],u),d({aliases:[["yourModule","myModule1"],[/yourOtherModule/,"myModule1"],[/yourOtherModule\/([^\/]+)\/special/,"yourOtherModule/common/special"],[/(yourOtherModule\/(common))\/special/,"myModule2"]],paths:{myTopLevelModule:"./tests/functional/_base/loader/myTopLevelModule"}}),d(["myTopLevelModule","myModule1","myModule2","yourModule","yourOtherModule","yourOtherModule/stuff/special"],function(o,e,t,i,a,n){var s=this.myTopLevelModule,r=c===e&&c===i&&c===a&&u===t&&u===n&&"myTopLevelModule"===s.name&&"myTopLevelModule.myModule"===s.myModule.name;l(r)})},function(o){n.isTrue(o)}),"config/test":s(d.toUrl("./loader/index.html"),{async:!0,baseUrl:"../../../..",packages:[{name:"loader",location:"tests/functional/_base/loader/config",packageMap:{pkg:"pkgMapped"}},{name:"pkg",location:"tests/functional/_base/loader/config/pkg"},{name:"pkgMapped",location:"tests/functional/_base/loader/config/pkg",packageMap:{pkg:"pkgMapped"}},{name:"dojo",location:"node_modules/dojo"}],config:{"loader/someModuleConfiggedPriorToBoot":{someConfig:"this is the config for someModuleConfiggedPriorToBoot"}}},function(i){function a(o,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[t]=e[t]);return o}d({config:{"loader/someModule":{someConfig:"this is the config for someModule-someConfig"},"pkgMapped/m1":{globalConfig:"globalConfigForpkgMapped/m1",isMapped:!0},"pkgMapped/m2":{globalConfig:"globalConfigForpkgMapped/m2"}}}),d(["loader/someModuleConfiggedPriorToBoot","loader/someModule"],function(o,e){var t={someModuleConfiggedPriorToBootConfig:a({},o.getConfig()),someModuleConfig:a({},e.getConfig()),someModuleM1Config:a({},e.m1.getConfig()),someModuleM2Config:a({},e.m2.getConfig())};d({config:{"loader/someModule":{someMoreConfig:"this is the config for someModule-someMoreConfig"}}}),d(["loader/someModule"],function(o){a(t,{someModuleAfterConfig:a({},o.getConfig())}),d({config:{"pkg/m1":{globalConfig:"globalConfigForM1"},"pkg/m2":{globalConfig:"globalConfigForM2"}}},["pkg/m1","pkg/m2"],function(o,e){i(a(t,{m1Config:o.getConfig(),m2Config:e.getConfig()}))})})})},function(o){n.deepEqual(o.someModuleConfiggedPriorToBootConfig,{someConfig:"this is the config for someModuleConfiggedPriorToBoot"}),n.deepEqual(o.someModuleConfig,{someConfig:"this is the config for someModule-someConfig"}),n.deepEqual(o.someModuleM1Config,{globalConfig:"globalConfigForpkgMapped/m1",isMapped:!0,configThroughMappedRefForM1:"configThroughMappedRefForM1"}),n.deepEqual(o.someModuleM2Config,{globalConfig:"globalConfigForpkgMapped/m2",configThroughMappedRefForM1:"configThroughMappedRefForM1",config1:"mapped-config1",config2:"mapped-config2",config3:"mapped-config3"}),n.deepEqual(o.someModuleAfterConfig,{someConfig:"this is the config for someModule-someConfig",someMoreConfig:"this is the config for someModule-someMoreConfig"}),n.deepEqual(o.m1Config,{globalConfig:"globalConfigForM1"}),n.deepEqual(o.m2Config,{globalConfig:"globalConfigForM2",config1:"config1",config2:"config2",config3:"config3"})}),mappingMultiLayer:s(d.toUrl("./loader/index.html"),{async:!0,baseUrl:".",packages:[{name:"dojo",location:"node_modules/dojo"},{name:"test",location:"./mapping-multi-layer"},{name:"app1",location:"./mapping-multi-layer/App1"},{name:"app2",location:"./mapping-multi-layer/App2"},{name:"common1",location:"./mapping-multi-layer/Common1"},{name:"common2",location:"./mapping-multi-layer/Common2"},{name:"router",location:"./mapping-multi-layer/Router"},{name:"mappedModule",location:"./mapping-multi-layer/MappedModule"}],map:{app1:{common:"common1"},app2:{common:"common2"},"my/replacement/A":{"my/A":"my/A"},"*":{"starmap/demo1":"router/demoA","starmap/demo2":"router/demoB",starmapModule:"mappedModule","my/A":"my/replacement/A"}}},function(o){d({cache:{}}),d.async||d(["dojo"]),d.boot&&d.apply(null,d.boot);var e=d.on("error",function(){e.remove(),o({error:!0})});d(["test/main"],function(){e.remove(),o({error:!1,results:results})})},function(o){if(o.error)n.fail("require error");else{n.strictEqual(o.results.join(),["Common1/another:cache","Router/demoB:nocache","App1/thing:cache","Router/demoC:cache","Router/demoA:cache","MappedModule/mappedC:cache","mappedModule/mappedA:cache","my/B:cache","my/A:cache","my/replacement/A:cache","mainRequire1:loaded","Common2/anotherone:cache","Common2/another:cache","mappedModule/mappedB:cache","App2/thing:cache","mainRequire2:loaded"].join())}}),mapping:s(d.toUrl("./loader/index.html"),{async:!0,packages:[{name:"dojo",location:"node_modules/dojo"}],map:{"my/replacement/A":{"my/A":"my/A"},"*":{"my/A":"my/replacement/A"}}},function(e){d({cache:{"my/replacement/A":function(){define(["../A"],function(){return{it:"is a replacement module"}})},"my/A":function(){define(["./B"],function(){return{it:"is the original module"}})},"my/B":function(){define([],function(){return{it:"is a module dependency"}})}}}),d({cache:{}}),d.async||d(["dojo"]),d.boot&&d.apply(null,d.boot);var t=d.on("error",function(){t.remove(),e({error:!0})});d(["my/A"],function(o){t.remove(),e({aIt:o.it})})},function(o){o.error?n.fail():n.strictEqual(o.aIt,"is a replacement module")}),compactPath:s(d.toUrl("./loader/index.html"),{isDebug:1,async:1},function(o){var e=d.compactPath;o([e("../../dojo/../../mytests"),e("module"),e("a/./b"),e("a/../b"),e("a/./b/./c/./d"),e("a/../b/../c/../d"),e("a/b/c/../../d"),e("a/b/c/././d"),e("./a/b"),e("../a/b"),e("")])},function(o){n.strictEqual("../../../mytests",o.shift()),n.strictEqual("module",o.shift()),n.strictEqual("a/b",o.shift()),n.strictEqual("b",o.shift()),n.strictEqual("a/b/c/d",o.shift()),n.strictEqual("d",o.shift()),n.strictEqual("a/d",o.shift()),n.strictEqual("a/b/c/d",o.shift()),n.strictEqual("a/b",o.shift()),n.strictEqual("../a/b",o.shift()),n.strictEqual("",o.shift())}),modules:s(d.toUrl("./loader/index.html"),{async:1,baseUrl:"./foo",packages:[{name:"testing",location:"../../../../../"},{name:"dojo",location:"../../../../../node_modules/dojo"}]},function(a){d(["dojo","dojo/has","modules/anon","modules/wrapped","testing/tests/functional/_base/loader/modules/full","modules/data","modules/factoryArity","modules/factoryArityExports","testing/tests/functional/_base/loader/modules/idFactoryArity","testing/tests/functional/_base/loader/modules/idFactoryArityExports"],function(o,e,t,i){a([e("dojo-amd-factory-scan"),t.theAnswer,d("modules/anon").five,i.five,o.require("testing.tests.functional._base.loader.modules.wrapped").five,d("modules/wrapped").five,d("testing/tests/functional/_base/loader/modules/full").twiceTheAnswer,d("modules/data").five,d("modules/factoryArity").module.id,d("modules/factoryArity").id,d("modules/factoryArity").impliedDep,d("modules/factoryArityExports").module.id,d("modules/factoryArityExports").id,d("modules/factoryArityExports").impliedDep,d("testing/tests/functional/_base/loader/modules/idFactoryArity").module.id,d("testing/tests/functional/_base/loader/modules/idFactoryArity").id,d("testing/tests/functional/_base/loader/modules/idFactoryArity").impliedDep,d("testing/tests/functional/_base/loader/modules/idFactoryArityExports").module.id,d("testing/tests/functional/_base/loader/modules/idFactoryArityExports").id,d("testing/tests/functional/_base/loader/modules/idFactoryArityExports").impliedDep])})},function(o){n.strictEqual(o.shift(),1),n.strictEqual(o.shift(),42),n.strictEqual(o.shift(),5),n.strictEqual(o.shift(),5),n.strictEqual(o.shift(),5),n.strictEqual(o.shift(),5),n.strictEqual(o.shift(),84),n.strictEqual(o.shift(),5),n.strictEqual(o.shift(),"modules/factoryArity"),n.strictEqual(o.shift(),"factoryArity"),n.strictEqual(o.shift(),"impliedDep1"),n.strictEqual(o.shift(),"modules/factoryArityExports"),n.strictEqual(o.shift(),"factoryArityExports"),n.strictEqual(o.shift(),"impliedDep2"),n.strictEqual(o.shift(),"testing/tests/functional/_base/loader/modules/idFactoryArity"),n.strictEqual(o.shift(),"idFactoryArity"),n.strictEqual(o.shift(),"impliedDep3"),n.strictEqual(o.shift(),"testing/tests/functional/_base/loader/modules/idFactoryArityExports"),n.strictEqual(o.shift(),"idFactoryArityExports"),n.strictEqual(o.shift(),"impliedDep4")})})});