define(["../util","intern/dojo/node!querystring"],function(n,o){return function(i){var e=new n.Promise(function(t){function n(e){e="html"===i.query.type?"<h1>SUCCESSFUL HTML response</h1>":(e="json"===i.query.type?JSON.stringify({method:i.method,query:i.query,payload:e}):"javascript"===i.query.type?"window.iframeTestingFunction = function(){ return 42; };":i.query.text?i.query.text:"iframe succeeded",'<textarea style="width:100%; height: 100px;">'+e+"</textarea>"),t({status:200,headers:{"Content-Type":"text/html"},body:["<html>","<head></head>","<body>",e,"</body>","</html>"]})}"xml"!==i.query.type?i.data?i.data.then(n):"GET"===i.method?n():i.body.join().then(function(e){n(e=o.parse(e))}):t({status:200,headers:{"Content-Type":"text/xml"},body:['<?xml version="1.0" encoding="UTF-8"?>\n','<Envelope title="Test of dojo.io.iframe xml test">\n',"<Children>\n","<child>FOO</child>\n","<child>BAR</child>\n","<child>BAZ</child>\n","<child>BAT</child>\n","</Children>\n","<![CDATA[\n","function(){\n","for(var i=0; i<somethign; i++){\n","if(foo>bar){ /* whatever */ }\n","}\n","}\n","]]>\n",'<a href="something">something else</a>\n',"</Envelope>"]})}),t=i.query.delay;return t&&(t=parseInt(t,10),e=n.delay(e,t)),e}});