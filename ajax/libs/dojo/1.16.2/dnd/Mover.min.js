define(["../_base/array","../_base/declare","../_base/lang","../sniff","../_base/window","../dom","../dom-geometry","../dom-style","../Evented","../on","../touch","./common","./autoscroll"],function(o,t,a,e,l,r,v,c,s,h,u,n,d){return t("dojo.dnd.Mover",[s],{constructor:function(t,o,e){this.node=r.byId(t),this.marginBox={l:o.pageX,t:o.pageY},this.mouseButton=o.button;var s=this.host=e,n=t.ownerDocument;function i(t){t.preventDefault(),t.stopPropagation()}this.events=[h(n,u.move,a.hitch(this,"onFirstMove")),h(n,u.move,a.hitch(this,"onMouseMove")),h(n,u.release,a.hitch(this,"onMouseUp")),h(n,"dragstart",i),h(n.body,"selectstart",i)],d.autoScrollStart(n),s&&s.onMoveStart&&s.onMoveStart(this)},onMouseMove:function(t){d.autoScroll(t);var o=this.marginBox;this.host.onMove(this,{l:o.l+t.pageX,t:o.t+t.pageY},t),t.preventDefault(),t.stopPropagation()},onMouseUp:function(t){(e("webkit")&&e("mac")&&2==this.mouseButton?0==t.button:this.mouseButton==t.button)&&this.destroy(),t.preventDefault(),t.stopPropagation()},onFirstMove:function(t){var o,e,s=this.node.style,n=this.host;switch(s.position){case"relative":case"absolute":o=Math.round(parseFloat(s.left))||0,e=Math.round(parseFloat(s.top))||0;break;default:s.position="absolute";var i=v.getMarginBox(this.node),a=l.doc.body,r=c.getComputedStyle(a),h=v.getMarginBox(a,r),u=v.getContentBox(a,r);o=i.l-(u.l-h.l),e=i.t-(u.t-h.t)}this.marginBox.l=o-this.marginBox.l,this.marginBox.t=e-this.marginBox.t,n&&n.onFirstMove&&n.onFirstMove(this,t),this.events.shift().remove()},destroy:function(){o.forEach(this.events,function(t){t.remove()});var t=this.host;t&&t.onMoveStop&&t.onMoveStop(this),this.events=this.node=this.host=null}})});