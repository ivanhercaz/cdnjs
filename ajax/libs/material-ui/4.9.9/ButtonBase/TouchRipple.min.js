"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.styles=exports.DELAY_RIPPLE=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactTransitionGroup=require("react-transition-group"),_clsx=_interopRequireDefault(require("clsx")),_withStyles=_interopRequireDefault(require("../styles/withStyles")),_Ripple=_interopRequireDefault(require("./Ripple")),DURATION=550,DELAY_RIPPLE=80;exports.DELAY_RIPPLE=DELAY_RIPPLE;var styles=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}};exports.styles=styles;var TouchRipple=React.forwardRef(function(e,t){var r=e.center,b=void 0!==r&&r,u=e.classes,i=e.className,a=(0,_objectWithoutProperties2.default)(e,["center","classes","className"]),n=React.useState([]),l=n[0],o=n[1],s=React.useRef(0),c=React.useRef(null);React.useEffect(function(){c.current&&(c.current(),c.current=null)},[l]);var y=React.useRef(!1),v=React.useRef(null),q=React.useRef(null),D=React.useRef(null);React.useEffect(function(){return function(){clearTimeout(v.current)}},[]);var T=React.useCallback(function(e){var t=e.pulsate,r=e.rippleX,i=e.rippleY,a=e.rippleSize,n=e.cb;o(function(e){return[].concat((0,_toConsumableArray2.default)(e),[React.createElement(_Ripple.default,{key:s.current,classes:u,timeout:DURATION,pulsate:t,rippleX:r,rippleY:i,rippleSize:a})])}),s.current+=1,c.current=n},[u]),p=React.useCallback(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length?arguments[2]:void 0,i=t.pulsate,a=void 0!==i&&i,n=t.center,u=void 0===n?b||t.pulsate:n,l=t.fakeElement,o=void 0!==l&&l;if("mousedown"===e.type&&y.current)y.current=!1;else{"touchstart"===e.type&&(y.current=!0);var s,c,p,f=o?null:D.current,d=f?f.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(u||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)s=Math.round(d.width/2),c=Math.round(d.height/2);else{var h=e.clientX?e.clientX:e.touches[0].clientX,R=e.clientY?e.clientY:e.touches[0].clientY;s=Math.round(h-d.left),c=Math.round(R-d.top)}if(u)(p=Math.sqrt((2*Math.pow(d.width,2)+Math.pow(d.height,2))/3))%2==0&&(p+=1);else{var m=2*Math.max(Math.abs((f?f.clientWidth:0)-s),s)+2,_=2*Math.max(Math.abs((f?f.clientHeight:0)-c),c)+2;p=Math.sqrt(Math.pow(m,2)+Math.pow(_,2))}e.touches?null===q.current&&(q.current=function(){T({pulsate:a,rippleX:s,rippleY:c,rippleSize:p,cb:r})},v.current=setTimeout(function(){q.current&&(q.current(),q.current=null)},DELAY_RIPPLE)):T({pulsate:a,rippleX:s,rippleY:c,rippleSize:p,cb:r})}},[b,T]),f=React.useCallback(function(){p({},{pulsate:!0})},[p]),d=React.useCallback(function(e,t){if(clearTimeout(v.current),"touchend"===e.type&&q.current)return e.persist(),q.current(),q.current=null,void(v.current=setTimeout(function(){d(e,t)}));q.current=null,o(function(e){return 0<e.length?e.slice(1):e}),c.current=t},[]);return React.useImperativeHandle(t,function(){return{pulsate:f,start:p,stop:d}},[f,p,d]),React.createElement("span",(0,_extends2.default)({className:(0,_clsx.default)(u.root,i),ref:D},a),React.createElement(_reactTransitionGroup.TransitionGroup,{component:null,exit:!0},l))});"production"!==process.env.NODE_ENV&&(TouchRipple.propTypes={center:_propTypes.default.bool,classes:_propTypes.default.object.isRequired,className:_propTypes.default.string});var _default=(0,_withStyles.default)(styles,{flip:!1,name:"MuiTouchRipple"})(React.memo(TouchRipple));exports.default=_default;