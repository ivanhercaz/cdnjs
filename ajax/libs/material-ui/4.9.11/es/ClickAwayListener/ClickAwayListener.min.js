import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import ownerDocument from"../utils/ownerDocument";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import{elementAcceptingRef,exactProp}from"@material-ui/utils";function mapEventPropToEvent(e){return e.substring(2).toLowerCase()}function ClickAwayListener(e){const{children:t,disableReactTree:r=!1,mouseEvent:n="onClick",onClickAway:o,touchEvent:c="onTouchEnd"}=e,u=React.useRef(!1),s=React.useRef(null),a=React.useRef(!1),i=React.useRef(!1);React.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]);const p=React.useCallback(e=>{s.current=ReactDOM.findDOMNode(e)},[]),m=useForkRef(t.ref,p),l=useEventCallback(e=>{const t=i.current;if(i.current=!1,!a.current||!s.current)return;if(u.current)return void(u.current=!1);let n;if(e.composedPath)n=e.composedPath().indexOf(s.current)>-1;else{const t=ownerDocument(s.current);n=!(t.documentElement&&t.documentElement.contains(e.target))||s.current.contains(e.target)}n||!r&&t||o(e)}),f=e=>r=>{i.current=!0;const n=t.props[e];n&&n(r)},E={ref:m};return!1!==c&&(E[c]=f(c)),React.useEffect(()=>{if(!1!==c){const e=mapEventPropToEvent(c),t=ownerDocument(s.current),r=()=>{u.current=!0};return t.addEventListener(e,l),t.addEventListener("touchmove",r),()=>{t.removeEventListener(e,l),t.removeEventListener("touchmove",r)}}},[l,c]),!1!==n&&(E[n]=f(n)),React.useEffect(()=>{if(!1!==n){const e=mapEventPropToEvent(n),t=ownerDocument(s.current);return t.addEventListener(e,l),()=>{t.removeEventListener(e,l)}}},[l,n]),React.createElement(React.Fragment,null,React.cloneElement(t,E))}"production"!==process.env.NODE_ENV&&(ClickAwayListener.propTypes={children:elementAcceptingRef.isRequired,disableReactTree:PropTypes.bool,mouseEvent:PropTypes.oneOf(["onClick","onMouseDown","onMouseUp",!1]),onClickAway:PropTypes.func.isRequired,touchEvent:PropTypes.oneOf(["onTouchEnd","onTouchStart",!1])}),"production"!==process.env.NODE_ENV&&(ClickAwayListener.propTypes=exactProp(ClickAwayListener.propTypes));export default ClickAwayListener;