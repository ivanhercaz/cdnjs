import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import ownerDocument from"../utils/ownerDocument";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import{elementAcceptingRef,exactProp}from"@material-ui/utils";function mapEventPropToEvent(e){return e.substring(2).toLowerCase()}function clickedRootScrollbar(e){return document.documentElement.clientWidth<e.clientX||document.documentElement.clientHeight<e.clientY}function ClickAwayListener(e){const{children:t,disableReactTree:n=!1,mouseEvent:r="onClick",onClickAway:o,touchEvent:c="onTouchEnd"}=e,u=React.useRef(!1),s=React.useRef(null),i=React.useRef(!1),a=React.useRef(!1);React.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[]);const l=React.useCallback(e=>{s.current=ReactDOM.findDOMNode(e)},[]),p=useForkRef(t.ref,l),m=useEventCallback(e=>{const t=a.current;if(a.current=!1,!i.current||!s.current||clickedRootScrollbar(e))return;if(u.current)return void(u.current=!1);let r;if(e.composedPath)r=e.composedPath().indexOf(s.current)>-1;else{const t=ownerDocument(s.current);r=!(t.documentElement&&t.documentElement.contains(e.target))||s.current.contains(e.target)}r||!n&&t||o(e)}),f=e=>n=>{a.current=!0;const r=t.props[e];r&&r(n)},E={ref:p};return!1!==c&&(E[c]=f(c)),React.useEffect(()=>{if(!1!==c){const e=mapEventPropToEvent(c),t=ownerDocument(s.current),n=()=>{u.current=!0};return t.addEventListener(e,m),t.addEventListener("touchmove",n),()=>{t.removeEventListener(e,m),t.removeEventListener("touchmove",n)}}},[m,c]),!1!==r&&(E[r]=f(r)),React.useEffect(()=>{if(!1!==r){const e=mapEventPropToEvent(r),t=ownerDocument(s.current);return t.addEventListener(e,m),()=>{t.removeEventListener(e,m)}}},[m,r]),React.createElement(React.Fragment,null,React.cloneElement(t,E))}"production"!==process.env.NODE_ENV&&(ClickAwayListener.propTypes={children:elementAcceptingRef.isRequired,disableReactTree:PropTypes.bool,mouseEvent:PropTypes.oneOf(["onClick","onMouseDown","onMouseUp",!1]),onClickAway:PropTypes.func.isRequired,touchEvent:PropTypes.oneOf(["onTouchEnd","onTouchStart",!1])}),"production"!==process.env.NODE_ENV&&(ClickAwayListener.propTypes=exactProp(ClickAwayListener.propTypes));export default ClickAwayListener;