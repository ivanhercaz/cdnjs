"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOffsetTop=getOffsetTop,exports.getOffsetLeft=getOffsetLeft,exports.default=exports.styles=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactDom=_interopRequireDefault(require("react-dom")),_debounce=_interopRequireDefault(require("../utils/debounce")),_clsx=_interopRequireDefault(require("clsx")),_utils=require("@material-ui/utils"),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_ownerWindow=_interopRequireDefault(require("../utils/ownerWindow")),_createChainedFunction=_interopRequireDefault(require("../utils/createChainedFunction")),_withStyles=_interopRequireDefault(require("../styles/withStyles")),_Modal=_interopRequireDefault(require("../Modal")),_Grow=_interopRequireDefault(require("../Grow")),_Paper=_interopRequireDefault(require("../Paper"));function getOffsetTop(e,t){var r=0;return"number"==typeof t?r=t:"center"===t?r=e.height/2:"bottom"===t&&(r=e.height),r}function getOffsetLeft(e,t){var r=0;return"number"==typeof t?r=t:"center"===t?r=e.width/2:"right"===t&&(r=e.width),r}function getTransformOriginValue(e){return[e.horizontal,e.vertical].map(function(e){return"number"==typeof e?"".concat(e,"px"):e}).join(" ")}function getScrollParent(e,t){for(var r=t,o=0;r&&r!==e;)o+=(r=r.parentElement).scrollTop;return o}function getAnchorEl(e){return"function"==typeof e?e():e}var styles={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}};exports.styles=styles;var Popover=_react.default.forwardRef(function(e,t){var r=e.action,v=e.anchorEl,o=e.anchorOrigin,a=void 0===o?{vertical:"top",horizontal:"left"}:o,p=e.anchorPosition,n=e.anchorReference,m=void 0===n?"anchorEl":n,i=e.children,l=e.classes,u=e.className,s=e.container,f=e.elevation,c=void 0===f?8:f,d=e.getContentAnchorEl,h=e.marginThreshold,y=void 0===h?16:h,_=e.onEnter,g=e.onEntered,T=e.onEntering,E=e.onExit,b=e.onExited,O=e.onExiting,q=e.open,x=e.PaperProps,w=void 0===x?{}:x,R=e.transformOrigin,P=void 0===R?{vertical:"top",horizontal:"left"}:R,D=e.TransitionComponent,C=void 0===D?_Grow.default:D,N=e.transitionDuration,M=void 0===N?"auto":N,z=e.TransitionProps,j=void 0===z?{}:z,A=(0,_objectWithoutProperties2.default)(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),W=_react.default.useRef(),V=_react.default.useCallback(function(e){if("anchorPosition"===m)return"production"!==process.env.NODE_ENV&&(p||console.error('Material-UI: you need to provide a `anchorPosition` prop when using <Popover anchorReference="anchorPosition" />.')),p;var t=getAnchorEl(v),r=t instanceof(0,_ownerWindow.default)(t).Element?t:(0,_ownerDocument.default)(W.current).body,o=r.getBoundingClientRect();if("production"!==process.env.NODE_ENV){var n=r.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===n.top&&0===n.left&&0===n.right&&0===n.bottom&&console.warn(["Material-UI: the `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}var i=0===e?a.vertical:"center";return{top:o.top+getOffsetTop(o,i),left:o.left+getOffsetLeft(o,a.horizontal)}},[v,a.horizontal,a.vertical,p,m]),k=_react.default.useCallback(function(e){var t=0;if(d&&"anchorEl"===m){var r=d(e);if(r&&e.contains(r)){var o=getScrollParent(e,r);t=r.offsetTop+r.clientHeight/2-o||0}"production"!==process.env.NODE_ENV&&"top"!==a.vertical&&console.error(["Material-UI: you can not change the default `anchorOrigin.vertical` value ","when also providing the `getContentAnchorEl` prop to the popover component.","Only use one of the two props.","Set `getContentAnchorEl` to `null | undefined` or leave `anchorOrigin.vertical` unchanged."].join("\n"))}return t},[a.vertical,m,d]),I=_react.default.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return{vertical:getOffsetTop(e,P.vertical)+t,horizontal:getOffsetLeft(e,P.horizontal)}},[P.horizontal,P.vertical]),S=_react.default.useCallback(function(e){var t=k(e),r={width:e.offsetWidth,height:e.offsetHeight},o=I(r,t);if("none"===m)return{top:null,left:null,transformOrigin:getTransformOriginValue(o)};var n=V(t),i=n.top-o.vertical,a=n.left-o.horizontal,p=i+r.height,l=a+r.width,u=(0,_ownerWindow.default)(getAnchorEl(v)),s=u.innerHeight-y,f=u.innerWidth-y;if(i<y){var c=i-y;i-=c,o.vertical+=c}else if(s<p){var d=p-s;i-=d,o.vertical+=d}if("production"!==process.env.NODE_ENV&&s<r.height&&r.height&&s&&console.error(["Material-UI: the popover component is too tall.","Some part of it can not be seen on the screen (".concat(r.height-s,"px)."),"Please consider adding a `max-height` to improve the user-experience."].join("\n")),a<y){var h=a-y;a-=h,o.horizontal+=h}else if(f<l){var _=l-f;a-=_,o.horizontal+=_}return{top:"".concat(Math.round(i),"px"),left:"".concat(Math.round(a),"px"),transformOrigin:getTransformOriginValue(o)}},[v,m,V,k,I,y]),L=_react.default.useCallback(function(){var e=W.current;if(e){var t=S(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin}},[S]),H=_react.default.useCallback(function(e){W.current=_reactDom.default.findDOMNode(e)},[]);_react.default.useEffect(function(){q&&L()}),_react.default.useImperativeHandle(r,function(){return q?{updatePosition:function(){L()}}:null},[q,L]),_react.default.useEffect(function(){if(q){var e=(0,_debounce.default)(function(){L()});return window.addEventListener("resize",e),function(){e.clear(),window.removeEventListener("rezise",e)}}},[q,L]);var U=M;"auto"!==M||C.muiSupportAuto||(U=void 0);var B=s||(v?(0,_ownerDocument.default)(getAnchorEl(v)).body:void 0);return _react.default.createElement(_Modal.default,(0,_extends2.default)({container:B,open:q,ref:t,BackdropProps:{invisible:!0},className:(0,_clsx.default)(l.root,u)},A),_react.default.createElement(C,(0,_extends2.default)({appear:!0,in:q,onEnter:_,onEntered:g,onExit:E,onExited:b,onExiting:O,timeout:U},j,{onEntering:(0,_createChainedFunction.default)(function(e,t){T&&T(e,t),L()},j.onEntering)}),_react.default.createElement(_Paper.default,(0,_extends2.default)({elevation:c,ref:H},w,{className:(0,_clsx.default)(l.paper,w.className)}),i)))});"production"!==process.env.NODE_ENV&&(Popover.propTypes={action:_utils.refType,anchorEl:(0,_utils.chainPropTypes)(_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.func]),function(e){if(e.open&&(!e.anchorReference||"anchorEl"===e.anchorReference)){var t=getAnchorEl(e.anchorEl);if(!(t instanceof(0,_ownerWindow.default)(t).Element))return new Error(["Material-UI: the `anchorEl` prop provided to the component is invalid.","It should be an Element instance but it's `".concat(t,"` instead.")].join("\n"));var r=t.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===r.top&&0===r.left&&0===r.right&&0===r.bottom)return new Error(["Material-UI: the `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}return null}),anchorOrigin:_propTypes.default.shape({horizontal:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.oneOf(["left","center","right"])]).isRequired,vertical:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.oneOf(["top","center","bottom"])]).isRequired}),anchorPosition:_propTypes.default.shape({left:_propTypes.default.number.isRequired,top:_propTypes.default.number.isRequired}),anchorReference:_propTypes.default.oneOf(["anchorEl","anchorPosition","none"]),children:_propTypes.default.node,classes:_propTypes.default.object.isRequired,className:_propTypes.default.string,container:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.func]),elevation:_propTypes.default.number,getContentAnchorEl:_propTypes.default.func,marginThreshold:_propTypes.default.number,onClose:_propTypes.default.func,onEnter:_propTypes.default.func,onEntered:_propTypes.default.func,onEntering:_propTypes.default.func,onExit:_propTypes.default.func,onExited:_propTypes.default.func,onExiting:_propTypes.default.func,open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef}),transformOrigin:_propTypes.default.shape({horizontal:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.oneOf(["left","center","right"])]).isRequired,vertical:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.oneOf(["top","center","bottom"])]).isRequired}),TransitionComponent:_propTypes.default.elementType,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number}),_propTypes.default.oneOf(["auto"])]),TransitionProps:_propTypes.default.object});var _default=(0,_withStyles.default)(styles,{name:"MuiPopover"})(Popover);exports.default=_default;