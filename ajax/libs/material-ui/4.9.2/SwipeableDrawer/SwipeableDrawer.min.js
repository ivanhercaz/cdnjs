"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.reset=reset,exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactDom=_interopRequireDefault(require("react-dom")),_utils=require("@material-ui/utils"),_Drawer=_interopRequireWildcard(require("../Drawer/Drawer")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_transitions=require("../styles/transitions"),_useTheme=_interopRequireDefault(require("../styles/useTheme")),_utils2=require("../transitions/utils"),_NoSsr=_interopRequireDefault(require("../NoSsr")),_SwipeArea=_interopRequireDefault(require("./SwipeArea")),UNCERTAINTY_THRESHOLD=3,nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t){return"right"===e?document.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t){return"bottom"===e?window.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,a){return Math.min(Math.max(r?t-e:a+t-e,0),a)}function getDomTreeShapes(e,t){for(var r=[];e&&e!==t;){var a=window.getComputedStyle(e);"absolute"===a.getPropertyValue("position")||"hidden"===a.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler(e){var t=e.domTreeShapes,u=e.start,o=e.current,l=e.anchor,s={x:"scrollLeft",y:"scrollTop"},c={x:"scrollWidth",y:"scrollHeight"},p={x:"clientWidth",y:"clientHeight"};return t.some(function(e){var t=u<=o;"top"!==l&&"left"!==l||(t=!t);var r="left"===l||"right"===l?"x":"y",a=e[s[r]],n=0<a,i=a+e[p[r]]<e[c[r]];return t&&i||!t&&n?e:null})}var disableSwipeToOpenDefault="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:_transitions.duration.enteringScreen,exit:_transitions.duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?_react.default.useLayoutEffect:_react.default.useEffect,SwipeableDrawer=_react.default.forwardRef(function(e,t){var r=e.anchor,f=void 0===r?"left":r,a=e.disableBackdropTransition,_=void 0!==a&&a,n=e.disableDiscovery,h=void 0!==n&&n,i=e.disableSwipeToOpen,u=void 0===i?disableSwipeToOpenDefault:i,T=e.hideBackdrop,o=e.hysteresis,l=void 0===o?.52:o,s=e.minFlingVelocity,c=void 0===s?450:s,p=e.ModalProps,d=(p=void 0===p?{}:p).BackdropProps,v=(0,_objectWithoutProperties2.default)(p,["BackdropProps"]),m=e.onClose,y=e.onOpen,w=e.open,b=e.PaperProps,g=void 0===b?{}:b,D=e.SwipeAreaProps,S=e.swipeAreaWidth,E=void 0===S?20:S,C=e.transitionDuration,R=void 0===C?transitionDurationDefault:C,q=e.variant,P=void 0===q?"temporary":q,x=(0,_objectWithoutProperties2.default)(e,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),H=(0,_useTheme.default)(),k=_react.default.useState(!1),A=k[0],O=k[1],M=_react.default.useRef({isSwiping:null}),Y=_react.default.useRef(),N=_react.default.useRef(),W=_react.default.useRef(),X=_react.default.useRef(!1),L=_react.default.useRef();useEnhancedEffect(function(){L.current=null},[w]);var B=_react.default.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.mode,a=void 0===r?null:r,n=t.changeTransition,i=void 0===n||n,u=(0,_Drawer.getAnchor)(H,f),o=-1!==["right","bottom"].indexOf(u)?1:-1,l=(0,_Drawer.isHorizontal)(f),s=l?"translate(".concat(o*e,"px, 0)"):"translate(0, ".concat(o*e,"px)"),c=W.current.style;c.webkitTransform=s,c.transform=s;var p="";if(a&&(p=H.transitions.create("all",(0,_utils2.getTransitionProps)({timeout:R},{mode:a}))),i&&(c.webkitTransition=p,c.transition=p),!_&&!T){var d=N.current.style;d.opacity=1-e/getMaxTranslate(l,W.current),i&&(d.webkitTransition=p,d.transition=p)}},[f,_,T,H,R]),j=(0,_useEventCallback.default)(function(e){if(X.current)if(nodeThatClaimedTheSwipe=null,X.current=!1,O(!1),M.current.isSwiping){var t,r=(M.current.isSwiping=null,_Drawer.getAnchor)(H,f),a=(0,_Drawer.isHorizontal)(f);t=(a?calculateCurrentX:calculateCurrentY)(r,e.changedTouches);var n=a?M.current.startX:M.current.startY,i=getMaxTranslate(a,W.current),u=getTranslate(t,n,w,i),o=u/i;Math.abs(M.current.velocity)>c&&(L.current=1e3*Math.abs((i-u)/M.current.velocity)),w?M.current.velocity>c||l<o?m():B(0,{mode:"exit"}):M.current.velocity<-c||l<1-o?y():B(getMaxTranslate(a,W.current),{mode:"enter"})}else M.current.isSwiping=null}),V=(0,_useEventCallback.default)(function(e){if(W.current&&X.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===M.current)){var t=(0,_Drawer.getAnchor)(H,f),r=(0,_Drawer.isHorizontal)(f),a=calculateCurrentX(t,e.touches),n=calculateCurrentY(t,e.touches);if(w&&W.current.contains(e.target)&&null==nodeThatClaimedTheSwipe){var i=findNativeHandler({domTreeShapes:getDomTreeShapes(e.target,W.current),start:r?M.current.startX:M.current.startY,current:r?a:n,anchor:f});if(i)return void(nodeThatClaimedTheSwipe=i);nodeThatClaimedTheSwipe=M.current}if(null==M.current.isSwiping){var u=Math.abs(a-M.current.startX),o=Math.abs(n-M.current.startY);o<u&&e.cancelable&&e.preventDefault();var l=r?o<u&&UNCERTAINTY_THRESHOLD<u:u<o&&UNCERTAINTY_THRESHOLD<o;if(!0==l||(r?UNCERTAINTY_THRESHOLD<o:UNCERTAINTY_THRESHOLD<u)){if(!(M.current.isSwiping=l))return void j(e);M.current.startX=a,M.current.startY=n,h||w||(r?M.current.startX-=E:M.current.startY-=E)}}if(M.current.isSwiping){var s=getMaxTranslate(r,W.current),c=r?M.current.startX:M.current.startY;w&&!M.current.paperHit&&(c=Math.min(c,s));var p=getTranslate(r?a:n,c,w,s);if(w)if(M.current.paperHit)0===p&&(M.current.startX=a,M.current.startY=n);else{if(!(r?a<s:n<s))return;M.current.paperHit=!0,M.current.startX=a,M.current.startY=n}null===M.current.lastTranslate&&(M.current.lastTranslate=p,M.current.lastTime=performance.now()+1);var d=(p-M.current.lastTranslate)/(performance.now()-M.current.lastTime)*1e3;M.current.velocity=.4*M.current.velocity+.6*d,M.current.lastTranslate=p,M.current.lastTime=performance.now(),e.cancelable&&e.preventDefault(),B(p)}}}),I=(0,_useEventCallback.default)(function(e){if(!e.defaultPrevented&&!e.muiHandled&&(!w||N.current.contains(e.target)||W.current.contains(e.target))){var t=(0,_Drawer.getAnchor)(H,f),r=(0,_Drawer.isHorizontal)(f),a=calculateCurrentX(t,e.touches),n=calculateCurrentY(t,e.touches);if(!w){if(u||e.target!==Y.current)return;if(r){if(E<a)return}else if(E<n)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,M.current.startX=a,M.current.startY=n,O(!0),!w&&W.current&&B(getMaxTranslate(r,W.current)+(h?20:-E),{changeTransition:!1}),M.current.velocity=0,M.current.lastTime=null,M.current.lastTranslate=null,M.current.paperHit=!1,X.current=!0}});_react.default.useEffect(function(){if("temporary"===P){var e=(0,_ownerDocument.default)(W.current);return e.addEventListener("touchstart",I),e.addEventListener("touchmove",V,{passive:!1}),e.addEventListener("touchend",j),function(){e.removeEventListener("touchstart",I),e.removeEventListener("touchmove",V,{passive:!1}),e.removeEventListener("touchend",j)}}},[P,I,V,j]),_react.default.useEffect(function(){return function(){nodeThatClaimedTheSwipe===M.current&&(nodeThatClaimedTheSwipe=null)}},[]),_react.default.useEffect(function(){w||O(!1)},[w]);var U=_react.default.useCallback(function(e){N.current=_reactDom.default.findDOMNode(e)},[]),z=_react.default.useCallback(function(e){W.current=_reactDom.default.findDOMNode(e)},[]);return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_Drawer.default,(0,_extends2.default)({open:!("temporary"!==P||!A)||w,variant:P,ModalProps:(0,_extends2.default)({BackdropProps:(0,_extends2.default)({},d,{ref:U})},v),PaperProps:(0,_extends2.default)({},g,{style:(0,_extends2.default)({pointerEvents:"temporary"!==P||w?"":"none"},g.style),ref:z}),anchor:f,transitionDuration:L.current||R,onClose:m,ref:t},x)),!u&&"temporary"===P&&_react.default.createElement(_NoSsr.default,null,_react.default.createElement(_SwipeArea.default,(0,_extends2.default)({anchor:f,ref:Y,width:E},D))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:_propTypes.default.oneOf(["left","top","right","bottom"]),children:_propTypes.default.node,disableBackdropTransition:_propTypes.default.bool,disableDiscovery:_propTypes.default.bool,disableSwipeToOpen:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,hysteresis:_propTypes.default.number,minFlingVelocity:_propTypes.default.number,ModalProps:_propTypes.default.shape({BackdropProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef})}),onClose:_propTypes.default.func.isRequired,onOpen:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef,style:_propTypes.default.object}),SwipeAreaProps:_propTypes.default.object,swipeAreaWidth:_propTypes.default.number,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number})]),variant:_propTypes.default.oneOf(["permanent","persistent","temporary"])});var _default=SwipeableDrawer;exports.default=_default;