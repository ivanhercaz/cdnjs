"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.styles=exports.DELAY_RIPPLE=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactTransitionGroup=require("react-transition-group"),_clsx=_interopRequireDefault(require("clsx")),_withStyles=_interopRequireDefault(require("../styles/withStyles")),_Ripple=_interopRequireDefault(require("./Ripple")),DURATION=550,DELAY_RIPPLE=80;exports.DELAY_RIPPLE=DELAY_RIPPLE;var styles=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}};exports.styles=styles;var TouchRipple=React.forwardRef(function(e,t){var r=e.center,y=void 0!==r&&r,u=e.classes,i=e.className,a=(0,_objectWithoutProperties2.default)(e,["center","classes","className"]),n=React.useState([]),o=n[0],l=n[1],s=React.useRef(0),c=React.useRef(null);React.useEffect(function(){c.current&&(c.current(),c.current=null)},[o]);var q=React.useRef(!1),v=React.useRef(null),D=React.useRef(null),T=React.useRef(null);React.useEffect(function(){return function(){clearTimeout(v.current)}},[]);var g=React.useCallback(function(e){var t=e.pulsate,r=e.rippleX,i=e.rippleY,a=e.rippleSize,n=e.cb;l(function(e){return[].concat((0,_toConsumableArray2.default)(e),[React.createElement(_Ripple.default,{key:s.current,classes:u,timeout:DURATION,pulsate:t,rippleX:r,rippleY:i,rippleSize:a})])}),s.current+=1,c.current=n},[u]),p=React.useCallback(function(){var e,t,r,i,a,n,u,o,l,s,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=2<arguments.length?arguments[2]:void 0,d=p.pulsate,h=void 0!==d&&d,R=p.center,m=void 0===R?y||p.pulsate:R,_=p.fakeElement,b=void 0!==_&&_;"mousedown"===c.type&&q.current?q.current=!1:("touchstart"===c.type&&(q.current=!0),t=(e=b?null:T.current)?e.getBoundingClientRect():{width:0,height:0,left:0,top:0},u=m||0===c.clientX&&0===c.clientY||!c.clientX&&!c.touches?(n=Math.round(t.width/2),Math.round(t.height/2)):(i=(r=c.touches?c.touches[0]:c).clientX,a=r.clientY,n=Math.round(i-t.left),Math.round(a-t.top)),m?(s=Math.sqrt((2*Math.pow(t.width,2)+Math.pow(t.height,2))/3))%2==0&&(s+=1):(o=2*Math.max(Math.abs((e?e.clientWidth:0)-n),n)+2,l=2*Math.max(Math.abs((e?e.clientHeight:0)-u),u)+2,s=Math.sqrt(Math.pow(o,2)+Math.pow(l,2))),c.touches?null===D.current&&(D.current=function(){g({pulsate:h,rippleX:n,rippleY:u,rippleSize:s,cb:f})},v.current=setTimeout(function(){D.current&&(D.current(),D.current=null)},DELAY_RIPPLE)):g({pulsate:h,rippleX:n,rippleY:u,rippleSize:s,cb:f}))},[y,g]),f=React.useCallback(function(){p({},{pulsate:!0})},[p]),d=React.useCallback(function(e,t){if(clearTimeout(v.current),"touchend"===e.type&&D.current)return e.persist(),D.current(),D.current=null,void(v.current=setTimeout(function(){d(e,t)}));D.current=null,l(function(e){return 0<e.length?e.slice(1):e}),c.current=t},[]);return React.useImperativeHandle(t,function(){return{pulsate:f,start:p,stop:d}},[f,p,d]),React.createElement("span",(0,_extends2.default)({className:(0,_clsx.default)(u.root,i),ref:T},a),React.createElement(_reactTransitionGroup.TransitionGroup,{component:null,exit:!0},o))});"production"!==process.env.NODE_ENV&&(TouchRipple.propTypes={center:_propTypes.default.bool,classes:_propTypes.default.object.isRequired,className:_propTypes.default.string});var _default=(0,_withStyles.default)(styles,{flip:!1,name:"MuiTouchRipple"})(React.memo(TouchRipple));exports.default=_default;