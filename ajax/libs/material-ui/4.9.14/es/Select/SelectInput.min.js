import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import*as React from"react";import{isFragment}from"react-is";import PropTypes from"prop-types";import clsx from"clsx";import ownerDocument from"../utils/ownerDocument";import capitalize from"../utils/capitalize";import{refType}from"@material-ui/utils";import Menu from"../Menu/Menu";import{isFilled}from"../InputBase/utils";import useForkRef from"../utils/useForkRef";import useControlled from"../utils/useControlled";function areEqualValues(e,o){return"object"==typeof o&&null!==o?e===o:String(e)===String(o)}function isEmpty(e){return null==e||"string"==typeof e&&!e.trim()}const SelectInput=React.forwardRef(function(e,o){const{"aria-label":t,autoFocus:r,autoWidth:n,children:a,classes:l,className:s,defaultValue:p,disabled:i,displayEmpty:u,IconComponent:c,inputRef:d,labelId:m,MenuProps:y={},multiple:f,name:b,onBlur:P,onChange:v,onClose:h,onFocus:T,onOpen:R,open:E,readOnly:g,renderValue:x,SelectDisplayProps:C={},tabIndex:I,value:F,variant:S="standard"}=e,w=_objectWithoutPropertiesLoose(e,["aria-label","autoFocus","autoWidth","children","classes","className","defaultValue","disabled","displayEmpty","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","required","SelectDisplayProps","tabIndex","type","value","variant"]),[O,j]=useControlled({controlled:F,default:p,name:"Select"}),D=React.useRef(null),[M,_]=React.useState(null),{current:V}=React.useRef(null!=E),[N,k]=React.useState(),[W,A]=React.useState(!1),L=useForkRef(o,d);React.useImperativeHandle(L,()=>({focus:()=>{M.focus()},node:D.current,value:O}),[M,O]),React.useEffect(()=>{r&&M&&M.focus()},[r,M]),React.useEffect(()=>{if(M){const e=ownerDocument(M).querySelector(`#${m}`);if(e){const o=()=>{getSelection().isCollapsed&&M.focus()};return e.addEventListener("click",o),()=>{e.removeEventListener("click",o)}}}},[m,M]);const $=(e,o)=>{e?R&&R(o):h&&h(o),V||(k(n?null:M.clientWidth),A(e))},q=null!==M&&(V?E:W);let U,B;delete w["aria-invalid"];const K=[];let z=!1,H=!1;(isFilled({value:O})||u)&&(x?U=x(O):z=!0);const Y=React.Children.map(a,e=>{if(!React.isValidElement(e))return null;let o;if("production"!==process.env.NODE_ENV&&isFragment(e)&&console.error(["Material-UI: The Select component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),f){if(!Array.isArray(O))throw new Error("Material-UI: The `value` prop must be an array when using the `Select` component with `multiple`.");(o=O.some(o=>areEqualValues(o,e.props.value)))&&z&&K.push(e.props.children)}else(o=areEqualValues(O,e.props.value))&&z&&(B=e.props.children);return o&&(H=!0),React.cloneElement(e,{"aria-selected":o?"true":void 0,onClick:(e=>o=>{let t;if(f||$(!1,o),f){t=Array.isArray(O)?[...O]:[];const o=O.indexOf(e.props.value);-1===o?t.push(e.props.value):t.splice(o,1)}else t=e.props.value;e.props.onClick&&e.props.onClick(o),O!==t&&(j(t),v&&(o.persist(),Object.defineProperty(o,"target",{writable:!0,value:{value:t,name:b}}),v(o,e)))})(e),onKeyUp:o=>{" "===o.key&&o.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(o)},role:"option",selected:o,value:void 0,"data-value":e.props.value})});"production"!==process.env.NODE_ENV&&React.useEffect(()=>{if(!H&&!f&&""!==O){const e=React.Children.toArray(a).map(e=>e.props.value);console.warn([`Material-UI: You have provided an out-of-range value \`${O}\` for the select ${b?`(name="${b}") `:""}component.`,"Consider providing a value that matches one of the available options or ''.",`The available values are ${e.filter(e=>null!=e).map(e=>`\`${e}\``).join(", ")||'""'}.`].join("\n"))}},[H,a,f,b,O]),z&&(U=f?K.join(", "):B);let G,J=N;!n&&V&&M&&(J=M.clientWidth),G=void 0!==I?I:i?null:0;const Q=C.id||(b?`mui-component-select-${b}`:void 0);return React.createElement(React.Fragment,null,React.createElement("div",_extends({className:clsx(l.root,l.select,l.selectMenu,l[S],s,i&&l.disabled),ref:_,tabIndex:G,role:"button","aria-disabled":i?"true":void 0,"aria-expanded":q?"true":void 0,"aria-haspopup":"listbox","aria-label":t,"aria-labelledby":[m,Q].filter(Boolean).join(" ")||void 0,onKeyDown:e=>{g||-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),$(!0,e))},onMouseDown:i||g?null:e=>{0===e.button&&(e.preventDefault(),M.focus(),$(!0,e))},onBlur:e=>{!q&&P&&(e.persist(),Object.defineProperty(e,"target",{writable:!0,value:{value:O,name:b}}),P(e))},onFocus:T},C,{id:Q}),isEmpty(U)?React.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):U),React.createElement("input",_extends({value:Array.isArray(O)?O.join(","):O,name:b,ref:D,type:"hidden",autoFocus:r},w)),React.createElement(c,{className:clsx(l.icon,l[`icon${capitalize(S)}`],q&&l.iconOpen,i&&l.disabled)}),React.createElement(Menu,_extends({id:`menu-${b||""}`,anchorEl:M,open:q,onClose:e=>{$(!1,e)}},y,{MenuListProps:_extends({"aria-labelledby":m,role:"listbox",disableListWrap:!0},y.MenuListProps),PaperProps:_extends(_extends({},y.PaperProps),{},{style:_extends({minWidth:J},null!=y.PaperProps?y.PaperProps.style:null)})}),Y))});"production"!==process.env.NODE_ENV&&(SelectInput.propTypes={"aria-label":PropTypes.string,autoFocus:PropTypes.bool,autoWidth:PropTypes.bool,children:PropTypes.node,classes:PropTypes.object.isRequired,className:PropTypes.string,defaultValue:PropTypes.any,disabled:PropTypes.bool,displayEmpty:PropTypes.bool,IconComponent:PropTypes.elementType.isRequired,inputRef:refType,labelId:PropTypes.string,MenuProps:PropTypes.object,multiple:PropTypes.bool,name:PropTypes.string,onBlur:PropTypes.func,onChange:PropTypes.func,onClose:PropTypes.func,onFocus:PropTypes.func,onOpen:PropTypes.func,open:PropTypes.bool,readOnly:PropTypes.bool,renderValue:PropTypes.func,required:PropTypes.bool,SelectDisplayProps:PropTypes.object,tabIndex:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),type:PropTypes.any,value:PropTypes.any,variant:PropTypes.oneOf(["standard","outlined","filled"])});export default SelectInput;