"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.reset=reset,exports.default=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),ReactDOM=_interopRequireWildcard(require("react-dom")),_utils=require("@material-ui/utils"),_styles=require("@material-ui/styles"),_Drawer=_interopRequireWildcard(require("../Drawer/Drawer")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_transitions=require("../styles/transitions"),_useTheme=_interopRequireDefault(require("../styles/useTheme")),_utils2=require("../transitions/utils"),_NoSsr=_interopRequireDefault(require("../NoSsr")),_SwipeArea=_interopRequireDefault(require("./SwipeArea")),UNCERTAINTY_THRESHOLD=3,nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t){return"right"===e?document.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t){return"bottom"===e?window.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,n){return Math.min(Math.max(r?t-e:n+t-e,0),n)}function getDomTreeShapes(e,t){for(var r=[];e&&e!==t;){var n=window.getComputedStyle(e);"absolute"===n.getPropertyValue("position")||"hidden"===n.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler(e){var t=e.domTreeShapes,o=e.start,u=e.current,l=e.anchor,s={x:"scrollLeft",y:"scrollTop"},c={x:"scrollWidth",y:"scrollHeight"},p={x:"clientWidth",y:"clientHeight"};return t.some(function(e){var t=o<=u;"top"!==l&&"left"!==l||(t=!t);var r="left"===l||"right"===l?"x":"y",n=e[s[r]],a=0<n,i=n+e[p[r]]<e[c[r]];return t&&i||!t&&a?e:null})}var disableSwipeToOpenDefault="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:_transitions.duration.enteringScreen,exit:_transitions.duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?React.useLayoutEffect:React.useEffect,SwipeableDrawer=React.forwardRef(function(e,t){var f=(0,_useTheme.default)(),r=(0,_styles.getThemeProps)({name:"MuiSwipeableDrawer",props:(0,_extends2.default)({},e),theme:f}),n=r.anchor,h=void 0===n?"left":n,a=r.disableBackdropTransition,T=void 0!==a&&a,i=r.disableDiscovery,_=void 0!==i&&i,o=r.disableSwipeToOpen,u=void 0===o?disableSwipeToOpenDefault:o,m=r.hideBackdrop,l=r.hysteresis,s=void 0===l?.52:l,c=r.minFlingVelocity,p=void 0===c?450:c,d=r.ModalProps,v=(d=void 0===d?{}:d).BackdropProps,y=(0,_objectWithoutProperties2.default)(d,["BackdropProps"]),w=r.onClose,b=r.onOpen,g=r.open,R=r.PaperProps,D=void 0===R?{}:R,S=r.SwipeAreaProps,E=r.swipeAreaWidth,C=void 0===E?20:E,q=r.transitionDuration,x=void 0===q?transitionDurationDefault:q,P=r.variant,H=void 0===P?"temporary":P,M=(0,_objectWithoutProperties2.default)(r,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),O=React.useState(!1),A=O[0],k=O[1],Y=React.useRef({isSwiping:null}),W=React.useRef(),N=React.useRef(),X=React.useRef(),L=React.useRef(!1),B=React.useRef();useEnhancedEffect(function(){B.current=null},[g]);var j=React.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.mode,n=void 0===r?null:r,a=t.changeTransition,i=void 0===a||a,o=(0,_Drawer.getAnchor)(f,h),u=-1!==["right","bottom"].indexOf(o)?1:-1,l=(0,_Drawer.isHorizontal)(h),s=l?"translate(".concat(u*e,"px, 0)"):"translate(0, ".concat(u*e,"px)"),c=X.current.style;c.webkitTransform=s,c.transform=s;var p,d="";n&&(d=f.transitions.create("all",(0,_utils2.getTransitionProps)({timeout:x},{mode:n}))),i&&(c.webkitTransition=d,c.transition=d),T||m||((p=N.current.style).opacity=1-e/getMaxTranslate(l,X.current),i&&(p.webkitTransition=d,p.transition=d))},[h,T,m,f,x]),V=(0,_useEventCallback.default)(function(e){var t,r,n,a,i,o,u;L.current&&(nodeThatClaimedTheSwipe=null,L.current=!1,k(!1),Y.current.isSwiping?(t=(Y.current.isSwiping=null,_Drawer.getAnchor)(f,h),n=((r=(0,_Drawer.isHorizontal)(h))?calculateCurrentX:calculateCurrentY)(t,e.changedTouches),a=r?Y.current.startX:Y.current.startY,i=getMaxTranslate(r,X.current),u=(o=getTranslate(n,a,g,i))/i,Math.abs(Y.current.velocity)>p&&(B.current=1e3*Math.abs((i-o)/Y.current.velocity)),g?Y.current.velocity>p||s<u?w():j(0,{mode:"exit"}):Y.current.velocity<-p||s<1-u?b():j(getMaxTranslate(r,X.current),{mode:"enter"})):Y.current.isSwiping=null)}),I=(0,_useEventCallback.default)(function(e){if(X.current&&L.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===Y.current)){var t=(0,_Drawer.getAnchor)(f,h),r=(0,_Drawer.isHorizontal)(h),n=calculateCurrentX(t,e.touches),a=calculateCurrentY(t,e.touches);if(g&&X.current.contains(e.target)&&null==nodeThatClaimedTheSwipe){var i=findNativeHandler({domTreeShapes:getDomTreeShapes(e.target,X.current),start:r?Y.current.startX:Y.current.startY,current:r?n:a,anchor:h});if(i)return void(nodeThatClaimedTheSwipe=i);nodeThatClaimedTheSwipe=Y.current}if(null==Y.current.isSwiping){var o=Math.abs(n-Y.current.startX),u=Math.abs(a-Y.current.startY);u<o&&e.cancelable&&e.preventDefault();var l=r?u<o&&UNCERTAINTY_THRESHOLD<o:o<u&&UNCERTAINTY_THRESHOLD<u;if(!0==l||(r?UNCERTAINTY_THRESHOLD<u:UNCERTAINTY_THRESHOLD<o)){if(!(Y.current.isSwiping=l))return void V(e);Y.current.startX=n,Y.current.startY=a,_||g||(r?Y.current.startX-=C:Y.current.startY-=C)}}if(Y.current.isSwiping){var s=getMaxTranslate(r,X.current),c=r?Y.current.startX:Y.current.startY;g&&!Y.current.paperHit&&(c=Math.min(c,s));var p=getTranslate(r?n:a,c,g,s);if(g)if(Y.current.paperHit)0===p&&(Y.current.startX=n,Y.current.startY=a);else{if(!(r?n<s:a<s))return;Y.current.paperHit=!0,Y.current.startX=n,Y.current.startY=a}null===Y.current.lastTranslate&&(Y.current.lastTranslate=p,Y.current.lastTime=performance.now()+1);var d=(p-Y.current.lastTranslate)/(performance.now()-Y.current.lastTime)*1e3;Y.current.velocity=.4*Y.current.velocity+.6*d,Y.current.lastTranslate=p,Y.current.lastTime=performance.now(),e.cancelable&&e.preventDefault(),j(p)}}}),U=(0,_useEventCallback.default)(function(e){if(!e.defaultPrevented&&!e.muiHandled&&(!g||N.current.contains(e.target)||X.current.contains(e.target))){var t=(0,_Drawer.getAnchor)(f,h),r=(0,_Drawer.isHorizontal)(h),n=calculateCurrentX(t,e.touches),a=calculateCurrentY(t,e.touches);if(!g){if(u||e.target!==W.current)return;if(r){if(C<n)return}else if(C<a)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,Y.current.startX=n,Y.current.startY=a,k(!0),!g&&X.current&&j(getMaxTranslate(r,X.current)+(_?20:-C),{changeTransition:!1}),Y.current.velocity=0,Y.current.lastTime=null,Y.current.lastTranslate=null,Y.current.paperHit=!1,L.current=!0}});React.useEffect(function(){if("temporary"===H){var e=(0,_ownerDocument.default)(X.current);return e.addEventListener("touchstart",U),e.addEventListener("touchmove",I,{passive:!1}),e.addEventListener("touchend",V),function(){e.removeEventListener("touchstart",U),e.removeEventListener("touchmove",I,{passive:!1}),e.removeEventListener("touchend",V)}}},[H,U,I,V]),React.useEffect(function(){return function(){nodeThatClaimedTheSwipe===Y.current&&(nodeThatClaimedTheSwipe=null)}},[]),React.useEffect(function(){g||k(!1)},[g]);var z=React.useCallback(function(e){N.current=ReactDOM.findDOMNode(e)},[]);return React.createElement(React.Fragment,null,React.createElement(_Drawer.default,(0,_extends2.default)({open:!("temporary"!==H||!A)||g,variant:H,ModalProps:(0,_extends2.default)({BackdropProps:(0,_extends2.default)((0,_extends2.default)({},v),{},{ref:z})},y),PaperProps:(0,_extends2.default)((0,_extends2.default)({},D),{},{style:(0,_extends2.default)({pointerEvents:"temporary"!==H||g?"":"none"},D.style),ref:X}),anchor:h,transitionDuration:B.current||x,onClose:w,ref:t},M)),!u&&"temporary"===H&&React.createElement(_NoSsr.default,null,React.createElement(_SwipeArea.default,(0,_extends2.default)({anchor:h,ref:W,width:C},S))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:_propTypes.default.oneOf(["left","top","right","bottom"]),children:_propTypes.default.node,disableBackdropTransition:_propTypes.default.bool,disableDiscovery:_propTypes.default.bool,disableSwipeToOpen:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,hysteresis:_propTypes.default.number,minFlingVelocity:_propTypes.default.number,ModalProps:_propTypes.default.shape({BackdropProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef})}),onClose:_propTypes.default.func.isRequired,onOpen:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef,style:_propTypes.default.object}),SwipeAreaProps:_propTypes.default.object,swipeAreaWidth:_propTypes.default.number,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number})]),variant:_propTypes.default.oneOf(["permanent","persistent","temporary"])});var _default=SwipeableDrawer;exports.default=SwipeableDrawer;