import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import{isFragment}from"react-is";import PropTypes from"prop-types";import*as ReactDOM from"react-dom";import ownerDocument from"../utils/ownerDocument";import List from"../List";import getScrollbarSize from"../utils/getScrollbarSize";import useForkRef from"../utils/useForkRef";function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;var r=e.innerText;return void 0===r&&(r=e.textContent),0!==(r=r.trim().toLowerCase()).length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,n,o){for(var i=!1,s=n(e,t,!!t&&r);s;){if(s===e.firstChild){if(i)return!1;i=!0}if(s.hasAttribute("tabindex")&&!s.disabled&&"true"!==s.getAttribute("aria-disabled")&&textCriteriaMatches(s,o))return s.focus(),!0;s=n(e,s,r)}return!1}var useEnhancedEffect="undefined"==typeof window?React.useEffect:React.useLayoutEffect,MenuList=React.forwardRef(function(e,t){var r=e.actions,n=e.autoFocus,o=void 0!==n&&n,i=e.autoFocusItem,s=void 0!==i&&i,a=e.children,u=e.className,c=e.onKeyDown,l=e.disableListWrap,p=void 0!==l&&l,d=e.variant,f=void 0===d?"selectedMenu":d,m=_objectWithoutProperties(e,["actions","autoFocus","autoFocusItem","children","className","onKeyDown","disableListWrap","variant"]),v=React.useRef(null),h=React.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(function(){o&&v.current.focus()},[o]),React.useImperativeHandle(r,function(){return{adjustStyleForScrollbar:function(e,t){var r=!v.current.style.width;if(e.clientHeight<v.current.clientHeight&&r){var n="".concat(getScrollbarSize(!0),"px");v.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=n,v.current.style.width="calc(100% + ".concat(n,")")}return v.current}}},[]);var y=React.useCallback(function(e){v.current=ReactDOM.findDOMNode(e)},[]),b=useForkRef(y,t),g=-1;React.Children.forEach(a,function(e,t){React.isValidElement(e)&&("production"!==process.env.NODE_ENV&&isFragment(e)&&console.error(["Material-UI: the Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===f&&e.props.selected?g=t:-1===g&&(g=t)))});var R=React.Children.map(a,function(e,t){if(t===g){var r={};if(s&&(r.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===f&&(r.tabIndex=0),null!==r)return React.cloneElement(e,r)}return e});return React.createElement(List,_extends({role:"menu",ref:b,className:u,onKeyDown:function(e){var t=v.current,r=e.key,n=ownerDocument(t).activeElement;if("ArrowDown"===r)e.preventDefault(),moveFocus(t,n,p,nextItem);else if("ArrowUp"===r)e.preventDefault(),moveFocus(t,n,p,previousItem);else if("Home"===r)e.preventDefault(),moveFocus(t,null,p,nextItem);else if("End"===r)e.preventDefault(),moveFocus(t,null,p,previousItem);else if(1===r.length){var o=h.current,i=r.toLowerCase(),s=performance.now();o.keys.length>0&&(s-o.lastTime>500?(o.keys=[],o.repeating=!0,o.previousKeyMatched=!0):o.repeating&&i!==o.keys[0]&&(o.repeating=!1)),o.lastTime=s,o.keys.push(i);var a=n&&!o.repeating&&textCriteriaMatches(n,o);o.previousKeyMatched&&(a||moveFocus(t,n,!1,nextItem,o))?e.preventDefault():o.previousKeyMatched=!1}c&&c(e)},tabIndex:o?0:-1},m),R)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={actions:PropTypes.shape({current:PropTypes.object}),autoFocus:PropTypes.bool,autoFocusItem:PropTypes.bool,children:PropTypes.node,className:PropTypes.string,disableListWrap:PropTypes.bool,onKeyDown:PropTypes.func,variant:PropTypes.oneOf(["menu","selectedMenu"])});export default MenuList;