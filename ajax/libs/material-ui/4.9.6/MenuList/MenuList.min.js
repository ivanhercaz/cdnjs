"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_reactIs=require("react-is"),_propTypes=_interopRequireDefault(require("prop-types")),ReactDOM=_interopRequireWildcard(require("react-dom")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_List=_interopRequireDefault(require("../List")),_getScrollbarSize=_interopRequireDefault(require("../utils/getScrollbarSize")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef"));function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;var r=e.innerText;return void 0===r&&(r=e.textContent),0!==(r=r.trim().toLowerCase()).length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,i,n){for(var a=!1,u=i(e,t,!!t&&r);u;){if(u===e.firstChild){if(a)return!1;a=!0}if(u.hasAttribute("tabindex")&&!u.disabled&&"true"!==u.getAttribute("aria-disabled")&&textCriteriaMatches(u,n))return u.focus(),!0;u=i(e,u,r)}return!1}var useEnhancedEffect="undefined"==typeof window?React.useEffect:React.useLayoutEffect,MenuList=React.forwardRef(function(e,t){var r=e.actions,i=e.autoFocus,n=void 0!==i&&i,a=e.autoFocusItem,u=void 0!==a&&a,o=e.children,s=e.className,l=e.onKeyDown,c=e.disableListWrap,p=void 0!==c&&c,d=e.variant,f=void 0===d?"selectedMenu":d,v=(0,_objectWithoutProperties2.default)(e,["actions","autoFocus","autoFocusItem","children","className","onKeyDown","disableListWrap","variant"]),m=React.useRef(null),h=React.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(function(){n&&m.current.focus()},[n]),React.useImperativeHandle(r,function(){return{adjustStyleForScrollbar:function(e,t){var r=!m.current.style.width;if(e.clientHeight<m.current.clientHeight&&r){var i="".concat((0,_getScrollbarSize.default)(!0),"px");m.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=i,m.current.style.width="calc(100% + ".concat(i,")")}return m.current}}},[]);var _=React.useCallback(function(e){m.current=ReactDOM.findDOMNode(e)},[]),b=(0,_useForkRef.default)(_,t),y=-1;React.Children.forEach(o,function(e,t){React.isValidElement(e)&&("production"!==process.env.NODE_ENV&&(0,_reactIs.isFragment)(e)&&console.error(["Material-UI: the Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===f&&e.props.selected||-1===y)&&(y=t))});var R=React.Children.map(o,function(e,t){if(t===y){var r={};if(u&&(r.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===f&&(r.tabIndex=0),null!==r)return React.cloneElement(e,r)}return e});return React.createElement(_List.default,(0,_extends2.default)({role:"menu",ref:b,className:s,onKeyDown:function(e){var t=m.current,r=e.key,i=(0,_ownerDocument.default)(t).activeElement;if("ArrowDown"===r)e.preventDefault(),moveFocus(t,i,p,nextItem);else if("ArrowUp"===r)e.preventDefault(),moveFocus(t,i,p,previousItem);else if("Home"===r)e.preventDefault(),moveFocus(t,null,p,nextItem);else if("End"===r)e.preventDefault(),moveFocus(t,null,p,previousItem);else if(1===r.length){var n=h.current,a=r.toLowerCase(),u=performance.now();0<n.keys.length&&(500<u-n.lastTime?(n.keys=[],n.repeating=!0,n.previousKeyMatched=!0):n.repeating&&a!==n.keys[0]&&(n.repeating=!1)),n.lastTime=u,n.keys.push(a);var o=i&&!n.repeating&&textCriteriaMatches(i,n);n.previousKeyMatched&&(o||moveFocus(t,i,!1,nextItem,n))?e.preventDefault():n.previousKeyMatched=!1}l&&l(e)},tabIndex:n?0:-1},v),R)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={actions:_propTypes.default.shape({current:_propTypes.default.object}),autoFocus:_propTypes.default.bool,autoFocusItem:_propTypes.default.bool,children:_propTypes.default.node,className:_propTypes.default.string,disableListWrap:_propTypes.default.bool,onKeyDown:_propTypes.default.func,variant:_propTypes.default.oneOf(["menu","selectedMenu"])});var _default=MenuList;exports.default=_default;