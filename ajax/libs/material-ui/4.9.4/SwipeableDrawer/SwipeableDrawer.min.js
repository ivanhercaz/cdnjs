"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.reset=reset,exports.default=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactDom=_interopRequireDefault(require("react-dom")),_utils=require("@material-ui/utils"),_styles=require("@material-ui/styles"),_Drawer=_interopRequireWildcard(require("../Drawer/Drawer")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_transitions=require("../styles/transitions"),_useTheme=_interopRequireDefault(require("../styles/useTheme")),_utils2=require("../transitions/utils"),_NoSsr=_interopRequireDefault(require("../NoSsr")),_SwipeArea=_interopRequireDefault(require("./SwipeArea")),UNCERTAINTY_THRESHOLD=3,nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t){return"right"===e?document.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t){return"bottom"===e?window.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,a){return Math.min(Math.max(r?t-e:a+t-e,0),a)}function getDomTreeShapes(e,t){for(var r=[];e&&e!==t;){var a=window.getComputedStyle(e);"absolute"===a.getPropertyValue("position")||"hidden"===a.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler(e){var t=e.domTreeShapes,u=e.start,o=e.current,l=e.anchor,s={x:"scrollLeft",y:"scrollTop"},c={x:"scrollWidth",y:"scrollHeight"},p={x:"clientWidth",y:"clientHeight"};return t.some(function(e){var t=u<=o;"top"!==l&&"left"!==l||(t=!t);var r="left"===l||"right"===l?"x":"y",a=e[s[r]],n=0<a,i=a+e[p[r]]<e[c[r]];return t&&i||!t&&n?e:null})}var disableSwipeToOpenDefault="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:_transitions.duration.enteringScreen,exit:_transitions.duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?_react.default.useLayoutEffect:_react.default.useEffect,SwipeableDrawer=_react.default.forwardRef(function(e,t){var f=(0,_useTheme.default)(),r=(0,_styles.getThemeProps)({name:"MuiSwipeableDrawer",props:(0,_extends2.default)({},e),theme:f}),a=r.anchor,_=void 0===a?"left":a,n=r.disableBackdropTransition,h=void 0!==n&&n,i=r.disableDiscovery,T=void 0!==i&&i,u=r.disableSwipeToOpen,o=void 0===u?disableSwipeToOpenDefault:u,m=r.hideBackdrop,l=r.hysteresis,s=void 0===l?.52:l,c=r.minFlingVelocity,p=void 0===c?450:c,d=r.ModalProps,v=(d=void 0===d?{}:d).BackdropProps,y=(0,_objectWithoutProperties2.default)(d,["BackdropProps"]),w=r.onClose,b=r.onOpen,g=r.open,D=r.PaperProps,S=void 0===D?{}:D,E=r.SwipeAreaProps,R=r.swipeAreaWidth,C=void 0===R?20:R,q=r.transitionDuration,P=void 0===q?transitionDurationDefault:q,x=r.variant,H=void 0===x?"temporary":x,A=(0,_objectWithoutProperties2.default)(r,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),k=_react.default.useState(!1),M=k[0],O=k[1],Y=_react.default.useRef({isSwiping:null}),N=_react.default.useRef(),W=_react.default.useRef(),X=_react.default.useRef(),L=_react.default.useRef(!1),B=_react.default.useRef();useEnhancedEffect(function(){B.current=null},[g]);var j=_react.default.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.mode,a=void 0===r?null:r,n=t.changeTransition,i=void 0===n||n,u=(0,_Drawer.getAnchor)(f,_),o=-1!==["right","bottom"].indexOf(u)?1:-1,l=(0,_Drawer.isHorizontal)(_),s=l?"translate(".concat(o*e,"px, 0)"):"translate(0, ".concat(o*e,"px)"),c=X.current.style;c.webkitTransform=s,c.transform=s;var p="";if(a&&(p=f.transitions.create("all",(0,_utils2.getTransitionProps)({timeout:P},{mode:a}))),i&&(c.webkitTransition=p,c.transition=p),!h&&!m){var d=W.current.style;d.opacity=1-e/getMaxTranslate(l,X.current),i&&(d.webkitTransition=p,d.transition=p)}},[_,h,m,f,P]),V=(0,_useEventCallback.default)(function(e){if(L.current)if(nodeThatClaimedTheSwipe=null,L.current=!1,O(!1),Y.current.isSwiping){var t,r=(Y.current.isSwiping=null,_Drawer.getAnchor)(f,_),a=(0,_Drawer.isHorizontal)(_);t=(a?calculateCurrentX:calculateCurrentY)(r,e.changedTouches);var n=a?Y.current.startX:Y.current.startY,i=getMaxTranslate(a,X.current),u=getTranslate(t,n,g,i),o=u/i;Math.abs(Y.current.velocity)>p&&(B.current=1e3*Math.abs((i-u)/Y.current.velocity)),g?Y.current.velocity>p||s<o?w():j(0,{mode:"exit"}):Y.current.velocity<-p||s<1-o?b():j(getMaxTranslate(a,X.current),{mode:"enter"})}else Y.current.isSwiping=null}),I=(0,_useEventCallback.default)(function(e){if(X.current&&L.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===Y.current)){var t=(0,_Drawer.getAnchor)(f,_),r=(0,_Drawer.isHorizontal)(_),a=calculateCurrentX(t,e.touches),n=calculateCurrentY(t,e.touches);if(g&&X.current.contains(e.target)&&null==nodeThatClaimedTheSwipe){var i=findNativeHandler({domTreeShapes:getDomTreeShapes(e.target,X.current),start:r?Y.current.startX:Y.current.startY,current:r?a:n,anchor:_});if(i)return void(nodeThatClaimedTheSwipe=i);nodeThatClaimedTheSwipe=Y.current}if(null==Y.current.isSwiping){var u=Math.abs(a-Y.current.startX),o=Math.abs(n-Y.current.startY);o<u&&e.cancelable&&e.preventDefault();var l=r?o<u&&UNCERTAINTY_THRESHOLD<u:u<o&&UNCERTAINTY_THRESHOLD<o;if(!0==l||(r?UNCERTAINTY_THRESHOLD<o:UNCERTAINTY_THRESHOLD<u)){if(!(Y.current.isSwiping=l))return void V(e);Y.current.startX=a,Y.current.startY=n,T||g||(r?Y.current.startX-=C:Y.current.startY-=C)}}if(Y.current.isSwiping){var s=getMaxTranslate(r,X.current),c=r?Y.current.startX:Y.current.startY;g&&!Y.current.paperHit&&(c=Math.min(c,s));var p=getTranslate(r?a:n,c,g,s);if(g)if(Y.current.paperHit)0===p&&(Y.current.startX=a,Y.current.startY=n);else{if(!(r?a<s:n<s))return;Y.current.paperHit=!0,Y.current.startX=a,Y.current.startY=n}null===Y.current.lastTranslate&&(Y.current.lastTranslate=p,Y.current.lastTime=performance.now()+1);var d=(p-Y.current.lastTranslate)/(performance.now()-Y.current.lastTime)*1e3;Y.current.velocity=.4*Y.current.velocity+.6*d,Y.current.lastTranslate=p,Y.current.lastTime=performance.now(),e.cancelable&&e.preventDefault(),j(p)}}}),U=(0,_useEventCallback.default)(function(e){if(!e.defaultPrevented&&!e.muiHandled&&(!g||W.current.contains(e.target)||X.current.contains(e.target))){var t=(0,_Drawer.getAnchor)(f,_),r=(0,_Drawer.isHorizontal)(_),a=calculateCurrentX(t,e.touches),n=calculateCurrentY(t,e.touches);if(!g){if(o||e.target!==N.current)return;if(r){if(C<a)return}else if(C<n)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,Y.current.startX=a,Y.current.startY=n,O(!0),!g&&X.current&&j(getMaxTranslate(r,X.current)+(T?20:-C),{changeTransition:!1}),Y.current.velocity=0,Y.current.lastTime=null,Y.current.lastTranslate=null,Y.current.paperHit=!1,L.current=!0}});_react.default.useEffect(function(){if("temporary"===H){var e=(0,_ownerDocument.default)(X.current);return e.addEventListener("touchstart",U),e.addEventListener("touchmove",I,{passive:!1}),e.addEventListener("touchend",V),function(){e.removeEventListener("touchstart",U),e.removeEventListener("touchmove",I,{passive:!1}),e.removeEventListener("touchend",V)}}},[H,U,I,V]),_react.default.useEffect(function(){return function(){nodeThatClaimedTheSwipe===Y.current&&(nodeThatClaimedTheSwipe=null)}},[]),_react.default.useEffect(function(){g||O(!1)},[g]);var z=_react.default.useCallback(function(e){W.current=_reactDom.default.findDOMNode(e)},[]);return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_Drawer.default,(0,_extends2.default)({open:!("temporary"!==H||!M)||g,variant:H,ModalProps:(0,_extends2.default)({BackdropProps:(0,_extends2.default)({},v,{ref:z})},y),PaperProps:(0,_extends2.default)({},S,{style:(0,_extends2.default)({pointerEvents:"temporary"!==H||g?"":"none"},S.style),ref:X}),anchor:_,transitionDuration:B.current||P,onClose:w,ref:t},A)),!o&&"temporary"===H&&_react.default.createElement(_NoSsr.default,null,_react.default.createElement(_SwipeArea.default,(0,_extends2.default)({anchor:_,ref:N,width:C},E))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:_propTypes.default.oneOf(["left","top","right","bottom"]),children:_propTypes.default.node,disableBackdropTransition:_propTypes.default.bool,disableDiscovery:_propTypes.default.bool,disableSwipeToOpen:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,hysteresis:_propTypes.default.number,minFlingVelocity:_propTypes.default.number,ModalProps:_propTypes.default.shape({BackdropProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef})}),onClose:_propTypes.default.func.isRequired,onOpen:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef,style:_propTypes.default.object}),SwipeAreaProps:_propTypes.default.object,swipeAreaWidth:_propTypes.default.number,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number})]),variant:_propTypes.default.oneOf(["permanent","persistent","temporary"])});var _default=SwipeableDrawer;exports.default=_default;