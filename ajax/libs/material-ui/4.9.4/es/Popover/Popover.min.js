import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import React from"react";import PropTypes from"prop-types";import ReactDOM from"react-dom";import debounce from"../utils/debounce";import clsx from"clsx";import{chainPropTypes,elementTypeAcceptingRef,refType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";import createChainedFunction from"../utils/createChainedFunction";import withStyles from"../styles/withStyles";import Modal from"../Modal";import Grow from"../Grow";import Paper from"../Paper";export function getOffsetTop(e,o){let t=0;return"number"==typeof o?t=o:"center"===o?t=e.height/2:"bottom"===o&&(t=e.height),t};export function getOffsetLeft(e,o){let t=0;return"number"==typeof o?t=o:"center"===o?t=e.width/2:"right"===o&&(t=e.width),t};function getTransformOriginValue(e){return[e.horizontal,e.vertical].map(e=>"number"==typeof e?`${e}px`:e).join(" ")}function getScrollParent(e,o){let t=o,n=0;for(;t&&t!==e;)n+=(t=t.parentElement).scrollTop;return n}function getAnchorEl(e){return"function"==typeof e?e():e}export const styles={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}};const Popover=React.forwardRef(function(e,o){const{action:t,anchorEl:n,anchorOrigin:r={vertical:"top",horizontal:"left"},anchorPosition:i,anchorReference:p="anchorEl",children:s,classes:a,className:c,container:l,elevation:h=8,getContentAnchorEl:u,marginThreshold:f=16,onEnter:m,onEntered:d,onEntering:y,onExit:P,onExited:T,onExiting:g,open:E,PaperProps:v={},transformOrigin:b={vertical:"top",horizontal:"left"},TransitionComponent:O=Grow,transitionDuration:R="auto",TransitionProps:w={}}=e,x=_objectWithoutPropertiesLoose(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),C=React.useRef(),N=React.useCallback(e=>{if("anchorPosition"===p)return"production"!==process.env.NODE_ENV&&(i||console.error('Material-UI: you need to provide a `anchorPosition` prop when using <Popover anchorReference="anchorPosition" />.')),i;const o=getAnchorEl(n),t=o instanceof ownerWindow(o).Element?o:ownerDocument(C.current).body,s=t.getBoundingClientRect();if("production"!==process.env.NODE_ENV){const e=t.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom&&console.warn(["Material-UI: the `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}const a=0===e?r.vertical:"center";return{top:s.top+getOffsetTop(s,a),left:s.left+getOffsetLeft(s,r.horizontal)}},[n,r.horizontal,r.vertical,i,p]),D=React.useCallback(e=>{let o=0;if(u&&"anchorEl"===p){const t=u(e);if(t&&e.contains(t)){const n=getScrollParent(e,t);o=t.offsetTop+t.clientHeight/2-n||0}"production"!==process.env.NODE_ENV&&"top"!==r.vertical&&console.error(["Material-UI: you can not change the default `anchorOrigin.vertical` value ","when also providing the `getContentAnchorEl` prop to the popover component.","Only use one of the two props.","Set `getContentAnchorEl` to `null | undefined` or leave `anchorOrigin.vertical` unchanged."].join("\n"))}return o},[r.vertical,p,u]),M=React.useCallback((e,o=0)=>({vertical:getOffsetTop(e,b.vertical)+o,horizontal:getOffsetLeft(e,b.horizontal)}),[b.horizontal,b.vertical]),z=React.useCallback(e=>{const o=D(e),t={width:e.offsetWidth,height:e.offsetHeight},r=M(t,o);if("none"===p)return{top:null,left:null,transformOrigin:getTransformOriginValue(r)};const i=N(o);let s=i.top-r.vertical,a=i.left-r.horizontal;const c=s+t.height,l=a+t.width,h=ownerWindow(getAnchorEl(n)),u=h.innerHeight-f,m=h.innerWidth-f;if(s<f){const e=s-f;s-=e,r.vertical+=e}else if(c>u){const e=c-u;s-=e,r.vertical+=e}if("production"!==process.env.NODE_ENV&&t.height>u&&t.height&&u&&console.error(["Material-UI: the popover component is too tall.",`Some part of it can not be seen on the screen (${t.height-u}px).`,"Please consider adding a `max-height` to improve the user-experience."].join("\n")),a<f){const e=a-f;a-=e,r.horizontal+=e}else if(l>m){const e=l-m;a-=e,r.horizontal+=e}return{top:`${Math.round(s)}px`,left:`${Math.round(a)}px`,transformOrigin:getTransformOriginValue(r)}},[n,p,N,D,M,f]),j=React.useCallback(()=>{const e=C.current;if(!e)return;const o=z(e);null!==o.top&&(e.style.top=o.top),null!==o.left&&(e.style.left=o.left),e.style.transformOrigin=o.transformOrigin},[z]),A=React.useCallback(e=>{C.current=ReactDOM.findDOMNode(e)},[]);React.useEffect(()=>{E&&j()}),React.useImperativeHandle(t,()=>E?{updatePosition:()=>{j()}}:null,[E,j]),React.useEffect(()=>{if(!E)return;const e=debounce(()=>{j()});return window.addEventListener("resize",e),()=>{e.clear(),window.removeEventListener("rezise",e)}},[E,j]);let _=R;"auto"!==R||O.muiSupportAuto||(_=void 0);const W=l||(n?ownerDocument(getAnchorEl(n)).body:void 0);return React.createElement(Modal,_extends({container:W,open:E,ref:o,BackdropProps:{invisible:!0},className:clsx(a.root,c)},x),React.createElement(O,_extends({appear:!0,in:E,onEnter:m,onEntered:d,onExit:P,onExited:T,onExiting:g,timeout:_},w,{onEntering:createChainedFunction((e,o)=>{y&&y(e,o),j()},w.onEntering)}),React.createElement(Paper,_extends({elevation:h,ref:A},v,{className:clsx(a.paper,v.className)}),s)))});"production"!==process.env.NODE_ENV&&(Popover.propTypes={action:refType,anchorEl:chainPropTypes(PropTypes.oneOfType([PropTypes.object,PropTypes.func]),e=>{if(e.open&&(!e.anchorReference||"anchorEl"===e.anchorReference)){const o=getAnchorEl(e.anchorEl);if(!(o instanceof ownerWindow(o).Element))return new Error(["Material-UI: the `anchorEl` prop provided to the component is invalid.",`It should be an Element instance but it's \`${o}\` instead.`].join("\n"));{const e=o.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom)return new Error(["Material-UI: the `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}}return null}),anchorOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.number,PropTypes.oneOf(["left","center","right"])]).isRequired,vertical:PropTypes.oneOfType([PropTypes.number,PropTypes.oneOf(["top","center","bottom"])]).isRequired}),anchorPosition:PropTypes.shape({left:PropTypes.number.isRequired,top:PropTypes.number.isRequired}),anchorReference:PropTypes.oneOf(["anchorEl","anchorPosition","none"]),children:PropTypes.node,classes:PropTypes.object.isRequired,className:PropTypes.string,container:PropTypes.oneOfType([PropTypes.object,PropTypes.func]),elevation:PropTypes.number,getContentAnchorEl:PropTypes.func,marginThreshold:PropTypes.number,onClose:PropTypes.func,onEnter:PropTypes.func,onEntered:PropTypes.func,onEntering:PropTypes.func,onExit:PropTypes.func,onExited:PropTypes.func,onExiting:PropTypes.func,open:PropTypes.bool.isRequired,PaperProps:PropTypes.shape({component:elementTypeAcceptingRef}),transformOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.number,PropTypes.oneOf(["left","center","right"])]).isRequired,vertical:PropTypes.oneOfType([PropTypes.number,PropTypes.oneOf(["top","center","bottom"])]).isRequired}),TransitionComponent:PropTypes.elementType,transitionDuration:PropTypes.oneOfType([PropTypes.number,PropTypes.shape({enter:PropTypes.number,exit:PropTypes.number}),PropTypes.oneOf(["auto"])]),TransitionProps:PropTypes.object});export default withStyles(styles,{name:"MuiPopover"})(Popover);