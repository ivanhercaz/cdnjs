"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.styles=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_react=_interopRequireDefault(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_propTypes=_interopRequireDefault(require("prop-types")),_styles=require("@material-ui/styles"),_utils=require("@material-ui/utils"),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_Portal=_interopRequireDefault(require("../Portal")),_createChainedFunction=_interopRequireDefault(require("../utils/createChainedFunction")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_zIndex=_interopRequireDefault(require("../styles/zIndex")),_ModalManager=_interopRequireWildcard(require("./ModalManager")),_TrapFocus=_interopRequireDefault(require("./TrapFocus")),_SimpleBackdrop=_interopRequireDefault(require("./SimpleBackdrop"));function getContainer(e){return e="function"==typeof e?e():e,_reactDom.default.findDOMNode(e)}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new _ModalManager.default,styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};exports.styles=styles;var Modal=_react.default.forwardRef(function(e,r){function t(){return(0,_ownerDocument.default)(H.current)}function o(){return N.current.modalRef=V.current,N.current.mountNode=H.current,N.current}function a(){w.mount(o(),{disableScrollLock:x}),V.current.scrollTop=0}var n=(0,_styles.useTheme)(),u=(0,_styles.getThemeProps)({name:"MuiModal",props:(0,_extends2.default)({},e),theme:n}),l=u.BackdropComponent,i=void 0===l?_SimpleBackdrop.default:l,d=u.BackdropProps,s=u.children,p=u.closeAfterTransition,c=void 0!==p&&p,f=u.container,_=u.disableAutoFocus,b=void 0!==_&&_,y=u.disableBackdropClick,k=void 0!==y&&y,m=u.disableEnforceFocus,q=void 0!==m&&m,T=u.disableEscapeKeyDown,R=void 0!==T&&T,v=u.disablePortal,D=void 0!==v&&v,E=u.disableRestoreFocus,h=void 0!==E&&E,C=u.disableScrollLock,x=void 0!==C&&C,F=u.hideBackdrop,M=void 0!==F&&F,g=u.keepMounted,B=void 0!==g&&g,P=u.manager,w=void 0===P?defaultManager:P,I=u.onBackdropClick,A=u.onClose,K=u.onEscapeKeyDown,S=u.onRendered,j=u.open,z=(0,_objectWithoutProperties2.default)(u,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),W=_react.default.useState(!0),O=W[0],L=W[1],N=_react.default.useRef({}),H=_react.default.useRef(null),V=_react.default.useRef(null),G=(0,_useForkRef.default)(V,r),J=getHasTransition(u),Q=(0,_useEventCallback.default)(function(){var e=getContainer(f)||t().body;w.add(o(),e),V.current&&a()}),U=_react.default.useCallback(function(){return w.isTopModal(o())},[w]),X=(0,_useEventCallback.default)(function(e){(H.current=e)&&(S&&S(),j&&U()?a():(0,_ModalManager.ariaHidden)(V.current,!0))}),Y=_react.default.useCallback(function(){w.remove(o())},[w]);if(_react.default.useEffect(function(){return function(){Y()}},[Y]),_react.default.useEffect(function(){j?Q():J&&c||Y()},[j,Y,J,c,Q]),!B&&!j&&(!J||O))return null;var Z=styles(n||{zIndex:_zIndex.default}),$={};return void 0===s.props.tabIndex&&($.tabIndex=s.props.tabIndex||"-1"),J&&($.onEnter=(0,_createChainedFunction.default)(function(){L(!1)},s.props.onEnter),$.onExited=(0,_createChainedFunction.default)(function(){L(!0),c&&Y()},s.props.onExited)),_react.default.createElement(_Portal.default,{ref:X,container:f,disablePortal:D},_react.default.createElement("div",(0,_extends2.default)({ref:G,onKeyDown:function(e){"Escape"===e.key&&U()&&(e.stopPropagation(),K&&K(e),!R&&A&&A(e,"escapeKeyDown"))},role:"presentation"},z,{style:(0,_extends2.default)({},Z.root,{},!j&&O?Z.hidden:{},{},z.style)}),M?null:_react.default.createElement(i,(0,_extends2.default)({open:j,onClick:function(e){e.target===e.currentTarget&&(I&&I(e),!k&&A&&A(e,"backdropClick"))}},d)),_react.default.createElement(_TrapFocus.default,{disableEnforceFocus:q,disableAutoFocus:b,disableRestoreFocus:h,getDoc:t,isEnabled:U,open:j},_react.default.cloneElement(s,$))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:_propTypes.default.elementType,BackdropProps:_propTypes.default.object,children:_utils.elementAcceptingRef.isRequired,closeAfterTransition:_propTypes.default.bool,container:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.func]),disableAutoFocus:_propTypes.default.bool,disableBackdropClick:_propTypes.default.bool,disableEnforceFocus:_propTypes.default.bool,disableEscapeKeyDown:_propTypes.default.bool,disablePortal:_propTypes.default.bool,disableRestoreFocus:_propTypes.default.bool,disableScrollLock:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,keepMounted:_propTypes.default.bool,manager:_propTypes.default.object,onBackdropClick:_propTypes.default.func,onClose:_propTypes.default.func,onEscapeKeyDown:_propTypes.default.func,onRendered:_propTypes.default.func,open:_propTypes.default.bool.isRequired});var _default=Modal;exports.default=_default;