"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_react=_interopRequireDefault(require("react")),_reactIs=require("react-is"),_propTypes=_interopRequireDefault(require("prop-types")),_reactDom=_interopRequireDefault(require("react-dom")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_List=_interopRequireDefault(require("../List")),_getScrollbarSize=_interopRequireDefault(require("../utils/getScrollbarSize")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef"));function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;var r=e.innerText;return void 0===r&&(r=e.textContent),0!==(r=r.trim().toLowerCase()).length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,n,i){for(var u=!1,a=n(e,t,!!t&&r);a;){if(a===e.firstChild){if(u)return!1;u=!0}if(a.hasAttribute("tabindex")&&!a.disabled&&"true"!==a.getAttribute("aria-disabled")&&textCriteriaMatches(a,i))return a.focus(),!0;a=n(e,a,r)}return!1}var useEnhancedEffect="undefined"==typeof window?_react.default.useEffect:_react.default.useLayoutEffect,MenuList=_react.default.forwardRef(function(e,t){var r=e.actions,n=e.autoFocus,i=void 0!==n&&n,u=e.autoFocusItem,a=void 0!==u&&u,o=e.children,l=e.className,s=e.onKeyDown,c=e.disableListWrap,d=void 0!==c&&c,f=e.variant,p=void 0===f?"selectedMenu":f,_=(0,_objectWithoutProperties2.default)(e,["actions","autoFocus","autoFocusItem","children","className","onKeyDown","disableListWrap","variant"]),v=_react.default.useRef(null),m=_react.default.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(function(){i&&v.current.focus()},[i]),_react.default.useImperativeHandle(r,function(){return{adjustStyleForScrollbar:function(e,t){var r=!v.current.style.width;if(e.clientHeight<v.current.clientHeight&&r){var n="".concat((0,_getScrollbarSize.default)(!0),"px");v.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=n,v.current.style.width="calc(100% + ".concat(n,")")}return v.current}}},[]);var h=_react.default.useCallback(function(e){v.current=_reactDom.default.findDOMNode(e)},[]),y=(0,_useForkRef.default)(h,t),b=-1;_react.default.Children.forEach(o,function(e,t){_react.default.isValidElement(e)&&("production"!==process.env.NODE_ENV&&(0,_reactIs.isFragment)(e)&&console.error(["Material-UI: the Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===p&&e.props.selected||-1===b)&&(b=t))});var D=_react.default.Children.map(o,function(e,t){if(t===b){var r={};if(a&&(r.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===p&&(r.tabIndex=0),null!==r)return _react.default.cloneElement(e,r)}return e});return _react.default.createElement(_List.default,(0,_extends2.default)({role:"menu",ref:y,className:l,onKeyDown:function(e){var t=v.current,r=e.key,n=(0,_ownerDocument.default)(t).activeElement;if("ArrowDown"===r)e.preventDefault(),moveFocus(t,n,d,nextItem);else if("ArrowUp"===r)e.preventDefault(),moveFocus(t,n,d,previousItem);else if("Home"===r)e.preventDefault(),moveFocus(t,null,d,nextItem);else if("End"===r)e.preventDefault(),moveFocus(t,null,d,previousItem);else if(1===r.length){var i=m.current,u=r.toLowerCase(),a=performance.now();0<i.keys.length&&(500<a-i.lastTime?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&u!==i.keys[0]&&(i.repeating=!1)),i.lastTime=a,i.keys.push(u);var o=n&&!i.repeating&&textCriteriaMatches(n,i);i.previousKeyMatched&&(o||moveFocus(t,n,!1,nextItem,i))?e.preventDefault():i.previousKeyMatched=!1}s&&s(e)},tabIndex:i?0:-1},_),D)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={actions:_propTypes.default.shape({current:_propTypes.default.object}),autoFocus:_propTypes.default.bool,autoFocusItem:_propTypes.default.bool,children:_propTypes.default.node,className:_propTypes.default.string,disableListWrap:_propTypes.default.bool,onKeyDown:_propTypes.default.func,variant:_propTypes.default.oneOf(["menu","selectedMenu"])});var _default=MenuList;exports.default=_default;