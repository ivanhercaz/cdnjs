"use strict";const validation=require("./validation"),validateSchema=validation.validate,{hookRunner:hookRunner,hookIterator:hookIterator}=require("./hooks"),wrapThenable=require("./wrapThenable");function handleRequest(e,n,t){if(!0!==t.sent)if(null==e){var a=n.raw.method,r=n.headers;if("GET"!==a&&"HEAD"!==a){var o=r["content-type"];"POST"!==a&&"PUT"!==a&&"PATCH"!==a?"OPTIONS"!==a&&"DELETE"!==a?t.code(404).send(new Error("Not Found")):void 0===o||void 0===r["transfer-encoding"]&&void 0===r["content-length"]?handler(n,t):t.context.contentTypeParser.run(o,handler,n,t):void 0===o?void 0!==r["transfer-encoding"]||"0"!==r["content-length"]&&void 0!==r["content-length"]?t.context.contentTypeParser.run("",handler,n,t):handler(n,t):t.context.contentTypeParser.run(o,handler,n,t)}else handler(n,t)}else t.send(e)}function handler(e,n){null!==n.context.preValidation?hookRunner(n.context.preValidation,hookIterator,e,n,preValidationCallback):preValidationCallback(null,e,n)}function preValidationCallback(e,n,t){if(!0!==t.res.finished)if(null==e){var a=validateSchema(t.context,n);if(a){if(!1===t.context.attachValidation)return void t.code(400).send(a);t.request.validationError=a}null!==t.context.preHandler?hookRunner(t.context.preHandler,hookIterator,n,t,preHandlerCallback):preHandlerCallback(null,n,t)}else t.send(e)}function preHandlerCallback(e,n,t){if(!0!==t.res.finished)if(null==e){var a=t.context.handler(n,t);a&&"function"==typeof a.then&&wrapThenable(a,t)}else t.send(e)}module.exports=handleRequest,module.exports[Symbol.for("internals")]={handler:handler};