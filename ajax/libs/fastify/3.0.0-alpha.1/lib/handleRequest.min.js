"use strict";const{validate:validateSchema}=require("./validation"),{hookRunner:hookRunner,hookIterator:hookIterator}=require("./hooks"),wrapThenable=require("./wrapThenable");function handleRequest(e,n,t){if(!0!==t.sent)if(null==e){var r=n.raw.method,a=n.headers;if("GET"!==r&&"HEAD"!==r){var o=a["content-type"];"POST"!==r&&"PUT"!==r&&"PATCH"!==r?"OPTIONS"!==r&&"DELETE"!==r?t.code(404).send(new Error("Not Found")):void 0===o||void 0===a["transfer-encoding"]&&void 0===a["content-length"]?handler(n,t):t.context.contentTypeParser.run(o,handler,n,t):void 0===o?void 0!==a["transfer-encoding"]||"0"!==a["content-length"]&&void 0!==a["content-length"]?t.context.contentTypeParser.run("",handler,n,t):handler(n,t):t.context.contentTypeParser.run(o,handler,n,t)}else handler(n,t)}else t.send(e)}function handler(e,n){null!==n.context.preValidation?hookRunner(n.context.preValidation,hookIterator,e,n,preValidationCallback):preValidationCallback(null,e,n)}function preValidationCallback(e,n,t){if(!0!==t.sent&&!0!==t.raw.finished)if(null==e){var r=validateSchema(t.context,n);if(r){if(!1===t.context.attachValidation)return void t.code(400).send(r);t.request.validationError=r}null!==t.context.preHandler?hookRunner(t.context.preHandler,hookIterator,n,t,preHandlerCallback):preHandlerCallback(null,n,t)}else t.send(e)}function preHandlerCallback(e,n,t){if(!t.sent&&!0!==t.raw.finished)if(null==e){var r;try{r=t.context.handler(n,t)}catch(e){return void t.send(e)}void 0!==r&&(null!==r&&"function"==typeof r.then?wrapThenable(r,t):t.send(r))}else t.send(e)}module.exports=handleRequest,module.exports[Symbol.for("internals")]={handler:handler};