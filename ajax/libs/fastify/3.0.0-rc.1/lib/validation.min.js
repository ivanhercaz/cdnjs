"use strict";const headersSchema=Symbol("headers-schema"),paramsSchema=Symbol("params-schema"),querystringSchema=Symbol("querystring-schema"),bodySchema=Symbol("body-schema"),responseSchema=Symbol("response-schema");function compileSchemasForSerialization(e,r){if(!e.schema||!e.schema.response)return;const{method:a,url:s}=e.config||{};e[responseSchema]=Object.keys(e.schema.response).reduce(function(t,o){return t[o]=r({schema:e.schema.response[o],url:s,method:a,httpStatus:o}),t},{})}function compileSchemasForValidation(e,r){if(!e.schema)return;const{method:a,url:s}=e.config||{},t=e.schema.headers;if(t&&Object.getPrototypeOf(t)!==Object.prototype)e[headersSchema]=r({schema:t,method:a,url:s,httpPart:"headers"});else if(t){const o={};Object.keys(t).forEach(e=>{o[e]=t[e]}),o.required instanceof Array&&(o.required=o.required.map(e=>e.toLowerCase())),t.properties&&(o.properties={},Object.keys(t.properties).forEach(e=>{o.properties[e.toLowerCase()]=t.properties[e]})),e[headersSchema]=r({schema:o,method:a,url:s,httpPart:"headers"})}e.schema.body&&(e[bodySchema]=r({schema:e.schema.body,method:a,url:s,httpPart:"body"})),e.schema.querystring&&(e[querystringSchema]=r({schema:e.schema.querystring,method:a,url:s,httpPart:"querystring"})),e.schema.params&&(e[paramsSchema]=r({schema:e.schema.params,method:a,url:s,httpPart:"params"}))}function validateParam(e,r,a){var s=e&&e(r[a]);return!1===s?e.errors:s&&s.error?s.error:(s&&s.value&&(r[a]=s.value),!1)}function validate(e,r){var a=validateParam(e[paramsSchema],r,"params");if(a)return wrapValidationError(a,"params");var s=validateParam(e[bodySchema],r,"body");if(s)return wrapValidationError(s,"body");var t=validateParam(e[querystringSchema],r,"query");if(t)return wrapValidationError(t,"querystring");var o=validateParam(e[headersSchema],r,"headers");return o?wrapValidationError(o,"headers"):null}function wrapValidationError(e,r){if(e instanceof Error)return e;var a=new Error(schemaErrorsText(e,r));return a.validation=e,a.validationContext=r,a}function serialize(e,r,a){var s=e[responseSchema];if(!s)return JSON.stringify(r);if(s[a])return s[a](r);var t=(a+"")[0]+"xx";return s[t]?s[t](r):JSON.stringify(r)}function schemaErrorsText(e,r){for(var a="",s=0;s<e.length;s++){var t=e[s];a+=r+(t.dataPath||"")+" "+t.message+", "}return a.slice(0,-", ".length)}module.exports={symbols:{bodySchema:bodySchema,querystringSchema:querystringSchema,responseSchema:responseSchema,paramsSchema:paramsSchema,headersSchema:headersSchema},compileSchemasForValidation:compileSchemasForValidation,compileSchemasForSerialization:compileSchemasForSerialization,validate:validate,serialize:serialize};