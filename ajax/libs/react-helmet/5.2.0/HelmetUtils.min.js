exports.__esModule=!0,exports.warn=exports.requestAnimationFrame=exports.reducePropsToState=exports.mapStateOnServer=exports.handleClientStateChange=exports.convertReactPropstoHtmlAttributes=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_react=require("react"),_react2=_interopRequireDefault(_react),_objectAssign=require("object-assign"),_objectAssign2=_interopRequireDefault(_objectAssign),_HelmetConstants=require("./HelmetConstants.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var encodeSpecialCharacters=function(t,e){return!1===(!(1<arguments.length&&void 0!==e)||e)?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},getTitleFromPropsList=function(t){var e=getInnermostProperty(t,_HelmetConstants.TAG_NAMES.TITLE),n=getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.TITLE_TEMPLATE);if(n&&e)return n.replace(/%s/g,function(){return e});var r=getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.DEFAULT_TITLE);return e||r||void 0},getOnChangeClientState=function(t){return getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.ON_CHANGE_CLIENT_STATE)||function(){}},getAttributesFromPropsList=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(t,e){return _extends({},t,e)},{})},getBaseTagFromPropsList=function(s,t){return t.filter(function(t){return void 0!==t[_HelmetConstants.TAG_NAMES.BASE]}).map(function(t){return t[_HelmetConstants.TAG_NAMES.BASE]}).reverse().reduce(function(t,e){if(!t.length)for(var n=Object.keys(e),r=0;r<n.length;r++){var o=n[r].toLowerCase();if(-1!==s.indexOf(o)&&e[o])return t.concat(e)}return t},[])},getTagsFromPropsList=function(e,T,t){var l={};return t.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&warn("Helmet: "+e+' should be of type "Array". Instead found type "'+_typeof(t[e])+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,t){var i={};t.filter(function(t){for(var e=void 0,n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],s=o.toLowerCase();-1===T.indexOf(s)||e===_HelmetConstants.TAG_PROPERTIES.REL&&"canonical"===t[e].toLowerCase()||s===_HelmetConstants.TAG_PROPERTIES.REL&&"stylesheet"===t[s].toLowerCase()||(e=s),-1===T.indexOf(o)||o!==_HelmetConstants.TAG_PROPERTIES.INNER_HTML&&o!==_HelmetConstants.TAG_PROPERTIES.CSS_TEXT&&o!==_HelmetConstants.TAG_PROPERTIES.ITEM_PROP||(e=o)}if(!e||!t[e])return!1;var a=t[e].toLowerCase();return l[e]||(l[e]={}),i[e]||(i[e]={}),!l[e][a]&&(i[e][a]=!0)}).reverse().forEach(function(t){return e.push(t)});for(var n=Object.keys(i),r=0;r<n.length;r++){var o=n[r],s=(0,_objectAssign2.default)({},l[o],i[o]);l[o]=s}return e},[]).reverse()},getInnermostProperty=function(t,e){for(var n=t.length-1;0<=n;n--){var r=t[n];if(r.hasOwnProperty(e))return r[e]}return null},reducePropsToState=function(t){return{baseTag:getBaseTagFromPropsList([_HelmetConstants.TAG_PROPERTIES.HREF],t),bodyAttributes:getAttributesFromPropsList(_HelmetConstants.ATTRIBUTE_NAMES.BODY,t),defer:getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.DEFER),encode:getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:getAttributesFromPropsList(_HelmetConstants.ATTRIBUTE_NAMES.HTML,t),linkTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.LINK,[_HelmetConstants.TAG_PROPERTIES.REL,_HelmetConstants.TAG_PROPERTIES.HREF],t),metaTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.META,[_HelmetConstants.TAG_PROPERTIES.NAME,_HelmetConstants.TAG_PROPERTIES.CHARSET,_HelmetConstants.TAG_PROPERTIES.HTTPEQUIV,_HelmetConstants.TAG_PROPERTIES.PROPERTY,_HelmetConstants.TAG_PROPERTIES.ITEM_PROP],t),noscriptTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.NOSCRIPT,[_HelmetConstants.TAG_PROPERTIES.INNER_HTML],t),onChangeClientState:getOnChangeClientState(t),scriptTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.SCRIPT,[_HelmetConstants.TAG_PROPERTIES.SRC,_HelmetConstants.TAG_PROPERTIES.INNER_HTML],t),styleTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.STYLE,[_HelmetConstants.TAG_PROPERTIES.CSS_TEXT],t),title:getTitleFromPropsList(t),titleAttributes:getAttributesFromPropsList(_HelmetConstants.ATTRIBUTE_NAMES.TITLE,t)}},rafPolyfill=function(){var n=Date.now();return function(t){var e=Date.now();16<e-n?t(n=e):setTimeout(function(){rafPolyfill(t)},0)}}(),cafPolyfill=function(t){return clearTimeout(t)},requestAnimationFrame="undefined"!=typeof window?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||rafPolyfill:global.requestAnimationFrame||rafPolyfill,cancelAnimationFrame="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||cafPolyfill:global.cancelAnimationFrame||cafPolyfill,warn=function(t){return console&&"function"==typeof console.warn&&console.warn(t)},_helmetCallback=null,handleClientStateChange=function(t){_helmetCallback&&cancelAnimationFrame(_helmetCallback),_helmetCallback=t.defer?requestAnimationFrame(function(){commitTagChanges(t,function(){_helmetCallback=null})}):(commitTagChanges(t),null)},commitTagChanges=function(t,e){var n=t.baseTag,r=t.bodyAttributes,o=t.htmlAttributes,s=t.linkTags,a=t.metaTags,i=t.noscriptTags,T=t.onChangeClientState,l=t.scriptTags,u=t.styleTags,c=t.title,A=t.titleAttributes;updateAttributes(_HelmetConstants.TAG_NAMES.BODY,r),updateAttributes(_HelmetConstants.TAG_NAMES.HTML,o),updateTitle(c,A);var _={baseTag:updateTags(_HelmetConstants.TAG_NAMES.BASE,n),linkTags:updateTags(_HelmetConstants.TAG_NAMES.LINK,s),metaTags:updateTags(_HelmetConstants.TAG_NAMES.META,a),noscriptTags:updateTags(_HelmetConstants.TAG_NAMES.NOSCRIPT,i),scriptTags:updateTags(_HelmetConstants.TAG_NAMES.SCRIPT,l),styleTags:updateTags(_HelmetConstants.TAG_NAMES.STYLE,u)},m={},E={};Object.keys(_).forEach(function(t){var e=_[t],n=e.newTags,r=e.oldTags;n.length&&(m[t]=n),r.length&&(E[t]=_[t].oldTags)}),e&&e(),T(t,m,E)},flattenArray=function(t){return Array.isArray(t)?t.join(""):t},updateTitle=function(t,e){void 0!==t&&document.title!==t&&(document.title=flattenArray(t)),updateAttributes(_HelmetConstants.TAG_NAMES.TITLE,e)},updateAttributes=function(t,e){var n=document.getElementsByTagName(t)[0];if(n){for(var r=n.getAttribute(_HelmetConstants.HELMET_ATTRIBUTE),o=r?r.split(","):[],s=[].concat(o),a=Object.keys(e),i=0;i<a.length;i++){var T=a[i],l=e[T]||"";n.getAttribute(T)!==l&&n.setAttribute(T,l),-1===o.indexOf(T)&&o.push(T);var u=s.indexOf(T);-1!==u&&s.splice(u,1)}for(var c=s.length-1;0<=c;c--)n.removeAttribute(s[c]);o.length===s.length?n.removeAttribute(_HelmetConstants.HELMET_ATTRIBUTE):n.getAttribute(_HelmetConstants.HELMET_ATTRIBUTE)!==a.join(",")&&n.setAttribute(_HelmetConstants.HELMET_ATTRIBUTE,a.join(","))}},updateTags=function(o,t){var e=document.head||document.querySelector(_HelmetConstants.TAG_NAMES.HEAD),n=e.querySelectorAll(o+"["+_HelmetConstants.HELMET_ATTRIBUTE+"]"),s=Array.prototype.slice.call(n),a=[],i=void 0;return t&&t.length&&t.forEach(function(t){var n=document.createElement(o);for(var e in t)if(t.hasOwnProperty(e))if(e===_HelmetConstants.TAG_PROPERTIES.INNER_HTML)n.innerHTML=t.innerHTML;else if(e===_HelmetConstants.TAG_PROPERTIES.CSS_TEXT)n.styleSheet?n.styleSheet.cssText=t.cssText:n.appendChild(document.createTextNode(t.cssText));else{var r=void 0===t[e]?"":t[e];n.setAttribute(e,r)}n.setAttribute(_HelmetConstants.HELMET_ATTRIBUTE,"true"),s.some(function(t,e){return i=e,n.isEqualNode(t)})?s.splice(i,1):a.push(n)}),s.forEach(function(t){return t.parentNode.removeChild(t)}),a.forEach(function(t){return e.appendChild(t)}),{oldTags:s,newTags:a}},generateElementAttributesAsString=function(r){return Object.keys(r).reduce(function(t,e){var n=void 0!==r[e]?e+'="'+r[e]+'"':""+e;return t?t+" "+n:n},"")},generateTitleAsString=function(t,e,n,r){var o=generateElementAttributesAsString(n),s=flattenArray(e);return o?"<"+t+" "+_HelmetConstants.HELMET_ATTRIBUTE+'="true" '+o+">"+encodeSpecialCharacters(s,r)+"</"+t+">":"<"+t+" "+_HelmetConstants.HELMET_ATTRIBUTE+'="true">'+encodeSpecialCharacters(s,r)+"</"+t+">"},generateTagsAsString=function(s,t,a){return t.reduce(function(t,r){var e=Object.keys(r).filter(function(t){return!(t===_HelmetConstants.TAG_PROPERTIES.INNER_HTML||t===_HelmetConstants.TAG_PROPERTIES.CSS_TEXT)}).reduce(function(t,e){var n=void 0===r[e]?e:e+'="'+encodeSpecialCharacters(r[e],a)+'"';return t?t+" "+n:n},""),n=r.innerHTML||r.cssText||"",o=-1===_HelmetConstants.SELF_CLOSING_TAGS.indexOf(s);return t+"<"+s+" "+_HelmetConstants.HELMET_ATTRIBUTE+'="true" '+e+(o?"/>":">"+n+"</"+s+">")},"")},convertElementAttributestoReactProps=function(n,t){var e=1<arguments.length&&void 0!==t?t:{};return Object.keys(n).reduce(function(t,e){return t[_HelmetConstants.REACT_TAG_MAP[e]||e]=n[e],t},e)},convertReactPropstoHtmlAttributes=function(n,t){var e=1<arguments.length&&void 0!==t?t:{};return Object.keys(n).reduce(function(t,e){return t[_HelmetConstants.HTML_TAG_MAP[e]||e]=n[e],t},e)},generateTitleAsReactComponent=function(t,e,n){var r,o=((r={key:e})[_HelmetConstants.HELMET_ATTRIBUTE]=!0,r),s=convertElementAttributestoReactProps(n,o);return[_react2.default.createElement(_HelmetConstants.TAG_NAMES.TITLE,s,e)]},generateTagsAsReactComponent=function(n,t){return t.map(function(r,t){var e,o=((e={key:t})[_HelmetConstants.HELMET_ATTRIBUTE]=!0,e);return Object.keys(r).forEach(function(t){var e=_HelmetConstants.REACT_TAG_MAP[t]||t;if(e===_HelmetConstants.TAG_PROPERTIES.INNER_HTML||e===_HelmetConstants.TAG_PROPERTIES.CSS_TEXT){var n=r.innerHTML||r.cssText;o.dangerouslySetInnerHTML={__html:n}}else o[e]=r[t]}),_react2.default.createElement(n,o)})},getMethodsForTag=function(t,e,n){switch(t){case _HelmetConstants.TAG_NAMES.TITLE:return{toComponent:function(){return generateTitleAsReactComponent(t,e.title,e.titleAttributes,n)},toString:function(){return generateTitleAsString(t,e.title,e.titleAttributes,n)}};case _HelmetConstants.ATTRIBUTE_NAMES.BODY:case _HelmetConstants.ATTRIBUTE_NAMES.HTML:return{toComponent:function(){return convertElementAttributestoReactProps(e)},toString:function(){return generateElementAttributesAsString(e)}};default:return{toComponent:function(){return generateTagsAsReactComponent(t,e)},toString:function(){return generateTagsAsString(t,e,n)}}}},mapStateOnServer=function(t){var e=t.baseTag,n=t.bodyAttributes,r=t.encode,o=t.htmlAttributes,s=t.linkTags,a=t.metaTags,i=t.noscriptTags,T=t.scriptTags,l=t.styleTags,u=t.title,c=void 0===u?"":u,A=t.titleAttributes;return{base:getMethodsForTag(_HelmetConstants.TAG_NAMES.BASE,e,r),bodyAttributes:getMethodsForTag(_HelmetConstants.ATTRIBUTE_NAMES.BODY,n,r),htmlAttributes:getMethodsForTag(_HelmetConstants.ATTRIBUTE_NAMES.HTML,o,r),link:getMethodsForTag(_HelmetConstants.TAG_NAMES.LINK,s,r),meta:getMethodsForTag(_HelmetConstants.TAG_NAMES.META,a,r),noscript:getMethodsForTag(_HelmetConstants.TAG_NAMES.NOSCRIPT,i,r),script:getMethodsForTag(_HelmetConstants.TAG_NAMES.SCRIPT,T,r),style:getMethodsForTag(_HelmetConstants.TAG_NAMES.STYLE,l,r),title:getMethodsForTag(_HelmetConstants.TAG_NAMES.TITLE,{title:c,titleAttributes:A},r)}};exports.convertReactPropstoHtmlAttributes=convertReactPropstoHtmlAttributes,exports.handleClientStateChange=handleClientStateChange,exports.mapStateOnServer=mapStateOnServer,exports.reducePropsToState=reducePropsToState,exports.requestAnimationFrame=requestAnimationFrame,exports.warn=warn;