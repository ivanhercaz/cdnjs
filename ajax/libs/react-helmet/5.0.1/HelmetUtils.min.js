exports.__esModule=!0,exports.warn=exports.requestIdleCallback=exports.reducePropsToState=exports.mapStateOnServer=exports.handleClientStateChange=exports.convertReactPropstoHtmlAttributes=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_react=require("react"),_react2=_interopRequireDefault(_react),_objectAssign=require("object-assign"),_objectAssign2=_interopRequireDefault(_objectAssign),_HelmetConstants=require("./HelmetConstants.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var encodeSpecialCharacters=function(t,e){return!1===(!(1<arguments.length&&void 0!==e)||e)?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},getTitleFromPropsList=function(t){var e=getInnermostProperty(t,_HelmetConstants.TAG_NAMES.TITLE),n=getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.TITLE_TEMPLATE);if(n&&e)return n.replace(/%s/g,function(){return e});var r=getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.DEFAULT_TITLE);return e||r||""},getOnChangeClientState=function(t){return getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.ON_CHANGE_CLIENT_STATE)||function(){}},getAttributesFromPropsList=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(t,e){return _extends({},t,e)},{})},getBaseTagFromPropsList=function(o,t){return t.filter(function(t){return void 0!==t[_HelmetConstants.TAG_NAMES.BASE]}).map(function(t){return t[_HelmetConstants.TAG_NAMES.BASE]}).reverse().reduce(function(t,e){if(!t.length)for(var n=Object.keys(e),r=0;r<n.length;r++){var s=n[r].toLowerCase();if(-1!==o.indexOf(s)&&e[s])return t.concat(e)}return t},[])},getTagsFromPropsList=function(e,l,t){var i={};return t.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&warn("Helmet: "+e+' should be of type "Array". Instead found type "'+_typeof(t[e])+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,t){var T={};t.filter(function(t){for(var e=void 0,n=Object.keys(t),r=0;r<n.length;r++){var s=n[r],o=s.toLowerCase();-1===l.indexOf(o)||e===_HelmetConstants.TAG_PROPERTIES.REL&&"canonical"===t[e].toLowerCase()||o===_HelmetConstants.TAG_PROPERTIES.REL&&"stylesheet"===t[o].toLowerCase()||(e=o),-1===l.indexOf(s)||s!==_HelmetConstants.TAG_PROPERTIES.INNER_HTML&&s!==_HelmetConstants.TAG_PROPERTIES.CSS_TEXT&&s!==_HelmetConstants.TAG_PROPERTIES.ITEM_PROP||(e=s)}if(!e||!t[e])return!1;var a=t[e].toLowerCase();return i[e]||(i[e]={}),T[e]||(T[e]={}),!i[e][a]&&(T[e][a]=!0)}).reverse().forEach(function(t){return e.push(t)});for(var n=Object.keys(T),r=0;r<n.length;r++){var s=n[r],o=(0,_objectAssign2.default)({},i[s],T[s]);i[s]=o}return e},[]).reverse()},getInnermostProperty=function(t,e){for(var n=t.length-1;0<=n;n--){var r=t[n];if(r.hasOwnProperty(e))return r[e]}return null},reducePropsToState=function(t){return{baseTag:getBaseTagFromPropsList([_HelmetConstants.TAG_PROPERTIES.HREF],t),bodyAttributes:getAttributesFromPropsList(_HelmetConstants.ATTRIBUTE_NAMES.BODY,t),encode:getInnermostProperty(t,_HelmetConstants.HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:getAttributesFromPropsList(_HelmetConstants.ATTRIBUTE_NAMES.HTML,t),linkTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.LINK,[_HelmetConstants.TAG_PROPERTIES.REL,_HelmetConstants.TAG_PROPERTIES.HREF],t),metaTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.META,[_HelmetConstants.TAG_PROPERTIES.NAME,_HelmetConstants.TAG_PROPERTIES.CHARSET,_HelmetConstants.TAG_PROPERTIES.HTTPEQUIV,_HelmetConstants.TAG_PROPERTIES.PROPERTY,_HelmetConstants.TAG_PROPERTIES.ITEM_PROP],t),noscriptTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.NOSCRIPT,[_HelmetConstants.TAG_PROPERTIES.INNER_HTML],t),onChangeClientState:getOnChangeClientState(t),scriptTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.SCRIPT,[_HelmetConstants.TAG_PROPERTIES.SRC,_HelmetConstants.TAG_PROPERTIES.INNER_HTML],t),styleTags:getTagsFromPropsList(_HelmetConstants.TAG_NAMES.STYLE,[_HelmetConstants.TAG_PROPERTIES.CSS_TEXT],t),title:getTitleFromPropsList(t),titleAttributes:getAttributesFromPropsList(_HelmetConstants.ATTRIBUTE_NAMES.TITLE,t)}},requestIdleCallback="undefined"!=typeof window&&void 0!==window.requestIdleCallback?window.requestIdleCallback:function(t){var e=Date.now();return setTimeout(function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},1)},cancelIdleCallback="undefined"!=typeof window&&void 0!==window.cancelIdleCallback?window.cancelIdleCallback:function(t){return clearTimeout(t)},warn=function(t){return console&&"function"==typeof console.warn&&console.warn(t)},_helmetIdleCallback=null,handleClientStateChange=function(t){var e=t.baseTag,n=t.bodyAttributes,r=t.htmlAttributes,T=t.linkTags,l=t.metaTags,i=t.noscriptTags,u=t.onChangeClientState,c=t.scriptTags,_=t.styleTags,E=t.title,A=t.titleAttributes;_helmetIdleCallback&&cancelIdleCallback(_helmetIdleCallback),_helmetIdleCallback=requestIdleCallback(function(){updateAttributes(_HelmetConstants.TAG_NAMES.BODY,n),updateAttributes(_HelmetConstants.TAG_NAMES.HTML,r),updateTitle(E,A);var s={baseTag:updateTags(_HelmetConstants.TAG_NAMES.BASE,e),linkTags:updateTags(_HelmetConstants.TAG_NAMES.LINK,T),metaTags:updateTags(_HelmetConstants.TAG_NAMES.META,l),noscriptTags:updateTags(_HelmetConstants.TAG_NAMES.NOSCRIPT,i),scriptTags:updateTags(_HelmetConstants.TAG_NAMES.SCRIPT,c),styleTags:updateTags(_HelmetConstants.TAG_NAMES.STYLE,_)},o={},a={};Object.keys(s).forEach(function(t){var e=s[t],n=e.newTags,r=e.oldTags;n.length&&(o[t]=n),r.length&&(a[t]=s[t].oldTags)}),_helmetIdleCallback=null,u(t,o,a)})},updateTitle=function(t,e){document.title!==t&&(document.title=t),updateAttributes(_HelmetConstants.TAG_NAMES.TITLE,e)},updateAttributes=function(t,e){var n=document.getElementsByTagName(t)[0];if(n){for(var r=n.getAttribute(_HelmetConstants.HELMET_ATTRIBUTE),s=r?r.split(","):[],o=[].concat(s),a=Object.keys(e),T=0;T<a.length;T++){var l=a[T],i=e[l]||"";n.getAttribute(l)!==i&&n.setAttribute(l,i),-1===s.indexOf(l)&&s.push(l);var u=o.indexOf(l);-1!==u&&o.splice(u,1)}for(var c=o.length-1;0<=c;c--)n.removeAttribute(o[c]);s.length===o.length?n.removeAttribute(_HelmetConstants.HELMET_ATTRIBUTE):n.getAttribute(_HelmetConstants.HELMET_ATTRIBUTE)!==a.join(",")&&n.setAttribute(_HelmetConstants.HELMET_ATTRIBUTE,a.join(","))}},updateTags=function(s,t){var e=document.head||document.querySelector(_HelmetConstants.TAG_NAMES.HEAD),n=e.querySelectorAll(s+"["+_HelmetConstants.HELMET_ATTRIBUTE+"]"),o=Array.prototype.slice.call(n),a=[],T=void 0;return t&&t.length&&t.forEach(function(t){var n=document.createElement(s);for(var e in t)if(t.hasOwnProperty(e))if(e===_HelmetConstants.TAG_PROPERTIES.INNER_HTML)n.innerHTML=t.innerHTML;else if(e===_HelmetConstants.TAG_PROPERTIES.CSS_TEXT)n.styleSheet?n.styleSheet.cssText=t.cssText:n.appendChild(document.createTextNode(t.cssText));else{var r=void 0===t[e]?"":t[e];n.setAttribute(e,r)}n.setAttribute(_HelmetConstants.HELMET_ATTRIBUTE,"true"),o.some(function(t,e){return T=e,n.isEqualNode(t)})?o.splice(T,1):a.push(n)}),o.forEach(function(t){return t.parentNode.removeChild(t)}),a.forEach(function(t){return e.appendChild(t)}),{oldTags:o,newTags:a}},generateElementAttributesAsString=function(r){return Object.keys(r).reduce(function(t,e){var n=void 0!==r[e]?e+'="'+r[e]+'"':""+e;return t?t+" "+n:n},"")},generateTitleAsString=function(t,e,n,r){var s=generateElementAttributesAsString(n);return s?"<"+t+" "+_HelmetConstants.HELMET_ATTRIBUTE+'="true" '+s+">"+encodeSpecialCharacters(e,r)+"</"+t+">":"<"+t+" "+_HelmetConstants.HELMET_ATTRIBUTE+'="true">'+encodeSpecialCharacters(e,r)+"</"+t+">"},generateTagsAsString=function(o,t,a){return t.reduce(function(t,r){var e=Object.keys(r).filter(function(t){return!(t===_HelmetConstants.TAG_PROPERTIES.INNER_HTML||t===_HelmetConstants.TAG_PROPERTIES.CSS_TEXT)}).reduce(function(t,e){var n=void 0===r[e]?e:e+'="'+encodeSpecialCharacters(r[e],a)+'"';return t?t+" "+n:n},""),n=r.innerHTML||r.cssText||"",s=-1===_HelmetConstants.SELF_CLOSING_TAGS.indexOf(o);return t+"<"+o+" "+_HelmetConstants.HELMET_ATTRIBUTE+'="true" '+e+(s?"/>":">"+n+"</"+o+">")},"")},convertElementAttributestoReactProps=function(n,t){var e=1<arguments.length&&void 0!==t?t:{};return Object.keys(n).reduce(function(t,e){return t[_HelmetConstants.REACT_TAG_MAP[e]||e]=n[e],t},e)},convertReactPropstoHtmlAttributes=function(n,t){var e=1<arguments.length&&void 0!==t?t:{};return Object.keys(n).reduce(function(t,e){return t[_HelmetConstants.HTML_TAG_MAP[e]||e]=n[e],t},e)},generateTitleAsReactComponent=function(t,e,n){var r,s=((r={key:e})[_HelmetConstants.HELMET_ATTRIBUTE]=!0,r),o=convertElementAttributestoReactProps(n,s);return[_react2.default.createElement(_HelmetConstants.TAG_NAMES.TITLE,o,e)]},generateTagsAsReactComponent=function(n,t){return t.map(function(r,t){var e,s=((e={key:t})[_HelmetConstants.HELMET_ATTRIBUTE]=!0,e);return Object.keys(r).forEach(function(t){var e=_HelmetConstants.REACT_TAG_MAP[t]||t;if(e===_HelmetConstants.TAG_PROPERTIES.INNER_HTML||e===_HelmetConstants.TAG_PROPERTIES.CSS_TEXT){var n=r.innerHTML||r.cssText;s.dangerouslySetInnerHTML={__html:n}}else s[e]=r[t]}),_react2.default.createElement(n,s)})},getMethodsForTag=function(t,e,n){switch(t){case _HelmetConstants.TAG_NAMES.TITLE:return{toComponent:function(){return generateTitleAsReactComponent(t,e.title,e.titleAttributes,n)},toString:function(){return generateTitleAsString(t,e.title,e.titleAttributes,n)}};case _HelmetConstants.ATTRIBUTE_NAMES.BODY:case _HelmetConstants.ATTRIBUTE_NAMES.HTML:return{toComponent:function(){return convertElementAttributestoReactProps(e)},toString:function(){return generateElementAttributesAsString(e)}};default:return{toComponent:function(){return generateTagsAsReactComponent(t,e)},toString:function(){return generateTagsAsString(t,e,n)}}}},mapStateOnServer=function(t){var e=t.baseTag,n=t.bodyAttributes,r=t.encode,s=t.htmlAttributes,o=t.linkTags,a=t.metaTags,T=t.noscriptTags,l=t.scriptTags,i=t.styleTags,u=t.title,c=t.titleAttributes;return{base:getMethodsForTag(_HelmetConstants.TAG_NAMES.BASE,e,r),bodyAttributes:getMethodsForTag(_HelmetConstants.ATTRIBUTE_NAMES.BODY,n,r),htmlAttributes:getMethodsForTag(_HelmetConstants.ATTRIBUTE_NAMES.HTML,s,r),link:getMethodsForTag(_HelmetConstants.TAG_NAMES.LINK,o,r),meta:getMethodsForTag(_HelmetConstants.TAG_NAMES.META,a,r),noscript:getMethodsForTag(_HelmetConstants.TAG_NAMES.NOSCRIPT,T,r),script:getMethodsForTag(_HelmetConstants.TAG_NAMES.SCRIPT,l,r),style:getMethodsForTag(_HelmetConstants.TAG_NAMES.STYLE,i,r),title:getMethodsForTag(_HelmetConstants.TAG_NAMES.TITLE,{title:u,titleAttributes:c},r)}};exports.convertReactPropstoHtmlAttributes=convertReactPropstoHtmlAttributes,exports.handleClientStateChange=handleClientStateChange,exports.mapStateOnServer=mapStateOnServer,exports.reducePropsToState=reducePropsToState,exports.requestIdleCallback=requestIdleCallback,exports.warn=warn;