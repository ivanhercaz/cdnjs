var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};import React from"react";import objectAssign from"object-assign";import{ATTRIBUTE_NAMES,HELMET_ATTRIBUTE,HELMET_PROPS,HTML_TAG_MAP,REACT_TAG_MAP,SELF_CLOSING_TAGS,TAG_NAMES,TAG_PROPERTIES}from"./HelmetConstants.js";var encodeSpecialCharacters=function(t){return!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},getTitleFromPropsList=function(t){var e=getInnermostProperty(t,TAG_NAMES.TITLE),r=getInnermostProperty(t,HELMET_PROPS.TITLE_TEMPLATE);if(r&&e)return r.replace(/%s/g,function(){return e});var n=getInnermostProperty(t,HELMET_PROPS.DEFAULT_TITLE);return e||n||void 0},getOnChangeClientState=function(t){return getInnermostProperty(t,HELMET_PROPS.ON_CHANGE_CLIENT_STATE)||function(){}},getAttributesFromPropsList=function(t,e){return e.filter(function(e){return void 0!==e[t]}).map(function(e){return e[t]}).reduce(function(t,e){return _extends({},t,e)},{})},getBaseTagFromPropsList=function(t,e){return e.filter(function(t){return void 0!==t[TAG_NAMES.BASE]}).map(function(t){return t[TAG_NAMES.BASE]}).reverse().reduce(function(e,r){if(!e.length)for(var n=Object.keys(r),o=0;o<n.length;o++){var a=n[o].toLowerCase();if(-1!==t.indexOf(a)&&r[a])return e.concat(r)}return e},[])},getTagsFromPropsList=function(t,e,r){var n={};return r.filter(function(e){return!!Array.isArray(e[t])||(void 0!==e[t]&&warn("Helmet: "+t+' should be of type "Array". Instead found type "'+_typeof(e[t])+'"'),!1)}).map(function(e){return e[t]}).reverse().reduce(function(t,r){var o={};r.filter(function(t){for(var r=void 0,a=Object.keys(t),T=0;T<a.length;T++){var i=a[T],s=i.toLowerCase();-1===e.indexOf(s)||r===TAG_PROPERTIES.REL&&"canonical"===t[r].toLowerCase()||s===TAG_PROPERTIES.REL&&"stylesheet"===t[s].toLowerCase()||(r=s),-1===e.indexOf(i)||i!==TAG_PROPERTIES.INNER_HTML&&i!==TAG_PROPERTIES.CSS_TEXT&&i!==TAG_PROPERTIES.ITEM_PROP||(r=i)}if(!r||!t[r])return!1;var u=t[r].toLowerCase();return n[r]||(n[r]={}),o[r]||(o[r]={}),!n[r][u]&&(o[r][u]=!0,!0)}).reverse().forEach(function(e){return t.push(e)});for(var a=Object.keys(o),T=0;T<a.length;T++){var i=a[T],s=objectAssign({},n[i],o[i]);n[i]=s}return t},[]).reverse()},getInnermostProperty=function(t,e){for(var r=t.length-1;r>=0;r--){var n=t[r];if(n.hasOwnProperty(e))return n[e]}return null},reducePropsToState=function(t){return{baseTag:getBaseTagFromPropsList([TAG_PROPERTIES.HREF],t),bodyAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.BODY,t),defer:getInnermostProperty(t,HELMET_PROPS.DEFER),encode:getInnermostProperty(t,HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.HTML,t),linkTags:getTagsFromPropsList(TAG_NAMES.LINK,[TAG_PROPERTIES.REL,TAG_PROPERTIES.HREF],t),metaTags:getTagsFromPropsList(TAG_NAMES.META,[TAG_PROPERTIES.NAME,TAG_PROPERTIES.CHARSET,TAG_PROPERTIES.HTTPEQUIV,TAG_PROPERTIES.PROPERTY,TAG_PROPERTIES.ITEM_PROP],t),noscriptTags:getTagsFromPropsList(TAG_NAMES.NOSCRIPT,[TAG_PROPERTIES.INNER_HTML],t),onChangeClientState:getOnChangeClientState(t),scriptTags:getTagsFromPropsList(TAG_NAMES.SCRIPT,[TAG_PROPERTIES.SRC,TAG_PROPERTIES.INNER_HTML],t),styleTags:getTagsFromPropsList(TAG_NAMES.STYLE,[TAG_PROPERTIES.CSS_TEXT],t),title:getTitleFromPropsList(t),titleAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.TITLE,t)}},rafPolyfill=function(){var t=Date.now();return function(e){var r=Date.now();r-t>16?(t=r,e(r)):setTimeout(function(){rafPolyfill(e)},0)}}(),cafPolyfill=function(t){return clearTimeout(t)},requestAnimationFrame="undefined"!=typeof window?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||rafPolyfill:global.requestAnimationFrame||rafPolyfill,cancelAnimationFrame="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||cafPolyfill:global.cancelAnimationFrame||cafPolyfill,warn=function(t){return console&&"function"==typeof console.warn&&console.warn(t)},_helmetCallback=null,handleClientStateChange=function(t){_helmetCallback&&cancelAnimationFrame(_helmetCallback),t.defer?_helmetCallback=requestAnimationFrame(function(){commitTagChanges(t,function(){_helmetCallback=null})}):(commitTagChanges(t),_helmetCallback=null)},commitTagChanges=function(t,e){var r=t.baseTag,n=t.bodyAttributes,o=t.htmlAttributes,a=t.linkTags,T=t.metaTags,i=t.noscriptTags,s=t.onChangeClientState,u=t.scriptTags,A=t.styleTags,E=t.title,c=t.titleAttributes;updateAttributes(TAG_NAMES.BODY,n),updateAttributes(TAG_NAMES.HTML,o),updateTitle(E,c);var l={baseTag:updateTags(TAG_NAMES.BASE,r),linkTags:updateTags(TAG_NAMES.LINK,a),metaTags:updateTags(TAG_NAMES.META,T),noscriptTags:updateTags(TAG_NAMES.NOSCRIPT,i),scriptTags:updateTags(TAG_NAMES.SCRIPT,u),styleTags:updateTags(TAG_NAMES.STYLE,A)},g={},f={};Object.keys(l).forEach(function(t){var e=l[t],r=e.newTags,n=e.oldTags;r.length&&(g[t]=r),n.length&&(f[t]=l[t].oldTags)}),e&&e(),s(t,g,f)},flattenArray=function(t){return Array.isArray(t)?t.join(""):t},updateTitle=function(t,e){void 0!==t&&document.title!==t&&(document.title=flattenArray(t)),updateAttributes(TAG_NAMES.TITLE,e)},updateAttributes=function(t,e){var r=document.getElementsByTagName(t)[0];if(r){for(var n=r.getAttribute(HELMET_ATTRIBUTE),o=n?n.split(","):[],a=[].concat(o),T=Object.keys(e),i=0;i<T.length;i++){var s=T[i],u=e[s]||"";r.getAttribute(s)!==u&&r.setAttribute(s,u),-1===o.indexOf(s)&&o.push(s);var A=a.indexOf(s);-1!==A&&a.splice(A,1)}for(var E=a.length-1;E>=0;E--)r.removeAttribute(a[E]);o.length===a.length?r.removeAttribute(HELMET_ATTRIBUTE):r.getAttribute(HELMET_ATTRIBUTE)!==T.join(",")&&r.setAttribute(HELMET_ATTRIBUTE,T.join(","))}},updateTags=function(t,e){var r=document.head||document.querySelector(TAG_NAMES.HEAD),n=r.querySelectorAll(t+"["+HELMET_ATTRIBUTE+"]"),o=Array.prototype.slice.call(n),a=[],T=void 0;return e&&e.length&&e.forEach(function(e){var r=document.createElement(t);for(var n in e)if(e.hasOwnProperty(n))if(n===TAG_PROPERTIES.INNER_HTML)r.innerHTML=e.innerHTML;else if(n===TAG_PROPERTIES.CSS_TEXT)r.styleSheet?r.styleSheet.cssText=e.cssText:r.appendChild(document.createTextNode(e.cssText));else{var i=void 0===e[n]?"":e[n];r.setAttribute(n,i)}r.setAttribute(HELMET_ATTRIBUTE,"true"),o.some(function(t,e){return T=e,r.isEqualNode(t)})?o.splice(T,1):a.push(r)}),o.forEach(function(t){return t.parentNode.removeChild(t)}),a.forEach(function(t){return r.appendChild(t)}),{oldTags:o,newTags:a}},generateElementAttributesAsString=function(t){return Object.keys(t).reduce(function(e,r){var n=void 0!==t[r]?r+'="'+t[r]+'"':""+r;return e?e+" "+n:n},"")},generateTitleAsString=function(t,e,r,n){var o=generateElementAttributesAsString(r),a=flattenArray(e);return o?"<"+t+" "+HELMET_ATTRIBUTE+'="true" '+o+">"+encodeSpecialCharacters(a,n)+"</"+t+">":"<"+t+" "+HELMET_ATTRIBUTE+'="true">'+encodeSpecialCharacters(a,n)+"</"+t+">"},generateTagsAsString=function(t,e,r){return e.reduce(function(e,n){var o=Object.keys(n).filter(function(t){return!(t===TAG_PROPERTIES.INNER_HTML||t===TAG_PROPERTIES.CSS_TEXT)}).reduce(function(t,e){var o=void 0===n[e]?e:e+'="'+encodeSpecialCharacters(n[e],r)+'"';return t?t+" "+o:o},""),a=n.innerHTML||n.cssText||"",T=-1===SELF_CLOSING_TAGS.indexOf(t);return e+"<"+t+" "+HELMET_ATTRIBUTE+'="true" '+o+(T?"/>":">"+a+"</"+t+">")},"")},convertElementAttributestoReactProps=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(t).reduce(function(e,r){return e[REACT_TAG_MAP[r]||r]=t[r],e},e)},convertReactPropstoHtmlAttributes=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(t).reduce(function(e,r){return e[HTML_TAG_MAP[r]||r]=t[r],e},e)},generateTitleAsReactComponent=function(t,e,r){var n,o=((n={key:e})[HELMET_ATTRIBUTE]=!0,n),a=convertElementAttributestoReactProps(r,o);return[React.createElement(TAG_NAMES.TITLE,a,e)]},generateTagsAsReactComponent=function(t,e){return e.map(function(e,r){var n,o=((n={key:r})[HELMET_ATTRIBUTE]=!0,n);return Object.keys(e).forEach(function(t){var r=REACT_TAG_MAP[t]||t;if(r===TAG_PROPERTIES.INNER_HTML||r===TAG_PROPERTIES.CSS_TEXT){var n=e.innerHTML||e.cssText;o.dangerouslySetInnerHTML={__html:n}}else o[r]=e[t]}),React.createElement(t,o)})},getMethodsForTag=function(t,e,r){switch(t){case TAG_NAMES.TITLE:return{toComponent:function(){return generateTitleAsReactComponent(t,e.title,e.titleAttributes,r)},toString:function(){return generateTitleAsString(t,e.title,e.titleAttributes,r)}};case ATTRIBUTE_NAMES.BODY:case ATTRIBUTE_NAMES.HTML:return{toComponent:function(){return convertElementAttributestoReactProps(e)},toString:function(){return generateElementAttributesAsString(e)}};default:return{toComponent:function(){return generateTagsAsReactComponent(t,e)},toString:function(){return generateTagsAsString(t,e,r)}}}},mapStateOnServer=function(t){var e=t.baseTag,r=t.bodyAttributes,n=t.encode,o=t.htmlAttributes,a=t.linkTags,T=t.metaTags,i=t.noscriptTags,s=t.scriptTags,u=t.styleTags,A=t.title,E=void 0===A?"":A,c=t.titleAttributes;return{base:getMethodsForTag(TAG_NAMES.BASE,e,n),bodyAttributes:getMethodsForTag(ATTRIBUTE_NAMES.BODY,r,n),htmlAttributes:getMethodsForTag(ATTRIBUTE_NAMES.HTML,o,n),link:getMethodsForTag(TAG_NAMES.LINK,a,n),meta:getMethodsForTag(TAG_NAMES.META,T,n),noscript:getMethodsForTag(TAG_NAMES.NOSCRIPT,i,n),script:getMethodsForTag(TAG_NAMES.SCRIPT,s,n),style:getMethodsForTag(TAG_NAMES.STYLE,u,n),title:getMethodsForTag(TAG_NAMES.TITLE,{title:E,titleAttributes:c},n)}};export{convertReactPropstoHtmlAttributes};export{handleClientStateChange};export{mapStateOnServer};export{reducePropsToState};export{requestAnimationFrame};export{warn};