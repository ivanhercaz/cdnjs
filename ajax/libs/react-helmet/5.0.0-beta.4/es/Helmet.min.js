var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function _objectWithoutProperties(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}import React from"react";import withSideEffect from"react-side-effect";import deepEqual from"deep-equal";import objectAssign from"object-assign";import{ATTRIBUTE_NAMES,HELMET_ATTRIBUTE,HELMET_PROPS,HTML_TAG_MAP,REACT_TAG_MAP,SELF_CLOSING_TAGS,TAG_NAMES,TAG_PROPERTIES}from"./HelmetConstants.js";var encodeSpecialCharacters=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},getInnermostProperty=function(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r];if(n[t])return n[t]}return null},getTitleFromPropsList=function(e){var t=getInnermostProperty(e,TAG_NAMES.TITLE),r=getInnermostProperty(e,HELMET_PROPS.TITLE_TEMPLATE);if(r&&t)return r.replace(/%s/g,function(){return t});var n=getInnermostProperty(e,HELMET_PROPS.DEFAULT_TITLE);return t||n||""},getOnChangeClientState=function(e){return getInnermostProperty(e,HELMET_PROPS.ON_CHANGE_CLIENT_STATE)||function(){}},getAttributesFromPropsList=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(e,t){return _extends({},e,t)},{})},getBaseTagFromPropsList=function(e,t){return t.filter(function(e){return void 0!==e[TAG_NAMES.BASE]}).map(function(e){return e[TAG_NAMES.BASE]}).reverse().reduce(function(t,r){if(!t.length)for(var n=Object.keys(r),o=0;o<n.length;o++){var a=n[o].toLowerCase();if(-1!==e.indexOf(a)&&r[a])return t.concat(r)}return t},[])},getTagsFromPropsList=function(e,t,r){var n={};return r.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&warn("Helmet: "+e+' should be of type "Array". Instead found type "'+_typeof(t[e])+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,r){var o={};r.filter(function(e){for(var r=void 0,a=Object.keys(e),s=0;s<a.length;s++){var i=a[s],T=i.toLowerCase();-1===t.indexOf(T)||r===TAG_PROPERTIES.REL&&"canonical"===e[r].toLowerCase()||T===TAG_PROPERTIES.REL&&"stylesheet"===e[T].toLowerCase()||(r=T),-1===t.indexOf(i)||i!==TAG_PROPERTIES.INNER_HTML&&i!==TAG_PROPERTIES.CSS_TEXT&&i!==TAG_PROPERTIES.ITEM_PROP||(r=i)}if(!r||!e[r])return!1;var c=e[r].toLowerCase();return n[r]||(n[r]={}),o[r]||(o[r]={}),!n[r][c]&&(o[r][c]=!0,!0)}).reverse().forEach(function(t){return e.push(t)});for(var a=Object.keys(o),s=0;s<a.length;s++){var i=a[s],T=objectAssign({},n[i],o[i]);n[i]=T}return e},[]).reverse()},updateTitle=function(e,t){document.title=e||document.title,updateAttributes(TAG_NAMES.TITLE,t)},updateAttributes=function(e,t){for(var r=document.getElementsByTagName(e)[0],n=r.getAttribute(HELMET_ATTRIBUTE),o=n?n.split(","):[],a=[].concat(o),s=Object.keys(t),i=0;i<s.length;i++){var T=s[i],c=t[T]||"";r.setAttribute(T,c),-1===o.indexOf(T)&&o.push(T);var u=a.indexOf(T);-1!==u&&a.splice(u,1)}for(var p=a.length-1;p>=0;p--)r.removeAttribute(a[p]);o.length===a.length?r.removeAttribute(HELMET_ATTRIBUTE):r.setAttribute(HELMET_ATTRIBUTE,o.join(","))},updateTags=function(e,t){var r=document.head||document.querySelector(TAG_NAMES.HEAD),n=r.querySelectorAll(e+"["+HELMET_ATTRIBUTE+"]"),o=Array.prototype.slice.call(n),a=[],s=void 0;return t&&t.length&&t.forEach(function(t){var r=document.createElement(e);for(var n in t)if(t.hasOwnProperty(n))if(n===TAG_PROPERTIES.INNER_HTML)r.innerHTML=t.innerHTML;else if(n===TAG_PROPERTIES.CSS_TEXT)r.styleSheet?r.styleSheet.cssText=t.cssText:r.appendChild(document.createTextNode(t.cssText));else{var i=void 0===t[n]?"":t[n];r.setAttribute(n,i)}r.setAttribute(HELMET_ATTRIBUTE,"true"),o.some(function(e,t){return s=t,r.isEqualNode(e)})?o.splice(s,1):a.push(r)}),o.forEach(function(e){return e.parentNode.removeChild(e)}),a.forEach(function(e){return r.appendChild(e)}),{oldTags:o,newTags:a}},generateElementAttributesAsString=function(e){return Object.keys(e).reduce(function(t,r){var n=void 0!==e[r]?r+'="'+e[r]+'"':""+r;return t?t+" "+n:n},"")},generateTitleAsString=function(e,t,r){var n=generateElementAttributesAsString(r);return n?"<"+e+" "+HELMET_ATTRIBUTE+'="true" '+n+">"+encodeSpecialCharacters(t)+"</"+e+">":"<"+e+" "+HELMET_ATTRIBUTE+'="true">'+encodeSpecialCharacters(t)+"</"+e+">"},generateTagsAsString=function(e,t){return t.reduce(function(t,r){var n=Object.keys(r).filter(function(e){return!(e===TAG_PROPERTIES.INNER_HTML||e===TAG_PROPERTIES.CSS_TEXT)}).reduce(function(e,t){var n=void 0===r[t]?t:t+'="'+encodeSpecialCharacters(r[t])+'"';return e?e+" "+n:n},""),o=r.innerHTML||r.cssText||"",a=-1===SELF_CLOSING_TAGS.indexOf(e);return t+"<"+e+" "+HELMET_ATTRIBUTE+'="true" '+n+(a?"/>":">"+o+"</"+e+">")},"")},convertElementAttributestoReactProps=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[REACT_TAG_MAP[r]||r]=e[r],t},t)},convertReactPropstoHtmlAttributes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[HTML_TAG_MAP[r]||r]=e[r],t},t)},generateTitleAsReactComponent=function(e,t,r){var n=_defineProperty({key:t},HELMET_ATTRIBUTE,!0),o=convertElementAttributestoReactProps(r,n);return[React.createElement(TAG_NAMES.TITLE,o,t)]},generateTagsAsReactComponent=function(e,t){return t.map(function(t,r){var n=_defineProperty({key:r},HELMET_ATTRIBUTE,!0);return Object.keys(t).forEach(function(e){var r=REACT_TAG_MAP[e]||e;if(r===TAG_PROPERTIES.INNER_HTML||r===TAG_PROPERTIES.CSS_TEXT){var o=t.innerHTML||t.cssText;n.dangerouslySetInnerHTML={__html:o}}else n[r]=t[e]}),React.createElement(e,n)})},getMethodsForTag=function(e,t){switch(e){case TAG_NAMES.TITLE:return{toComponent:function(){return generateTitleAsReactComponent(e,t.title,t.titleAttributes)},toString:function(){return generateTitleAsString(e,t.title,t.titleAttributes)}};case ATTRIBUTE_NAMES.BODY:case ATTRIBUTE_NAMES.HTML:return{toComponent:function(){return convertElementAttributestoReactProps(t)},toString:function(){return generateElementAttributesAsString(t)}};default:return{toComponent:function(){return generateTagsAsReactComponent(e,t)},toString:function(){return generateTagsAsString(e,t)}}}},mapStateOnServer=function(e){var t=e.baseTag,r=e.bodyAttributes,n=e.htmlAttributes,o=e.linkTags,a=e.metaTags,s=e.noscriptTags,i=e.scriptTags,T=e.styleTags,c=e.title,u=e.titleAttributes;return{base:getMethodsForTag(TAG_NAMES.BASE,t),bodyAttributes:getMethodsForTag(ATTRIBUTE_NAMES.BODY,r),htmlAttributes:getMethodsForTag(ATTRIBUTE_NAMES.HTML,n),link:getMethodsForTag(TAG_NAMES.LINK,o),meta:getMethodsForTag(TAG_NAMES.META,a),noscript:getMethodsForTag(TAG_NAMES.NOSCRIPT,s),script:getMethodsForTag(TAG_NAMES.SCRIPT,i),style:getMethodsForTag(TAG_NAMES.STYLE,T),title:getMethodsForTag(TAG_NAMES.TITLE,{title:c,titleAttributes:u})}},Helmet=function(e){var t,r;return r=t=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,React.Component),_createClass(r,[{key:"shouldComponentUpdate",value:function(e){return!deepEqual(this.props,e)}},{key:"mapNestedChildrenToProps",value:function(e,t){if(!t)return null;switch(e.type){case TAG_NAMES.SCRIPT:case TAG_NAMES.NOSCRIPT:return{innerHTML:t};case TAG_NAMES.STYLE:return{cssText:t}}return t}},{key:"flattenArrayTypeChildren",value:function(e){var t=e.child,r=e.arrayTypeChildren,n=e.newChildProps,o=e.nestedChildren;return _extends({},r,_defineProperty({},t.type,[].concat(_toConsumableArray(r[t.type]||[]),[_extends({},n,this.mapNestedChildrenToProps(t,o))])))}},{key:"mapObjectTypeChildren",value:function(e){var t,r=e.child,n=e.newProps,o=e.newChildProps,a=e.nestedChildren;switch(r.type){case TAG_NAMES.TITLE:return _extends({},n,(_defineProperty(t={},r.type,a),_defineProperty(t,"titleAttributes",_extends({},o)),t));case TAG_NAMES.BODY:return _extends({},n,{bodyAttributes:_extends({},o)});case TAG_NAMES.HTML:return _extends({},n,{htmlAttributes:_extends({},o)})}return _extends({},n,_defineProperty({},r.type,_extends({},o)))}},{key:"mapArrayTypeChildrenToProps",value:function(e,t){var r=_extends({},t);return Object.keys(e).forEach(function(t){r=_extends({},r,_defineProperty({},t,e[t]))}),r}},{key:"warnOnInvalidChildren",value:function(e,t){"production"!==process.env.NODE_ENV&&t&&"string"!=typeof t&&console.warn("Helmet expects a single string as a child of "+e.type)}},{key:"mapChildrenToProps",value:function(e,t){var r=this,n={};return React.Children.forEach(e,function(e){var o=e.props,a=o.children,s=_objectWithoutProperties(o,["children"]),i=convertReactPropstoHtmlAttributes(s);switch(r.warnOnInvalidChildren(e,a),e.type){case TAG_NAMES.LINK:case TAG_NAMES.META:case TAG_NAMES.NOSCRIPT:case TAG_NAMES.SCRIPT:case TAG_NAMES.STYLE:n=r.flattenArrayTypeChildren({child:e,arrayTypeChildren:n,newChildProps:i,nestedChildren:a});break;default:t=r.mapObjectTypeChildren({child:e,newProps:t,newChildProps:i,nestedChildren:a})}}),t=this.mapArrayTypeChildrenToProps(n,t)}},{key:"render",value:function(){var t=this.props,r=t.children,n=_objectWithoutProperties(t,["children"]),o=_extends({},n);return r&&(o=this.mapChildrenToProps(r,o)),React.createElement(e,o)}}],[{key:"canUseDOM",set:function(t){e.canUseDOM=t}}]),r}(),t.propTypes={base:React.PropTypes.object,bodyAttributes:React.PropTypes.object,children:React.PropTypes.oneOfType([React.PropTypes.arrayOf(React.PropTypes.node),React.PropTypes.node]),defaultTitle:React.PropTypes.string,htmlAttributes:React.PropTypes.object,link:React.PropTypes.arrayOf(React.PropTypes.object),meta:React.PropTypes.arrayOf(React.PropTypes.object),noscript:React.PropTypes.arrayOf(React.PropTypes.object),onChangeClientState:React.PropTypes.func,script:React.PropTypes.arrayOf(React.PropTypes.object),style:React.PropTypes.arrayOf(React.PropTypes.object),title:React.PropTypes.string,titleAttributes:React.PropTypes.object,titleTemplate:React.PropTypes.string},t.peek=e.peek,t.rewind=function(){var t=e.rewind();return t||(t=mapStateOnServer({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),t},r},reducePropsToState=function(e){return{baseTag:getBaseTagFromPropsList([TAG_PROPERTIES.HREF],e),bodyAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.BODY,e),htmlAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.HTML,e),linkTags:getTagsFromPropsList(TAG_NAMES.LINK,[TAG_PROPERTIES.REL,TAG_PROPERTIES.HREF],e),metaTags:getTagsFromPropsList(TAG_NAMES.META,[TAG_PROPERTIES.NAME,TAG_PROPERTIES.CHARSET,TAG_PROPERTIES.HTTPEQUIV,TAG_PROPERTIES.PROPERTY,TAG_PROPERTIES.ITEM_PROP],e),noscriptTags:getTagsFromPropsList(TAG_NAMES.NOSCRIPT,[TAG_PROPERTIES.INNER_HTML],e),onChangeClientState:getOnChangeClientState(e),scriptTags:getTagsFromPropsList(TAG_NAMES.SCRIPT,[TAG_PROPERTIES.SRC,TAG_PROPERTIES.INNER_HTML],e),styleTags:getTagsFromPropsList(TAG_NAMES.STYLE,[TAG_PROPERTIES.CSS_TEXT],e),title:getTitleFromPropsList(e),titleAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.TITLE,e)}},handleClientStateChange=function(e){var t=e.baseTag,r=e.bodyAttributes,n=e.htmlAttributes,o=e.linkTags,a=e.metaTags,s=e.noscriptTags,i=e.onChangeClientState,T=e.scriptTags,c=e.styleTags,u=e.title,p=e.titleAttributes;updateAttributes(TAG_NAMES.BODY,r),updateAttributes(TAG_NAMES.HTML,n),updateTitle(u,p);var l={baseTag:updateTags(TAG_NAMES.BASE,t),linkTags:updateTags(TAG_NAMES.LINK,o),metaTags:updateTags(TAG_NAMES.META,a),noscriptTags:updateTags(TAG_NAMES.NOSCRIPT,s),scriptTags:updateTags(TAG_NAMES.SCRIPT,T),styleTags:updateTags(TAG_NAMES.STYLE,c)},E={},A={};Object.keys(l).forEach(function(e){var t=l[e],r=t.newTags,n=t.oldTags;r.length&&(E[e]=r),n.length&&(A[e]=l[e].oldTags)}),i(e,E,A)},warn=function(e){return console&&"function"==typeof console.warn&&console.warn(e)},NullComponent=function(){return null},HelmetSideEffects=withSideEffect(reducePropsToState,handleClientStateChange,mapStateOnServer)(NullComponent),HelmetExport=Helmet(HelmetSideEffects);HelmetExport.renderStatic=HelmetExport.rewind;export{HelmetExport as Helmet};export default HelmetExport;