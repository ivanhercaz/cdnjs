!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).singleSpa={})}(this,function(t){"use strict";var e=Object.freeze({__proto__:null,get start(){return Ct},get ensureJQuerySupport(){return gt},get setBootstrapMaxTime(){return Y},get setMountMaxTime(){return Z},get setUnmountMaxTime(){return tt},get setUnloadMaxTime(){return nt},get registerApplication(){return St},get getMountedApps(){return Pt},get getAppStatus(){return At},get unloadApplication(){return Mt},get checkActivityFunctions(){return _t},get getAppNames(){return Nt},get navigateToUrl(){return ut},get triggerAppChange(){return Lt},get addErrorHandler(){return r},get removeErrorHandler(){return i},get mountRootParcel(){return $},get NOT_LOADED(){return c},get LOADING_SOURCE_CODE(){return g},get NOT_BOOTSTRAPPED(){return w},get BOOTSTRAPPING(){return a},get NOT_MOUNTED(){return E},get MOUNTING(){return s},get UPDATING(){return b},get LOAD_ERROR(){return m},get MOUNTED(){return y},get UNMOUNTING(){return f},get SKIP_BECAUSE_BROKEN(){return T}}),n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).CustomEvent;var l=function(){try{var t=new n("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}}()?n:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(t,n){var e=document.createEvent("CustomEvent");return n?e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail):e.initCustomEvent(t,!1,!1,void 0),e}:function(t,n){var e=document.createEventObject();return e.type=t,n?(e.bubbles=Boolean(n.bubbles),e.cancelable=Boolean(n.cancelable),e.detail=n.detail):(e.bubbles=!1,e.cancelable=!1,e.detail=void 0),e};function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=[];function u(t,n,e){var r=v(t,n,e);o.length?o.forEach(function(t){return t(r)}):setTimeout(function(){throw r})}function r(t){if("function"!=typeof t)throw Error(d(28,"a single-spa error handler must be a function"));o.push(t)}function i(e){if("function"!=typeof e)throw Error(d(29,"a single-spa error handler must be a function"));var r=!1;return o=o.filter(function(t){var n=t===e;return r=r||n,!n}),r}function d(t,n){for(var e=arguments.length,r=new Array(2<e?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];return"single-spa minified message #".concat(t,": ").concat(n?n+" ":"","See https://single-spa.js.org/error/?code=").concat(t).concat(r.length?"&arg=".concat(r.join("&arg=")):"")}function v(n,t,e){var r,o="".concat(j(t)," '").concat(U(t),"' died in status ").concat(t.status,": ");if(n instanceof Error){try{n.message=o+n.message}catch(t){}r=n}else{console.warn(d(30,"While ".concat(t.status,", '").concat(U(t),"' rejected its lifecycle function promise with a non-Error. This will cause stack traces to not be accurate."),t.status,U(t)));try{r=Error(o+JSON.stringify(n))}catch(t){r=n}}return r.appOrParcelName=U(t),t.status=e,r}var c="NOT_LOADED",g="LOADING_SOURCE_CODE",w="NOT_BOOTSTRAPPED",a="BOOTSTRAPPING",E="NOT_MOUNTED",s="MOUNTING",y="MOUNTED",b="UPDATING",f="UNMOUNTING",p="UNLOADING",m="LOAD_ERROR",T="SKIP_BECAUSE_BROKEN";function O(t){return t.status===y}function P(t){return!O(t)}function N(t){return t.status!==c&&t.status!==g&&t.status!==m}function A(t){return!N(t)}function S(n){try{return n.activeWhen(window.location)}catch(t){u(t,n,T)}}function _(n){try{return!n.activeWhen(window.location)}catch(t){u(t,n,T)}}function D(t){return t!==T&&(!t||t.status!==T)}function M(t){return t.status!==m||200<=(new Date).getTime()-t.loadErrorTime}function U(t){return t.name}function x(t){return Boolean(t.unmountThisParcel)}function j(t){return x(t)?"parcel":"application"}function L(t){for(var n=arguments.length-1;0<n;n--)for(var e in arguments[n])"__proto__"!==e&&(arguments[n-1][e]=arguments[n][e]);return t}function I(t,n){for(var e=0;e<t.length;e++)if(n(t[e]))return t[e];return null}function R(t){return t&&("function"==typeof t||(n=t,Array.isArray(n)&&!I(n,function(t){return"function"!=typeof t})));var n}function C(t,o){var n=t[o]||[];0===(n=Array.isArray(n)?n:[n]).length&&(n=[function(){return Promise.resolve()}]);var i=j(t),a=U(t);return function(r){return n.reduce(function(t,n,e){return t.then(function(){var t=n(r);return B(t)?t:Promise.reject(d(15,"Within ".concat(i," ").concat(a,", the lifecycle function ").concat(o," at array index ").concat(e," did not return a promise"),i,a,o,e))})},Promise.resolve())}}function B(t){return t&&"function"==typeof t.then&&"function"==typeof t.catch}function G(n,e){return Promise.resolve().then(function(){return n.status!==w?n:(n.status=a,et(n,"bootstrap").then(function(){return n.status=E,n}).catch(function(t){if(e)throw v(t,n,T);return u(t,n,T),n}))})}function W(r,o){return Promise.resolve().then(function(){if(r.status!==y)return r;r.status=f;var t=Object.keys(r.parcels).map(function(t){return r.parcels[t].unmountThisParcel()});return Promise.all(t).then(e,function(n){return e().then(function(){var t=Error(n.message);if(o)throw v(t,r,T);u(t,r,T)})}).then(function(){return r});function e(){return et(r,"unmount").then(function(){r.status=E}).catch(function(t){if(o)throw v(t,r,T);u(t,r,T)})}})}var F=!1,k=!1;function K(e,r){return Promise.resolve().then(function(){return e.status!==E?e:(F||(window.dispatchEvent(new l("single-spa:before-first-mount")),F=!0),et(e,"mount").then(function(){return e.status=y,k||(window.dispatchEvent(new l("single-spa:first-mount")),k=!0),e}).catch(function(t){return e.status=y,W(e).then(n,n);function n(){if(r)throw v(t,e,T);return u(t,e,T),e}}))})}var H=0,J={parcels:{}};function $(){return q.apply(J,arguments)}function q(t,n){var e=this;if(!t||"object"!==h(t)&&"function"!=typeof t)throw Error(d(2,"Cannot mount parcel without a config object or config loading function"));if(t.name&&"string"!=typeof t.name)throw Error(d(3,"Parcel name must be a string, if provided. Was given ".concat(h(t.name)),h(t.name)));if("object"!==h(n))throw Error(d(4,"Parcel ".concat(name," has invalid customProps -- must be an object but was given ").concat(h(n)),name,h(n)));if(!n.domElement)throw Error(d(5,"Parcel ".concat(name," cannot be mounted without a domElement provided as a prop"),name));var i,a=H++,r="function"==typeof t,o=r?t:function(){return Promise.resolve(t)},u={id:a,parcels:{},status:r?g:w,customProps:n,parentName:U(e),unmountThisParcel:function(){if(u.status!==y)throw Error(d(6,"Cannot unmount parcel '".concat(name,"' -- it is in a ").concat(u.status," status"),name,u.status));return W(u,!0).then(function(t){return u.parentName&&delete e.parcels[u.id],t}).then(function(t){return s(t),t}).catch(function(t){throw u.status=T,f(t),t})}};e.parcels[a]=u;var c=o();if(!c||"function"!=typeof c.then)throw Error(d(7,"When mounting a parcel, the config loading function must return a promise that resolves with the parcel config"));var s,f,l=(c=c.then(function(t){if(!t)throw Error(d(8,"When mounting a parcel, the config loading function returned a promise that did not resolve with a parcel config"));var n=t.name||"parcel-".concat(a);if(!R(t.bootstrap))throw Error(d(9,"Parcel ".concat(n," must have a valid bootstrap function"),n));if(!R(t.mount))throw Error(d(10,"Parcel ".concat(n," must have a valid mount function"),n));if(!R(t.unmount))throw Error(d(11,"Parcel ".concat(n," must have a valid unmount function"),n));if(t.update&&!R(t.update))throw Error(d(12,"Parcel ".concat(n," provided an invalid update function"),n));var e=C(t,"bootstrap"),r=C(t,"mount"),o=C(t,"unmount");u.status=w,u.name=n,u.bootstrap=e,u.mount=r,u.unmount=o,u.timeouts=rt(t.timeouts),t.update&&(u.update=C(t,"update"),i.update=function(t){return u.customProps=t,Q((n=u,Promise.resolve().then(function(){if(n.status!==y)throw Error(d(32,"Cannot update parcel '".concat(U(n),"' because it is not mounted"),U(n)));return n.status=b,et(n,"update").then(function(){return n.status=y,n}).catch(function(t){throw v(t,n,T)})})));var n})})).then(function(){return G(u,!0)}),p=l.then(function(){return K(u,!0)}),m=new Promise(function(t,n){s=t,f=n});return i={mount:function(){return Q(Promise.resolve().then(function(){if(u.status!==E)throw Error(d(13,"Cannot mount parcel '".concat(name,"' -- it is in a ").concat(u.status," status"),name,u.status));return K(e.parcels[a]=u)}))},unmount:function(){return Q(u.unmountThisParcel())},getStatus:function(){return u.status},loadPromise:Q(c),bootstrapPromise:Q(l),mountPromise:Q(p),unmountPromise:Q(m)}}function Q(t){return t.then(function(){return null})}function V(t){var n=L({},t.customProps,{name:U(t),mountParcel:q.bind(t),singleSpa:e});return x(t)&&(n.unmountSelf=t.unmountThisParcel),n}var z=1e3,X={bootstrap:{millis:4e3,dieOnTimeout:!1,warningMillis:z},mount:{millis:3e3,dieOnTimeout:!1,warningMillis:z},unmount:{millis:3e3,dieOnTimeout:!1,warningMillis:z},unload:{millis:3e3,dieOnTimeout:!1,warningMillis:z},update:{millis:3e3,dieOnTimeout:!1,warningMillis:z}};function Y(t,n,e){if("number"!=typeof t||t<=0)throw Error(d(16,"bootstrap max time must be a positive integer number of milliseconds"));X.bootstrap={millis:t,dieOnTimeout:n,warningMillis:e||z}}function Z(t,n,e){if("number"!=typeof t||t<=0)throw Error(d(17,"mount max time must be a positive integer number of milliseconds"));X.mount={millis:t,dieOnTimeout:n,warningMillis:e||z}}function tt(t,n,e){if("number"!=typeof t||t<=0)throw Error(d(18,"unmount max time must be a positive integer number of milliseconds"));X.unmount={millis:t,dieOnTimeout:n,warningMillis:e||z}}function nt(t,n,e){if("number"!=typeof t||t<=0)throw Error(d(19,"unload max time must be a positive integer number of milliseconds"));X.unload={millis:t,dieOnTimeout:n,warningMillis:e||z}}function et(t,e){var c=t.timeouts[e],s=c.warningMillis,f=j(t);return new Promise(function(n,r){var o=!1,i=!1;t[e](V(t)).then(function(t){o=!0,n(t)}).catch(function(t){o=!0,r(t)}),setTimeout(function(){return u(1)},s),setTimeout(function(){return u(!0)},c.millis);var a=d(31,"Lifecycle function ".concat(e," for ").concat(f," ").concat(U(t)," lifecycle did not resolve or reject for ").concat(c.millis," ms."),e,f,U(t),c.millis);function u(t){if(!o)if(!0===t)i=!0,c.dieOnTimeout?r(Error(a)):console.error(a);else if(!i){var n=t,e=n*s;console.warn(a),e+s<c.millis&&setTimeout(function(){return u(n+1)},s)}}})}function rt(t){var n={};for(var e in X)n[e]=L({},X[e],t&&t[e]||{});return n}function ot(a){return Promise.resolve().then(function(){return a.loadPromise?a.loadPromise:a.status!==c&&a.status!==m?a:(a.status=g,a.loadPromise=Promise.resolve().then(function(){var t=a.loadImpl(V(a));if(!B(t))throw e=!0,Error(d(33,"single-spa loading function did not return a promise. Check the second argument to registerApplication('".concat(U(a),"', loadingFunction, activityFunction)"),U(a)));return t.then(function(t){var n,e;a.loadErrorTime=null,"object"!==h(i=t)&&(e=34,n="does not export anything"),R(i.bootstrap)||(e=35,n="does not export a bootstrap function or array of functions"),R(i.mount)||(e=36,n="does not export a bootstrap function or array of functions"),R(i.unmount)||(e=37,n="does not export a bootstrap function or array of functions");var r=j(i);if(e){var o;try{o=JSON.stringify(i)}catch(t){}return console.error(d(e,"The loading function for single-spa ".concat(r," '").concat(U(a),"' resolved with the following, which does not have bootstrap, mount, and unmount functions"),r,U(a),o),i),u(n,a,T),a}return i.devtools&&i.devtools.overlays&&(a.devtools.overlays=L({},a.devtools.overlays,i.devtools.overlays)),a.status=w,a.bootstrap=C(i,"bootstrap"),a.mount=C(i,"mount"),a.unmount=C(i,"unmount"),a.unload=C(i,"unload"),a.timeouts=rt(i.timeouts),delete a.loadPromise,a})}).catch(function(t){var n;return delete a.loadPromise,e?n=T:(n=m,a.loadErrorTime=(new Date).getTime()),u(t,a,n),a}));var i,e})}var it={hashchange:[],popstate:[]},at=["hashchange","popstate"];function ut(t){var n;if("string"==typeof t)n=t;else if(this&&this.href)n=this.href;else{if(!(t&&t.currentTarget&&t.currentTarget.href&&t.preventDefault))throw Error(d(14,"singleSpaNavigate/navigateToUrl must be either called with a string url, with an <a> tag as its context, or with an event whose currentTarget is an <a> tag"));n=t.currentTarget.href,t.preventDefault()}var e=dt(window.location.href),r=dt(n);0===n.indexOf("#")?window.location.hash=r.hash:e.host!==r.host&&r.host?window.location.href=n:r.pathname===e.pathname&&r.search===e.pathname?window.location.hash=r.hash:window.history.pushState(null,null,n)}function ct(n){var e=this;if(n){var t=n[0].type;0<=at.indexOf(t)&&it[t].forEach(function(t){try{t.apply(e,n)}catch(t){setTimeout(function(){throw t})}})}}function st(){It([],arguments)}window.addEventListener("hashchange",st),window.addEventListener("popstate",st);var ft=window.addEventListener,lt=window.removeEventListener;window.addEventListener=function(t,n){if(!("function"==typeof n&&0<=at.indexOf(t))||I(it[t],function(t){return t===n}))return ft.apply(this,arguments);it[t].push(n)},window.removeEventListener=function(t,n){if(!("function"==typeof n&&0<=at.indexOf(t)))return lt.apply(this,arguments);it[t]=it[t].filter(function(t){return t!==n})};var pt=window.history.pushState;window.history.pushState=function(t){var n=pt.apply(this,arguments);return st(ht(t)),n};var mt=window.history.replaceState;function ht(n){try{return new PopStateEvent("popstate",{state:n})}catch(t){var e=document.createEvent("PopStateEvent");return e.initPopStateEvent("popstate",!1,!1,n),e}}function dt(t){var n=document.createElement("a");return n.href=t,n}window.history.replaceState=function(t){var n=mt.apply(this,arguments);return st(ht(t)),n},window.singleSpaNavigate=ut;var vt=!1;function gt(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:window.jQuery;if(t||window.$&&window.$.fn&&window.$.fn.jquery&&(t=window.$),t&&!vt){var e=t.fn.on,r=t.fn.off;t.fn.on=function(t,n){return wt.call(this,e,window.addEventListener,t,n,arguments)},t.fn.off=function(t,n){return wt.call(this,r,window.removeEventListener,t,n,arguments)},vt=!0}}function wt(t,n,e,r,o){return"string"!=typeof e?t.apply(this,o):(e.split(/\s+/).forEach(function(t){0<=at.indexOf(t)&&(n(t,r),e=e.replace(t,""))}),""===e.trim()?this:t.apply(this,o))}var Et={};function yt(i){return Promise.resolve().then(function(){var o=Et[U(i)];return o?i.status===c?(bt(i,o),i):i.status===p?o.promise.then(function(){return i}):i.status!==E?i:(i.status=p,et(i,"unload").then(function(){return bt(i,o),i}).catch(function(t){var n,e,r;return e=o,r=t,delete Et[U(n=i)],delete n.bootstrap,delete n.mount,delete n.unmount,delete n.unload,u(r,n,T),e.reject(r),i})):i})}function bt(t,n){delete Et[U(t)],delete t.bootstrap,delete t.mount,delete t.unmount,delete t.unload,t.status=c,n.resolve()}function Tt(t,n,e,r){Et[U(t)]={app:t,resolve:e,reject:r},Object.defineProperty(Et[U(t)],"promise",{get:n})}var Ot=[];function Pt(){return Ot.filter(O).map(U)}function Nt(){return Ot.map(U)}function At(n){var t=I(Ot,function(t){return U(t)===n});return t?t.status:null}function St(t,n,e){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof t||0===t.length)throw Error(d(20,"The first argument to registerApplication must be a non-empty string 'appName'"));if(-1!==Nt().indexOf(t))throw Error(d(21,"There is already an app declared with name ".concat(t),t));if("object"!==h(o)||Array.isArray(o))throw Error(d(22,"customProps must be an object"));if(!n)throw Error(d(23,"The application or loading function is required"));if(r="function"!=typeof n?function(){return Promise.resolve(n)}:n,"function"!=typeof e)throw Error(d(24,"The activityFunction argument must be a function"));Ot.push({loadErrorTime:null,name:t,loadImpl:r,activeWhen:e,status:c,parcels:{},devtools:{overlays:{options:{},selectors:[]}},customProps:o}),gt(),It()}function _t(n){return Ot.filter(function(t){return t.activeWhen(n)}).map(U)}function Dt(){return Ot.filter(D).filter(M).filter(A).filter(S)}function Mt(n){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{waitForUnmount:!1};if("string"!=typeof n)throw Error(d(26,"unloadApplication requires a string 'appName'"));var e=I(Ot,function(t){return U(t)===n});if(!e)throw Error(d(27,"Could not unload application '".concat(n,"' because no such application has been registered"),n));var r,o,i=(r=U(e),Et[r]);if(t&&t.waitForUnmount){if(i)return i.promise;var a=new Promise(function(t,n){Tt(e,function(){return a},t,n)});return a}return i?(o=i.promise,Ut(e,i.resolve,i.reject)):o=new Promise(function(t,n){Tt(e,function(){return o},t,n),Ut(e,t,n)}),o}function Ut(t,n,e){W(t).then(yt).then(function(){n(),setTimeout(function(){It()})}).catch(e)}var xt=!1,jt=[];function Lt(){return It()}function It(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length?arguments[1]:void 0;if(xt)return new Promise(function(t,n){jt.push({resolve:t,reject:n,eventArguments:e})});var u=!0;return Rt?(xt=!0,Promise.resolve().then(function(){window.dispatchEvent(new l("single-spa:before-routing-event",f()));var t=Object.keys(Et).map(function(t){return Et[t].app}).filter(P).map(yt),n=Ot.filter(D).filter(O).filter(_).map(W).map(function(t){return t.then(yt)}).concat(t);0<n.length&&(u=!1);var e=Promise.all(n),r=Dt(),o=r.map(function(t){return ot(t).then(G).then(function(t){return e.then(function(){return K(t)})})});0<o.length&&(u=!1);var i=Ot.filter(D).filter(P).filter(N).filter(S).filter(function(t){return r.indexOf(t)<0}).map(function(t){return G(t).then(function(){return e}).then(function(){return K(t)})});return 0<i.length&&(u=!1),e.catch(function(t){throw s(),t}).then(function(){return s(),Promise.all(o.concat(i)).catch(function(n){throw a.forEach(function(t){return t.reject(n)}),n}).then(c)})})):Promise.resolve().then(function(){var t=Dt().map(ot);return 0<t.length&&(u=!1),Promise.all(t).then(s).then(function(){return[]}).catch(function(t){throw s(),t})});function c(){var n=Pt();a.forEach(function(t){return t.resolve(n)});try{var t=u?"single-spa:no-app-change":"single-spa:app-change";window.dispatchEvent(new l(t,f())),window.dispatchEvent(new l("single-spa:routing-event",f()))}catch(t){setTimeout(function(){throw t})}if(xt=!1,0<jt.length){var e=jt;jt=[],It(e)}return n}function s(){a.forEach(function(t){ct(t.eventArguments)}),ct(e)}function f(){var t={detail:{}};return e&&e[0]&&(t.detail.originalEvent=e[0]),t}}var Rt=!1;function Ct(){Rt=!0,It()}setTimeout(function(){Rt||console.warn(d(1,"singleSpa.start() has not been called, 5000ms after single-spa was loaded. Before start() is called, apps can be declared and loaded, but not bootstrapped or mounted."))},5e3);var Bt={getRawAppData:function(){return[].concat(Ot)},reroute:It,NOT_LOADED:c,toLoadPromise:ot,toBootstrapPromise:G,unregisterApplication:function(n){if(!Ot.find(function(t){return U(t)===n}))throw Error(d(25,"Cannot unregister application '".concat(n,"' because no such application has been registered"),n));return Mt(n).then(function(){var t=Ot.findIndex(function(t){return U(t)===n});Ot.splice(t,1)})}};window&&window.__SINGLE_SPA_DEVTOOLS__&&(window.__SINGLE_SPA_DEVTOOLS__.exposedMethods=Bt),t.BOOTSTRAPPING=a,t.LOADING_SOURCE_CODE=g,t.LOAD_ERROR=m,t.MOUNTED=y,t.MOUNTING=s,t.NOT_BOOTSTRAPPED=w,t.NOT_LOADED=c,t.NOT_MOUNTED=E,t.SKIP_BECAUSE_BROKEN=T,t.UNMOUNTING=f,t.UPDATING=b,t.addErrorHandler=r,t.checkActivityFunctions=_t,t.ensureJQuerySupport=gt,t.getAppNames=Nt,t.getAppStatus=At,t.getMountedApps=Pt,t.mountRootParcel=$,t.navigateToUrl=ut,t.registerApplication=St,t.removeErrorHandler=i,t.setBootstrapMaxTime=Y,t.setMountMaxTime=Z,t.setUnloadMaxTime=nt,t.setUnmountMaxTime=tt,t.start=Ct,t.triggerAppChange=Lt,t.unloadApplication=Mt,Object.defineProperty(t,"__esModule",{value:!0})});